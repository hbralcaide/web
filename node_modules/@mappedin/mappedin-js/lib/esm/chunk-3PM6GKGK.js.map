{
  "version": 3,
  "sources": ["../../../../node_modules/.pnpm/tinyqueue@2.0.3/node_modules/tinyqueue/tinyqueue.js", "../../../../node_modules/.pnpm/polylabel@1.1.0/node_modules/polylabel/polylabel.js", "../../../../node_modules/.pnpm/rbush@3.0.1/node_modules/rbush/rbush.min.js", "../../../../node_modules/.pnpm/@turf+helpers@6.5.0/node_modules/@turf/helpers/dist/js/index.js", "../../../../node_modules/.pnpm/@turf+meta@6.5.0/node_modules/@turf/meta/dist/js/index.js", "../../../../node_modules/.pnpm/@turf+bbox@6.5.0/node_modules/@turf/bbox/dist/js/index.js", "../../../../node_modules/.pnpm/geojson-rbush@3.2.0/node_modules/geojson-rbush/index.js", "../../src/index.ts", "../../src/map-data.ts", "../../src/analytics/index.ts", "../../src/analytics/customer.ts", "../../src/utils/fetch.ts", "../../src/utils/not-null.ts", "../../src/search/index.ts", "../../src/search/external.ts", "../../../packages/mvf-utils/index.ts", "../../../packages/mvf-utils/api-types.ts", "../../../packages/mvf-utils/mvf-types.ts", "../../../packages/mvf-utils/mvf-utils.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/no-validator.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/dist/types/geojson.js", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/dist/types/core.js", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/dist/types/bundle.js", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/extensions/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/dist/extensions/aesthetics.js", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/dist/extensions/annotation.js", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/dist/extensions/area.js", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/dist/extensions/textArea.js", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/dist/extensions/facade.js", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/dist/extensions/floorImage.js", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/dist/extensions/style.js", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/dist/extensions/window.js", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/extensions/enterprise.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/dist/extensions/tileset.js", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/extensions/location.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/dist/extensions/category.js", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/extensions/navigationFlags.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/error.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/locale.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/core/floors/floors.ts", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/clone/type.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/clone/value.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/guard/value.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/create/type.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/system/policy.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/guard/guard.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/create/immutable.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/error/error.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/guard/index.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/guard/kind.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/symbols/symbols.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/guard/type.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/patterns/patterns.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/registry/index.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/registry/format.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/registry/type.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/sets/set.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/any/any.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/array/array.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/async-iterator/async-iterator.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/awaited/awaited.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/intersect/intersect-evaluated.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/discard/discard.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/never/never.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/optional/optional-from-mapped-result.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/mapped/mapped-result.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/mapped/mapped.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/constructor/constructor.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/function/function.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/indexed/indexed-from-mapped-key.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/indexed/indexed.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/union/union-evaluated.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/union/union-create.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/union/union.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/indexed/indexed-property-keys.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/template-literal/finite.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/template-literal/parse.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/template-literal/generate.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/template-literal/syntax.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/literal/literal.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/boolean/boolean.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/bigint/bigint.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/number/number.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/string/string.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/template-literal/pattern.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/template-literal/union.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/template-literal/template-literal.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/indexed/indexed-from-mapped-result.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/iterator/iterator.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/object/object.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/promise/promise.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/readonly/readonly-from-mapped-result.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/readonly/readonly.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/tuple/tuple.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/optional/optional.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/intersect/intersect-create.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/intersect/intersect.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/composite/composite.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/keyof/keyof-from-mapped-result.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/keyof/keyof.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/keyof/keyof-property-keys.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/keyof/keyof-property-entries.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/const/const.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/date/date.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/null/null.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/symbol/symbol.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/undefined/undefined.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/uint8array/uint8array.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/unknown/unknown.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/constructor-parameters/constructor-parameters.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/deref/deref.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/enum/enum.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/exclude/exclude-from-mapped-result.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/exclude/exclude.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/extends/extends-check.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/extends/extends-from-mapped-key.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/extends/extends.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/extends/extends-from-mapped-result.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/extends/extends-undefined.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/exclude/exclude-from-template-literal.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/extract/extract-from-mapped-result.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/extract/extract.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/extract/extract-from-template-literal.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/instance-type/instance-type.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/integer/integer.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/intrinsic/capitalize.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/intrinsic/intrinsic.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/intrinsic/intrinsic-from-mapped-key.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/intrinsic/lowercase.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/intrinsic/uncapitalize.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/intrinsic/uppercase.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/not/not.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/omit/omit-from-mapped-key.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/omit/omit.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/omit/omit-from-mapped-result.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/parameters/parameters.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/partial/partial-from-mapped-result.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/partial/partial.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/pick/pick-from-mapped-key.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/pick/pick.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/pick/pick-from-mapped-result.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/readonly-optional/readonly-optional.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/record/record.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/recursive/recursive.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/ref/ref.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/regexp/regexp.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/required/required-from-mapped-result.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/required/required.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/rest/rest.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/return-type/return-type.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/strict/strict.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/transform/transform.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/unsafe/unsafe.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/void/void.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/type/index.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/type/type/type.mjs", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utility-types/details/details.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/core/geojson/geojson.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/core/identifiers/identifiers.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/core/floors/floors.integrity.ts", "../../../../node_modules/.pnpm/@mappedin+safe-types@1.0.1/node_modules/@mappedin/safe-types/src/result.ts", "../../../../node_modules/.pnpm/@mappedin+safe-types@1.0.1/node_modules/@mappedin/safe-types/src/option.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/errors/integrity.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utils/ensure-unique-ids.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/errors/compress.ts", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/errors/errors.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/system/system.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/errors/function.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/deref/deref.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/hash/hash.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/check/check.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/index.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/assert/assert.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/cast/cast.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/create/create.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/clone/clone.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/clean/clean.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/convert/convert.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/decode/decode.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/transform/decode.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/transform/encode.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/transform/has.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/default/default.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/delta/delta.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/pointer/index.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/pointer/pointer.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/equal/equal.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/encode/encode.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/mutate/mutate.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/parse/parse.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/value/index.mjs", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/value/value/value.mjs", "../../../../node_modules/.pnpm/fflate@0.8.2/node_modules/fflate/esm/browser.js", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/test/short-error.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/errors/decompress.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/core/geometry/geometry.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utility-types/partial-record.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utils/typed-keys.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/core/geometry/geometry.integrity.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/core/floors/floors.validation.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/core/manifest/manifest.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/parser.builder.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/parser.ts", "../../../../node_modules/.pnpm/@mappedin+typebox-fast-transform@1.0.0-bl-SDKS-3339-2.79be6db.0_2947aa8c8fee90858d5809cd2386a8fd/node_modules/@mappedin/typebox-fast-transform/src/fast-decode.ts", "../../../../node_modules/.pnpm/@mappedin+typebox-fast-transform@1.0.0-bl-SDKS-3339-2.79be6db.0_2947aa8c8fee90858d5809cd2386a8fd/node_modules/@mappedin/typebox-fast-transform/src/deref.ts", "../../../../node_modules/.pnpm/@mappedin+typebox-fast-transform@1.0.0-bl-SDKS-3339-2.79be6db.0_2947aa8c8fee90858d5809cd2386a8fd/node_modules/@mappedin/typebox-fast-transform/src/transform-cache.ts", "../../../../node_modules/.pnpm/@mappedin+typebox-fast-transform@1.0.0-bl-SDKS-3339-2.79be6db.0_2947aa8c8fee90858d5809cd2386a8fd/node_modules/@mappedin/typebox-fast-transform/src/fast-encode.ts", "../../../../node_modules/.pnpm/@sinclair+typebox@0.33.22/node_modules/@sinclair/typebox/build/esm/compiler/compiler.mjs", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/formats/register.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/formats/date-time.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/formats/date.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/formats/time.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/formats/uri.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utility-types/extra/extra.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utility-types/geometry-id/geometry-id.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/core/floors/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/core/geojson/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/core/geometry/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/core/geometry/geometry.validation.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utils/typed-entries.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/core/identifiers/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utils/bundling/compress.ts", "../../../../node_modules/.pnpm/@mappedin+safe-types@1.0.1/node_modules/@mappedin/safe-types/src/result/safe-fn.ts", "../../../../node_modules/.pnpm/@mappedin+safe-types@1.0.1/node_modules/@mappedin/safe-types/src/result/as-error.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utils/bundling/decompress.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utils/locale/deep-merge.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utils/fix-duplicate-all-of.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utils/prefix-references.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utility-types/details/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utility-types/extra/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utility-types/geometry-anchor/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utility-types/geometry-anchor/geometry-anchor.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utility-types/geometry-id/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utility-types/safe-enum/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utility-types/safe-enum/safe-enum.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/raw-to-parsed.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/converter/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-annotations@3.0.0-bl-SDKS-3339-2.79be6db.0_228232bd1497a9b8ba066db1c309b02a/node_modules/@mappedin/mvf-annotations/src/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-bl-SDKS-3339-2.79be6db.0_2846b5a0933079619d19c722eb9af5f4/node_modules/@mappedin/mvf-core/src/utils/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-annotations@3.0.0-bl-SDKS-3339-2.79be6db.0_228232bd1497a9b8ba066db1c309b02a/node_modules/@mappedin/mvf-annotations/src/integrity.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-annotations@3.0.0-bl-SDKS-3339-2.79be6db.0_228232bd1497a9b8ba066db1c309b02a/node_modules/@mappedin/mvf-annotations/src/errors.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-cms@3.0.0-bl-SDKS-3339-2.79be6db.0_93204ff7c0aa626c1344ccd4e2e7108d/node_modules/@mappedin/mvf-cms/src/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-locations@3.0.0-bl-SDKS-3339-2.79be6db.0_d6dfc3bd745c68385cbef517f1fa707e/node_modules/@mappedin/mvf-locations/src/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-locations@3.0.0-bl-SDKS-3339-2.79be6db.0_d6dfc3bd745c68385cbef517f1fa707e/node_modules/@mappedin/mvf-locations/src/category.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-locations@3.0.0-bl-SDKS-3339-2.79be6db.0_d6dfc3bd745c68385cbef517f1fa707e/node_modules/@mappedin/mvf-locations/src/integrity.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-locations@3.0.0-bl-SDKS-3339-2.79be6db.0_d6dfc3bd745c68385cbef517f1fa707e/node_modules/@mappedin/mvf-locations/src/error.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-locations@3.0.0-bl-SDKS-3339-2.79be6db.0_d6dfc3bd745c68385cbef517f1fa707e/node_modules/@mappedin/mvf-locations/src/location.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-cms@3.0.0-bl-SDKS-3339-2.79be6db.0_93204ff7c0aa626c1344ccd4e2e7108d/node_modules/@mappedin/mvf-cms/src/integrity.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-cms@3.0.0-bl-SDKS-3339-2.79be6db.0_93204ff7c0aa626c1344ccd4e2e7108d/node_modules/@mappedin/mvf-cms/src/error.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-cms@3.0.0-bl-SDKS-3339-2.79be6db.0_93204ff7c0aa626c1344ccd4e2e7108d/node_modules/@mappedin/mvf-cms/src/subSchemas/enterpriseCategories.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-cms@3.0.0-bl-SDKS-3339-2.79be6db.0_93204ff7c0aa626c1344ccd4e2e7108d/node_modules/@mappedin/mvf-cms/src/subSchemas/identifiers.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-cms@3.0.0-bl-SDKS-3339-2.79be6db.0_93204ff7c0aa626c1344ccd4e2e7108d/node_modules/@mappedin/mvf-cms/src/subSchemas/enterpriseFloorText.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-cms@3.0.0-bl-SDKS-3339-2.79be6db.0_93204ff7c0aa626c1344ccd4e2e7108d/node_modules/@mappedin/mvf-cms/src/subSchemas/enterpriseLayers.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-cms@3.0.0-bl-SDKS-3339-2.79be6db.0_93204ff7c0aa626c1344ccd4e2e7108d/node_modules/@mappedin/mvf-cms/src/subSchemas/enterpriseLocationInstance.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-cms@3.0.0-bl-SDKS-3339-2.79be6db.0_93204ff7c0aa626c1344ccd4e2e7108d/node_modules/@mappedin/mvf-cms/src/subSchemas/enterpriseLocations.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-cms@3.0.0-bl-SDKS-3339-2.79be6db.0_93204ff7c0aa626c1344ccd4e2e7108d/node_modules/@mappedin/mvf-cms/src/subSchemas/utils.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-cms@3.0.0-bl-SDKS-3339-2.79be6db.0_93204ff7c0aa626c1344ccd4e2e7108d/node_modules/@mappedin/mvf-cms/src/subSchemas/enterpriseTextAreas.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-cms@3.0.0-bl-SDKS-3339-2.79be6db.0_93204ff7c0aa626c1344ccd4e2e7108d/node_modules/@mappedin/mvf-cms/src/subSchemas/enterpriseTextures.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-cms@3.0.0-bl-SDKS-3339-2.79be6db.0_93204ff7c0aa626c1344ccd4e2e7108d/node_modules/@mappedin/mvf-cms/src/subSchemas/enterpriseVenue.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-connections@3.0.0-bl-SDKS-3339-2.79be6db.0_dc8632df7c114c770843cadcd3a8589b/node_modules/@mappedin/mvf-connections/src/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-navigation-flags@3.0.0-bl-SDKS-3339-2.79be6db.0_8099c97b4c011b1a0a99b6529ac692ee/node_modules/@mappedin/mvf-navigation-flags/src/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-navigation-flags@3.0.0-bl-SDKS-3339-2.79be6db.0_8099c97b4c011b1a0a99b6529ac692ee/node_modules/@mappedin/mvf-navigation-flags/src/integrity.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-navigation-flags@3.0.0-bl-SDKS-3339-2.79be6db.0_8099c97b4c011b1a0a99b6529ac692ee/node_modules/@mappedin/mvf-navigation-flags/src/errors.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-navigation-flags@3.0.0-bl-SDKS-3339-2.79be6db.0_8099c97b4c011b1a0a99b6529ac692ee/node_modules/@mappedin/mvf-navigation-flags/src/utils.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-navigation-flags@3.0.0-bl-SDKS-3339-2.79be6db.0_8099c97b4c011b1a0a99b6529ac692ee/node_modules/@mappedin/mvf-navigation-flags/src/validation.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-connections@3.0.0-bl-SDKS-3339-2.79be6db.0_dc8632df7c114c770843cadcd3a8589b/node_modules/@mappedin/mvf-connections/src/integrity.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-default-style@3.0.0-bl-SDKS-3339-2.79be6db.0_724756a26c31eb84bb3ef14a77a365c7/node_modules/@mappedin/mvf-default-style/src/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-default-style@3.0.0-bl-SDKS-3339-2.79be6db.0_724756a26c31eb84bb3ef14a77a365c7/node_modules/@mappedin/mvf-default-style/src/integrity.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-facade@3.0.0-bl-SDKS-3339-2.79be6db.0_f9a7ceab60e3e633f35cee5d56c47e16/node_modules/@mappedin/mvf-facade/src/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-floor-stacks@3.0.0-bl-SDKS-3339-2.79be6db.0_f52141c0c1d3c521abe9f5f858cb9210/node_modules/@mappedin/mvf-floor-stacks/src/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-floor-stacks@3.0.0-bl-SDKS-3339-2.79be6db.0_f52141c0c1d3c521abe9f5f858cb9210/node_modules/@mappedin/mvf-floor-stacks/src/integrity.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-floor-stacks@3.0.0-bl-SDKS-3339-2.79be6db.0_f52141c0c1d3c521abe9f5f858cb9210/node_modules/@mappedin/mvf-floor-stacks/src/error.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-facade@3.0.0-bl-SDKS-3339-2.79be6db.0_f9a7ceab60e3e633f35cee5d56c47e16/node_modules/@mappedin/mvf-facade/src/integrity.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-facade@3.0.0-bl-SDKS-3339-2.79be6db.0_f9a7ceab60e3e633f35cee5d56c47e16/node_modules/@mappedin/mvf-facade/src/error.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-floor-images@3.0.0-bl-SDKS-3339-2.79be6db.0_089a13cad14403104fa13aa00e46e533/node_modules/@mappedin/mvf-floor-images/src/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-floor-images@3.0.0-bl-SDKS-3339-2.79be6db.0_089a13cad14403104fa13aa00e46e533/node_modules/@mappedin/mvf-floor-images/src/integrity.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-kinds@3.0.0-bl-SDKS-3339-2.79be6db.0_3ed6e374fc6ba22a5015771dded77273/node_modules/@mappedin/mvf-kinds/src/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-kinds@3.0.0-bl-SDKS-3339-2.79be6db.0_3ed6e374fc6ba22a5015771dded77273/node_modules/@mappedin/mvf-kinds/src/integrity.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-nodes@3.0.0-bl-SDKS-3339-2.79be6db.0_b3ec002b61b6bb0c4f7b73c653b67f35/node_modules/@mappedin/mvf-nodes/src/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-nodes@3.0.0-bl-SDKS-3339-2.79be6db.0_b3ec002b61b6bb0c4f7b73c653b67f35/node_modules/@mappedin/mvf-nodes/src/integrity.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-nodes@3.0.0-bl-SDKS-3339-2.79be6db.0_b3ec002b61b6bb0c4f7b73c653b67f35/node_modules/@mappedin/mvf-nodes/src/errors.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-outdoors@3.0.0-bl-SDKS-3339-2.79be6db.0_3ecc1556d6d3ca4bbf5e873f340afdc1/node_modules/@mappedin/mvf-outdoors/src/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-outdoors@3.0.0-bl-SDKS-3339-2.79be6db.0_3ecc1556d6d3ca4bbf5e873f340afdc1/node_modules/@mappedin/mvf-outdoors/src/integrity.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-outdoors@3.0.0-bl-SDKS-3339-2.79be6db.0_3ecc1556d6d3ca4bbf5e873f340afdc1/node_modules/@mappedin/mvf-outdoors/src/error.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-tileset@3.0.0-bl-SDKS-3339-2.79be6db.0_7765e0dd322accceba619ae258efa79e/node_modules/@mappedin/mvf-tileset/src/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-tileset@3.0.0-bl-SDKS-3339-2.79be6db.0_7765e0dd322accceba619ae258efa79e/node_modules/@mappedin/mvf-tileset/src/integrity.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-tileset@3.0.0-bl-SDKS-3339-2.79be6db.0_7765e0dd322accceba619ae258efa79e/node_modules/@mappedin/mvf-tileset/src/errors.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-traversability@3.0.0-bl-SDKS-3339-2.79be6db.0_c57fb78b9853d5e60a4d52c17a04fee4/node_modules/@mappedin/mvf-traversability/src/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/converter/builderOptions.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/converter/converterUtils.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/converter/builders/annotationBuilder.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/converter/builders/connectionBuilder.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/converter/builders/enterpriseBuilder.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/converter/builders/facadeBuilder.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/converter/builders/floorBuilder.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/converter/builders/floorImagesBuilder.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/converter/builders/floorStackBuilder.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/converter/builders/geometryBuilder.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/converter/geoCenter.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/converter/builders/locationBuilder.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/converter/builders/manifestBuilder.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/converter/builders/nodeBuilder.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-v2@2.100.0-bl-SDKS-3339-2.79be6db.0_4d96c5dd134d51083ccde5816fb61709/node_modules/@mappedin/mvf-v2/src/converter/builders/styleBuilder.ts", "../../../packages/common/normalize-url.ts", "../../../packages/mvf-utils/constants.ts", "../../../packages/mvf-utils/tokens/access-token.ts", "../../../packages/mvf-utils/tokens/utils.ts", "../../../packages/mvf-utils/tokens/sas-token.ts", "../../../../node_modules/.pnpm/fflate@0.7.4/node_modules/fflate/esm/browser.js", "../../../packages/mvf-utils/geometry.ts", "../../../../node_modules/.pnpm/@turf+boolean-point-on-line@6.5.0/node_modules/@turf/boolean-point-on-line/dist/es/index.js", "../../../../node_modules/.pnpm/@turf+invariant@6.5.0/node_modules/@turf/invariant/dist/es/index.js", "../../../../node_modules/.pnpm/@turf+center@6.5.0/node_modules/@turf/center/dist/es/index.js", "../../../../node_modules/.pnpm/@turf+length@6.5.0/node_modules/@turf/length/dist/es/index.js", "../../../../node_modules/.pnpm/@turf+distance@6.5.0/node_modules/@turf/distance/dist/es/index.js", "../../../../node_modules/.pnpm/@turf+line-slice@6.5.0/node_modules/@turf/line-slice/dist/es/index.js", "../../../../node_modules/.pnpm/@turf+nearest-point-on-line@6.5.0/node_modules/@turf/nearest-point-on-line/dist/es/index.js", "../../../../node_modules/.pnpm/@turf+bearing@6.5.0/node_modules/@turf/bearing/dist/es/index.js", "../../../../node_modules/.pnpm/@turf+destination@6.5.0/node_modules/@turf/destination/dist/es/index.js", "../../../../node_modules/.pnpm/@turf+line-intersect@6.5.0/node_modules/@turf/line-intersect/dist/es/index.js", "../../../../node_modules/.pnpm/@turf+line-segment@6.5.0/node_modules/@turf/line-segment/dist/es/index.js", "../../src/map-data-objects/index.ts", "../../src/map-data-objects/node.ts", "../../src/map-data-objects/base-metadata-object.ts", "../../src/map-data-objects/utils.ts", "../../src/map-data-objects/coordinate.ts", "../../src/map-data-objects/area.ts", "../../src/map-data-objects/detailed-map-data.ts", "../../src/map-data-objects/hyperlink.ts", "../../src/utils/randomId.ts", "../../src/map-data-objects/image.ts", "../../src/utils/misc.ts", "../../src/map-data-objects/base-object.ts", "../../src/map-data-objects/door.ts", "../../src/map-data-objects/space.ts", "../../src/map-data-objects/floor.ts", "../../src/map-data-objects/connection.ts", "../../src/utils/index.ts", "../../src/utils/api.ts", "../../src/utils/options.ts", "../../src/constants.ts", "../../src/map-data-objects/object.ts", "../../src/map-data-objects/poi.ts", "../../src/map-data-objects/annotation.ts", "../../src/map-data-objects/floor-stack.ts", "../../src/map-data-objects/facade.ts", "../../src/utils/data-creation.ts", "../../src/map-data-objects/location.ts", "../../src/map-data-objects/category.ts", "../../src/map-data-objects/venue.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-kr-report-deepest-error.4487eaa.0/node_modules/@mappedin/mvf-core/src/utils/locale/index.ts", "../../../../node_modules/.pnpm/@mappedin+mvf-core@3.0.0-kr-report-deepest-error.4487eaa.0/node_modules/@mappedin/mvf-core/src/utils/locale/deep-merge.ts", "../../src/api-geojson/directions.ts", "../../src/api-geojson/directions/index.ts", "../../src/api-geojson/directions/directions.ts", "../../src/api-geojson/utils.ts", "../../src/types.ts", "../../src/api-geojson/directions/directions-internal.ts", "../../../packages/geojson-navigator/index.ts", "../../../packages/geojson-navigator/src/index.ts", "../../../packages/geojson-navigator/src/navigator/index.ts", "../../../packages/geojson-navigator/src/navigator/navigator.ts", "../../../packages/geojson-navigator/src/edge/index.ts", "../../../packages/geojson-navigator/src/edge/edge.ts", "../../../packages/geojson-navigator/src/navigation-graph/index.ts", "../../../packages/geojson-navigator/src/navigation-graph/navigation-graph.ts", "../../../../node_modules/.pnpm/@turf+boolean-point-in-polygon@6.5.0/node_modules/@turf/boolean-point-in-polygon/dist/es/index.js", "../../../packages/geojson-navigator/src/utils/index.ts", "../../../packages/geojson-navigator/src/utils/get-angle.ts", "../../../packages/geojson-navigator/src/utils/has-line-of-sight.ts", "../../../packages/geojson-navigator/src/utils/get-line-intersection.ts", "../../../packages/geojson-navigator/src/utils/get-offset-line.ts", "../../../packages/geojson-navigator/src/utils/rad-to-deg-normalized.ts", "../../../packages/geojson-navigator/src/navigator/utils.ts", "../../src/api-geojson/directions/utils.ts", "../../src/query/index.ts", "../../src/query/external.ts", "../../src/query/cache.ts", "../../../../node_modules/.pnpm/d3-quadtree@3.0.1/node_modules/d3-quadtree/src/index.js", "../../../../node_modules/.pnpm/d3-quadtree@3.0.1/node_modules/d3-quadtree/src/quadtree.js", "../../../../node_modules/.pnpm/d3-quadtree@3.0.1/node_modules/d3-quadtree/src/add.js", "../../../../node_modules/.pnpm/d3-quadtree@3.0.1/node_modules/d3-quadtree/src/cover.js", "../../../../node_modules/.pnpm/d3-quadtree@3.0.1/node_modules/d3-quadtree/src/data.js", "../../../../node_modules/.pnpm/d3-quadtree@3.0.1/node_modules/d3-quadtree/src/extent.js", "../../../../node_modules/.pnpm/d3-quadtree@3.0.1/node_modules/d3-quadtree/src/find.js", "../../../../node_modules/.pnpm/d3-quadtree@3.0.1/node_modules/d3-quadtree/src/quad.js", "../../../../node_modules/.pnpm/d3-quadtree@3.0.1/node_modules/d3-quadtree/src/remove.js", "../../../../node_modules/.pnpm/d3-quadtree@3.0.1/node_modules/d3-quadtree/src/root.js", "../../../../node_modules/.pnpm/d3-quadtree@3.0.1/node_modules/d3-quadtree/src/size.js", "../../../../node_modules/.pnpm/d3-quadtree@3.0.1/node_modules/d3-quadtree/src/visit.js", "../../../../node_modules/.pnpm/d3-quadtree@3.0.1/node_modules/d3-quadtree/src/visitAfter.js", "../../../../node_modules/.pnpm/d3-quadtree@3.0.1/node_modules/d3-quadtree/src/x.js", "../../../../node_modules/.pnpm/d3-quadtree@3.0.1/node_modules/d3-quadtree/src/y.js", "../../src/query/utils.ts", "../../src/map-data-objects/location-profile.ts", "../../src/map-data-objects/opening-hours.ts", "../../src/map-data-objects/location-category.ts", "../../src/map-view.ts", "../../../geojson/src/index.ts", "../../../geojson/src/request-idle-callback-polyfill.js", "../../../geojson/src/renderer.ts", "../../../geojson/src/utils/object-this-polyfill.js", "../../../geojson/src/services/renderer.ts", "../../../geojson/src/services/test-mode.ts", "../../../geojson/src/systems/collisions/system.ts", "inline-worker:/home/jenkins/workspace/dev-relation/WebSDK V6 Alpha - Build with Github Packages/sdks/geojson/src/systems/collisions/worker", "../../../packages/quad-tree/index.ts", "../../../packages/quad-tree/src/index.ts", "../../../packages/quad-tree/src/quad-tree.ts", "../../../packages/quad-tree/src/utils/index.ts", "../../../packages/quad-tree/src/utils/contains.ts", "../../../packages/quad-tree/src/utils/intersectPoint.ts", "../../../packages/quad-tree/src/utils/intersects.ts", "../../../packages/quad-tree/src/utils/appendItems.ts", "../../../packages/quad-tree/src/rectangle.ts", "../../../geojson/src/systems/collisions/utils.ts", "../../../geojson/src/systems/collisions/collider-processor.ts", "../../../geojson/src/systems/collisions/sync-worker.ts", "../../../geojson/src/systems/interactions/index.ts", "../../../geojson/src/systems/interactions/system.ts", "../../../geojson/src/systems/interactions/tap-controller.ts", "../../../geojson/src/systems/interactions/constants.ts", "../../../geojson/src/systems/interactions/utils.ts", "../../../geojson/src/systems/exporter/index.ts", "../../../geojson/src/systems/exporter/exporter.ts", "../../../geojson/src/systems/mesh-creation-and-optimization/system.ts", "../../../geojson/src/geometry/polygons.ts", "../../../geojson/src/geometry/multi-polygon.ts", "../../../geojson/src/geometry/multi-line-string.ts", "../../../geojson/src/components/model.ts", "../../../geojson/src/utils/schema-validation.ts", "../../../geojson/src/systems/draw/utils.ts", "../../../geojson/src/systems/dom-visiblity/system.ts", "../../../geojson/src/systems/2d-projection/system.ts", "../../../geojson/src/systems/2d-draw/system.ts", "../../../packages/shave-text/index.ts", "../../../packages/shave-text/shave-text.ts", "../../../geojson/src/systems/2d-draw/utils.ts", "../../../geojson/src/systems/draw/system.ts", "../../../geojson/src/systems/2d-visibility/system.ts", "../../../geojson/src/systems/render/system.ts", "../../../geojson/src/components/path.ts", "../../../geojson/src/systems/camera/index.ts", "../../../geojson/src/systems/camera/system.ts", "../../../../node_modules/.pnpm/@tweenjs+tween.js@25.0.0/node_modules/@tweenjs/tween.js/dist/tween.esm.js", "../../../geojson/src/systems/camera/helpers/index.ts", "../../../geojson/src/systems/camera/helpers/input-set.ts", "../../../geojson/src/systems/camera/helpers/utils.ts", "../../../geojson/src/systems/camera/helpers/touch-anchor.ts", "../../../geojson/src/systems/camera/constants.ts", "../../../geojson/src/systems/dom-draw/system.ts", "../../../geojson/src/systems/dom-resize/system.ts", "../../../geojson/src/camera.ts", "../../../geojson/src/systems/watermark/system.ts", "../../../geojson/src/systems/watermark/watermark-vertex.glsl", "../../../geojson/src/systems/watermark/watermark-fragment.glsl", "../../../geojson/src/systems/watermark/constants.ts", "../../../geojson/src/systems/watermark/logos.ts", "../../../geojson/src/utils/texture-loader.ts", "../../../geojson/src/systems/pan-bounds/system.ts", "../../../geojson/src/systems/html-controls/system.ts", "../../../geojson/src/components/custom.ts", "../../../geojson/src/systems/custom-geometry/system.ts", "../../../geojson/src/systems/outline-interpolation/system.ts", "../../../geojson/src/systems/outline-interpolation/utils.ts", "../../../geojson/src/systems/mesh-detachment/utils.ts", "../../../geojson/src/systems/outline-interpolation/outline-material.ts", "../../../geojson/src/systems/outline-interpolation/outline-vertex.glsl", "../../../geojson/src/systems/outline-interpolation/outline-fragment.glsl", "../../../geojson/src/utils/idle-queue.ts", "../../../geojson/src/systems/image/system.ts", "../../../geojson/src/components/image.ts", "../../../geojson/src/utils/largest-interior-rectangle.ts", "../../../geojson/src/systems/geometry-in-focus/system.ts", "../../../geojson/src/systems/outdoor-layers/system.ts", "../../../../node_modules/.pnpm/@turf+boolean-intersects@6.5.0/node_modules/@turf/boolean-intersects/dist/es/index.js", "../../../../node_modules/.pnpm/@turf+boolean-disjoint@6.5.0/node_modules/@turf/boolean-disjoint/dist/es/index.js", "../../../../node_modules/.pnpm/@turf+polygon-to-line@6.5.0/node_modules/@turf/polygon-to-line/dist/es/index.js", "../../../geojson/src/systems/path/index.ts", "../../../geojson/src/systems/path/system.ts", "../../../geojson/src/systems/path/utils.ts", "../../../geojson/src/shaders/Path.Vertex.glsl", "../../../geojson/src/shaders/Path.Fragment.glsl", "../../../geojson/src/shaders/Path.Stencil.Fragment.glsl", "../../../geojson/src/systems/mesh-detachment/system.ts", "../../../geojson/src/systems/mesh-modification/system.ts", "../../../geojson/src/systems/mesh-modification/utils.ts", "../../../geojson/src/utils/debug.ts", "../../../geojson/src/systems/2d-occlusion/system.ts", "../../../geojson/src/systems/geometry-disposal/system.ts", "../../../geojson/src/systems/texture/system.ts", "../../../geojson/src/systems/render-order/system.ts", "../../../geojson/src/systems/clipping-plane/system.ts", "../../../geojson/examples/src/utils/scene-graph-visualizer.ts", "../../src/api-geojson/index.ts", "../../src/api-geojson/api.ts", "../../src/map-view-objects/index.ts", "../../src/map-view-objects/label.ts", "../../src/map-view-objects/marker.ts", "../../src/map-view-objects/image3d.ts", "../../src/map-view-objects/model.ts", "../../src/map-view-objects/path.ts", "../../src/map-view-objects/camera-transform.ts", "../../src/map-view-objects/shape.ts", "../../src/map-view-objects/text3d.ts", "../../src/navigation/index.ts", "../../src/navigation/markers.ts", "../../src/navigation/icons.ts", "../../src/navigation/utils.ts", "../../src/api-geojson/camera.ts", "../../src/api-geojson/exporter.ts", "../../src/api-geojson/labels.ts", "../../src/api-geojson/map-object.ts", "../../src/api-geojson/floor-object.ts", "../../src/api-geojson/floor-stack-object.ts", "../../src/api-geojson/multi-floor.ts", "../../src/api-geojson/markers.ts", "../../src/api-geojson/images.ts", "../../src/api-geojson/models.ts", "../../src/api-geojson/paths.ts", "../../src/api-geojson/shapes.ts", "../../src/api-geojson/style.ts", "../../src/api-geojson/outdoor.ts", "../../src/api-geojson/text3d.ts", "../../src/states/index.ts", "../../src/states/doors-state.ts", "../../src/states/state-utils.ts", "../../src/states/facade-state.ts", "../../src/states/floor-state.ts", "../../src/states/geometry-state.ts", "../../src/states/label-state.ts", "../../src/states/marker-state.ts", "../../src/states/path-state.ts", "../../src/states/shape-state.ts", "../../src/states/text3d-state.ts", "../../src/states/walls-state.ts", "../../src/states/image-state.ts", "../../src/states/model-state.ts", "../../src/api-geojson/auto/index.ts", "../../src/api-geojson/auto/geometries.ts", "../../src/api-geojson/auto/labels.ts", "../../src/api-geojson/icons.ts", "../../../../node_modules/.pnpm/dompurify@3.2.6/node_modules/dompurify/src/utils.ts", "../../../../node_modules/.pnpm/dompurify@3.2.6/node_modules/dompurify/src/tags.ts", "../../../../node_modules/.pnpm/dompurify@3.2.6/node_modules/dompurify/src/attrs.ts", "../../../../node_modules/.pnpm/dompurify@3.2.6/node_modules/dompurify/src/regexp.ts", "../../../../node_modules/.pnpm/dompurify@3.2.6/node_modules/dompurify/src/purify.ts", "../../src/api-geojson/auto/utils.ts", "../../src/debug.ts", "../../src/api-geojson/schemas.ts", "../../src/utils/animation.ts", "../../../packages/mvf-utils/tokens/token-manager.ts", "../../src/hydrate-map-data.ts", "../../src/utils/inject-css.ts", "raw:./styles/navigation.scss?raw", "raw:../../geojson/src/styles/marker.scss?raw", "raw:../../geojson/src/styles/collisions.scss?raw", "raw:../../geojson/src/styles/interactions.scss?raw", "raw:../../geojson/src/styles/html-controls.scss?raw", "raw:../../packages/outdoor-context-v5/css/maplibre-gl.css?raw", "../../src/api-geojson/language.ts"],
  "sourcesContent": ["(function (global, factory) {\ntypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\ntypeof define === 'function' && define.amd ? define(factory) :\n(global = global || self, global.TinyQueue = factory());\n}(this, function () { 'use strict';\n\nvar TinyQueue = function TinyQueue(data, compare) {\n    if ( data === void 0 ) data = [];\n    if ( compare === void 0 ) compare = defaultCompare;\n\n    this.data = data;\n    this.length = this.data.length;\n    this.compare = compare;\n\n    if (this.length > 0) {\n        for (var i = (this.length >> 1) - 1; i >= 0; i--) { this._down(i); }\n    }\n};\n\nTinyQueue.prototype.push = function push (item) {\n    this.data.push(item);\n    this.length++;\n    this._up(this.length - 1);\n};\n\nTinyQueue.prototype.pop = function pop () {\n    if (this.length === 0) { return undefined; }\n\n    var top = this.data[0];\n    var bottom = this.data.pop();\n    this.length--;\n\n    if (this.length > 0) {\n        this.data[0] = bottom;\n        this._down(0);\n    }\n\n    return top;\n};\n\nTinyQueue.prototype.peek = function peek () {\n    return this.data[0];\n};\n\nTinyQueue.prototype._up = function _up (pos) {\n    var ref = this;\n        var data = ref.data;\n        var compare = ref.compare;\n    var item = data[pos];\n\n    while (pos > 0) {\n        var parent = (pos - 1) >> 1;\n        var current = data[parent];\n        if (compare(item, current) >= 0) { break; }\n        data[pos] = current;\n        pos = parent;\n    }\n\n    data[pos] = item;\n};\n\nTinyQueue.prototype._down = function _down (pos) {\n    var ref = this;\n        var data = ref.data;\n        var compare = ref.compare;\n    var halfLength = this.length >> 1;\n    var item = data[pos];\n\n    while (pos < halfLength) {\n        var left = (pos << 1) + 1;\n        var best = data[left];\n        var right = left + 1;\n\n        if (right < this.length && compare(data[right], best) < 0) {\n            left = right;\n            best = data[right];\n        }\n        if (compare(best, item) >= 0) { break; }\n\n        data[pos] = best;\n        pos = left;\n    }\n\n    data[pos] = item;\n};\n\nfunction defaultCompare(a, b) {\n    return a < b ? -1 : a > b ? 1 : 0;\n}\n\nreturn TinyQueue;\n\n}));\n", "'use strict';\n\nvar Queue = require('tinyqueue');\n\nif (Queue.default) Queue = Queue.default; // temporary webpack fix\n\nmodule.exports = polylabel;\nmodule.exports.default = polylabel;\n\nfunction polylabel(polygon, precision, debug) {\n    precision = precision || 1.0;\n\n    // find the bounding box of the outer ring\n    var minX, minY, maxX, maxY;\n    for (var i = 0; i < polygon[0].length; i++) {\n        var p = polygon[0][i];\n        if (!i || p[0] < minX) minX = p[0];\n        if (!i || p[1] < minY) minY = p[1];\n        if (!i || p[0] > maxX) maxX = p[0];\n        if (!i || p[1] > maxY) maxY = p[1];\n    }\n\n    var width = maxX - minX;\n    var height = maxY - minY;\n    var cellSize = Math.min(width, height);\n    var h = cellSize / 2;\n\n    if (cellSize === 0) {\n        var degeneratePoleOfInaccessibility = [minX, minY];\n        degeneratePoleOfInaccessibility.distance = 0;\n        return degeneratePoleOfInaccessibility;\n    }\n\n    // a priority queue of cells in order of their \"potential\" (max distance to polygon)\n    var cellQueue = new Queue(undefined, compareMax);\n\n    // cover polygon with initial cells\n    for (var x = minX; x < maxX; x += cellSize) {\n        for (var y = minY; y < maxY; y += cellSize) {\n            cellQueue.push(new Cell(x + h, y + h, h, polygon));\n        }\n    }\n\n    // take centroid as the first best guess\n    var bestCell = getCentroidCell(polygon);\n\n    // special case for rectangular polygons\n    var bboxCell = new Cell(minX + width / 2, minY + height / 2, 0, polygon);\n    if (bboxCell.d > bestCell.d) bestCell = bboxCell;\n\n    var numProbes = cellQueue.length;\n\n    while (cellQueue.length) {\n        // pick the most promising cell from the queue\n        var cell = cellQueue.pop();\n\n        // update the best cell if we found a better one\n        if (cell.d > bestCell.d) {\n            bestCell = cell;\n            if (debug) console.log('found best %d after %d probes', Math.round(1e4 * cell.d) / 1e4, numProbes);\n        }\n\n        // do not drill down further if there's no chance of a better solution\n        if (cell.max - bestCell.d <= precision) continue;\n\n        // split the cell into four cells\n        h = cell.h / 2;\n        cellQueue.push(new Cell(cell.x - h, cell.y - h, h, polygon));\n        cellQueue.push(new Cell(cell.x + h, cell.y - h, h, polygon));\n        cellQueue.push(new Cell(cell.x - h, cell.y + h, h, polygon));\n        cellQueue.push(new Cell(cell.x + h, cell.y + h, h, polygon));\n        numProbes += 4;\n    }\n\n    if (debug) {\n        console.log('num probes: ' + numProbes);\n        console.log('best distance: ' + bestCell.d);\n    }\n\n    var poleOfInaccessibility = [bestCell.x, bestCell.y];\n    poleOfInaccessibility.distance = bestCell.d;\n    return poleOfInaccessibility;\n}\n\nfunction compareMax(a, b) {\n    return b.max - a.max;\n}\n\nfunction Cell(x, y, h, polygon) {\n    this.x = x; // cell center x\n    this.y = y; // cell center y\n    this.h = h; // half the cell size\n    this.d = pointToPolygonDist(x, y, polygon); // distance from cell center to polygon\n    this.max = this.d + this.h * Math.SQRT2; // max distance to polygon within a cell\n}\n\n// signed distance from point to polygon outline (negative if point is outside)\nfunction pointToPolygonDist(x, y, polygon) {\n    var inside = false;\n    var minDistSq = Infinity;\n\n    for (var k = 0; k < polygon.length; k++) {\n        var ring = polygon[k];\n\n        for (var i = 0, len = ring.length, j = len - 1; i < len; j = i++) {\n            var a = ring[i];\n            var b = ring[j];\n\n            if ((a[1] > y !== b[1] > y) &&\n                (x < (b[0] - a[0]) * (y - a[1]) / (b[1] - a[1]) + a[0])) inside = !inside;\n\n            minDistSq = Math.min(minDistSq, getSegDistSq(x, y, a, b));\n        }\n    }\n\n    return minDistSq === 0 ? 0 : (inside ? 1 : -1) * Math.sqrt(minDistSq);\n}\n\n// get polygon centroid\nfunction getCentroidCell(polygon) {\n    var area = 0;\n    var x = 0;\n    var y = 0;\n    var points = polygon[0];\n\n    for (var i = 0, len = points.length, j = len - 1; i < len; j = i++) {\n        var a = points[i];\n        var b = points[j];\n        var f = a[0] * b[1] - b[0] * a[1];\n        x += (a[0] + b[0]) * f;\n        y += (a[1] + b[1]) * f;\n        area += f * 3;\n    }\n    if (area === 0) return new Cell(points[0][0], points[0][1], 0, polygon);\n    return new Cell(x / area, y / area, 0, polygon);\n}\n\n// get squared distance from a point to a segment\nfunction getSegDistSq(px, py, a, b) {\n\n    var x = a[0];\n    var y = a[1];\n    var dx = b[0] - x;\n    var dy = b[1] - y;\n\n    if (dx !== 0 || dy !== 0) {\n\n        var t = ((px - x) * dx + (py - y) * dy) / (dx * dx + dy * dy);\n\n        if (t > 1) {\n            x = b[0];\n            y = b[1];\n\n        } else if (t > 0) {\n            x += dx * t;\n            y += dy * t;\n        }\n    }\n\n    dx = px - x;\n    dy = py - y;\n\n    return dx * dx + dy * dy;\n}\n", "!function(t,i){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=i():\"function\"==typeof define&&define.amd?define(i):(t=t||self).RBush=i()}(this,function(){\"use strict\";function t(t,r,e,a,h){!function t(n,r,e,a,h){for(;a>e;){if(a-e>600){var o=a-e+1,s=r-e+1,l=Math.log(o),f=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*f*(o-f)/o)*(s-o/2<0?-1:1),m=Math.max(e,Math.floor(r-s*f/o+u)),c=Math.min(a,Math.floor(r+(o-s)*f/o+u));t(n,r,m,c,h)}var p=n[r],d=e,x=a;for(i(n,e,r),h(n[a],p)>0&&i(n,e,a);d<x;){for(i(n,d,x),d++,x--;h(n[d],p)<0;)d++;for(;h(n[x],p)>0;)x--}0===h(n[e],p)?i(n,e,x):i(n,++x,a),x<=r&&(e=x+1),r<=x&&(a=x-1)}}(t,r,e||0,a||t.length-1,h||n)}function i(t,i,n){var r=t[i];t[i]=t[n],t[n]=r}function n(t,i){return t<i?-1:t>i?1:0}var r=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function e(t,i,n){if(!n)return i.indexOf(t);for(var r=0;r<i.length;r++)if(n(t,i[r]))return r;return-1}function a(t,i){h(t,0,t.children.length,i,t)}function h(t,i,n,r,e){e||(e=p(null)),e.minX=1/0,e.minY=1/0,e.maxX=-1/0,e.maxY=-1/0;for(var a=i;a<n;a++){var h=t.children[a];o(e,t.leaf?r(h):h)}return e}function o(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function s(t,i){return t.minX-i.minX}function l(t,i){return t.minY-i.minY}function f(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function u(t){return t.maxX-t.minX+(t.maxY-t.minY)}function m(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function c(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function d(i,n,r,e,a){for(var h=[n,r];h.length;)if(!((r=h.pop())-(n=h.pop())<=e)){var o=n+Math.ceil((r-n)/e/2)*e;t(i,o,n,r,a),h.push(n,o,o,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(t){var i=this.data,n=[];if(!c(t,i))return n;for(var r=this.toBBox,e=[];i;){for(var a=0;a<i.children.length;a++){var h=i.children[a],o=i.leaf?r(h):h;c(t,o)&&(i.leaf?n.push(h):m(t,o)?this._all(h,n):e.push(h))}i=e.pop()}return n},r.prototype.collides=function(t){var i=this.data;if(!c(t,i))return!1;for(var n=[];i;){for(var r=0;r<i.children.length;r++){var e=i.children[r],a=i.leaf?this.toBBox(e):e;if(c(t,a)){if(i.leaf||m(t,a))return!0;n.push(e)}}i=n.pop()}return!1},r.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0;i<t.length;i++)this.insert(t[i]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},r.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},r.prototype.clear=function(){return this.data=p([]),this},r.prototype.remove=function(t,i){if(!t)return this;for(var n,r,a,h=this.data,o=this.toBBox(t),s=[],l=[];h||s.length;){if(h||(h=s.pop(),r=s[s.length-1],n=l.pop(),a=!0),h.leaf){var f=e(t,h.children,i);if(-1!==f)return h.children.splice(f,1),s.push(h),this._condense(s),this}a||h.leaf||!m(h,o)?r?(n++,h=r.children[n],a=!1):h=null:(s.push(h),l.push(n),n=0,r=h,h=h.children[0])}return this},r.prototype.toBBox=function(t){return t},r.prototype.compareMinX=function(t,i){return t.minX-i.minX},r.prototype.compareMinY=function(t,i){return t.minY-i.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(t){return this.data=t,this},r.prototype._all=function(t,i){for(var n=[];t;)t.leaf?i.push.apply(i,t.children):n.push.apply(n,t.children),t=n.pop();return i},r.prototype._build=function(t,i,n,r){var e,h=n-i+1,o=this._maxEntries;if(h<=o)return a(e=p(t.slice(i,n+1)),this.toBBox),e;r||(r=Math.ceil(Math.log(h)/Math.log(o)),o=Math.ceil(h/Math.pow(o,r-1))),(e=p([])).leaf=!1,e.height=r;var s=Math.ceil(h/o),l=s*Math.ceil(Math.sqrt(o));d(t,i,n,l,this.compareMinX);for(var f=i;f<=n;f+=l){var u=Math.min(f+l-1,n);d(t,f,u,s,this.compareMinY);for(var m=f;m<=u;m+=s){var c=Math.min(m+s-1,u);e.children.push(this._build(t,m,c,r-1))}}return a(e,this.toBBox),e},r.prototype._chooseSubtree=function(t,i,n,r){for(;r.push(i),!i.leaf&&r.length-1!==n;){for(var e=1/0,a=1/0,h=void 0,o=0;o<i.children.length;o++){var s=i.children[o],l=f(s),u=(m=t,c=s,(Math.max(c.maxX,m.maxX)-Math.min(c.minX,m.minX))*(Math.max(c.maxY,m.maxY)-Math.min(c.minY,m.minY))-l);u<a?(a=u,e=l<e?l:e,h=s):u===a&&l<e&&(e=l,h=s)}i=h||i.children[0]}var m,c;return i},r.prototype._insert=function(t,i,n){var r=n?t:this.toBBox(t),e=[],a=this._chooseSubtree(r,this.data,i,e);for(a.children.push(t),o(a,r);i>=0&&e[i].children.length>this._maxEntries;)this._split(e,i),i--;this._adjustParentBBoxes(r,e,i)},r.prototype._split=function(t,i){var n=t[i],r=n.children.length,e=this._minEntries;this._chooseSplitAxis(n,e,r);var h=this._chooseSplitIndex(n,e,r),o=p(n.children.splice(h,n.children.length-h));o.height=n.height,o.leaf=n.leaf,a(n,this.toBBox),a(o,this.toBBox),i?t[i-1].children.push(o):this._splitRoot(n,o)},r.prototype._splitRoot=function(t,i){this.data=p([t,i]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(t,i,n){for(var r,e,a,o,s,l,u,m=1/0,c=1/0,p=i;p<=n-i;p++){var d=h(t,0,p,this.toBBox),x=h(t,p,n,this.toBBox),v=(e=d,a=x,o=void 0,s=void 0,l=void 0,u=void 0,o=Math.max(e.minX,a.minX),s=Math.max(e.minY,a.minY),l=Math.min(e.maxX,a.maxX),u=Math.min(e.maxY,a.maxY),Math.max(0,l-o)*Math.max(0,u-s)),M=f(d)+f(x);v<m?(m=v,r=p,c=M<c?M:c):v===m&&M<c&&(c=M,r=p)}return r||n-i},r.prototype._chooseSplitAxis=function(t,i,n){var r=t.leaf?this.compareMinX:s,e=t.leaf?this.compareMinY:l;this._allDistMargin(t,i,n,r)<this._allDistMargin(t,i,n,e)&&t.children.sort(r)},r.prototype._allDistMargin=function(t,i,n,r){t.children.sort(r);for(var e=this.toBBox,a=h(t,0,i,e),s=h(t,n-i,n,e),l=u(a)+u(s),f=i;f<n-i;f++){var m=t.children[f];o(a,t.leaf?e(m):m),l+=u(a)}for(var c=n-i-1;c>=i;c--){var p=t.children[c];o(s,t.leaf?e(p):p),l+=u(s)}return l},r.prototype._adjustParentBBoxes=function(t,i,n){for(var r=n;r>=0;r--)o(i[r],t)},r.prototype._condense=function(t){for(var i=t.length-1,n=void 0;i>=0;i--)0===t[i].children.length?i>0?(n=t[i-1].children).splice(n.indexOf(t[i]),1):this.clear():a(t[i],this.toBBox)},r});\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * @module helpers\n */\n/**\n * Earth Radius used with the Harvesine formula and approximates using a spherical (non-ellipsoid) Earth.\n *\n * @memberof helpers\n * @type {number}\n */\nexports.earthRadius = 6371008.8;\n/**\n * Unit of measurement factors using a spherical (non-ellipsoid) earth radius.\n *\n * @memberof helpers\n * @type {Object}\n */\nexports.factors = {\n    centimeters: exports.earthRadius * 100,\n    centimetres: exports.earthRadius * 100,\n    degrees: exports.earthRadius / 111325,\n    feet: exports.earthRadius * 3.28084,\n    inches: exports.earthRadius * 39.37,\n    kilometers: exports.earthRadius / 1000,\n    kilometres: exports.earthRadius / 1000,\n    meters: exports.earthRadius,\n    metres: exports.earthRadius,\n    miles: exports.earthRadius / 1609.344,\n    millimeters: exports.earthRadius * 1000,\n    millimetres: exports.earthRadius * 1000,\n    nauticalmiles: exports.earthRadius / 1852,\n    radians: 1,\n    yards: exports.earthRadius * 1.0936,\n};\n/**\n * Units of measurement factors based on 1 meter.\n *\n * @memberof helpers\n * @type {Object}\n */\nexports.unitsFactors = {\n    centimeters: 100,\n    centimetres: 100,\n    degrees: 1 / 111325,\n    feet: 3.28084,\n    inches: 39.37,\n    kilometers: 1 / 1000,\n    kilometres: 1 / 1000,\n    meters: 1,\n    metres: 1,\n    miles: 1 / 1609.344,\n    millimeters: 1000,\n    millimetres: 1000,\n    nauticalmiles: 1 / 1852,\n    radians: 1 / exports.earthRadius,\n    yards: 1.0936133,\n};\n/**\n * Area of measurement factors based on 1 square meter.\n *\n * @memberof helpers\n * @type {Object}\n */\nexports.areaFactors = {\n    acres: 0.000247105,\n    centimeters: 10000,\n    centimetres: 10000,\n    feet: 10.763910417,\n    hectares: 0.0001,\n    inches: 1550.003100006,\n    kilometers: 0.000001,\n    kilometres: 0.000001,\n    meters: 1,\n    metres: 1,\n    miles: 3.86e-7,\n    millimeters: 1000000,\n    millimetres: 1000000,\n    yards: 1.195990046,\n};\n/**\n * Wraps a GeoJSON {@link Geometry} in a GeoJSON {@link Feature}.\n *\n * @name feature\n * @param {Geometry} geometry input geometry\n * @param {Object} [properties={}] an Object of key-value pairs to add as properties\n * @param {Object} [options={}] Optional Parameters\n * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature\n * @param {string|number} [options.id] Identifier associated with the Feature\n * @returns {Feature} a GeoJSON Feature\n * @example\n * var geometry = {\n *   \"type\": \"Point\",\n *   \"coordinates\": [110, 50]\n * };\n *\n * var feature = turf.feature(geometry);\n *\n * //=feature\n */\nfunction feature(geom, properties, options) {\n    if (options === void 0) { options = {}; }\n    var feat = { type: \"Feature\" };\n    if (options.id === 0 || options.id) {\n        feat.id = options.id;\n    }\n    if (options.bbox) {\n        feat.bbox = options.bbox;\n    }\n    feat.properties = properties || {};\n    feat.geometry = geom;\n    return feat;\n}\nexports.feature = feature;\n/**\n * Creates a GeoJSON {@link Geometry} from a Geometry string type & coordinates.\n * For GeometryCollection type use `helpers.geometryCollection`\n *\n * @name geometry\n * @param {string} type Geometry Type\n * @param {Array<any>} coordinates Coordinates\n * @param {Object} [options={}] Optional Parameters\n * @returns {Geometry} a GeoJSON Geometry\n * @example\n * var type = \"Point\";\n * var coordinates = [110, 50];\n * var geometry = turf.geometry(type, coordinates);\n * // => geometry\n */\nfunction geometry(type, coordinates, _options) {\n    if (_options === void 0) { _options = {}; }\n    switch (type) {\n        case \"Point\":\n            return point(coordinates).geometry;\n        case \"LineString\":\n            return lineString(coordinates).geometry;\n        case \"Polygon\":\n            return polygon(coordinates).geometry;\n        case \"MultiPoint\":\n            return multiPoint(coordinates).geometry;\n        case \"MultiLineString\":\n            return multiLineString(coordinates).geometry;\n        case \"MultiPolygon\":\n            return multiPolygon(coordinates).geometry;\n        default:\n            throw new Error(type + \" is invalid\");\n    }\n}\nexports.geometry = geometry;\n/**\n * Creates a {@link Point} {@link Feature} from a Position.\n *\n * @name point\n * @param {Array<number>} coordinates longitude, latitude position (each in decimal degrees)\n * @param {Object} [properties={}] an Object of key-value pairs to add as properties\n * @param {Object} [options={}] Optional Parameters\n * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature\n * @param {string|number} [options.id] Identifier associated with the Feature\n * @returns {Feature<Point>} a Point feature\n * @example\n * var point = turf.point([-75.343, 39.984]);\n *\n * //=point\n */\nfunction point(coordinates, properties, options) {\n    if (options === void 0) { options = {}; }\n    if (!coordinates) {\n        throw new Error(\"coordinates is required\");\n    }\n    if (!Array.isArray(coordinates)) {\n        throw new Error(\"coordinates must be an Array\");\n    }\n    if (coordinates.length < 2) {\n        throw new Error(\"coordinates must be at least 2 numbers long\");\n    }\n    if (!isNumber(coordinates[0]) || !isNumber(coordinates[1])) {\n        throw new Error(\"coordinates must contain numbers\");\n    }\n    var geom = {\n        type: \"Point\",\n        coordinates: coordinates,\n    };\n    return feature(geom, properties, options);\n}\nexports.point = point;\n/**\n * Creates a {@link Point} {@link FeatureCollection} from an Array of Point coordinates.\n *\n * @name points\n * @param {Array<Array<number>>} coordinates an array of Points\n * @param {Object} [properties={}] Translate these properties to each Feature\n * @param {Object} [options={}] Optional Parameters\n * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north]\n * associated with the FeatureCollection\n * @param {string|number} [options.id] Identifier associated with the FeatureCollection\n * @returns {FeatureCollection<Point>} Point Feature\n * @example\n * var points = turf.points([\n *   [-75, 39],\n *   [-80, 45],\n *   [-78, 50]\n * ]);\n *\n * //=points\n */\nfunction points(coordinates, properties, options) {\n    if (options === void 0) { options = {}; }\n    return featureCollection(coordinates.map(function (coords) {\n        return point(coords, properties);\n    }), options);\n}\nexports.points = points;\n/**\n * Creates a {@link Polygon} {@link Feature} from an Array of LinearRings.\n *\n * @name polygon\n * @param {Array<Array<Array<number>>>} coordinates an array of LinearRings\n * @param {Object} [properties={}] an Object of key-value pairs to add as properties\n * @param {Object} [options={}] Optional Parameters\n * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature\n * @param {string|number} [options.id] Identifier associated with the Feature\n * @returns {Feature<Polygon>} Polygon Feature\n * @example\n * var polygon = turf.polygon([[[-5, 52], [-4, 56], [-2, 51], [-7, 54], [-5, 52]]], { name: 'poly1' });\n *\n * //=polygon\n */\nfunction polygon(coordinates, properties, options) {\n    if (options === void 0) { options = {}; }\n    for (var _i = 0, coordinates_1 = coordinates; _i < coordinates_1.length; _i++) {\n        var ring = coordinates_1[_i];\n        if (ring.length < 4) {\n            throw new Error(\"Each LinearRing of a Polygon must have 4 or more Positions.\");\n        }\n        for (var j = 0; j < ring[ring.length - 1].length; j++) {\n            // Check if first point of Polygon contains two numbers\n            if (ring[ring.length - 1][j] !== ring[0][j]) {\n                throw new Error(\"First and last Position are not equivalent.\");\n            }\n        }\n    }\n    var geom = {\n        type: \"Polygon\",\n        coordinates: coordinates,\n    };\n    return feature(geom, properties, options);\n}\nexports.polygon = polygon;\n/**\n * Creates a {@link Polygon} {@link FeatureCollection} from an Array of Polygon coordinates.\n *\n * @name polygons\n * @param {Array<Array<Array<Array<number>>>>} coordinates an array of Polygon coordinates\n * @param {Object} [properties={}] an Object of key-value pairs to add as properties\n * @param {Object} [options={}] Optional Parameters\n * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature\n * @param {string|number} [options.id] Identifier associated with the FeatureCollection\n * @returns {FeatureCollection<Polygon>} Polygon FeatureCollection\n * @example\n * var polygons = turf.polygons([\n *   [[[-5, 52], [-4, 56], [-2, 51], [-7, 54], [-5, 52]]],\n *   [[[-15, 42], [-14, 46], [-12, 41], [-17, 44], [-15, 42]]],\n * ]);\n *\n * //=polygons\n */\nfunction polygons(coordinates, properties, options) {\n    if (options === void 0) { options = {}; }\n    return featureCollection(coordinates.map(function (coords) {\n        return polygon(coords, properties);\n    }), options);\n}\nexports.polygons = polygons;\n/**\n * Creates a {@link LineString} {@link Feature} from an Array of Positions.\n *\n * @name lineString\n * @param {Array<Array<number>>} coordinates an array of Positions\n * @param {Object} [properties={}] an Object of key-value pairs to add as properties\n * @param {Object} [options={}] Optional Parameters\n * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature\n * @param {string|number} [options.id] Identifier associated with the Feature\n * @returns {Feature<LineString>} LineString Feature\n * @example\n * var linestring1 = turf.lineString([[-24, 63], [-23, 60], [-25, 65], [-20, 69]], {name: 'line 1'});\n * var linestring2 = turf.lineString([[-14, 43], [-13, 40], [-15, 45], [-10, 49]], {name: 'line 2'});\n *\n * //=linestring1\n * //=linestring2\n */\nfunction lineString(coordinates, properties, options) {\n    if (options === void 0) { options = {}; }\n    if (coordinates.length < 2) {\n        throw new Error(\"coordinates must be an array of two or more positions\");\n    }\n    var geom = {\n        type: \"LineString\",\n        coordinates: coordinates,\n    };\n    return feature(geom, properties, options);\n}\nexports.lineString = lineString;\n/**\n * Creates a {@link LineString} {@link FeatureCollection} from an Array of LineString coordinates.\n *\n * @name lineStrings\n * @param {Array<Array<Array<number>>>} coordinates an array of LinearRings\n * @param {Object} [properties={}] an Object of key-value pairs to add as properties\n * @param {Object} [options={}] Optional Parameters\n * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north]\n * associated with the FeatureCollection\n * @param {string|number} [options.id] Identifier associated with the FeatureCollection\n * @returns {FeatureCollection<LineString>} LineString FeatureCollection\n * @example\n * var linestrings = turf.lineStrings([\n *   [[-24, 63], [-23, 60], [-25, 65], [-20, 69]],\n *   [[-14, 43], [-13, 40], [-15, 45], [-10, 49]]\n * ]);\n *\n * //=linestrings\n */\nfunction lineStrings(coordinates, properties, options) {\n    if (options === void 0) { options = {}; }\n    return featureCollection(coordinates.map(function (coords) {\n        return lineString(coords, properties);\n    }), options);\n}\nexports.lineStrings = lineStrings;\n/**\n * Takes one or more {@link Feature|Features} and creates a {@link FeatureCollection}.\n *\n * @name featureCollection\n * @param {Feature[]} features input features\n * @param {Object} [options={}] Optional Parameters\n * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature\n * @param {string|number} [options.id] Identifier associated with the Feature\n * @returns {FeatureCollection} FeatureCollection of Features\n * @example\n * var locationA = turf.point([-75.343, 39.984], {name: 'Location A'});\n * var locationB = turf.point([-75.833, 39.284], {name: 'Location B'});\n * var locationC = turf.point([-75.534, 39.123], {name: 'Location C'});\n *\n * var collection = turf.featureCollection([\n *   locationA,\n *   locationB,\n *   locationC\n * ]);\n *\n * //=collection\n */\nfunction featureCollection(features, options) {\n    if (options === void 0) { options = {}; }\n    var fc = { type: \"FeatureCollection\" };\n    if (options.id) {\n        fc.id = options.id;\n    }\n    if (options.bbox) {\n        fc.bbox = options.bbox;\n    }\n    fc.features = features;\n    return fc;\n}\nexports.featureCollection = featureCollection;\n/**\n * Creates a {@link Feature<MultiLineString>} based on a\n * coordinate array. Properties can be added optionally.\n *\n * @name multiLineString\n * @param {Array<Array<Array<number>>>} coordinates an array of LineStrings\n * @param {Object} [properties={}] an Object of key-value pairs to add as properties\n * @param {Object} [options={}] Optional Parameters\n * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature\n * @param {string|number} [options.id] Identifier associated with the Feature\n * @returns {Feature<MultiLineString>} a MultiLineString feature\n * @throws {Error} if no coordinates are passed\n * @example\n * var multiLine = turf.multiLineString([[[0,0],[10,10]]]);\n *\n * //=multiLine\n */\nfunction multiLineString(coordinates, properties, options) {\n    if (options === void 0) { options = {}; }\n    var geom = {\n        type: \"MultiLineString\",\n        coordinates: coordinates,\n    };\n    return feature(geom, properties, options);\n}\nexports.multiLineString = multiLineString;\n/**\n * Creates a {@link Feature<MultiPoint>} based on a\n * coordinate array. Properties can be added optionally.\n *\n * @name multiPoint\n * @param {Array<Array<number>>} coordinates an array of Positions\n * @param {Object} [properties={}] an Object of key-value pairs to add as properties\n * @param {Object} [options={}] Optional Parameters\n * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature\n * @param {string|number} [options.id] Identifier associated with the Feature\n * @returns {Feature<MultiPoint>} a MultiPoint feature\n * @throws {Error} if no coordinates are passed\n * @example\n * var multiPt = turf.multiPoint([[0,0],[10,10]]);\n *\n * //=multiPt\n */\nfunction multiPoint(coordinates, properties, options) {\n    if (options === void 0) { options = {}; }\n    var geom = {\n        type: \"MultiPoint\",\n        coordinates: coordinates,\n    };\n    return feature(geom, properties, options);\n}\nexports.multiPoint = multiPoint;\n/**\n * Creates a {@link Feature<MultiPolygon>} based on a\n * coordinate array. Properties can be added optionally.\n *\n * @name multiPolygon\n * @param {Array<Array<Array<Array<number>>>>} coordinates an array of Polygons\n * @param {Object} [properties={}] an Object of key-value pairs to add as properties\n * @param {Object} [options={}] Optional Parameters\n * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature\n * @param {string|number} [options.id] Identifier associated with the Feature\n * @returns {Feature<MultiPolygon>} a multipolygon feature\n * @throws {Error} if no coordinates are passed\n * @example\n * var multiPoly = turf.multiPolygon([[[[0,0],[0,10],[10,10],[10,0],[0,0]]]]);\n *\n * //=multiPoly\n *\n */\nfunction multiPolygon(coordinates, properties, options) {\n    if (options === void 0) { options = {}; }\n    var geom = {\n        type: \"MultiPolygon\",\n        coordinates: coordinates,\n    };\n    return feature(geom, properties, options);\n}\nexports.multiPolygon = multiPolygon;\n/**\n * Creates a {@link Feature<GeometryCollection>} based on a\n * coordinate array. Properties can be added optionally.\n *\n * @name geometryCollection\n * @param {Array<Geometry>} geometries an array of GeoJSON Geometries\n * @param {Object} [properties={}] an Object of key-value pairs to add as properties\n * @param {Object} [options={}] Optional Parameters\n * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature\n * @param {string|number} [options.id] Identifier associated with the Feature\n * @returns {Feature<GeometryCollection>} a GeoJSON GeometryCollection Feature\n * @example\n * var pt = turf.geometry(\"Point\", [100, 0]);\n * var line = turf.geometry(\"LineString\", [[101, 0], [102, 1]]);\n * var collection = turf.geometryCollection([pt, line]);\n *\n * // => collection\n */\nfunction geometryCollection(geometries, properties, options) {\n    if (options === void 0) { options = {}; }\n    var geom = {\n        type: \"GeometryCollection\",\n        geometries: geometries,\n    };\n    return feature(geom, properties, options);\n}\nexports.geometryCollection = geometryCollection;\n/**\n * Round number to precision\n *\n * @param {number} num Number\n * @param {number} [precision=0] Precision\n * @returns {number} rounded number\n * @example\n * turf.round(120.4321)\n * //=120\n *\n * turf.round(120.4321, 2)\n * //=120.43\n */\nfunction round(num, precision) {\n    if (precision === void 0) { precision = 0; }\n    if (precision && !(precision >= 0)) {\n        throw new Error(\"precision must be a positive number\");\n    }\n    var multiplier = Math.pow(10, precision || 0);\n    return Math.round(num * multiplier) / multiplier;\n}\nexports.round = round;\n/**\n * Convert a distance measurement (assuming a spherical Earth) from radians to a more friendly unit.\n * Valid units: miles, nauticalmiles, inches, yards, meters, metres, kilometers, centimeters, feet\n *\n * @name radiansToLength\n * @param {number} radians in radians across the sphere\n * @param {string} [units=\"kilometers\"] can be degrees, radians, miles, inches, yards, metres,\n * meters, kilometres, kilometers.\n * @returns {number} distance\n */\nfunction radiansToLength(radians, units) {\n    if (units === void 0) { units = \"kilometers\"; }\n    var factor = exports.factors[units];\n    if (!factor) {\n        throw new Error(units + \" units is invalid\");\n    }\n    return radians * factor;\n}\nexports.radiansToLength = radiansToLength;\n/**\n * Convert a distance measurement (assuming a spherical Earth) from a real-world unit into radians\n * Valid units: miles, nauticalmiles, inches, yards, meters, metres, kilometers, centimeters, feet\n *\n * @name lengthToRadians\n * @param {number} distance in real units\n * @param {string} [units=\"kilometers\"] can be degrees, radians, miles, inches, yards, metres,\n * meters, kilometres, kilometers.\n * @returns {number} radians\n */\nfunction lengthToRadians(distance, units) {\n    if (units === void 0) { units = \"kilometers\"; }\n    var factor = exports.factors[units];\n    if (!factor) {\n        throw new Error(units + \" units is invalid\");\n    }\n    return distance / factor;\n}\nexports.lengthToRadians = lengthToRadians;\n/**\n * Convert a distance measurement (assuming a spherical Earth) from a real-world unit into degrees\n * Valid units: miles, nauticalmiles, inches, yards, meters, metres, centimeters, kilometres, feet\n *\n * @name lengthToDegrees\n * @param {number} distance in real units\n * @param {string} [units=\"kilometers\"] can be degrees, radians, miles, inches, yards, metres,\n * meters, kilometres, kilometers.\n * @returns {number} degrees\n */\nfunction lengthToDegrees(distance, units) {\n    return radiansToDegrees(lengthToRadians(distance, units));\n}\nexports.lengthToDegrees = lengthToDegrees;\n/**\n * Converts any bearing angle from the north line direction (positive clockwise)\n * and returns an angle between 0-360 degrees (positive clockwise), 0 being the north line\n *\n * @name bearingToAzimuth\n * @param {number} bearing angle, between -180 and +180 degrees\n * @returns {number} angle between 0 and 360 degrees\n */\nfunction bearingToAzimuth(bearing) {\n    var angle = bearing % 360;\n    if (angle < 0) {\n        angle += 360;\n    }\n    return angle;\n}\nexports.bearingToAzimuth = bearingToAzimuth;\n/**\n * Converts an angle in radians to degrees\n *\n * @name radiansToDegrees\n * @param {number} radians angle in radians\n * @returns {number} degrees between 0 and 360 degrees\n */\nfunction radiansToDegrees(radians) {\n    var degrees = radians % (2 * Math.PI);\n    return (degrees * 180) / Math.PI;\n}\nexports.radiansToDegrees = radiansToDegrees;\n/**\n * Converts an angle in degrees to radians\n *\n * @name degreesToRadians\n * @param {number} degrees angle between 0 and 360 degrees\n * @returns {number} angle in radians\n */\nfunction degreesToRadians(degrees) {\n    var radians = degrees % 360;\n    return (radians * Math.PI) / 180;\n}\nexports.degreesToRadians = degreesToRadians;\n/**\n * Converts a length to the requested unit.\n * Valid units: miles, nauticalmiles, inches, yards, meters, metres, kilometers, centimeters, feet\n *\n * @param {number} length to be converted\n * @param {Units} [originalUnit=\"kilometers\"] of the length\n * @param {Units} [finalUnit=\"kilometers\"] returned unit\n * @returns {number} the converted length\n */\nfunction convertLength(length, originalUnit, finalUnit) {\n    if (originalUnit === void 0) { originalUnit = \"kilometers\"; }\n    if (finalUnit === void 0) { finalUnit = \"kilometers\"; }\n    if (!(length >= 0)) {\n        throw new Error(\"length must be a positive number\");\n    }\n    return radiansToLength(lengthToRadians(length, originalUnit), finalUnit);\n}\nexports.convertLength = convertLength;\n/**\n * Converts a area to the requested unit.\n * Valid units: kilometers, kilometres, meters, metres, centimetres, millimeters, acres, miles, yards, feet, inches, hectares\n * @param {number} area to be converted\n * @param {Units} [originalUnit=\"meters\"] of the distance\n * @param {Units} [finalUnit=\"kilometers\"] returned unit\n * @returns {number} the converted area\n */\nfunction convertArea(area, originalUnit, finalUnit) {\n    if (originalUnit === void 0) { originalUnit = \"meters\"; }\n    if (finalUnit === void 0) { finalUnit = \"kilometers\"; }\n    if (!(area >= 0)) {\n        throw new Error(\"area must be a positive number\");\n    }\n    var startFactor = exports.areaFactors[originalUnit];\n    if (!startFactor) {\n        throw new Error(\"invalid original units\");\n    }\n    var finalFactor = exports.areaFactors[finalUnit];\n    if (!finalFactor) {\n        throw new Error(\"invalid final units\");\n    }\n    return (area / startFactor) * finalFactor;\n}\nexports.convertArea = convertArea;\n/**\n * isNumber\n *\n * @param {*} num Number to validate\n * @returns {boolean} true/false\n * @example\n * turf.isNumber(123)\n * //=true\n * turf.isNumber('foo')\n * //=false\n */\nfunction isNumber(num) {\n    return !isNaN(num) && num !== null && !Array.isArray(num);\n}\nexports.isNumber = isNumber;\n/**\n * isObject\n *\n * @param {*} input variable to validate\n * @returns {boolean} true/false\n * @example\n * turf.isObject({elevation: 10})\n * //=true\n * turf.isObject('foo')\n * //=false\n */\nfunction isObject(input) {\n    return !!input && input.constructor === Object;\n}\nexports.isObject = isObject;\n/**\n * Validate BBox\n *\n * @private\n * @param {Array<number>} bbox BBox to validate\n * @returns {void}\n * @throws Error if BBox is not valid\n * @example\n * validateBBox([-180, -40, 110, 50])\n * //=OK\n * validateBBox([-180, -40])\n * //=Error\n * validateBBox('Foo')\n * //=Error\n * validateBBox(5)\n * //=Error\n * validateBBox(null)\n * //=Error\n * validateBBox(undefined)\n * //=Error\n */\nfunction validateBBox(bbox) {\n    if (!bbox) {\n        throw new Error(\"bbox is required\");\n    }\n    if (!Array.isArray(bbox)) {\n        throw new Error(\"bbox must be an Array\");\n    }\n    if (bbox.length !== 4 && bbox.length !== 6) {\n        throw new Error(\"bbox must be an Array of 4 or 6 numbers\");\n    }\n    bbox.forEach(function (num) {\n        if (!isNumber(num)) {\n            throw new Error(\"bbox must only contain numbers\");\n        }\n    });\n}\nexports.validateBBox = validateBBox;\n/**\n * Validate Id\n *\n * @private\n * @param {string|number} id Id to validate\n * @returns {void}\n * @throws Error if Id is not valid\n * @example\n * validateId([-180, -40, 110, 50])\n * //=Error\n * validateId([-180, -40])\n * //=Error\n * validateId('Foo')\n * //=OK\n * validateId(5)\n * //=OK\n * validateId(null)\n * //=Error\n * validateId(undefined)\n * //=Error\n */\nfunction validateId(id) {\n    if (!id) {\n        throw new Error(\"id is required\");\n    }\n    if ([\"string\", \"number\"].indexOf(typeof id) === -1) {\n        throw new Error(\"id must be a number or a string\");\n    }\n}\nexports.validateId = validateId;\n", "'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar helpers = require('@turf/helpers');\n\n/**\n * Callback for coordEach\n *\n * @callback coordEachCallback\n * @param {Array<number>} currentCoord The current coordinate being processed.\n * @param {number} coordIndex The current index of the coordinate being processed.\n * @param {number} featureIndex The current index of the Feature being processed.\n * @param {number} multiFeatureIndex The current index of the Multi-Feature being processed.\n * @param {number} geometryIndex The current index of the Geometry being processed.\n */\n\n/**\n * Iterate over coordinates in any GeoJSON object, similar to Array.forEach()\n *\n * @name coordEach\n * @param {FeatureCollection|Feature|Geometry} geojson any GeoJSON object\n * @param {Function} callback a method that takes (currentCoord, coordIndex, featureIndex, multiFeatureIndex)\n * @param {boolean} [excludeWrapCoord=false] whether or not to include the final coordinate of LinearRings that wraps the ring in its iteration.\n * @returns {void}\n * @example\n * var features = turf.featureCollection([\n *   turf.point([26, 37], {\"foo\": \"bar\"}),\n *   turf.point([36, 53], {\"hello\": \"world\"})\n * ]);\n *\n * turf.coordEach(features, function (currentCoord, coordIndex, featureIndex, multiFeatureIndex, geometryIndex) {\n *   //=currentCoord\n *   //=coordIndex\n *   //=featureIndex\n *   //=multiFeatureIndex\n *   //=geometryIndex\n * });\n */\nfunction coordEach(geojson, callback, excludeWrapCoord) {\n  // Handles null Geometry -- Skips this GeoJSON\n  if (geojson === null) return;\n  var j,\n    k,\n    l,\n    geometry,\n    stopG,\n    coords,\n    geometryMaybeCollection,\n    wrapShrink = 0,\n    coordIndex = 0,\n    isGeometryCollection,\n    type = geojson.type,\n    isFeatureCollection = type === \"FeatureCollection\",\n    isFeature = type === \"Feature\",\n    stop = isFeatureCollection ? geojson.features.length : 1;\n\n  // This logic may look a little weird. The reason why it is that way\n  // is because it's trying to be fast. GeoJSON supports multiple kinds\n  // of objects at its root: FeatureCollection, Features, Geometries.\n  // This function has the responsibility of handling all of them, and that\n  // means that some of the `for` loops you see below actually just don't apply\n  // to certain inputs. For instance, if you give this just a\n  // Point geometry, then both loops are short-circuited and all we do\n  // is gradually rename the input until it's called 'geometry'.\n  //\n  // This also aims to allocate as few resources as possible: just a\n  // few numbers and booleans, rather than any temporary arrays as would\n  // be required with the normalization approach.\n  for (var featureIndex = 0; featureIndex < stop; featureIndex++) {\n    geometryMaybeCollection = isFeatureCollection\n      ? geojson.features[featureIndex].geometry\n      : isFeature\n      ? geojson.geometry\n      : geojson;\n    isGeometryCollection = geometryMaybeCollection\n      ? geometryMaybeCollection.type === \"GeometryCollection\"\n      : false;\n    stopG = isGeometryCollection\n      ? geometryMaybeCollection.geometries.length\n      : 1;\n\n    for (var geomIndex = 0; geomIndex < stopG; geomIndex++) {\n      var multiFeatureIndex = 0;\n      var geometryIndex = 0;\n      geometry = isGeometryCollection\n        ? geometryMaybeCollection.geometries[geomIndex]\n        : geometryMaybeCollection;\n\n      // Handles null Geometry -- Skips this geometry\n      if (geometry === null) continue;\n      coords = geometry.coordinates;\n      var geomType = geometry.type;\n\n      wrapShrink =\n        excludeWrapCoord &&\n        (geomType === \"Polygon\" || geomType === \"MultiPolygon\")\n          ? 1\n          : 0;\n\n      switch (geomType) {\n        case null:\n          break;\n        case \"Point\":\n          if (\n            callback(\n              coords,\n              coordIndex,\n              featureIndex,\n              multiFeatureIndex,\n              geometryIndex\n            ) === false\n          )\n            return false;\n          coordIndex++;\n          multiFeatureIndex++;\n          break;\n        case \"LineString\":\n        case \"MultiPoint\":\n          for (j = 0; j < coords.length; j++) {\n            if (\n              callback(\n                coords[j],\n                coordIndex,\n                featureIndex,\n                multiFeatureIndex,\n                geometryIndex\n              ) === false\n            )\n              return false;\n            coordIndex++;\n            if (geomType === \"MultiPoint\") multiFeatureIndex++;\n          }\n          if (geomType === \"LineString\") multiFeatureIndex++;\n          break;\n        case \"Polygon\":\n        case \"MultiLineString\":\n          for (j = 0; j < coords.length; j++) {\n            for (k = 0; k < coords[j].length - wrapShrink; k++) {\n              if (\n                callback(\n                  coords[j][k],\n                  coordIndex,\n                  featureIndex,\n                  multiFeatureIndex,\n                  geometryIndex\n                ) === false\n              )\n                return false;\n              coordIndex++;\n            }\n            if (geomType === \"MultiLineString\") multiFeatureIndex++;\n            if (geomType === \"Polygon\") geometryIndex++;\n          }\n          if (geomType === \"Polygon\") multiFeatureIndex++;\n          break;\n        case \"MultiPolygon\":\n          for (j = 0; j < coords.length; j++) {\n            geometryIndex = 0;\n            for (k = 0; k < coords[j].length; k++) {\n              for (l = 0; l < coords[j][k].length - wrapShrink; l++) {\n                if (\n                  callback(\n                    coords[j][k][l],\n                    coordIndex,\n                    featureIndex,\n                    multiFeatureIndex,\n                    geometryIndex\n                  ) === false\n                )\n                  return false;\n                coordIndex++;\n              }\n              geometryIndex++;\n            }\n            multiFeatureIndex++;\n          }\n          break;\n        case \"GeometryCollection\":\n          for (j = 0; j < geometry.geometries.length; j++)\n            if (\n              coordEach(geometry.geometries[j], callback, excludeWrapCoord) ===\n              false\n            )\n              return false;\n          break;\n        default:\n          throw new Error(\"Unknown Geometry Type\");\n      }\n    }\n  }\n}\n\n/**\n * Callback for coordReduce\n *\n * The first time the callback function is called, the values provided as arguments depend\n * on whether the reduce method has an initialValue argument.\n *\n * If an initialValue is provided to the reduce method:\n *  - The previousValue argument is initialValue.\n *  - The currentValue argument is the value of the first element present in the array.\n *\n * If an initialValue is not provided:\n *  - The previousValue argument is the value of the first element present in the array.\n *  - The currentValue argument is the value of the second element present in the array.\n *\n * @callback coordReduceCallback\n * @param {*} previousValue The accumulated value previously returned in the last invocation\n * of the callback, or initialValue, if supplied.\n * @param {Array<number>} currentCoord The current coordinate being processed.\n * @param {number} coordIndex The current index of the coordinate being processed.\n * Starts at index 0, if an initialValue is provided, and at index 1 otherwise.\n * @param {number} featureIndex The current index of the Feature being processed.\n * @param {number} multiFeatureIndex The current index of the Multi-Feature being processed.\n * @param {number} geometryIndex The current index of the Geometry being processed.\n */\n\n/**\n * Reduce coordinates in any GeoJSON object, similar to Array.reduce()\n *\n * @name coordReduce\n * @param {FeatureCollection|Geometry|Feature} geojson any GeoJSON object\n * @param {Function} callback a method that takes (previousValue, currentCoord, coordIndex)\n * @param {*} [initialValue] Value to use as the first argument to the first call of the callback.\n * @param {boolean} [excludeWrapCoord=false] whether or not to include the final coordinate of LinearRings that wraps the ring in its iteration.\n * @returns {*} The value that results from the reduction.\n * @example\n * var features = turf.featureCollection([\n *   turf.point([26, 37], {\"foo\": \"bar\"}),\n *   turf.point([36, 53], {\"hello\": \"world\"})\n * ]);\n *\n * turf.coordReduce(features, function (previousValue, currentCoord, coordIndex, featureIndex, multiFeatureIndex, geometryIndex) {\n *   //=previousValue\n *   //=currentCoord\n *   //=coordIndex\n *   //=featureIndex\n *   //=multiFeatureIndex\n *   //=geometryIndex\n *   return currentCoord;\n * });\n */\nfunction coordReduce(geojson, callback, initialValue, excludeWrapCoord) {\n  var previousValue = initialValue;\n  coordEach(\n    geojson,\n    function (\n      currentCoord,\n      coordIndex,\n      featureIndex,\n      multiFeatureIndex,\n      geometryIndex\n    ) {\n      if (coordIndex === 0 && initialValue === undefined)\n        previousValue = currentCoord;\n      else\n        previousValue = callback(\n          previousValue,\n          currentCoord,\n          coordIndex,\n          featureIndex,\n          multiFeatureIndex,\n          geometryIndex\n        );\n    },\n    excludeWrapCoord\n  );\n  return previousValue;\n}\n\n/**\n * Callback for propEach\n *\n * @callback propEachCallback\n * @param {Object} currentProperties The current Properties being processed.\n * @param {number} featureIndex The current index of the Feature being processed.\n */\n\n/**\n * Iterate over properties in any GeoJSON object, similar to Array.forEach()\n *\n * @name propEach\n * @param {FeatureCollection|Feature} geojson any GeoJSON object\n * @param {Function} callback a method that takes (currentProperties, featureIndex)\n * @returns {void}\n * @example\n * var features = turf.featureCollection([\n *     turf.point([26, 37], {foo: 'bar'}),\n *     turf.point([36, 53], {hello: 'world'})\n * ]);\n *\n * turf.propEach(features, function (currentProperties, featureIndex) {\n *   //=currentProperties\n *   //=featureIndex\n * });\n */\nfunction propEach(geojson, callback) {\n  var i;\n  switch (geojson.type) {\n    case \"FeatureCollection\":\n      for (i = 0; i < geojson.features.length; i++) {\n        if (callback(geojson.features[i].properties, i) === false) break;\n      }\n      break;\n    case \"Feature\":\n      callback(geojson.properties, 0);\n      break;\n  }\n}\n\n/**\n * Callback for propReduce\n *\n * The first time the callback function is called, the values provided as arguments depend\n * on whether the reduce method has an initialValue argument.\n *\n * If an initialValue is provided to the reduce method:\n *  - The previousValue argument is initialValue.\n *  - The currentValue argument is the value of the first element present in the array.\n *\n * If an initialValue is not provided:\n *  - The previousValue argument is the value of the first element present in the array.\n *  - The currentValue argument is the value of the second element present in the array.\n *\n * @callback propReduceCallback\n * @param {*} previousValue The accumulated value previously returned in the last invocation\n * of the callback, or initialValue, if supplied.\n * @param {*} currentProperties The current Properties being processed.\n * @param {number} featureIndex The current index of the Feature being processed.\n */\n\n/**\n * Reduce properties in any GeoJSON object into a single value,\n * similar to how Array.reduce works. However, in this case we lazily run\n * the reduction, so an array of all properties is unnecessary.\n *\n * @name propReduce\n * @param {FeatureCollection|Feature} geojson any GeoJSON object\n * @param {Function} callback a method that takes (previousValue, currentProperties, featureIndex)\n * @param {*} [initialValue] Value to use as the first argument to the first call of the callback.\n * @returns {*} The value that results from the reduction.\n * @example\n * var features = turf.featureCollection([\n *     turf.point([26, 37], {foo: 'bar'}),\n *     turf.point([36, 53], {hello: 'world'})\n * ]);\n *\n * turf.propReduce(features, function (previousValue, currentProperties, featureIndex) {\n *   //=previousValue\n *   //=currentProperties\n *   //=featureIndex\n *   return currentProperties\n * });\n */\nfunction propReduce(geojson, callback, initialValue) {\n  var previousValue = initialValue;\n  propEach(geojson, function (currentProperties, featureIndex) {\n    if (featureIndex === 0 && initialValue === undefined)\n      previousValue = currentProperties;\n    else\n      previousValue = callback(previousValue, currentProperties, featureIndex);\n  });\n  return previousValue;\n}\n\n/**\n * Callback for featureEach\n *\n * @callback featureEachCallback\n * @param {Feature<any>} currentFeature The current Feature being processed.\n * @param {number} featureIndex The current index of the Feature being processed.\n */\n\n/**\n * Iterate over features in any GeoJSON object, similar to\n * Array.forEach.\n *\n * @name featureEach\n * @param {FeatureCollection|Feature|Geometry} geojson any GeoJSON object\n * @param {Function} callback a method that takes (currentFeature, featureIndex)\n * @returns {void}\n * @example\n * var features = turf.featureCollection([\n *   turf.point([26, 37], {foo: 'bar'}),\n *   turf.point([36, 53], {hello: 'world'})\n * ]);\n *\n * turf.featureEach(features, function (currentFeature, featureIndex) {\n *   //=currentFeature\n *   //=featureIndex\n * });\n */\nfunction featureEach(geojson, callback) {\n  if (geojson.type === \"Feature\") {\n    callback(geojson, 0);\n  } else if (geojson.type === \"FeatureCollection\") {\n    for (var i = 0; i < geojson.features.length; i++) {\n      if (callback(geojson.features[i], i) === false) break;\n    }\n  }\n}\n\n/**\n * Callback for featureReduce\n *\n * The first time the callback function is called, the values provided as arguments depend\n * on whether the reduce method has an initialValue argument.\n *\n * If an initialValue is provided to the reduce method:\n *  - The previousValue argument is initialValue.\n *  - The currentValue argument is the value of the first element present in the array.\n *\n * If an initialValue is not provided:\n *  - The previousValue argument is the value of the first element present in the array.\n *  - The currentValue argument is the value of the second element present in the array.\n *\n * @callback featureReduceCallback\n * @param {*} previousValue The accumulated value previously returned in the last invocation\n * of the callback, or initialValue, if supplied.\n * @param {Feature} currentFeature The current Feature being processed.\n * @param {number} featureIndex The current index of the Feature being processed.\n */\n\n/**\n * Reduce features in any GeoJSON object, similar to Array.reduce().\n *\n * @name featureReduce\n * @param {FeatureCollection|Feature|Geometry} geojson any GeoJSON object\n * @param {Function} callback a method that takes (previousValue, currentFeature, featureIndex)\n * @param {*} [initialValue] Value to use as the first argument to the first call of the callback.\n * @returns {*} The value that results from the reduction.\n * @example\n * var features = turf.featureCollection([\n *   turf.point([26, 37], {\"foo\": \"bar\"}),\n *   turf.point([36, 53], {\"hello\": \"world\"})\n * ]);\n *\n * turf.featureReduce(features, function (previousValue, currentFeature, featureIndex) {\n *   //=previousValue\n *   //=currentFeature\n *   //=featureIndex\n *   return currentFeature\n * });\n */\nfunction featureReduce(geojson, callback, initialValue) {\n  var previousValue = initialValue;\n  featureEach(geojson, function (currentFeature, featureIndex) {\n    if (featureIndex === 0 && initialValue === undefined)\n      previousValue = currentFeature;\n    else previousValue = callback(previousValue, currentFeature, featureIndex);\n  });\n  return previousValue;\n}\n\n/**\n * Get all coordinates from any GeoJSON object.\n *\n * @name coordAll\n * @param {FeatureCollection|Feature|Geometry} geojson any GeoJSON object\n * @returns {Array<Array<number>>} coordinate position array\n * @example\n * var features = turf.featureCollection([\n *   turf.point([26, 37], {foo: 'bar'}),\n *   turf.point([36, 53], {hello: 'world'})\n * ]);\n *\n * var coords = turf.coordAll(features);\n * //= [[26, 37], [36, 53]]\n */\nfunction coordAll(geojson) {\n  var coords = [];\n  coordEach(geojson, function (coord) {\n    coords.push(coord);\n  });\n  return coords;\n}\n\n/**\n * Callback for geomEach\n *\n * @callback geomEachCallback\n * @param {Geometry} currentGeometry The current Geometry being processed.\n * @param {number} featureIndex The current index of the Feature being processed.\n * @param {Object} featureProperties The current Feature Properties being processed.\n * @param {Array<number>} featureBBox The current Feature BBox being processed.\n * @param {number|string} featureId The current Feature Id being processed.\n */\n\n/**\n * Iterate over each geometry in any GeoJSON object, similar to Array.forEach()\n *\n * @name geomEach\n * @param {FeatureCollection|Feature|Geometry} geojson any GeoJSON object\n * @param {Function} callback a method that takes (currentGeometry, featureIndex, featureProperties, featureBBox, featureId)\n * @returns {void}\n * @example\n * var features = turf.featureCollection([\n *     turf.point([26, 37], {foo: 'bar'}),\n *     turf.point([36, 53], {hello: 'world'})\n * ]);\n *\n * turf.geomEach(features, function (currentGeometry, featureIndex, featureProperties, featureBBox, featureId) {\n *   //=currentGeometry\n *   //=featureIndex\n *   //=featureProperties\n *   //=featureBBox\n *   //=featureId\n * });\n */\nfunction geomEach(geojson, callback) {\n  var i,\n    j,\n    g,\n    geometry,\n    stopG,\n    geometryMaybeCollection,\n    isGeometryCollection,\n    featureProperties,\n    featureBBox,\n    featureId,\n    featureIndex = 0,\n    isFeatureCollection = geojson.type === \"FeatureCollection\",\n    isFeature = geojson.type === \"Feature\",\n    stop = isFeatureCollection ? geojson.features.length : 1;\n\n  // This logic may look a little weird. The reason why it is that way\n  // is because it's trying to be fast. GeoJSON supports multiple kinds\n  // of objects at its root: FeatureCollection, Features, Geometries.\n  // This function has the responsibility of handling all of them, and that\n  // means that some of the `for` loops you see below actually just don't apply\n  // to certain inputs. For instance, if you give this just a\n  // Point geometry, then both loops are short-circuited and all we do\n  // is gradually rename the input until it's called 'geometry'.\n  //\n  // This also aims to allocate as few resources as possible: just a\n  // few numbers and booleans, rather than any temporary arrays as would\n  // be required with the normalization approach.\n  for (i = 0; i < stop; i++) {\n    geometryMaybeCollection = isFeatureCollection\n      ? geojson.features[i].geometry\n      : isFeature\n      ? geojson.geometry\n      : geojson;\n    featureProperties = isFeatureCollection\n      ? geojson.features[i].properties\n      : isFeature\n      ? geojson.properties\n      : {};\n    featureBBox = isFeatureCollection\n      ? geojson.features[i].bbox\n      : isFeature\n      ? geojson.bbox\n      : undefined;\n    featureId = isFeatureCollection\n      ? geojson.features[i].id\n      : isFeature\n      ? geojson.id\n      : undefined;\n    isGeometryCollection = geometryMaybeCollection\n      ? geometryMaybeCollection.type === \"GeometryCollection\"\n      : false;\n    stopG = isGeometryCollection\n      ? geometryMaybeCollection.geometries.length\n      : 1;\n\n    for (g = 0; g < stopG; g++) {\n      geometry = isGeometryCollection\n        ? geometryMaybeCollection.geometries[g]\n        : geometryMaybeCollection;\n\n      // Handle null Geometry\n      if (geometry === null) {\n        if (\n          callback(\n            null,\n            featureIndex,\n            featureProperties,\n            featureBBox,\n            featureId\n          ) === false\n        )\n          return false;\n        continue;\n      }\n      switch (geometry.type) {\n        case \"Point\":\n        case \"LineString\":\n        case \"MultiPoint\":\n        case \"Polygon\":\n        case \"MultiLineString\":\n        case \"MultiPolygon\": {\n          if (\n            callback(\n              geometry,\n              featureIndex,\n              featureProperties,\n              featureBBox,\n              featureId\n            ) === false\n          )\n            return false;\n          break;\n        }\n        case \"GeometryCollection\": {\n          for (j = 0; j < geometry.geometries.length; j++) {\n            if (\n              callback(\n                geometry.geometries[j],\n                featureIndex,\n                featureProperties,\n                featureBBox,\n                featureId\n              ) === false\n            )\n              return false;\n          }\n          break;\n        }\n        default:\n          throw new Error(\"Unknown Geometry Type\");\n      }\n    }\n    // Only increase `featureIndex` per each feature\n    featureIndex++;\n  }\n}\n\n/**\n * Callback for geomReduce\n *\n * The first time the callback function is called, the values provided as arguments depend\n * on whether the reduce method has an initialValue argument.\n *\n * If an initialValue is provided to the reduce method:\n *  - The previousValue argument is initialValue.\n *  - The currentValue argument is the value of the first element present in the array.\n *\n * If an initialValue is not provided:\n *  - The previousValue argument is the value of the first element present in the array.\n *  - The currentValue argument is the value of the second element present in the array.\n *\n * @callback geomReduceCallback\n * @param {*} previousValue The accumulated value previously returned in the last invocation\n * of the callback, or initialValue, if supplied.\n * @param {Geometry} currentGeometry The current Geometry being processed.\n * @param {number} featureIndex The current index of the Feature being processed.\n * @param {Object} featureProperties The current Feature Properties being processed.\n * @param {Array<number>} featureBBox The current Feature BBox being processed.\n * @param {number|string} featureId The current Feature Id being processed.\n */\n\n/**\n * Reduce geometry in any GeoJSON object, similar to Array.reduce().\n *\n * @name geomReduce\n * @param {FeatureCollection|Feature|Geometry} geojson any GeoJSON object\n * @param {Function} callback a method that takes (previousValue, currentGeometry, featureIndex, featureProperties, featureBBox, featureId)\n * @param {*} [initialValue] Value to use as the first argument to the first call of the callback.\n * @returns {*} The value that results from the reduction.\n * @example\n * var features = turf.featureCollection([\n *     turf.point([26, 37], {foo: 'bar'}),\n *     turf.point([36, 53], {hello: 'world'})\n * ]);\n *\n * turf.geomReduce(features, function (previousValue, currentGeometry, featureIndex, featureProperties, featureBBox, featureId) {\n *   //=previousValue\n *   //=currentGeometry\n *   //=featureIndex\n *   //=featureProperties\n *   //=featureBBox\n *   //=featureId\n *   return currentGeometry\n * });\n */\nfunction geomReduce(geojson, callback, initialValue) {\n  var previousValue = initialValue;\n  geomEach(\n    geojson,\n    function (\n      currentGeometry,\n      featureIndex,\n      featureProperties,\n      featureBBox,\n      featureId\n    ) {\n      if (featureIndex === 0 && initialValue === undefined)\n        previousValue = currentGeometry;\n      else\n        previousValue = callback(\n          previousValue,\n          currentGeometry,\n          featureIndex,\n          featureProperties,\n          featureBBox,\n          featureId\n        );\n    }\n  );\n  return previousValue;\n}\n\n/**\n * Callback for flattenEach\n *\n * @callback flattenEachCallback\n * @param {Feature} currentFeature The current flattened feature being processed.\n * @param {number} featureIndex The current index of the Feature being processed.\n * @param {number} multiFeatureIndex The current index of the Multi-Feature being processed.\n */\n\n/**\n * Iterate over flattened features in any GeoJSON object, similar to\n * Array.forEach.\n *\n * @name flattenEach\n * @param {FeatureCollection|Feature|Geometry} geojson any GeoJSON object\n * @param {Function} callback a method that takes (currentFeature, featureIndex, multiFeatureIndex)\n * @example\n * var features = turf.featureCollection([\n *     turf.point([26, 37], {foo: 'bar'}),\n *     turf.multiPoint([[40, 30], [36, 53]], {hello: 'world'})\n * ]);\n *\n * turf.flattenEach(features, function (currentFeature, featureIndex, multiFeatureIndex) {\n *   //=currentFeature\n *   //=featureIndex\n *   //=multiFeatureIndex\n * });\n */\nfunction flattenEach(geojson, callback) {\n  geomEach(geojson, function (geometry, featureIndex, properties, bbox, id) {\n    // Callback for single geometry\n    var type = geometry === null ? null : geometry.type;\n    switch (type) {\n      case null:\n      case \"Point\":\n      case \"LineString\":\n      case \"Polygon\":\n        if (\n          callback(\n            helpers.feature(geometry, properties, { bbox: bbox, id: id }),\n            featureIndex,\n            0\n          ) === false\n        )\n          return false;\n        return;\n    }\n\n    var geomType;\n\n    // Callback for multi-geometry\n    switch (type) {\n      case \"MultiPoint\":\n        geomType = \"Point\";\n        break;\n      case \"MultiLineString\":\n        geomType = \"LineString\";\n        break;\n      case \"MultiPolygon\":\n        geomType = \"Polygon\";\n        break;\n    }\n\n    for (\n      var multiFeatureIndex = 0;\n      multiFeatureIndex < geometry.coordinates.length;\n      multiFeatureIndex++\n    ) {\n      var coordinate = geometry.coordinates[multiFeatureIndex];\n      var geom = {\n        type: geomType,\n        coordinates: coordinate,\n      };\n      if (\n        callback(helpers.feature(geom, properties), featureIndex, multiFeatureIndex) ===\n        false\n      )\n        return false;\n    }\n  });\n}\n\n/**\n * Callback for flattenReduce\n *\n * The first time the callback function is called, the values provided as arguments depend\n * on whether the reduce method has an initialValue argument.\n *\n * If an initialValue is provided to the reduce method:\n *  - The previousValue argument is initialValue.\n *  - The currentValue argument is the value of the first element present in the array.\n *\n * If an initialValue is not provided:\n *  - The previousValue argument is the value of the first element present in the array.\n *  - The currentValue argument is the value of the second element present in the array.\n *\n * @callback flattenReduceCallback\n * @param {*} previousValue The accumulated value previously returned in the last invocation\n * of the callback, or initialValue, if supplied.\n * @param {Feature} currentFeature The current Feature being processed.\n * @param {number} featureIndex The current index of the Feature being processed.\n * @param {number} multiFeatureIndex The current index of the Multi-Feature being processed.\n */\n\n/**\n * Reduce flattened features in any GeoJSON object, similar to Array.reduce().\n *\n * @name flattenReduce\n * @param {FeatureCollection|Feature|Geometry} geojson any GeoJSON object\n * @param {Function} callback a method that takes (previousValue, currentFeature, featureIndex, multiFeatureIndex)\n * @param {*} [initialValue] Value to use as the first argument to the first call of the callback.\n * @returns {*} The value that results from the reduction.\n * @example\n * var features = turf.featureCollection([\n *     turf.point([26, 37], {foo: 'bar'}),\n *     turf.multiPoint([[40, 30], [36, 53]], {hello: 'world'})\n * ]);\n *\n * turf.flattenReduce(features, function (previousValue, currentFeature, featureIndex, multiFeatureIndex) {\n *   //=previousValue\n *   //=currentFeature\n *   //=featureIndex\n *   //=multiFeatureIndex\n *   return currentFeature\n * });\n */\nfunction flattenReduce(geojson, callback, initialValue) {\n  var previousValue = initialValue;\n  flattenEach(\n    geojson,\n    function (currentFeature, featureIndex, multiFeatureIndex) {\n      if (\n        featureIndex === 0 &&\n        multiFeatureIndex === 0 &&\n        initialValue === undefined\n      )\n        previousValue = currentFeature;\n      else\n        previousValue = callback(\n          previousValue,\n          currentFeature,\n          featureIndex,\n          multiFeatureIndex\n        );\n    }\n  );\n  return previousValue;\n}\n\n/**\n * Callback for segmentEach\n *\n * @callback segmentEachCallback\n * @param {Feature<LineString>} currentSegment The current Segment being processed.\n * @param {number} featureIndex The current index of the Feature being processed.\n * @param {number} multiFeatureIndex The current index of the Multi-Feature being processed.\n * @param {number} geometryIndex The current index of the Geometry being processed.\n * @param {number} segmentIndex The current index of the Segment being processed.\n * @returns {void}\n */\n\n/**\n * Iterate over 2-vertex line segment in any GeoJSON object, similar to Array.forEach()\n * (Multi)Point geometries do not contain segments therefore they are ignored during this operation.\n *\n * @param {FeatureCollection|Feature|Geometry} geojson any GeoJSON\n * @param {Function} callback a method that takes (currentSegment, featureIndex, multiFeatureIndex, geometryIndex, segmentIndex)\n * @returns {void}\n * @example\n * var polygon = turf.polygon([[[-50, 5], [-40, -10], [-50, -10], [-40, 5], [-50, 5]]]);\n *\n * // Iterate over GeoJSON by 2-vertex segments\n * turf.segmentEach(polygon, function (currentSegment, featureIndex, multiFeatureIndex, geometryIndex, segmentIndex) {\n *   //=currentSegment\n *   //=featureIndex\n *   //=multiFeatureIndex\n *   //=geometryIndex\n *   //=segmentIndex\n * });\n *\n * // Calculate the total number of segments\n * var total = 0;\n * turf.segmentEach(polygon, function () {\n *     total++;\n * });\n */\nfunction segmentEach(geojson, callback) {\n  flattenEach(geojson, function (feature, featureIndex, multiFeatureIndex) {\n    var segmentIndex = 0;\n\n    // Exclude null Geometries\n    if (!feature.geometry) return;\n    // (Multi)Point geometries do not contain segments therefore they are ignored during this operation.\n    var type = feature.geometry.type;\n    if (type === \"Point\" || type === \"MultiPoint\") return;\n\n    // Generate 2-vertex line segments\n    var previousCoords;\n    var previousFeatureIndex = 0;\n    var previousMultiIndex = 0;\n    var prevGeomIndex = 0;\n    if (\n      coordEach(\n        feature,\n        function (\n          currentCoord,\n          coordIndex,\n          featureIndexCoord,\n          multiPartIndexCoord,\n          geometryIndex\n        ) {\n          // Simulating a meta.coordReduce() since `reduce` operations cannot be stopped by returning `false`\n          if (\n            previousCoords === undefined ||\n            featureIndex > previousFeatureIndex ||\n            multiPartIndexCoord > previousMultiIndex ||\n            geometryIndex > prevGeomIndex\n          ) {\n            previousCoords = currentCoord;\n            previousFeatureIndex = featureIndex;\n            previousMultiIndex = multiPartIndexCoord;\n            prevGeomIndex = geometryIndex;\n            segmentIndex = 0;\n            return;\n          }\n          var currentSegment = helpers.lineString(\n            [previousCoords, currentCoord],\n            feature.properties\n          );\n          if (\n            callback(\n              currentSegment,\n              featureIndex,\n              multiFeatureIndex,\n              geometryIndex,\n              segmentIndex\n            ) === false\n          )\n            return false;\n          segmentIndex++;\n          previousCoords = currentCoord;\n        }\n      ) === false\n    )\n      return false;\n  });\n}\n\n/**\n * Callback for segmentReduce\n *\n * The first time the callback function is called, the values provided as arguments depend\n * on whether the reduce method has an initialValue argument.\n *\n * If an initialValue is provided to the reduce method:\n *  - The previousValue argument is initialValue.\n *  - The currentValue argument is the value of the first element present in the array.\n *\n * If an initialValue is not provided:\n *  - The previousValue argument is the value of the first element present in the array.\n *  - The currentValue argument is the value of the second element present in the array.\n *\n * @callback segmentReduceCallback\n * @param {*} previousValue The accumulated value previously returned in the last invocation\n * of the callback, or initialValue, if supplied.\n * @param {Feature<LineString>} currentSegment The current Segment being processed.\n * @param {number} featureIndex The current index of the Feature being processed.\n * @param {number} multiFeatureIndex The current index of the Multi-Feature being processed.\n * @param {number} geometryIndex The current index of the Geometry being processed.\n * @param {number} segmentIndex The current index of the Segment being processed.\n */\n\n/**\n * Reduce 2-vertex line segment in any GeoJSON object, similar to Array.reduce()\n * (Multi)Point geometries do not contain segments therefore they are ignored during this operation.\n *\n * @param {FeatureCollection|Feature|Geometry} geojson any GeoJSON\n * @param {Function} callback a method that takes (previousValue, currentSegment, currentIndex)\n * @param {*} [initialValue] Value to use as the first argument to the first call of the callback.\n * @returns {void}\n * @example\n * var polygon = turf.polygon([[[-50, 5], [-40, -10], [-50, -10], [-40, 5], [-50, 5]]]);\n *\n * // Iterate over GeoJSON by 2-vertex segments\n * turf.segmentReduce(polygon, function (previousSegment, currentSegment, featureIndex, multiFeatureIndex, geometryIndex, segmentIndex) {\n *   //= previousSegment\n *   //= currentSegment\n *   //= featureIndex\n *   //= multiFeatureIndex\n *   //= geometryIndex\n *   //= segmentIndex\n *   return currentSegment\n * });\n *\n * // Calculate the total number of segments\n * var initialValue = 0\n * var total = turf.segmentReduce(polygon, function (previousValue) {\n *     previousValue++;\n *     return previousValue;\n * }, initialValue);\n */\nfunction segmentReduce(geojson, callback, initialValue) {\n  var previousValue = initialValue;\n  var started = false;\n  segmentEach(\n    geojson,\n    function (\n      currentSegment,\n      featureIndex,\n      multiFeatureIndex,\n      geometryIndex,\n      segmentIndex\n    ) {\n      if (started === false && initialValue === undefined)\n        previousValue = currentSegment;\n      else\n        previousValue = callback(\n          previousValue,\n          currentSegment,\n          featureIndex,\n          multiFeatureIndex,\n          geometryIndex,\n          segmentIndex\n        );\n      started = true;\n    }\n  );\n  return previousValue;\n}\n\n/**\n * Callback for lineEach\n *\n * @callback lineEachCallback\n * @param {Feature<LineString>} currentLine The current LineString|LinearRing being processed\n * @param {number} featureIndex The current index of the Feature being processed\n * @param {number} multiFeatureIndex The current index of the Multi-Feature being processed\n * @param {number} geometryIndex The current index of the Geometry being processed\n */\n\n/**\n * Iterate over line or ring coordinates in LineString, Polygon, MultiLineString, MultiPolygon Features or Geometries,\n * similar to Array.forEach.\n *\n * @name lineEach\n * @param {Geometry|Feature<LineString|Polygon|MultiLineString|MultiPolygon>} geojson object\n * @param {Function} callback a method that takes (currentLine, featureIndex, multiFeatureIndex, geometryIndex)\n * @example\n * var multiLine = turf.multiLineString([\n *   [[26, 37], [35, 45]],\n *   [[36, 53], [38, 50], [41, 55]]\n * ]);\n *\n * turf.lineEach(multiLine, function (currentLine, featureIndex, multiFeatureIndex, geometryIndex) {\n *   //=currentLine\n *   //=featureIndex\n *   //=multiFeatureIndex\n *   //=geometryIndex\n * });\n */\nfunction lineEach(geojson, callback) {\n  // validation\n  if (!geojson) throw new Error(\"geojson is required\");\n\n  flattenEach(geojson, function (feature, featureIndex, multiFeatureIndex) {\n    if (feature.geometry === null) return;\n    var type = feature.geometry.type;\n    var coords = feature.geometry.coordinates;\n    switch (type) {\n      case \"LineString\":\n        if (callback(feature, featureIndex, multiFeatureIndex, 0, 0) === false)\n          return false;\n        break;\n      case \"Polygon\":\n        for (\n          var geometryIndex = 0;\n          geometryIndex < coords.length;\n          geometryIndex++\n        ) {\n          if (\n            callback(\n              helpers.lineString(coords[geometryIndex], feature.properties),\n              featureIndex,\n              multiFeatureIndex,\n              geometryIndex\n            ) === false\n          )\n            return false;\n        }\n        break;\n    }\n  });\n}\n\n/**\n * Callback for lineReduce\n *\n * The first time the callback function is called, the values provided as arguments depend\n * on whether the reduce method has an initialValue argument.\n *\n * If an initialValue is provided to the reduce method:\n *  - The previousValue argument is initialValue.\n *  - The currentValue argument is the value of the first element present in the array.\n *\n * If an initialValue is not provided:\n *  - The previousValue argument is the value of the first element present in the array.\n *  - The currentValue argument is the value of the second element present in the array.\n *\n * @callback lineReduceCallback\n * @param {*} previousValue The accumulated value previously returned in the last invocation\n * of the callback, or initialValue, if supplied.\n * @param {Feature<LineString>} currentLine The current LineString|LinearRing being processed.\n * @param {number} featureIndex The current index of the Feature being processed\n * @param {number} multiFeatureIndex The current index of the Multi-Feature being processed\n * @param {number} geometryIndex The current index of the Geometry being processed\n */\n\n/**\n * Reduce features in any GeoJSON object, similar to Array.reduce().\n *\n * @name lineReduce\n * @param {Geometry|Feature<LineString|Polygon|MultiLineString|MultiPolygon>} geojson object\n * @param {Function} callback a method that takes (previousValue, currentLine, featureIndex, multiFeatureIndex, geometryIndex)\n * @param {*} [initialValue] Value to use as the first argument to the first call of the callback.\n * @returns {*} The value that results from the reduction.\n * @example\n * var multiPoly = turf.multiPolygon([\n *   turf.polygon([[[12,48],[2,41],[24,38],[12,48]], [[9,44],[13,41],[13,45],[9,44]]]),\n *   turf.polygon([[[5, 5], [0, 0], [2, 2], [4, 4], [5, 5]]])\n * ]);\n *\n * turf.lineReduce(multiPoly, function (previousValue, currentLine, featureIndex, multiFeatureIndex, geometryIndex) {\n *   //=previousValue\n *   //=currentLine\n *   //=featureIndex\n *   //=multiFeatureIndex\n *   //=geometryIndex\n *   return currentLine\n * });\n */\nfunction lineReduce(geojson, callback, initialValue) {\n  var previousValue = initialValue;\n  lineEach(\n    geojson,\n    function (currentLine, featureIndex, multiFeatureIndex, geometryIndex) {\n      if (featureIndex === 0 && initialValue === undefined)\n        previousValue = currentLine;\n      else\n        previousValue = callback(\n          previousValue,\n          currentLine,\n          featureIndex,\n          multiFeatureIndex,\n          geometryIndex\n        );\n    }\n  );\n  return previousValue;\n}\n\n/**\n * Finds a particular 2-vertex LineString Segment from a GeoJSON using `@turf/meta` indexes.\n *\n * Negative indexes are permitted.\n * Point & MultiPoint will always return null.\n *\n * @param {FeatureCollection|Feature|Geometry} geojson Any GeoJSON Feature or Geometry\n * @param {Object} [options={}] Optional parameters\n * @param {number} [options.featureIndex=0] Feature Index\n * @param {number} [options.multiFeatureIndex=0] Multi-Feature Index\n * @param {number} [options.geometryIndex=0] Geometry Index\n * @param {number} [options.segmentIndex=0] Segment Index\n * @param {Object} [options.properties={}] Translate Properties to output LineString\n * @param {BBox} [options.bbox={}] Translate BBox to output LineString\n * @param {number|string} [options.id={}] Translate Id to output LineString\n * @returns {Feature<LineString>} 2-vertex GeoJSON Feature LineString\n * @example\n * var multiLine = turf.multiLineString([\n *     [[10, 10], [50, 30], [30, 40]],\n *     [[-10, -10], [-50, -30], [-30, -40]]\n * ]);\n *\n * // First Segment (defaults are 0)\n * turf.findSegment(multiLine);\n * // => Feature<LineString<[[10, 10], [50, 30]]>>\n *\n * // First Segment of 2nd Multi Feature\n * turf.findSegment(multiLine, {multiFeatureIndex: 1});\n * // => Feature<LineString<[[-10, -10], [-50, -30]]>>\n *\n * // Last Segment of Last Multi Feature\n * turf.findSegment(multiLine, {multiFeatureIndex: -1, segmentIndex: -1});\n * // => Feature<LineString<[[-50, -30], [-30, -40]]>>\n */\nfunction findSegment(geojson, options) {\n  // Optional Parameters\n  options = options || {};\n  if (!helpers.isObject(options)) throw new Error(\"options is invalid\");\n  var featureIndex = options.featureIndex || 0;\n  var multiFeatureIndex = options.multiFeatureIndex || 0;\n  var geometryIndex = options.geometryIndex || 0;\n  var segmentIndex = options.segmentIndex || 0;\n\n  // Find FeatureIndex\n  var properties = options.properties;\n  var geometry;\n\n  switch (geojson.type) {\n    case \"FeatureCollection\":\n      if (featureIndex < 0)\n        featureIndex = geojson.features.length + featureIndex;\n      properties = properties || geojson.features[featureIndex].properties;\n      geometry = geojson.features[featureIndex].geometry;\n      break;\n    case \"Feature\":\n      properties = properties || geojson.properties;\n      geometry = geojson.geometry;\n      break;\n    case \"Point\":\n    case \"MultiPoint\":\n      return null;\n    case \"LineString\":\n    case \"Polygon\":\n    case \"MultiLineString\":\n    case \"MultiPolygon\":\n      geometry = geojson;\n      break;\n    default:\n      throw new Error(\"geojson is invalid\");\n  }\n\n  // Find SegmentIndex\n  if (geometry === null) return null;\n  var coords = geometry.coordinates;\n  switch (geometry.type) {\n    case \"Point\":\n    case \"MultiPoint\":\n      return null;\n    case \"LineString\":\n      if (segmentIndex < 0) segmentIndex = coords.length + segmentIndex - 1;\n      return helpers.lineString(\n        [coords[segmentIndex], coords[segmentIndex + 1]],\n        properties,\n        options\n      );\n    case \"Polygon\":\n      if (geometryIndex < 0) geometryIndex = coords.length + geometryIndex;\n      if (segmentIndex < 0)\n        segmentIndex = coords[geometryIndex].length + segmentIndex - 1;\n      return helpers.lineString(\n        [\n          coords[geometryIndex][segmentIndex],\n          coords[geometryIndex][segmentIndex + 1],\n        ],\n        properties,\n        options\n      );\n    case \"MultiLineString\":\n      if (multiFeatureIndex < 0)\n        multiFeatureIndex = coords.length + multiFeatureIndex;\n      if (segmentIndex < 0)\n        segmentIndex = coords[multiFeatureIndex].length + segmentIndex - 1;\n      return helpers.lineString(\n        [\n          coords[multiFeatureIndex][segmentIndex],\n          coords[multiFeatureIndex][segmentIndex + 1],\n        ],\n        properties,\n        options\n      );\n    case \"MultiPolygon\":\n      if (multiFeatureIndex < 0)\n        multiFeatureIndex = coords.length + multiFeatureIndex;\n      if (geometryIndex < 0)\n        geometryIndex = coords[multiFeatureIndex].length + geometryIndex;\n      if (segmentIndex < 0)\n        segmentIndex =\n          coords[multiFeatureIndex][geometryIndex].length - segmentIndex - 1;\n      return helpers.lineString(\n        [\n          coords[multiFeatureIndex][geometryIndex][segmentIndex],\n          coords[multiFeatureIndex][geometryIndex][segmentIndex + 1],\n        ],\n        properties,\n        options\n      );\n  }\n  throw new Error(\"geojson is invalid\");\n}\n\n/**\n * Finds a particular Point from a GeoJSON using `@turf/meta` indexes.\n *\n * Negative indexes are permitted.\n *\n * @param {FeatureCollection|Feature|Geometry} geojson Any GeoJSON Feature or Geometry\n * @param {Object} [options={}] Optional parameters\n * @param {number} [options.featureIndex=0] Feature Index\n * @param {number} [options.multiFeatureIndex=0] Multi-Feature Index\n * @param {number} [options.geometryIndex=0] Geometry Index\n * @param {number} [options.coordIndex=0] Coord Index\n * @param {Object} [options.properties={}] Translate Properties to output Point\n * @param {BBox} [options.bbox={}] Translate BBox to output Point\n * @param {number|string} [options.id={}] Translate Id to output Point\n * @returns {Feature<Point>} 2-vertex GeoJSON Feature Point\n * @example\n * var multiLine = turf.multiLineString([\n *     [[10, 10], [50, 30], [30, 40]],\n *     [[-10, -10], [-50, -30], [-30, -40]]\n * ]);\n *\n * // First Segment (defaults are 0)\n * turf.findPoint(multiLine);\n * // => Feature<Point<[10, 10]>>\n *\n * // First Segment of the 2nd Multi-Feature\n * turf.findPoint(multiLine, {multiFeatureIndex: 1});\n * // => Feature<Point<[-10, -10]>>\n *\n * // Last Segment of last Multi-Feature\n * turf.findPoint(multiLine, {multiFeatureIndex: -1, coordIndex: -1});\n * // => Feature<Point<[-30, -40]>>\n */\nfunction findPoint(geojson, options) {\n  // Optional Parameters\n  options = options || {};\n  if (!helpers.isObject(options)) throw new Error(\"options is invalid\");\n  var featureIndex = options.featureIndex || 0;\n  var multiFeatureIndex = options.multiFeatureIndex || 0;\n  var geometryIndex = options.geometryIndex || 0;\n  var coordIndex = options.coordIndex || 0;\n\n  // Find FeatureIndex\n  var properties = options.properties;\n  var geometry;\n\n  switch (geojson.type) {\n    case \"FeatureCollection\":\n      if (featureIndex < 0)\n        featureIndex = geojson.features.length + featureIndex;\n      properties = properties || geojson.features[featureIndex].properties;\n      geometry = geojson.features[featureIndex].geometry;\n      break;\n    case \"Feature\":\n      properties = properties || geojson.properties;\n      geometry = geojson.geometry;\n      break;\n    case \"Point\":\n    case \"MultiPoint\":\n      return null;\n    case \"LineString\":\n    case \"Polygon\":\n    case \"MultiLineString\":\n    case \"MultiPolygon\":\n      geometry = geojson;\n      break;\n    default:\n      throw new Error(\"geojson is invalid\");\n  }\n\n  // Find Coord Index\n  if (geometry === null) return null;\n  var coords = geometry.coordinates;\n  switch (geometry.type) {\n    case \"Point\":\n      return helpers.point(coords, properties, options);\n    case \"MultiPoint\":\n      if (multiFeatureIndex < 0)\n        multiFeatureIndex = coords.length + multiFeatureIndex;\n      return helpers.point(coords[multiFeatureIndex], properties, options);\n    case \"LineString\":\n      if (coordIndex < 0) coordIndex = coords.length + coordIndex;\n      return helpers.point(coords[coordIndex], properties, options);\n    case \"Polygon\":\n      if (geometryIndex < 0) geometryIndex = coords.length + geometryIndex;\n      if (coordIndex < 0)\n        coordIndex = coords[geometryIndex].length + coordIndex;\n      return helpers.point(coords[geometryIndex][coordIndex], properties, options);\n    case \"MultiLineString\":\n      if (multiFeatureIndex < 0)\n        multiFeatureIndex = coords.length + multiFeatureIndex;\n      if (coordIndex < 0)\n        coordIndex = coords[multiFeatureIndex].length + coordIndex;\n      return helpers.point(coords[multiFeatureIndex][coordIndex], properties, options);\n    case \"MultiPolygon\":\n      if (multiFeatureIndex < 0)\n        multiFeatureIndex = coords.length + multiFeatureIndex;\n      if (geometryIndex < 0)\n        geometryIndex = coords[multiFeatureIndex].length + geometryIndex;\n      if (coordIndex < 0)\n        coordIndex =\n          coords[multiFeatureIndex][geometryIndex].length - coordIndex;\n      return helpers.point(\n        coords[multiFeatureIndex][geometryIndex][coordIndex],\n        properties,\n        options\n      );\n  }\n  throw new Error(\"geojson is invalid\");\n}\n\nexports.coordAll = coordAll;\nexports.coordEach = coordEach;\nexports.coordReduce = coordReduce;\nexports.featureEach = featureEach;\nexports.featureReduce = featureReduce;\nexports.findPoint = findPoint;\nexports.findSegment = findSegment;\nexports.flattenEach = flattenEach;\nexports.flattenReduce = flattenReduce;\nexports.geomEach = geomEach;\nexports.geomReduce = geomReduce;\nexports.lineEach = lineEach;\nexports.lineReduce = lineReduce;\nexports.propEach = propEach;\nexports.propReduce = propReduce;\nexports.segmentEach = segmentEach;\nexports.segmentReduce = segmentReduce;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar meta_1 = require(\"@turf/meta\");\n/**\n * Takes a set of features, calculates the bbox of all input features, and returns a bounding box.\n *\n * @name bbox\n * @param {GeoJSON} geojson any GeoJSON object\n * @returns {BBox} bbox extent in [minX, minY, maxX, maxY] order\n * @example\n * var line = turf.lineString([[-74, 40], [-78, 42], [-82, 35]]);\n * var bbox = turf.bbox(line);\n * var bboxPolygon = turf.bboxPolygon(bbox);\n *\n * //addToMap\n * var addToMap = [line, bboxPolygon]\n */\nfunction bbox(geojson) {\n    var result = [Infinity, Infinity, -Infinity, -Infinity];\n    meta_1.coordEach(geojson, function (coord) {\n        if (result[0] > coord[0]) {\n            result[0] = coord[0];\n        }\n        if (result[1] > coord[1]) {\n            result[1] = coord[1];\n        }\n        if (result[2] < coord[0]) {\n            result[2] = coord[0];\n        }\n        if (result[3] < coord[1]) {\n            result[3] = coord[1];\n        }\n    });\n    return result;\n}\nbbox[\"default\"] = bbox;\nexports.default = bbox;\n", "var rbush = require('rbush');\nvar helpers = require('@turf/helpers');\nvar meta = require('@turf/meta');\nvar turfBBox = require('@turf/bbox').default;\nvar featureEach = meta.featureEach;\nvar coordEach = meta.coordEach;\nvar polygon = helpers.polygon;\nvar featureCollection = helpers.featureCollection;\n\n/**\n * GeoJSON implementation of [RBush](https://github.com/mourner/rbush#rbush) spatial index.\n *\n * @name rbush\n * @param {number} [maxEntries=9] defines the maximum number of entries in a tree node. 9 (used by default) is a\n * reasonable choice for most applications. Higher value means faster insertion and slower search, and vice versa.\n * @returns {RBush} GeoJSON RBush\n * @example\n * var geojsonRbush = require('geojson-rbush').default;\n * var tree = geojsonRbush();\n */\nfunction geojsonRbush(maxEntries) {\n    var tree = new rbush(maxEntries);\n    /**\n     * [insert](https://github.com/mourner/rbush#data-format)\n     *\n     * @param {Feature} feature insert single GeoJSON Feature\n     * @returns {RBush} GeoJSON RBush\n     * @example\n     * var poly = turf.polygon([[[-78, 41], [-67, 41], [-67, 48], [-78, 48], [-78, 41]]]);\n     * tree.insert(poly)\n     */\n    tree.insert = function (feature) {\n        if (feature.type !== 'Feature') throw new Error('invalid feature');\n        feature.bbox = feature.bbox ? feature.bbox : turfBBox(feature);\n        return rbush.prototype.insert.call(this, feature);\n    };\n\n    /**\n     * [load](https://github.com/mourner/rbush#bulk-inserting-data)\n     *\n     * @param {FeatureCollection|Array<Feature>} features load entire GeoJSON FeatureCollection\n     * @returns {RBush} GeoJSON RBush\n     * @example\n     * var polys = turf.polygons([\n     *     [[[-78, 41], [-67, 41], [-67, 48], [-78, 48], [-78, 41]]],\n     *     [[[-93, 32], [-83, 32], [-83, 39], [-93, 39], [-93, 32]]]\n     * ]);\n     * tree.load(polys);\n     */\n    tree.load = function (features) {\n        var load = [];\n        // Load an Array of Features\n        if (Array.isArray(features)) {\n            features.forEach(function (feature) {\n                if (feature.type !== 'Feature') throw new Error('invalid features');\n                feature.bbox = feature.bbox ? feature.bbox : turfBBox(feature);\n                load.push(feature);\n            });\n        } else {\n            // Load a FeatureCollection\n            featureEach(features, function (feature) {\n                if (feature.type !== 'Feature') throw new Error('invalid features');\n                feature.bbox = feature.bbox ? feature.bbox : turfBBox(feature);\n                load.push(feature);\n            });\n        }\n        return rbush.prototype.load.call(this, load);\n    };\n\n    /**\n     * [remove](https://github.com/mourner/rbush#removing-data)\n     *\n     * @param {Feature} feature remove single GeoJSON Feature\n     * @param {Function} equals Pass a custom equals function to compare by value for removal.\n     * @returns {RBush} GeoJSON RBush\n     * @example\n     * var poly = turf.polygon([[[-78, 41], [-67, 41], [-67, 48], [-78, 48], [-78, 41]]]);\n     *\n     * tree.remove(poly);\n     */\n    tree.remove = function (feature, equals) {\n        if (feature.type !== 'Feature') throw new Error('invalid feature');\n        feature.bbox = feature.bbox ? feature.bbox : turfBBox(feature);\n        return rbush.prototype.remove.call(this, feature, equals);\n    };\n\n    /**\n     * [clear](https://github.com/mourner/rbush#removing-data)\n     *\n     * @returns {RBush} GeoJSON Rbush\n     * @example\n     * tree.clear()\n     */\n    tree.clear = function () {\n        return rbush.prototype.clear.call(this);\n    };\n\n    /**\n     * [search](https://github.com/mourner/rbush#search)\n     *\n     * @param {BBox|FeatureCollection|Feature} geojson search with GeoJSON\n     * @returns {FeatureCollection} all features that intersects with the given GeoJSON.\n     * @example\n     * var poly = turf.polygon([[[-78, 41], [-67, 41], [-67, 48], [-78, 48], [-78, 41]]]);\n     *\n     * tree.search(poly);\n     */\n    tree.search = function (geojson) {\n        var features = rbush.prototype.search.call(this, this.toBBox(geojson));\n        return featureCollection(features);\n    };\n\n    /**\n     * [collides](https://github.com/mourner/rbush#collisions)\n     *\n     * @param {BBox|FeatureCollection|Feature} geojson collides with GeoJSON\n     * @returns {boolean} true if there are any items intersecting the given GeoJSON, otherwise false.\n     * @example\n     * var poly = turf.polygon([[[-78, 41], [-67, 41], [-67, 48], [-78, 48], [-78, 41]]]);\n     *\n     * tree.collides(poly);\n     */\n    tree.collides = function (geojson) {\n        return rbush.prototype.collides.call(this, this.toBBox(geojson));\n    };\n\n    /**\n     * [all](https://github.com/mourner/rbush#search)\n     *\n     * @returns {FeatureCollection} all the features in RBush\n     * @example\n     * tree.all()\n     */\n    tree.all = function () {\n        var features = rbush.prototype.all.call(this);\n        return featureCollection(features);\n    };\n\n    /**\n     * [toJSON](https://github.com/mourner/rbush#export-and-import)\n     *\n     * @returns {any} export data as JSON object\n     * @example\n     * var exported = tree.toJSON()\n     */\n    tree.toJSON = function () {\n        return rbush.prototype.toJSON.call(this);\n    };\n\n    /**\n     * [fromJSON](https://github.com/mourner/rbush#export-and-import)\n     *\n     * @param {any} json import previously exported data\n     * @returns {RBush} GeoJSON RBush\n     * @example\n     * var exported = {\n     *   \"children\": [\n     *     {\n     *       \"type\": \"Feature\",\n     *       \"geometry\": {\n     *         \"type\": \"Point\",\n     *         \"coordinates\": [110, 50]\n     *       },\n     *       \"properties\": {},\n     *       \"bbox\": [110, 50, 110, 50]\n     *     }\n     *   ],\n     *   \"height\": 1,\n     *   \"leaf\": true,\n     *   \"minX\": 110,\n     *   \"minY\": 50,\n     *   \"maxX\": 110,\n     *   \"maxY\": 50\n     * }\n     * tree.fromJSON(exported)\n     */\n    tree.fromJSON = function (json) {\n        return rbush.prototype.fromJSON.call(this, json);\n    };\n\n    /**\n     * Converts GeoJSON to {minX, minY, maxX, maxY} schema\n     *\n     * @private\n     * @param {BBox|FeatureCollection|Feature} geojson feature(s) to retrieve BBox from\n     * @returns {Object} converted to {minX, minY, maxX, maxY}\n     */\n    tree.toBBox = function (geojson) {\n        var bbox;\n        if (geojson.bbox) bbox = geojson.bbox;\n        else if (Array.isArray(geojson) && geojson.length === 4) bbox = geojson;\n        else if (Array.isArray(geojson) && geojson.length === 6) bbox = [geojson[0], geojson[1], geojson[3], geojson[4]];\n        else if (geojson.type === 'Feature') bbox = turfBBox(geojson);\n        else if (geojson.type === 'FeatureCollection') bbox = turfBBox(geojson);\n        else throw new Error('invalid geojson')\n\n        return {\n            minX: bbox[0],\n            minY: bbox[1],\n            maxX: bbox[2],\n            maxY: bbox[3]\n        };\n    };\n    return tree;\n}\n\nmodule.exports = geojsonRbush;\nmodule.exports.default = geojsonRbush;\n", "/**\n * @module @mappedin/mappedin-js\n */\nimport MapData, { getMapDataInternal } from './map-data';\nimport type {\n\tTEvents,\n\tTMapDataEvents,\n\tTStateChangedInternalPayload,\n\tTEventPayload,\n\tTClickPayload,\n\tTHoverPayload,\n\tTFloorChangeReason,\n\tCameraBounds,\n} from './events';\nimport type {\n\tTGetMapDataOptions,\n\tTGetMapDataWithAccessTokenOptions,\n\tTGetMapDataWithCredentialsOptions,\n\tTGetMapDataSharedOptions,\n\tTGetVenueBundleOptions,\n\tLocalePackUrls,\n\tEnvironment,\n\tTSearchOptions,\n} from '../../packages/mvf-utils';\n\nimport {\n\tdownloadMVF,\n\tdownloadVenueBundleMVFAPIGateway,\n\tgetAccessToken,\n\tparseMVF,\n\tunzipMVF,\n} from '@packages/internal/mvf-utils';\nimport type { Floor } from './map-data-objects';\nimport { MapDataInternal } from './map-data-objects';\nimport type {\n\tParsedMVF as TMVF,\n\tStyleCollection as TMVFStyleCollection,\n\tStyle as TMVFStyle,\n\tLineStringStyle as TMVFLineStringStyle,\n\tPolygonStyle as TMVFPolygonStyle,\n\tPointStyle as TMVFPointStyle,\n\tOperationHours,\n\tSiblingGroup,\n\tLocationState,\n} from '@mappedin/mvf-v2';\nimport { MapView } from './map-view';\nimport type {\n\tInsetPadding,\n\tInsetPaddingOption,\n\tShading,\n\tPaintStyle,\n\tLineStyle,\n\tAddText3DOptions,\n\tInitializeText3DState,\n\tEnvMapOptions,\n\tMapViewState,\n\tInitializeModelState,\n\tWatermarkUpdateOptions,\n\tInterpolation,\n\tLabelAppearance,\n\tLabelTextPlacement,\n\tColorString,\n\tInterpolateOn,\n} from '../../geojson/src';\nimport {\n\tcollisionWorkerUrl,\n\tcreateRenderer,\n\tenableTestMode,\n\tmaplibreWorkerUrl,\n\tpreloadFont,\n\tANIMATION_TWEENS,\n} from '../../geojson/src';\nexport type { PubSub } from '@packages/internal/common/pubsub';\nimport { decodeAccessToken, Logger } from '@packages/internal/common';\nexport type { MappedinError, MappedinRenderError } from '@packages/internal/common/errors';\nimport { handleShow3DMapOptionDefault, validateOptions } from './utils';\nimport type { AnalyticsUpdateOptions } from './analytics';\nimport type { LanguagePackHydrationItem, TImagePlacementOptions, TMultiFloorViewOptions } from './types';\nimport { handleTokenCapabilities } from './utils/options';\nimport { ENTERPRISE_API_AUDIENCE, MAPPEDIN_COLORS } from './constants';\nimport { createEnvControl, getBuildingIds, unzipAndParseMVFv2 } from '@packages/internal/mvf-utils/mvf-utils';\nimport { TokenManager } from '@packages/internal/mvf-utils/tokens/token-manager';\nimport { hydrateMapData, type THydrateMapDataBundle } from './hydrate-map-data';\nexport { disableText3DWorker } from './api-geojson/text3d';\n\n// Re-export for public API\nexport { hydrateMapData, type THydrateMapDataBundle };\n\n/**\n * TODO: We should glob import these styles. Unfortunately, esbuild-plugin-sass doesn't\n * support ignore patterns, so it will try to process a glob import like \"*.scss\" and\n * fail to build.\n */\nimport { injectCSS } from './utils/inject-css';\nimport navigationStyle from './styles/navigation.scss?raw';\nimport markerStyle from '../../geojson/src/styles/marker.scss?raw';\nimport collisionsStyle from '../../geojson/src/styles/collisions.scss?raw';\nimport interactionsStyle from '../../geojson/src/styles/interactions.scss?raw';\nimport htmlControlsStyle from '../../geojson/src/styles/html-controls.scss?raw';\nimport maplibreStyle from '../../packages/outdoor-context-v5/css/maplibre-gl.css?raw';\nconst styles = [navigationStyle, markerStyle, collisionsStyle, interactionsStyle, htmlControlsStyle, maplibreStyle];\n\nexport { setLoggerLevel, E_SDK_LOG_LEVEL } from '@packages/internal/common/Mappedin.Logger';\n\nlet CUSTOM_WATERMARK_ON_CLICK_FN: () => void | undefined;\n/**\n * @internal\n * @hidden\n * Must be called before {@link show3dMap}\n */\nexport function __setWatermarkOnClickFn(fn: () => void) {\n\t// Our internal applications set custom on click functions for the watermark.\n\t// We don't really want customers to do this, so lets try to keep this as hidden as possible.\n\tCUSTOM_WATERMARK_ON_CLICK_FN = fn;\n}\n\n/**\n * Represents all the available antialiasing options.\n */\ntype TAntialiasingOptions = {\n\t/**\n\t * Enable antialiasing. Only works when device supports WebGL2.\n\t *\n\t * @default true\n\t */\n\tenabled?: boolean;\n\n\t/**\n\t * Change the quality of antialiasing in the scene. Greater quality means less noise, but worse performance.\n\t *\n\t * @default 'medium'\n\t */\n\tquality?: 'low' | 'medium' | 'high' | 'ultra';\n};\n\n/**\n * @interface\n * Options for the watermark.\n */\nexport type TWatermarkOptions = WatermarkUpdateOptions;\n\n/**\n * Options for showing a 3D map.\n *\n * @experimental\n */\ntype TShow3DMapOptions = {\n\t/**\n\t * The outdoor view options.\n\t */\n\toutdoorView?: {\n\t\t/**\n\t\t * The token is used to fetch outdoor tiles, which will then be rendered.\n\t\t */\n\t\ttoken?: string;\n\t\t/**\n\t\t * A url to a style specification conforming to the [Maplibre Style Spec](https://maplibre.org/maplibre-style-spec/).\n\t\t * Use the {@link Environment | `environment`} setting to switch environments.\n\t\t */\n\t\tstyle?: string;\n\t\t/**\n\t\t * Enable or disable the outdoor view.\n\t\t * @default true\n\t\t */\n\t\tenabled?: boolean;\n\t\t/**\n\t\t * Layers that should be hidden by geometry. This is useful when you want to hide certain layers when they are below the geometry.\n\t\t * @default ['building', 'building-top']\n\t\t */\n\t\tlayersHiddenByGeometry?: string[];\n\n\t\t/**\n\t\t * Reduces the pixel ratio for MapLibre rendering to improve framerate performance.\n\t\t * When enabled, the rendering quality will be lower but performance will be better,\n\t\t * which can be useful on devices with high-DPI displays or limited GPU capabilities.\n\t\t *\n\t\t * @default false\n\t\t */\n\t\tlowDpi?: boolean;\n\t};\n\n\t/**\n\t * The initial bearing of the map, in degrees.\n\t *\n\t * @default 0\n\t */\n\tbearing?: number;\n\n\t/**\n\t * The initial pitch of the map, in degrees.\n\t *\n\t * @default 45\n\t */\n\tpitch?: number;\n\n\t/**\n\t * The initial zoom level of the map, in mercator zoom levels.\n\t * If it is not specified, it will default to the level that fits the map bounds.\n\t */\n\tzoomLevel?: number;\n\n\t/**\n\t * The screen offsets of the map, in screen pixels.\n\t */\n\tscreenOffsets?: InsetPadding;\n\n\t/**\n\t * Antialiasing settings.\n\t *\n\t * @hidden\n\t * @default true\n\t */\n\tantialiasing?: boolean | TAntialiasingOptions;\n\n\t/**\n\t * @experimental\n\t *\n\t * Enable debug mode to check the visual representation of performance stats.\n\t * @default false\n\t */\n\tdebug?: boolean;\n\n\t/**\n\t * Options when showing the watermark.\n\t *\n\t * @hidden\n\t */\n\twatermark?: TWatermarkOptions;\n\n\t/**\n\t * Options for the attribution control.\n\t *\n\t * @hidden\n\t */\n\tattribution?: {\n\t\t/**\n\t\t * Custom attribution content.\n\t\t */\n\t\tcustom?: string[];\n\t\t/**\n\t\t * Attribution position.\n\t\t * @default 'bottom-right'\n\t\t */\n\t\tposition?: 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right';\n\t\t/**\n\t\t * Whether to show a feedback link next to the attributions.\n\t\t * @default true\n\t\t */\n\t\tfeedback?: boolean;\n\t};\n\n\t/**\n\t * First floor to be rendered.\n\t * By default, floor with the elevation that's closest to 0 is rendered. All floors will be sorted by elevation in ascending order.\n\t */\n\tinitialFloor?: Floor | string;\n\n\t/**\n\t * Enable shading of bottoms of geometry along with outlines to make geometry stand out.\n\t * @default true\n\t * @deprecated Use `style.shading`.\n\t */\n\tshadingAndOutlines?: boolean;\n\n\t/**\n\t * Specify a color for the top of wall geometry.\n\t * @deprecated Use `style.wallTopColor`.\n\t */\n\twallTopColor?: string;\n\n\t/**\n\t * Style options for the map.\n\t * @experimental\n\t */\n\tstyle?: {\n\t\t/**\n\t\t * Background color. Only relevant if outdoor map is disabled.\n\t\t */\n\t\tbackgroundColor?: string;\n\n\t\t/**\n\t\t * Background alpha value. Only relevant if outdoor map is disabled.\n\t\t */\n\t\tbackgroundAlpha?: number;\n\t\t/**\n\t\t * Set the global shading for all elements. True will use default values, false will disable shading.\n\t\t * @default true\n\t\t */\n\t\tshading?: boolean | Shading;\n\t\t/**\n\t\t * Set the global outlines for all elements. True will enable outlines, false will disable them.\n\t\t * @default true\n\t\t */\n\t\toutlines?: boolean;\n\t\t/**\n\t\t * Specify a color for the top of wall geometry.\n\t\t */\n\t\twallTopColor?: string;\n\t};\n\n\t/**\n\t * Options for controlling multi-floor view.\n\t */\n\tmultiFloorView?: TMultiFloorViewOptions;\n\n\t/**\n\t * @experimental\n\t * @internal\n\t */\n\timagePlacementOptions?: TImagePlacementOptions;\n\n\t/**\n\t * Enable or disable the flip of images to face the camera.\n\t * @default true\n\t */\n\tflipImagesToFaceCamera?: boolean;\n\n\t/**\n\t * Automatically inject necessary styles into the document head. If `false`, the `index.css` file needs to be manually imported.\n\t *\n\t * ```ts\n\t * import '@mappedin/mappedin-js/lib/index.css';\n\t * ...\n\t * await show3dMap(...);\n\t * ```\n\t *\n\t * @default true\n\t */\n\tinjectStyles?: boolean;\n\n\t/**\n\t * @hidden\n\t * @internal\n\t */\n\tonWebGLContextCreationError?: (event: Event) => void;\n\n\t/**\n\t * @hidden\n\t * @internal\n\t */\n\tonWebGLContextLost?: (event: Event) => void;\n\n\t/**\n\t * @hidden\n\t * @internal\n\t */\n\tonWebGLContextRestored?: (event: Event) => void;\n\n\t/**\n\t * @hidden\n\t * @internal\n\t */\n\tonWebGLRendererError?: (error: Error) => void;\n\n\t/**\n\t * @experimental\n\t * @internal\n\t *\n\t * If true, the map will use a standalone camera for rendering instead of syncing with MapLibre's camera.\n\t * This enables environment map reflections to update with camera movement in interleaved and overlay modes.\n\t * Note: This disables building occlusion since the depth buffer is no longer synchronized with MapLibre.\n\t *\n\t * @default false\n\t */\n\tuseStandaloneCamera?: boolean;\n\n\t/**\n\t *\n\t * Preload floors for the map. Allows floors to appear faster but requires more time and memory up front.\n\t */\n\tpreloadFloors?: Floor[];\n\n\t/**\n\t * If true, the map will not use web workers. This will turn off outdoor context, and may negatively impact performance of labels and markers.\n\t * @internal\n\t *\n\t * \u26A0\uFE0F **WARNING**: Setting this to true is not recommended and should only be used for environments where the CSP does not allow web workers.\n\t * Disabling web workers may significantly degrade performance and disable outdoor map functionality.\n\t * @default false\n\t */\n\tdisableWorkers?: boolean;\n};\n\n/**\n * @internal\n * @deprecated Use {@link hydrateMapData} instead.\n *\n * Returns a {@link MapData} instance from a parsed MVF object.\n */\nexport const hydrateMapDataFromMVF = async (\n\tmvf: TMVF,\n\toptions?: TGetMapDataWithCredentialsOptions & { languagePacks?: LanguagePackHydrationItem[] },\n): Promise<MapData> => {\n\tlet accessToken: string | undefined;\n\n\tconst env = createEnvControl();\n\tif (options) {\n\t\tenv.updateByUserOption(options);\n\t}\n\ttry {\n\t\tif (options) {\n\t\t\tconst tokenData = await getAccessToken({\n\t\t\t\t...options,\n\t\t\t\tbaseAuthUri: env.getBaseAuthUri(),\n\t\t\t});\n\t\t\taccessToken = tokenData.accessToken;\n\t\t}\n\t} catch (e) {\n\t\tLogger.warn('Getting access token failed. Outdoor map disabled.', e);\n\t}\n\n\tconst mapDataInternal = new MapDataInternal(mvf, {\n\t\toutdoorViewToken: accessToken,\n\t\tlanguagePacks: options?.languagePacks,\n\t\tenv,\n\t});\n\tconst mapData = new MapData(mapDataInternal);\n\n\treturn mapData;\n};\n\nlet USE_ENTERPRISE_API = false;\n/**\n * @internal\n * @deprecated Use {@link getMapData} and enterprise will be inferred from key/secret.\n */\nexport function setUseEnterpriseAPI(value: boolean) {\n\tUSE_ENTERPRISE_API = value;\n}\n\nlet FORCE_ENTERPRISE_LOCATIONS = false;\n/**\n * @internal\n * @hidden\n *\n * If true, the SDK will create enterprise locations in addition to location profiles. Use this to allow\n * legacy applications to load platform maps.\n */\nexport function forceEnterpriseLocations(value: boolean) {\n\tFORCE_ENTERPRISE_LOCATIONS = value;\n}\n\n/**\n * @hidden\n * @internal\n *\n * See {@link forceEnterpriseLocations}\n */\nexport function shouldForceEnterpriseLocations() {\n\treturn FORCE_ENTERPRISE_LOCATIONS;\n}\n\n/**\n * Asynchronously retrieves map data ({@link MapData}) based on user-provided options.\n *\n * @experimental\n * @param userOptions {TGetMapDataOptions} Options provided by the user to retrieve map data.\n * @returns {Promise<MapData>} Promise resolving to the MapData.\n * @example\n * const data = await getMapData({ key: 'api_key', secret: 'api_secret', mapId: 'id' });\n */\nexport const getMapData = async (userOptions: TGetMapDataOptions): Promise<MapData> => {\n\tlet enterprise = USE_ENTERPRISE_API;\n\tlet accessToken: string;\n\tconst env = createEnvControl();\n\tenv.updateByUserOption(userOptions);\n\tconst userOptionsWithDefaults: TGetMapDataOptions = {\n\t\tprefetchTokens: true,\n\t\t...userOptions,\n\t\tfallbackToNavigatorLanguage: userOptions.fallbackToNavigatorLanguage ?? true,\n\t};\n\n\tconst tokenManager = new TokenManager([userOptionsWithDefaults.mapId], userOptionsWithDefaults);\n\tif ('accessToken' in userOptionsWithDefaults && userOptionsWithDefaults.accessToken) {\n\t\taccessToken = userOptionsWithDefaults.accessToken;\n\t\tconst { aud, sub } = decodeAccessToken(accessToken);\n\t\tif (ENTERPRISE_API_AUDIENCE.some(audience => aud.includes(audience)) || (sub && sub.startsWith('client'))) {\n\t\t\tenterprise = true;\n\t\t\tenv.setEnterprise(enterprise);\n\t\t\ttokenManager.setEnterprise(enterprise);\n\t\t}\n\t} else if ('key' in userOptionsWithDefaults && 'secret' in userOptionsWithDefaults) {\n\t\tif (userOptionsWithDefaults.key.startsWith('mipk_')) {\n\t\t\tthrow new Error(\n\t\t\t\t'Partner API keys detected! \\n\\nPartner API keys should not be passed directly to the SDK. See https://developer.mappedin.com/docs/rest-apis/partner for more details.',\n\t\t\t);\n\t\t} else if (!userOptionsWithDefaults.key.startsWith('mik_')) {\n\t\t\tenterprise = true;\n\t\t\tenv.setEnterprise(enterprise);\n\t\t\ttokenManager.setEnterprise(enterprise);\n\t\t}\n\t\tuserOptionsWithDefaults.baseAuthUri = env.getBaseAuthUri();\n\t\tlet tokenData: Awaited<ReturnType<typeof tokenManager.getAccessTokenAsync>>;\n\t\ttry {\n\t\t\ttokenData = await tokenManager.getAccessTokenAsync();\n\t\t\taccessToken = tokenData?.token;\n\t\t} catch (e: any) {\n\t\t\tLogger.warn('Get access token failed', e.message);\n\t\t\tthrow new Error('Get access token failed: ' + e.message);\n\t\t}\n\t} else {\n\t\tthrow new Error('Missing key or secret.');\n\t}\n\n\tif (userOptionsWithDefaults.layoutId != null) {\n\t\tif (!enterprise) {\n\t\t\t// TODO: Remove this check once multi-layout is supported\n\t\t\tLogger.warn('layoutId is currently unsupported!');\n\t\t} else if (userOptionsWithDefaults.layoutId !== 'draft') {\n\t\t\tLogger.warn('Invalid layoutId! Use \"draft\" to load draft data or leave unspecified to load live data.');\n\t\t}\n\t}\n\n\tuserOptionsWithDefaults.baseUri = env.getBaseUri();\n\n\tconst beforeDownload = performance.now();\n\tlet data: Uint8Array;\n\tlet localePacks: LocalePackUrls | undefined;\n\tif (enterprise) {\n\t\tconst venueOptions: TGetVenueBundleOptions = {\n\t\t\t...userOptionsWithDefaults,\n\t\t\tvenue: userOptionsWithDefaults.mapId,\n\t\t\t// @ts-expect-error\n\t\t\tclientId: userOptionsWithDefaults.key,\n\t\t\t// @ts-expect-error\n\t\t\tclientSecret: userOptionsWithDefaults.secret,\n\t\t\tversion: '1.0.0',\n\t\t\tperspective: userOptionsWithDefaults.viewId,\n\t\t\tuseDraftData: userOptionsWithDefaults.layoutId === 'draft',\n\t\t};\n\t\tconst result = await downloadVenueBundleMVFAPIGateway(venueOptions);\n\t\tdata = result.compressed;\n\t\tlocalePacks = result.localePacks;\n\t} else {\n\t\tdata = await downloadMVF(userOptionsWithDefaults, accessToken);\n\t}\n\tconst postDownload = performance.now();\n\tconst mvf = await unzipAndParseMVFv2(data, userOptionsWithDefaults.mvfVersion);\n\tconst postParse = performance.now();\n\n\tif (typeof userOptions.onMVFParsed === 'function') {\n\t\tuserOptions.onMVFParsed(mvf);\n\t}\n\n\tconst floorStackIds = getBuildingIds(mvf);\n\tif (floorStackIds.length > 0) {\n\t\ttokenManager.setMapIds(floorStackIds);\n\t} else {\n\t\ttokenManager.setMapIds([userOptionsWithDefaults.mapId]);\n\t}\n\n\tif (userOptionsWithDefaults.prefetchTokens) {\n\t\ttry {\n\t\t\tawait tokenManager.readySync();\n\t\t} catch (e) {\n\t\t\tLogger.error('Failed to ready token manager!', e);\n\t\t}\n\t}\n\n\tif (shouldForceEnterpriseLocations()) {\n\t\tif (enterprise) {\n\t\t\tLogger.warn('forceEnterpriseLocations is enabled, but the map is already an enterprise map!');\n\t\t}\n\n\t\tif (userOptionsWithDefaults.mvfVersion !== '3.0.0') {\n\t\t\tLogger.warn(\"mvfVersion must be '3.0.0' when forceEnterpriseLocations is enabled!\");\n\t\t}\n\t}\n\n\tconst mapDataInternal = new MapDataInternal(mvf, {\n\t\tenv,\n\t\toutdoorViewToken: accessToken,\n\t\ttokenManager,\n\t\tenterprise,\n\t\tlocalePacksUrls: localePacks,\n\t\tbinaryBundle: data,\n\t\tgetMapDataOptions: userOptionsWithDefaults,\n\t});\n\tconst mapData = new MapData(mapDataInternal, { search: userOptions.search });\n\tmapDataInternal.Analytics.init({\n\t\taccessToken,\n\t\tmapId: userOptionsWithDefaults.mapId,\n\t\tkey: 'key' in userOptionsWithDefaults ? userOptionsWithDefaults.key : undefined,\n\t\tsecret: 'secret' in userOptionsWithDefaults ? userOptionsWithDefaults.secret : undefined,\n\t\t...userOptionsWithDefaults.analytics,\n\t\tbaseUri: env.getAnalyticsBaseUri(),\n\t\tcontext: userOptionsWithDefaults.analytics?.context as AnalyticsUpdateOptions['context'],\n\t});\n\tmapDataInternal.Analytics.sendGetMapDataEvent({\n\t\tparseDuration: postParse - postDownload,\n\t\tdownloadDuration: postDownload - beforeDownload,\n\t\tviewId: userOptionsWithDefaults.viewId,\n\t});\n\n\tconst language = mapDataInternal.findPreferredLanguage({\n\t\tlanguageCode: userOptionsWithDefaults.language,\n\t\tfallbackToNavigatorLanguage: userOptionsWithDefaults.fallbackToNavigatorLanguage,\n\t});\n\tif (language) {\n\t\ttry {\n\t\t\tawait mapData.changeLanguage(language.code);\n\t\t} catch (e) {\n\t\t\t/* empty */\n\t\t}\n\t}\n\n\treturn mapData;\n};\n\n/**\n * @internal\n * @deprecated Use {@link getMapData} and enterprise will be inferred from key/secret.\n */\nexport const getMapDataEnterprise = getMapData;\n\n/**\n * @internal\n *\n * Note: had to add this here to avoid a circular reference when I put it in options\n * TODO: investigate\n *\n * Check if the worker urls are valid\n * @returns false if workers have not been set, and an object with the worker urls if they are set\n */\nexport const checkWorkerUrls = async () => {\n\tif (collisionWorkerUrl === '' || maplibreWorkerUrl === '') {\n\t\treturn false;\n\t}\n\n\t// we want to enforce same-origin, as the browser will outright reject remote worker URLs\n\tconst promises = [\n\t\tfetch(collisionWorkerUrl, {\n\t\t\tmode: 'same-origin',\n\t\t}),\n\t\tfetch(maplibreWorkerUrl, {\n\t\t\tmode: 'same-origin',\n\t\t}),\n\t];\n\tlet [collisionResponse, maplibreResponse] = [{ ok: false }, { ok: false }];\n\ttry {\n\t\t[collisionResponse, maplibreResponse] = await Promise.all(promises);\n\t} catch (e) {\n\t\t// ignore errors\n\t}\n\n\treturn {\n\t\tcollision: collisionResponse.ok,\n\t\tmaplibre: maplibreResponse.ok,\n\t};\n};\n\nexport const show3dMap = async (el: HTMLElement, mapData: MapData, options?: TShow3DMapOptions): Promise<MapView> => {\n\tconst start = performance.now();\n\tconst optionsWithDefaults = handleShow3DMapOptionDefault(options, mapData);\n\tif (optionsWithDefaults) validateOptions(optionsWithDefaults);\n\n\t// Inject the styles into the document head.\n\tif (optionsWithDefaults.injectStyles ?? true) {\n\t\tinjectCSS(styles, { id: 'mappedin__styles' });\n\t}\n\n\t// Should use the outdoorViewToken and not user provided accessToken.\n\t// Capabilities turn on/off paid features we don't want users to bypass.\n\tconst capabilities = handleTokenCapabilities(mapData.outdoorViewToken ?? '');\n\n\tconst internal = getMapDataInternal(mapData);\n\tif (optionsWithDefaults.outdoorView?.style) {\n\t\tinternal.envControl.updateTileServerBaseUrl(optionsWithDefaults.outdoorView?.style);\n\t}\n\n\tlet disableCollisionWorker = false;\n\tlet disableOutdoors = false;\n\t// let's check if the worker urls are valid\n\tconst workerUrls = await checkWorkerUrls();\n\tif (workerUrls) {\n\t\t// setWorkerURL was called, let's check if the worker urls are properly set up\n\t\tif (!workerUrls.collision) {\n\t\t\t// collision worker url is not valid, let's disable it\n\t\t\tdisableCollisionWorker = true;\n\t\t}\n\t\tif (!workerUrls.maplibre) {\n\t\t\t// maplibre worker url is not valid, let's disable it\n\t\t\tdisableOutdoors = true;\n\t\t}\n\t}\n\n\tconst core = await createRenderer(el, {\n\t\tcenter: [mapData.mapCenter.longitude, mapData.mapCenter.latitude],\n\t\tbearing: optionsWithDefaults.bearing,\n\t\tpitch: optionsWithDefaults.pitch,\n\t\tzoomLevel: optionsWithDefaults.zoomLevel,\n\t\tbackgroundAlpha: optionsWithDefaults.style?.backgroundAlpha,\n\t\tbackgroundColor: optionsWithDefaults.style?.backgroundColor,\n\t\toutdoorView:\n\t\t\t!disableOutdoors && optionsWithDefaults.outdoorView?.token\n\t\t\t\t? {\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t'x-mappedin-tiles-key': optionsWithDefaults.outdoorView?.token,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstyle: mapData.getEnv().tileServerUri,\n\t\t\t\t\t\tenabled: !!optionsWithDefaults.outdoorView?.enabled,\n\t\t\t\t\t\tlowDpi: optionsWithDefaults.outdoorView?.lowDpi,\n\t\t\t\t  }\n\t\t\t\t: undefined,\n\t\twatermark: {\n\t\t\t...optionsWithDefaults.watermark,\n\t\t\tvisible: optionsWithDefaults.watermark?.visible ?? (!internal.enterpriseMode && !capabilities.remove_watermark),\n\t\t\tonClick: CUSTOM_WATERMARK_ON_CLICK_FN || undefined,\n\t\t},\n\t\tattribution: optionsWithDefaults.attribution,\n\t\tantialias:\n\t\t\ttypeof optionsWithDefaults.antialiasing === 'boolean'\n\t\t\t\t? optionsWithDefaults.antialiasing\n\t\t\t\t: Boolean(optionsWithDefaults.antialiasing?.enabled),\n\t\taccessToken: mapData.outdoorViewToken,\n\t\tocclusionEnabled: true,\n\t\ttransformImageRequest: !internal.enterpriseMode ? internal.transformImageRequest : undefined,\n\t\tnaturalBearing: mapData.naturalBearing,\n\t\timagePlacementOptions: optionsWithDefaults.imagePlacementOptions,\n\t\tonWebGLContextCreationError: optionsWithDefaults.onWebGLContextCreationError,\n\t\tonWebGLContextLost: optionsWithDefaults.onWebGLContextLost,\n\t\tonWebGLContextRestored: optionsWithDefaults.onWebGLContextRestored,\n\t\tonWebGLRendererError: optionsWithDefaults.onWebGLRendererError,\n\t\tuseStandaloneCamera: optionsWithDefaults.useStandaloneCamera ?? false,\n\t\tuseWorkers: !(optionsWithDefaults.disableWorkers ?? false),\n\t\tuseCollisionWorker: !disableCollisionWorker,\n\t});\n\n\tconst mapView3d = new MapView(core);\n\n\tawait mapView3d.addMap(mapData, optionsWithDefaults);\n\tinternal.Analytics.sendMapViewLoadedEvent({\n\t\tfirstRenderDuration: performance.now() - start,\n\t\tdimension: mapView3d.getDimensions(),\n\t\tcollisionWorkerDisabled: disableCollisionWorker,\n\t\toutdoorsWorkerDisabled: disableOutdoors,\n\t});\n\n\treturn mapView3d;\n};\n\n/**\n * Returns the package version of the SDK.\n */\nexport const getVersion = () => {\n\treturn process.env.npm_package_version;\n};\n\n/**\n * @internal\n * @deprecated Use {@link show3dMap} instead.\n */\nexport const show3dMapGeojson = show3dMap;\nexport { parseMVF, unzipMVF, enableTestMode, preloadFont, MAPPEDIN_COLORS, ANIMATION_TWEENS };\nexport type {\n\tMapData,\n\tMapViewState,\n\tTEvents,\n\tTMapDataEvents,\n\tTStateChangedInternalPayload,\n\tTEventPayload,\n\tTFloorChangeReason,\n\tCameraBounds,\n\tTClickPayload,\n\tTHoverPayload,\n\tTShow3DMapOptions,\n\tTGetMapDataOptions,\n\tTGetMapDataWithAccessTokenOptions,\n\tTGetMapDataWithCredentialsOptions,\n\tTSearchOptions,\n\tTGetMapDataSharedOptions,\n\tTAntialiasingOptions,\n\tTMVF,\n\tPaintStyle,\n\tLineStyle,\n\tEnvMapOptions,\n\tShading,\n\tTMVFStyleCollection,\n\tTMVFStyle,\n\tTMVFLineStringStyle,\n\tTMVFPolygonStyle,\n\tTMVFPointStyle,\n\tEnvironment,\n\tInsetPadding,\n\tInsetPaddingOption,\n\tOperationHours,\n\tSiblingGroup,\n\tLocationState,\n\tAddText3DOptions,\n\tInitializeText3DState,\n\tInitializeModelState,\n\tInterpolation,\n\tLabelAppearance,\n\tLabelTextPlacement,\n\tColorString,\n\tInterpolateOn,\n};\nexport { MapView } from './map-view';\nexport type * from 'geojson';\nexport type {\n\tTCameraAnimationOptions,\n\tTAnimationOptions,\n\tTFocusOnOptions,\n\tTEasingFunction,\n\tTCameraTarget,\n\tTNavigationTarget,\n\tTDirectionZone,\n\tTAddMarkerOptions,\n\tTAddPathOptions,\n\tTAddLabelOptions,\n\tTAddModelOptions,\n\tTAddModel,\n\tTAddImageOptions,\n\tTGetDirectionsOptions,\n\tTCollisionRankingTier,\n\tTMarkerPlacement,\n\tTDirectionInstruction,\n\tTDirectionInstructionAction,\n\tTFocusTarget,\n\tIFocusable,\n\tIAnchorable,\n\tTMapDataObjectTypes,\n\tTSetFloorOptions,\n\tTCancellablePromise,\n\tTAnimateStateResult,\n\tGlobalState,\n\tTActionType,\n\tTBearingType,\n\tTConnectionType,\n\tTMultiFloorViewOptions,\n\tMapViewElements,\n\tMapDataElements,\n\tMapElementsWithState,\n\tTGetState,\n\tTUpdateState,\n\tTTakeScreenshotOptions,\n} from './types';\nexport type {\n\tTModelState,\n\tTModelUpdateState,\n\tTLabelState,\n\tTLabelUpdateState,\n\tTMarkerState,\n\tTMarkerUpdateState,\n\tTPathState,\n\tTPathUpdateState,\n\tTShapeState,\n\tTShapeUpdateState,\n\tTText3DState,\n\tTText3DUpdateState,\n\tTWallsState,\n\tTWallsUpdateState,\n\tTDoorsState,\n\tTDoorsUpdateState,\n\tTFacadeState,\n\tTFacadeUpdateState,\n\tTFloorState,\n\tTFloorUpdateState,\n\tTGeometryState,\n\tTGeometryUpdateState,\n\tTImage3DState as TImageState,\n\tTImage3DUpdateState as TImageUpdateState,\n\tMapElementToGetState,\n\tMapElementToUpdateState,\n} from './states';\nexport { WALLS, DOORS, ACTION_TYPE, BEARING_TYPE, CONNECTION_TYPE } from './types';\nexport type {\n\tLabel,\n\tMarker,\n\tPath,\n\tPathSegment,\n\tShape,\n\tCameraTransform,\n\tModel,\n\tImage3DView,\n\tText3DView,\n} from './map-view-objects';\nexport type { Debug } from './debug';\n// Export the full classes so the .is(...) methods can be used\nexport type { Navigation, TNavigationOptions } from './navigation';\nexport type { TSpaceType } from './map-data-objects';\nexport {\n\tCoordinate,\n\tAnnotation,\n\tConnection,\n\tDoor,\n\tFloor,\n\tFloorStack,\n\tMapObject,\n\tPointOfInterest,\n\tSpace,\n\tImageMetaData,\n\tHyperlink,\n\tEnterpriseLocation,\n\tEnterpriseCategory,\n\tEnterpriseVenue,\n\tLocationProfile,\n\tLocationCategory,\n\tFacade,\n\tNode,\n\tArea,\n\ttype Places,\n\ttype OpeningHours,\n} from './map-data-objects';\n\nexport { setWorkersUrl } from './api-geojson/api';\nexport { findPreferredLanguageInVenue } from './api-geojson/language';\nexport type { TFindPreferredLanguageInVenueOptions } from './api-geojson/language';\nexport type {\n\tCamera,\n\tModels,\n\tLabels,\n\tMarkers,\n\tPaths,\n\tExporter,\n\tStyle,\n\tShapes,\n\tOutdoor,\n\tImage3D,\n\tText3D,\n} from './api-geojson';\nexport { Directions } from './api-geojson/directions/directions';\nexport type {\n\tSearchResult,\n\tSearchResultItem,\n\tSearchResultEnterpriseCategory,\n\tSearchResultEnterpriseLocations,\n\tSearchResultPlaces,\n\tSearchOptions,\n\tSearch,\n\tSuggestion,\n\tMatchInfo,\n} from './search';\nexport type { TFindNearestOptions, TFindNearestResult, TQueriables, Query } from './query';\n\nexport type { Analytics, TAnalyticsUpdateState } from './analytics';\nexport type { NavigationState } from './navigation';\nexport { unzipAndParseMVFv2 };\n\n// Multi-floor utilities for dynamic-focus package\nexport { getMultiFloorState } from './api-geojson/multi-floor';\nexport type { VisibilityState } from './api-geojson/multi-floor';\n//\n", "import { Analytics } from './analytics';\nimport { PubSub } from '@packages/internal/common/pubsub';\nimport type { TSearchOptions } from '@packages/internal/mvf-utils';\nimport type {\n\tConnection,\n\tDoor,\n\tFloor,\n\tMapDataInternal,\n\tSpace,\n\tMapObject,\n\tPointOfInterest,\n\tAnnotation,\n\tCoordinate,\n\tFloorStack,\n\tNode,\n\tFacade,\n\tArea,\n\tEnterpriseCategory,\n\tEnterpriseLocation,\n\tEnterpriseVenue,\n\tLocationProfile,\n\tLocationCategory,\n} from './map-data-objects';\nimport { Search } from './search';\nimport type { TNavigationTarget, TGetDirectionsOptions, TMapDataObjectTypes, MapDataElements } from './types';\nimport type { Directions } from './api-geojson/directions';\nimport type { Query } from './query';\nimport type { IGeoJSONData } from './map-data-objects/types';\nimport type { TMapDataEvents } from './events';\n\n/**\n * A WeakMap to associate {@link MapData} instances with their internal representation.\n * We need a way to get the internal data object from the API\n *\n * @internal\n */\nexport const MapDataInternalByMapData = new WeakMap<MapData, MapDataInternal>();\n\n/**\n * ## MapData in Mappedin JS\n *\n * MapData is the core data container for all map information, providing access to spaces, floors, points of interest, and navigation capabilities. It serves as the foundation for building interactive indoor mapping applications.\n *\n * ### Features\n * - Access to all map elements (spaces, floors, doors, etc.)\n * - Built-in search functionality with suggestions\n * - Navigation and wayfinding capabilities\n * - Multi-language support\n * - Analytics tracking\n * - Data export and serialization\n *\n * > **Best Practice:** Use `getByType()` to retrieve collections of map elements, and `getById()` for specific elements. Enable search functionality when you need location discovery features.\n *\n * ### Example Usage\n * ```ts\n * // Get all spaces on the map\n * const spaces = mapData.getByType('space');\n *\n * // Find a specific space by ID\n * const space = mapData.getById('space', 'space-123');\n *\n * // Get directions between two locations\n * const directions = mapData.getDirections(space1, space2);\n *\n * // Enable and use search\n * await mapData.Search.enable();\n * const results = await mapData.Search.query('Coffee Shop');\n *\n * // Change language\n * await mapData.changeLanguage('es');\n * ```\n *\n * ### Data Access Patterns\n * - **Collections**: Use `getByType()` for all elements of a type\n * - **Specific Elements**: Use `getById()` for individual elements\n * - **External IDs**: Use `getByExternalId()` for custom identifiers\n * - **GeoJSON**: Use `getGeoJSON()` for geometric data\n *\n * ### Navigation Features\n * - `getDirections()`: Route between two locations\n * - `getDirectionsMultiDestination()`: Route with multiple destinations\n * - `getDistance()`: Calculate distance between locations\n *\n * ### More Information\n * - [Getting Started Guide](https://developer.mappedin.com/web-sdk/getting-started)\n * - [Search Guide](https://developer.mappedin.com/web-sdk/enterprise-data#enterprise-search)\n * - [Wayfinding Guide](https://developer.mappedin.com/web-sdk/wayfinding)\n *\n * Represents the data for a map, providing access to map elements\n * like spaces, floors, and points of interest.\n */\nclass MapData {\n\t#pubSub: PubSub<TMapDataEvents>;\n\t#internal: MapDataInternal;\n\n\tAnalytics: Analytics;\n\t/**\n\t * Search API for MapData\n\t *\n\t * Provides full-text search capabilities across all map locations, with support for suggestions, filtering, and result ranking.\n\t *\n\t * @example Enable search and perform a query\n\t * ```ts\n\t * // Enable search\n\t * const mapData = await getMapData({ search: { enabled: true } });\n\t * // or\n\t * await mapData.Search.enable();\n\t *\n\t * // Perform a search query\n\t * const results = await mapData.Search.query('Coffee Shop');\n\t * console.log(results.locations);\n\t * ```\n\t *\n\t * @example Get search suggestions\n\t * ```ts\n\t * // Get search suggestions\n\t * const suggestions = await mapData.Search.suggest('Coff');\n\t * console.log(suggestions);\n\t * ```\n\t *\n\t * @example Search with filters\n\t * ```ts\n\t * const results = await mapData.Search.query('Shop', {\n\t *   categories: ['retail'],\n\t *   floor: mapData.getByType('floor')[0]\n\t * });\n\t * ```\n\t *\n\t * @see [Search Guide](https://developer.mappedin.com/web-sdk/enterprise-data#enterprise-search)\n\t */\n\tSearch: Search;\n\n\t/**\n\t * Query API for advanced data filtering and retrieval.\n\t *\n\t * Provides powerful querying capabilities to filter and find map elements based on various criteria.\n\t *\n\t * @example\n\t * ```ts\n\t * // Find all spaces with specific properties\n\t * const results = mapData.Query.spaces()\n\t *   .where('category', 'retail')\n\t *   .where('floor', floor)\n\t *   .execute();\n\t * ```\n\t */\n\tQuery: Query;\n\n\t/**\n\t * @internal\n\t */\n\tinternal: MapDataInternal;\n\n\t/**\n\t * Constructs a new instance of {@link MapData}.\n\t *\n\t * @internal\n\t */\n\tconstructor(internal: MapDataInternal, { search }: { search?: TSearchOptions } = {}) {\n\t\tthis.#pubSub = new PubSub<TMapDataEvents>();\n\t\tthis.#internal = internal;\n\t\tMapDataInternalByMapData.set(this, internal);\n\n\t\tthis.Analytics = new Analytics(internal.Analytics);\n\t\tthis.Query = internal.Query;\n\t\tthis.internal = internal;\n\n\t\tthis.Search = new Search(this, internal, { enabled: search?.enabled });\n\t\tthis.#internal.on('language-change', language => {\n\t\t\tthis.#pubSub.publish('language-change', language);\n\t\t});\n\t}\n\n\t/**\n\t * Subscribe to MapData events.\n\t *\n\t * Listen for events emitted by the MapData instance such as language changes.\n\t *\n\t * @param eventName The name of the event to listen for.\n\t * @param fn The callback function to execute when the event is emitted.\n\t *\n\t * @example Listen for language changes\n\t * ```ts\n\t * mapData.on('language-change', ({ code, name }) => {\n\t *   console.log(`Language changed to ${name} (${code})`);\n\t *\n\t *   // Update UI to reflect new language\n\t * \tupdateInterfaceLanguage(code);\n\t * });\n\t * ```\n\t */\n\ton = <EventName extends keyof TMapDataEvents>(\n\t\teventName: EventName,\n\t\tfn: (\n\t\t\tpayload: TMapDataEvents[EventName] extends { data: null }\n\t\t\t\t? TMapDataEvents[EventName]['data']\n\t\t\t\t: TMapDataEvents[EventName],\n\t\t) => void,\n\t) => {\n\t\tthis.#pubSub.on(eventName, fn);\n\t};\n\n\t/**\n\t * Unsubscribe from MapData events.\n\t *\n\t * @param eventName The name of the event to unsubscribe from.\n\t * @param fn The callback function that was previously registered with `on()`.\n\t *\n\t * @example Remove language change listener\n\t * ```ts\n\t * const handleLanguageChange = ({ code, name }) => {\n\t *   console.log(`Language changed to ${name}`);\n\t * };\n\t *\n\t * // Add listener\n\t * mapData.on('language-change', handleLanguageChange);\n\t *\n\t * // Later, remove the listener\n\t * mapData.off('language-change', handleLanguageChange);\n\t * ```\n\t */\n\toff = <EventName extends keyof TMapDataEvents>(\n\t\teventName: EventName,\n\t\tfn: (\n\t\t\tpayload: TMapDataEvents[EventName] extends { data: null }\n\t\t\t\t? TMapDataEvents[EventName]['data']\n\t\t\t\t: TMapDataEvents[EventName],\n\t\t) => void,\n\t) => {\n\t\tthis.#pubSub.off(eventName, fn);\n\t};\n\n\t/**\n\t * Get the current environment configuration.\n\t *\n\t * Returns the environment settings including API endpoints and configuration.\n\t *\n\t * @returns Environment configuration object\n\t * @example\n\t * ```ts\n\t * const env = mapData.getEnv();\n\t * console.log(env.baseUri); // Get the API URL for the current environment\n\t * ```\n\t */\n\tgetEnv() {\n\t\treturn this.#internal.getEnv();\n\t}\n\n\t/**\n\t * Get an access token for use with Mappedin's API.\n\t *\n\t * Returns the current access token that can be used for authenticated API requests.\n\t *\n\t * @returns {string} The current access token\n\t * @example\n\t * ```ts\n\t * const token = mapData.getAccessToken();\n\t * // Use token for API requests\n\t * ```\n\t */\n\tgetAccessToken() {\n\t\treturn this.#internal.tokenManager?.getAccessToken().token;\n\t}\n\n\t/**\n\t * The name of the map.\n\t *\n\t * @returns {string} The name of the map.\n\t * @example\n\t * ```ts\n\t * console.log(mapData.mapName); // \"Downtown Mall\"\n\t * ```\n\t */\n\tget mapName(): string {\n\t\treturn this.#internal.mapName;\n\t}\n\n\t/**\n\t * The unique identifier for the map.\n\t *\n\t * @returns {string | undefined} The map ID.\n\t * @example\n\t * ```ts\n\t * console.log(mapData.mapId); // \"map-12345\"\n\t * ```\n\t */\n\tget mapId(): string | undefined {\n\t\treturn this.#internal.getMapDataOptions?.mapId;\n\t}\n\n\t/**\n\t * The approximate center coordinate ({@link Coordinate}) of the map.\n\t *\n\t * @returns {Coordinate} The center coordinate of the map.\n\t * @example\n\t * ```ts\n\t * const center = mapData.mapCenter;\n\t * console.log(`Map center: ${center.latitude}, ${center.longitude}`);\n\t * ```\n\t */\n\tget mapCenter(): Coordinate {\n\t\treturn this.#internal.mapCenter;\n\t}\n\n\t/**\n\t * The organization ID of the map.\n\t *\n\t * @returns {string} The organization ID of the map.\n\t * @example\n\t * ```ts\n\t * console.log(mapData.organizationId); // \"org-12345\"\n\t * ```\n\t */\n\tget organizationId(): string {\n\t\treturn this.#internal.organizationId;\n\t}\n\n\t/**\n\t * The token used to fetch outdoor tiles for outdoor map integration.\n\t *\n\t * @returns {string | undefined} The outdoor view token.\n\t * @example\n\t * ```ts\n\t * const outdoorToken = mapData.outdoorViewToken;\n\t * if (outdoorToken) {\n\t *   // Configure outdoor map with token\n\t * }\n\t * ```\n\t */\n\tget outdoorViewToken(): string | undefined {\n\t\treturn this.#internal.outdoorViewToken;\n\t}\n\n\t/**\n\t * Retrieves all map elements of a specific type.\n\t *\n\t * This is the primary method for accessing collections of map elements. Use the typed overloads for better TypeScript support.\n\t *\n\t * @param type The type of elements to retrieve.\n\t * @returns An array of elements of the given type.\n\t *\n\t * @example Get all spaces\n\t * ```ts\n\t * const spaces = mapData.getByType('space');\n\t * console.log(`Found ${spaces.length} spaces`);\n\t * ```\n\t *\n\t * @example Get all floors\n\t * ```ts\n\t * const floors = mapData.getByType('floor');\n\t * floors.forEach(floor => console.log(floor.name));\n\t * ```\n\t *\n\t * @example Get all doors\n\t * ```ts\n\t * const doors = mapData.getByType('door');\n\t * const entranceDoors = doors.filter(door => door.type === 'entrance');\n\t * ```\n\t */\n\tgetByType(type: string): MapDataElements[];\n\t/**\n\t * @returns The spaces ({@link Space}) on the map.\n\t * @example\n\t * ```ts\n\t * const spaces = mapData.getByType('space');\n\t * const retailSpaces = spaces.filter(space => space.category === 'retail');\n\t * ```\n\t */\n\tgetByType(type: 'space'): Space[];\n\t/**\n\t * @returns The doors ({@link Door}) on the map.\n\t * @example\n\t * ```ts\n\t * const doors = mapData.getByType('door');\n\t * const entranceDoors = doors.filter(door => door.type === 'entrance');\n\t * ```\n\t */\n\tgetByType(type: 'door'): Door[];\n\t/**\n\t * @returns The floors ({@link Floor}) on the map.\n\t * @example\n\t * ```ts\n\t * const floors = mapData.getByType('floor');\n\t * const groundFloor = floors.find(floor => floor.level === 0);\n\t * ```\n\t */\n\tgetByType(type: 'floor'): Floor[];\n\t/**\n\t * @returns The stacks of floors ({@link FloorStack}) within the map.\n\t * @example\n\t * ```ts\n\t * const floorStacks = mapData.getByType('floor-stack');\n\t * const mainBuilding = floorStacks.find(stack => stack.name === 'Main Building');\n\t * ```\n\t */\n\tgetByType(type: 'floor-stack'): FloorStack[];\n\t/**\n\t * @returns The facades ({@link Facade}) within the map.\n\t * @example\n\t * ```ts\n\t * const facades = mapData.getByType('facade');\n\t * const northFacade = facades.find(facade => facade.name === 'North');\n\t * ```\n\t */\n\tgetByType(type: 'facade'): Facade[];\n\t/**\n\t * @returns The connections ({@link Connection}) on the map.\n\t * @example\n\t * ```ts\n\t * const connections = mapData.getByType('connection');\n\t * const elevators = connections.filter(conn => conn.type === 'elevator');\n\t * ```\n\t */\n\tgetByType(type: 'connection'): Connection[];\n\t/**\n\t * @returns The objects ({@link MapObject}) on the map.\n\t * @example\n\t * ```ts\n\t * const objects = mapData.getByType('object');\n\t * const furniture = objects.filter(obj => obj.category === 'furniture');\n\t * ```\n\t */\n\tgetByType(type: 'object'): MapObject[];\n\t/**\n\t * @returns The points of interest ({@link PointOfInterest}) on the map.\n\t * @example\n\t * ```ts\n\t * const pois = mapData.getByType('point-of-interest');\n\t * const restrooms = pois.filter(poi => poi.category === 'restroom');\n\t * ```\n\t */\n\tgetByType(type: 'point-of-interest'): PointOfInterest[];\n\t/**\n\t * @returns The annotations ({@link Annotation}) on the map.\n\t * @example\n\t * ```ts\n\t * const annotations = mapData.getByType('annotation');\n\t * const infoAnnotations = annotations.filter(ann => ann.type === 'info');\n\t * ```\n\t */\n\tgetByType(type: 'annotation'): Annotation[];\n\t/**\n\t * @returns The nodes ({@link Node}) on the map.\n\t * @example\n\t * ```ts\n\t * const nodes = mapData.getByType('node');\n\t * const navigationNodes = nodes.filter(node => node.type === 'navigation');\n\t * ```\n\t */\n\tgetByType(type: 'node'): Node[];\n\t/**\n\t * @returns The areas ({@link Area}) on the map.\n\t * @example\n\t * ```ts\n\t * const areas = mapData.getByType('area');\n\t * const parkingAreas = areas.filter(area => area.category === 'parking');\n\t * ```\n\t */\n\tgetByType(type: 'area'): Area[];\n\t/**\n\t * @returns The enterprise locations ({@link EnterpriseLocation}) on the map.\n\t * @example\n\t * ```ts\n\t * const locations = mapData.getByType('enterprise-location');\n\t * const stores = locations.filter(loc => loc.category === 'store');\n\t * ```\n\t */\n\tgetByType(type: 'enterprise-location'): EnterpriseLocation[];\n\t/**\n\t * @returns The enterprise categories ({@link EnterpriseCategory}) on the map.\n\t * @example\n\t * ```ts\n\t * const categories = mapData.getByType('enterprise-category');\n\t * const retailCategories = categories.filter(cat => cat.type === 'retail');\n\t * ```\n\t */\n\tgetByType(type: 'enterprise-category'): EnterpriseCategory[];\n\t/**\n\t * @returns The enterprise venues ({@link EnterpriseVenue}) on the map.\n\t * @example\n\t * ```ts\n\t * const venues = mapData.getByType('enterprise-venue');\n\t * const malls = venues.filter(venue => venue.type === 'mall');\n\t * ```\n\t */\n\tgetByType(type: 'enterprise-venue'): EnterpriseVenue | undefined;\n\t/**\n\t * @returns The location profiles ({@link LocationProfile}) on the map.\n\t * @example\n\t * ```ts\n\t * const profiles = mapData.getByType('location-profile');\n\t * const featuredProfiles = profiles.filter(profile => profile.featured);\n\t * ```\n\t */\n\tgetByType(type: 'location-profile'): LocationProfile[];\n\t/**\n\t * @returns The location categories ({@link LocationCategory}) on the map.\n\t * @example\n\t * ```ts\n\t * const categories = mapData.getByType('location-category');\n\t * const mainCategories = categories.filter(cat => cat.parent === null);\n\t * ```\n\t */\n\tgetByType(type: 'location-category'): LocationCategory[];\n\tgetByType(type: string): object[] | object | undefined {\n\t\treturn this.#internal.getByType(type);\n\t}\n\n\t/**\n\t * Retrieves a specific map feature by its type and ID.\n\t *\n\t * Use this method to find individual map elements when you know their exact ID. This is more efficient than filtering collections for specific elements.\n\t *\n\t * @param type The type of element to retrieve.\n\t * @param id The unique identifier of the element.\n\t * @returns The map element if found, undefined otherwise.\n\t *\n\t * @example Find a specific space\n\t * ```ts\n\t * const space = mapData.getById('space', 'space-123');\n\t * if (space) {\n\t *   console.log(`Found space: ${space.name}`);\n\t * }\n\t * ```\n\t *\n\t * @example Find a specific floor\n\t * ```ts\n\t * const floor = mapData.getById('floor', 'floor-1');\n\t * if (floor) {\n\t *   console.log(`Floor level: ${floor.level}`);\n\t * }\n\t * ```\n\t *\n\t * @example Find a door\n\t * ```ts\n\t * const door = mapData.getById('door', 'door-main-entrance');\n\t * if (door) {\n\t *   console.log(`Door type: ${door.type}`);\n\t * }\n\t * ```\n\t *\n\t * @example Find an element by ID when you don't know the type.\n\t *\n\t * In general, it is better to specify the type if you know it, since you get better type safety.\n\t * ```ts\n\t * const element = mapData.getById('unknown', 'element-123');\n\t * if (!element) {\n\t *   console.log(`Element not found`);\n\t * } else if (Space.is(element)) {\n\t *   console.log(`Found space: ${element.name}`);\n\t * } else if (Door.is(element)) ...\n\t * ```\n\t */\n\tgetById<T extends keyof Omit<TMapDataObjectTypes, 'enterprise-venue'> | 'unknown'>(\n\t\ttype: T,\n\t\tid: string,\n\t):\n\t\t| (T extends keyof TMapDataObjectTypes ? TMapDataObjectTypes[T] : TMapDataObjectTypes[keyof TMapDataObjectTypes])\n\t\t| undefined;\n\tgetById<T extends keyof TMapDataObjectTypes>(type: T, id: string): TMapDataObjectTypes[T] | undefined;\n\tgetById<T extends 'unknown'>(type: T, id: string): TMapDataObjectTypes[keyof TMapDataObjectTypes] | undefined;\n\tgetById<T extends keyof Omit<TMapDataObjectTypes, 'enterprise-venue'> | 'unknown'>(\n\t\ttype: T,\n\t\tid: string,\n\t):\n\t\t| (T extends keyof TMapDataObjectTypes ? TMapDataObjectTypes[T] : TMapDataObjectTypes[keyof TMapDataObjectTypes])\n\t\t| undefined {\n\t\treturn this.#internal.getById(type, id);\n\t}\n\n\t/**\n\t * Retrieves map elements by their external ID.\n\t *\n\t * External IDs are custom identifiers that can be assigned to map elements. This is useful for integrating with external systems or databases.\n\t *\n\t * @param type The type of element to retrieve.\n\t * @param externalId The external identifier to search for.\n\t * @returns An array of elements with the matching external ID.\n\t *\n\t * @example Find spaces by external ID\n\t * ```ts\n\t * const spaces = mapData.getByExternalId('space', 'STORE-001');\n\t * spaces.forEach(space => console.log(`Found space: ${space.name}`));\n\t * ```\n\t *\n\t * @example Find locations by external ID\n\t * ```ts\n\t * const locations = mapData.getByExternalId('enterprise-location', 'RESTAURANT-ABC');\n\t * locations.forEach(location => console.log(`Found location: ${location.name}`));\n\t * ```\n\t */\n\tgetByExternalId<T extends keyof Omit<TMapDataObjectTypes, 'annotation' | 'facade'>>(\n\t\ttype: T,\n\t\texternalId: string,\n\t): TMapDataObjectTypes[T][] {\n\t\treturn this.#internal.getByExternalId(type, externalId);\n\t}\n\n\t/**\n\t * Retrieves the GeoJSON representation of a map element.\n\t *\n\t * Returns the geometric data for a map element in GeoJSON format, which can be used for custom rendering, analysis, or integration with mapping libraries.\n\t *\n\t * @param mapDataObject The map element to get GeoJSON for.\n\t * @returns The GeoJSON representation of the element.\n\t *\n\t * @example Get GeoJSON for a space\n\t * ```ts\n\t * const space = mapData.getById('space', 'space-123');\n\t * if (space) {\n\t *   const geoJSON = mapData.getGeoJSON(space);\n\t *   console.log('Space geometry:', geoJSON.geometry);\n\t *   console.log('Space properties:', geoJSON.properties);\n\t * }\n\t * ```\n\t *\n\t * @example Get GeoJSON for a floor\n\t * ```ts\n\t * const floor = mapData.getByType('floor')[0];\n\t * const geoJSON = mapData.getGeoJSON(floor);\n\t * console.log('Floor bounds:', geoJSON.geometry.coordinates);\n\t * ```\n\t */\n\tgetGeoJSON<T extends IGeoJSONData>(mapDataObject: T): T['geoJSON'] {\n\t\t// TODO: add support for WALLS.Interior and WALLS.Exterior - should these be returned by floor or all together?\n\t\treturn mapDataObject.geoJSON;\n\t}\n\n\t/**\n\t * Changes the language of the map data.\n\t *\n\t * Updates all text content (names, descriptions, etc.) to the specified language. The map will emit a 'language-change' event when the language is updated.\n\t *\n\t * @param localeCode The ISO 639-1 language code to change to (e.g., 'en' for English, 'fr' for French). Check ({@link EnterpriseVenue.languages}) for available\n     languages\n\t * @returns A promise that resolves when the language change is complete.\n\t *\n\t * @example Change to Spanish\n\t * ```ts\n\t * await mapData.changeLanguage('es');\n\t * console.log('Map language changed to Spanish');\n\t * ```\n\t *\n\t * @example Change to French\n\t * ```ts\n\t * await mapData.changeLanguage('fr');\n\t * console.log('Map language changed to French');\n\t * ```\n\t *\n\t * @example Listen for language changes\n\t * ```ts\n\t * mapData.on('language-change', ({ code, name }) => {\n\t *   console.log(`Language changed to ${name} (${code})`);\n\t * });\n\t * ```\n\t */\n\tasync changeLanguage(localeCode: string) {\n\t\treturn this.#internal.changeLanguage(localeCode);\n\t}\n\n\t/**\n\t * Gets the current language of the map data.\n\t *\n\t * @returns The current language code and name.\n\t * @example\n\t * ```ts\n\t * const language = mapData.currentLanguage;\n\t * console.log(`Current language: ${language.name} (${language.code})`);\n\t * ```\n\t */\n\tget currentLanguage() {\n\t\treturn this.#internal.currentLanguage;\n\t}\n\n\t/**\n\t * Gets the natural bearing of the map.\n\t *\n\t * The natural bearing represents the orientation of the map relative to true north. This is useful for aligning the map with compass directions or external mapping systems.\n\t *\n\t * @returns The natural bearing in degrees.\n\t * @example\n\t * ```ts\n\t * const bearing = mapData.naturalBearing;\n\t * console.log(`Map is oriented ${bearing} degrees from true north`);\n\t * ```\n\t */\n\tget naturalBearing() {\n\t\treturn this.#internal.naturalBearing ?? 0;\n\t}\n\n\t/**\n\n\t * @deprecated Use the async version instead. This method will be made truly async in the upcoming future.\n\t * @internal\n\t */\n\t__LEGACY_GET_DIRECTIONS_SYNC = (\n\t\tfrom: TNavigationTarget | TNavigationTarget[],\n\t\tto: TNavigationTarget | TNavigationTarget[],\n\t\toptions?: TGetDirectionsOptions,\n\t): Directions | undefined => {\n\t\treturn this.#internal.__LEGACY_GET_DIRECTIONS_SYNC(from, to, options) as Directions | undefined;\n\t};\n\n\t/**\n\t * Calculates directions between two or more locations.\n\t *\n\t * Provides turn-by-turn navigation instructions and a path between the specified locations. The path avoids obstacles and follows walkable routes.\n\t *\n\t * @param from The starting location(s).\n\t * @param to The destination location(s).\n\t * @param options Optional configuration for the directions calculation.\n\t * @returns A {@link Directions} object containing the route, or undefined if no route is found.\n\t *\n\t * @example Get directions between two spaces\n\t * ```ts\n\t * const space1 = mapData.getById('space', 'space-123');\n\t * const space2 = mapData.getById('space', 'space-456');\n\t *\n\t * if (space1 && space2) {\n\t *   const directions = await mapData.getDirections(space1, space2);\n\t *   if (directions) {\n\t *     console.log(`Distance: ${directions.distance}m`);\n\t *     console.log(`Duration: ${directions.duration}s`);\n\t *     directions.instructions.forEach(instruction => {\n\t *       console.log(instruction.action.type);\n\t *     });\n\t *   }\n\t * }\n\t * ```\n\t *\n\t * @example Get directions with options\n\t * ```ts\n\t * const directions = await mapData.getDirections(space1, space2, {\n\t *   accessible: true,\n\t *   smoothing: { radius: 3 }\n\t * });\n\t * ```\n\t *\n\t * @example Get directions from multiple starting points\n\t * ```ts\n\t * const directions = await mapData.getDirections([space1, space2], destination);\n\t * ```\n\t *\n\t * @see [Wayfinding Guide](https://developer.mappedin.com/web-sdk/wayfinding)\n\t */\n\tgetDirections = (\n\t\tfrom: TNavigationTarget | TNavigationTarget[],\n\t\tto: TNavigationTarget | TNavigationTarget[],\n\t\toptions?: TGetDirectionsOptions,\n\t): Promise<Directions | undefined> => {\n\t\treturn this.#internal.getDirections(from, to, options) as Promise<Directions | undefined>;\n\t};\n\n\t/**\n\t * @deprecated Use the async version instead. This method will be made truly async in the upcoming future.\n\t * @internal\n\t */\n\t__LEGACY_GET_DIRECTIONS_MULTI_DESTINATION_SYNC = (\n\t\tfrom: TNavigationTarget,\n\t\tto: (TNavigationTarget | TNavigationTarget[])[],\n\t\toptions?: TGetDirectionsOptions,\n\t): Directions[] | undefined => {\n\t\treturn this.#internal.__LEGACY_GET_DIRECTIONS_MULTI_DESTINATION_SYNC(from, to, options) as Directions[] | undefined;\n\t};\n\n\t/**\n\t * Calculates directions to multiple destinations.\n\t *\n\t * Provides routes from a single starting point to multiple destinations. Useful for finding the best route when visiting multiple locations.\n\t *\n\t * @param from The starting location.\n\t * @param to An array of destination locations or arrays of destinations.\n\t * @param options Optional configuration for the directions calculation.\n\t * @returns An array of {@link Directions} objects, one for each destination.\n\t *\n\t * @example Get directions to multiple destinations\n\t * ```ts\n\t * const start = mapData.getById('space', 'entrance');\n\t * const destinations = [\n\t *   mapData.getById('space', 'store-1'),\n\t *   mapData.getById('space', 'store-2'),\n\t *   mapData.getById('space', 'restaurant')\n\t * ].filter(Boolean);\n\t *\n\t * const allDirections = await mapData.getDirectionsMultiDestination(start, destinations);\n\t * allDirections.forEach((directions, index) => {\n\t *   console.log(`Route ${index + 1}: ${directions.distance}m`);\n\t * });\n\t * ```\n\t *\n\t * @example Get directions with alternative routes\n\t * ```ts\n\t * const directions = await mapData.getDirectionsMultiDestination(start, [\n\t *   [destination1, destination2], // First route option\n\t *   [destination3, destination4]  // Second route option\n\t * ]);\n\t * ```\n\t */\n\tgetDirectionsMultiDestination = (\n\t\tfrom: TNavigationTarget,\n\t\tto: (TNavigationTarget | TNavigationTarget[])[],\n\t\toptions?: TGetDirectionsOptions,\n\t): Promise<Directions[] | undefined> => {\n\t\treturn this.#internal.getDirectionsMultiDestination(from, to, options) as Promise<Directions[] | undefined>;\n\t};\n\n\t/**\n\t * Calculates the straight-line distance between two locations.\n\t *\n\t * Returns the direct distance between two points, not following walkable paths. For navigation distances, use {@link getDirections}.\n\t *\n\t * @param from The starting location.\n\t * @param to The destination location.\n\t * @returns The distance in meters.\n\t *\n\t * @example Calculate distance between spaces\n\t * ```ts\n\t * const space1 = mapData.getById('space', 'space-123');\n\t * const space2 = mapData.getById('space', 'space-456');\n\t *\n\t * if (space1 && space2) {\n\t *   const distance = mapData.getDistance(space1, space2);\n\t *   console.log(`Direct distance: ${distance}m`);\n\t * }\n\t * ```\n\t *\n\t * @example Calculate distance from coordinate\n\t * ```ts\n\t * const coordinate = mapData.mapCenter;\n\t * const space = mapData.getByType('space')[0];\n\t * const distance = mapData.getDistance(coordinate, space);\n\t * console.log(`Distance from center: ${distance}m`);\n\t * ```\n\t */\n\tgetDistance(\n\t\tfrom: Space | Door | Coordinate | MapObject | PointOfInterest | Annotation | Node | EnterpriseLocation | Area,\n\t\tto: Space | Door | Coordinate | MapObject | PointOfInterest | Annotation | Node | EnterpriseLocation | Area,\n\t) {\n\t\treturn this.#internal.getDistance(from, to);\n\t}\n\n\t/**\n\t * Creates a backup of the map data including language packs.\n\t * @internal\n\t */\n\ttoBinaryBundle({ downloadLanguagePacks = true }: { downloadLanguagePacks?: boolean } = {}) {\n\t\treturn this.#internal.toBinaryBundle({ downloadLanguagePacks });\n\t}\n\n\t/**\n\t * Exports the map data as a JSON bundle.\n\t *\n\t * Creates a JSON representation of the map data that can be easily parsed and manipulated. Useful for data analysis, debugging, or integration with other systems.\n\t *\n\t * @param options Configuration options for the export.\n\t * @param options.downloadLanguagePacks Whether to include language packs in the export.\n\t * @returns A JSON bundle containing the map data.\n\t *\n\t * @example Export map data as JSON\n\t * ```ts\n\t * const jsonBundle = mapData.toJSONBundle({ downloadLanguagePacks: true });\n\t * console.log('Map data exported:', jsonBundle);\n\t * ```\n\t *\n\t * @example Export for analysis\n\t * ```ts\n\t * const jsonBundle = mapData.toJSONBundle({ downloadLanguagePacks: false });\n\t * // Use JSON data for analysis or processing\n\t * ```\n\t */\n\ttoJSONBundle({ downloadLanguagePacks = true }: { downloadLanguagePacks?: boolean } = {}) {\n\t\treturn this.#internal.toJSONBundle({ downloadLanguagePacks });\n\t}\n}\n\nexport default MapData;\n\n/**\n * @internal\n */\nexport function getMapDataInternal(mapData: MapData): MapDataInternal {\n\tconst found = MapDataInternalByMapData.get(mapData);\n\tif (!found) throw new Error('MapDataInternal not found');\n\n\treturn found;\n}\n", "export { Analytics, AnalyticsInternal } from './customer';\nexport type { AnalyticsUpdateOptions, AnalyticState, TAnalyticsUpdateState } from './customer';\n", "import { Logger, SafeStorage, debounce } from '@packages/internal/common';\nimport { fetch } from '../utils/fetch';\n\n// prettier-ignore\n/**\n * Valid track-analytics API contexts. These should match the expected values of that endpoint or the requests will fail.\n * If a set context is not in this list, it will default to the first VALID_CONTEXTS value.\n */\nexport const VALID_CONTEXTS = [ 'websdk', 'web', 'webv2', 'kiosk-v2', 'mobile', 'iossdk', 'androidsdk', 'reactnativesdk', 'gen7', 'bespoke', 'reactsdk' ] as const;\ntype ValidContext = (typeof VALID_CONTEXTS)[number];\nexport const DEFAULT_CONTEXT = VALID_CONTEXTS[0];\n\nexport const ANALYTICS_URL = 'https://api-gateway.mappedin.com/track-analytics/a/';\n\nconst DENY_WATCH_POSITION = 'deny-watchposition';\nconst LOAD_MAPVIEW = 'load-mapview';\nconst LOAD_MAPDATA = 'load-mapdata';\nconst CHANGE_LANGUAGE = 'change-language';\nconst QUERY_DIRECTION = 'query-directions';\nexport const FOUND_POSITION = 'found-position';\nexport const FOUND_FLOOR = 'found-floor';\ntype BlueDotEvents = typeof FOUND_FLOOR | typeof FOUND_POSITION;\n\nexport class AnalyticsInternal {\n\t// keep track of the options that's been set\n\t#options: Readonly<AnalyticsOptions> = Object.freeze({});\n\t#state: AnalyticState;\n\tprivate oneTimeEventsSent: Set<string> = new Set();\n\n\tconstructor() {\n\t\tthis.#state = this.#getStateWithOption(this.#options);\n\t}\n\n\tinit(options: AnalyticsUpdateOptions) {\n\t\tthis.reset();\n\t\tthis.updateStateWithOptions(options);\n\t}\n\n\t/**\n\t * Reset state and options\n\t */\n\treset() {\n\t\tthis.#options = {};\n\t\tthis.#state = this.#getStateWithOption({});\n\t\tthis.oneTimeEventsSent.clear();\n\t}\n\n\tprivate updateStateWithOptions(options: AnalyticsUpdateOptions) {\n\t\tthis.#options = Object.freeze(Object.assign({}, this.#options, options));\n\t\tthis.#state = this.#getStateWithOption(options);\n\t\tthis.#saveStateToStorage(this.#state);\n\n\t\treturn this.#state;\n\t}\n\n\t#saveStateToStorage(state: Partial<Pick<AnalyticState, 'sessionId' | 'deviceId'>>) {\n\t\tif (state.sessionId) {\n\t\t\tSafeStorage.getInstance().saveSessionData('id', state.sessionId);\n\t\t}\n\t\tif (state.deviceId) {\n\t\t\tSafeStorage.getInstance().saveLocalData('deviceId', state.deviceId);\n\t\t}\n\t}\n\n\t#getStateWithOption(options: AnalyticsOptions) {\n\t\tconst baseUri = options.baseUri ?? ANALYTICS_URL;\n\n\t\treturn {\n\t\t\tbaseUri,\n\t\t\tanalyticsBaseUrl: getBaseUrl({ ...options, baseUri }),\n\t\t\tversion: process?.env?.npm_package_version || 'v6',\n\t\t\tdeviceId: options.deviceId || getDeviceIDFromStorage(),\n\t\t\taccessToken: options.accessToken,\n\t\t\tmapId: options.mapId,\n\t\t\tsessionId: options.sessionId || getSessionIDFromStorage(),\n\t\t\tplatformString: options.platformString || '',\n\t\t\tcontext: getValidContext(options.context) || DEFAULT_CONTEXT,\n\t\t\tgeolocationMode: false,\n\t\t\tsendEvents: options.sendEvents ?? true,\n\t\t\tlogEvents: options.logEvents ?? false,\n\t\t\tnoAuth: options.noAuth || false,\n\t\t\tkey: options.key,\n\t\t\tsecret: options.secret,\n\t\t} satisfies AnalyticState as AnalyticState;\n\t}\n\n\tupdateState(update: UpdateStateParam) {\n\t\tconst updatedState: Partial<AnalyticState> = {\n\t\t\t...update,\n\t\t};\n\t\tif (updatedState.mapId) {\n\t\t\tupdatedState.analyticsBaseUrl = getBaseUrl({ ...this.#state, mapId: updatedState.mapId });\n\t\t}\n\t\tif (updatedState.context) {\n\t\t\tupdatedState.context = getValidContext(updatedState.context);\n\t\t}\n\t\tif (updatedState.baseUri) {\n\t\t\tupdatedState.analyticsBaseUrl = getBaseUrl({ baseUri: updatedState.baseUri, mapId: this.#state.mapId });\n\t\t}\n\t\tObject.assign(this.#state, updatedState);\n\t\tthis.handleStateUpdate(update);\n\t\tthis.#saveStateToStorage(updatedState);\n\t}\n\n\t// side effects of state updated\n\tprivate handleStateUpdate(update: UpdateStateParam) {\n\t\tif (update.userPosition?.floorLevel) {\n\t\t\tthis.sendBlueDotEvents('found-floor');\n\t\t} else if (update.userPosition) {\n\t\t\tthis.sendBlueDotEvents('found-position');\n\t\t}\n\t}\n\n\tget authReady() {\n\t\tconst { key, secret, accessToken } = this.getState();\n\n\t\treturn !!(key && secret) || !!accessToken;\n\t}\n\n\tgetState() {\n\t\treturn this.#state;\n\t}\n\n\tprivate getContext() {\n\t\treturn this.getState().context || this.#options.context || DEFAULT_CONTEXT;\n\t}\n\n\tprivate getSessionId() {\n\t\treturn this.getState().sessionId || this.#options.sessionId || getSessionIDFromStorage();\n\t}\n\n\tprivate getDeviceId() {\n\t\treturn this.getState().deviceId || this.#options.deviceId || getDeviceIDFromStorage();\n\t}\n\n\tprivate sendAnalyticEvent(target: string, data: Record<string, any> = {}) {\n\t\tconst state = this.getState();\n\t\tconst url = buildUrl(state.analyticsBaseUrl, target);\n\n\t\tconst headers: HeadersInit = {\n\t\t\t'mi-context': this.getContext(),\n\t\t\t'mi-session': this.getSessionId(),\n\t\t\t'mi-device': this.getDeviceId(),\n\t\t} satisfies AnalyticsHeaders;\n\n\t\tif (state.logEvents) {\n\t\t\tLogger.log('Analytics.track', url, headers);\n\t\t}\n\n\t\tif (!state.sendEvents) {\n\t\t\t// Turns off analytics track events for internal testing\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tif (!this.authReady) return Logger.warn('Auth needs to be ready to send analytics.');\n\n\t\tconst jsonData = { ...data, g: state.geolocationMode, sdk_version: state.version };\n\t\tif (state.userPosition) {\n\t\t\tObject.assign(jsonData, state.userPosition);\n\t\t}\n\n\t\theaders['Content-Type'] = 'application/json';\n\n\t\tif (state.accessToken) {\n\t\t\theaders['Authorization'] = `Bearer ${state.accessToken}`;\n\t\t} else if (!state.noAuth) {\n\t\t\tif (state.secret && state.key) {\n\t\t\t\theaders['x-mappedin-key'] = btoa(state.key);\n\t\t\t\theaders['x-mappedin-secret'] = btoa(state.secret);\n\t\t\t}\n\t\t}\n\n\t\treturn fetch(url, {\n\t\t\tmethod: 'POST',\n\t\t\tmode: 'cors',\n\t\t\theaders,\n\t\t\tbody: JSON.stringify(jsonData),\n\t\t});\n\t}\n\n\tcapture<T extends keyof CaptureEventsPayloadMap>(\n\t\teventName: T,\n\t\tquery: CaptureEventsPayloadMap[T],\n\t): Promise<Response> | Promise<void>;\n\tcapture<T extends keyof CaptureEventsPayloadMap | (string & NonNullable<unknown>)>(\n\t\ttarget: T,\n\t\tquery: T extends keyof CaptureEventsPayloadMap ? CaptureEventsPayloadMap[T] : Record<string, any>,\n\t): Promise<Response> | Promise<void>;\n\tcapture<T extends keyof CaptureEventsPayloadMap | string>(\n\t\ttarget: T,\n\t\tquery: T extends keyof CaptureEventsPayloadMap ? CaptureEventsPayloadMap[T] : Record<string, any>,\n\t) {\n\t\tif (USER_CANNOT_SEND.includes(target)) {\n\t\t\tLogger.warn(`${target} event is sent internally.`);\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tconst eventName = RESERVED_EVENTS.includes(target as keyof CaptureEventsPayloadMap) ? target.slice(1) : target; // get rid of '$'\n\n\t\treturn this.sendAnalyticEvent(eventName, query as Record<string, any>);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tsendGetMapDataEvent(payload: { parseDuration: number; downloadDuration: number; viewId?: string }) {\n\t\treturn this.sendAnalyticEvent(LOAD_MAPDATA, payload);\n\t}\n\n\tsendChangeLanguageEvent(payload: { fromLanguage: string }) {\n\t\treturn this.sendAnalyticEvent(CHANGE_LANGUAGE, payload);\n\t}\n\n\tsendWatchPositionDenied() {\n\t\treturn this.sendAnalyticEvent(DENY_WATCH_POSITION);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tsendMapViewLoadedEvent({\n\t\tfirstRenderDuration,\n\t\tdimension,\n\t\tcollisionWorkerDisabled,\n\t\toutdoorsWorkerDisabled,\n\t}: {\n\t\tfirstRenderDuration: number;\n\t\tdimension: { height: number; width: number };\n\t\t/**\n\t\t * True when setWorkerURL is set, but the worker file cannot be found, so we disable the collision worker and use sync collision detection instead\n\t\t */\n\t\tcollisionWorkerDisabled: boolean;\n\t\t/**\n\t\t * True when setWorkerURL is set, but the worker file cannot be found, so we disable the outdoor context\n\t\t */\n\t\toutdoorsWorkerDisabled: boolean;\n\t}) {\n\t\treturn this.sendAnalyticEvent(LOAD_MAPVIEW, {\n\t\t\ttype: '3d',\n\t\t\tfirstRenderDuration,\n\t\t\twidth: dimension.width,\n\t\t\theight: dimension.height,\n\t\t\tdevicePixelRatio: globalThis.devicePixelRatio || 1,\n\t\t\tcollisionWorkerDisabled,\n\t\t\toutdoorsWorkerDisabled,\n\t\t});\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tsendGetDirectionsEvent = debounce((start: string, end: string, accessible?: boolean) => {\n\t\tconst payload: Record<string, any> = {\n\t\t\tstart: start,\n\t\t\tend: end,\n\t\t\ttype: 'location_to_location',\n\t\t};\n\n\t\tif (accessible !== undefined) {\n\t\t\tpayload.accessible = accessible;\n\t\t}\n\n\t\treturn this.sendAnalyticEvent(QUERY_DIRECTION, payload);\n\t}, 2500);\n\n\tsendBlueDotEvents(event: BlueDotEvents) {\n\t\tif ((event === 'found-floor' || event === 'found-position') && this.oneTimeEventsSent.has(event)) {\n\t\t\treturn;\n\t\t}\n\t\tthis.oneTimeEventsSent.add(event);\n\n\t\treturn this.sendAnalyticEvent(event);\n\t}\n\n\t// TODO: cancel all outgoing requests\n\t// destroy() {\n\t// }\n}\n\nfunction getBaseUrl({ mapId, baseUri = ANALYTICS_URL }: { mapId?: string; baseUri: string }) {\n\treturn `${baseUri}${mapId}/`;\n}\n\nfunction getDeviceIDFromStorage(): string {\n\treturn SafeStorage.getInstance().loadLocalData('deviceId');\n}\n\nfunction getSessionIDFromStorage(): string {\n\treturn SafeStorage.getInstance().loadSessionData('id');\n}\n\nfunction buildUrl(baseUrl: string, target: string) {\n\treturn baseUrl + target;\n}\n\nfunction getValidContext(context?: string) {\n\treturn VALID_CONTEXTS.find(c => c === context);\n}\n\ntype UpdateStateParam = Partial<\n\tPick<\n\t\tAnalyticState,\n\t\t| 'geolocationMode'\n\t\t| 'context'\n\t\t| 'logEvents'\n\t\t| 'userPosition'\n\t\t| 'mapId'\n\t\t| 'sendEvents'\n\t\t| 'logEvents'\n\t\t| 'accessToken'\n\t\t| 'sessionId'\n\t\t| 'deviceId'\n\t>\n>;\n\ntype CaptureEventsPayloadMap = {\n\t'$select-location': {\n\t\tid: string;\n\t};\n\t'$select-category': {\n\t\tid: string;\n\t};\n\t'$query-suggest': {\n\t\tquery: string;\n\t\tsuggestions?: string[];\n\t};\n\t'$query-search': {\n\t\tquery: string;\n\t\thits?: string[];\n\t};\n};\n\n// keep this up-to-date with CaptureEventsPayloadMap\nconst RESERVED_EVENTS = ['$select-location', '$select-category', '$query-suggest', '$query-search'] as const;\nconst USER_CANNOT_SEND = [LOAD_MAPVIEW, LOAD_MAPDATA, QUERY_DIRECTION, DENY_WATCH_POSITION, CHANGE_LANGUAGE];\n\nexport const analyticsInternal = new AnalyticsInternal();\n\nexport class Analytics {\n\t#internal: AnalyticsInternal;\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(internalAnalytics: AnalyticsInternal) {\n\t\tthis.#internal = internalAnalytics;\n\t\tthis.capture = this.#internal.capture.bind(this.#internal);\n\t\tthis.updateState = this.#internal.updateState.bind(this.#internal);\n\t}\n\n\t/**\n\t * Captures an analytic event with a custom target and query payload.\n\t *\n\t * @param target - The event name or target can be one of: `$select-location`, `$select-category`, `$query-suggest`, `$query-search`\n\t * @param query - The payload associated with the event.\n\t * @returns A promise that resolves to the server response or void.\n\t */\n\tcapture: typeof AnalyticsInternal.prototype.capture;\n\n\t/**\n\t * Updates the analytics state with the provided parameters.\n\t * @param update - The state parameters to update.\n\t */\n\tupdateState: (update: TAnalyticsUpdateState) => void;\n\n\t/**\n\t * Returns the current analytics state.\n\t * @internal\n\t * @returns the current analytics state\n\t */\n\tgetState() {\n\t\t// For privacy, discard sessionId and deviceId from the public state\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\t\tconst { sessionId, deviceId, ...publicState } = this.#internal.getState();\n\n\t\treturn publicState;\n\t}\n\n\t// For user privacy reasons, keep these functions private and undiscoverable.\n\t// @ts-ignore intentionally unused method\n\tprivate getContext() {\n\t\treturn this.#internal['getContext']();\n\t}\n\t// @ts-ignore intentionally unused method\n\tprivate getSessionId() {\n\t\treturn this.#internal['getSessionId']();\n\t}\n\t// @ts-ignore intentionally unused method\n\tprivate getDeviceId() {\n\t\treturn this.#internal['getDeviceId']();\n\t}\n}\n\ntype AnalyticsUserPosition = {\n\tbluedotTimestamp: number;\n\tlatitude: number;\n\tlongitude: number;\n\tfloorLevel?: number;\n\taccuracy?: number;\n};\n\ntype AnalyticsHeaders = {\n\t'mi-context': string;\n\t'mi-session': string;\n\t'mi-device': string;\n\tAuthorization?: string;\n};\n\ntype AnalyticsAuth = {\n\t/** The API key for authentication. */\n\tkey?: string;\n\t/** The API secret for authentication. */\n\tsecret?: string;\n\t/** The access token for authentication. */\n\taccessToken?: string;\n};\n\nexport type AnalyticState = {\n\tversion: string;\n\t/** The platform string to be included in analytics. */\n\tplatformString: string;\n\t/** The base URI for the analytics endpoint. */\n\tbaseUri: string;\n\t/** The base URI with mapId appended. */\n\tanalyticsBaseUrl: string;\n\t/** Flag to disable authentication. */\n\tnoAuth: boolean;\n\t/** Flag to enable geolocation mode. */\n\tgeolocationMode: boolean;\n\t/** @internal The device ID to be used for analytics. */\n\tdeviceId: string;\n\t/** @internal The session ID to be used for analytics. */\n\tsessionId: string;\n\t/** The context in which the analytics are being used. */\n\tcontext: ValidContext;\n\t/** The last known user position. */\n\tuserPosition?: AnalyticsUserPosition;\n\t/** The ID of the map to be used for analytics. */\n\tmapId?: string;\n\t/** Flag to enable logging of events. */\n\tlogEvents: boolean;\n\t/** Flag to enable sending of events. */\n\tsendEvents: boolean;\n} & AnalyticsAuth;\n\ntype AnalyticsOptions = Partial<\n\tOmit<AnalyticState, 'version' | 'analyticsBaseUrl' | 'geolocationMode' | 'userPosition'>\n>;\n\nexport type AnalyticsUpdateOptions = Omit<AnalyticsOptions, keyof AnalyticsAuth> &\n\t(\n\t\t| (Required<Pick<AnalyticsAuth, 'key' | 'secret'>> & Partial<Pick<AnalyticsAuth, 'accessToken'>>)\n\t\t| (Required<Pick<AnalyticsAuth, 'accessToken'>> & Partial<Pick<AnalyticsAuth, 'key' | 'secret'>>)\n\t);\n\n/**\n * Options for updating the current state of analytics.\n * @interface\n */\nexport type TAnalyticsUpdateState = Pick<\n\tPartial<AnalyticState>,\n\t'logEvents' | 'sendEvents' | 'baseUri' | 'accessToken'\n>;\n", "import { notNull } from './not-null';\n\nconst control = (function createFetchControl() {\n\tlet fetch: Window['fetch'] | undefined = globalThis.fetch;\n\n\treturn {\n\t\tfetch(...args: Parameters<Window['fetch']>): ReturnType<Window['fetch']> {\n\t\t\tif (!notNull(fetch))\n\t\t\t\tthrow new Error(\n\t\t\t\t\t'fetch is not available in your environment. Pass your own function into `setFetchFn` (node-fetch, etc)',\n\t\t\t\t);\n\n\t\t\treturn fetch?.(...args);\n\t\t},\n\n\t\tsetFetch(f: Window['fetch']) {\n\t\t\tfetch = f;\n\t\t},\n\t};\n})();\n\nexport const fetch = control.fetch;\n", "/**\n * @internal\n */\nexport const notNull = <T>(value: T | null | undefined): value is T => value != null;\n", "export type {\n\tSearchResult,\n\tSearchResultItem,\n\tSearchOptions,\n\tSuggestion,\n\tSearchResultEnterpriseCategory,\n\tSearchResultEnterpriseLocations,\n\tSearchResultPlaces,\n\tMatchInfo,\n} from './internal';\nexport type { SearchState } from './external';\nexport { Search } from './external';\n", "import { Logger } from '@packages/internal/common';\nimport type MapData from '../map-data';\nimport type { InternalSearch, SearchOptions, SuggestOptions } from './internal';\nimport type { MapDataInternal } from '../map-data-objects';\nimport type { Suggestion } from 'minisearch';\n\n/**\n * Search allows users to search for locations, categories, and other points of interest within the venue.\n *\n * Refer to the [Search Guide](https://developer.mappedin.com/web-sdk/enterprise-data#enterprise-search) for more information and interactive examples.\n */\nexport class Search {\n\t#mapData: MapData;\n\tprivate searchInstance?: Promise<InternalSearch>;\n\t#mapDataInternal: MapDataInternal;\n\t#languageChangeHandler: () => void;\n\n\t/**\n\t * Whether the search is enabled.\n\t * @default false\n\t */\n\tenabled = false;\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(mapData: MapData, mapDataInternal: MapDataInternal, { enabled = false }: { enabled?: boolean } = {}) {\n\t\tthis.#mapData = mapData;\n\t\tthis.#mapDataInternal = mapDataInternal;\n\t\tthis.#languageChangeHandler = () => {\n\t\t\tthis.searchInstance?.then(search => search.populate());\n\t\t};\n\n\t\tif (enabled) {\n\t\t\tthis.enable();\n\t\t}\n\t}\n\n\t/**\n\t * Use query to search for locations based on a string input:\n\t *\n\t * - {@link EnterpriseLocation}: Specific places such as stores, restaurants, or washrooms.\n\t * - {@link EnterpriseCategory}: Groups of locations, such as \"Food Court\" or \"Electronics.\"\n\t * - {@link Places}: Any main objects that can be searched for such as Space, Door, Point of Interest\n\t *\n\t * Search query returns a list of matching {@\tlink SearchResult} based on the input string.\n\t *\n\t * {@link SearchResult} include information about the type of match, the score (relevance), and detailed metadata about the matching items.\n\t *\n\t * @param term - The search term.\n\t * @param options - The search options.\n\t * @returns The search results.\n\t * @example\n\t * ```ts\n\t * const results = await search.query('Coffee Shop');\n\t * console.log(results.locations);\n\t * ```\n\t */\n\tasync query(term: string, options: SearchOptions = {}): ReturnType<typeof InternalSearch.prototype.search> {\n\t\tif (!this.enabled) {\n\t\t\tawait this.enable();\n\t\t}\n\t\tif (!this.searchInstance) {\n\t\t\tLogger.error('Search should be enabled by now');\n\n\t\t\treturn { places: [], enterpriseLocations: [], enterpriseCategories: [] };\n\t\t}\n\n\t\ttry {\n\t\t\treturn await (await this.searchInstance).search(term, options);\n\t\t} catch (e) {\n\t\t\tLogger.error('Search.query failed due to', e);\n\n\t\t\treturn { places: [], enterpriseLocations: [], enterpriseCategories: [] };\n\t\t}\n\t}\n\n\t/**\n\t * Suggests the names of places, locations, and categories based on partial input. This is useful for creating an autocomplete feature for a search bar.\n\t * @param term - The search term.\n\t * @param options - The suggest options.\n\t * @returns The search suggestions.\n\t * @example\n\t * ```ts\n\t * const suggestions = await search.suggest('Coffee');\n\t * console.log(suggestions);\n\t * ```\n\t */\n\tasync suggest(term: string, options: SuggestOptions = {}): Promise<Suggestion[]> {\n\t\tif (!this.enabled) {\n\t\t\tawait this.enable();\n\t\t}\n\n\t\tif (!this.searchInstance) {\n\t\t\tLogger.error('Search should be enabled by now');\n\n\t\t\treturn [];\n\t\t}\n\n\t\ttry {\n\t\t\treturn await (await this.searchInstance).suggest(term, options);\n\t\t} catch (e) {\n\t\t\tLogger.error('Search.suggest failed due to', e);\n\n\t\t\treturn [];\n\t\t}\n\t}\n\n\t/**\n\t * Enables the search.\n\t */\n\tasync enable(): Promise<void> {\n\t\tif (this.enabled) {\n\t\t\treturn;\n\t\t}\n\t\tthis.enabled = true;\n\t\tif (!this.searchInstance) {\n\t\t\tthis.searchInstance = import('./internal').then(\n\t\t\t\t({ InternalSearch: SearchClass }) => new SearchClass(this.#mapData),\n\t\t\t);\n\t\t}\n\t\tthis.#mapDataInternal.on('language-change', this.#languageChangeHandler);\n\n\t\tawait this.searchInstance;\n\t}\n}\n\nexport type SearchState = {\n\t/**\n\t * Whether the search is enabled.\n\t */\n\tenabled: boolean;\n};\n", "export * from './api-types';\nexport * from './mvf-types';\n\nexport type {\n\tTGetMapDataOptions,\n\tTGetMapDataWithAccessTokenOptions,\n\tTGetMapDataWithCredentialsOptions,\n\tTGetMapDataSharedOptions,\n\tTGetVenueOptions,\n\tTSearchOptions,\n\tTGetVenueBundleOptions,\n\tLocalePackUrls,\n\tEnvironment,\n} from './mvf-utils';\n\nexport {\n\tdownloadVenueBundleMVF,\n\tdownloadVenueBundleMVFAPIGateway,\n\tdownloadMVF,\n\tparseOptions,\n\tgetAccessToken,\n\tparseMVF,\n\tunzipMVF,\n\tparseMVFv1,\n\tunzipMVFv1,\n\tcreateEnvControl,\n\tgetSasToken,\n\tparseLanguagePack,\n} from './mvf-utils';\n\nexport { findAndSplitObstructionByAllEntrances as splitObstructionByAllEntrances } from './geometry';\n", "/**\n * This file contains the API types for MappedinSDK - before they get turned into Classes\n */\n\nexport type TLocationType = 'amenities' | 'tenant';\n\nexport type TNode = {\n\tid: string;\n\tx: number;\n\ty: number;\n\tmap: string;\n\texternalId?: string;\n\tpaths: {\n\t\tnode: string;\n\t\tmap: string;\n\t\tweight?: number;\n\t}[];\n\t[propName: string]: any;\n};\n\nexport type TImage = {\n\toriginal?: string;\n\tlarge?: string;\n\t'140x140'?: string;\n\txxlarge?: string;\n\txsmall?: string;\n\t'66x66'?: string;\n\txlarge?: string;\n\tmedium?: string;\n\txxsmall?: string;\n\tsmall?: string;\n};\n\nexport type TLogo = TImage;\n\nexport type TGalleryImage = {\n\timage: TImage;\n\tcaption?: string;\n};\n\nexport type TPhone = {\n\tnumber?: string;\n};\n\nexport type TSocial = {\n\twebsite?: string;\n\ttwitter?: string;\n\tfacebook?: string;\n\tinstagram?: string;\n};\n\nexport type TColor = {\n\thex: string;\n\topacity: number;\n\trgba: string;\n};\n\nexport type TVortex = {\n\tid: string;\n\tname: string;\n\ttype: string;\n\tweight: number;\n\tmultiplier: number;\n\t[propName: string]: any;\n};\n\nexport type TPicture = {\n\toriginal?: string;\n};\n\nexport type TOpeningHours = {\n\t'@type': string;\n\topens: string;\n\tcloses: string;\n\tdayOfWeek: string[];\n\tvalidFrom?: string;\n\tvalidThrough?: string;\n};\n\nexport type TSiblingGroup = {\n\tlabel: string;\n\tsiblings: string[];\n};\n\nexport type TState = {\n\ttype: string;\n\tstart?: string;\n\tend?: string;\n};\n\nexport type TCategory = {\n\tname?: string;\n\texternalId?: string;\n\tparents?: string[];\n\tid?: string;\n\ticon?: TPicture;\n};\n\nexport type TEvent = {\n\tid: string;\n\ttype: string;\n\tname: string;\n\tlocation?: string;\n\tdescription?: string;\n\timage?: TImage;\n\tstartDate?: number;\n\tendDate?: number;\n\tshowDate?: number;\n};\n\nexport interface TGeoReference {\n\ttarget: { x: number; y: number };\n\tcontrol: { x: number; y: number };\n}\n\nexport interface TMap {\n\tid: string;\n\tname: string;\n\tshortName: string;\n\televation?: number;\n\tscale?: number;\n\tx_scale?: number;\n\tgeoreference?: TGeoReference[];\n\t[propName: string]: any;\n}\n\nexport type TMapGroup = {\n\tname: string;\n\tid: string;\n};\n\n// A location representing a map group\nexport type TBuilding = TLocation & {\n\tgroupId: string;\n};\n\nexport type TLocation = {\n\tid: string;\n\tname: string;\n\ttype: string;\n\tnodes: {\n\t\tmap: TMap['id'];\n\t\tnode: TNode['id'];\n\t}[];\n\tpolygons: {\n\t\tmap: TMap['id'];\n\t\tid: TPolygon['id'];\n\t}[];\n\tcategories: string[];\n\tdescription?: string;\n\tsortOrder?: number;\n\tlogo?: TLogo;\n\tphone?: TPhone;\n\tsocial?: TSocial;\n\tcolor?: TColor;\n\tshortName?: string;\n\tdetailsUrl?: string;\n\tparent?: string | null;\n\ttags?: string[];\n\texternalId?: string;\n\tpicture?: TPicture;\n\tstates?: TState[];\n\toperationHours?: TOpeningHours[] | undefined;\n\tsiblingGroups?: TSiblingGroup[] | undefined;\n\tgallery?: TGalleryImage[] | undefined;\n\t[propName: string]: any;\n};\n\nexport type TPolygon = {\n\tid: string;\n\tmap: string;\n\tlayer?: string;\n\tlayerId?: string;\n\texternalId?: string;\n\tname?: string;\n\tentrances: {\n\t\tmap: TMap['id'];\n\t\tid: TNode['id'];\n\t}[];\n};\n\nexport type TPolygonRanking = {\n\tpolygonId: string;\n\tentranceNodeId: string;\n\tscore: number;\n};\n\nexport type TLocationState = {\n\tid: string;\n\tname: string;\n\tvalue: string;\n};\n\nexport type TVenue = {\n\taddress?: string;\n\tcity?: string;\n\tcountrycode?: string;\n\tdefaultMap?: string;\n\texternalId?: string;\n\tid?: string;\n\tlatitude?: number;\n\tlogo?: TLogo;\n\tlongitude?: number;\n\tmetadata?: any;\n\tname?: string;\n\toperationHours?: TOpeningHours[];\n\tpostal?: string;\n\tslug?: string;\n\tstate?: string;\n\ttelephone?: string;\n\ttzid?: string;\n\ttzidOverride?: string;\n\tutcOffset?: string;\n\twebsite?: string;\n};\n\nexport type TMappedinAPI = {\n\tnodes: TNode[];\n\tlocations: TLocation[];\n\tcategories: TCategory[];\n\tmapGroups: TMapGroup[];\n\tpolygons: TPolygon[];\n\tmaps: TMap[];\n\tthemes: any;\n\tvenue: TVenue;\n\tvortexes: TVortex[];\n\tlocationStates?: TLocationState[];\n\timageBinaries?: Map<string, Uint8Array>;\n};\n", "import type {\n\tMapId,\n\tStyle,\n\tFeature,\n\tLineString,\n\tObstructionProperties,\n\tEntranceProperties,\n\tSpaceProperties,\n\tObstructionCollection,\n\tEntranceCollection,\n\tSpaceCollection,\n\tFloorImageProperties,\n\tBaseTextAreaProperties,\n\tEnterpriseTexture,\n} from '@mappedin/mvf-v2';\nimport type { FeatureCollection, MultiPolygon, Point, Polygon } from 'geojson';\nimport type { TImage, TMap, TNode, TOpeningHours, TPhone, TSiblingGroup, TSocial } from './api-types';\n\nexport type WithIDs<T> = Map<string, T>;\n\ntype ManifestFile = {\n\ttype: 'file';\n\tname: string;\n};\n\ntype ManifestFolder = {\n\ttype: 'folder';\n\tname: string;\n\tchildren: ManifestFile[];\n};\n\nexport type MVFStyle = Style & {\n\ttype: string;\n\twidth?: number;\n};\n\nexport type MVFObstructionFeature = ObstructionCollection['features'][number];\nexport type MVFEntranceFeature = EntranceCollection['features'][number];\nexport type MVFSpaceFeature = SpaceCollection['features'][number];\n\nexport type WithPolygonImage<T extends SpaceProperties | ObstructionProperties> = T & {\n\timage?: FloorImageProperties;\n};\nexport type WithTextArea<T extends SpaceProperties | ObstructionProperties> = T & { textArea?: BaseTextAreaProperties };\nexport type WithEntepriseStyle<T extends SpaceProperties | ObstructionProperties> = T & {\n\tstyle?: { styleId: string; edgeOffset?: number };\n};\nexport type WithTextures<T extends SpaceProperties | ObstructionProperties> = T & {\n\ttextures?: EnterpriseTexture[];\n};\nexport type WithBevel<T extends SpaceProperties | ObstructionProperties> = T & {\n\tbevel?: {\n\t\tenabled?: boolean;\n\t\tthickness?: number;\n\t\tsize?: number;\n\t\toffset?: number;\n\t\tsegments?: number;\n\t};\n};\nexport type PolygonFeatureProperties<T extends SpaceProperties | ObstructionProperties> =\n\t| WithEntepriseStyle<T>\n\t| WithPolygonImage<T>\n\t| WithTextures<T>\n\t| WithBevel<T>;\n\nexport type MVFv1PolygonLikeProperties = {\n\tid: string;\n\taltitude?: number;\n\tcolor?: string;\n\texternalId?: string | null;\n\theight?: number;\n\topacity?: number;\n\tlayer?: string;\n\tlevel: string;\n\tparent?: string | null;\n};\n\nexport type MVFv1SpaceProperties = MVFv1PolygonLikeProperties & {\n\tentrances: {\n\t\tlevel: TMap['id'];\n\t\tid: TNode['id'];\n\t}[];\n};\n\nexport type MVFv1ObstructionProperties = MVFv1PolygonLikeProperties;\n\nexport type MVFv1ConnectionProperties = {\n\tid: string;\n\t/**\n\t * Indicates that a connection is accessible\n\t */\n\taccessible: boolean;\n\t/**\n\t * Array of node ids that this Connection connects with.\n\t */\n\tdestinations: string[];\n\tlevel: string;\n\tmultiplier: number;\n\tname: string;\n\t/**\n\t * Type of the connection such as `escalator` or `elevator`\n\t */\n\ttype: string;\n\tweight: number;\n};\n\nexport type MVFv1NodeProperties = {\n\tid: string;\n\t/**\n\t * Indicates that a node is accessible\n\t */\n\taccessible: boolean;\n\t/**\n\t * External id of a node is used to sync and connect to external systems to Mappedin data\n\t */\n\texternalId: string | null;\n\tlevel: string;\n\tmultiplier: number;\n\tneighbors: string[];\n\tweight: number;\n};\n\nexport type MVFv1LevelProperties = {\n\tid: string;\n\tabbreviation?: string;\n\tbuilding?: string;\n\televation?: number;\n\tname: string;\n};\n\nexport type MVFv1ManifestProperties = {\n\t/**\n\t * Name of the venue\n\t */\n\tname: string;\n\tfolder_struct: (ManifestFolder | ManifestFile)[];\n\t/**\n\t * Mappedin Venue Format version number of the MVF bundle\n\t */\n\tversion: string;\n\t/**\n\t * Timestamp when the MVF bundle was generated. E.g. `2022-02-25T16:26:09.908Z`\n\t */\n\ttime: string;\n};\n\nexport type MVFv1BuildingProperties = {\n\tid: string;\n\tname: string;\n\tvenue: string;\n};\n\nexport type MVFv1CategoryProperties = {\n\tid: string;\n\tname: string;\n\tpicture?: TImage;\n};\n\nexport type MVFv1LocationProperties = {\n\tid: string;\n\taddress?: string | null;\n\t/**\n\t * Array of {@link MICategoryProperties | category} ids\n\t */\n\tcategories: string[];\n\t/**\n\t * A text description of the location usually indicating what the location is used for\n\t */\n\tdescription?: string | null;\n\t/**\n\t * Email address to for contacting this location\n\t */\n\temail?: string | null;\n\t/**\n\t * External id used to connect Mappedin Location to an external system\n\t */\n\texternalId?: string | null;\n\t/**\n\t * Opening hours of the location\n\t */\n\thours?: TOpeningHours[] | null;\n\t/**\n\t * Collection of links related to this location\n\t */\n\tlinks?:\n\t\t| {\n\t\t\t\tlabel: string;\n\t\t\t\turl: string;\n\t\t  }[]\n\t\t| null;\n\tlogo?: TImage | null;\n\t/**\n\t * Name of the location. By default this is the string displayed in the location label\n\t */\n\tname: string;\n\t/**\n\t * Phone number for contacting this location\n\t */\n\tphone?: TPhone | null;\n\tpicture?: TImage | null;\n\tservices?: string | null;\n\tsiblingGroups?: TSiblingGroup[] | null;\n\t/**\n\t * Social media links of the location\n\t */\n\tsocial?: TSocial | null;\n\t/**\n\t * Array of {@link MISpaceProperties | MVF Space} ids for this location\n\t */\n\tspaces?:\n\t\t| {\n\t\t\t\tid: string;\n\t\t\t\tmap: string;\n\t\t  }[]\n\t\t| null;\n\tstates?:\n\t\t| {\n\t\t\t\ttype: string;\n\t\t\t\tstart?: string;\n\t\t\t\tend?: string;\n\t\t  }[]\n\t\t| null;\n\ttype: string;\n};\n\nexport type MVFv1ObstructionCollection = FeatureCollection<Polygon, MVFv1ObstructionProperties>;\nexport type MVFv1SpaceCollection = FeatureCollection<Polygon, MVFv1SpaceProperties>;\nexport type MVFv1ConnectionCollection = FeatureCollection<Point, MVFv1ConnectionProperties>;\nexport type MVFv1NodeCollection = FeatureCollection<Point, MVFv1NodeProperties>;\nexport type MVFv1LevelCollection = FeatureCollection<Polygon | MultiPolygon, MVFv1LevelProperties>;\nexport type MVFv1ManifestCollection = FeatureCollection<Point, MVFv1ManifestProperties>;\nexport type MVFv1BuildingCollection = FeatureCollection<Polygon, MVFv1BuildingProperties>;\nexport type MVFv1CategoryCollection = FeatureCollection<null, MVFv1CategoryProperties>;\nexport type MVFv1LocationCollection = FeatureCollection<null, MVFv1LocationProperties>;\n\nexport type ParsedMVFv1 = {\n\t/**\n\t * @propertyNames { \"pattern\": \"^m_[0-9a-z]{16}$\" }\n\t */\n\tspace: {\n\t\t[mapId: MapId]: MVFv1SpaceCollection | undefined;\n\t};\n\t/**\n\t * @propertyNames { \"pattern\": \"^m_[0-9a-z]{16}$\" }\n\t */\n\tobstruction: {\n\t\t[mapId: MapId]: MVFv1ObstructionCollection | undefined;\n\t};\n\t/**\n\t * @propertyNames { \"pattern\": \"^m_[0-9a-z]{16}$\" }\n\t */\n\tlevel: {\n\t\t[mapId: MapId]: MVFv1LevelCollection | undefined;\n\t};\n\t/**\n\t * @propertyNames { \"pattern\": \"^m_[0-9a-z]{16}$\" }\n\t */\n\tnode: {\n\t\t[mapId: MapId]: MVFv1NodeCollection | undefined;\n\t};\n\t/**\n\t * @propertyNames { \"pattern\": \"^m_[0-9a-z]{16}$\" }\n\t */\n\tconnection: {\n\t\t[mapId: MapId]: MVFv1ConnectionCollection | undefined;\n\t};\n\t'manifest.geojson': MVFv1ManifestCollection;\n\t'building.geojson': MVFv1BuildingCollection;\n\t'category.geojson': MVFv1CategoryCollection;\n\t'location.geojson': MVFv1LocationCollection;\n};\n\nexport type RawMVFv1 = {\n\t'manifest.geojson': Uint8Array;\n\t'building.geojson': Uint8Array;\n\t'category.geojson': Uint8Array;\n\t'location.geojson': Uint8Array;\n\tlevel: Partial<Record<MapId, Uint8Array>>;\n\tnode: Partial<Record<MapId, Uint8Array>>;\n\tspace: Partial<Record<MapId, Uint8Array>>;\n\tobstruction: Partial<Record<MapId, Uint8Array>>;\n\tconnection: Partial<Record<MapId, Uint8Array>>;\n};\n\nexport type ObstructionFeature = Feature<LineString | Polygon, ObstructionProperties>;\nexport type ObstructionWallFeature = Feature<LineString, ObstructionProperties>;\nexport type EntranceFeature = Feature<LineString, EntranceProperties>;\n", "import type { ParsedMVFLocalePack, RawMVF, EnterpriseCollection, ParsedMVF } from '@mappedin/mvf-v2/no-validator';\nimport { extractAndConvertMVFv3UnsafeSync } from '@mappedin/mvf-v2/no-validator';\nimport { Logger } from '../common';\nimport { normalizeUrl } from '../common/normalize-url';\nimport type { ParsedMVFv1, RawMVFv1 } from './mvf-types';\nimport {\n\tDEFAULT_V6_URI,\n\ttype Environment,\n\ttype InternalServiceEnvironment,\n\ttype ServiceEnvironment,\n\tgetEnvironmentAuthState,\n} from './constants';\n\nexport * from './tokens/access-token';\nexport * from './tokens/sas-token';\nexport type { Environment, ServiceEnvironment };\nimport * as fflate from 'fflate';\n\nlet fetch: Window['fetch'] = (globalThis as any).fetch;\nconst version = process?.env?.npm_package_version;\n\n/**\n * This is how we can avoid bundling in node-fetch (via isomorphic fetch),\n * which keeps popping up in security advisories\n * This is a pattern that most isomorphic libraries appear to use,\n * where when running in node, you can pass your own fetch function\n * as one is not provided by Node.js.\n *\n */\nexport function isomorphicFetch(): Window['fetch'] {\n\tif (fetch == null) {\n\t\tthrow new Error(\n\t\t\t'fetch is not available in your environment. Pass your own function into `setFetchFn` (node-fetch, etc)',\n\t\t);\n\t}\n\n\treturn fetch;\n}\n\n/**\n * @internal\n * export for test mocking\n */\nexport function __setFetchFn(fn: any) {\n\tfetch = fn;\n}\nexport type TGetVenueOptions = {\n\taccessToken?: string;\n\tclientId?: string;\n\tclientSecret?: string;\n\tbaseUrl?: string;\n\tincludeHidden?: boolean;\n\tnoAuth?: boolean;\n\tperspective?: string;\n\tlanguage?: string;\n\theaders?: {\n\t\t[key in string]: string;\n\t};\n\tvenue: string;\n\t/**\n\t * An object specifying additional properties to fetch for each data item.\n\t * Each key represents a data item (e.g., 'locations', 'nodes'), and the value is an array of strings indicating extra properties to be included.\n\t * @example\n\t * For example:\n\t * ```\n\t * getVenue({\n\t *   venue: 'some-venue',\n\t *   things: { vortexes: [ 'material' ]\n\t * }})\n\t * ```\n\t */\n\tthings?: any;\n\tuseDraftData?: boolean;\n\tplatformString?: string;\n\tsecure?: boolean;\n\tpreloadMapGeometry?: boolean;\n};\n\nexport type TGetVenueBundleOptions = TGetVenueOptions & {\n\tbaseUri?: string;\n\tversion?: string;\n\t/**\n\t * Parse bundle and convert images to blobs. Disabled in React Native\n\t * @private\n\t */\n\tshouldPopulateBundledImagesAsBlobs?: boolean;\n\tmvfVersion?: '2.0.0' | '2.0.0-c' | '3.0.0';\n};\n\n/** @internal */\nexport type TGetVenueMVFOptions = TGetVenueBundleOptions & {\n\tonMVFParsed?: (mvf: ParsedMVF) => void;\n\t/**\n\t * Override initial MVF data\n\t */\n\toverride?: Partial<Pick<ParsedMVF, 'styles.json'>>;\n};\n\n/**\n * Options for configuring search functionality.\n */\nexport type TSearchOptions = {\n\t/**\n\t * Indicates whether search functionality is enabled.\n\t */\n\tenabled: boolean;\n};\n\nexport type TGetMapDataSharedOptions = {\n\t/**\n\t * Mappedin map ID.\n\t */\n\tmapId: string;\n\t/**\n\t * Optionally provide a custom base URL for the Mappedin API request.\n\t * Use the {@link Environment | `environment`} setting to switch environments\n\t */\n\tbaseUri?: string;\n\n\t/**\n\t * Optionally provide a custom base URL for authentication when obtaining an access token.\n\t * Use the {@link Environment | `environment`} setting to switch environments.\n\t */\n\tbaseAuthUri?: string;\n\n\t/**\n\t * Optionally provide an entirely custom URL for authentication when obtaining an access token.\n\t * @hidden\n\t * @internal\n\t */\n\tcustomAuthUri?: string;\n\n\t/**\n\t * Callback for when the Mappedin map data has been fetched and parsed as Mappedin Venue Format (MVF) data.\n\t * @param mvf Parsed MVF data.\n\t */\n\tonMVFParsed?: (mvf: ParsedMVF) => void;\n\n\t/**\n\t * Load different view of mvf data based on configId\n\t */\n\tviewId?: string;\n\n\t/**\n\t * set the target SDK environment\n\t * @default 'us'\n\t * @example\n\t * const mapData = getMapData({\n\t *  key: '',\n\t *  secret: '',\n\t *  environment: 'eu'\n\t * })\n\t */\n\tenvironment?: ServiceEnvironment;\n\n\t/**\n\t * The language of the map data.\n\t * The ISO 639-1 language code to change to (e.g., 'en' for English, 'fr' for French). Check ({@link EnterpriseVenue.languages}) for available languages\n\t */\n\tlanguage?: string;\n\n\t/**\n\t * Whether to use browser's language settings as fallback if the supplied language code is not available.\n\t * @default true\n\t * */\n\tfallbackToNavigatorLanguage?: boolean;\n\n\t/**\n\t * Analytics configuration.\n\t */\n\tanalytics?: {\n\t\t/**\n\t\t * Whether to log analytics events.\n\t\t * @default false\n\t\t */\n\t\tlogEvents?: boolean;\n\t\t/**\n\t\t * Whether to send analytics events to the server.\n\t\t * @default false\n\t\t */\n\t\tsendEvents?: boolean;\n\t\t/**\n\t\t * Custom base URI for analytics requests. If not provided, the default analytics endpoint will be used.\n\t\t * Use the {@link Environment | `environment`} setting to switch environments.\n\t\t */\n\t\tbaseUri?: string;\n\t\t/**\n\t\t * Context for analytics events.\n\t\t * @default 'websdk'\n\t\t * @internal\n\t\t */\n\t\tcontext?: string;\n\t};\n\n\t/*\n\t * Enable Search Capability\n\t */\n\tsearch?: TSearchOptions;\n\n\t/**\n\t * Fetch bearer and SAS tokens for the map ahead of time and keep them up to date in the background.\n\t * @default true\n\t */\n\tprefetchTokens?: boolean;\n\n\t/**\n\t * @hidden\n\t * @internal\n\t */\n\tlayoutId?: 'draft';\n\n\t/**\n\t * @hidden\n\t * @internal\n\t */\n\tmvfVersion?: '2.0.0' | '2.0.0-c' | '3.0.0';\n};\n\n/**\n * @interface\n */\nexport type TGetMapDataWithCredentialsOptions = {\n\t/**\n\t * Mappedin auth key.\n\t */\n\tkey: string;\n\t/**\n\t * Mappedin auth secret.\n\t */\n\tsecret: string;\n} & TGetMapDataSharedOptions;\n\n/**\n * @interface\n */\nexport type TGetMapDataWithAccessTokenOptions = {\n\t/**\n\t * Mappedin access token.\n\t */\n\taccessToken: string;\n} & TGetMapDataSharedOptions;\n\nexport type TGetMapDataOptions = TGetMapDataWithCredentialsOptions | TGetMapDataWithAccessTokenOptions;\n\nexport type TProcessedMVFOptions = TGetMapDataOptions & {\n\tclientId: string;\n\tclientSecret: string;\n\tvenue: string;\n\taccessToken: string;\n};\n\nexport type TAllGetVenueOptions =\n\t| TGetVenueOptions\n\t| TGetVenueMVFOptions\n\t| (TProcessedMVFOptions & { perspective?: string }); // adding perspective prop here for backwards compatibility\n\nexport type TGetVenueOptionsInternal<T extends TAllGetVenueOptions> = Omit<\n\tT & {\n\t\tbaseUrl?: string;\n\t\tsupplementaryUrl?: string;\n\t\tnoAuth?: boolean;\n\t\tincludeHidden?: boolean;\n\t\tapiGateway?: string;\n\t\tauthorization?: string;\n\t\theaders?: any;\n\t},\n\t'things'\n> & { things?: any };\n\nexport const defaultOptions: TGetVenueOptionsInternal<TGetVenueOptions> = {\n\tsupplementaryUrl: 'https://api-gateway.mappedin.com/analytics/',\n\theaders: {},\n\taccessToken: '',\n\tclientId: '',\n\tnoAuth: false,\n\tincludeHidden: true,\n\tclientSecret: '',\n\tapiGateway: '',\n\tauthorization: '',\n\tperspective: 'Website',\n\tlanguage: '',\n\tvenue: '',\n};\n\n/**\n * @internal\n */\nexport function parseOptions<T extends TAllGetVenueOptions>(options: T): TGetVenueOptionsInternal<T> {\n\tconst _options = {\n\t\t...defaultOptions,\n\t\t...options,\n\t};\n\n\t_options.headers = {\n\t\t..._options.headers,\n\t\t'mappedin-sdk-version': version,\n\t};\n\n\t_options.things = [] as any;\n\n\tif ('platformString' in options) {\n\t\t_options.headers = {\n\t\t\t..._options.headers,\n\t\t\t'mappedin-platform-version': options.platformString,\n\t\t};\n\t}\n\n\tif (_options.noAuth) {\n\t\t// Skip auth\n\t} else if (_options.accessToken) {\n\t\t_options.authorization = `Bearer ${_options.accessToken}`;\n\t} else if (_options.clientId && _options.clientSecret) {\n\t\t_options.authorization = `Basic ${(globalThis as any).btoa(`${_options.clientId}:${_options.clientSecret}`)}`;\n\t}\n\n\t// Language code should be case-insensitive\n\t_options.language = _options.language?.toLowerCase();\n\n\treturn _options;\n}\n\n/**\n * Prepares the request and URL fields to pass into generateAPIRequest\n * @param options options from getVenue- baseUrl and supplementaryUrl are used\n * @param url string describing the url corresponding to the client's request\n * @param supplementary whether to use the supplementaryUrl when sending the request\n */\nexport function constructParamsForRequest(\n\toptions: TGetVenueOptionsInternal<TGetVenueOptions>,\n\turl: string,\n\tsupplementary = false,\n) {\n\tconst requestOptions = {\n\t\tlanguage: options.language,\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t};\n\n\tif (supplementary) {\n\t\tdelete requestOptions.language;\n\t}\n\n\tconst { headers } = options;\n\n\theaders['Content-Type'] = headers['Content-Type'] || 'text/json';\n\n\tif (options.accessToken) {\n\t\theaders.Authorization = `Bearer ${options.accessToken}`;\n\t} else if (!options.noAuth) {\n\t\tif (options.clientId && options.clientSecret) {\n\t\t\theaders['x-mappedin-key'] = btoa(options.clientId);\n\t\t\theaders['x-mappedin-secret'] = btoa(options.clientSecret);\n\t\t}\n\t}\n\n\tconst req = {\n\t\tmethod: 'GET',\n\t\theaders,\n\t};\n\n\tif (options.secure) {\n\t\turl += '&withcdntoken';\n\t}\n\n\treturn { req, url };\n}\n\nexport async function generateAPIRequest(\n\toptions: TGetVenueOptionsInternal<TGetVenueOptions>,\n\turl: string,\n\tsupplementary = false,\n) {\n\t/*\n  If not supplementary: fail on a non-OK response\n  If supplementary: always succeed\n  */\n\tconst ret = constructParamsForRequest(options, url, supplementary);\n\n\tconst response = await isomorphicFetch()(ret.url, ret.req);\n\n\tif (!response.ok) {\n\t\tthrow new Error(`${response.status} ${response.statusText}`);\n\t}\n\n\treturn response.json();\n}\n\nexport const getPerspectivesFromResponse = (\n\tres: unknown,\n): Record<string, { url: string; locale_packs: LocalePackUrls }> | null => {\n\tconst availablePerspectives =\n\t\tres != null &&\n\t\ttypeof res === 'object' &&\n\t\t'perspectives' in res &&\n\t\tres.perspectives != null &&\n\t\ttypeof res.perspectives === 'object'\n\t\t\t? res.perspectives\n\t\t\t: null;\n\n\tif (availablePerspectives == null || Object.keys(availablePerspectives).length === 0) {\n\t\tLogger.warn('No perspectives available in response!');\n\n\t\treturn null;\n\t}\n\n\tconst perspectives: Record<string, { url: string; locale_packs: LocalePackUrls }> = {};\n\n\tfor (const [name, perspective] of Object.entries(availablePerspectives)) {\n\t\tconst url = 'url' in perspective && typeof perspective.url === 'string' ? perspective.url : null;\n\t\tconst locale_packs =\n\t\t\t'locale_packs' in perspective && typeof perspective.locale_packs === 'object' ? perspective.locale_packs : null;\n\t\tif (url == null || locale_packs == null) {\n\t\t\tLogger.warn(`Perspective ${name} is missing url or locale_packs!`);\n\t\t\tcontinue;\n\t\t}\n\t\tperspectives[name] = { url, locale_packs };\n\t}\n\n\treturn perspectives;\n};\n\n/**\n * Get the bundle URL and updated_at time.\n * @internal\n */\nexport async function getVenueMVFURL(userOptions: TGetVenueBundleOptions, path = `exports/mvf/1/bundle`) {\n\tconst parsedOptions: TGetVenueOptionsInternal<TGetVenueBundleOptions> = parseOptions({\n\t\tbaseUri: 'https://api-gateway.mappedin.com/',\n\t\t...defaultOptions,\n\t\t...userOptions,\n\t});\n\tconst _url = `${parsedOptions.baseUri + path}?venue=${parsedOptions.venue}&version=${\n\t\tparsedOptions.version ?? '2.0.0'\n\t}`;\n\tparsedOptions.headers['Content-Type'] = 'application/zip';\n\n\tconst res = await generateAPIRequest(parsedOptions, _url);\n\n\tlet url = res.url;\n\tlet localePacks = res.locale_packs;\n\n\t// Try and load a requested perspective\n\tconst requestedPerspective = parsedOptions.perspective ?? defaultOptions.perspective;\n\tconst availablePerspectives = getPerspectivesFromResponse(res);\n\tif (requestedPerspective != null && requestedPerspective !== '' && availablePerspectives != null) {\n\t\tconst perspective = availablePerspectives[requestedPerspective];\n\t\tif (perspective == null) {\n\t\t\tLogger.warn(`Perspective ${requestedPerspective} not found in response! Loading default perspective instead.`);\n\t\t} else {\n\t\t\tLogger.log(`Loading perspective \"${requestedPerspective}\"`);\n\t\t\turl = perspective.url;\n\t\t\tlocalePacks = perspective.locale_packs;\n\t\t}\n\t}\n\n\treturn {\n\t\turl,\n\t\tlocalePacks,\n\t\tupdated_at: res.updated_at,\n\t};\n}\n\nconst getDecoder = (function () {\n\tlet decoder: TextDecoder | undefined;\n\n\treturn (): TextDecoder => {\n\t\tif (!decoder) {\n\t\t\tdecoder = new TextDecoder();\n\t\t}\n\n\t\treturn decoder;\n\t};\n})();\n\nexport async function getLanguagePackUnitArray(url: string, { signal }: { signal: AbortSignal }) {\n\tconst data = await (await isomorphicFetch()(url, { signal })).arrayBuffer();\n\n\treturn new Uint8Array(data);\n}\n\nexport async function parseLanguagePack(data: Uint8Array) {\n\tconst raw = fflate.unzipSync(data);\n\tconst mvfData: ParsedMVFLocalePack = {} as unknown as any;\n\tif (raw['enterprise/'] != null) {\n\t\tmvfData.enterprise = {};\n\t\tconst locationsRaw = raw['enterprise/locations.json'];\n\t\tif (locationsRaw) {\n\t\t\tmvfData.enterprise.locations = JSON.parse(getDecoder().decode(locationsRaw));\n\t\t}\n\t\tconst locationInstancesRaw = raw['enterprise/locationInstances.json'];\n\t\tif (locationInstancesRaw) {\n\t\t\tmvfData.enterprise.locationInstances = JSON.parse(getDecoder().decode(locationInstancesRaw));\n\t\t}\n\t\tconst categoryRaw = raw['enterprise/categories.json'];\n\t\tif (categoryRaw) {\n\t\t\tmvfData.enterprise.categories = JSON.parse(getDecoder().decode(categoryRaw));\n\t\t}\n\t}\n\tif (raw['floorstack.json']) {\n\t\tmvfData['floorstack.json'] = JSON.parse(getDecoder().decode(raw['floorstack.json']));\n\t}\n\tif (raw['floor.geojson']) {\n\t\tmvfData['floor.geojson'] = JSON.parse(getDecoder().decode(raw['floor.geojson']));\n\t}\n\tif (raw['manifest.json']) {\n\t\tmvfData['manifest.geojson'] = JSON.parse(getDecoder().decode(raw['manifest.json']));\n\t}\n\n\treturn mvfData;\n}\n\nexport async function downloadLanguagePack(\n\turl: string,\n\t{ signal }: { signal: AbortSignal },\n): Promise<ParsedMVFLocalePack | undefined> {\n\ttry {\n\t\tconst data = await (await isomorphicFetch()(url, { signal })).arrayBuffer();\n\t\tif (signal.aborted) {\n\t\t\treturn;\n\t\t}\n\t\tconst compressed = new Uint8Array(data);\n\t\tconst mvfData = await parseLanguagePack(compressed);\n\n\t\treturn mvfData;\n\t} catch (e) {\n\t\tconst newError = new Error('downloadLanguagePack failed');\n\t\tnewError.cause = e;\n\t\tthrow newError;\n\t}\n}\n\nexport function getMVFBundlePathAPIGateway(options: { mvfVersion?: string; useDraftData?: boolean }): string {\n\tconst { mvfVersion, useDraftData } = options;\n\tif (mvfVersion === '3.0.0') {\n\t\treturn useDraftData ? `exports/mvf3-draft/1/bundle` : `exports/mvf3/1/bundle`;\n\t} else if (mvfVersion == null || mvfVersion === '2.0.0') {\n\t\treturn useDraftData ? `exports/mvf2-draft/1/bundle` : `exports/mvf2/1/bundle`;\n\t} else if (mvfVersion === '2.0.0-c') {\n\t\t/**\n\t\t * Ben Liu, 2025-09-08\n\t\t *\n\t\t * This is a temporary, special MVF version that indicates an MVF v2 created using the MVF v3 exporter + converter. Eventually.\n\t\t * this should be the default MVF v2, but as there are still some bugs to be resolved with the MVF v3 exporter, the regular MVF\n\t\t * v2 is still made using the legacy exporter.\n\t\t *\n\t\t * TODO: This option should be deprecated once the MVF v3 exporter is stable.\n\t\t */\n\t\treturn useDraftData ? `exports/mvf2c-draft/1/bundle` : `exports/mvf2c/1/bundle`;\n\t} else {\n\t\tthrow new Error(`Unsupported MVF version: ${mvfVersion}`);\n\t}\n}\n\nexport async function downloadVenueBundleMVFAPIGateway(\n\toptions: TGetVenueBundleOptions,\n): Promise<{ compressed: Uint8Array; localePacks: LocalePackUrls }> {\n\treturn new Promise(async (resolve, reject) => {\n\t\ttry {\n\t\t\tconst path = getMVFBundlePathAPIGateway(options);\n\t\t\tconst { url, localePacks } = await getVenueMVFURL(options, path);\n\t\t\tconst data = await isomorphicFetch()(url).then(res => res.arrayBuffer());\n\t\t\tconst compressed = new Uint8Array(data);\n\t\t\tresolve({ compressed, localePacks });\n\t\t} catch (e: any) {\n\t\t\treject(e);\n\t\t}\n\t});\n}\n\nexport async function downloadVenueBundleMVF(options: TGetVenueBundleOptions): Promise<Uint8Array> {\n\treturn new Promise(async (resolve, reject) => {\n\t\ttry {\n\t\t\tconst { url } = await getVenueMVFURL(options);\n\t\t\tconst data = await isomorphicFetch()(url).then(res => res.arrayBuffer());\n\t\t\tconst compressed = new Uint8Array(data);\n\t\t\tresolve(compressed);\n\t\t} catch (e: any) {\n\t\t\treject(e);\n\t\t}\n\t});\n}\n\nexport function parseMVFv1(raw: RawMVFv1): ParsedMVFv1 {\n\t// https://stackoverflow.com/questions/68468203/why-am-i-getting-textencoder-is-not-defined-in-jest\n\tconst decoder = new TextDecoder();\n\tconst decode = decoder.decode.bind(decoder);\n\n\ttry {\n\t\tconst mvfData: ParsedMVFv1 = {\n\t\t\t'manifest.geojson': JSON.parse(decode(raw['manifest.geojson'])),\n\t\t\t'building.geojson': JSON.parse(decode(raw['building.geojson'])),\n\t\t\t'category.geojson': JSON.parse(decode(raw['category.geojson'])),\n\t\t\t'location.geojson': JSON.parse(decode(raw['location.geojson'])),\n\t\t\tobstruction: {},\n\t\t\tspace: {},\n\t\t\tlevel: {},\n\t\t\tnode: {},\n\t\t\tconnection: {},\n\t\t};\n\n\t\tconst spaceFiles = Object.keys(raw.space);\n\t\tfor (const file of spaceFiles) {\n\t\t\tconst trimmedName = file.replace(/\\.json|\\.geojson/g, '');\n\t\t\tmvfData.space[trimmedName] = JSON.parse(decode(raw.space[file]));\n\t\t}\n\n\t\tconst obstructionFiles = Object.keys(raw.obstruction);\n\t\tfor (const file of obstructionFiles) {\n\t\t\tconst trimmedName = file.replace(/\\.json|\\.geojson/g, '');\n\t\t\tmvfData.obstruction[trimmedName] = JSON.parse(decode(raw.obstruction[file]));\n\t\t}\n\n\t\tconst nodeFiles = Object.keys(raw.node);\n\t\tfor (const file of nodeFiles) {\n\t\t\tconst trimmedName = file.replace(/\\.json|\\.geojson/g, '');\n\t\t\tmvfData.node[trimmedName] = JSON.parse(decode(raw.node[file]));\n\t\t}\n\n\t\tconst levelFiles = Object.keys(raw.level);\n\t\tfor (const file of levelFiles) {\n\t\t\tconst trimmedName = file.replace(/\\.json|\\.geojson/g, '');\n\t\t\tmvfData.level[trimmedName] = JSON.parse(decode(raw.level[file]));\n\t\t}\n\n\t\tconst connectionFiles = Object.keys(raw.connection);\n\t\tfor (const file of connectionFiles) {\n\t\t\tconst trimmedName = file.replace(/\\.json|\\.geojson/g, '');\n\t\t\tmvfData.connection[trimmedName] = JSON.parse(decode(raw.connection[file]));\n\t\t}\n\n\t\treturn mvfData;\n\t} catch (e) {\n\t\tLogger.error(e);\n\t\tthrow new Error('MVF parsing failed! Probably encountered a bad file.');\n\t}\n}\n\nexport function validateStaticMVFv1Files(data: unknown) {\n\tif (data == null || typeof data !== 'object') {\n\t\treturn false;\n\t}\n\n\tconst STATIC_MVF_V1_FILES = ['building.geojson', 'category.geojson', 'location.geojson', 'manifest.geojson'] as const;\n\n\tfor (const fileName of STATIC_MVF_V1_FILES) {\n\t\t/**\n\t\t * Checking that the unzipped data is a Uint8Array is our best guess that the data\n\t\t * is correct. At least it matches the typescript definition from @mappedin/mvf.\n\t\t */\n\t\tif (data?.[fileName]?.[Symbol.toStringTag] !== 'Uint8Array') {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\nexport async function unzipMVFv1(data: any): Promise<RawMVFv1> {\n\treturn new Promise(async (resolve, reject) => {\n\t\ttry {\n\t\t\tif (data == null || typeof data !== 'object') {\n\t\t\t\tthrow new Error('Error parsing data! Unzipping failed.');\n\t\t\t}\n\n\t\t\tif (data![Symbol.toStringTag] !== 'Uint8Array') {\n\t\t\t\tthrow new Error('Unexpected file type! Unzipping failed.');\n\t\t\t}\n\n\t\t\tconst decompressed = fflate.unzipSync(data as Uint8Array);\n\n\t\t\tif (!validateStaticMVFv1Files(decompressed)) {\n\t\t\t\tthrow new Error('MVF is missing some expect static files. Unzipping failed.');\n\t\t\t}\n\n\t\t\tconst raw: RawMVFv1 = {\n\t\t\t\t'building.geojson': decompressed['building.geojson'],\n\t\t\t\t'category.geojson': decompressed['category.geojson'],\n\t\t\t\t'location.geojson': decompressed['location.geojson'],\n\t\t\t\t'manifest.geojson': decompressed['manifest.geojson'],\n\t\t\t\tspace: {},\n\t\t\t\tobstruction: {},\n\t\t\t\tnode: {},\n\t\t\t\tlevel: {},\n\t\t\t\tconnection: {},\n\t\t\t};\n\n\t\t\tconst keys = Object.keys(decompressed);\n\t\t\tfor (const fileName of keys) {\n\t\t\t\t// Ignore the file if it has no data\n\t\t\t\tif (decompressed[fileName].length === 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst path = fileName.split('/');\n\n\t\t\t\tif (path.length < 0) {\n\t\t\t\t\tthrow new Error('Encounted a file with no name! Unzipping failed.');\n\t\t\t\t}\n\n\t\t\t\tif (path.length > 2) {\n\t\t\t\t\tthrow new Error('Encountered unexpected nesting in MVF! Unzipping failed.');\n\t\t\t\t}\n\n\t\t\t\t// We can ignore any un-nested files as they should have already been attached above\n\t\t\t\tif (path.length === 1) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * If the file is nested under a folder, construct the nested JSON appropriately\n\t\t\t\t */\n\t\t\t\tif (path[0] === 'image') {\n\t\t\t\t\t// TODO: Handle images\n\t\t\t\t\tLogger.warn('MVF unzipping encountered an image. Ignoring as this case has not been implemented.');\n\t\t\t\t\tcontinue;\n\t\t\t\t} else {\n\t\t\t\t\tif (raw[path[0]] == null) {\n\t\t\t\t\t\traw[path[0]] = {};\n\t\t\t\t\t}\n\t\t\t\t\traw[path[0]][path[1]] = decompressed[fileName];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresolve(raw);\n\t\t} catch (e) {\n\t\t\treject(e);\n\t\t}\n\t});\n}\n\nexport async function downloadMVF(userOptions: TGetMapDataOptions, accessToken: string): Promise<Uint8Array> {\n\treturn new Promise(async (resolve, reject) => {\n\t\ttry {\n\t\t\tconst { url } = await getMakerBundleURL(userOptions, accessToken);\n\n\t\t\tconst data = await isomorphicFetch()(url).then(res => res.arrayBuffer());\n\t\t\tconst compressed = new Uint8Array(data);\n\t\t\tresolve(compressed);\n\t\t} catch (e: any) {\n\t\t\treject(e);\n\t\t}\n\t});\n}\n\nexport async function getMakerBundleURL(userOptions: TGetMapDataOptions, token: string) {\n\tconst url = new URL(\n\t\t`${userOptions.baseUri ? normalizeUrl(userOptions.baseUri) : DEFAULT_V6_URI}api/v1/venue/${userOptions.mapId}/mvf`,\n\t);\n\n\tif (userOptions.viewId) {\n\t\turl.searchParams.set('configId', userOptions.viewId);\n\t}\n\n\tif (userOptions.mvfVersion) {\n\t\turl.searchParams.set('version', userOptions.mvfVersion);\n\t}\n\n\tconst response = await isomorphicFetch()(url.toString(), {\n\t\theaders: {\n\t\t\tAuthorization: `Bearer ${token}`,\n\t\t},\n\t});\n\n\tif (!response.ok) throw new Error(`${response.status} ${response.statusText}`);\n\n\treturn response.json() as unknown as { url: string; updated_at: string };\n}\n\n/**\n * @internal\n */\nexport function parseMVF(raw: RawMVF): ParsedMVF {\n\t// TODO: Replace this entire function with a call to @mappedin/mvf/rawToParsedMVF\n\t// https://stackoverflow.com/questions/68468203/why-am-i-getting-textencoder-is-not-defined-in-jest\n\tconst decoder = new TextDecoder();\n\tconst decode = decoder.decode.bind(decoder);\n\n\ttry {\n\t\tconst mvfData: ParsedMVF = {\n\t\t\t'connection.json': JSON.parse(decode(raw['connection.json'])),\n\t\t\t'manifest.geojson': JSON.parse(decode(raw['manifest.geojson'])),\n\t\t\t// TODO: remove this once map.geojson is deprecated\n\t\t\t'map.geojson': raw['map.geojson'] ? JSON.parse(decode(raw['map.geojson'])) : undefined,\n\t\t\t// TODO: remove this once mapstack.geojson is deprecated\n\t\t\t'mapstack.geojson': raw['mapstack.geojson'] ? JSON.parse(decode(raw['mapstack.geojson'])) : undefined,\n\t\t\t'node.geojson': JSON.parse(decode(raw['node.geojson'])),\n\t\t\tobstruction: {},\n\t\t\tspace: {},\n\t\t\tentrance: {},\n\t\t\tfacade: {},\n\t\t\t'tileset.json': raw['tileset.json'] ? JSON.parse(decode(raw['tileset.json'])) : undefined,\n\t\t\t'navigationFlags.json': raw['navigationFlags.json'] ? JSON.parse(decode(raw['navigationFlags.json'])) : undefined,\n\t\t};\n\n\t\tif (raw.enterprise != null) {\n\t\t\tmvfData.enterprise = {} as EnterpriseCollection;\n\t\t\tif (raw.enterprise?.['locations.json']) {\n\t\t\t\tmvfData.enterprise.locations = JSON.parse(decode(raw.enterprise?.['locations.json']));\n\t\t\t}\n\t\t\tif (raw.enterprise?.['categories.json']) {\n\t\t\t\tmvfData.enterprise.categories = JSON.parse(decode(raw.enterprise?.['categories.json']));\n\t\t\t}\n\t\t\tif (raw.enterprise?.['venue.json']) {\n\t\t\t\tmvfData.enterprise.venue = JSON.parse(decode(raw.enterprise?.['venue.json']));\n\t\t\t}\n\t\t\tif (raw.enterprise?.['layers.json']) {\n\t\t\t\tmvfData.enterprise.layers = JSON.parse(decode(raw.enterprise?.['layers.json']));\n\t\t\t}\n\t\t\tif (raw.enterprise?.['locationInstances.json']) {\n\t\t\t\tmvfData.enterprise.locationInstances = JSON.parse(decode(raw.enterprise?.['locationInstances.json']));\n\t\t\t}\n\t\t\tif (raw.enterprise?.['enterpriseStyles.json']) {\n\t\t\t\tmvfData.enterprise.enterpriseStyles = JSON.parse(decode(raw.enterprise?.['enterpriseStyles.json']));\n\t\t\t}\n\t\t\tif (raw.enterprise?.['textures.json']) {\n\t\t\t\tmvfData.enterprise.textures = JSON.parse(decode(raw.enterprise?.['textures.json']));\n\t\t\t}\n\n\t\t\tif (raw.enterprise?.['floorText.json']) {\n\t\t\t\tmvfData.enterprise.floorText = JSON.parse(decode(raw.enterprise?.['floorText.json']));\n\t\t\t}\n\t\t\tif (raw.enterprise?.['categoryPriorities.json']) {\n\t\t\t\tmvfData.enterprise.categoryPriorities = JSON.parse(decode(raw.enterprise?.['categoryPriorities.json']));\n\t\t\t}\n\t\t}\n\n\t\tif (raw['floorstack.json'] != null) {\n\t\t\tmvfData['floorstack.json'] = JSON.parse(decode(raw['floorstack.json']));\n\t\t} else if (raw['mapstack.json'] != null) {\n\t\t\tmvfData['mapstack.json'] = JSON.parse(decode(raw['mapstack.json']));\n\t\t}\n\n\t\tif (mvfData['floorstack.json'] == null && mvfData['mapstack.json'] == null && mvfData['mapstack.geojson'] == null) {\n\t\t\tthrow new Error('MVF is missing floorstack.json or mapstack.json/mapstack.geojson');\n\t\t}\n\n\t\tif (raw['floor.geojson']) {\n\t\t\tmvfData['floor.geojson'] = JSON.parse(decode(raw['floor.geojson']));\n\t\t}\n\n\t\tif (mvfData['floor.geojson'] == null && mvfData['map.geojson'] == null) {\n\t\t\tthrow new Error('MVF is missing floor.geojson or map.geojson');\n\t\t}\n\n\t\tif ('styles.json' in raw) {\n\t\t\tmvfData['styles.json'] = JSON.parse(decode(raw['styles.json']));\n\t\t}\n\n\t\tif ('shapes.json' in raw) {\n\t\t\tmvfData['shapes.json'] = JSON.parse(decode(raw['shapes.json']));\n\t\t}\n\n\t\tif ('location.json' in raw) {\n\t\t\tmvfData['location.json'] = JSON.parse(decode(raw['location.json']));\n\t\t}\n\n\t\tif ('category.json' in raw) {\n\t\t\tmvfData['category.json'] = JSON.parse(decode(raw['category.json']));\n\t\t}\n\n\t\tif (raw.annotation != null) {\n\t\t\tmvfData.annotation = {};\n\t\t\tconst annotationFiles = Object.keys(raw.annotation);\n\t\t\tfor (const file of annotationFiles) {\n\t\t\t\tconst trimmedName = file.replace(/\\.json|\\.geojson/g, '');\n\t\t\t\tmvfData.annotation![trimmedName] = JSON.parse(decode(raw.annotation[file]));\n\t\t\t}\n\t\t}\n\n\t\tconst spaceFiles = Object.keys(raw.space);\n\t\tfor (const file of spaceFiles) {\n\t\t\tconst trimmedName = file.replace(/\\.json|\\.geojson/g, '');\n\t\t\tmvfData.space[trimmedName] = JSON.parse(decode(raw.space[file]));\n\t\t}\n\n\t\tif (raw.obstruction != null) {\n\t\t\tconst obstructionFiles = Object.keys(raw.obstruction);\n\t\t\tfor (const file of obstructionFiles) {\n\t\t\t\tconst trimmedName = file.replace(/\\.json|\\.geojson/g, '');\n\t\t\t\tmvfData.obstruction[trimmedName] = JSON.parse(decode(raw.obstruction[file]));\n\t\t\t}\n\t\t} else {\n\t\t\tmvfData.obstruction = {};\n\t\t}\n\n\t\tif (raw.entrance != null) {\n\t\t\tconst entranceFiles = Object.keys(raw.entrance);\n\t\t\tfor (const file of entranceFiles) {\n\t\t\t\tconst trimmedName = file.replace(/\\.json|\\.geojson/g, '');\n\t\t\t\tmvfData.entrance[trimmedName] = JSON.parse(decode(raw.entrance[file]));\n\t\t\t}\n\t\t} else {\n\t\t\tmvfData.entrance = {};\n\t\t}\n\n\t\tif ('floorImages' in raw && raw['floorImages'] != null) {\n\t\t\tmvfData.floorImages = {};\n\t\t\tfor (const file of Object.keys(raw.floorImages)) {\n\t\t\t\tconst trimmedName = file.replace(/\\.json|\\.geojson/g, '');\n\t\t\t\tmvfData.floorImages[trimmedName] = JSON.parse(decode(raw.floorImages[file]));\n\t\t\t}\n\t\t}\n\n\t\tif ('textAreas' in raw && raw['textAreas'] != null) {\n\t\t\tmvfData.textAreas = {};\n\t\t\tfor (const file of Object.keys(raw.textAreas)) {\n\t\t\t\tconst trimmedName = file.replace(/\\.json|\\.geojson/g, '');\n\t\t\t\tmvfData.textAreas[trimmedName] = JSON.parse(decode(raw.textAreas[file]));\n\t\t\t}\n\t\t}\n\n\t\tif ('facade' in raw && raw['facade'] != null) {\n\t\t\tmvfData.facade = {};\n\t\t\tfor (const file of Object.keys(raw.facade)) {\n\t\t\t\tconst trimmedName = file.replace(/\\.json|\\.geojson/g, '');\n\t\t\t\tmvfData.facade[trimmedName] = JSON.parse(decode(raw.facade[file]));\n\t\t\t}\n\t\t}\n\n\t\tif ('area' in raw && raw['area'] != null) {\n\t\t\tmvfData.area = {};\n\t\t\tfor (const file of Object.keys(raw.area)) {\n\t\t\t\tconst trimmedName = file.replace(/\\.json|\\.geojson/g, '');\n\t\t\t\tmvfData.area[trimmedName] = JSON.parse(decode(raw.area[file]));\n\t\t\t}\n\t\t}\n\n\t\treturn mvfData;\n\t} catch (e) {\n\t\tLogger.error(e);\n\t\tthrow new Error('MVF parsing failed! Probably encountered a bad file.');\n\t}\n}\n\n/**\n * Figure out if the MVF data at least has the static files we expect.\n */\nexport function validateStaticMVFFiles(data: unknown) {\n\tif (data == null || typeof data !== 'object') {\n\t\treturn false;\n\t}\n\n\tconst STATIC_MVF_FILES = [\n\t\t'connection.json',\n\t\t'manifest.geojson',\n\t\t'floor.geojson' in data ? 'floor.geojson' : 'map.geojson',\n\t\t'node.geojson',\n\t\t'floorstack.json' in data ? 'floorstack.json' : 'mapstack.json' in data ? 'mapstack.json' : 'mapstack.geojson',\n\t];\n\n\t// optional files\n\tif ('styles.json' in data) {\n\t\tSTATIC_MVF_FILES.push('styles.json');\n\t}\n\tif ('shapes.json' in data) {\n\t\tSTATIC_MVF_FILES.push('shapes.json');\n\t}\n\n\tfor (const fileName of STATIC_MVF_FILES) {\n\t\t/**\n\t\t * Checking that the unzipped data is a Uint8Array is our best guess that the data\n\t\t * is correct. At least it matches the typescript definition from @mappedin/mvf.\n\t\t */\n\t\tif (data[fileName] == null || data[fileName][Symbol.toStringTag] !== 'Uint8Array') {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\n/**\n * @internal\n */\nexport async function unzipMVF(data: Uint8Array): Promise<RawMVF> {\n\treturn new Promise(async (resolve, reject) => {\n\t\ttry {\n\t\t\tif (data == null || typeof data !== 'object') {\n\t\t\t\tthrow new Error('Error parsing data! Unzipping failed.');\n\t\t\t}\n\n\t\t\tif (data![Symbol.toStringTag] !== 'Uint8Array') {\n\t\t\t\tthrow new Error('Unexpected file type! Unzipping failed.');\n\t\t\t}\n\n\t\t\tconst decompressed = fflate.unzipSync(data as Uint8Array);\n\n\t\t\tif (!validateStaticMVFFiles(decompressed)) {\n\t\t\t\tthrow new Error('MVF is missing some expect static files. Unzipping failed.');\n\t\t\t}\n\n\t\t\tconst raw = {};\n\t\t\tconst keys = Object.keys(decompressed);\n\t\t\tfor (const fileName of keys) {\n\t\t\t\t// Ignore the file if it has no data\n\t\t\t\tif (decompressed[fileName].length === 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst path = fileName.split('/');\n\n\t\t\t\tif (path.length < 0) {\n\t\t\t\t\tthrow new Error('Encounted a file with no name! Unzipping failed.');\n\t\t\t\t}\n\n\t\t\t\tif (path.length > 2) {\n\t\t\t\t\tthrow new Error('Encountered unexpected nesting in MVF! Unzipping failed.');\n\t\t\t\t}\n\n\t\t\t\t// We can ignore any un-nested files as they should have already been attached above\n\t\t\t\tif (path.length === 1) {\n\t\t\t\t\traw[path[0]] = decompressed[fileName];\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * If the file is nested under a folder, construct the nested JSON appropriately\n\t\t\t\t */\n\t\t\t\tif (path[0] === 'image') {\n\t\t\t\t\t// TODO: Handle images\n\t\t\t\t\tLogger.warn('MVF unzipping encountered an image. Ignoring as this case has not been implemented.');\n\t\t\t\t\tcontinue;\n\t\t\t\t} else {\n\t\t\t\t\tif (raw[path[0]] == null) {\n\t\t\t\t\t\traw[path[0]] = {};\n\t\t\t\t\t}\n\t\t\t\t\traw[path[0]][path[1]] = decompressed[fileName];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresolve(raw as RawMVF);\n\t\t} catch (e) {\n\t\t\treject(e);\n\t\t}\n\t});\n}\n\nexport type LocalePackUrls = {\n\t[key: string]: string;\n};\n\nexport function createEnvControl() {\n\tlet environment: InternalServiceEnvironment = 'us';\n\tlet authOption: Partial<Environment> = {};\n\n\tfunction getState() {\n\t\treturn getAuthStateByEnvironment(getEnvironmentAuthState(environment), authOption);\n\t}\n\n\treturn {\n\t\t/**\n\t\t * @internal\n\t\t */\n\t\tupdateByUserOption(userOption: TGetMapDataOptions) {\n\t\t\tif (userOption.environment) {\n\t\t\t\tenvironment = userOption.environment;\n\t\t\t}\n\t\t\tif (userOption.baseUri) {\n\t\t\t\tauthOption['baseUri'] = userOption.baseUri;\n\t\t\t}\n\t\t\tif (userOption.baseAuthUri) {\n\t\t\t\tauthOption['baseAuthUri'] = userOption.baseAuthUri;\n\t\t\t}\n\t\t\tif (userOption.analytics?.baseUri) {\n\t\t\t\tauthOption['analyticsBaseUri'] = userOption.analytics?.baseUri;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * @internal\n\t\t */\n\t\tupdateTileServerBaseUrl(url: string) {\n\t\t\tauthOption['tileServerUri'] = url;\n\t\t},\n\t\t/**\n\t\t * @internal\n\t\t */\n\t\tupdateEnvironment(env: InternalServiceEnvironment) {\n\t\t\tenvironment = env;\n\t\t},\n\t\t/**\n\t\t * @internal\n\t\t */\n\t\tsetEnterprise(isEnterprise: boolean) {\n\t\t\tif (environment === 'us' || environment === 'us-enterprise') {\n\t\t\t\t// validate and adjust the environment based on the isEnterprise flag\n\t\t\t\tenvironment = isEnterprise ? 'us-enterprise' : 'us';\n\t\t\t}\n\t\t\t// EU is always enterprise, staging environments are not affected\n\t\t},\n\t\tgetBaseUri() {\n\t\t\treturn getState().baseUri;\n\t\t},\n\t\tgetBaseAuthUri() {\n\t\t\treturn getState().baseAuthUri;\n\t\t},\n\t\tgetAnalyticsBaseUri() {\n\t\t\treturn getState().analyticsBaseUri;\n\t\t},\n\t\tgetTileServerUri() {\n\t\t\treturn getState().tileServerUri;\n\t\t},\n\t\treset() {\n\t\t\tenvironment = 'us';\n\t\t\tauthOption = {};\n\t\t},\n\t\t/**\n\t\t * @internal\n\t\t */\n\t\t__getState: getState,\n\t};\n}\nexport type EnvControl = ReturnType<typeof createEnvControl>;\n\nfunction getAuthStateByEnvironment(env: Readonly<Environment>, state: Partial<Environment>): Environment {\n\treturn {\n\t\t...env,\n\t\t...state,\n\t};\n}\n\n/**\n * Return IDs for all individual maps that are part of a multi-building MVF, not including the\n * outdoor map. If a map is not a multi-building map, an empty array is returned.\n */\nexport const getBuildingIds = (mvf: ParsedMVF) => {\n\tconst floorStacks = Object.values(mvf['floorstack.json'] ?? mvf['mapstack.json'] ?? {});\n\tif (floorStacks.length === 1) {\n\t\t// Not multi-building\n\t\treturn [];\n\t}\n\n\treturn floorStacks\n\t\t.filter(floorStack => floorStack.type !== 'Outdoor')\n\t\t.map(floorStack => floorStack.id.replace('fs_', '').replace('ms_', ''));\n};\n\nconst unzipAndParseMVFv3ToMVFv2 = async (data: Uint8Array) => {\n\tconst start = performance.now();\n\tconst maybeMvf = extractAndConvertMVFv3UnsafeSync(data);\n\tLogger.log(`Parsed MVFv3 in ${performance.now() - start}ms`);\n\tmaybeMvf.inspectErr(e => {\n\t\tLogger.error(e);\n\t\tthrow new Error('MVFv3 parsing failed!');\n\t});\n\n\tconst mvf: ParsedMVF = maybeMvf.unwrap();\n\n\treturn mvf;\n};\n\nexport async function unzipAndParseMVFv2(data: Uint8Array, inputVersion = '2.0.0'): Promise<ParsedMVF> {\n\tswitch (inputVersion) {\n\t\tcase '2.0.0':\n\t\tcase '2.0.0-c': {\n\t\t\ttry {\n\t\t\t\tconst raw = await unzipMVF(data);\n\n\t\t\t\treturn parseMVF(raw);\n\t\t\t} catch {\n\t\t\t\t// Try to parse as MVFv3\n\t\t\t\treturn unzipAndParseMVFv3ToMVFv2(data);\n\t\t\t}\n\t\t}\n\t\tcase '3.0.0':\n\t\t\treturn unzipAndParseMVFv3ToMVFv2(data);\n\t\tdefault:\n\t\t\tthrow new Error(`Unsupported MVF version: ${inputVersion}`);\n\t}\n}\n", "export * from './types/geojson.js';\nexport * from './types/core.js';\nexport * from './types/bundle.js';\nexport * from './extensions/index.js';\nexport * from './error.js';\nexport * from './locale.js';\n\nexport { rawToParsedMVF } from './raw-to-parsed.js';\nexport {\n\textractAndConvertMVFv3,\n\textractAndConvertMVFv3Sync,\n\textractAndConvertMVFv3Unsafe,\n\textractAndConvertMVFv3UnsafeSync,\n\tconvertUnzippedStandardMVFv3ToParsedMVFv2,\n} from './converter/index.js';\n", "export {};\n//# sourceMappingURL=geojson.js.map", "export {};\n//# sourceMappingURL=core.js.map", "export {};\n//# sourceMappingURL=bundle.js.map", "export * from './aesthetics.js';\nexport * from './annotation.js';\nexport * from './area.js';\nexport * from './textArea.js';\nexport * from './facade.js';\nexport * from './floorImage.js';\nexport * from './style.js';\nexport * from './window.js';\nexport * from './enterprise.js';\nexport * from './tileset.js';\nexport * from './location.js';\nexport * from './category.js';\nexport * from './navigationFlags.js';\n", "export {};\n//# sourceMappingURL=aesthetics.js.map", "export {};\n//# sourceMappingURL=annotation.js.map", "export {};\n//# sourceMappingURL=area.js.map", "export {};\n//# sourceMappingURL=textArea.js.map", "export {};\n//# sourceMappingURL=facade.js.map", "export {};\n//# sourceMappingURL=floorImage.js.map", "export {};\n//# sourceMappingURL=style.js.map", "export {};\n//# sourceMappingURL=window.js.map", "/**\n * The Mappedin Enterprise Extension\n *\n * Contains data the Enterprise Apps use, in the format generated by Mappedin CMS.\n */\n\nimport type { FloorId, NodeId, ObstructionId, SpaceId } from '../types/core.js';\nimport type { Feature, FeatureCollection, Point } from '../types/geojson.js';\n\n// Utility types\n\n/**\n * A time in the format of HH:MM:SS\n *\n * @pattern ^[0-2][0-9]:[0-6][0-9](:[0-6][0-9])?$\n */\nexport type Time = string;\n\nexport type Day = 'Sunday' | 'Monday' | 'Tuesday' | 'Wednesday' | 'Thursday' | 'Friday' | 'Saturday';\nexport const PUBLIC_HOLIDAYS = 'PublicHolidays';\nexport type DayOrPublicHoliday = Day | typeof PUBLIC_HOLIDAYS;\n/**\n * We (almost) follow this schema (http://schema.org/OpeningHoursSpecification)\n * The only difference is that we (like Google: https://developers.google.com/search/docs/data-types/local-businesses)\n * accept dayOfWeek as an array as well as an individual day.\n * */\nexport type OperationHours = {\n\t/**\n\t * The type of operation hours\n\t *\n\t * @default 'OpeningHoursSpecification'\n\t */\n\t'@type'?: 'OpeningHoursSpecification';\n\t/**\n\t * The time the operation hours start\n\t *\n\t */\n\topens?: Time;\n\t/**\n\t * The time the operation hours end\n\t */\n\tcloses?: Time;\n\n\t/**\n\t * The days of the week the operation hours apply to\n\t */\n\tdayOfWeek?: DayOrPublicHoliday | [DayOrPublicHoliday] | DayOrPublicHoliday[];\n\n\t/**\n\t * The date the operation hours start, in ISO 8601 format\n\t * @format date-time\n\t */\n\tvalidFrom?: string;\n\n\t/**\n\t * The date the operation hours end, in ISO 8601 format\n\t * @format date-time\n\t */\n\tvalidThrough?: string;\n};\n\n/**\n * The state of a location. Start and end dates are optional.\n */\nexport type LocationState = {\n\t/**\n\t * The type of the location state. Technically not limited, but should be one of the following:\n\t * - closed-temporarily\n\t * - new\n\t * - pop-up\n\t * - coming-soon\n\t * - relocated\n\t */\n\ttype: 'closed-temporarily' | 'new' | 'pop-up' | 'coming-soon' | 'relocated' | string;\n\t/**\n\t * The start date of the state\n\t * @format date\n\t */\n\tstart?: string;\n\t/**\n\t * The start date of the state\n\t * @format date\n\t */\n\tend?: string;\n};\n\nexport type SiblingGroup = {\n\tlabel: string;\n\tsiblings: EnterpriseLocationId[];\n};\n\nexport type Language = {\n\tname: string;\n\tcode: string;\n};\n\n/**\n * A collection of extra data, with no validation.\n * All classic x_ properties go here, with the x_ prefix stripped.\n */\nexport type Extras = { extra?: Record<string, unknown> };\n\n// IDs\n/**\n * An ID for an enterprise location\n *\n * **Important**: While the suffix can be any length, it is strongly recommended to use\n * suffixes of at least 8 characters to ensure uniqueness and avoid collisions.\n *\n * @pattern ^el_[A-Za-z0-9_-]+$\n */\nexport type EnterpriseLocationId = string;\n\n/**\n * An ID for an enterprise category\n *\n * **Important**: While the suffix can be any length, it is strongly recommended to use\n * suffixes of at least 8 characters to ensure uniqueness and avoid collisions.\n *\n * @pattern ^ec_[A-Za-z0-9_-]+$\n */\nexport type EnterpriseCategoryId = string;\n\n/**\n * An ID for an enterprise location instance\n *\n * **Important**: While the suffix can be any length, it is strongly recommended to use\n * suffixes of at least 8 characters to ensure uniqueness and avoid collisions.\n *\n * @pattern ^eli_[A-Za-z0-9_-]+$\n */\nexport type EnterpriseLocationInstanceId = string;\n\n// Enterprise types\n\nexport type EnterpriseVenue = {\n\tslug: string;\n\tname: string;\n\texternalId: string;\n\tdefaultLanguage: Language;\n\tlanguages: Language[];\n\n\t/**\n\t * @deprecated Use `defaultFloor` instead\n\t */\n\tdefaultMap?: FloorId;\n\n\t/**\n\t * The venue's default floor\n\t */\n\tdefaultFloor?: FloorId;\n\n\t/**\n\t * The venue's timezone, from the IANA Time Zone Database.\n\t * Should be in the format of `America/New_York`\n\t *\n\t * @pattern ^[A-Za-z0-9\\/_-]+$\n\t */\n\ttzid?: string;\n\n\t/**\n\t * The ISO 3166-1 alpha-2 country code of the venue, if known\n\t *\n\t * Eg. `US` or `GB`\n\t */\n\tcountrycode?: string;\n\n\t/**\n\t * The venue's logo\n\t *\n\t * @format uri\n\t */\n\tlogo?: string;\n\n\t/**\n\t * The venue's icon\n\t *\n\t * @format uri\n\t */\n\ticon?: string;\n\n\t/**\n\t * The venue's cover image\n\t *\n\t * @format uri\n\t */\n\tcoverImage?: string;\n\n\t/**\n\t * The base URL for Mappedin Web for this venue\n\t *\n\t * Better name?\n\t */\n\tmappedinWebUrl?: string;\n\n\ttopLocations?: EnterpriseLocationId[];\n\n\t/**\n\t * When this venue is open.\n\t *  @type array */\n\toperationHours?: Array<OperationHours>;\n} & Extras;\n\n/**\n * @deprecated Use `spaces` instead\n */\ntype LocationNodes = { map: FloorId; id: NodeId }[];\n\n/**\n * The places that this location is anchored to in the physical world. These are either Polygon\n * or Point spaces. A location can be attached to many spaces, and a space can be attached to\n * many locations.\n *\n * If there are different properties for the location on those spaces, they will show up in the location's {@link EnterpriseLocation.instances instances} property.\n */\ntype LocationSpaces = { floor: FloorId; id: SpaceId }[];\n\n/**\n * @deprecated Use `spaces` instead\n */\ntype LocationPolygons = { map: FloorId; id: SpaceId }[];\n\nexport type EnterpriseLocation = {\n\tid: EnterpriseLocationId;\n\tname: string;\n\texternalId: string;\n\ttype: string;\n\tsortOrder: number;\n\n\t/**\n\t *  @deprecated Use `spaces` instead. All of a location's polygons will be in the spaces array.\n\t *  @type array */\n\tpolygons: LocationPolygons;\n\n\t/**\n\t *  @deprecated Use `spaces` instead. A location's nodes that are not attached to a polygon will be in the spaces array as a point space. Nodes that are attached to one of it's polygons will be destinationNodes on that polygon's space\n\t *  @type array */\n\tnodes: LocationNodes;\n\n\t/**\n\t * The places that this location is anchored to in the physical world. These are either Polygon\n\t * or Point spaces. A location can be attached to many spaces, and a space can be attached to\n\t * many locations.\n\t *\n\t * If there are different properties for the location on those spaces, they will show up in the location's {@link EnterpriseLocation.instances instances} property\n\t */\n\tspaces: LocationSpaces;\n\n\tdescription?: string;\n\n\ttags?: Array<string>;\n\tshortName?: string;\n\n\t/**\n\t * The location's logo\n\t *\n\t * @format uri\n\t */\n\tlogo?: string;\n\n\t/**\n\t * The picture of the location\n\t *\n\t * @format uri\n\t */\n\tpicture?: string;\n\n\tphone?: {\n\t\tnumber: string;\n\t\textension?: string;\n\t};\n\n\t/** @type array */\n\toperationHours?: Array<OperationHours>;\n\n\t/**\n\t * The location's social media links\n\t */\n\tsocial?: {\n\t\tfacebook?: string;\n\t\tinstagram?: string;\n\t\ttwitter?: string;\n\t\twebsite?: string;\n\t};\n\n\t// These are being currently requested by our apps, but should not go into MVF.\n\t// color?: unknown;\n\t// filterFlags?: unknown;\n\n\t/**\n\t * The location's state. No more than one state should be active at a time,\n\t * and all but at most one should have dates set\n\t */\n\tstates?: Array<LocationState>;\n\n\t/**\n\t * Locations that are related to this location in some manner (described by the label)\n\t */\n\tsiblingGroups?: Array<SiblingGroup>;\n\n\t/**\n\t * The location's image gallery\n\t */\n\tgallery?: Array<{\n\t\tcaption?: string | null;\n\t\timage: string;\n\t\t/**\n\t\t * The URL to link from the image\n\t\t * @format uri\n\t\t */\n\t\tembeddedUrl?: string | null;\n\t}>;\n\n\t/**\n\t * Whether to show the flat label when an image is present\n\t */\n\tshowFloatingLabelWhenImagePresent?: boolean;\n\n\t/**\n\t * The location's amenity type. Only set if the location is an amenity\n\t */\n\tamenity?: string;\n\n\t/**\n\t * Whether to show the logo of the location\n\t */\n\tshowLogo?: boolean;\n\n\t/**\n\t * Web links for the location\n\t *\n\t * @type array\n\t */\n\tlinks?: Array<{\n\t\tlabel: string;\n\t\t/**\n\t\t * The URL of the link\n\t\t * @format uri\n\t\t */\n\t\turl: string;\n\t}>;\n\n\t/**\n\t * Whether to show the location in applications\n\t */\n\thidden?: boolean;\n\n\t/**\n\t * The main category of the location. It must be one of the categories in the Location's categories array.\n\t */\n\tprimaryCategory?: EnterpriseCategoryId;\n} & Extras;\n\nexport type EnterpriseCategory = {\n\tid: EnterpriseCategoryId;\n\texternalId: string;\n\tname: string;\n\tcolor?: string;\n\tsortOrder: number;\n\tchildren: EnterpriseCategoryId[];\n\tlocations: EnterpriseLocationId[];\n\n\t/**\n\t * The category's icon\n\t *\n\t * @format uri\n\t */\n\ticon?: string;\n\ticonFromDefaultList?: string | null;\n\n\t/**\n\t * The category's picture\n\t *\n\t * @format uri\n\t */\n\tpicture?: string;\n} & Extras;\n\n// Skipped:\n// Vortexes: Only needed for filterFlags. That should be core when we know how to use it\n\n/**\n * A locationInstance is a particular instace of an Enterprise Location that has some properties\n * different from the parent. Eg, it may have different hours, or a slightly different name.\n *\n * A LocationInstance:\n * - MUST have a parent, referring to an Enterprise Location.\n * - MUST have a unique ID, for localization to work.\n * - SHOULD have AT LEAST ONE polygon or node to anchor it in space.\n * - SHOULD have AT LEAST ONE other Enterprise Location property set.\n *\n * It is otherwise a Partial<EnterpriseLocation>\n *\n * Usage examples:\n * - A locationInstance for a location with a different externalId so a customer can identify them individually.\n * - A locationInstance with different operationHours, that might indicate different hours for that particular entrace.\n */\nexport type EnterpriseLocationInstance = Partial<Omit<EnterpriseLocation, 'id' | 'parent'>> & {\n\tid: EnterpriseLocationInstanceId;\n\tparent: EnterpriseLocationId;\n};\n\n/**\n * The ordered list of category ids that this location belongs to\n * The order here determines the priority of the categories, with the first category being the highest priority\n * for determining application logic like icon and color preference.\n * @type array\n */\nexport type EnterpriseCategoryPriority = Record<EnterpriseLocationId, EnterpriseCategoryId[]>;\n\n/**\n * **Important**: While the suffix can be any length, it is strongly recommended to use\n * suffixes of at least 8 characters to ensure uniqueness and avoid collisions.\n *\n * @pattern ^ely_[A-Za-z0-9_-]+$\n */\nexport type EnterpriseLayerId = string;\n\nexport type EnterpriseLayerSpace = { floorId: FloorId; spaceId: SpaceId };\n\nexport type EnterpriseLayer = {\n\tid: EnterpriseLayerId;\n\tname: string;\n\t/**\n\t * @minItems 1\n\t */\n\tspaces: EnterpriseLayerSpace[];\n};\n\nexport type EnterpriseStyles = Record<\n\tstring,\n\t{ edgeOffset?: number; geometryAnchors: { geometryId: SpaceId; floorId: FloorId }[] }\n>;\n\nexport type EnterpriseTextureUV = {\n\tu: number;\n\tv: number;\n};\n\nexport type EnterpriseTextureFace = 'top' | 'side';\nexport type EnterpriseTextureGeometryAnchor = {\n\tgeometryId: SpaceId;\n\tfloorId: FloorId;\n};\nexport type EnterpriseTextureSurface = 'inside' | 'outside' | 'both';\n\nexport type EnterpriseTexture = {\n\t/**\n\t * Controls how many times the texture repeats across the surface.\n\t * The u value controls horizontal repetition and v controls vertical repetition.\n\t */\n\trepeat: EnterpriseTextureUV;\n\t/**\n\t * Controls the starting position of the texture on the surface.\n\t * The u value shifts the texture horizontally and v shifts vertically.\n\t */\n\toffset: EnterpriseTextureUV;\n\t/**\n\t * Rotation of the texture in degrees clockwise.\n\t *\n\t * For top textures this is relative to north. North is 0, east is 90.\n\t *\n\t * For side textures this is relative to the upward direction, with 0 degrees being upright.\n\t *\n\t * @minimum 0\n\t * @maximum 360\n\t */\n\trotation: number;\n\t/**\n\t * Path to the texture image. Must be either a PNG or JPG format.\n\t */\n\tpath: string;\n\t/**\n\t * Face of the polygon that the texture will be applied to.\n\t *\n\t * 'top' means that the texture will be applied to the upward-pointing face of the polygon.\n\t *\n\t * 'side' means that the texture will be applied to every side face of the polygon.\n\t */\n\tface: EnterpriseTextureFace;\n\t/**\n\t * Surface of the polygon that the texture will be applied to.\n\t *\n\t * 'inside' means that the texture will only be applied to the interior surface of the polygon.\n\t *\n\t * 'outside' means that the texture will only be applied to the exterior surface of the polygon.\n\t *\n\t * 'both' means that the texture will be applied to both interior and exterior surfaces of the polygon.\n\t *\n\t */\n\tsurface: EnterpriseTextureSurface;\n\t/**\n\t * Coordinates of the texture's bounding box in format: [minLon, minLat, maxLon, maxLat].\n\t */\n\tbounds: [number, number, number, number];\n\t/**\n\t * Anchors for the texture on the geometry of the polygon.\n\t *\n\t * @minItems 1\n\t */\n\tgeometryAnchors: EnterpriseTextureGeometryAnchor[];\n};\n\n/**\n * Text and some transformations that may be applied to superimpose the text onto a map, which can\n * either be anchored to a specific space or floating.\n */\nexport type FloorTextCommonProperties = {\n\t/**\n\t * The text to display. Newline characters are supported.\n\t */\n\ttext: string;\n\n\t/**\n\t * Whether the text is visible.\n\t *\n\t * @default true\n\t */\n\tvisible: boolean;\n\n\t/**\n\t * The em-height (multiplier of the font's height) at which to render the font, in meters.\n\t * The font height is the distance between the ascender (highest point, height of an A) and descender (lowest point, bottom of a g) of the font.\n\t * For example, if the font-size is 12, the space for a single character will be 12 meters high.\n\t *\n\t * @default 12\n\t */\n\tfontSize: number;\n\n\t/**\n\t * The font family of the text.\n\t *\n\t * @default 'Droid Sans'\n\t */\n\tfontFamily: string;\n\n\t/**\n\t * The color of the text in CSS format (e.g. `#000000`, `rgb(0, 0, 0)`, `black`).\n\t *\n\t * @default 'black'\n\t */\n\tcolor: string;\n\t/**\n\t * Rotation in degrees, about the center of the text. North is 0, east is 90.\n\t *\n\t * @minimum 0\n\t * @maximum 360\n\t */\n\trotation: number;\n\t/**\n\t * Horizontal alignment of multi-line text.\n\t *\n\t * @default 'center'\n\t */\n\talign: 'left' | 'center' | 'right';\n};\n\nexport type AnchoredFloorTextProperties = FloorTextCommonProperties & {\n\t/**\n\t * The geometry to which this text belongs. It will be displayed on top of it.\n\t */\n\tgeometryId: SpaceId | ObstructionId;\n};\n\nexport type FloatingFloorTextProperties = FloorTextCommonProperties & {\n\t/**\n\t * The vertical offset of the text, in meters.\n\t */\n\tverticalOffset: number;\n};\n\nexport type FloorTextProperties = AnchoredFloorTextProperties | FloatingFloorTextProperties;\n\nexport type FloorTextFeature = Feature<Point, FloorTextProperties>;\nexport type AnchoredFloorTextFeature = Feature<Point, AnchoredFloorTextProperties>;\nexport type FloatingFloorTextFeature = Feature<Point, FloatingFloorTextProperties>;\n\n/**\n * A collection of text to be displayed on a map. They are either attached to a space or are floating.\n */\nexport type FloorTextFeatureCollection = FeatureCollection<Point, FloorTextProperties>;\n\n/**\n * The text to display on a map, split into  feature collection per floor.\n */\nexport type EnterpriseFloorText = {\n\t[floorId: FloorId]: FloorTextFeatureCollection | undefined;\n};\n\nexport type EnterpriseCollection = {\n\tlocations: EnterpriseLocation[];\n\tcategories: EnterpriseCategory[];\n\tvenue: EnterpriseVenue;\n\tlocationInstances: EnterpriseLocationInstance[];\n\tlayers: EnterpriseLayer[];\n\tcategoryPriorities?: EnterpriseCategoryPriority;\n\ttextures?: EnterpriseTexture[];\n\tenterpriseStyles?: EnterpriseStyles;\n\tfloorText?: EnterpriseFloorText;\n};\n", "export {};\n//# sourceMappingURL=tileset.js.map", "/**\n * The Mappedin Location Extension\n */\n\nimport type { ConnectionId, EntranceId, FloorId, ObstructionId, SpaceId } from '../types/core.js';\nimport type { AnnotationId } from './annotation.js';\nimport type { AreaId } from './area.js';\nimport type { CategoryId } from './category.js';\nimport type { DayOrPublicHoliday, Time } from './index.js';\n/**\n * An ID for a location\n *\n * **Important**: While the suffix can be any length, it is strongly recommended to use\n * suffixes of at least 8 characters to ensure uniqueness and avoid collisions.\n *\n * @pattern ^loc_[A-Za-z0-9_-]+$\n */\nexport type LocationId = string;\n\nexport type LocationSpaceMapping = {\n\tfloor: FloorId;\n\tid: SpaceId;\n};\n\nexport type LocationObstructionMapping = {\n\tfloor: FloorId;\n\tid: ObstructionId;\n};\n\nexport type LocationEntranceMapping = {\n\tfloor: FloorId;\n\tid: EntranceId;\n};\n\nexport type LocationAnnotationMapping = {\n\tfloor: FloorId;\n\tid: AnnotationId;\n};\n\nexport type LocationAreaMapping = {\n\tfloor: FloorId;\n\tid: AreaId;\n};\n\nexport type LocationSocial = {\n\t/**\n\t * The name of the social media platform.\n\t */\n\tname: string;\n\t/**\n\t * The URL of the social media profile\n\t * @format uri\n\t */\n\turl: string;\n};\n\n/**\n * The location's pictures\n * Single-field object, because it's plausible we might add captions or comments in the future\n */\nexport type LocationPicture = {\n\t/**\n\t * @format uri\n\t */\n\turl?: string;\n};\n\nexport type LocationLink = {\n\tlabel: string;\n\t/**\n\t * The URL of the link\n\t * @format uri\n\t */\n\turl: string;\n};\n\n/**\n * We (almost) follow this schema (http://schema.org/OpeningHoursSpecification)\n * The only difference is that we (like Google: https://developers.google.com/search/docs/data-types/local-businesses)\n * accept dayOfWeek as an array as well as an individual day.\n *\n * Behavioral notes:\n * - if the \"opens\" property is not present, the location is closed, and the closes\n * property is ignored (Schema.org style)\n * - if opens/closes are both set to 00:00, the location is closed (Google style)\n * - If special hours do not specifiy certain weekdays being open, those weekdays are closed.\n * - Not specifying dayOfWeek is equivalent to specifying every day of the week.\n * - we will omit the '@type' property when producing MVFs. But we won't reject 3rd party MVFs\n * that include it.\n * */\nexport type OpeningHoursSpecification = {\n\t/**\n\t * The type of opening hours\n\t *\n\t * @default 'OpeningHoursSpecification'\n\t */\n\t'@type'?: 'OpeningHoursSpecification';\n\t/**\n\t * The time the opening hours start\n\t *\n\t */\n\topens?: Time;\n\t/**\n\t * The time the opening hours end\n\t */\n\tcloses?: Time;\n\n\t/**\n\t * The days of the week the opening hours apply to\n\t */\n\tdayOfWeek?: DayOrPublicHoliday | [DayOrPublicHoliday] | DayOrPublicHoliday[];\n\n\t/**\n\t * The date the opening hours start, in ISO 8601 format\n\t * @format date-time\n\t */\n\tvalidFrom?: string;\n\n\t/**\n\t * The date the opening hours end, in ISO 8601 format\n\t * @format date-time\n\t */\n\tvalidThrough?: string;\n};\n\nexport type Location = {\n\tid: LocationId;\n\tname: string;\n\texternalId?: string;\n\tcategories: CategoryId[];\n\n\tspaces: LocationSpaceMapping[];\n\n\tobstructions: LocationObstructionMapping[];\n\n\tentrances: LocationEntranceMapping[];\n\n\tconnections: ConnectionId[];\n\n\tannotations: LocationAnnotationMapping[];\n\n\tareas: LocationAreaMapping[];\n\n\tdescription?: string;\n\n\t/**\n\t * The location's logo\n\t *\n\t * @format uri\n\t */\n\tlogo?: string;\n\n\tphone?: string;\n\n\t/**\n\t * The location's social media links.\n\t */\n\tsocial: LocationSocial[];\n\n\t/**\n\t * The location's pictures\n\t */\n\tpictures: LocationPicture[];\n\n\t/**\n\t * Web links for the location\n\t */\n\tlinks: LocationLink[];\n\n\t/**\n\t * The location's website\n\t */\n\twebsite?: LocationLink;\n\n\t/**\n\t * The location's opening hours\n\t */\n\topeningHoursSpecification: OpeningHoursSpecification[];\n\n\t/**\n\t * The location's icon, one of picture/category/logo\n\t *\n\t * @format uri\n\t */\n\ticon?: string;\n};\n", "export {};\n//# sourceMappingURL=category.js.map", "import type { Details } from '../types/core.js';\n/**\n * A NavigationFlagDeclaration describes the relationship between a \"key\" that a developer might use to wayfind using that flag, and the index and bit position in an object's `flags` array.\n * Ie, if there is a flag with a key of `vip`, index 1 and bit position 0, then an item with flags as `[0, 0]` does not have the flag, `[0, 1]` does, and `[1, 2]` or `[1, 0]` do not.\n *\n * NavigationFlagDeclarations also may contain details about the flag, which can be displayed to a user if present.\n */\nexport type NavigationFlagDeclaration = {\n\t/**\n\t * The index of the flag in a flags array. ie, 0 means the first bitfield, 1 means the second bitfield, etc.\n\t * @minimum 0\n\t */\n\tindex: number;\n\t/**\n\t * The bit position of the flag in a flag's bitfield. ie, 0 means the first bit, 1 means the second bit, etc.\n\t * A flag bitfield with that bit set to 1 means the flag is present. Other than for Well Known Flags, this is not expected to be durable across different versions of the same MVF.\n\t * @minimum 0\n\t * @maximum 31\n\t */\n\tbit: number;\n\tdetails?: Details;\n};\n\n/**\n * A map of all NavigationFlagDeclarations present in the MVF. The key is the durable value a developer should use to interact with the flag when wayfinding, and the\n * value is the definition of the flag that describes how to determine whether it's set in an object's flags array.\n */\nexport type NavigationFlagDeclarations = {\n\t[key: string]: NavigationFlagDeclaration;\n};\n\n/**\n * A Flags array is an array of 32 bit integers, each representing a bit string of included flags. 1 means the flag is present, 0 means it's not.\n */\nexport type Flags = number[];\n\n/**\n * All well known navigation flags. These may or may not be present in an MVF, but if they are, they always mean the same thing.\n */\nexport const WELL_KNOWN_FLAGS = {\n\t/**\n\t * A flag indicating that something is accessible, specifically that it can be crossed by users with reduced mobility, including those using wheelchairs.\n\t */\n\taccessible: 'accessible',\n\t/**\n\t * A flag indicating that something is outside of a building, in the open air. The sky is NOT NECESSARILY visible, an 'outdoors' path may be under a bridge or awning.\n\t */\n\toutdoors: 'outdoors',\n\t/**\n\t * A flag indicating that something is navigable by the public users of the building or space. By default, consumers of MVF should not route through non-public things unless specifically requested.\n\t */\n\tpublic: 'public',\n} as const;\n", "import type { FacadeId } from './extensions/facade.js';\nimport type {\n\tConnection,\n\tEntranceId,\n\tFloorId,\n\tFloorStack,\n\tNodeId,\n\tNodeProperties,\n\tObstructionId,\n\tObstructionProperties,\n\tSpaceId,\n\tSpaceProperties,\n} from './types/core.js';\n\nexport class IntegrityError extends Error {\n\tconstructor(message: string) {\n\t\tsuper(message);\n\t\tthis.name = 'IntegrityError';\n\t}\n}\n\nexport class FloorStackUnknownMapError extends IntegrityError {\n\tfloorStack: FloorStack;\n\tfloorId: FloorId;\n\n\tconstructor(floorStack: FloorStack, floorId: FloorId) {\n\t\tsuper(\n\t\t\t`Floor stack '${floorStack.id}' contains floor '${floorId}' which is not listed in floor.geojson / map.geojson`,\n\t\t);\n\t\tthis.floorStack = floorStack;\n\t\tthis.floorId = floorId;\n\t}\n}\n\nexport class SpaceCollectionUnknownMapError extends IntegrityError {\n\tfloorId: FloorId;\n\n\tconstructor(floorId: FloorId) {\n\t\tsuper(`A space collection references floor '${floorId}' which does not exist`);\n\t\tthis.floorId = floorId;\n\t}\n}\n\nexport class SpaceUnknownNodeError extends IntegrityError {\n\tspace: SpaceProperties;\n\tnodeId: NodeId;\n\n\tconstructor(space: SpaceProperties, nodeId: NodeId) {\n\t\tsuper(`Space '${space.id}' references a destination node '${nodeId}' which does not exist`);\n\t\tthis.space = space;\n\t\tthis.nodeId = nodeId;\n\t}\n}\n\nexport class ObstructionCollectionUnknownMapError extends IntegrityError {\n\tfloorId: FloorId;\n\n\tconstructor(floorId: FloorId) {\n\t\tsuper(`An obstruction collection references floor '${floorId}' which does not exist`);\n\t\tthis.floorId = floorId;\n\t}\n}\n\nexport class ObstructionUnknownEntranceError extends IntegrityError {\n\tobstruction: ObstructionProperties;\n\tfloorId: FloorId;\n\tentranceId: EntranceId;\n\n\tconstructor(obstruction: ObstructionProperties, floorId: FloorId, entranceId: EntranceId) {\n\t\tsuper(\n\t\t\t`Obstruction '${obstruction.id}' references an entrance '${entranceId}' which does not exist on floor '${floorId}'`,\n\t\t);\n\t\tthis.obstruction = obstruction;\n\t\tthis.floorId = floorId;\n\t\tthis.entranceId = entranceId;\n\t}\n}\n\nexport class ConnectionUnknownNodeError extends IntegrityError {\n\tconnection: Connection;\n\tnodeId: NodeId;\n\n\tconstructor(connection: Connection, nodeId: NodeId) {\n\t\tsuper(`Connection '${connection.id}' references a node '${nodeId}' which does not exist`);\n\t\tthis.connection = connection;\n\t\tthis.nodeId = nodeId;\n\t}\n}\n\nexport class NodeUnknownFloorError extends IntegrityError {\n\tnode: NodeProperties;\n\tfloorId: FloorId;\n\n\tconstructor(node: NodeProperties) {\n\t\tconst floorId = node.floor ?? node.map;\n\t\tsuper(`Node '${node.id}' claims to be on floor '${floorId}' which does not exist`);\n\t\tthis.node = node;\n\t\tthis.floorId = floorId;\n\t}\n}\n\nexport class NodeUnknownSpaceError extends IntegrityError {\n\tnode: NodeProperties;\n\tspaceId: SpaceId;\n\n\tconstructor(node: NodeProperties, spaceId: SpaceId) {\n\t\tsuper(`Node '${node.id}' references a space '${spaceId}' (on floor '${node.map}') which does not exist`);\n\t\tthis.node = node;\n\t\tthis.spaceId = spaceId;\n\t}\n}\n\nexport class NodeUnknownNeighborError extends IntegrityError {\n\tnode: NodeProperties;\n\tneighborId: NodeId;\n\n\tconstructor(node: NodeProperties, neighborId: NodeId) {\n\t\tsuper(`Node '${node.id}' has a neighbor node '${neighborId}' which does not exist`);\n\t\tthis.node = node;\n\t\tthis.neighborId = neighborId;\n\t}\n}\n\nexport class NodeSelfReferenceError extends IntegrityError {\n\tnode: NodeProperties;\n\n\tconstructor(node: NodeProperties) {\n\t\tsuper(`Node '${node.id}' has a self reference in its neighbors list`);\n\t\tthis.node = node;\n\t}\n}\n\nexport class StyleUnknownPolygonError extends IntegrityError {\n\tstyleId: string;\n\tpolygonKind: 'space' | 'obstruction' | 'unknown';\n\tpolygonId: SpaceId | ObstructionId;\n\n\tconstructor(styleId: string, polygonKind: 'space' | 'obstruction' | 'unknown', polygonId: SpaceId | ObstructionId) {\n\t\tsuper(`Style ${styleId} references a ${polygonKind} polygon ${polygonId} which does not exist.`);\n\t\tthis.styleId = styleId;\n\t\tthis.polygonKind = polygonKind;\n\t\tthis.polygonId = polygonId;\n\t}\n}\n\nexport class StyleUnknownLineStringError extends IntegrityError {\n\tstyleId: string;\n\tlineStringKind: 'space' | 'obstruction' | 'entrance' | 'unknown';\n\tlineStringId: SpaceId | ObstructionId | EntranceId;\n\n\tconstructor(\n\t\tstyleId: string,\n\t\tlineStringKind: 'space' | 'obstruction' | 'entrance' | 'unknown',\n\t\tlineStringId: SpaceId | ObstructionId | EntranceId,\n\t) {\n\t\tsuper(`Style ${styleId} references a ${lineStringKind} line string ${lineStringId} which does not exist.`);\n\t\tthis.styleId = styleId;\n\t\tthis.lineStringKind = lineStringKind;\n\t\tthis.lineStringId = lineStringId;\n\t}\n}\n\nexport class StyleUnknownPointError extends IntegrityError {\n\tstyleId: string;\n\tpointKind: 'space';\n\tpointId: SpaceId;\n\n\tconstructor(styleId: string, pointKind: 'space', pointId: SpaceId) {\n\t\tsuper(`Style ${styleId} references a ${pointKind} point ${pointId} which does not exist.`);\n\t\tthis.styleId = styleId;\n\t\tthis.pointKind = pointKind;\n\t\tthis.pointId = pointId;\n\t}\n}\n\nexport class InvalidStyleError extends IntegrityError {\n\tstyleId: string;\n\n\tconstructor(styleId: string) {\n\t\tsuper(`Style ${styleId} does not appear to be a valid polygon or line string style.`);\n\t\tthis.styleId = styleId;\n\t}\n}\n\nexport class AnchoredImageUnknownSpaceError extends IntegrityError {\n\tspaceId: SpaceId;\n\tfloorId: FloorId;\n\n\tconstructor(spaceId: SpaceId, floorId: FloorId) {\n\t\tsuper(`An image for space polygon ${spaceId} is defined, but this polygon does not exist on floor ${floorId}.`);\n\t\tthis.spaceId = spaceId;\n\t\tthis.floorId = floorId;\n\t}\n}\n\nexport class AnchoredFloorTextUnknownSpaceError extends IntegrityError {\n\tspaceId: SpaceId;\n\tfloorId: FloorId;\n\n\tconstructor(spaceId: SpaceId, floorId: FloorId) {\n\t\tsuper(`Text for space ${spaceId} is defined, but this space does not exist on floor ${floorId}.`);\n\t\tthis.spaceId = spaceId;\n\t\tthis.floorId = floorId;\n\t}\n}\n\nexport class AnchoredFloorTextUnknownObstructionError extends IntegrityError {\n\tobstructionId: ObstructionId;\n\tfloorId: FloorId;\n\n\tconstructor(obstructionId: ObstructionId, floorId: FloorId) {\n\t\tsuper(`Text for obstruction ${obstructionId} is defined, but this obstruction does not exist on floor ${floorId}.`);\n\t\tthis.obstructionId = obstructionId;\n\t\tthis.floorId = floorId;\n\t}\n}\n\nexport class AnchoredImageUnknownObstructionError extends IntegrityError {\n\tobstructionId: ObstructionId;\n\tfloorId: FloorId;\n\n\tconstructor(obstructionId: ObstructionId, floorId: FloorId) {\n\t\tsuper(\n\t\t\t`An image for obstruction polygon ${obstructionId} is defined, but this polygon does not exist on floor ${floorId}, or does not have allowed geometry.`,\n\t\t);\n\t\tthis.obstructionId = obstructionId;\n\t\tthis.floorId = floorId;\n\t}\n}\n\nexport class TextAreaUnknownSpaceError extends Error {\n\tspaceId: SpaceId;\n\tfloorId: FloorId;\n\n\tconstructor(spaceId: SpaceId, floorId: FloorId) {\n\t\tsuper(`A text area for space ${spaceId} is defined, but this space does not exist on floor ${floorId}.`);\n\t\tthis.spaceId = spaceId;\n\t\tthis.floorId = floorId;\n\t}\n}\n\nexport class EnterpriseLayerUnknownSpaceError extends Error {\n\tspaceId: SpaceId;\n\tfloorId: FloorId;\n\n\tconstructor(spaceId: SpaceId, floorId: FloorId) {\n\t\tsuper(`A layer with space ${spaceId} is defined, but this space does not exist on floor ${floorId}.`);\n\t\tthis.spaceId = spaceId;\n\t\tthis.floorId = floorId;\n\t}\n}\n\nexport class EnterpriseStyleGeometryAnchorsUnknownSpaceError extends Error {\n\tgeometryId: SpaceId;\n\tfloorId: FloorId;\n\n\tconstructor(geometryId: SpaceId, floorId: FloorId) {\n\t\tsuper(`An enterprise style references a space ${geometryId} which does not exist on floor ${floorId}.`);\n\t\tthis.geometryId = geometryId;\n\t\tthis.floorId = floorId;\n\t}\n}\n\nexport class EnterpriseTextureUnknownSpaceError extends Error {\n\tspaceId: SpaceId;\n\tfloorId: FloorId;\n\n\tconstructor(spaceId: SpaceId, floorId: FloorId) {\n\t\tsuper(`A texture for space ${spaceId} is defined, but this space does not exist on floor ${floorId}.`);\n\t\tthis.spaceId = spaceId;\n\t\tthis.floorId = floorId;\n\t}\n}\n\nexport class TextAreaUnknownObstructionError extends Error {\n\tobstructionId: ObstructionId;\n\tfloorId: FloorId;\n\n\tconstructor(obstructionId: ObstructionId, floorId: FloorId) {\n\t\tsuper(\n\t\t\t`A text area for obstruction ${obstructionId} is defined, but this obstruction does not exist on floor ${floorId}.`,\n\t\t);\n\t\tthis.obstructionId = obstructionId;\n\t\tthis.floorId = floorId;\n\t}\n}\n\nexport class EnterpriseUnknownLocationError extends Error {\n\tconstructor(locationId: string) {\n\t\tsuper(`Enterprise location '${locationId}' does not exist.`);\n\t\tthis.name = 'EnterpriseUnknownLocationError';\n\t}\n}\n\nexport class EnterpriseUnknownMapError extends Error {\n\tconstructor(mapId: string) {\n\t\tsuper(`Enterprise location references unknown map '${mapId}'.`);\n\t\tthis.name = 'EnterpriseUnknownMapError';\n\t}\n}\n\nexport class EnterpriseLocationUnknownSpaceError extends Error {\n\tconstructor(locationId: string, spaceId: string, mapId: string) {\n\t\tsuper(`Enterprise location '${locationId}' references unknown space '${spaceId}' on map '${mapId}'.`);\n\t\tthis.name = 'EnterpriseLocationUnknownSpaceError';\n\t}\n}\n\nexport class EnterpriseUnknownCategoryError extends Error {\n\tconstructor(categoryId: string) {\n\t\tsuper(`Enterprise category '${categoryId}' does not exist.`);\n\t\tthis.name = 'EnterpriseUnknownCategoryError';\n\t}\n}\n\nexport class EnterpriseInconsistentMapError extends Error {\n\tconstructor(locationId: string, spaceOrNodeId: string, mapId1: string, mapId2: string) {\n\t\tsuper(\n\t\t\t`Enterprise location '${locationId}' has an item '${spaceOrNodeId}' that references maps '${mapId1}', but it is actually on '${mapId2}'.`,\n\t\t);\n\t\tthis.name = 'EnterpriseInconsistentMapError';\n\t}\n}\n\nexport class EnterpriseCyclicalCategoryReferenceError extends Error {\n\tconstructor(categoryId: string) {\n\t\tsuper(`Cyclical reference detected in category hierarchy starting from category '${categoryId}'`);\n\t\tthis.name = 'EnterpriseCyclicalCategoryReferenceError';\n\t}\n}\n\nexport class EnterpriseInvalidTimeZoneError extends Error {\n\tconstructor(tzid: string) {\n\t\tsuper(`Invalid timezone '${tzid}'`);\n\t\tthis.name = 'EnterpriseInvalidTimeZoneError';\n\t}\n}\n\nexport class FacadeUnknownFloorStackError extends Error {\n\tconstructor(floorStackId: string) {\n\t\tsuper(`An facade references floor stack '${floorStackId}' which does not exist`);\n\t\tthis.name = 'FacadeUnknownFloorStackError';\n\t}\n}\n\nexport class FacadeUnknownFloorError extends Error {\n\tconstructor(facadeId: FacadeId, floorId: FloorId) {\n\t\tsuper(`Facade '${facadeId}' references floor '${floorId}' which does not exist`);\n\t\tthis.name = 'FacadeUnknownFloorError';\n\t}\n}\n\nexport class FacadeUnknownSpaceError extends Error {\n\tconstructor(facadeId: FacadeId, spaceId: SpaceId, floorId: FloorId) {\n\t\tsuper(`Facade '${facadeId}' references space '${spaceId}' (on floor '${floorId}') which does not exist`);\n\t\tthis.name = 'FacadeUnknownSpaceError';\n\t}\n}\n\nexport class DuplicateTilesetKeyError extends IntegrityError {\n\tconstructor(key: string) {\n\t\tsuper(`Duplicate tileset key found: ${key}`);\n\t\tthis.name = 'DuplicateTilesetKeyError';\n\t}\n}\n", "import { deepDiffOn, deepMergeOn } from '@mappedin/mvf-core';\nimport type {\n\tManifestCollection,\n\tManifestFile,\n\tManifestProperties,\n\tParsedMVF,\n\tParsedMVFLocalePack,\n} from './types/bundle.js';\n\nimport type { PartialExcept } from '@mappedin/mvf-core';\n\n/**\n * Cleans up the folder_struct to only include files and folders that are present as keys in the partial parsed MVF.\n * This is used in cleanUpManifest to remove unnecessary folder_struct entries.\n *\n * We do this instead of re-creating the folder_struct so the locale pack functions do not need to understand\n * what file extensions are used.\n *\n * @param folderStruct - The original folder structure from the manifest of the orginal MVF.\n * @param localePack - A partial ParsedMVF object containing the keys still in the data, usually from a locale pack.\n * @returns A cleaned up folder structure array.\n */\nfunction cleanUpFolderStruct(\n\tfolderStruct: ManifestProperties['folder_struct'],\n\tlocalePack: PartialExcept<ParsedMVF, 'id'>,\n): ManifestProperties['folder_struct'] {\n\tconst result: ManifestProperties['folder_struct'] = [];\n\tfor (const item of folderStruct) {\n\t\t// Check if the file or folder exists in the parsed MVF, with or without the file extension\n\t\tif (!Object.hasOwn(localePack, item.name) && !Object.hasOwn(localePack, item.name.split('.')[0])) {\n\t\t\tcontinue;\n\t\t}\n\t\tif (item.type === 'file') {\n\t\t\tresult.push(item);\n\t\t} else if (item.type === 'folder' && item.name in localePack) {\n\t\t\tconst folder: ManifestFile[] = [];\n\t\t\tconst folderProperty = localePack[item.name as keyof ParsedMVF] as Record<string, unknown>;\n\t\t\tfor (const child of item.children) {\n\t\t\t\tif (\n\t\t\t\t\tObject.hasOwn(folderProperty, child.name) ||\n\t\t\t\t\tObject.hasOwn(folderProperty, child.name.split('.')[0]) // In case the file extension is not present\n\t\t\t\t) {\n\t\t\t\t\tfolder.push(child);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (folder.length > 0) {\n\t\t\t\tresult.push({\n\t\t\t\t\t...item,\n\t\t\t\t\tchildren: folder,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\treturn result;\n}\n\n/**\n * Cleans up the manifest and removes unnecessary folder_struct entries. Used in createLocalePack.\n * Speficially, it removes folder_struct entries that are not present in the locale pack.\n *\n * @param manifest - The original manifest collection.\n * @param localePack - The partial MVF locale pack.\n * @returns A ParsedMVFLocalePack with the correct manifest\n */\nexport function cleanUpManifest(\n\tmanifest: ManifestCollection,\n\tlocalePack: PartialExcept<ParsedMVF, 'id'>,\n): ParsedMVFLocalePack {\n\tconst cleanedManifest: ManifestCollection = {\n\t\t...manifest,\n\t\tfeatures: manifest.features.map((feature) => {\n\t\t\tif (feature.properties && 'folder_struct' in feature.properties) {\n\t\t\t\treturn {\n\t\t\t\t\t...feature,\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\t...feature.properties,\n\t\t\t\t\t\tfolder_struct: cleanUpFolderStruct(feature.properties.folder_struct, localePack),\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn feature;\n\t\t}),\n\t};\n\n\treturn {\n\t\t...localePack,\n\t\t'manifest.geojson': cleanedManifest,\n\t};\n}\n\n/**\n * Merges a partial locale pack into a full ParsedMVF object.\n *\n * This function uses a deep merge strategy to combine the full ParsedMVF with a partial\n * locale pack, preserving the original structure while updating or adding new content\n * from the locale pack.\n *\n * It has special handling for arrays containing \"identifiable objects\" (ie, an object with an\n * 'id' or 'key' property somewhere in it's structure, like a Feature with 'properties.id' or 'properties.key'). In those cases,\n * the merge will only update the objects that have a corresponding 'id' or 'key' in the locale pack, by merging\n * in only the properties that are present in the locale pack.\n *\n * This allows a locale pack to contain updates to only some objects in an array, without having to\n * update every object in the array.\n *\n * Also, this function does NOT have detailed understanding of MVF's structure, outside of the manifest,\n * which should make it robust to changes / additions to MVF in the future.\n *\n * Key features:\n * 1. Clones the original parsed MVF\n * 2. Deep merges objects and arrays, with special handling for arrays containing objects with 'id' or 'key' properties somewhere.\n * 3. Adds new properties from the locale pack that don't exist in the full ParsedMVF.\n * 4. Keeps the original folder_struct from the full ParsedMVF.\n *\n * @param full - The complete ParsedMVF object to merge into.\n * @param partial - The partial ParsedMVFLocalePack containing localized updates.\n * @returns A new ParsedMVF object that is the result of merging the partial locale pack into the full ParsedMVF.\n *\n *\n * @example\n * // Basic merge with enterprise extension\n * // It work with any collection, but this extension is simple to create and read test data for.\n * const full: ParsedMVF = {\n *   'enterprise': {\n *     locations: [\n *       {\n *         id: 'el_store1',\n *         name: 'Clothing Store',\n *         externalId: 'CS001',\n *         type: 'store',\n *         sortOrder: 1,\n *         description: 'A great clothing store',\n *         polygons: [{ map: 'map1', id: 'space1' }],\n *         nodes: [{ map: 'map1', id: 'node1' }]\n *       }\n *     ],\n *     categories: []\n *   }\n * };\n *\n * const partial: ParsedMVFLocalePack = {\n *   'enterprise.json': {\n *     locations: [\n *       {\n *         id: 'el_store1',\n *         name: 'Magasin de V\u00EAtements',\n *         description: 'Un excellent magasin de v\u00EAtements'\n *       }\n *     ]\n *   }\n * };\n *\n * const result = mergeLocalePack(full, partial);\n * // Result:\n * // {\n * //   'enterprise.json': {\n * //     locations: [\n * //       {\n * //         id: 'el_store1',\n * //         name: 'Magasin de V\u00EAtements',\n * //         externalId: 'CS001',\n * //         type: 'store',\n * //         sortOrder: 1,\n * //         description: 'Un excellent magasin de v\u00EAtements',\n * //         polygons: [{ map: 'map1', id: 'space1' }],\n * //         nodes: [{ map: 'map1', id: 'node1' }]\n * //       }\n * //     ],\n * //     categories: []\n * //   }\n * // }\n *\n * @example\n * // Merge with nested arrays containing identifiable objects, showing partial updates\n * const full: ParsedMVF = {\n *   'enterprise.json': {\n *     locations: [\n *       {\n *         id: 'el_store1',\n *         name: 'Store 1',\n *         externalId: 'S1',\n *         type: 'store',\n *         sortOrder: 1,\n *         description: 'A great store',\n *         polygons: [{ map: 'map1', id: 'space1' }],\n *         nodes: [{ map: 'map1', id: 'node1' }]\n *       },\n *       {\n *         id: 'el_store2',\n *         name: 'Store 2',\n *         externalId: 'S2',\n *         type: 'store',\n *         sortOrder: 2,\n *         description: 'Another great store',\n *         polygons: [{ map: 'map1', id: 'space2' }],\n *         nodes: [{ map: 'map1', id: 'node2' }]\n *       }\n *     ]\n *   }\n * };\n *\n * const partial: ParsedMVFLocalePack = {\n *   'enterprise.json': {\n *     locations: [\n *       {\n *         id: 'el_store1',\n *         name: 'Magasin 1',\n *         description: 'Un excellent magasin'\n *       }\n *       // Note: el_store2 is not included because it hasn't changed\n *     ]\n *   }\n * };\n *\n * const result = mergeLocalePack(full, partial);\n * // Result:\n * // {\n * //   'enterprise.json': {\n * //     locations: [\n * //       {\n * //         id: 'el_store1',\n * //         name: 'Magasin 1',\n * //         externalId: 'S1',\n * //         type: 'store',\n * //         sortOrder: 1,\n * //         description: 'Un excellent magasin',\n * //         polygons: [{ map: 'map1', id: 'space1' }],\n * //         nodes: [{ map: 'map1', id: 'node1' }]\n * //       },\n * //       {\n * //         id: 'el_store2',\n * //         name: 'Store 2',\n * //         externalId: 'S2',\n * //         type: 'store',\n * //         sortOrder: 2,\n * //         description: 'Another great store',\n * //         polygons: [{ map: 'map1', id: 'space2' }],\n * //         nodes: [{ map: 'map1', id: 'node2' }]\n * //       }\n * //     ]\n * //   }\n * // }\n *\n * Note: The merging process always preserves the 'id' field and the structure of the\n * 'manifest.geojson' file, ensuring the integrity of the MVF structure while allowing\n * for localized content updates.\n */\nexport function mergeLocalePack(full: ParsedMVF, partial: ParsedMVFLocalePack): ParsedMVF {\n\tconst originalFolderStruct = full['manifest.geojson'].features[0].properties.folder_struct;\n\tconst partialMerge = deepMergeOn(full, partial, ['id']);\n\tconst partialManifest = partial['manifest.geojson'];\n\treturn {\n\t\t...partialMerge,\n\t\t'manifest.geojson': {\n\t\t\ttype: 'FeatureCollection',\n\t\t\tfeatures: [\n\t\t\t\t{\n\t\t\t\t\t...partialManifest.features[0],\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\t...partialManifest.features[0].properties,\n\t\t\t\t\t\tfolder_struct: originalFolderStruct,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t};\n}\n\n/**\n * Creates a partial locale pack by comparing two full ParsedMVF objects.\n *\n * This function generates a ParsedMVFLocalePack by identifying the differences\n * between a base ParsedMVF and a localized ParsedMVF. It's particularly useful\n * for extracting localized content changes from a fully localized MVF.\n *\n * Key features:\n * 1. Compares the base and localized ParsedMVF objects deeply.\n * 2. Includes only the properties and nested objects that differ in the locale pack.\n * 3. Handles arrays of objects with identifier keys, including only changed items.\n * 4. Preserves the structure of changed elements while omitting unchanged ones.\n * 5. Cleans up the manifest to include only relevant folder structure entries.\n *\n * @param base - The original ParsedMVF object to compare against.\n * @param locale - The localized ParsedMVF object containing changes.\n * @returns A ParsedMVFLocalePack containing only the differences between base and locale.\n *\n * @example\n * // Basic creation of a locale pack with enterprise extension\n * const base: ParsedMVF = {\n *   'enterprise.json': {\n *     venue: {\n *       name: 'Shopping Mall',\n *       slug: 'shopping-mall',\n *       externalId: 'SM001',\n *       defaultLanguage: { name: 'English', code: 'en' },\n *       languages: [{ name: 'English', code: 'en' }, { name: 'French', code: 'fr' }]\n *     },\n *     locations: [\n *       {\n *         id: 'el_store1',\n *         name: 'Clothing Store',\n *         externalId: 'CS001',\n *         type: 'store',\n *         sortOrder: 1,\n *         description: 'A great clothing store',\n *         polygons: [{ map: 'map1', id: 'space1' }],\n *         nodes: [{ map: 'map1', id: 'node1' }]\n *       }\n *     ],\n *     categories: []\n *   }\n * };\n *\n * const locale: ParsedMVF = {\n *   'enterprise.json': {\n *     venue: {\n *       name: 'Centre Commercial',\n *       slug: 'shopping-mall',\n *       externalId: 'SM001',\n *       defaultLanguage: { name: 'English', code: 'en' },\n *       languages: [{ name: 'English', code: 'en' }, { name: 'French', code: 'fr' }]\n *     },\n *     locations: [\n *       {\n *         id: 'el_store1',\n *         name: 'Magasin de V\u00EAtements',\n *         externalId: 'CS001',\n *         type: 'store',\n *         sortOrder: 1,\n *         description: 'Un excellent magasin de v\u00EAtements',\n *         polygons: [{ map: 'map1', id: 'space1' }],\n *         nodes: [{ map: 'map1', id: 'node1' }]\n *       }\n *     ],\n *     categories: []\n *   }\n * };\n *\n * const result = createLocalePack(base, locale);\n * // Result:\n * // {\n * //   'enterprise.json': {\n * //     venue: {\n * //       name: 'Centre Commercial'\n * //     },\n * //     locations: [\n * //       {\n * //         id: 'el_store1',\n * //         name: 'Magasin de V\u00EAtements',\n * //         description: 'Un excellent magasin de v\u00EAtements'\n * //       }\n * //     ]\n * //   }\n * // }\n *\n * @example\n * // Creating a locale pack with partial changes in nested arrays\n * const base: ParsedMVF = {\n *   'enterprise.json': {\n *     locations: [\n *       {\n *         id: 'el_store1',\n *         name: 'Store 1',\n *         externalId: 'S1',\n *         type: 'store',\n *         sortOrder: 1,\n *         description: 'A great store',\n *         polygons: [{ map: 'map1', id: 'space1' }],\n *         nodes: [{ map: 'map1', id: 'node1' }]\n *       },\n *       {\n *         id: 'el_store2',\n *         name: 'Store 2',\n *         externalId: 'S2',\n *         type: 'store',\n *         sortOrder: 2,\n *         description: 'Another great store',\n *         polygons: [{ map: 'map1', id: 'space2' }],\n *         nodes: [{ map: 'map1', id: 'node2' }]\n *       }\n *     ]\n *   }\n * };\n *\n * const locale: ParsedMVF = {\n *   'enterprise.json': {\n *     locations: [\n *       {\n *         id: 'el_store1',\n *         name: 'Magasin 1',\n *         externalId: 'S1',\n *         type: 'store',\n *         sortOrder: 1,\n *         description: 'Un excellent magasin',\n *         polygons: [{ map: 'map1', id: 'space1' }],\n *         nodes: [{ map: 'map1', id: 'node1' }]\n *       },\n *       {\n *         id: 'el_store2',\n *         name: 'Store 2',\n *         externalId: 'S2',\n *         type: 'store',\n *         sortOrder: 2,\n *         description: 'Another great store',\n *         polygons: [{ map: 'map1', id: 'space2' }],\n *         nodes: [{ map: 'map1', id: 'node2' }]\n *       }\n *     ]\n *   }\n * };\n *\n * const result = createLocalePack(base, locale);\n * // Result:\n * // {\n * //   'enterprise.json': {\n * //     locations: [\n * //       {\n * //         id: 'el_store1',\n * //         name: 'Magasin 1',\n * //         description: 'Un excellent magasin'\n * //       }\n * //       // Note: el_store2 is not included because it hasn't changed\n * //     ]\n * //   }\n * // }\n *\n * Note: The resulting locale pack includes only the changed properties and\n * maintains the structure necessary for these changes. The manifest is also\n * cleaned up to include only relevant folder structure entries.\n */\nexport function createLocalePack(base: ParsedMVF, locale: ParsedMVF): ParsedMVFLocalePack {\n\tconst localeManifest = locale['manifest.geojson'];\n\tconst diff = deepDiffOn(base, locale, ['id', 'key']);\n\tconst localePack = cleanUpManifest(localeManifest, diff);\n\treturn localePack;\n}\n", null, null, "import { Clone } from './value.mjs';\n/** Clones a Rest */\nexport function CloneRest(schemas) {\n    return schemas.map((schema) => CloneType(schema));\n}\n/** Clones a Type */\nexport function CloneType(schema, options) {\n    return options === undefined ? Clone(schema) : Clone({ ...options, ...schema });\n}\n", "import * as ValueGuard from '../guard/value.mjs';\nfunction ArrayType(value) {\n    return value.map((value) => Visit(value));\n}\nfunction DateType(value) {\n    return new Date(value.getTime());\n}\nfunction Uint8ArrayType(value) {\n    return new Uint8Array(value);\n}\nfunction RegExpType(value) {\n    return new RegExp(value.source, value.flags);\n}\nfunction ObjectType(value) {\n    const result = {};\n    for (const key of Object.getOwnPropertyNames(value)) {\n        result[key] = Visit(value[key]);\n    }\n    for (const key of Object.getOwnPropertySymbols(value)) {\n        result[key] = Visit(value[key]);\n    }\n    return result;\n}\n// prettier-ignore\nfunction Visit(value) {\n    return (ValueGuard.IsArray(value) ? ArrayType(value) :\n        ValueGuard.IsDate(value) ? DateType(value) :\n            ValueGuard.IsUint8Array(value) ? Uint8ArrayType(value) :\n                ValueGuard.IsRegExp(value) ? RegExpType(value) :\n                    ValueGuard.IsObject(value) ? ObjectType(value) :\n                        value);\n}\n/** Clones a value */\nexport function Clone(value) {\n    return Visit(value);\n}\n", "// --------------------------------------------------------------------------\n// PropertyKey\n// --------------------------------------------------------------------------\n/** Returns true if this value has this property key */\nexport function HasPropertyKey(value, key) {\n    return key in value;\n}\n// --------------------------------------------------------------------------\n// Object Instances\n// --------------------------------------------------------------------------\n/** Returns true if this value is an async iterator */\nexport function IsAsyncIterator(value) {\n    return IsObject(value) && !IsArray(value) && !IsUint8Array(value) && Symbol.asyncIterator in value;\n}\n/** Returns true if this value is an array */\nexport function IsArray(value) {\n    return Array.isArray(value);\n}\n/** Returns true if this value is bigint */\nexport function IsBigInt(value) {\n    return typeof value === 'bigint';\n}\n/** Returns true if this value is a boolean */\nexport function IsBoolean(value) {\n    return typeof value === 'boolean';\n}\n/** Returns true if this value is a Date object */\nexport function IsDate(value) {\n    return value instanceof globalThis.Date;\n}\n/** Returns true if this value is a function */\nexport function IsFunction(value) {\n    return typeof value === 'function';\n}\n/** Returns true if this value is an iterator */\nexport function IsIterator(value) {\n    return IsObject(value) && !IsArray(value) && !IsUint8Array(value) && Symbol.iterator in value;\n}\n/** Returns true if this value is null */\nexport function IsNull(value) {\n    return value === null;\n}\n/** Returns true if this value is number */\nexport function IsNumber(value) {\n    return typeof value === 'number';\n}\n/** Returns true if this value is an object */\nexport function IsObject(value) {\n    return typeof value === 'object' && value !== null;\n}\n/** Returns true if this value is RegExp */\nexport function IsRegExp(value) {\n    return value instanceof globalThis.RegExp;\n}\n/** Returns true if this value is string */\nexport function IsString(value) {\n    return typeof value === 'string';\n}\n/** Returns true if this value is symbol */\nexport function IsSymbol(value) {\n    return typeof value === 'symbol';\n}\n/** Returns true if this value is a Uint8Array */\nexport function IsUint8Array(value) {\n    return value instanceof globalThis.Uint8Array;\n}\n/** Returns true if this value is undefined */\nexport function IsUndefined(value) {\n    return value === undefined;\n}\n", "import { TypeSystemPolicy } from '../../system/policy.mjs';\nimport { Immutable } from './immutable.mjs';\nimport { Clone } from '../clone/value.mjs';\n/** Creates TypeBox schematics using the configured InstanceMode */\nexport function CreateType(schema, options) {\n    const result = options !== undefined ? { ...options, ...schema } : schema;\n    switch (TypeSystemPolicy.InstanceMode) {\n        case 'freeze':\n            return Immutable(result);\n        case 'clone':\n            return Clone(result);\n        default:\n            return result;\n    }\n}\n", "import { IsObject, IsArray, IsNumber, IsUndefined } from '../value/guard/index.mjs';\nexport var TypeSystemPolicy;\n(function (TypeSystemPolicy) {\n    // ------------------------------------------------------------------\n    // TypeSystemPolicy: Instancing\n    // ------------------------------------------------------------------\n    /**\n     * Configures the instantiation behavior of TypeBox types. The `default` option assigns raw JavaScript\n     * references for embedded types, which may cause side effects if type properties are explicitly updated\n     * outside the TypeBox type builder. The `clone` option creates copies of any shared types upon creation,\n     * preventing unintended side effects. The `freeze` option applies `Object.freeze()` to the type, making\n     * it fully readonly and immutable. Implementations should use `default` whenever possible, as it is the\n     * fastest way to instantiate types. The default setting is `default`.\n     */\n    TypeSystemPolicy.InstanceMode = 'default';\n    // ------------------------------------------------------------------\n    // TypeSystemPolicy: Checking\n    // ------------------------------------------------------------------\n    /** Sets whether TypeBox should assert optional properties using the TypeScript `exactOptionalPropertyTypes` assertion policy. The default is `false` */\n    TypeSystemPolicy.ExactOptionalPropertyTypes = false;\n    /** Sets whether arrays should be treated as a kind of objects. The default is `false` */\n    TypeSystemPolicy.AllowArrayObject = false;\n    /** Sets whether `NaN` or `Infinity` should be treated as valid numeric values. The default is `false` */\n    TypeSystemPolicy.AllowNaN = false;\n    /** Sets whether `null` should validate for void types. The default is `false` */\n    TypeSystemPolicy.AllowNullVoid = false;\n    /** Checks this value using the ExactOptionalPropertyTypes policy */\n    function IsExactOptionalProperty(value, key) {\n        return TypeSystemPolicy.ExactOptionalPropertyTypes ? key in value : value[key] !== undefined;\n    }\n    TypeSystemPolicy.IsExactOptionalProperty = IsExactOptionalProperty;\n    /** Checks this value using the AllowArrayObjects policy */\n    function IsObjectLike(value) {\n        const isObject = IsObject(value);\n        return TypeSystemPolicy.AllowArrayObject ? isObject : isObject && !IsArray(value);\n    }\n    TypeSystemPolicy.IsObjectLike = IsObjectLike;\n    /** Checks this value as a record using the AllowArrayObjects policy */\n    function IsRecordLike(value) {\n        return IsObjectLike(value) && !(value instanceof Date) && !(value instanceof Uint8Array);\n    }\n    TypeSystemPolicy.IsRecordLike = IsRecordLike;\n    /** Checks this value using the AllowNaN policy */\n    function IsNumberLike(value) {\n        return TypeSystemPolicy.AllowNaN ? IsNumber(value) : Number.isFinite(value);\n    }\n    TypeSystemPolicy.IsNumberLike = IsNumberLike;\n    /** Checks this value using the AllowVoidNull policy */\n    function IsVoidLike(value) {\n        const isUndefined = IsUndefined(value);\n        return TypeSystemPolicy.AllowNullVoid ? isUndefined || value === null : isUndefined;\n    }\n    TypeSystemPolicy.IsVoidLike = IsVoidLike;\n})(TypeSystemPolicy || (TypeSystemPolicy = {}));\n", "// --------------------------------------------------------------------------\n// Iterators\n// --------------------------------------------------------------------------\n/** Returns true if this value is an async iterator */\nexport function IsAsyncIterator(value) {\n    return IsObject(value) && Symbol.asyncIterator in value;\n}\n/** Returns true if this value is an iterator */\nexport function IsIterator(value) {\n    return IsObject(value) && Symbol.iterator in value;\n}\n// --------------------------------------------------------------------------\n// Object Instances\n// --------------------------------------------------------------------------\n/** Returns true if this value is not an instance of a class */\nexport function IsStandardObject(value) {\n    return IsObject(value) && (Object.getPrototypeOf(value) === Object.prototype || Object.getPrototypeOf(value) === null);\n}\n/** Returns true if this value is an instance of a class */\nexport function IsInstanceObject(value) {\n    return IsObject(value) && !IsArray(value) && IsFunction(value.constructor) && value.constructor.name !== 'Object';\n}\n// --------------------------------------------------------------------------\n// JavaScript\n// --------------------------------------------------------------------------\n/** Returns true if this value is a Promise */\nexport function IsPromise(value) {\n    return value instanceof Promise;\n}\n/** Returns true if this value is a Date */\nexport function IsDate(value) {\n    return value instanceof Date && Number.isFinite(value.getTime());\n}\n/** Returns true if this value is an instance of Map<K, T> */\nexport function IsMap(value) {\n    return value instanceof globalThis.Map;\n}\n/** Returns true if this value is an instance of Set<T> */\nexport function IsSet(value) {\n    return value instanceof globalThis.Set;\n}\n/** Returns true if this value is RegExp */\nexport function IsRegExp(value) {\n    return value instanceof globalThis.RegExp;\n}\n/** Returns true if this value is a typed array */\nexport function IsTypedArray(value) {\n    return ArrayBuffer.isView(value);\n}\n/** Returns true if the value is a Int8Array */\nexport function IsInt8Array(value) {\n    return value instanceof globalThis.Int8Array;\n}\n/** Returns true if the value is a Uint8Array */\nexport function IsUint8Array(value) {\n    return value instanceof globalThis.Uint8Array;\n}\n/** Returns true if the value is a Uint8ClampedArray */\nexport function IsUint8ClampedArray(value) {\n    return value instanceof globalThis.Uint8ClampedArray;\n}\n/** Returns true if the value is a Int16Array */\nexport function IsInt16Array(value) {\n    return value instanceof globalThis.Int16Array;\n}\n/** Returns true if the value is a Uint16Array */\nexport function IsUint16Array(value) {\n    return value instanceof globalThis.Uint16Array;\n}\n/** Returns true if the value is a Int32Array */\nexport function IsInt32Array(value) {\n    return value instanceof globalThis.Int32Array;\n}\n/** Returns true if the value is a Uint32Array */\nexport function IsUint32Array(value) {\n    return value instanceof globalThis.Uint32Array;\n}\n/** Returns true if the value is a Float32Array */\nexport function IsFloat32Array(value) {\n    return value instanceof globalThis.Float32Array;\n}\n/** Returns true if the value is a Float64Array */\nexport function IsFloat64Array(value) {\n    return value instanceof globalThis.Float64Array;\n}\n/** Returns true if the value is a BigInt64Array */\nexport function IsBigInt64Array(value) {\n    return value instanceof globalThis.BigInt64Array;\n}\n/** Returns true if the value is a BigUint64Array */\nexport function IsBigUint64Array(value) {\n    return value instanceof globalThis.BigUint64Array;\n}\n// --------------------------------------------------------------------------\n// PropertyKey\n// --------------------------------------------------------------------------\n/** Returns true if this value has this property key */\nexport function HasPropertyKey(value, key) {\n    return key in value;\n}\n// --------------------------------------------------------------------------\n// Standard\n// --------------------------------------------------------------------------\n/** Returns true of this value is an object type */\nexport function IsObject(value) {\n    return value !== null && typeof value === 'object';\n}\n/** Returns true if this value is an array, but not a typed array */\nexport function IsArray(value) {\n    return Array.isArray(value) && !ArrayBuffer.isView(value);\n}\n/** Returns true if this value is an undefined */\nexport function IsUndefined(value) {\n    return value === undefined;\n}\n/** Returns true if this value is an null */\nexport function IsNull(value) {\n    return value === null;\n}\n/** Returns true if this value is an boolean */\nexport function IsBoolean(value) {\n    return typeof value === 'boolean';\n}\n/** Returns true if this value is an number */\nexport function IsNumber(value) {\n    return typeof value === 'number';\n}\n/** Returns true if this value is an integer */\nexport function IsInteger(value) {\n    return Number.isInteger(value);\n}\n/** Returns true if this value is bigint */\nexport function IsBigInt(value) {\n    return typeof value === 'bigint';\n}\n/** Returns true if this value is string */\nexport function IsString(value) {\n    return typeof value === 'string';\n}\n/** Returns true if this value is a function */\nexport function IsFunction(value) {\n    return typeof value === 'function';\n}\n/** Returns true if this value is a symbol */\nexport function IsSymbol(value) {\n    return typeof value === 'symbol';\n}\n/** Returns true if this value is a value type such as number, string, boolean */\nexport function IsValueType(value) {\n    // prettier-ignore\n    return (IsBigInt(value) ||\n        IsBoolean(value) ||\n        IsNull(value) ||\n        IsNumber(value) ||\n        IsString(value) ||\n        IsSymbol(value) ||\n        IsUndefined(value));\n}\n", "import * as ValueGuard from '../guard/value.mjs';\nfunction ImmutableArray(value) {\n    return globalThis.Object.freeze(value).map((value) => Immutable(value));\n}\nfunction ImmutableDate(value) {\n    return value;\n}\nfunction ImmutableUint8Array(value) {\n    return value;\n}\nfunction ImmutableRegExp(value) {\n    return value;\n}\nfunction ImmutableObject(value) {\n    const result = {};\n    for (const key of Object.getOwnPropertyNames(value)) {\n        result[key] = Immutable(value[key]);\n    }\n    for (const key of Object.getOwnPropertySymbols(value)) {\n        result[key] = Immutable(value[key]);\n    }\n    return globalThis.Object.freeze(result);\n}\n/** Specialized deep immutable value. Applies freeze recursively to the given value */\n// prettier-ignore\nexport function Immutable(value) {\n    return (ValueGuard.IsArray(value) ? ImmutableArray(value) :\n        ValueGuard.IsDate(value) ? ImmutableDate(value) :\n            ValueGuard.IsUint8Array(value) ? ImmutableUint8Array(value) :\n                ValueGuard.IsRegExp(value) ? ImmutableRegExp(value) :\n                    ValueGuard.IsObject(value) ? ImmutableObject(value) :\n                        value);\n}\n", "/** The base Error type thrown for all TypeBox exceptions  */\nexport class TypeBoxError extends Error {\n    constructor(message) {\n        super(message);\n    }\n}\n", "export * as KindGuard from './kind.mjs';\nexport * as TypeGuard from './type.mjs';\nexport * as ValueGuard from './value.mjs';\n", "import * as ValueGuard from './value.mjs';\nimport { Kind, Hint, TransformKind, ReadonlyKind, OptionalKind } from '../symbols/index.mjs';\n/** `[Kind-Only]` Returns true if this value has a Readonly symbol */\nexport function IsReadonly(value) {\n    return ValueGuard.IsObject(value) && value[ReadonlyKind] === 'Readonly';\n}\n/** `[Kind-Only]` Returns true if this value has a Optional symbol */\nexport function IsOptional(value) {\n    return ValueGuard.IsObject(value) && value[OptionalKind] === 'Optional';\n}\n/** `[Kind-Only]` Returns true if the given value is TAny */\nexport function IsAny(value) {\n    return IsKindOf(value, 'Any');\n}\n/** `[Kind-Only]` Returns true if the given value is TArray */\nexport function IsArray(value) {\n    return IsKindOf(value, 'Array');\n}\n/** `[Kind-Only]` Returns true if the given value is TAsyncIterator */\nexport function IsAsyncIterator(value) {\n    return IsKindOf(value, 'AsyncIterator');\n}\n/** `[Kind-Only]` Returns true if the given value is TBigInt */\nexport function IsBigInt(value) {\n    return IsKindOf(value, 'BigInt');\n}\n/** `[Kind-Only]` Returns true if the given value is TBoolean */\nexport function IsBoolean(value) {\n    return IsKindOf(value, 'Boolean');\n}\n/** `[Kind-Only]` Returns true if the given value is TConstructor */\nexport function IsConstructor(value) {\n    return IsKindOf(value, 'Constructor');\n}\n/** `[Kind-Only]` Returns true if the given value is TDate */\nexport function IsDate(value) {\n    return IsKindOf(value, 'Date');\n}\n/** `[Kind-Only]` Returns true if the given value is TFunction */\nexport function IsFunction(value) {\n    return IsKindOf(value, 'Function');\n}\n/** `[Kind-Only]` Returns true if the given value is TInteger */\nexport function IsInteger(value) {\n    return IsKindOf(value, 'Integer');\n}\n/** `[Kind-Only]` Returns true if the given schema is TProperties */\nexport function IsProperties(value) {\n    return ValueGuard.IsObject(value);\n}\n/** `[Kind-Only]` Returns true if the given value is TIntersect */\nexport function IsIntersect(value) {\n    return IsKindOf(value, 'Intersect');\n}\n/** `[Kind-Only]` Returns true if the given value is TIterator */\nexport function IsIterator(value) {\n    return IsKindOf(value, 'Iterator');\n}\n/** `[Kind-Only]` Returns true if the given value is a TKind with the given name. */\nexport function IsKindOf(value, kind) {\n    return ValueGuard.IsObject(value) && Kind in value && value[Kind] === kind;\n}\n/** `[Kind-Only]` Returns true if the given value is TLiteral<string> */\nexport function IsLiteralString(value) {\n    return IsLiteral(value) && ValueGuard.IsString(value.const);\n}\n/** `[Kind-Only]` Returns true if the given value is TLiteral<number> */\nexport function IsLiteralNumber(value) {\n    return IsLiteral(value) && ValueGuard.IsNumber(value.const);\n}\n/** `[Kind-Only]` Returns true if the given value is TLiteral<boolean> */\nexport function IsLiteralBoolean(value) {\n    return IsLiteral(value) && ValueGuard.IsBoolean(value.const);\n}\n/** `[Kind-Only]` Returns true if the given value is TLiteral */\nexport function IsLiteral(value) {\n    return IsKindOf(value, 'Literal');\n}\n/** `[Kind-Only]` Returns true if the given value is a TMappedKey */\nexport function IsMappedKey(value) {\n    return IsKindOf(value, 'MappedKey');\n}\n/** `[Kind-Only]` Returns true if the given value is TMappedResult */\nexport function IsMappedResult(value) {\n    return IsKindOf(value, 'MappedResult');\n}\n/** `[Kind-Only]` Returns true if the given value is TNever */\nexport function IsNever(value) {\n    return IsKindOf(value, 'Never');\n}\n/** `[Kind-Only]` Returns true if the given value is TNot */\nexport function IsNot(value) {\n    return IsKindOf(value, 'Not');\n}\n/** `[Kind-Only]` Returns true if the given value is TNull */\nexport function IsNull(value) {\n    return IsKindOf(value, 'Null');\n}\n/** `[Kind-Only]` Returns true if the given value is TNumber */\nexport function IsNumber(value) {\n    return IsKindOf(value, 'Number');\n}\n/** `[Kind-Only]` Returns true if the given value is TObject */\nexport function IsObject(value) {\n    return IsKindOf(value, 'Object');\n}\n/** `[Kind-Only]` Returns true if the given value is TPromise */\nexport function IsPromise(value) {\n    return IsKindOf(value, 'Promise');\n}\n/** `[Kind-Only]` Returns true if the given value is TRecord */\nexport function IsRecord(value) {\n    return IsKindOf(value, 'Record');\n}\n/** `[Kind-Only]` Returns true if this value is TRecursive */\nexport function IsRecursive(value) {\n    return ValueGuard.IsObject(value) && Hint in value && value[Hint] === 'Recursive';\n}\n/** `[Kind-Only]` Returns true if the given value is TRef */\nexport function IsRef(value) {\n    return IsKindOf(value, 'Ref');\n}\n/** `[Kind-Only]` Returns true if the given value is TRegExp */\nexport function IsRegExp(value) {\n    return IsKindOf(value, 'RegExp');\n}\n/** `[Kind-Only]` Returns true if the given value is TString */\nexport function IsString(value) {\n    return IsKindOf(value, 'String');\n}\n/** `[Kind-Only]` Returns true if the given value is TSymbol */\nexport function IsSymbol(value) {\n    return IsKindOf(value, 'Symbol');\n}\n/** `[Kind-Only]` Returns true if the given value is TTemplateLiteral */\nexport function IsTemplateLiteral(value) {\n    return IsKindOf(value, 'TemplateLiteral');\n}\n/** `[Kind-Only]` Returns true if the given value is TThis */\nexport function IsThis(value) {\n    return IsKindOf(value, 'This');\n}\n/** `[Kind-Only]` Returns true of this value is TTransform */\nexport function IsTransform(value) {\n    return ValueGuard.IsObject(value) && TransformKind in value;\n}\n/** `[Kind-Only]` Returns true if the given value is TTuple */\nexport function IsTuple(value) {\n    return IsKindOf(value, 'Tuple');\n}\n/** `[Kind-Only]` Returns true if the given value is TUndefined */\nexport function IsUndefined(value) {\n    return IsKindOf(value, 'Undefined');\n}\n/** `[Kind-Only]` Returns true if the given value is TUnion */\nexport function IsUnion(value) {\n    return IsKindOf(value, 'Union');\n}\n/** `[Kind-Only]` Returns true if the given value is TUint8Array */\nexport function IsUint8Array(value) {\n    return IsKindOf(value, 'Uint8Array');\n}\n/** `[Kind-Only]` Returns true if the given value is TUnknown */\nexport function IsUnknown(value) {\n    return IsKindOf(value, 'Unknown');\n}\n/** `[Kind-Only]` Returns true if the given value is a raw TUnsafe */\nexport function IsUnsafe(value) {\n    return IsKindOf(value, 'Unsafe');\n}\n/** `[Kind-Only]` Returns true if the given value is TVoid */\nexport function IsVoid(value) {\n    return IsKindOf(value, 'Void');\n}\n/** `[Kind-Only]` Returns true if the given value is TKind */\nexport function IsKind(value) {\n    return ValueGuard.IsObject(value) && Kind in value && ValueGuard.IsString(value[Kind]);\n}\n/** `[Kind-Only]` Returns true if the given value is TSchema */\nexport function IsSchema(value) {\n    // prettier-ignore\n    return (IsAny(value) ||\n        IsArray(value) ||\n        IsBoolean(value) ||\n        IsBigInt(value) ||\n        IsAsyncIterator(value) ||\n        IsConstructor(value) ||\n        IsDate(value) ||\n        IsFunction(value) ||\n        IsInteger(value) ||\n        IsIntersect(value) ||\n        IsIterator(value) ||\n        IsLiteral(value) ||\n        IsMappedKey(value) ||\n        IsMappedResult(value) ||\n        IsNever(value) ||\n        IsNot(value) ||\n        IsNull(value) ||\n        IsNumber(value) ||\n        IsObject(value) ||\n        IsPromise(value) ||\n        IsRecord(value) ||\n        IsRef(value) ||\n        IsRegExp(value) ||\n        IsString(value) ||\n        IsSymbol(value) ||\n        IsTemplateLiteral(value) ||\n        IsThis(value) ||\n        IsTuple(value) ||\n        IsUndefined(value) ||\n        IsUnion(value) ||\n        IsUint8Array(value) ||\n        IsUnknown(value) ||\n        IsUnsafe(value) ||\n        IsVoid(value) ||\n        IsKind(value));\n}\n", "/** Symbol key applied to transform types */\nexport const TransformKind = Symbol.for('TypeBox.Transform');\n/** Symbol key applied to readonly types */\nexport const ReadonlyKind = Symbol.for('TypeBox.Readonly');\n/** Symbol key applied to optional types */\nexport const OptionalKind = Symbol.for('TypeBox.Optional');\n/** Symbol key applied to types */\nexport const Hint = Symbol.for('TypeBox.Hint');\n/** Symbol key applied to types */\nexport const Kind = Symbol.for('TypeBox.Kind');\n", "import * as ValueGuard from './value.mjs';\nimport { Kind, Hint, TransformKind, ReadonlyKind, OptionalKind } from '../symbols/index.mjs';\nimport { TypeBoxError } from '../error/index.mjs';\nexport class TypeGuardUnknownTypeError extends TypeBoxError {\n}\nconst KnownTypes = [\n    'Any',\n    'Array',\n    'AsyncIterator',\n    'BigInt',\n    'Boolean',\n    'Constructor',\n    'Date',\n    'Enum',\n    'Function',\n    'Integer',\n    'Intersect',\n    'Iterator',\n    'Literal',\n    'MappedKey',\n    'MappedResult',\n    'Not',\n    'Null',\n    'Number',\n    'Object',\n    'Promise',\n    'Record',\n    'Ref',\n    'RegExp',\n    'String',\n    'Symbol',\n    'TemplateLiteral',\n    'This',\n    'Tuple',\n    'Undefined',\n    'Union',\n    'Uint8Array',\n    'Unknown',\n    'Void',\n];\nfunction IsPattern(value) {\n    try {\n        new RegExp(value);\n        return true;\n    }\n    catch {\n        return false;\n    }\n}\nfunction IsControlCharacterFree(value) {\n    if (!ValueGuard.IsString(value))\n        return false;\n    for (let i = 0; i < value.length; i++) {\n        const code = value.charCodeAt(i);\n        if ((code >= 7 && code <= 13) || code === 27 || code === 127) {\n            return false;\n        }\n    }\n    return true;\n}\nfunction IsAdditionalProperties(value) {\n    return IsOptionalBoolean(value) || IsSchema(value);\n}\nfunction IsOptionalBigInt(value) {\n    return ValueGuard.IsUndefined(value) || ValueGuard.IsBigInt(value);\n}\nfunction IsOptionalNumber(value) {\n    return ValueGuard.IsUndefined(value) || ValueGuard.IsNumber(value);\n}\nfunction IsOptionalBoolean(value) {\n    return ValueGuard.IsUndefined(value) || ValueGuard.IsBoolean(value);\n}\nfunction IsOptionalString(value) {\n    return ValueGuard.IsUndefined(value) || ValueGuard.IsString(value);\n}\nfunction IsOptionalPattern(value) {\n    return ValueGuard.IsUndefined(value) || (ValueGuard.IsString(value) && IsControlCharacterFree(value) && IsPattern(value));\n}\nfunction IsOptionalFormat(value) {\n    return ValueGuard.IsUndefined(value) || (ValueGuard.IsString(value) && IsControlCharacterFree(value));\n}\nfunction IsOptionalSchema(value) {\n    return ValueGuard.IsUndefined(value) || IsSchema(value);\n}\n// ------------------------------------------------------------------\n// Modifiers\n// ------------------------------------------------------------------\n/** Returns true if this value has a Readonly symbol */\nexport function IsReadonly(value) {\n    return ValueGuard.IsObject(value) && value[ReadonlyKind] === 'Readonly';\n}\n/** Returns true if this value has a Optional symbol */\nexport function IsOptional(value) {\n    return ValueGuard.IsObject(value) && value[OptionalKind] === 'Optional';\n}\n// ------------------------------------------------------------------\n// Types\n// ------------------------------------------------------------------\n/** Returns true if the given value is TAny */\nexport function IsAny(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Any') &&\n        IsOptionalString(value.$id));\n}\n/** Returns true if the given value is TArray */\nexport function IsArray(value) {\n    return (IsKindOf(value, 'Array') &&\n        value.type === 'array' &&\n        IsOptionalString(value.$id) &&\n        IsSchema(value.items) &&\n        IsOptionalNumber(value.minItems) &&\n        IsOptionalNumber(value.maxItems) &&\n        IsOptionalBoolean(value.uniqueItems) &&\n        IsOptionalSchema(value.contains) &&\n        IsOptionalNumber(value.minContains) &&\n        IsOptionalNumber(value.maxContains));\n}\n/** Returns true if the given value is TAsyncIterator */\nexport function IsAsyncIterator(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'AsyncIterator') &&\n        value.type === 'AsyncIterator' &&\n        IsOptionalString(value.$id) &&\n        IsSchema(value.items));\n}\n/** Returns true if the given value is TBigInt */\nexport function IsBigInt(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'BigInt') &&\n        value.type === 'bigint' &&\n        IsOptionalString(value.$id) &&\n        IsOptionalBigInt(value.exclusiveMaximum) &&\n        IsOptionalBigInt(value.exclusiveMinimum) &&\n        IsOptionalBigInt(value.maximum) &&\n        IsOptionalBigInt(value.minimum) &&\n        IsOptionalBigInt(value.multipleOf));\n}\n/** Returns true if the given value is TBoolean */\nexport function IsBoolean(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Boolean') &&\n        value.type === 'boolean' &&\n        IsOptionalString(value.$id));\n}\n/** Returns true if the given value is TConstructor */\nexport function IsConstructor(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Constructor') &&\n        value.type === 'Constructor' &&\n        IsOptionalString(value.$id) &&\n        ValueGuard.IsArray(value.parameters) &&\n        value.parameters.every(schema => IsSchema(schema)) &&\n        IsSchema(value.returns));\n}\n/** Returns true if the given value is TDate */\nexport function IsDate(value) {\n    return (IsKindOf(value, 'Date') &&\n        value.type === 'Date' &&\n        IsOptionalString(value.$id) &&\n        IsOptionalNumber(value.exclusiveMaximumTimestamp) &&\n        IsOptionalNumber(value.exclusiveMinimumTimestamp) &&\n        IsOptionalNumber(value.maximumTimestamp) &&\n        IsOptionalNumber(value.minimumTimestamp) &&\n        IsOptionalNumber(value.multipleOfTimestamp));\n}\n/** Returns true if the given value is TFunction */\nexport function IsFunction(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Function') &&\n        value.type === 'Function' &&\n        IsOptionalString(value.$id) &&\n        ValueGuard.IsArray(value.parameters) &&\n        value.parameters.every(schema => IsSchema(schema)) &&\n        IsSchema(value.returns));\n}\n/** Returns true if the given value is TInteger */\nexport function IsInteger(value) {\n    return (IsKindOf(value, 'Integer') &&\n        value.type === 'integer' &&\n        IsOptionalString(value.$id) &&\n        IsOptionalNumber(value.exclusiveMaximum) &&\n        IsOptionalNumber(value.exclusiveMinimum) &&\n        IsOptionalNumber(value.maximum) &&\n        IsOptionalNumber(value.minimum) &&\n        IsOptionalNumber(value.multipleOf));\n}\n/** Returns true if the given schema is TProperties */\nexport function IsProperties(value) {\n    // prettier-ignore\n    return (ValueGuard.IsObject(value) &&\n        Object.entries(value).every(([key, schema]) => IsControlCharacterFree(key) && IsSchema(schema)));\n}\n/** Returns true if the given value is TIntersect */\nexport function IsIntersect(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Intersect') &&\n        (ValueGuard.IsString(value.type) && value.type !== 'object' ? false : true) &&\n        ValueGuard.IsArray(value.allOf) &&\n        value.allOf.every(schema => IsSchema(schema) && !IsTransform(schema)) &&\n        IsOptionalString(value.type) &&\n        (IsOptionalBoolean(value.unevaluatedProperties) || IsOptionalSchema(value.unevaluatedProperties)) &&\n        IsOptionalString(value.$id));\n}\n/** Returns true if the given value is TIterator */\nexport function IsIterator(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Iterator') &&\n        value.type === 'Iterator' &&\n        IsOptionalString(value.$id) &&\n        IsSchema(value.items));\n}\n/** Returns true if the given value is a TKind with the given name. */\nexport function IsKindOf(value, kind) {\n    return ValueGuard.IsObject(value) && Kind in value && value[Kind] === kind;\n}\n/** Returns true if the given value is TLiteral<string> */\nexport function IsLiteralString(value) {\n    return IsLiteral(value) && ValueGuard.IsString(value.const);\n}\n/** Returns true if the given value is TLiteral<number> */\nexport function IsLiteralNumber(value) {\n    return IsLiteral(value) && ValueGuard.IsNumber(value.const);\n}\n/** Returns true if the given value is TLiteral<boolean> */\nexport function IsLiteralBoolean(value) {\n    return IsLiteral(value) && ValueGuard.IsBoolean(value.const);\n}\n/** Returns true if the given value is TLiteral */\nexport function IsLiteral(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Literal') &&\n        IsOptionalString(value.$id) && IsLiteralValue(value.const));\n}\n/** Returns true if the given value is a TLiteralValue */\nexport function IsLiteralValue(value) {\n    return ValueGuard.IsBoolean(value) || ValueGuard.IsNumber(value) || ValueGuard.IsString(value);\n}\n/** Returns true if the given value is a TMappedKey */\nexport function IsMappedKey(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'MappedKey') &&\n        ValueGuard.IsArray(value.keys) &&\n        value.keys.every(key => ValueGuard.IsNumber(key) || ValueGuard.IsString(key)));\n}\n/** Returns true if the given value is TMappedResult */\nexport function IsMappedResult(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'MappedResult') &&\n        IsProperties(value.properties));\n}\n/** Returns true if the given value is TNever */\nexport function IsNever(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Never') &&\n        ValueGuard.IsObject(value.not) &&\n        Object.getOwnPropertyNames(value.not).length === 0);\n}\n/** Returns true if the given value is TNot */\nexport function IsNot(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Not') &&\n        IsSchema(value.not));\n}\n/** Returns true if the given value is TNull */\nexport function IsNull(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Null') &&\n        value.type === 'null' &&\n        IsOptionalString(value.$id));\n}\n/** Returns true if the given value is TNumber */\nexport function IsNumber(value) {\n    return (IsKindOf(value, 'Number') &&\n        value.type === 'number' &&\n        IsOptionalString(value.$id) &&\n        IsOptionalNumber(value.exclusiveMaximum) &&\n        IsOptionalNumber(value.exclusiveMinimum) &&\n        IsOptionalNumber(value.maximum) &&\n        IsOptionalNumber(value.minimum) &&\n        IsOptionalNumber(value.multipleOf));\n}\n/** Returns true if the given value is TObject */\nexport function IsObject(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Object') &&\n        value.type === 'object' &&\n        IsOptionalString(value.$id) &&\n        IsProperties(value.properties) &&\n        IsAdditionalProperties(value.additionalProperties) &&\n        IsOptionalNumber(value.minProperties) &&\n        IsOptionalNumber(value.maxProperties));\n}\n/** Returns true if the given value is TPromise */\nexport function IsPromise(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Promise') &&\n        value.type === 'Promise' &&\n        IsOptionalString(value.$id) &&\n        IsSchema(value.item));\n}\n/** Returns true if the given value is TRecord */\nexport function IsRecord(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Record') &&\n        value.type === 'object' &&\n        IsOptionalString(value.$id) &&\n        IsAdditionalProperties(value.additionalProperties) &&\n        ValueGuard.IsObject(value.patternProperties) &&\n        ((schema) => {\n            const keys = Object.getOwnPropertyNames(schema.patternProperties);\n            return (keys.length === 1 &&\n                IsPattern(keys[0]) &&\n                ValueGuard.IsObject(schema.patternProperties) &&\n                IsSchema(schema.patternProperties[keys[0]]));\n        })(value));\n}\n/** Returns true if this value is TRecursive */\nexport function IsRecursive(value) {\n    return ValueGuard.IsObject(value) && Hint in value && value[Hint] === 'Recursive';\n}\n/** Returns true if the given value is TRef */\nexport function IsRef(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Ref') &&\n        IsOptionalString(value.$id) &&\n        ValueGuard.IsString(value.$ref));\n}\n/** Returns true if the given value is TRegExp */\nexport function IsRegExp(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'RegExp') &&\n        IsOptionalString(value.$id) &&\n        ValueGuard.IsString(value.source) &&\n        ValueGuard.IsString(value.flags) &&\n        IsOptionalNumber(value.maxLength) &&\n        IsOptionalNumber(value.minLength));\n}\n/** Returns true if the given value is TString */\nexport function IsString(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'String') &&\n        value.type === 'string' &&\n        IsOptionalString(value.$id) &&\n        IsOptionalNumber(value.minLength) &&\n        IsOptionalNumber(value.maxLength) &&\n        IsOptionalPattern(value.pattern) &&\n        IsOptionalFormat(value.format));\n}\n/** Returns true if the given value is TSymbol */\nexport function IsSymbol(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Symbol') &&\n        value.type === 'symbol' &&\n        IsOptionalString(value.$id));\n}\n/** Returns true if the given value is TTemplateLiteral */\nexport function IsTemplateLiteral(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'TemplateLiteral') &&\n        value.type === 'string' &&\n        ValueGuard.IsString(value.pattern) &&\n        value.pattern[0] === '^' &&\n        value.pattern[value.pattern.length - 1] === '$');\n}\n/** Returns true if the given value is TThis */\nexport function IsThis(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'This') &&\n        IsOptionalString(value.$id) &&\n        ValueGuard.IsString(value.$ref));\n}\n/** Returns true of this value is TTransform */\nexport function IsTransform(value) {\n    return ValueGuard.IsObject(value) && TransformKind in value;\n}\n/** Returns true if the given value is TTuple */\nexport function IsTuple(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Tuple') &&\n        value.type === 'array' &&\n        IsOptionalString(value.$id) &&\n        ValueGuard.IsNumber(value.minItems) &&\n        ValueGuard.IsNumber(value.maxItems) &&\n        value.minItems === value.maxItems &&\n        (( // empty\n        ValueGuard.IsUndefined(value.items) &&\n            ValueGuard.IsUndefined(value.additionalItems) &&\n            value.minItems === 0) || (ValueGuard.IsArray(value.items) &&\n            value.items.every(schema => IsSchema(schema)))));\n}\n/** Returns true if the given value is TUndefined */\nexport function IsUndefined(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Undefined') &&\n        value.type === 'undefined' &&\n        IsOptionalString(value.$id));\n}\n/** Returns true if the given value is TUnion<Literal<string | number>[]> */\nexport function IsUnionLiteral(value) {\n    return IsUnion(value) && value.anyOf.every((schema) => IsLiteralString(schema) || IsLiteralNumber(schema));\n}\n/** Returns true if the given value is TUnion */\nexport function IsUnion(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Union') &&\n        IsOptionalString(value.$id) &&\n        ValueGuard.IsObject(value) &&\n        ValueGuard.IsArray(value.anyOf) &&\n        value.anyOf.every(schema => IsSchema(schema)));\n}\n/** Returns true if the given value is TUint8Array */\nexport function IsUint8Array(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Uint8Array') &&\n        value.type === 'Uint8Array' &&\n        IsOptionalString(value.$id) &&\n        IsOptionalNumber(value.minByteLength) &&\n        IsOptionalNumber(value.maxByteLength));\n}\n/** Returns true if the given value is TUnknown */\nexport function IsUnknown(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Unknown') &&\n        IsOptionalString(value.$id));\n}\n/** Returns true if the given value is a raw TUnsafe */\nexport function IsUnsafe(value) {\n    return IsKindOf(value, 'Unsafe');\n}\n/** Returns true if the given value is TVoid */\nexport function IsVoid(value) {\n    // prettier-ignore\n    return (IsKindOf(value, 'Void') &&\n        value.type === 'void' &&\n        IsOptionalString(value.$id));\n}\n/** Returns true if the given value is TKind */\nexport function IsKind(value) {\n    return ValueGuard.IsObject(value) && Kind in value && ValueGuard.IsString(value[Kind]) && !KnownTypes.includes(value[Kind]);\n}\n/** Returns true if the given value is TSchema */\nexport function IsSchema(value) {\n    // prettier-ignore\n    return (ValueGuard.IsObject(value)) && (IsAny(value) ||\n        IsArray(value) ||\n        IsBoolean(value) ||\n        IsBigInt(value) ||\n        IsAsyncIterator(value) ||\n        IsConstructor(value) ||\n        IsDate(value) ||\n        IsFunction(value) ||\n        IsInteger(value) ||\n        IsIntersect(value) ||\n        IsIterator(value) ||\n        IsLiteral(value) ||\n        IsMappedKey(value) ||\n        IsMappedResult(value) ||\n        IsNever(value) ||\n        IsNot(value) ||\n        IsNull(value) ||\n        IsNumber(value) ||\n        IsObject(value) ||\n        IsPromise(value) ||\n        IsRecord(value) ||\n        IsRef(value) ||\n        IsRegExp(value) ||\n        IsString(value) ||\n        IsSymbol(value) ||\n        IsTemplateLiteral(value) ||\n        IsThis(value) ||\n        IsTuple(value) ||\n        IsUndefined(value) ||\n        IsUnion(value) ||\n        IsUint8Array(value) ||\n        IsUnknown(value) ||\n        IsUnsafe(value) ||\n        IsVoid(value) ||\n        IsKind(value));\n}\n", "export const PatternBoolean = '(true|false)';\nexport const PatternNumber = '(0|[1-9][0-9]*)';\nexport const PatternString = '(.*)';\nexport const PatternNever = '(?!.*)';\nexport const PatternBooleanExact = `^${PatternBoolean}$`;\nexport const PatternNumberExact = `^${PatternNumber}$`;\nexport const PatternStringExact = `^${PatternString}$`;\nexport const PatternNeverExact = `^${PatternNever}$`;\n", "export * as FormatRegistry from './format.mjs';\nexport * as TypeRegistry from './type.mjs';\n", "/** A registry for user defined string formats */\nconst map = new Map();\n/** Returns the entries in this registry */\nexport function Entries() {\n    return new Map(map);\n}\n/** Clears all user defined string formats */\nexport function Clear() {\n    return map.clear();\n}\n/** Deletes a registered format */\nexport function Delete(format) {\n    return map.delete(format);\n}\n/** Returns true if the user defined string format exists */\nexport function Has(format) {\n    return map.has(format);\n}\n/** Sets a validation function for a user defined string format */\nexport function Set(format, func) {\n    map.set(format, func);\n}\n/** Gets a validation function for a user defined string format */\nexport function Get(format) {\n    return map.get(format);\n}\n", "/** A registry for user defined types */\nconst map = new Map();\n/** Returns the entries in this registry */\nexport function Entries() {\n    return new Map(map);\n}\n/** Clears all user defined types */\nexport function Clear() {\n    return map.clear();\n}\n/** Deletes a registered type */\nexport function Delete(kind) {\n    return map.delete(kind);\n}\n/** Returns true if this registry contains this kind */\nexport function Has(kind) {\n    return map.has(kind);\n}\n/** Sets a validation function for a user defined type */\nexport function Set(kind, func) {\n    map.set(kind, func);\n}\n/** Gets a custom validation function for a user defined type */\nexport function Get(kind) {\n    return map.get(kind);\n}\n", "/** Returns true if element right is in the set of left */\n// prettier-ignore\nexport function SetIncludes(T, S) {\n    return T.includes(S);\n}\n/** Returns true if left is a subset of right */\nexport function SetIsSubset(T, S) {\n    return T.every((L) => SetIncludes(S, L));\n}\n/** Returns a distinct set of elements */\nexport function SetDistinct(T) {\n    return [...new Set(T)];\n}\n/** Returns the Intersect of the given sets */\nexport function SetIntersect(T, S) {\n    return T.filter((L) => S.includes(L));\n}\n/** Returns the Union of the given sets */\nexport function SetUnion(T, S) {\n    return [...T, ...S];\n}\n/** Returns the Complement by omitting elements in T that are in S */\n// prettier-ignore\nexport function SetComplement(T, S) {\n    return T.filter(L => !S.includes(L));\n}\n// prettier-ignore\nfunction SetIntersectManyResolve(T, Init) {\n    return T.reduce((Acc, L) => {\n        return SetIntersect(Acc, L);\n    }, Init);\n}\n// prettier-ignore\nexport function SetIntersectMany(T) {\n    return (T.length === 1\n        ? T[0]\n        // Use left to initialize the accumulator for resolve\n        : T.length > 1\n            ? SetIntersectManyResolve(T.slice(1), T[0])\n            : []);\n}\n/** Returns the Union of multiple sets */\nexport function SetUnionMany(T) {\n    const Acc = [];\n    for (const L of T)\n        Acc.push(...L);\n    return Acc;\n}\n", "import { CreateType } from '../create/index.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[Json]` Creates an Any type */\nexport function Any(options) {\n    return CreateType({ [Kind]: 'Any' }, options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[Json]` Creates an Array type */\nexport function Array(items, options) {\n    return CreateType({ [Kind]: 'Array', type: 'array', items }, options);\n}\n", "import { Kind } from '../symbols/index.mjs';\nimport { CreateType } from '../create/type.mjs';\n/** `[JavaScript]` Creates a AsyncIterator type */\nexport function AsyncIterator(items, options) {\n    return CreateType({ [Kind]: 'AsyncIterator', type: 'AsyncIterator', items }, options);\n}\n", "import { Intersect } from '../intersect/index.mjs';\nimport { Union } from '../union/index.mjs';\nimport { CreateType } from '../create/type.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsIntersect, IsUnion, IsPromise } from '../guard/kind.mjs';\n// prettier-ignore\nfunction FromRest(T) {\n    return T.map(L => AwaitedResolve(L));\n}\n// prettier-ignore\nfunction FromIntersect(T) {\n    return Intersect(FromRest(T));\n}\n// prettier-ignore\nfunction FromUnion(T) {\n    return Union(FromRest(T));\n}\n// prettier-ignore\nfunction FromPromise(T) {\n    return AwaitedResolve(T);\n}\n// ----------------------------------------------------------------\n// AwaitedResolve\n// ----------------------------------------------------------------\n// prettier-ignore\nfunction AwaitedResolve(T) {\n    return (IsIntersect(T) ? FromIntersect(T.allOf) :\n        IsUnion(T) ? FromUnion(T.anyOf) :\n            IsPromise(T) ? FromPromise(T.item) :\n                T);\n}\n/** `[JavaScript]` Constructs a type by recursively unwrapping Promise types */\nexport function Awaited(T, options) {\n    return CreateType(AwaitedResolve(T), options);\n}\n", "import { OptionalKind } from '../symbols/index.mjs';\nimport { CreateType } from '../create/type.mjs';\nimport { Discard } from '../discard/index.mjs';\nimport { Never } from '../never/index.mjs';\nimport { Optional } from '../optional/index.mjs';\nimport { IntersectCreate } from './intersect-create.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsOptional, IsTransform } from '../guard/kind.mjs';\n// prettier-ignore\nfunction IsIntersectOptional(T) {\n    return T.every(L => IsOptional(L));\n}\n// prettier-ignore\nfunction RemoveOptionalFromType(T) {\n    return (Discard(T, [OptionalKind]));\n}\n// prettier-ignore\nfunction RemoveOptionalFromRest(T) {\n    return T.map(L => IsOptional(L) ? RemoveOptionalFromType(L) : L);\n}\n// prettier-ignore\nfunction ResolveIntersect(T, options) {\n    return (IsIntersectOptional(T)\n        ? Optional(IntersectCreate(RemoveOptionalFromRest(T), options))\n        : IntersectCreate(RemoveOptionalFromRest(T), options));\n}\n/** `[Json]` Creates an evaluated Intersect type */\nexport function IntersectEvaluated(T, options = {}) {\n    if (T.length === 0)\n        return Never(options);\n    if (T.length === 1)\n        return CreateType(T[0], options);\n    if (T.some((schema) => IsTransform(schema)))\n        throw new Error('Cannot intersect transform types');\n    return ResolveIntersect(T, options);\n}\n", "function DiscardKey(value, key) {\n    const { [key]: _, ...rest } = value;\n    return rest;\n}\n/** Discards property keys from the given value. This function returns a shallow Clone. */\nexport function Discard(value, keys) {\n    return keys.reduce((acc, key) => DiscardKey(acc, key), value);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[Json]` Creates a Never type */\nexport function Never(options) {\n    return CreateType({ [Kind]: 'Never', not: {} }, options);\n}\n", "import { MappedResult } from '../mapped/index.mjs';\nimport { Optional } from './optional.mjs';\n// prettier-ignore\nfunction FromProperties(P, F) {\n    const Acc = {};\n    for (const K2 of globalThis.Object.getOwnPropertyNames(P))\n        Acc[K2] = Optional(P[K2], F);\n    return Acc;\n}\n// prettier-ignore\nfunction FromMappedResult(R, F) {\n    return FromProperties(R.properties, F);\n}\n// prettier-ignore\nexport function OptionalFromMappedResult(R, F) {\n    const P = FromMappedResult(R, F);\n    return MappedResult(P);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n// prettier-ignore\nexport function MappedResult(properties) {\n    return CreateType({\n        [Kind]: 'MappedResult',\n        properties\n    });\n}\n", "import { Kind, OptionalKind, ReadonlyKind } from '../symbols/index.mjs';\nimport { Discard } from '../discard/index.mjs';\n// evaluation types\nimport { Array } from '../array/index.mjs';\nimport { AsyncIterator } from '../async-iterator/index.mjs';\nimport { Constructor } from '../constructor/index.mjs';\nimport { Function as FunctionType } from '../function/index.mjs';\nimport { IndexPropertyKeys } from '../indexed/index.mjs';\nimport { Intersect } from '../intersect/index.mjs';\nimport { Iterator } from '../iterator/index.mjs';\nimport { Literal } from '../literal/index.mjs';\nimport { Object } from '../object/index.mjs';\nimport { Optional } from '../optional/index.mjs';\nimport { Promise } from '../promise/index.mjs';\nimport { Readonly } from '../readonly/index.mjs';\nimport { Tuple } from '../tuple/index.mjs';\nimport { Union } from '../union/index.mjs';\n// operator\nimport { SetIncludes } from '../sets/index.mjs';\n// mapping types\nimport { MappedResult } from './mapped-result.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsArray, IsAsyncIterator, IsConstructor, IsFunction, IsIntersect, IsIterator, IsReadonly, IsMappedResult, IsMappedKey, IsObject, IsOptional, IsPromise, IsSchema, IsTuple, IsUnion } from '../guard/kind.mjs';\n// prettier-ignore\nfunction FromMappedResult(K, P) {\n    return (K in P\n        ? FromSchemaType(K, P[K])\n        : MappedResult(P));\n}\n// prettier-ignore\nfunction MappedKeyToKnownMappedResultProperties(K) {\n    return { [K]: Literal(K) };\n}\n// prettier-ignore\nfunction MappedKeyToUnknownMappedResultProperties(P) {\n    const Acc = {};\n    for (const L of P)\n        Acc[L] = Literal(L);\n    return Acc;\n}\n// prettier-ignore\nfunction MappedKeyToMappedResultProperties(K, P) {\n    return (SetIncludes(P, K)\n        ? MappedKeyToKnownMappedResultProperties(K)\n        : MappedKeyToUnknownMappedResultProperties(P));\n}\n// prettier-ignore\nfunction FromMappedKey(K, P) {\n    const R = MappedKeyToMappedResultProperties(K, P);\n    return FromMappedResult(K, R);\n}\n// prettier-ignore\nfunction FromRest(K, T) {\n    return T.map(L => FromSchemaType(K, L));\n}\n// prettier-ignore\nfunction FromProperties(K, T) {\n    const Acc = {};\n    for (const K2 of globalThis.Object.getOwnPropertyNames(T))\n        Acc[K2] = FromSchemaType(K, T[K2]);\n    return Acc;\n}\n// prettier-ignore\nfunction FromSchemaType(K, T) {\n    // required to retain user defined options for mapped type\n    const options = { ...T };\n    return (\n    // unevaluated modifier types\n    IsOptional(T) ? Optional(FromSchemaType(K, Discard(T, [OptionalKind]))) :\n        IsReadonly(T) ? Readonly(FromSchemaType(K, Discard(T, [ReadonlyKind]))) :\n            // unevaluated mapped types\n            IsMappedResult(T) ? FromMappedResult(K, T.properties) :\n                IsMappedKey(T) ? FromMappedKey(K, T.keys) :\n                    // unevaluated types\n                    IsConstructor(T) ? Constructor(FromRest(K, T.parameters), FromSchemaType(K, T.returns), options) :\n                        IsFunction(T) ? FunctionType(FromRest(K, T.parameters), FromSchemaType(K, T.returns), options) :\n                            IsAsyncIterator(T) ? AsyncIterator(FromSchemaType(K, T.items), options) :\n                                IsIterator(T) ? Iterator(FromSchemaType(K, T.items), options) :\n                                    IsIntersect(T) ? Intersect(FromRest(K, T.allOf), options) :\n                                        IsUnion(T) ? Union(FromRest(K, T.anyOf), options) :\n                                            IsTuple(T) ? Tuple(FromRest(K, T.items ?? []), options) :\n                                                IsObject(T) ? Object(FromProperties(K, T.properties), options) :\n                                                    IsArray(T) ? Array(FromSchemaType(K, T.items), options) :\n                                                        IsPromise(T) ? Promise(FromSchemaType(K, T.item), options) :\n                                                            T);\n}\n// prettier-ignore\nexport function MappedFunctionReturnType(K, T) {\n    const Acc = {};\n    for (const L of K)\n        Acc[L] = FromSchemaType(L, T);\n    return Acc;\n}\n/** `[Json]` Creates a Mapped object type */\nexport function Mapped(key, map, options) {\n    const K = IsSchema(key) ? IndexPropertyKeys(key) : key;\n    const RT = map({ [Kind]: 'MappedKey', keys: K });\n    const R = MappedFunctionReturnType(K, RT);\n    return Object(R, options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[JavaScript]` Creates a Constructor type */\nexport function Constructor(parameters, returns, options) {\n    return CreateType({ [Kind]: 'Constructor', type: 'Constructor', parameters, returns }, options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[JavaScript]` Creates a Function type */\nexport function Function(parameters, returns, options) {\n    return CreateType({ [Kind]: 'Function', type: 'Function', parameters, returns }, options);\n}\n", "import { Index } from './indexed.mjs';\nimport { MappedResult } from '../mapped/index.mjs';\nimport { Clone } from '../clone/value.mjs';\n// prettier-ignore\nfunction MappedIndexPropertyKey(T, K, options) {\n    return { [K]: Index(T, [K], Clone(options)) };\n}\n// prettier-ignore\nfunction MappedIndexPropertyKeys(T, K, options) {\n    return K.reduce((Acc, L) => {\n        return { ...Acc, ...MappedIndexPropertyKey(T, L, options) };\n    }, {});\n}\n// prettier-ignore\nfunction MappedIndexProperties(T, K, options) {\n    return MappedIndexPropertyKeys(T, K.keys, options);\n}\n// prettier-ignore\nexport function IndexFromMappedKey(T, K, options) {\n    const P = MappedIndexProperties(T, K, options);\n    return MappedResult(P);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Never } from '../never/index.mjs';\nimport { IntersectEvaluated } from '../intersect/index.mjs';\nimport { UnionEvaluated } from '../union/index.mjs';\nimport { IndexPropertyKeys } from './indexed-property-keys.mjs';\nimport { IndexFromMappedKey } from './indexed-from-mapped-key.mjs';\nimport { IndexFromMappedResult } from './indexed-from-mapped-result.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsArray, IsIntersect, IsObject, IsMappedKey, IsMappedResult, IsNever, IsSchema, IsTuple, IsUnion } from '../guard/kind.mjs';\n// prettier-ignore\nfunction FromRest(T, K) {\n    return T.map(L => IndexFromPropertyKey(L, K));\n}\n// prettier-ignore\nfunction FromIntersectRest(T) {\n    return T.filter(L => !IsNever(L));\n}\n// prettier-ignore\nfunction FromIntersect(T, K) {\n    return (IntersectEvaluated(FromIntersectRest(FromRest(T, K))));\n}\n// prettier-ignore\nfunction FromUnionRest(T) {\n    return (T.some(L => IsNever(L))\n        ? []\n        : T);\n}\n// prettier-ignore\nfunction FromUnion(T, K) {\n    return (UnionEvaluated(FromUnionRest(FromRest(T, K))));\n}\n// prettier-ignore\nfunction FromTuple(T, K) {\n    return (K in T ? T[K] :\n        K === '[number]' ? UnionEvaluated(T) :\n            Never());\n}\n// prettier-ignore\nfunction FromArray(T, K) {\n    return (K === '[number]'\n        ? T\n        : Never());\n}\n// prettier-ignore\nfunction FromProperty(T, K) {\n    return (K in T ? T[K] : Never());\n}\n// prettier-ignore\nexport function IndexFromPropertyKey(T, K) {\n    return (IsIntersect(T) ? FromIntersect(T.allOf, K) :\n        IsUnion(T) ? FromUnion(T.anyOf, K) :\n            IsTuple(T) ? FromTuple(T.items ?? [], K) :\n                IsArray(T) ? FromArray(T.items, K) :\n                    IsObject(T) ? FromProperty(T.properties, K) :\n                        Never());\n}\n// prettier-ignore\nexport function IndexFromPropertyKeys(T, K) {\n    return K.map(L => IndexFromPropertyKey(T, L));\n}\n// prettier-ignore\nfunction FromSchema(T, K) {\n    return (UnionEvaluated(IndexFromPropertyKeys(T, K)));\n}\n/** `[Json]` Returns an Indexed property type for the given keys */\nexport function Index(T, K, options) {\n    // mapped-types\n    if (IsMappedResult(K))\n        return IndexFromMappedResult(T, K, options);\n    if (IsMappedKey(K))\n        return IndexFromMappedKey(T, K, options);\n    // prettier-ignore\n    return CreateType(IsSchema(K)\n        ? FromSchema(T, IndexPropertyKeys(K))\n        : FromSchema(T, K), options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { OptionalKind } from '../symbols/index.mjs';\nimport { Discard } from '../discard/index.mjs';\nimport { Never } from '../never/index.mjs';\nimport { Optional } from '../optional/index.mjs';\nimport { UnionCreate } from './union-create.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsOptional } from '../guard/kind.mjs';\n// prettier-ignore\nfunction IsUnionOptional(T) {\n    return T.some(L => IsOptional(L));\n}\n// prettier-ignore\nfunction RemoveOptionalFromRest(T) {\n    return T.map(L => IsOptional(L) ? RemoveOptionalFromType(L) : L);\n}\n// prettier-ignore\nfunction RemoveOptionalFromType(T) {\n    return (Discard(T, [OptionalKind]));\n}\n// prettier-ignore\nfunction ResolveUnion(T, options) {\n    return (IsUnionOptional(T)\n        ? Optional(UnionCreate(RemoveOptionalFromRest(T), options))\n        : UnionCreate(RemoveOptionalFromRest(T), options));\n}\n/** `[Json]` Creates an evaluated Union type */\nexport function UnionEvaluated(T, options) {\n    // prettier-ignore\n    return (T.length === 0 ? Never(options) :\n        T.length === 1 ? CreateType(T[0], options) :\n            ResolveUnion(T, options));\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\nexport function UnionCreate(T, options) {\n    return CreateType({ [Kind]: 'Union', anyOf: T }, options);\n}\n", "import { Never } from '../never/index.mjs';\nimport { CreateType } from '../create/type.mjs';\nimport { UnionCreate } from './union-create.mjs';\n/** `[Json]` Creates a Union type */\nexport function Union(T, options) {\n    // prettier-ignore\n    return (T.length === 0 ? Never(options) :\n        T.length === 1 ? CreateType(T[0], options) :\n            UnionCreate(T, options));\n}\n", "import { TemplateLiteralGenerate } from '../template-literal/index.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsTemplateLiteral, IsUnion, IsLiteral, IsNumber, IsInteger } from '../guard/kind.mjs';\n// prettier-ignore\nfunction FromTemplateLiteral(T) {\n    const R = TemplateLiteralGenerate(T);\n    return R.map(S => S.toString());\n}\n// prettier-ignore\nfunction FromUnion(T) {\n    const Acc = [];\n    for (const L of T)\n        Acc.push(...IndexPropertyKeys(L));\n    return Acc;\n}\n// prettier-ignore\nfunction FromLiteral(T) {\n    return ([T.toString()] // TS 5.4 observes TLiteralValue as not having a toString()\n    );\n}\n/** Returns a tuple of PropertyKeys derived from the given TSchema */\n// prettier-ignore\nexport function IndexPropertyKeys(T) {\n    return [...new Set((IsTemplateLiteral(T) ? FromTemplateLiteral(T) :\n            IsUnion(T) ? FromUnion(T.anyOf) :\n                IsLiteral(T) ? FromLiteral(T.const) :\n                    IsNumber(T) ? ['[number]'] :\n                        IsInteger(T) ? ['[number]'] :\n                            []))];\n}\n", "import { TemplateLiteralParseExact } from './parse.mjs';\nimport { TypeBoxError } from '../error/index.mjs';\n// ------------------------------------------------------------------\n// TemplateLiteralFiniteError\n// ------------------------------------------------------------------\nexport class TemplateLiteralFiniteError extends TypeBoxError {\n}\n// ------------------------------------------------------------------\n// IsTemplateLiteralFiniteCheck\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction IsNumberExpression(expression) {\n    return (expression.type === 'or' &&\n        expression.expr.length === 2 &&\n        expression.expr[0].type === 'const' &&\n        expression.expr[0].const === '0' &&\n        expression.expr[1].type === 'const' &&\n        expression.expr[1].const === '[1-9][0-9]*');\n}\n// prettier-ignore\nfunction IsBooleanExpression(expression) {\n    return (expression.type === 'or' &&\n        expression.expr.length === 2 &&\n        expression.expr[0].type === 'const' &&\n        expression.expr[0].const === 'true' &&\n        expression.expr[1].type === 'const' &&\n        expression.expr[1].const === 'false');\n}\n// prettier-ignore\nfunction IsStringExpression(expression) {\n    return expression.type === 'const' && expression.const === '.*';\n}\n// ------------------------------------------------------------------\n// IsTemplateLiteralExpressionFinite\n// ------------------------------------------------------------------\n// prettier-ignore\nexport function IsTemplateLiteralExpressionFinite(expression) {\n    return (IsNumberExpression(expression) || IsStringExpression(expression) ? false :\n        IsBooleanExpression(expression) ? true :\n            (expression.type === 'and') ? expression.expr.every((expr) => IsTemplateLiteralExpressionFinite(expr)) :\n                (expression.type === 'or') ? expression.expr.every((expr) => IsTemplateLiteralExpressionFinite(expr)) :\n                    (expression.type === 'const') ? true :\n                        (() => { throw new TemplateLiteralFiniteError(`Unknown expression type`); })());\n}\n/** Returns true if this TemplateLiteral resolves to a finite set of values */\nexport function IsTemplateLiteralFinite(schema) {\n    const expression = TemplateLiteralParseExact(schema.pattern);\n    return IsTemplateLiteralExpressionFinite(expression);\n}\n", "import { TypeBoxError } from '../error/index.mjs';\n// ------------------------------------------------------------------\n// TemplateLiteralParserError\n// ------------------------------------------------------------------\nexport class TemplateLiteralParserError extends TypeBoxError {\n}\n// -------------------------------------------------------------------\n// Unescape\n//\n// Unescape for these control characters specifically. Note that this\n// function is only called on non union group content, and where we\n// still want to allow the user to embed control characters in that\n// content. For review.\n// -------------------------------------------------------------------\n// prettier-ignore\nfunction Unescape(pattern) {\n    return pattern\n        .replace(/\\\\\\$/g, '$')\n        .replace(/\\\\\\*/g, '*')\n        .replace(/\\\\\\^/g, '^')\n        .replace(/\\\\\\|/g, '|')\n        .replace(/\\\\\\(/g, '(')\n        .replace(/\\\\\\)/g, ')');\n}\n// -------------------------------------------------------------------\n// Control Characters\n// -------------------------------------------------------------------\nfunction IsNonEscaped(pattern, index, char) {\n    return pattern[index] === char && pattern.charCodeAt(index - 1) !== 92;\n}\nfunction IsOpenParen(pattern, index) {\n    return IsNonEscaped(pattern, index, '(');\n}\nfunction IsCloseParen(pattern, index) {\n    return IsNonEscaped(pattern, index, ')');\n}\nfunction IsSeparator(pattern, index) {\n    return IsNonEscaped(pattern, index, '|');\n}\n// -------------------------------------------------------------------\n// Control Groups\n// -------------------------------------------------------------------\nfunction IsGroup(pattern) {\n    if (!(IsOpenParen(pattern, 0) && IsCloseParen(pattern, pattern.length - 1)))\n        return false;\n    let count = 0;\n    for (let index = 0; index < pattern.length; index++) {\n        if (IsOpenParen(pattern, index))\n            count += 1;\n        if (IsCloseParen(pattern, index))\n            count -= 1;\n        if (count === 0 && index !== pattern.length - 1)\n            return false;\n    }\n    return true;\n}\n// prettier-ignore\nfunction InGroup(pattern) {\n    return pattern.slice(1, pattern.length - 1);\n}\n// prettier-ignore\nfunction IsPrecedenceOr(pattern) {\n    let count = 0;\n    for (let index = 0; index < pattern.length; index++) {\n        if (IsOpenParen(pattern, index))\n            count += 1;\n        if (IsCloseParen(pattern, index))\n            count -= 1;\n        if (IsSeparator(pattern, index) && count === 0)\n            return true;\n    }\n    return false;\n}\n// prettier-ignore\nfunction IsPrecedenceAnd(pattern) {\n    for (let index = 0; index < pattern.length; index++) {\n        if (IsOpenParen(pattern, index))\n            return true;\n    }\n    return false;\n}\n// prettier-ignore\nfunction Or(pattern) {\n    let [count, start] = [0, 0];\n    const expressions = [];\n    for (let index = 0; index < pattern.length; index++) {\n        if (IsOpenParen(pattern, index))\n            count += 1;\n        if (IsCloseParen(pattern, index))\n            count -= 1;\n        if (IsSeparator(pattern, index) && count === 0) {\n            const range = pattern.slice(start, index);\n            if (range.length > 0)\n                expressions.push(TemplateLiteralParse(range));\n            start = index + 1;\n        }\n    }\n    const range = pattern.slice(start);\n    if (range.length > 0)\n        expressions.push(TemplateLiteralParse(range));\n    if (expressions.length === 0)\n        return { type: 'const', const: '' };\n    if (expressions.length === 1)\n        return expressions[0];\n    return { type: 'or', expr: expressions };\n}\n// prettier-ignore\nfunction And(pattern) {\n    function Group(value, index) {\n        if (!IsOpenParen(value, index))\n            throw new TemplateLiteralParserError(`TemplateLiteralParser: Index must point to open parens`);\n        let count = 0;\n        for (let scan = index; scan < value.length; scan++) {\n            if (IsOpenParen(value, scan))\n                count += 1;\n            if (IsCloseParen(value, scan))\n                count -= 1;\n            if (count === 0)\n                return [index, scan];\n        }\n        throw new TemplateLiteralParserError(`TemplateLiteralParser: Unclosed group parens in expression`);\n    }\n    function Range(pattern, index) {\n        for (let scan = index; scan < pattern.length; scan++) {\n            if (IsOpenParen(pattern, scan))\n                return [index, scan];\n        }\n        return [index, pattern.length];\n    }\n    const expressions = [];\n    for (let index = 0; index < pattern.length; index++) {\n        if (IsOpenParen(pattern, index)) {\n            const [start, end] = Group(pattern, index);\n            const range = pattern.slice(start, end + 1);\n            expressions.push(TemplateLiteralParse(range));\n            index = end;\n        }\n        else {\n            const [start, end] = Range(pattern, index);\n            const range = pattern.slice(start, end);\n            if (range.length > 0)\n                expressions.push(TemplateLiteralParse(range));\n            index = end - 1;\n        }\n    }\n    return ((expressions.length === 0) ? { type: 'const', const: '' } :\n        (expressions.length === 1) ? expressions[0] :\n            { type: 'and', expr: expressions });\n}\n// ------------------------------------------------------------------\n// TemplateLiteralParse\n// ------------------------------------------------------------------\n/** Parses a pattern and returns an expression tree */\nexport function TemplateLiteralParse(pattern) {\n    // prettier-ignore\n    return (IsGroup(pattern) ? TemplateLiteralParse(InGroup(pattern)) :\n        IsPrecedenceOr(pattern) ? Or(pattern) :\n            IsPrecedenceAnd(pattern) ? And(pattern) :\n                { type: 'const', const: Unescape(pattern) });\n}\n// ------------------------------------------------------------------\n// TemplateLiteralParseExact\n// ------------------------------------------------------------------\n/** Parses a pattern and strips forward and trailing ^ and $ */\nexport function TemplateLiteralParseExact(pattern) {\n    return TemplateLiteralParse(pattern.slice(1, pattern.length - 1));\n}\n", "import { IsTemplateLiteralExpressionFinite } from './finite.mjs';\nimport { TemplateLiteralParseExact } from './parse.mjs';\nimport { TypeBoxError } from '../error/index.mjs';\n// ------------------------------------------------------------------\n// TemplateLiteralGenerateError\n// ------------------------------------------------------------------\nexport class TemplateLiteralGenerateError extends TypeBoxError {\n}\n// ------------------------------------------------------------------\n// TemplateLiteralExpressionGenerate\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction* GenerateReduce(buffer) {\n    if (buffer.length === 1)\n        return yield* buffer[0];\n    for (const left of buffer[0]) {\n        for (const right of GenerateReduce(buffer.slice(1))) {\n            yield `${left}${right}`;\n        }\n    }\n}\n// prettier-ignore\nfunction* GenerateAnd(expression) {\n    return yield* GenerateReduce(expression.expr.map((expr) => [...TemplateLiteralExpressionGenerate(expr)]));\n}\n// prettier-ignore\nfunction* GenerateOr(expression) {\n    for (const expr of expression.expr)\n        yield* TemplateLiteralExpressionGenerate(expr);\n}\n// prettier-ignore\nfunction* GenerateConst(expression) {\n    return yield expression.const;\n}\nexport function* TemplateLiteralExpressionGenerate(expression) {\n    return expression.type === 'and'\n        ? yield* GenerateAnd(expression)\n        : expression.type === 'or'\n            ? yield* GenerateOr(expression)\n            : expression.type === 'const'\n                ? yield* GenerateConst(expression)\n                : (() => {\n                    throw new TemplateLiteralGenerateError('Unknown expression');\n                })();\n}\n/** Generates a tuple of strings from the given TemplateLiteral. Returns an empty tuple if infinite. */\nexport function TemplateLiteralGenerate(schema) {\n    const expression = TemplateLiteralParseExact(schema.pattern);\n    // prettier-ignore\n    return (IsTemplateLiteralExpressionFinite(expression)\n        ? [...TemplateLiteralExpressionGenerate(expression)]\n        : []);\n}\n", "import { Literal } from '../literal/index.mjs';\nimport { Boolean } from '../boolean/index.mjs';\nimport { BigInt } from '../bigint/index.mjs';\nimport { Number } from '../number/index.mjs';\nimport { String } from '../string/index.mjs';\nimport { UnionEvaluated } from '../union/index.mjs';\nimport { Never } from '../never/index.mjs';\n// ------------------------------------------------------------------\n// SyntaxParsers\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction* FromUnion(syntax) {\n    const trim = syntax.trim().replace(/\"|'/g, '');\n    return (trim === 'boolean' ? yield Boolean() :\n        trim === 'number' ? yield Number() :\n            trim === 'bigint' ? yield BigInt() :\n                trim === 'string' ? yield String() :\n                    yield (() => {\n                        const literals = trim.split('|').map((literal) => Literal(literal.trim()));\n                        return (literals.length === 0 ? Never() :\n                            literals.length === 1 ? literals[0] :\n                                UnionEvaluated(literals));\n                    })());\n}\n// prettier-ignore\nfunction* FromTerminal(syntax) {\n    if (syntax[1] !== '{') {\n        const L = Literal('$');\n        const R = FromSyntax(syntax.slice(1));\n        return yield* [L, ...R];\n    }\n    for (let i = 2; i < syntax.length; i++) {\n        if (syntax[i] === '}') {\n            const L = FromUnion(syntax.slice(2, i));\n            const R = FromSyntax(syntax.slice(i + 1));\n            return yield* [...L, ...R];\n        }\n    }\n    yield Literal(syntax);\n}\n// prettier-ignore\nfunction* FromSyntax(syntax) {\n    for (let i = 0; i < syntax.length; i++) {\n        if (syntax[i] === '$') {\n            const L = Literal(syntax.slice(0, i));\n            const R = FromTerminal(syntax.slice(i));\n            return yield* [L, ...R];\n        }\n    }\n    yield Literal(syntax);\n}\n/** Parses TemplateLiteralSyntax and returns a tuple of TemplateLiteralKinds */\nexport function TemplateLiteralSyntax(syntax) {\n    return [...FromSyntax(syntax)];\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[Json]` Creates a Literal type */\nexport function Literal(value, options) {\n    return CreateType({\n        [Kind]: 'Literal',\n        const: value,\n        type: typeof value,\n    }, options);\n}\n", "import { Kind } from '../symbols/index.mjs';\nimport { CreateType } from '../create/index.mjs';\n/** `[Json]` Creates a Boolean type */\nexport function Boolean(options) {\n    return CreateType({ [Kind]: 'Boolean', type: 'boolean' }, options);\n}\n", "import { Kind } from '../symbols/index.mjs';\nimport { CreateType } from '../create/index.mjs';\n/** `[JavaScript]` Creates a BigInt type */\nexport function BigInt(options) {\n    return CreateType({ [Kind]: 'BigInt', type: 'bigint' }, options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[Json]` Creates a Number type */\nexport function Number(options) {\n    return CreateType({ [Kind]: 'Number', type: 'number' }, options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[Json]` Creates a String type */\nexport function String(options) {\n    return CreateType({ [Kind]: 'String', type: 'string' }, options);\n}\n", "import { PatternNumber, PatternString, PatternBoolean } from '../patterns/index.mjs';\nimport { Kind } from '../symbols/index.mjs';\nimport { TypeBoxError } from '../error/index.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsTemplateLiteral, IsUnion, IsNumber, IsInteger, IsBigInt, IsString, IsLiteral, IsBoolean } from '../guard/kind.mjs';\n// ------------------------------------------------------------------\n// TemplateLiteralPatternError\n// ------------------------------------------------------------------\nexport class TemplateLiteralPatternError extends TypeBoxError {\n}\n// ------------------------------------------------------------------\n// TemplateLiteralPattern\n// ------------------------------------------------------------------\nfunction Escape(value) {\n    return value.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n// prettier-ignore\nfunction Visit(schema, acc) {\n    return (IsTemplateLiteral(schema) ? schema.pattern.slice(1, schema.pattern.length - 1) :\n        IsUnion(schema) ? `(${schema.anyOf.map((schema) => Visit(schema, acc)).join('|')})` :\n            IsNumber(schema) ? `${acc}${PatternNumber}` :\n                IsInteger(schema) ? `${acc}${PatternNumber}` :\n                    IsBigInt(schema) ? `${acc}${PatternNumber}` :\n                        IsString(schema) ? `${acc}${PatternString}` :\n                            IsLiteral(schema) ? `${acc}${Escape(schema.const.toString())}` :\n                                IsBoolean(schema) ? `${acc}${PatternBoolean}` :\n                                    (() => { throw new TemplateLiteralPatternError(`Unexpected Kind '${schema[Kind]}'`); })());\n}\nexport function TemplateLiteralPattern(kinds) {\n    return `^${kinds.map((schema) => Visit(schema, '')).join('')}\\$`;\n}\n", "import { UnionEvaluated } from '../union/index.mjs';\nimport { Literal } from '../literal/index.mjs';\nimport { TemplateLiteralGenerate } from './generate.mjs';\n/** Returns a Union from the given TemplateLiteral */\nexport function TemplateLiteralToUnion(schema) {\n    const R = TemplateLiteralGenerate(schema);\n    const L = R.map((S) => Literal(S));\n    return UnionEvaluated(L);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { TemplateLiteralSyntax } from './syntax.mjs';\nimport { TemplateLiteralPattern } from './pattern.mjs';\nimport { IsString } from '../guard/value.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[Json]` Creates a TemplateLiteral type */\n// prettier-ignore\nexport function TemplateLiteral(unresolved, options) {\n    const pattern = IsString(unresolved)\n        ? TemplateLiteralPattern(TemplateLiteralSyntax(unresolved))\n        : TemplateLiteralPattern(unresolved);\n    return CreateType({ [Kind]: 'TemplateLiteral', type: 'string', pattern }, options);\n}\n", "import { MappedResult } from '../mapped/index.mjs';\nimport { IndexPropertyKeys } from './indexed-property-keys.mjs';\nimport { Index } from './index.mjs';\n// prettier-ignore\nfunction FromProperties(T, P, options) {\n    const Acc = {};\n    for (const K2 of Object.getOwnPropertyNames(P)) {\n        Acc[K2] = Index(T, IndexPropertyKeys(P[K2]), options);\n    }\n    return Acc;\n}\n// prettier-ignore\nfunction FromMappedResult(T, R, options) {\n    return FromProperties(T, R.properties, options);\n}\n// prettier-ignore\nexport function IndexFromMappedResult(T, R, options) {\n    const P = FromMappedResult(T, R, options);\n    return MappedResult(P);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[JavaScript]` Creates an Iterator type */\nexport function Iterator(items, options) {\n    return CreateType({ [Kind]: 'Iterator', type: 'Iterator', items }, options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsOptional } from '../guard/kind.mjs';\nfunction RequiredKeys(properties) {\n    const keys = [];\n    for (let key in properties) {\n        if (!IsOptional(properties[key]))\n            keys.push(key);\n    }\n    return keys;\n}\n/** `[Json]` Creates an Object type */\nfunction _Object(properties, options) {\n    const required = RequiredKeys(properties);\n    const schematic = required.length > 0 ? { [Kind]: 'Object', type: 'object', properties, required } : { [Kind]: 'Object', type: 'object', properties };\n    return CreateType(schematic, options);\n}\n/** `[Json]` Creates an Object type */\nexport var Object = _Object;\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[JavaScript]` Creates a Promise type */\nexport function Promise(item, options) {\n    return CreateType({ [Kind]: 'Promise', type: 'Promise', item }, options);\n}\n", "import { MappedResult } from '../mapped/index.mjs';\nimport { Readonly } from './readonly.mjs';\n// prettier-ignore\nfunction FromProperties(K, F) {\n    const Acc = {};\n    for (const K2 of globalThis.Object.getOwnPropertyNames(K))\n        Acc[K2] = Readonly(K[K2], F);\n    return Acc;\n}\n// prettier-ignore\nfunction FromMappedResult(R, F) {\n    return FromProperties(R.properties, F);\n}\n// prettier-ignore\nexport function ReadonlyFromMappedResult(R, F) {\n    const P = FromMappedResult(R, F);\n    return MappedResult(P);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { ReadonlyKind } from '../symbols/index.mjs';\nimport { Discard } from '../discard/index.mjs';\nimport { ReadonlyFromMappedResult } from './readonly-from-mapped-result.mjs';\nimport { IsMappedResult } from '../guard/kind.mjs';\nfunction RemoveReadonly(schema) {\n    return CreateType(Discard(schema, [ReadonlyKind]));\n}\nfunction AddReadonly(schema) {\n    return CreateType({ ...schema, [ReadonlyKind]: 'Readonly' });\n}\n// prettier-ignore\nfunction ReadonlyWithFlag(schema, F) {\n    return (F === false\n        ? RemoveReadonly(schema)\n        : AddReadonly(schema));\n}\n/** `[Json]` Creates a Readonly property */\nexport function Readonly(schema, enable) {\n    const F = enable ?? true;\n    return IsMappedResult(schema) ? ReadonlyFromMappedResult(schema, F) : ReadonlyWithFlag(schema, F);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[Json]` Creates a Tuple type */\nexport function Tuple(items, options) {\n    // prettier-ignore\n    return CreateType(items.length > 0 ?\n        { [Kind]: 'Tuple', type: 'array', items, additionalItems: false, minItems: items.length, maxItems: items.length } :\n        { [Kind]: 'Tuple', type: 'array', minItems: items.length, maxItems: items.length }, options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { OptionalKind } from '../symbols/index.mjs';\nimport { Discard } from '../discard/index.mjs';\nimport { OptionalFromMappedResult } from './optional-from-mapped-result.mjs';\nimport { IsMappedResult } from '../guard/kind.mjs';\nfunction RemoveOptional(schema) {\n    return CreateType(Discard(schema, [OptionalKind]));\n}\nfunction AddOptional(schema) {\n    return CreateType({ ...schema, [OptionalKind]: 'Optional' });\n}\n// prettier-ignore\nfunction OptionalWithFlag(schema, F) {\n    return (F === false\n        ? RemoveOptional(schema)\n        : AddOptional(schema));\n}\n/** `[Json]` Creates a Optional property */\nexport function Optional(schema, enable) {\n    const F = enable ?? true;\n    return IsMappedResult(schema) ? OptionalFromMappedResult(schema, F) : OptionalWithFlag(schema, F);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsObject, IsSchema } from '../guard/kind.mjs';\n// ------------------------------------------------------------------\n// IntersectCreate\n// ------------------------------------------------------------------\n// prettier-ignore\nexport function IntersectCreate(T, options = {}) {\n    const allObjects = T.every((schema) => IsObject(schema));\n    const clonedUnevaluatedProperties = IsSchema(options.unevaluatedProperties)\n        ? { unevaluatedProperties: options.unevaluatedProperties }\n        : {};\n    return CreateType((options.unevaluatedProperties === false || IsSchema(options.unevaluatedProperties) || allObjects\n        ? { ...clonedUnevaluatedProperties, [Kind]: 'Intersect', type: 'object', allOf: T }\n        : { ...clonedUnevaluatedProperties, [Kind]: 'Intersect', allOf: T }), options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Never } from '../never/index.mjs';\nimport { IntersectCreate } from './intersect-create.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsTransform } from '../guard/kind.mjs';\n/** `[Json]` Creates an evaluated Intersect type */\nexport function Intersect(T, options) {\n    if (T.length === 0)\n        return Never(options);\n    if (T.length === 1)\n        return CreateType(T[0], options);\n    if (T.some((schema) => IsTransform(schema)))\n        throw new Error('Cannot intersect transform types');\n    return IntersectCreate(T, options);\n}\n", "import { IntersectEvaluated } from '../intersect/index.mjs';\nimport { IndexFromPropertyKeys } from '../indexed/index.mjs';\nimport { KeyOfPropertyKeys } from '../keyof/index.mjs';\nimport { Object } from '../object/index.mjs';\nimport { SetDistinct } from '../sets/index.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsNever } from '../guard/kind.mjs';\n// prettier-ignore\nfunction CompositeKeys(T) {\n    const Acc = [];\n    for (const L of T)\n        Acc.push(...KeyOfPropertyKeys(L));\n    return SetDistinct(Acc);\n}\n// prettier-ignore\nfunction FilterNever(T) {\n    return T.filter(L => !IsNever(L));\n}\n// prettier-ignore\nfunction CompositeProperty(T, K) {\n    const Acc = [];\n    for (const L of T)\n        Acc.push(...IndexFromPropertyKeys(L, [K]));\n    return FilterNever(Acc);\n}\n// prettier-ignore\nfunction CompositeProperties(T, K) {\n    const Acc = {};\n    for (const L of K) {\n        Acc[L] = IntersectEvaluated(CompositeProperty(T, L));\n    }\n    return Acc;\n}\n// prettier-ignore\nexport function Composite(T, options) {\n    const K = CompositeKeys(T);\n    const P = CompositeProperties(T, K);\n    const R = Object(P, options);\n    return R;\n}\n", "import { MappedResult } from '../mapped/index.mjs';\nimport { KeyOf } from './keyof.mjs';\nimport { Clone } from '../clone/value.mjs';\n// prettier-ignore\nfunction FromProperties(K, options) {\n    const Acc = {};\n    for (const K2 of globalThis.Object.getOwnPropertyNames(K))\n        Acc[K2] = KeyOf(K[K2], Clone(options));\n    return Acc;\n}\n// prettier-ignore\nfunction FromMappedResult(R, options) {\n    return FromProperties(R.properties, options);\n}\n// prettier-ignore\nexport function KeyOfFromMappedResult(R, options) {\n    const P = FromMappedResult(R, options);\n    return MappedResult(P);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Literal } from '../literal/index.mjs';\nimport { Number } from '../number/index.mjs';\nimport { KeyOfPropertyKeys } from './keyof-property-keys.mjs';\nimport { UnionEvaluated } from '../union/index.mjs';\nimport { KeyOfFromMappedResult } from './keyof-from-mapped-result.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsMappedResult } from '../guard/kind.mjs';\n// prettier-ignore\nexport function KeyOfPropertyKeysToRest(T) {\n    return T.map(L => L === '[number]' ? Number() : Literal(L));\n}\n/** `[Json]` Creates a KeyOf type */\nexport function KeyOf(T, options) {\n    if (IsMappedResult(T)) {\n        return KeyOfFromMappedResult(T, options);\n    }\n    else {\n        const K = KeyOfPropertyKeys(T);\n        const S = KeyOfPropertyKeysToRest(K);\n        const U = UnionEvaluated(S);\n        return CreateType(U, options);\n    }\n}\n", "import { SetUnionMany, SetIntersectMany } from '../sets/index.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsIntersect, IsUnion, IsTuple, IsArray, IsObject, IsRecord } from '../guard/kind.mjs';\n// prettier-ignore\nfunction FromRest(T) {\n    const Acc = [];\n    for (const L of T)\n        Acc.push(KeyOfPropertyKeys(L));\n    return Acc;\n}\n// prettier-ignore\nfunction FromIntersect(T) {\n    const C = FromRest(T);\n    const R = SetUnionMany(C);\n    return R;\n}\n// prettier-ignore\nfunction FromUnion(T) {\n    const C = FromRest(T);\n    const R = SetIntersectMany(C);\n    return R;\n}\n// prettier-ignore\nfunction FromTuple(T) {\n    return T.map((_, I) => I.toString());\n}\n// prettier-ignore\nfunction FromArray(_) {\n    return (['[number]']);\n}\n// prettier-ignore\nfunction FromProperties(T) {\n    return (globalThis.Object.getOwnPropertyNames(T));\n}\n// ------------------------------------------------------------------\n// FromPatternProperties\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromPatternProperties(patternProperties) {\n    if (!includePatternProperties)\n        return [];\n    const patternPropertyKeys = globalThis.Object.getOwnPropertyNames(patternProperties);\n    return patternPropertyKeys.map(key => {\n        return (key[0] === '^' && key[key.length - 1] === '$')\n            ? key.slice(1, key.length - 1)\n            : key;\n    });\n}\n/** Returns a tuple of PropertyKeys derived from the given TSchema. */\n// prettier-ignore\nexport function KeyOfPropertyKeys(T) {\n    return (IsIntersect(T) ? FromIntersect(T.allOf) :\n        IsUnion(T) ? FromUnion(T.anyOf) :\n            IsTuple(T) ? FromTuple(T.items ?? []) :\n                IsArray(T) ? FromArray(T.items) :\n                    IsObject(T) ? FromProperties(T.properties) :\n                        IsRecord(T) ? FromPatternProperties(T.patternProperties) :\n                            []);\n}\n// ----------------------------------------------------------------\n// KeyOfPattern\n// ----------------------------------------------------------------\nlet includePatternProperties = false;\n/** Returns a regular expression pattern derived from the given TSchema */\nexport function KeyOfPattern(schema) {\n    includePatternProperties = true;\n    const keys = KeyOfPropertyKeys(schema);\n    includePatternProperties = false;\n    const pattern = keys.map((key) => `(${key})`);\n    return `^(${pattern.join('|')})$`;\n}\n", "import { IndexFromPropertyKeys } from '../indexed/indexed.mjs';\nimport { KeyOfPropertyKeys } from './keyof-property-keys.mjs';\n/**\n * `[Utility]` Resolves an array of keys and schemas from the given schema. This method is faster\n * than obtaining the keys and resolving each individually via indexing. This method was written\n * accellerate Intersect and Union encoding.\n */\nexport function KeyOfPropertyEntries(schema) {\n    const keys = KeyOfPropertyKeys(schema);\n    const schemas = IndexFromPropertyKeys(schema, keys);\n    return keys.map((_, index) => [keys[index], schemas[index]]);\n}\n", "import { Any } from '../any/index.mjs';\nimport { BigInt } from '../bigint/index.mjs';\nimport { Date } from '../date/index.mjs';\nimport { Function as FunctionType } from '../function/index.mjs';\nimport { Literal } from '../literal/index.mjs';\nimport { Null } from '../null/index.mjs';\nimport { Object } from '../object/index.mjs';\nimport { Symbol } from '../symbol/index.mjs';\nimport { Tuple } from '../tuple/index.mjs';\nimport { Readonly } from '../readonly/index.mjs';\nimport { Undefined } from '../undefined/index.mjs';\nimport { Uint8Array } from '../uint8array/index.mjs';\nimport { Unknown } from '../unknown/index.mjs';\nimport { CreateType } from '../create/index.mjs';\n// ------------------------------------------------------------------\n// ValueGuard\n// ------------------------------------------------------------------\nimport { IsArray, IsNumber, IsBigInt, IsUint8Array, IsDate, IsIterator, IsObject, IsAsyncIterator, IsFunction, IsUndefined, IsNull, IsSymbol, IsBoolean, IsString } from '../guard/value.mjs';\n// prettier-ignore\nfunction FromArray(T) {\n    return T.map(L => FromValue(L, false));\n}\n// prettier-ignore\nfunction FromProperties(value) {\n    const Acc = {};\n    for (const K of globalThis.Object.getOwnPropertyNames(value))\n        Acc[K] = Readonly(FromValue(value[K], false));\n    return Acc;\n}\nfunction ConditionalReadonly(T, root) {\n    return (root === true ? T : Readonly(T));\n}\n// prettier-ignore\nfunction FromValue(value, root) {\n    return (IsAsyncIterator(value) ? ConditionalReadonly(Any(), root) :\n        IsIterator(value) ? ConditionalReadonly(Any(), root) :\n            IsArray(value) ? Readonly(Tuple(FromArray(value))) :\n                IsUint8Array(value) ? Uint8Array() :\n                    IsDate(value) ? Date() :\n                        IsObject(value) ? ConditionalReadonly(Object(FromProperties(value)), root) :\n                            IsFunction(value) ? ConditionalReadonly(FunctionType([], Unknown()), root) :\n                                IsUndefined(value) ? Undefined() :\n                                    IsNull(value) ? Null() :\n                                        IsSymbol(value) ? Symbol() :\n                                            IsBigInt(value) ? BigInt() :\n                                                IsNumber(value) ? Literal(value) :\n                                                    IsBoolean(value) ? Literal(value) :\n                                                        IsString(value) ? Literal(value) :\n                                                            Object({}));\n}\n/** `[JavaScript]` Creates a readonly const type from the given value. */\nexport function Const(T, options) {\n    return CreateType(FromValue(T, true), options);\n}\n", "import { Kind } from '../symbols/index.mjs';\nimport { CreateType } from '../create/type.mjs';\n/** `[JavaScript]` Creates a Date type */\nexport function Date(options) {\n    return CreateType({ [Kind]: 'Date', type: 'Date' }, options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[Json]` Creates a Null type */\nexport function Null(options) {\n    return CreateType({ [Kind]: 'Null', type: 'null' }, options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[JavaScript]` Creates a Symbol type */\nexport function Symbol(options) {\n    return CreateType({ [Kind]: 'Symbol', type: 'symbol' }, options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[JavaScript]` Creates a Undefined type */\nexport function Undefined(options) {\n    return CreateType({ [Kind]: 'Undefined', type: 'undefined' }, options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[JavaScript]` Creates a Uint8Array type */\nexport function Uint8Array(options) {\n    return CreateType({ [Kind]: 'Uint8Array', type: 'Uint8Array' }, options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[Json]` Creates an Unknown type */\nexport function Unknown(options) {\n    return CreateType({ [Kind]: 'Unknown' }, options);\n}\n", "import { Tuple } from '../tuple/index.mjs';\n/** `[JavaScript]` Extracts the ConstructorParameters from the given Constructor type */\nexport function ConstructorParameters(schema, options) {\n    return Tuple(schema.parameters, options);\n}\n", "import { CloneType, CloneRest } from '../clone/type.mjs';\nimport { Discard } from '../discard/index.mjs';\nimport { IsUndefined } from '../guard/value.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsConstructor, IsFunction, IsIntersect, IsUnion, IsTuple, IsArray, IsObject, IsPromise, IsAsyncIterator, IsIterator, IsRef } from '../guard/kind.mjs';\nfunction FromRest(schema, references) {\n    return schema.map((schema) => Deref(schema, references));\n}\n// prettier-ignore\nfunction FromProperties(properties, references) {\n    const Acc = {};\n    for (const K of globalThis.Object.getOwnPropertyNames(properties)) {\n        Acc[K] = Deref(properties[K], references);\n    }\n    return Acc;\n}\n// prettier-ignore\nfunction FromConstructor(schema, references) {\n    schema.parameters = FromRest(schema.parameters, references);\n    schema.returns = Deref(schema.returns, references);\n    return schema;\n}\n// prettier-ignore\nfunction FromFunction(schema, references) {\n    schema.parameters = FromRest(schema.parameters, references);\n    schema.returns = Deref(schema.returns, references);\n    return schema;\n}\n// prettier-ignore\nfunction FromIntersect(schema, references) {\n    schema.allOf = FromRest(schema.allOf, references);\n    return schema;\n}\n// prettier-ignore\nfunction FromUnion(schema, references) {\n    schema.anyOf = FromRest(schema.anyOf, references);\n    return schema;\n}\n// prettier-ignore\nfunction FromTuple(schema, references) {\n    if (IsUndefined(schema.items))\n        return schema;\n    schema.items = FromRest(schema.items, references);\n    return schema;\n}\n// prettier-ignore\nfunction FromArray(schema, references) {\n    schema.items = Deref(schema.items, references);\n    return schema;\n}\n// prettier-ignore\nfunction FromObject(schema, references) {\n    schema.properties = FromProperties(schema.properties, references);\n    return schema;\n}\n// prettier-ignore\nfunction FromPromise(schema, references) {\n    schema.item = Deref(schema.item, references);\n    return schema;\n}\n// prettier-ignore\nfunction FromAsyncIterator(schema, references) {\n    schema.items = Deref(schema.items, references);\n    return schema;\n}\n// prettier-ignore\nfunction FromIterator(schema, references) {\n    schema.items = Deref(schema.items, references);\n    return schema;\n}\n// prettier-ignore\nfunction FromRef(schema, references) {\n    const target = references.find(remote => remote.$id === schema.$ref);\n    if (target === undefined)\n        throw Error(`Unable to dereference schema with $id ${schema.$ref}`);\n    const discard = Discard(target, ['$id']);\n    return Deref(discard, references);\n}\n// prettier-ignore\nfunction DerefResolve(schema, references) {\n    return (IsConstructor(schema) ? FromConstructor(schema, references) :\n        IsFunction(schema) ? FromFunction(schema, references) :\n            IsIntersect(schema) ? FromIntersect(schema, references) :\n                IsUnion(schema) ? FromUnion(schema, references) :\n                    IsTuple(schema) ? FromTuple(schema, references) :\n                        IsArray(schema) ? FromArray(schema, references) :\n                            IsObject(schema) ? FromObject(schema, references) :\n                                IsPromise(schema) ? FromPromise(schema, references) :\n                                    IsAsyncIterator(schema) ? FromAsyncIterator(schema, references) :\n                                        IsIterator(schema) ? FromIterator(schema, references) :\n                                            IsRef(schema) ? FromRef(schema, references) :\n                                                schema);\n}\n// ------------------------------------------------------------------\n// TDeref\n// ------------------------------------------------------------------\n/** `[Json]` Creates a dereferenced type */\nexport function Deref(schema, references) {\n    return DerefResolve(CloneType(schema), CloneRest(references));\n}\n", "import { Literal } from '../literal/index.mjs';\nimport { Kind, Hint } from '../symbols/index.mjs';\nimport { Union } from '../union/index.mjs';\n// ------------------------------------------------------------------\n// ValueGuard\n// ------------------------------------------------------------------\nimport { IsUndefined } from '../guard/value.mjs';\n/** `[Json]` Creates a Enum type */\nexport function Enum(item, options) {\n    if (IsUndefined(item))\n        throw new Error('Enum undefined or empty');\n    const values1 = globalThis.Object.getOwnPropertyNames(item)\n        .filter((key) => isNaN(key))\n        .map((key) => item[key]);\n    const values2 = [...new Set(values1)];\n    const anyOf = values2.map((value) => Literal(value));\n    return Union(anyOf, { ...options, [Hint]: 'Enum' });\n}\n", "import { MappedResult } from '../mapped/index.mjs';\nimport { Exclude } from './exclude.mjs';\n// prettier-ignore\nfunction FromProperties(P, U) {\n    const Acc = {};\n    for (const K2 of globalThis.Object.getOwnPropertyNames(P))\n        Acc[K2] = Exclude(P[K2], U);\n    return Acc;\n}\n// prettier-ignore\nfunction FromMappedResult(R, T) {\n    return FromProperties(R.properties, T);\n}\n// prettier-ignore\nexport function ExcludeFromMappedResult(R, T) {\n    const P = FromMappedResult(R, T);\n    return MappedResult(P);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Union } from '../union/index.mjs';\nimport { Never } from '../never/index.mjs';\nimport { ExtendsCheck, ExtendsResult } from '../extends/index.mjs';\nimport { ExcludeFromMappedResult } from './exclude-from-mapped-result.mjs';\nimport { ExcludeFromTemplateLiteral } from './exclude-from-template-literal.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsMappedResult, IsTemplateLiteral, IsUnion } from '../guard/kind.mjs';\nfunction ExcludeRest(L, R) {\n    const excluded = L.filter((inner) => ExtendsCheck(inner, R) === ExtendsResult.False);\n    return excluded.length === 1 ? excluded[0] : Union(excluded);\n}\n/** `[Json]` Constructs a type by excluding from unionType all union members that are assignable to excludedMembers */\nexport function Exclude(L, R, options = {}) {\n    // overloads\n    if (IsTemplateLiteral(L))\n        return CreateType(ExcludeFromTemplateLiteral(L, R), options);\n    if (IsMappedResult(L))\n        return CreateType(ExcludeFromMappedResult(L, R), options);\n    // prettier-ignore\n    return CreateType(IsUnion(L) ? ExcludeRest(L.anyOf, R) :\n        ExtendsCheck(L, R) !== ExtendsResult.False ? Never() : L, options);\n}\n", "import { Any } from '../any/index.mjs';\nimport { Function as FunctionType } from '../function/index.mjs';\nimport { Number } from '../number/index.mjs';\nimport { String } from '../string/index.mjs';\nimport { Unknown } from '../unknown/index.mjs';\nimport { TemplateLiteralToUnion } from '../template-literal/index.mjs';\nimport { PatternNumberExact, PatternStringExact } from '../patterns/index.mjs';\nimport { Kind, Hint } from '../symbols/index.mjs';\nimport { TypeBoxError } from '../error/index.mjs';\nimport { TypeGuard, ValueGuard } from '../guard/index.mjs';\nexport class ExtendsResolverError extends TypeBoxError {\n}\nexport var ExtendsResult;\n(function (ExtendsResult) {\n    ExtendsResult[ExtendsResult[\"Union\"] = 0] = \"Union\";\n    ExtendsResult[ExtendsResult[\"True\"] = 1] = \"True\";\n    ExtendsResult[ExtendsResult[\"False\"] = 2] = \"False\";\n})(ExtendsResult || (ExtendsResult = {}));\n// ------------------------------------------------------------------\n// IntoBooleanResult\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction IntoBooleanResult(result) {\n    return result === ExtendsResult.False ? result : ExtendsResult.True;\n}\n// ------------------------------------------------------------------\n// Throw\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction Throw(message) {\n    throw new ExtendsResolverError(message);\n}\n// ------------------------------------------------------------------\n// StructuralRight\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction IsStructuralRight(right) {\n    return (TypeGuard.IsNever(right) ||\n        TypeGuard.IsIntersect(right) ||\n        TypeGuard.IsUnion(right) ||\n        TypeGuard.IsUnknown(right) ||\n        TypeGuard.IsAny(right));\n}\n// prettier-ignore\nfunction StructuralRight(left, right) {\n    return (TypeGuard.IsNever(right) ? FromNeverRight(left, right) :\n        TypeGuard.IsIntersect(right) ? FromIntersectRight(left, right) :\n            TypeGuard.IsUnion(right) ? FromUnionRight(left, right) :\n                TypeGuard.IsUnknown(right) ? FromUnknownRight(left, right) :\n                    TypeGuard.IsAny(right) ? FromAnyRight(left, right) :\n                        Throw('StructuralRight'));\n}\n// ------------------------------------------------------------------\n// Any\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromAnyRight(left, right) {\n    return ExtendsResult.True;\n}\n// prettier-ignore\nfunction FromAny(left, right) {\n    return (TypeGuard.IsIntersect(right) ? FromIntersectRight(left, right) :\n        (TypeGuard.IsUnion(right) && right.anyOf.some((schema) => TypeGuard.IsAny(schema) || TypeGuard.IsUnknown(schema))) ? ExtendsResult.True :\n            TypeGuard.IsUnion(right) ? ExtendsResult.Union :\n                TypeGuard.IsUnknown(right) ? ExtendsResult.True :\n                    TypeGuard.IsAny(right) ? ExtendsResult.True :\n                        ExtendsResult.Union);\n}\n// ------------------------------------------------------------------\n// Array\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromArrayRight(left, right) {\n    return (TypeGuard.IsUnknown(left) ? ExtendsResult.False :\n        TypeGuard.IsAny(left) ? ExtendsResult.Union :\n            TypeGuard.IsNever(left) ? ExtendsResult.True :\n                ExtendsResult.False);\n}\n// prettier-ignore\nfunction FromArray(left, right) {\n    return (TypeGuard.IsObject(right) && IsObjectArrayLike(right) ? ExtendsResult.True :\n        IsStructuralRight(right) ? StructuralRight(left, right) :\n            !TypeGuard.IsArray(right) ? ExtendsResult.False :\n                IntoBooleanResult(Visit(left.items, right.items)));\n}\n// ------------------------------------------------------------------\n// AsyncIterator\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromAsyncIterator(left, right) {\n    return (IsStructuralRight(right) ? StructuralRight(left, right) :\n        !TypeGuard.IsAsyncIterator(right) ? ExtendsResult.False :\n            IntoBooleanResult(Visit(left.items, right.items)));\n}\n// ------------------------------------------------------------------\n// BigInt\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromBigInt(left, right) {\n    return (IsStructuralRight(right) ? StructuralRight(left, right) :\n        TypeGuard.IsObject(right) ? FromObjectRight(left, right) :\n            TypeGuard.IsRecord(right) ? FromRecordRight(left, right) :\n                TypeGuard.IsBigInt(right) ? ExtendsResult.True :\n                    ExtendsResult.False);\n}\n// ------------------------------------------------------------------\n// Boolean\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromBooleanRight(left, right) {\n    return (TypeGuard.IsLiteralBoolean(left) ? ExtendsResult.True :\n        TypeGuard.IsBoolean(left) ? ExtendsResult.True :\n            ExtendsResult.False);\n}\n// prettier-ignore\nfunction FromBoolean(left, right) {\n    return (IsStructuralRight(right) ? StructuralRight(left, right) :\n        TypeGuard.IsObject(right) ? FromObjectRight(left, right) :\n            TypeGuard.IsRecord(right) ? FromRecordRight(left, right) :\n                TypeGuard.IsBoolean(right) ? ExtendsResult.True :\n                    ExtendsResult.False);\n}\n// ------------------------------------------------------------------\n// Constructor\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromConstructor(left, right) {\n    return (IsStructuralRight(right) ? StructuralRight(left, right) :\n        TypeGuard.IsObject(right) ? FromObjectRight(left, right) :\n            !TypeGuard.IsConstructor(right) ? ExtendsResult.False :\n                left.parameters.length > right.parameters.length ? ExtendsResult.False :\n                    (!left.parameters.every((schema, index) => IntoBooleanResult(Visit(right.parameters[index], schema)) === ExtendsResult.True)) ? ExtendsResult.False :\n                        IntoBooleanResult(Visit(left.returns, right.returns)));\n}\n// ------------------------------------------------------------------\n// Date\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromDate(left, right) {\n    return (IsStructuralRight(right) ? StructuralRight(left, right) :\n        TypeGuard.IsObject(right) ? FromObjectRight(left, right) :\n            TypeGuard.IsRecord(right) ? FromRecordRight(left, right) :\n                TypeGuard.IsDate(right) ? ExtendsResult.True :\n                    ExtendsResult.False);\n}\n// ------------------------------------------------------------------\n// Function\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromFunction(left, right) {\n    return (IsStructuralRight(right) ? StructuralRight(left, right) :\n        TypeGuard.IsObject(right) ? FromObjectRight(left, right) :\n            !TypeGuard.IsFunction(right) ? ExtendsResult.False :\n                left.parameters.length > right.parameters.length ? ExtendsResult.False :\n                    (!left.parameters.every((schema, index) => IntoBooleanResult(Visit(right.parameters[index], schema)) === ExtendsResult.True)) ? ExtendsResult.False :\n                        IntoBooleanResult(Visit(left.returns, right.returns)));\n}\n// ------------------------------------------------------------------\n// Integer\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromIntegerRight(left, right) {\n    return (TypeGuard.IsLiteral(left) && ValueGuard.IsNumber(left.const) ? ExtendsResult.True :\n        TypeGuard.IsNumber(left) || TypeGuard.IsInteger(left) ? ExtendsResult.True :\n            ExtendsResult.False);\n}\n// prettier-ignore\nfunction FromInteger(left, right) {\n    return (TypeGuard.IsInteger(right) || TypeGuard.IsNumber(right) ? ExtendsResult.True :\n        IsStructuralRight(right) ? StructuralRight(left, right) :\n            TypeGuard.IsObject(right) ? FromObjectRight(left, right) :\n                TypeGuard.IsRecord(right) ? FromRecordRight(left, right) :\n                    ExtendsResult.False);\n}\n// ------------------------------------------------------------------\n// Intersect\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromIntersectRight(left, right) {\n    return right.allOf.every((schema) => Visit(left, schema) === ExtendsResult.True)\n        ? ExtendsResult.True\n        : ExtendsResult.False;\n}\n// prettier-ignore\nfunction FromIntersect(left, right) {\n    return left.allOf.some((schema) => Visit(schema, right) === ExtendsResult.True)\n        ? ExtendsResult.True\n        : ExtendsResult.False;\n}\n// ------------------------------------------------------------------\n// Iterator\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromIterator(left, right) {\n    return (IsStructuralRight(right) ? StructuralRight(left, right) :\n        !TypeGuard.IsIterator(right) ? ExtendsResult.False :\n            IntoBooleanResult(Visit(left.items, right.items)));\n}\n// ------------------------------------------------------------------\n// Literal\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromLiteral(left, right) {\n    return (TypeGuard.IsLiteral(right) && right.const === left.const ? ExtendsResult.True :\n        IsStructuralRight(right) ? StructuralRight(left, right) :\n            TypeGuard.IsObject(right) ? FromObjectRight(left, right) :\n                TypeGuard.IsRecord(right) ? FromRecordRight(left, right) :\n                    TypeGuard.IsString(right) ? FromStringRight(left, right) :\n                        TypeGuard.IsNumber(right) ? FromNumberRight(left, right) :\n                            TypeGuard.IsInteger(right) ? FromIntegerRight(left, right) :\n                                TypeGuard.IsBoolean(right) ? FromBooleanRight(left, right) :\n                                    ExtendsResult.False);\n}\n// ------------------------------------------------------------------\n// Never\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromNeverRight(left, right) {\n    return ExtendsResult.False;\n}\n// prettier-ignore\nfunction FromNever(left, right) {\n    return ExtendsResult.True;\n}\n// ------------------------------------------------------------------\n// Not\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction UnwrapTNot(schema) {\n    let [current, depth] = [schema, 0];\n    while (true) {\n        if (!TypeGuard.IsNot(current))\n            break;\n        current = current.not;\n        depth += 1;\n    }\n    return depth % 2 === 0 ? current : Unknown();\n}\n// prettier-ignore\nfunction FromNot(left, right) {\n    // TypeScript has no concept of negated types, and attempts to correctly check the negated\n    // type at runtime would put TypeBox at odds with TypeScripts ability to statically infer\n    // the type. Instead we unwrap to either unknown or T and continue evaluating.\n    // prettier-ignore\n    return (TypeGuard.IsNot(left) ? Visit(UnwrapTNot(left), right) :\n        TypeGuard.IsNot(right) ? Visit(left, UnwrapTNot(right)) :\n            Throw('Invalid fallthrough for Not'));\n}\n// ------------------------------------------------------------------\n// Null\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromNull(left, right) {\n    return (IsStructuralRight(right) ? StructuralRight(left, right) :\n        TypeGuard.IsObject(right) ? FromObjectRight(left, right) :\n            TypeGuard.IsRecord(right) ? FromRecordRight(left, right) :\n                TypeGuard.IsNull(right) ? ExtendsResult.True :\n                    ExtendsResult.False);\n}\n// ------------------------------------------------------------------\n// Number\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromNumberRight(left, right) {\n    return (TypeGuard.IsLiteralNumber(left) ? ExtendsResult.True :\n        TypeGuard.IsNumber(left) || TypeGuard.IsInteger(left) ? ExtendsResult.True :\n            ExtendsResult.False);\n}\n// prettier-ignore\nfunction FromNumber(left, right) {\n    return (IsStructuralRight(right) ? StructuralRight(left, right) :\n        TypeGuard.IsObject(right) ? FromObjectRight(left, right) :\n            TypeGuard.IsRecord(right) ? FromRecordRight(left, right) :\n                TypeGuard.IsInteger(right) || TypeGuard.IsNumber(right) ? ExtendsResult.True :\n                    ExtendsResult.False);\n}\n// ------------------------------------------------------------------\n// Object\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction IsObjectPropertyCount(schema, count) {\n    return Object.getOwnPropertyNames(schema.properties).length === count;\n}\n// prettier-ignore\nfunction IsObjectStringLike(schema) {\n    return IsObjectArrayLike(schema);\n}\n// prettier-ignore\nfunction IsObjectSymbolLike(schema) {\n    return IsObjectPropertyCount(schema, 0) || (IsObjectPropertyCount(schema, 1) && 'description' in schema.properties && TypeGuard.IsUnion(schema.properties.description) && schema.properties.description.anyOf.length === 2 && ((TypeGuard.IsString(schema.properties.description.anyOf[0]) &&\n        TypeGuard.IsUndefined(schema.properties.description.anyOf[1])) || (TypeGuard.IsString(schema.properties.description.anyOf[1]) &&\n        TypeGuard.IsUndefined(schema.properties.description.anyOf[0]))));\n}\n// prettier-ignore\nfunction IsObjectNumberLike(schema) {\n    return IsObjectPropertyCount(schema, 0);\n}\n// prettier-ignore\nfunction IsObjectBooleanLike(schema) {\n    return IsObjectPropertyCount(schema, 0);\n}\n// prettier-ignore\nfunction IsObjectBigIntLike(schema) {\n    return IsObjectPropertyCount(schema, 0);\n}\n// prettier-ignore\nfunction IsObjectDateLike(schema) {\n    return IsObjectPropertyCount(schema, 0);\n}\n// prettier-ignore\nfunction IsObjectUint8ArrayLike(schema) {\n    return IsObjectArrayLike(schema);\n}\n// prettier-ignore\nfunction IsObjectFunctionLike(schema) {\n    const length = Number();\n    return IsObjectPropertyCount(schema, 0) || (IsObjectPropertyCount(schema, 1) && 'length' in schema.properties && IntoBooleanResult(Visit(schema.properties['length'], length)) === ExtendsResult.True);\n}\n// prettier-ignore\nfunction IsObjectConstructorLike(schema) {\n    return IsObjectPropertyCount(schema, 0);\n}\n// prettier-ignore\nfunction IsObjectArrayLike(schema) {\n    const length = Number();\n    return IsObjectPropertyCount(schema, 0) || (IsObjectPropertyCount(schema, 1) && 'length' in schema.properties && IntoBooleanResult(Visit(schema.properties['length'], length)) === ExtendsResult.True);\n}\n// prettier-ignore\nfunction IsObjectPromiseLike(schema) {\n    const then = FunctionType([Any()], Any());\n    return IsObjectPropertyCount(schema, 0) || (IsObjectPropertyCount(schema, 1) && 'then' in schema.properties && IntoBooleanResult(Visit(schema.properties['then'], then)) === ExtendsResult.True);\n}\n// ------------------------------------------------------------------\n// Property\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction Property(left, right) {\n    return (Visit(left, right) === ExtendsResult.False ? ExtendsResult.False :\n        TypeGuard.IsOptional(left) && !TypeGuard.IsOptional(right) ? ExtendsResult.False :\n            ExtendsResult.True);\n}\n// prettier-ignore\nfunction FromObjectRight(left, right) {\n    return (TypeGuard.IsUnknown(left) ? ExtendsResult.False :\n        TypeGuard.IsAny(left) ? ExtendsResult.Union : (TypeGuard.IsNever(left) ||\n            (TypeGuard.IsLiteralString(left) && IsObjectStringLike(right)) ||\n            (TypeGuard.IsLiteralNumber(left) && IsObjectNumberLike(right)) ||\n            (TypeGuard.IsLiteralBoolean(left) && IsObjectBooleanLike(right)) ||\n            (TypeGuard.IsSymbol(left) && IsObjectSymbolLike(right)) ||\n            (TypeGuard.IsBigInt(left) && IsObjectBigIntLike(right)) ||\n            (TypeGuard.IsString(left) && IsObjectStringLike(right)) ||\n            (TypeGuard.IsSymbol(left) && IsObjectSymbolLike(right)) ||\n            (TypeGuard.IsNumber(left) && IsObjectNumberLike(right)) ||\n            (TypeGuard.IsInteger(left) && IsObjectNumberLike(right)) ||\n            (TypeGuard.IsBoolean(left) && IsObjectBooleanLike(right)) ||\n            (TypeGuard.IsUint8Array(left) && IsObjectUint8ArrayLike(right)) ||\n            (TypeGuard.IsDate(left) && IsObjectDateLike(right)) ||\n            (TypeGuard.IsConstructor(left) && IsObjectConstructorLike(right)) ||\n            (TypeGuard.IsFunction(left) && IsObjectFunctionLike(right))) ? ExtendsResult.True :\n            (TypeGuard.IsRecord(left) && TypeGuard.IsString(RecordKey(left))) ? (() => {\n                // When expressing a Record with literal key values, the Record is converted into a Object with\n                // the Hint assigned as `Record`. This is used to invert the extends logic.\n                return right[Hint] === 'Record' ? ExtendsResult.True : ExtendsResult.False;\n            })() :\n                (TypeGuard.IsRecord(left) && TypeGuard.IsNumber(RecordKey(left))) ? (() => {\n                    return IsObjectPropertyCount(right, 0) ? ExtendsResult.True : ExtendsResult.False;\n                })() :\n                    ExtendsResult.False);\n}\n// prettier-ignore\nfunction FromObject(left, right) {\n    return (IsStructuralRight(right) ? StructuralRight(left, right) :\n        TypeGuard.IsRecord(right) ? FromRecordRight(left, right) :\n            !TypeGuard.IsObject(right) ? ExtendsResult.False :\n                (() => {\n                    for (const key of Object.getOwnPropertyNames(right.properties)) {\n                        if (!(key in left.properties) && !TypeGuard.IsOptional(right.properties[key])) {\n                            return ExtendsResult.False;\n                        }\n                        if (TypeGuard.IsOptional(right.properties[key])) {\n                            return ExtendsResult.True;\n                        }\n                        if (Property(left.properties[key], right.properties[key]) === ExtendsResult.False) {\n                            return ExtendsResult.False;\n                        }\n                    }\n                    return ExtendsResult.True;\n                })());\n}\n// ------------------------------------------------------------------\n// Promise\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromPromise(left, right) {\n    return (IsStructuralRight(right) ? StructuralRight(left, right) :\n        TypeGuard.IsObject(right) && IsObjectPromiseLike(right) ? ExtendsResult.True :\n            !TypeGuard.IsPromise(right) ? ExtendsResult.False :\n                IntoBooleanResult(Visit(left.item, right.item)));\n}\n// ------------------------------------------------------------------\n// Record\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction RecordKey(schema) {\n    return (PatternNumberExact in schema.patternProperties ? Number() :\n        PatternStringExact in schema.patternProperties ? String() :\n            Throw('Unknown record key pattern'));\n}\n// prettier-ignore\nfunction RecordValue(schema) {\n    return (PatternNumberExact in schema.patternProperties ? schema.patternProperties[PatternNumberExact] :\n        PatternStringExact in schema.patternProperties ? schema.patternProperties[PatternStringExact] :\n            Throw('Unable to get record value schema'));\n}\n// prettier-ignore\nfunction FromRecordRight(left, right) {\n    const [Key, Value] = [RecordKey(right), RecordValue(right)];\n    return ((TypeGuard.IsLiteralString(left) && TypeGuard.IsNumber(Key) && IntoBooleanResult(Visit(left, Value)) === ExtendsResult.True) ? ExtendsResult.True :\n        TypeGuard.IsUint8Array(left) && TypeGuard.IsNumber(Key) ? Visit(left, Value) :\n            TypeGuard.IsString(left) && TypeGuard.IsNumber(Key) ? Visit(left, Value) :\n                TypeGuard.IsArray(left) && TypeGuard.IsNumber(Key) ? Visit(left, Value) :\n                    TypeGuard.IsObject(left) ? (() => {\n                        for (const key of Object.getOwnPropertyNames(left.properties)) {\n                            if (Property(Value, left.properties[key]) === ExtendsResult.False) {\n                                return ExtendsResult.False;\n                            }\n                        }\n                        return ExtendsResult.True;\n                    })() :\n                        ExtendsResult.False);\n}\n// prettier-ignore\nfunction FromRecord(left, right) {\n    return (IsStructuralRight(right) ? StructuralRight(left, right) :\n        TypeGuard.IsObject(right) ? FromObjectRight(left, right) :\n            !TypeGuard.IsRecord(right) ? ExtendsResult.False :\n                Visit(RecordValue(left), RecordValue(right)));\n}\n// ------------------------------------------------------------------\n// RegExp\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromRegExp(left, right) {\n    // Note: RegExp types evaluate as strings, not RegExp objects.\n    // Here we remap either into string and continue evaluating.\n    const L = TypeGuard.IsRegExp(left) ? String() : left;\n    const R = TypeGuard.IsRegExp(right) ? String() : right;\n    return Visit(L, R);\n}\n// ------------------------------------------------------------------\n// String\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromStringRight(left, right) {\n    return (TypeGuard.IsLiteral(left) && ValueGuard.IsString(left.const) ? ExtendsResult.True :\n        TypeGuard.IsString(left) ? ExtendsResult.True :\n            ExtendsResult.False);\n}\n// prettier-ignore\nfunction FromString(left, right) {\n    return (IsStructuralRight(right) ? StructuralRight(left, right) :\n        TypeGuard.IsObject(right) ? FromObjectRight(left, right) :\n            TypeGuard.IsRecord(right) ? FromRecordRight(left, right) :\n                TypeGuard.IsString(right) ? ExtendsResult.True :\n                    ExtendsResult.False);\n}\n// ------------------------------------------------------------------\n// Symbol\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromSymbol(left, right) {\n    return (IsStructuralRight(right) ? StructuralRight(left, right) :\n        TypeGuard.IsObject(right) ? FromObjectRight(left, right) :\n            TypeGuard.IsRecord(right) ? FromRecordRight(left, right) :\n                TypeGuard.IsSymbol(right) ? ExtendsResult.True :\n                    ExtendsResult.False);\n}\n// ------------------------------------------------------------------\n// TemplateLiteral\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromTemplateLiteral(left, right) {\n    // TemplateLiteral types are resolved to either unions for finite expressions or string\n    // for infinite expressions. Here we call to TemplateLiteralResolver to resolve for\n    // either type and continue evaluating.\n    return (TypeGuard.IsTemplateLiteral(left) ? Visit(TemplateLiteralToUnion(left), right) :\n        TypeGuard.IsTemplateLiteral(right) ? Visit(left, TemplateLiteralToUnion(right)) :\n            Throw('Invalid fallthrough for TemplateLiteral'));\n}\n// ------------------------------------------------------------------\n// Tuple\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction IsArrayOfTuple(left, right) {\n    return (TypeGuard.IsArray(right) &&\n        left.items !== undefined &&\n        left.items.every((schema) => Visit(schema, right.items) === ExtendsResult.True));\n}\n// prettier-ignore\nfunction FromTupleRight(left, right) {\n    return (TypeGuard.IsNever(left) ? ExtendsResult.True :\n        TypeGuard.IsUnknown(left) ? ExtendsResult.False :\n            TypeGuard.IsAny(left) ? ExtendsResult.Union :\n                ExtendsResult.False);\n}\n// prettier-ignore\nfunction FromTuple(left, right) {\n    return (IsStructuralRight(right) ? StructuralRight(left, right) :\n        TypeGuard.IsObject(right) && IsObjectArrayLike(right) ? ExtendsResult.True :\n            TypeGuard.IsArray(right) && IsArrayOfTuple(left, right) ? ExtendsResult.True :\n                !TypeGuard.IsTuple(right) ? ExtendsResult.False :\n                    (ValueGuard.IsUndefined(left.items) && !ValueGuard.IsUndefined(right.items)) || (!ValueGuard.IsUndefined(left.items) && ValueGuard.IsUndefined(right.items)) ? ExtendsResult.False :\n                        (ValueGuard.IsUndefined(left.items) && !ValueGuard.IsUndefined(right.items)) ? ExtendsResult.True :\n                            left.items.every((schema, index) => Visit(schema, right.items[index]) === ExtendsResult.True) ? ExtendsResult.True :\n                                ExtendsResult.False);\n}\n// ------------------------------------------------------------------\n// Uint8Array\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromUint8Array(left, right) {\n    return (IsStructuralRight(right) ? StructuralRight(left, right) :\n        TypeGuard.IsObject(right) ? FromObjectRight(left, right) :\n            TypeGuard.IsRecord(right) ? FromRecordRight(left, right) :\n                TypeGuard.IsUint8Array(right) ? ExtendsResult.True :\n                    ExtendsResult.False);\n}\n// ------------------------------------------------------------------\n// Undefined\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromUndefined(left, right) {\n    return (IsStructuralRight(right) ? StructuralRight(left, right) :\n        TypeGuard.IsObject(right) ? FromObjectRight(left, right) :\n            TypeGuard.IsRecord(right) ? FromRecordRight(left, right) :\n                TypeGuard.IsVoid(right) ? FromVoidRight(left, right) :\n                    TypeGuard.IsUndefined(right) ? ExtendsResult.True :\n                        ExtendsResult.False);\n}\n// ------------------------------------------------------------------\n// Union\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromUnionRight(left, right) {\n    return right.anyOf.some((schema) => Visit(left, schema) === ExtendsResult.True)\n        ? ExtendsResult.True\n        : ExtendsResult.False;\n}\n// prettier-ignore\nfunction FromUnion(left, right) {\n    return left.anyOf.every((schema) => Visit(schema, right) === ExtendsResult.True)\n        ? ExtendsResult.True\n        : ExtendsResult.False;\n}\n// ------------------------------------------------------------------\n// Unknown\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromUnknownRight(left, right) {\n    return ExtendsResult.True;\n}\n// prettier-ignore\nfunction FromUnknown(left, right) {\n    return (TypeGuard.IsNever(right) ? FromNeverRight(left, right) :\n        TypeGuard.IsIntersect(right) ? FromIntersectRight(left, right) :\n            TypeGuard.IsUnion(right) ? FromUnionRight(left, right) :\n                TypeGuard.IsAny(right) ? FromAnyRight(left, right) :\n                    TypeGuard.IsString(right) ? FromStringRight(left, right) :\n                        TypeGuard.IsNumber(right) ? FromNumberRight(left, right) :\n                            TypeGuard.IsInteger(right) ? FromIntegerRight(left, right) :\n                                TypeGuard.IsBoolean(right) ? FromBooleanRight(left, right) :\n                                    TypeGuard.IsArray(right) ? FromArrayRight(left, right) :\n                                        TypeGuard.IsTuple(right) ? FromTupleRight(left, right) :\n                                            TypeGuard.IsObject(right) ? FromObjectRight(left, right) :\n                                                TypeGuard.IsUnknown(right) ? ExtendsResult.True :\n                                                    ExtendsResult.False);\n}\n// ------------------------------------------------------------------\n// Void\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromVoidRight(left, right) {\n    return (TypeGuard.IsUndefined(left) ? ExtendsResult.True :\n        TypeGuard.IsUndefined(left) ? ExtendsResult.True :\n            ExtendsResult.False);\n}\n// prettier-ignore\nfunction FromVoid(left, right) {\n    return (TypeGuard.IsIntersect(right) ? FromIntersectRight(left, right) :\n        TypeGuard.IsUnion(right) ? FromUnionRight(left, right) :\n            TypeGuard.IsUnknown(right) ? FromUnknownRight(left, right) :\n                TypeGuard.IsAny(right) ? FromAnyRight(left, right) :\n                    TypeGuard.IsObject(right) ? FromObjectRight(left, right) :\n                        TypeGuard.IsVoid(right) ? ExtendsResult.True :\n                            ExtendsResult.False);\n}\n// prettier-ignore\nfunction Visit(left, right) {\n    return (\n    // resolvable\n    (TypeGuard.IsTemplateLiteral(left) || TypeGuard.IsTemplateLiteral(right)) ? FromTemplateLiteral(left, right) :\n        (TypeGuard.IsRegExp(left) || TypeGuard.IsRegExp(right)) ? FromRegExp(left, right) :\n            (TypeGuard.IsNot(left) || TypeGuard.IsNot(right)) ? FromNot(left, right) :\n                // standard\n                TypeGuard.IsAny(left) ? FromAny(left, right) :\n                    TypeGuard.IsArray(left) ? FromArray(left, right) :\n                        TypeGuard.IsBigInt(left) ? FromBigInt(left, right) :\n                            TypeGuard.IsBoolean(left) ? FromBoolean(left, right) :\n                                TypeGuard.IsAsyncIterator(left) ? FromAsyncIterator(left, right) :\n                                    TypeGuard.IsConstructor(left) ? FromConstructor(left, right) :\n                                        TypeGuard.IsDate(left) ? FromDate(left, right) :\n                                            TypeGuard.IsFunction(left) ? FromFunction(left, right) :\n                                                TypeGuard.IsInteger(left) ? FromInteger(left, right) :\n                                                    TypeGuard.IsIntersect(left) ? FromIntersect(left, right) :\n                                                        TypeGuard.IsIterator(left) ? FromIterator(left, right) :\n                                                            TypeGuard.IsLiteral(left) ? FromLiteral(left, right) :\n                                                                TypeGuard.IsNever(left) ? FromNever(left, right) :\n                                                                    TypeGuard.IsNull(left) ? FromNull(left, right) :\n                                                                        TypeGuard.IsNumber(left) ? FromNumber(left, right) :\n                                                                            TypeGuard.IsObject(left) ? FromObject(left, right) :\n                                                                                TypeGuard.IsRecord(left) ? FromRecord(left, right) :\n                                                                                    TypeGuard.IsString(left) ? FromString(left, right) :\n                                                                                        TypeGuard.IsSymbol(left) ? FromSymbol(left, right) :\n                                                                                            TypeGuard.IsTuple(left) ? FromTuple(left, right) :\n                                                                                                TypeGuard.IsPromise(left) ? FromPromise(left, right) :\n                                                                                                    TypeGuard.IsUint8Array(left) ? FromUint8Array(left, right) :\n                                                                                                        TypeGuard.IsUndefined(left) ? FromUndefined(left, right) :\n                                                                                                            TypeGuard.IsUnion(left) ? FromUnion(left, right) :\n                                                                                                                TypeGuard.IsUnknown(left) ? FromUnknown(left, right) :\n                                                                                                                    TypeGuard.IsVoid(left) ? FromVoid(left, right) :\n                                                                                                                        Throw(`Unknown left type operand '${left[Kind]}'`));\n}\nexport function ExtendsCheck(left, right) {\n    return Visit(left, right);\n}\n", "import { MappedResult } from '../mapped/index.mjs';\nimport { Literal } from '../literal/index.mjs';\nimport { Extends } from './extends.mjs';\nimport { Clone } from '../clone/value.mjs';\n// prettier-ignore\nfunction FromPropertyKey(K, U, L, R, options) {\n    return {\n        [K]: Extends(Literal(K), U, L, R, Clone(options))\n    };\n}\n// prettier-ignore\nfunction FromPropertyKeys(K, U, L, R, options) {\n    return K.reduce((Acc, LK) => {\n        return { ...Acc, ...FromPropertyKey(LK, U, L, R, options) };\n    }, {});\n}\n// prettier-ignore\nfunction FromMappedKey(K, U, L, R, options) {\n    return FromPropertyKeys(K.keys, U, L, R, options);\n}\n// prettier-ignore\nexport function ExtendsFromMappedKey(T, U, L, R, options) {\n    const P = FromMappedKey(T, U, L, R, options);\n    return MappedResult(P);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Union } from '../union/index.mjs';\nimport { ExtendsCheck, ExtendsResult } from './extends-check.mjs';\nimport { ExtendsFromMappedKey } from './extends-from-mapped-key.mjs';\nimport { ExtendsFromMappedResult } from './extends-from-mapped-result.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsMappedKey, IsMappedResult } from '../guard/kind.mjs';\n// prettier-ignore\nfunction ExtendsResolve(left, right, trueType, falseType) {\n    const R = ExtendsCheck(left, right);\n    return (R === ExtendsResult.Union ? Union([trueType, falseType]) :\n        R === ExtendsResult.True ? trueType :\n            falseType);\n}\n/** `[Json]` Creates a Conditional type */\nexport function Extends(L, R, T, F, options) {\n    // prettier-ignore\n    return (IsMappedResult(L) ? ExtendsFromMappedResult(L, R, T, F, options) :\n        IsMappedKey(L) ? CreateType(ExtendsFromMappedKey(L, R, T, F, options)) :\n            CreateType(ExtendsResolve(L, R, T, F), options));\n}\n", "import { MappedResult } from '../mapped/index.mjs';\nimport { Extends } from './extends.mjs';\nimport { Clone } from '../clone/value.mjs';\n// prettier-ignore\nfunction FromProperties(P, Right, True, False, options) {\n    const Acc = {};\n    for (const K2 of globalThis.Object.getOwnPropertyNames(P))\n        Acc[K2] = Extends(P[K2], Right, True, False, Clone(options));\n    return Acc;\n}\n// prettier-ignore\nfunction FromMappedResult(Left, Right, True, False, options) {\n    return FromProperties(Left.properties, Right, True, False, options);\n}\n// prettier-ignore\nexport function ExtendsFromMappedResult(Left, Right, True, False, options) {\n    const P = FromMappedResult(Left, Right, True, False, options);\n    return MappedResult(P);\n}\n", "import { Kind } from '../symbols/index.mjs';\n/** Fast undefined check used for properties of type undefined */\nfunction Intersect(schema) {\n    return schema.allOf.every((schema) => ExtendsUndefinedCheck(schema));\n}\nfunction Union(schema) {\n    return schema.anyOf.some((schema) => ExtendsUndefinedCheck(schema));\n}\nfunction Not(schema) {\n    return !ExtendsUndefinedCheck(schema.not);\n}\n/** Fast undefined check used for properties of type undefined */\n// prettier-ignore\nexport function ExtendsUndefinedCheck(schema) {\n    return (schema[Kind] === 'Intersect' ? Intersect(schema) :\n        schema[Kind] === 'Union' ? Union(schema) :\n            schema[Kind] === 'Not' ? Not(schema) :\n                schema[Kind] === 'Undefined' ? true :\n                    false);\n}\n", "import { Exclude } from './exclude.mjs';\nimport { TemplateLiteralToUnion } from '../template-literal/index.mjs';\nexport function ExcludeFromTemplateLiteral(L, R) {\n    return Exclude(TemplateLiteralToUnion(L), R);\n}\n", "import { MappedResult } from '../mapped/index.mjs';\nimport { Extract } from './extract.mjs';\n// prettier-ignore\nfunction FromProperties(P, T) {\n    const Acc = {};\n    for (const K2 of globalThis.Object.getOwnPropertyNames(P))\n        Acc[K2] = Extract(P[K2], T);\n    return Acc;\n}\n// prettier-ignore\nfunction FromMappedResult(R, T) {\n    return FromProperties(R.properties, T);\n}\n// prettier-ignore\nexport function ExtractFromMappedResult(R, T) {\n    const P = FromMappedResult(R, T);\n    return MappedResult(P);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Union } from '../union/index.mjs';\nimport { Never } from '../never/index.mjs';\nimport { ExtendsCheck, ExtendsResult } from '../extends/index.mjs';\nimport { ExtractFromMappedResult } from './extract-from-mapped-result.mjs';\nimport { ExtractFromTemplateLiteral } from './extract-from-template-literal.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsMappedResult, IsTemplateLiteral, IsUnion } from '../guard/kind.mjs';\nfunction ExtractRest(L, R) {\n    const extracted = L.filter((inner) => ExtendsCheck(inner, R) !== ExtendsResult.False);\n    return extracted.length === 1 ? extracted[0] : Union(extracted);\n}\n/** `[Json]` Constructs a type by extracting from type all union members that are assignable to union */\nexport function Extract(L, R, options) {\n    // overloads\n    if (IsTemplateLiteral(L))\n        return CreateType(ExtractFromTemplateLiteral(L, R), options);\n    if (IsMappedResult(L))\n        return CreateType(ExtractFromMappedResult(L, R), options);\n    // prettier-ignore\n    return CreateType(IsUnion(L) ? ExtractRest(L.anyOf, R) :\n        ExtendsCheck(L, R) !== ExtendsResult.False ? L : Never(), options);\n}\n", "import { Extract } from './extract.mjs';\nimport { TemplateLiteralToUnion } from '../template-literal/index.mjs';\nexport function ExtractFromTemplateLiteral(L, R) {\n    return Extract(TemplateLiteralToUnion(L), R);\n}\n", "import { CreateType } from '../create/type.mjs';\n/** `[JavaScript]` Extracts the InstanceType from the given Constructor type */\nexport function InstanceType(schema, options) {\n    return CreateType(schema.returns, options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[Json]` Creates an Integer type */\nexport function Integer(options) {\n    return CreateType({ [Kind]: 'Integer', type: 'integer' }, options);\n}\n", "import { Intrinsic } from './intrinsic.mjs';\n/** `[Json]` Intrinsic function to Capitalize LiteralString types */\nexport function Capitalize(T, options = {}) {\n    return Intrinsic(T, 'Capitalize', options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { TemplateLiteral, TemplateLiteralParseExact, IsTemplateLiteralExpressionFinite, TemplateLiteralExpressionGenerate } from '../template-literal/index.mjs';\nimport { IntrinsicFromMappedKey } from './intrinsic-from-mapped-key.mjs';\nimport { Literal } from '../literal/index.mjs';\nimport { Union } from '../union/index.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsMappedKey, IsTemplateLiteral, IsUnion, IsLiteral } from '../guard/kind.mjs';\n// ------------------------------------------------------------------\n// Apply\n// ------------------------------------------------------------------\nfunction ApplyUncapitalize(value) {\n    const [first, rest] = [value.slice(0, 1), value.slice(1)];\n    return [first.toLowerCase(), rest].join('');\n}\nfunction ApplyCapitalize(value) {\n    const [first, rest] = [value.slice(0, 1), value.slice(1)];\n    return [first.toUpperCase(), rest].join('');\n}\nfunction ApplyUppercase(value) {\n    return value.toUpperCase();\n}\nfunction ApplyLowercase(value) {\n    return value.toLowerCase();\n}\nfunction FromTemplateLiteral(schema, mode, options) {\n    // note: template literals require special runtime handling as they are encoded in string patterns.\n    // This diverges from the mapped type which would otherwise map on the template literal kind.\n    const expression = TemplateLiteralParseExact(schema.pattern);\n    const finite = IsTemplateLiteralExpressionFinite(expression);\n    if (!finite)\n        return { ...schema, pattern: FromLiteralValue(schema.pattern, mode) };\n    const strings = [...TemplateLiteralExpressionGenerate(expression)];\n    const literals = strings.map((value) => Literal(value));\n    const mapped = FromRest(literals, mode);\n    const union = Union(mapped);\n    return TemplateLiteral([union], options);\n}\n// prettier-ignore\nfunction FromLiteralValue(value, mode) {\n    return (typeof value === 'string' ? (mode === 'Uncapitalize' ? ApplyUncapitalize(value) :\n        mode === 'Capitalize' ? ApplyCapitalize(value) :\n            mode === 'Uppercase' ? ApplyUppercase(value) :\n                mode === 'Lowercase' ? ApplyLowercase(value) :\n                    value) : value.toString());\n}\n// prettier-ignore\nfunction FromRest(T, M) {\n    return T.map(L => Intrinsic(L, M));\n}\n/** Applies an intrinsic string manipulation to the given type. */\nexport function Intrinsic(schema, mode, options = {}) {\n    // prettier-ignore\n    return (\n    // Intrinsic-Mapped-Inference\n    IsMappedKey(schema) ? IntrinsicFromMappedKey(schema, mode, options) :\n        // Standard-Inference\n        IsTemplateLiteral(schema) ? FromTemplateLiteral(schema, mode, options) :\n            IsUnion(schema) ? Union(FromRest(schema.anyOf, mode), options) :\n                IsLiteral(schema) ? Literal(FromLiteralValue(schema.const, mode), options) :\n                    // Default Type\n                    CreateType(schema, options));\n}\n", "import { MappedResult } from '../mapped/index.mjs';\nimport { Intrinsic } from './intrinsic.mjs';\nimport { Literal } from '../literal/index.mjs';\nimport { Clone } from '../clone/value.mjs';\n// prettier-ignore\nfunction MappedIntrinsicPropertyKey(K, M, options) {\n    return {\n        [K]: Intrinsic(Literal(K), M, Clone(options))\n    };\n}\n// prettier-ignore\nfunction MappedIntrinsicPropertyKeys(K, M, options) {\n    const result = K.reduce((Acc, L) => {\n        return { ...Acc, ...MappedIntrinsicPropertyKey(L, M, options) };\n    }, {});\n    return result;\n}\n// prettier-ignore\nfunction MappedIntrinsicProperties(T, M, options) {\n    return MappedIntrinsicPropertyKeys(T['keys'], M, options);\n}\n// prettier-ignore\nexport function IntrinsicFromMappedKey(T, M, options) {\n    const P = MappedIntrinsicProperties(T, M, options);\n    return MappedResult(P);\n}\n", "import { Intrinsic } from './intrinsic.mjs';\n/** `[Json]` Intrinsic function to Lowercase LiteralString types */\nexport function Lowercase(T, options = {}) {\n    return Intrinsic(T, 'Lowercase', options);\n}\n", "import { Intrinsic } from './intrinsic.mjs';\n/** `[Json]` Intrinsic function to Uncapitalize LiteralString types */\nexport function Uncapitalize(T, options = {}) {\n    return Intrinsic(T, 'Uncapitalize', options);\n}\n", "import { Intrinsic } from './intrinsic.mjs';\n/** `[Json]` Intrinsic function to Uppercase LiteralString types */\nexport function Uppercase(T, options = {}) {\n    return Intrinsic(T, 'Uppercase', options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[Json]` Creates a Not type */\nexport function Not(not, options) {\n    return CreateType({ [Kind]: 'Not', not }, options);\n}\n", "import { MappedResult } from '../mapped/index.mjs';\nimport { Omit } from './omit.mjs';\nimport { Clone } from '../clone/value.mjs';\n// prettier-ignore\nfunction FromPropertyKey(T, K, options) {\n    return {\n        [K]: Omit(T, [K], Clone(options))\n    };\n}\n// prettier-ignore\nfunction FromPropertyKeys(T, K, options) {\n    return K.reduce((Acc, LK) => {\n        return { ...Acc, ...FromPropertyKey(T, LK, options) };\n    }, {});\n}\n// prettier-ignore\nfunction FromMappedKey(T, K, options) {\n    return FromPropertyKeys(T, K.keys, options);\n}\n// prettier-ignore\nexport function OmitFromMappedKey(T, K, options) {\n    const P = FromMappedKey(T, K, options);\n    return MappedResult(P);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Discard } from '../discard/discard.mjs';\nimport { Intersect } from '../intersect/index.mjs';\nimport { Union } from '../union/index.mjs';\nimport { Object } from '../object/index.mjs';\nimport { IndexPropertyKeys } from '../indexed/index.mjs';\nimport { OmitFromMappedKey } from './omit-from-mapped-key.mjs';\nimport { OmitFromMappedResult } from './omit-from-mapped-result.mjs';\nimport { TransformKind } from '../symbols/symbols.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsMappedKey, IsIntersect, IsUnion, IsObject, IsSchema, IsMappedResult } from '../guard/kind.mjs';\n// prettier-ignore\nfunction FromIntersect(T, K) {\n    return T.map((T) => OmitResolve(T, K));\n}\n// prettier-ignore\nfunction FromUnion(T, K) {\n    return T.map((T) => OmitResolve(T, K));\n}\n// ------------------------------------------------------------------\n// FromProperty\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction FromProperty(T, K) {\n    const { [K]: _, ...R } = T;\n    return R;\n}\n// prettier-ignore\nfunction FromProperties(T, K) {\n    return K.reduce((T, K2) => FromProperty(T, K2), T);\n}\n// prettier-ignore\nfunction FromObject(T, K) {\n    const options = Discard(T, [TransformKind, '$id', 'required', 'properties']);\n    const properties = FromProperties(T['properties'], K);\n    return Object(properties, options);\n}\n// ------------------------------------------------------------------\n// OmitResolve\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction OmitResolve(T, K) {\n    return (IsIntersect(T) ? Intersect(FromIntersect(T.allOf, K)) :\n        IsUnion(T) ? Union(FromUnion(T.anyOf, K)) :\n            IsObject(T) ? FromObject(T, K) :\n                Object({}));\n}\nexport function Omit(T, K, options) {\n    // mapped\n    if (IsMappedKey(K))\n        return OmitFromMappedKey(T, K, options);\n    if (IsMappedResult(T))\n        return OmitFromMappedResult(T, K, options);\n    // non-mapped\n    const I = IsSchema(K) ? IndexPropertyKeys(K) : K;\n    // special: mapping types require overridable options\n    return CreateType({ ...OmitResolve(T, I), ...options });\n}\n", "import { MappedResult } from '../mapped/index.mjs';\nimport { Omit } from './omit.mjs';\nimport { Clone } from '../clone/value.mjs';\n// prettier-ignore\nfunction FromProperties(P, K, options) {\n    const Acc = {};\n    for (const K2 of globalThis.Object.getOwnPropertyNames(P))\n        Acc[K2] = Omit(P[K2], K, Clone(options));\n    return Acc;\n}\n// prettier-ignore\nfunction FromMappedResult(R, K, options) {\n    return FromProperties(R.properties, K, options);\n}\n// prettier-ignore\nexport function OmitFromMappedResult(R, K, options) {\n    const P = FromMappedResult(R, K, options);\n    return MappedResult(P);\n}\n", "import { Tuple } from '../tuple/index.mjs';\n/** `[JavaScript]` Extracts the Parameters from the given Function type */\nexport function Parameters(schema, options) {\n    return Tuple(schema.parameters, options);\n}\n", "import { MappedResult } from '../mapped/index.mjs';\nimport { Partial } from './partial.mjs';\nimport { Clone } from '../clone/value.mjs';\n// prettier-ignore\nfunction FromProperties(K, options) {\n    const Acc = {};\n    for (const K2 of globalThis.Object.getOwnPropertyNames(K))\n        Acc[K2] = Partial(K[K2], Clone(options));\n    return Acc;\n}\n// prettier-ignore\nfunction FromMappedResult(R, options) {\n    return FromProperties(R.properties, options);\n}\n// prettier-ignore\nexport function PartialFromMappedResult(R, options) {\n    const P = FromMappedResult(R, options);\n    return MappedResult(P);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Optional } from '../optional/index.mjs';\nimport { Object } from '../object/index.mjs';\nimport { Intersect } from '../intersect/index.mjs';\nimport { Union } from '../union/index.mjs';\nimport { Discard } from '../discard/index.mjs';\nimport { TransformKind } from '../symbols/index.mjs';\nimport { PartialFromMappedResult } from './partial-from-mapped-result.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsMappedResult, IsIntersect, IsUnion, IsObject } from '../guard/kind.mjs';\n// prettier-ignore\nfunction FromRest(T) {\n    return T.map(L => PartialResolve(L));\n}\n// prettier-ignore\nfunction FromProperties(T) {\n    const Acc = {};\n    for (const K of globalThis.Object.getOwnPropertyNames(T))\n        Acc[K] = Optional(T[K]);\n    return Acc;\n}\n// prettier-ignore\nfunction FromObject(T) {\n    const options = Discard(T, [TransformKind, '$id', 'required', 'properties']);\n    const properties = FromProperties(T['properties']);\n    return Object(properties, options);\n}\n// ------------------------------------------------------------------\n// PartialResolve\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction PartialResolve(T) {\n    return (IsIntersect(T) ? Intersect(FromRest(T.allOf)) :\n        IsUnion(T) ? Union(FromRest(T.anyOf)) :\n            IsObject(T) ? FromObject(T) :\n                Object({}));\n}\n/** `[Json]` Constructs a type where all properties are optional */\nexport function Partial(T, options) {\n    if (IsMappedResult(T)) {\n        return PartialFromMappedResult(T, options);\n    }\n    else {\n        // special: mapping types require overridable options\n        return CreateType({ ...PartialResolve(T), ...options });\n    }\n}\n", "import { MappedResult } from '../mapped/index.mjs';\nimport { Pick } from './pick.mjs';\nimport { Clone } from '../clone/value.mjs';\n// prettier-ignore\nfunction FromPropertyKey(T, K, options) {\n    return {\n        [K]: Pick(T, [K], Clone(options))\n    };\n}\n// prettier-ignore\nfunction FromPropertyKeys(T, K, options) {\n    return K.reduce((Acc, LK) => {\n        return { ...Acc, ...FromPropertyKey(T, LK, options) };\n    }, {});\n}\n// prettier-ignore\nfunction FromMappedKey(T, K, options) {\n    return FromPropertyKeys(T, K.keys, options);\n}\n// prettier-ignore\nexport function PickFromMappedKey(T, K, options) {\n    const P = FromMappedKey(T, K, options);\n    return MappedResult(P);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Discard } from '../discard/discard.mjs';\nimport { Intersect } from '../intersect/index.mjs';\nimport { Union } from '../union/index.mjs';\nimport { Object } from '../object/index.mjs';\nimport { IndexPropertyKeys } from '../indexed/index.mjs';\nimport { PickFromMappedKey } from './pick-from-mapped-key.mjs';\nimport { PickFromMappedResult } from './pick-from-mapped-result.mjs';\nimport { TransformKind } from '../symbols/symbols.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsMappedKey, IsMappedResult, IsIntersect, IsUnion, IsObject, IsSchema } from '../guard/kind.mjs';\nfunction FromIntersect(T, K) {\n    return T.map((T) => PickResolve(T, K));\n}\n// prettier-ignore\nfunction FromUnion(T, K) {\n    return T.map((T) => PickResolve(T, K));\n}\n// prettier-ignore\nfunction FromProperties(T, K) {\n    const Acc = {};\n    for (const K2 of K)\n        if (K2 in T)\n            Acc[K2] = T[K2];\n    return Acc;\n}\n// prettier-ignore\nfunction FromObject(T, K) {\n    const options = Discard(T, [TransformKind, '$id', 'required', 'properties']);\n    const properties = FromProperties(T['properties'], K);\n    return Object(properties, options);\n}\n// ------------------------------------------------------------------\n// PickResolve\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction PickResolve(T, K) {\n    return (IsIntersect(T) ? Intersect(FromIntersect(T.allOf, K)) :\n        IsUnion(T) ? Union(FromUnion(T.anyOf, K)) :\n            IsObject(T) ? FromObject(T, K) :\n                Object({}));\n}\nexport function Pick(T, K, options) {\n    // mapped\n    if (IsMappedKey(K))\n        return PickFromMappedKey(T, K, options);\n    if (IsMappedResult(T))\n        return PickFromMappedResult(T, K, options);\n    // non-mapped\n    const I = IsSchema(K) ? IndexPropertyKeys(K) : K;\n    // special: mapping types require overridable options\n    return CreateType({ ...PickResolve(T, I), ...options });\n}\n", "import { MappedResult } from '../mapped/index.mjs';\nimport { Pick } from './pick.mjs';\nimport { Clone } from '../clone/value.mjs';\n// prettier-ignore\nfunction FromProperties(P, K, options) {\n    const Acc = {};\n    for (const K2 of globalThis.Object.getOwnPropertyNames(P))\n        Acc[K2] = Pick(P[K2], K, Clone(options));\n    return Acc;\n}\n// prettier-ignore\nfunction FromMappedResult(R, K, options) {\n    return FromProperties(R.properties, K, options);\n}\n// prettier-ignore\nexport function PickFromMappedResult(R, K, options) {\n    const P = FromMappedResult(R, K, options);\n    return MappedResult(P);\n}\n", "import { Readonly } from '../readonly/index.mjs';\nimport { Optional } from '../optional/index.mjs';\n/** `[Json]` Creates a Readonly and Optional property */\nexport function ReadonlyOptional(schema) {\n    return Readonly(Optional(schema));\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Object } from '../object/index.mjs';\nimport { Never } from '../never/index.mjs';\nimport { Union } from '../union/index.mjs';\nimport { IsTemplateLiteralFinite } from '../template-literal/index.mjs';\nimport { PatternStringExact, PatternNumberExact, PatternNeverExact } from '../patterns/index.mjs';\nimport { IndexPropertyKeys } from '../indexed/index.mjs';\nimport { Kind, Hint } from '../symbols/index.mjs';\n// ------------------------------------------------------------------\n// ValueGuard\n// ------------------------------------------------------------------\nimport { IsUndefined } from '../guard/value.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsInteger, IsLiteral, IsAny, IsNever, IsNumber, IsString, IsRegExp, IsTemplateLiteral, IsUnion } from '../guard/kind.mjs';\n// ------------------------------------------------------------------\n// RecordCreateFromPattern\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction RecordCreateFromPattern(pattern, T, options) {\n    return CreateType({\n        [Kind]: 'Record',\n        type: 'object',\n        patternProperties: { [pattern]: T }\n    }, options);\n}\n// ------------------------------------------------------------------\n// RecordCreateFromKeys\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction RecordCreateFromKeys(K, T, options) {\n    const Acc = {};\n    for (const K2 of K)\n        Acc[K2] = T;\n    return Object(Acc, { ...options, [Hint]: 'Record' });\n}\n// prettier-ignore\nfunction FromTemplateLiteralKey(K, T, options) {\n    return (IsTemplateLiteralFinite(K)\n        ? RecordCreateFromKeys(IndexPropertyKeys(K), T, options)\n        : RecordCreateFromPattern(K.pattern, T, options));\n}\n// prettier-ignore\nfunction FromUnionKey(K, T, options) {\n    return RecordCreateFromKeys(IndexPropertyKeys(Union(K)), T, options);\n}\n// prettier-ignore\nfunction FromLiteralKey(K, T, options) {\n    return RecordCreateFromKeys([K.toString()], T, options);\n}\n// prettier-ignore\nfunction FromRegExpKey(K, T, options) {\n    return RecordCreateFromPattern(K.source, T, options);\n}\n// prettier-ignore\nfunction FromStringKey(K, T, options) {\n    const pattern = IsUndefined(K.pattern) ? PatternStringExact : K.pattern;\n    return RecordCreateFromPattern(pattern, T, options);\n}\n// prettier-ignore\nfunction FromAnyKey(K, T, options) {\n    return RecordCreateFromPattern(PatternStringExact, T, options);\n}\n// prettier-ignore\nfunction FromNeverKey(K, T, options) {\n    return RecordCreateFromPattern(PatternNeverExact, T, options);\n}\n// prettier-ignore\nfunction FromIntegerKey(_, T, options) {\n    return RecordCreateFromPattern(PatternNumberExact, T, options);\n}\n// prettier-ignore\nfunction FromNumberKey(_, T, options) {\n    return RecordCreateFromPattern(PatternNumberExact, T, options);\n}\n// ------------------------------------------------------------------\n// TRecordOrObject\n// ------------------------------------------------------------------\n/** `[Json]` Creates a Record type */\nexport function Record(K, T, options = {}) {\n    // prettier-ignore\n    return (IsUnion(K) ? FromUnionKey(K.anyOf, T, options) :\n        IsTemplateLiteral(K) ? FromTemplateLiteralKey(K, T, options) :\n            IsLiteral(K) ? FromLiteralKey(K.const, T, options) :\n                IsInteger(K) ? FromIntegerKey(K, T, options) :\n                    IsNumber(K) ? FromNumberKey(K, T, options) :\n                        IsRegExp(K) ? FromRegExpKey(K, T, options) :\n                            IsString(K) ? FromStringKey(K, T, options) :\n                                IsAny(K) ? FromAnyKey(K, T, options) :\n                                    IsNever(K) ? FromNeverKey(K, T, options) :\n                                        Never(options));\n}\n", "import { CloneType } from '../clone/type.mjs';\nimport { CreateType } from '../create/type.mjs';\nimport { IsUndefined } from '../guard/value.mjs';\nimport { Kind, Hint } from '../symbols/index.mjs';\n// Auto Tracked For Recursive Types without ID's\nlet Ordinal = 0;\n/** `[Json]` Creates a Recursive type */\nexport function Recursive(callback, options = {}) {\n    if (IsUndefined(options.$id))\n        options.$id = `T${Ordinal++}`;\n    const thisType = CloneType(callback({ [Kind]: 'This', $ref: `${options.$id}` }));\n    thisType.$id = options.$id;\n    // prettier-ignore\n    return CreateType({ [Hint]: 'Recursive', ...thisType }, options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n// ------------------------------------------------------------------\n// ValueGuard\n// ------------------------------------------------------------------\nimport { IsString, IsUndefined } from '../guard/value.mjs';\n/** `[Json]` Creates a Ref type. */\nexport function Ref(unresolved, options) {\n    if (IsString(unresolved))\n        return CreateType({ [Kind]: 'Ref', $ref: unresolved }, options);\n    if (IsUndefined(unresolved.$id))\n        throw new Error('Reference target type must specify an $id');\n    return CreateType({ [Kind]: 'Ref', $ref: unresolved.$id }, options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { IsString } from '../guard/value.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[JavaScript]` Creates a RegExp type */\nexport function RegExp(unresolved, options) {\n    const expr = IsString(unresolved) ? new globalThis.RegExp(unresolved) : unresolved;\n    return CreateType({ [Kind]: 'RegExp', type: 'RegExp', source: expr.source, flags: expr.flags }, options);\n}\n", "import { MappedResult } from '../mapped/index.mjs';\nimport { Required } from './required.mjs';\n// prettier-ignore\nfunction FromProperties(P, options) {\n    const Acc = {};\n    for (const K2 of globalThis.Object.getOwnPropertyNames(P))\n        Acc[K2] = Required(P[K2], options);\n    return Acc;\n}\n// prettier-ignore\nfunction FromMappedResult(R, options) {\n    return FromProperties(R.properties, options);\n}\n// prettier-ignore\nexport function RequiredFromMappedResult(R, options) {\n    const P = FromMappedResult(R, options);\n    return MappedResult(P);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Intersect } from '../intersect/index.mjs';\nimport { Union } from '../union/index.mjs';\nimport { Object } from '../object/index.mjs';\nimport { OptionalKind, TransformKind } from '../symbols/index.mjs';\nimport { Discard } from '../discard/index.mjs';\nimport { RequiredFromMappedResult } from './required-from-mapped-result.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsMappedResult, IsIntersect, IsUnion, IsObject } from '../guard/kind.mjs';\n// prettier-ignore\nfunction FromRest(T) {\n    return T.map(L => RequiredResolve(L));\n}\n// prettier-ignore\nfunction FromProperties(T) {\n    const Acc = {};\n    for (const K of globalThis.Object.getOwnPropertyNames(T))\n        Acc[K] = Discard(T[K], [OptionalKind]);\n    return Acc;\n}\n// prettier-ignore\nfunction FromObject(T) {\n    const options = Discard(T, [TransformKind, '$id', 'required', 'properties']);\n    const properties = FromProperties(T['properties']);\n    return Object(properties, options);\n}\n// ------------------------------------------------------------------\n// RequiredResolve\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction RequiredResolve(T) {\n    return (IsIntersect(T) ? Intersect(FromRest(T.allOf)) :\n        IsUnion(T) ? Union(FromRest(T.anyOf)) :\n            IsObject(T) ? FromObject(T) :\n                Object({}));\n}\n/** `[Json]` Constructs a type where all properties are required */\nexport function Required(T, options) {\n    if (IsMappedResult(T)) {\n        return RequiredFromMappedResult(T, options);\n    }\n    else {\n        // special: mapping types require overridable options\n        return CreateType({ ...RequiredResolve(T), ...options });\n    }\n}\n", "// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsIntersect, IsUnion, IsTuple } from '../guard/kind.mjs';\n// prettier-ignore\nfunction RestResolve(T) {\n    return (IsIntersect(T) ? T.allOf :\n        IsUnion(T) ? T.anyOf :\n            IsTuple(T) ? T.items ?? [] :\n                []);\n}\n/** `[Json]` Extracts interior Rest elements from Tuple, Intersect and Union types */\nexport function Rest(T) {\n    return RestResolve(T);\n}\n", "import { CreateType } from '../create/type.mjs';\n/** `[JavaScript]` Extracts the ReturnType from the given Function type */\nexport function ReturnType(schema, options) {\n    return CreateType(schema.returns, options);\n}\n", "/**\n * @deprecated `[Json]` Omits compositing symbols from this schema. It is recommended\n * to use the JSON parse/stringify to remove compositing symbols if needed. This\n * is how Strict works internally.\n *\n * ```typescript\n * JSON.parse(JSON.stringify(Type.String()))\n * ```\n */\nexport function Strict(schema) {\n    return JSON.parse(JSON.stringify(schema));\n}\n", "import { TransformKind } from '../symbols/index.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsTransform } from '../guard/kind.mjs';\n// ------------------------------------------------------------------\n// TransformBuilders\n// ------------------------------------------------------------------\nexport class TransformDecodeBuilder {\n    constructor(schema) {\n        this.schema = schema;\n    }\n    Decode(decode) {\n        return new TransformEncodeBuilder(this.schema, decode);\n    }\n}\n// prettier-ignore\nexport class TransformEncodeBuilder {\n    constructor(schema, decode) {\n        this.schema = schema;\n        this.decode = decode;\n    }\n    EncodeTransform(encode, schema) {\n        const Encode = (value) => schema[TransformKind].Encode(encode(value));\n        const Decode = (value) => this.decode(schema[TransformKind].Decode(value));\n        const Codec = { Encode: Encode, Decode: Decode };\n        return { ...schema, [TransformKind]: Codec };\n    }\n    EncodeSchema(encode, schema) {\n        const Codec = { Decode: this.decode, Encode: encode };\n        return { ...schema, [TransformKind]: Codec };\n    }\n    Encode(encode) {\n        return (IsTransform(this.schema) ? this.EncodeTransform(encode, this.schema) : this.EncodeSchema(encode, this.schema));\n    }\n}\n/** `[Json]` Creates a Transform type */\nexport function Transform(schema) {\n    return new TransformDecodeBuilder(schema);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[Json]` Creates a Unsafe type that will infers as the generic argument T */\nexport function Unsafe(options = {}) {\n    return CreateType({ [Kind]: options[Kind] ?? 'Unsafe' }, options);\n}\n", "import { CreateType } from '../create/type.mjs';\nimport { Kind } from '../symbols/index.mjs';\n/** `[JavaScript]` Creates a Void type */\nexport function Void(options) {\n    return CreateType({ [Kind]: 'Void', type: 'void' }, options);\n}\n", "// ------------------------------------------------------------------\n// JsonTypeBuilder\n// ------------------------------------------------------------------\nexport { JsonTypeBuilder } from './json.mjs';\n// ------------------------------------------------------------------\n// JavaScriptTypeBuilder\n// ------------------------------------------------------------------\nimport * as TypeBuilder from './type.mjs';\nimport { JavaScriptTypeBuilder } from './javascript.mjs';\n/** JavaScript Type Builder with Static Resolution for TypeScript */\nconst Type = TypeBuilder;\nexport { JavaScriptTypeBuilder };\nexport { Type };\n", "// ------------------------------------------------------------------\n// Type: Module\n// ------------------------------------------------------------------\nexport { Any } from '../any/index.mjs';\nexport { Array } from '../array/index.mjs';\nexport { AsyncIterator } from '../async-iterator/index.mjs';\nexport { Awaited } from '../awaited/index.mjs';\nexport { BigInt } from '../bigint/index.mjs';\nexport { Boolean } from '../boolean/index.mjs';\nexport { Composite } from '../composite/index.mjs';\nexport { Const } from '../const/index.mjs';\nexport { Constructor } from '../constructor/index.mjs';\nexport { ConstructorParameters } from '../constructor-parameters/index.mjs';\nexport { Date } from '../date/index.mjs';\nexport { Deref } from '../deref/index.mjs';\nexport { Enum } from '../enum/index.mjs';\nexport { Exclude } from '../exclude/index.mjs';\nexport { Extends } from '../extends/index.mjs';\nexport { Extract } from '../extract/index.mjs';\nexport { Function } from '../function/index.mjs';\nexport { Index } from '../indexed/index.mjs';\nexport { InstanceType } from '../instance-type/index.mjs';\nexport { Integer } from '../integer/index.mjs';\nexport { Intersect } from '../intersect/index.mjs';\nexport { Capitalize, Uncapitalize, Lowercase, Uppercase } from '../intrinsic/index.mjs';\nexport { Iterator } from '../iterator/index.mjs';\nexport { KeyOf } from '../keyof/index.mjs';\nexport { Literal } from '../literal/index.mjs';\nexport { Mapped } from '../mapped/index.mjs';\nexport { Never } from '../never/index.mjs';\nexport { Not } from '../not/index.mjs';\nexport { Null } from '../null/index.mjs';\nexport { Number } from '../number/index.mjs';\nexport { Object } from '../object/index.mjs';\nexport { Omit } from '../omit/index.mjs';\nexport { Optional } from '../optional/index.mjs';\nexport { Parameters } from '../parameters/index.mjs';\nexport { Partial } from '../partial/index.mjs';\nexport { Pick } from '../pick/index.mjs';\nexport { Promise } from '../promise/index.mjs';\nexport { Readonly } from '../readonly/index.mjs';\nexport { ReadonlyOptional } from '../readonly-optional/index.mjs';\nexport { Record } from '../record/index.mjs';\nexport { Recursive } from '../recursive/index.mjs';\nexport { Ref } from '../ref/index.mjs';\nexport { RegExp } from '../regexp/index.mjs';\nexport { Required } from '../required/index.mjs';\nexport { Rest } from '../rest/index.mjs';\nexport { ReturnType } from '../return-type/index.mjs';\nexport { String } from '../string/index.mjs';\nexport { Strict } from '../strict/index.mjs';\nexport { Symbol } from '../symbol/index.mjs';\nexport { TemplateLiteral } from '../template-literal/index.mjs';\nexport { Transform } from '../transform/index.mjs';\nexport { Tuple } from '../tuple/index.mjs';\nexport { Uint8Array } from '../uint8array/index.mjs';\nexport { Undefined } from '../undefined/index.mjs';\nexport { Union } from '../union/index.mjs';\nexport { Unknown } from '../unknown/index.mjs';\nexport { Unsafe } from '../unsafe/index.mjs';\nexport { Void } from '../void/index.mjs';\n", null, null, null, null, null, null, null, null, null, "import { TypeSystemPolicy } from '../system/index.mjs';\nimport { KeyOfPattern } from '../type/keyof/index.mjs';\nimport { TypeRegistry, FormatRegistry } from '../type/registry/index.mjs';\nimport { ExtendsUndefinedCheck } from '../type/extends/extends-undefined.mjs';\nimport { GetErrorFunction } from './function.mjs';\nimport { TypeBoxError } from '../type/error/index.mjs';\nimport { Deref } from '../value/deref/index.mjs';\nimport { Hash } from '../value/hash/index.mjs';\nimport { Check } from '../value/check/index.mjs';\nimport { Kind } from '../type/symbols/index.mjs';\nimport { Never } from '../type/never/index.mjs';\n// ------------------------------------------------------------------\n// ValueGuard\n// ------------------------------------------------------------------\n// prettier-ignore\nimport { IsArray, IsUint8Array, IsDate, IsPromise, IsFunction, IsAsyncIterator, IsIterator, IsBoolean, IsNumber, IsBigInt, IsString, IsSymbol, IsInteger, IsNull, IsUndefined } from '../value/guard/index.mjs';\n// ------------------------------------------------------------------\n// ValueErrorType\n// ------------------------------------------------------------------\nexport var ValueErrorType;\n(function (ValueErrorType) {\n    ValueErrorType[ValueErrorType[\"ArrayContains\"] = 0] = \"ArrayContains\";\n    ValueErrorType[ValueErrorType[\"ArrayMaxContains\"] = 1] = \"ArrayMaxContains\";\n    ValueErrorType[ValueErrorType[\"ArrayMaxItems\"] = 2] = \"ArrayMaxItems\";\n    ValueErrorType[ValueErrorType[\"ArrayMinContains\"] = 3] = \"ArrayMinContains\";\n    ValueErrorType[ValueErrorType[\"ArrayMinItems\"] = 4] = \"ArrayMinItems\";\n    ValueErrorType[ValueErrorType[\"ArrayUniqueItems\"] = 5] = \"ArrayUniqueItems\";\n    ValueErrorType[ValueErrorType[\"Array\"] = 6] = \"Array\";\n    ValueErrorType[ValueErrorType[\"AsyncIterator\"] = 7] = \"AsyncIterator\";\n    ValueErrorType[ValueErrorType[\"BigIntExclusiveMaximum\"] = 8] = \"BigIntExclusiveMaximum\";\n    ValueErrorType[ValueErrorType[\"BigIntExclusiveMinimum\"] = 9] = \"BigIntExclusiveMinimum\";\n    ValueErrorType[ValueErrorType[\"BigIntMaximum\"] = 10] = \"BigIntMaximum\";\n    ValueErrorType[ValueErrorType[\"BigIntMinimum\"] = 11] = \"BigIntMinimum\";\n    ValueErrorType[ValueErrorType[\"BigIntMultipleOf\"] = 12] = \"BigIntMultipleOf\";\n    ValueErrorType[ValueErrorType[\"BigInt\"] = 13] = \"BigInt\";\n    ValueErrorType[ValueErrorType[\"Boolean\"] = 14] = \"Boolean\";\n    ValueErrorType[ValueErrorType[\"DateExclusiveMaximumTimestamp\"] = 15] = \"DateExclusiveMaximumTimestamp\";\n    ValueErrorType[ValueErrorType[\"DateExclusiveMinimumTimestamp\"] = 16] = \"DateExclusiveMinimumTimestamp\";\n    ValueErrorType[ValueErrorType[\"DateMaximumTimestamp\"] = 17] = \"DateMaximumTimestamp\";\n    ValueErrorType[ValueErrorType[\"DateMinimumTimestamp\"] = 18] = \"DateMinimumTimestamp\";\n    ValueErrorType[ValueErrorType[\"DateMultipleOfTimestamp\"] = 19] = \"DateMultipleOfTimestamp\";\n    ValueErrorType[ValueErrorType[\"Date\"] = 20] = \"Date\";\n    ValueErrorType[ValueErrorType[\"Function\"] = 21] = \"Function\";\n    ValueErrorType[ValueErrorType[\"IntegerExclusiveMaximum\"] = 22] = \"IntegerExclusiveMaximum\";\n    ValueErrorType[ValueErrorType[\"IntegerExclusiveMinimum\"] = 23] = \"IntegerExclusiveMinimum\";\n    ValueErrorType[ValueErrorType[\"IntegerMaximum\"] = 24] = \"IntegerMaximum\";\n    ValueErrorType[ValueErrorType[\"IntegerMinimum\"] = 25] = \"IntegerMinimum\";\n    ValueErrorType[ValueErrorType[\"IntegerMultipleOf\"] = 26] = \"IntegerMultipleOf\";\n    ValueErrorType[ValueErrorType[\"Integer\"] = 27] = \"Integer\";\n    ValueErrorType[ValueErrorType[\"IntersectUnevaluatedProperties\"] = 28] = \"IntersectUnevaluatedProperties\";\n    ValueErrorType[ValueErrorType[\"Intersect\"] = 29] = \"Intersect\";\n    ValueErrorType[ValueErrorType[\"Iterator\"] = 30] = \"Iterator\";\n    ValueErrorType[ValueErrorType[\"Kind\"] = 31] = \"Kind\";\n    ValueErrorType[ValueErrorType[\"Literal\"] = 32] = \"Literal\";\n    ValueErrorType[ValueErrorType[\"Never\"] = 33] = \"Never\";\n    ValueErrorType[ValueErrorType[\"Not\"] = 34] = \"Not\";\n    ValueErrorType[ValueErrorType[\"Null\"] = 35] = \"Null\";\n    ValueErrorType[ValueErrorType[\"NumberExclusiveMaximum\"] = 36] = \"NumberExclusiveMaximum\";\n    ValueErrorType[ValueErrorType[\"NumberExclusiveMinimum\"] = 37] = \"NumberExclusiveMinimum\";\n    ValueErrorType[ValueErrorType[\"NumberMaximum\"] = 38] = \"NumberMaximum\";\n    ValueErrorType[ValueErrorType[\"NumberMinimum\"] = 39] = \"NumberMinimum\";\n    ValueErrorType[ValueErrorType[\"NumberMultipleOf\"] = 40] = \"NumberMultipleOf\";\n    ValueErrorType[ValueErrorType[\"Number\"] = 41] = \"Number\";\n    ValueErrorType[ValueErrorType[\"ObjectAdditionalProperties\"] = 42] = \"ObjectAdditionalProperties\";\n    ValueErrorType[ValueErrorType[\"ObjectMaxProperties\"] = 43] = \"ObjectMaxProperties\";\n    ValueErrorType[ValueErrorType[\"ObjectMinProperties\"] = 44] = \"ObjectMinProperties\";\n    ValueErrorType[ValueErrorType[\"ObjectRequiredProperty\"] = 45] = \"ObjectRequiredProperty\";\n    ValueErrorType[ValueErrorType[\"Object\"] = 46] = \"Object\";\n    ValueErrorType[ValueErrorType[\"Promise\"] = 47] = \"Promise\";\n    ValueErrorType[ValueErrorType[\"RegExp\"] = 48] = \"RegExp\";\n    ValueErrorType[ValueErrorType[\"StringFormatUnknown\"] = 49] = \"StringFormatUnknown\";\n    ValueErrorType[ValueErrorType[\"StringFormat\"] = 50] = \"StringFormat\";\n    ValueErrorType[ValueErrorType[\"StringMaxLength\"] = 51] = \"StringMaxLength\";\n    ValueErrorType[ValueErrorType[\"StringMinLength\"] = 52] = \"StringMinLength\";\n    ValueErrorType[ValueErrorType[\"StringPattern\"] = 53] = \"StringPattern\";\n    ValueErrorType[ValueErrorType[\"String\"] = 54] = \"String\";\n    ValueErrorType[ValueErrorType[\"Symbol\"] = 55] = \"Symbol\";\n    ValueErrorType[ValueErrorType[\"TupleLength\"] = 56] = \"TupleLength\";\n    ValueErrorType[ValueErrorType[\"Tuple\"] = 57] = \"Tuple\";\n    ValueErrorType[ValueErrorType[\"Uint8ArrayMaxByteLength\"] = 58] = \"Uint8ArrayMaxByteLength\";\n    ValueErrorType[ValueErrorType[\"Uint8ArrayMinByteLength\"] = 59] = \"Uint8ArrayMinByteLength\";\n    ValueErrorType[ValueErrorType[\"Uint8Array\"] = 60] = \"Uint8Array\";\n    ValueErrorType[ValueErrorType[\"Undefined\"] = 61] = \"Undefined\";\n    ValueErrorType[ValueErrorType[\"Union\"] = 62] = \"Union\";\n    ValueErrorType[ValueErrorType[\"Void\"] = 63] = \"Void\";\n})(ValueErrorType || (ValueErrorType = {}));\n// ------------------------------------------------------------------\n// ValueErrors\n// ------------------------------------------------------------------\nexport class ValueErrorsUnknownTypeError extends TypeBoxError {\n    constructor(schema) {\n        super('Unknown type');\n        this.schema = schema;\n    }\n}\n// ------------------------------------------------------------------\n// EscapeKey\n// ------------------------------------------------------------------\nfunction EscapeKey(key) {\n    return key.replace(/~/g, '~0').replace(/\\//g, '~1'); // RFC6901 Path\n}\n// ------------------------------------------------------------------\n// Guards\n// ------------------------------------------------------------------\nfunction IsDefined(value) {\n    return value !== undefined;\n}\n// ------------------------------------------------------------------\n// ValueErrorIterator\n// ------------------------------------------------------------------\nexport class ValueErrorIterator {\n    constructor(iterator) {\n        this.iterator = iterator;\n    }\n    [Symbol.iterator]() {\n        return this.iterator;\n    }\n    /** Returns the first value error or undefined if no errors */\n    First() {\n        const next = this.iterator.next();\n        return next.done ? undefined : next.value;\n    }\n}\n// --------------------------------------------------------------------------\n// Create\n// --------------------------------------------------------------------------\nfunction Create(errorType, schema, path, value, errors = []) {\n    return {\n        type: errorType,\n        schema,\n        path,\n        value,\n        message: GetErrorFunction()({ errorType, path, schema, value, errors }),\n        errors,\n    };\n}\n// --------------------------------------------------------------------------\n// Types\n// --------------------------------------------------------------------------\nfunction* FromAny(schema, references, path, value) { }\nfunction* FromArray(schema, references, path, value) {\n    if (!IsArray(value)) {\n        return yield Create(ValueErrorType.Array, schema, path, value);\n    }\n    if (IsDefined(schema.minItems) && !(value.length >= schema.minItems)) {\n        yield Create(ValueErrorType.ArrayMinItems, schema, path, value);\n    }\n    if (IsDefined(schema.maxItems) && !(value.length <= schema.maxItems)) {\n        yield Create(ValueErrorType.ArrayMaxItems, schema, path, value);\n    }\n    for (let i = 0; i < value.length; i++) {\n        yield* Visit(schema.items, references, `${path}/${i}`, value[i]);\n    }\n    // prettier-ignore\n    if (schema.uniqueItems === true && !((function () { const set = new Set(); for (const element of value) {\n        const hashed = Hash(element);\n        if (set.has(hashed)) {\n            return false;\n        }\n        else {\n            set.add(hashed);\n        }\n    } return true; })())) {\n        yield Create(ValueErrorType.ArrayUniqueItems, schema, path, value);\n    }\n    // contains\n    if (!(IsDefined(schema.contains) || IsDefined(schema.minContains) || IsDefined(schema.maxContains))) {\n        return;\n    }\n    const containsSchema = IsDefined(schema.contains) ? schema.contains : Never();\n    const containsCount = value.reduce((acc, value, index) => (Visit(containsSchema, references, `${path}${index}`, value).next().done === true ? acc + 1 : acc), 0);\n    if (containsCount === 0) {\n        yield Create(ValueErrorType.ArrayContains, schema, path, value);\n    }\n    if (IsNumber(schema.minContains) && containsCount < schema.minContains) {\n        yield Create(ValueErrorType.ArrayMinContains, schema, path, value);\n    }\n    if (IsNumber(schema.maxContains) && containsCount > schema.maxContains) {\n        yield Create(ValueErrorType.ArrayMaxContains, schema, path, value);\n    }\n}\nfunction* FromAsyncIterator(schema, references, path, value) {\n    if (!IsAsyncIterator(value))\n        yield Create(ValueErrorType.AsyncIterator, schema, path, value);\n}\nfunction* FromBigInt(schema, references, path, value) {\n    if (!IsBigInt(value))\n        return yield Create(ValueErrorType.BigInt, schema, path, value);\n    if (IsDefined(schema.exclusiveMaximum) && !(value < schema.exclusiveMaximum)) {\n        yield Create(ValueErrorType.BigIntExclusiveMaximum, schema, path, value);\n    }\n    if (IsDefined(schema.exclusiveMinimum) && !(value > schema.exclusiveMinimum)) {\n        yield Create(ValueErrorType.BigIntExclusiveMinimum, schema, path, value);\n    }\n    if (IsDefined(schema.maximum) && !(value <= schema.maximum)) {\n        yield Create(ValueErrorType.BigIntMaximum, schema, path, value);\n    }\n    if (IsDefined(schema.minimum) && !(value >= schema.minimum)) {\n        yield Create(ValueErrorType.BigIntMinimum, schema, path, value);\n    }\n    if (IsDefined(schema.multipleOf) && !(value % schema.multipleOf === BigInt(0))) {\n        yield Create(ValueErrorType.BigIntMultipleOf, schema, path, value);\n    }\n}\nfunction* FromBoolean(schema, references, path, value) {\n    if (!IsBoolean(value))\n        yield Create(ValueErrorType.Boolean, schema, path, value);\n}\nfunction* FromConstructor(schema, references, path, value) {\n    yield* Visit(schema.returns, references, path, value.prototype);\n}\nfunction* FromDate(schema, references, path, value) {\n    if (!IsDate(value))\n        return yield Create(ValueErrorType.Date, schema, path, value);\n    if (IsDefined(schema.exclusiveMaximumTimestamp) && !(value.getTime() < schema.exclusiveMaximumTimestamp)) {\n        yield Create(ValueErrorType.DateExclusiveMaximumTimestamp, schema, path, value);\n    }\n    if (IsDefined(schema.exclusiveMinimumTimestamp) && !(value.getTime() > schema.exclusiveMinimumTimestamp)) {\n        yield Create(ValueErrorType.DateExclusiveMinimumTimestamp, schema, path, value);\n    }\n    if (IsDefined(schema.maximumTimestamp) && !(value.getTime() <= schema.maximumTimestamp)) {\n        yield Create(ValueErrorType.DateMaximumTimestamp, schema, path, value);\n    }\n    if (IsDefined(schema.minimumTimestamp) && !(value.getTime() >= schema.minimumTimestamp)) {\n        yield Create(ValueErrorType.DateMinimumTimestamp, schema, path, value);\n    }\n    if (IsDefined(schema.multipleOfTimestamp) && !(value.getTime() % schema.multipleOfTimestamp === 0)) {\n        yield Create(ValueErrorType.DateMultipleOfTimestamp, schema, path, value);\n    }\n}\nfunction* FromFunction(schema, references, path, value) {\n    if (!IsFunction(value))\n        yield Create(ValueErrorType.Function, schema, path, value);\n}\nfunction* FromInteger(schema, references, path, value) {\n    if (!IsInteger(value))\n        return yield Create(ValueErrorType.Integer, schema, path, value);\n    if (IsDefined(schema.exclusiveMaximum) && !(value < schema.exclusiveMaximum)) {\n        yield Create(ValueErrorType.IntegerExclusiveMaximum, schema, path, value);\n    }\n    if (IsDefined(schema.exclusiveMinimum) && !(value > schema.exclusiveMinimum)) {\n        yield Create(ValueErrorType.IntegerExclusiveMinimum, schema, path, value);\n    }\n    if (IsDefined(schema.maximum) && !(value <= schema.maximum)) {\n        yield Create(ValueErrorType.IntegerMaximum, schema, path, value);\n    }\n    if (IsDefined(schema.minimum) && !(value >= schema.minimum)) {\n        yield Create(ValueErrorType.IntegerMinimum, schema, path, value);\n    }\n    if (IsDefined(schema.multipleOf) && !(value % schema.multipleOf === 0)) {\n        yield Create(ValueErrorType.IntegerMultipleOf, schema, path, value);\n    }\n}\nfunction* FromIntersect(schema, references, path, value) {\n    let hasError = false;\n    for (const inner of schema.allOf) {\n        for (const error of Visit(inner, references, path, value)) {\n            hasError = true;\n            yield error;\n        }\n    }\n    if (hasError) {\n        return yield Create(ValueErrorType.Intersect, schema, path, value);\n    }\n    if (schema.unevaluatedProperties === false) {\n        const keyCheck = new RegExp(KeyOfPattern(schema));\n        for (const valueKey of Object.getOwnPropertyNames(value)) {\n            if (!keyCheck.test(valueKey)) {\n                yield Create(ValueErrorType.IntersectUnevaluatedProperties, schema, `${path}/${valueKey}`, value);\n            }\n        }\n    }\n    if (typeof schema.unevaluatedProperties === 'object') {\n        const keyCheck = new RegExp(KeyOfPattern(schema));\n        for (const valueKey of Object.getOwnPropertyNames(value)) {\n            if (!keyCheck.test(valueKey)) {\n                const next = Visit(schema.unevaluatedProperties, references, `${path}/${valueKey}`, value[valueKey]).next();\n                if (!next.done)\n                    yield next.value; // yield interior\n            }\n        }\n    }\n}\nfunction* FromIterator(schema, references, path, value) {\n    if (!IsIterator(value))\n        yield Create(ValueErrorType.Iterator, schema, path, value);\n}\nfunction* FromLiteral(schema, references, path, value) {\n    if (!(value === schema.const))\n        yield Create(ValueErrorType.Literal, schema, path, value);\n}\nfunction* FromNever(schema, references, path, value) {\n    yield Create(ValueErrorType.Never, schema, path, value);\n}\nfunction* FromNot(schema, references, path, value) {\n    if (Visit(schema.not, references, path, value).next().done === true)\n        yield Create(ValueErrorType.Not, schema, path, value);\n}\nfunction* FromNull(schema, references, path, value) {\n    if (!IsNull(value))\n        yield Create(ValueErrorType.Null, schema, path, value);\n}\nfunction* FromNumber(schema, references, path, value) {\n    if (!TypeSystemPolicy.IsNumberLike(value))\n        return yield Create(ValueErrorType.Number, schema, path, value);\n    if (IsDefined(schema.exclusiveMaximum) && !(value < schema.exclusiveMaximum)) {\n        yield Create(ValueErrorType.NumberExclusiveMaximum, schema, path, value);\n    }\n    if (IsDefined(schema.exclusiveMinimum) && !(value > schema.exclusiveMinimum)) {\n        yield Create(ValueErrorType.NumberExclusiveMinimum, schema, path, value);\n    }\n    if (IsDefined(schema.maximum) && !(value <= schema.maximum)) {\n        yield Create(ValueErrorType.NumberMaximum, schema, path, value);\n    }\n    if (IsDefined(schema.minimum) && !(value >= schema.minimum)) {\n        yield Create(ValueErrorType.NumberMinimum, schema, path, value);\n    }\n    if (IsDefined(schema.multipleOf) && !(value % schema.multipleOf === 0)) {\n        yield Create(ValueErrorType.NumberMultipleOf, schema, path, value);\n    }\n}\nfunction* FromObject(schema, references, path, value) {\n    if (!TypeSystemPolicy.IsObjectLike(value))\n        return yield Create(ValueErrorType.Object, schema, path, value);\n    if (IsDefined(schema.minProperties) && !(Object.getOwnPropertyNames(value).length >= schema.minProperties)) {\n        yield Create(ValueErrorType.ObjectMinProperties, schema, path, value);\n    }\n    if (IsDefined(schema.maxProperties) && !(Object.getOwnPropertyNames(value).length <= schema.maxProperties)) {\n        yield Create(ValueErrorType.ObjectMaxProperties, schema, path, value);\n    }\n    const requiredKeys = Array.isArray(schema.required) ? schema.required : [];\n    const knownKeys = Object.getOwnPropertyNames(schema.properties);\n    const unknownKeys = Object.getOwnPropertyNames(value);\n    for (const requiredKey of requiredKeys) {\n        if (unknownKeys.includes(requiredKey))\n            continue;\n        yield Create(ValueErrorType.ObjectRequiredProperty, schema.properties[requiredKey], `${path}/${EscapeKey(requiredKey)}`, undefined);\n    }\n    if (schema.additionalProperties === false) {\n        for (const valueKey of unknownKeys) {\n            if (!knownKeys.includes(valueKey)) {\n                yield Create(ValueErrorType.ObjectAdditionalProperties, schema, `${path}/${EscapeKey(valueKey)}`, value[valueKey]);\n            }\n        }\n    }\n    if (typeof schema.additionalProperties === 'object') {\n        for (const valueKey of unknownKeys) {\n            if (knownKeys.includes(valueKey))\n                continue;\n            yield* Visit(schema.additionalProperties, references, `${path}/${EscapeKey(valueKey)}`, value[valueKey]);\n        }\n    }\n    for (const knownKey of knownKeys) {\n        const property = schema.properties[knownKey];\n        if (schema.required && schema.required.includes(knownKey)) {\n            yield* Visit(property, references, `${path}/${EscapeKey(knownKey)}`, value[knownKey]);\n            if (ExtendsUndefinedCheck(schema) && !(knownKey in value)) {\n                yield Create(ValueErrorType.ObjectRequiredProperty, property, `${path}/${EscapeKey(knownKey)}`, undefined);\n            }\n        }\n        else {\n            if (TypeSystemPolicy.IsExactOptionalProperty(value, knownKey)) {\n                yield* Visit(property, references, `${path}/${EscapeKey(knownKey)}`, value[knownKey]);\n            }\n        }\n    }\n}\nfunction* FromPromise(schema, references, path, value) {\n    if (!IsPromise(value))\n        yield Create(ValueErrorType.Promise, schema, path, value);\n}\nfunction* FromRecord(schema, references, path, value) {\n    if (!TypeSystemPolicy.IsRecordLike(value))\n        return yield Create(ValueErrorType.Object, schema, path, value);\n    if (IsDefined(schema.minProperties) && !(Object.getOwnPropertyNames(value).length >= schema.minProperties)) {\n        yield Create(ValueErrorType.ObjectMinProperties, schema, path, value);\n    }\n    if (IsDefined(schema.maxProperties) && !(Object.getOwnPropertyNames(value).length <= schema.maxProperties)) {\n        yield Create(ValueErrorType.ObjectMaxProperties, schema, path, value);\n    }\n    const [patternKey, patternSchema] = Object.entries(schema.patternProperties)[0];\n    const regex = new RegExp(patternKey);\n    for (const [propertyKey, propertyValue] of Object.entries(value)) {\n        if (regex.test(propertyKey))\n            yield* Visit(patternSchema, references, `${path}/${EscapeKey(propertyKey)}`, propertyValue);\n    }\n    if (typeof schema.additionalProperties === 'object') {\n        for (const [propertyKey, propertyValue] of Object.entries(value)) {\n            if (!regex.test(propertyKey))\n                yield* Visit(schema.additionalProperties, references, `${path}/${EscapeKey(propertyKey)}`, propertyValue);\n        }\n    }\n    if (schema.additionalProperties === false) {\n        for (const [propertyKey, propertyValue] of Object.entries(value)) {\n            if (regex.test(propertyKey))\n                continue;\n            return yield Create(ValueErrorType.ObjectAdditionalProperties, schema, `${path}/${EscapeKey(propertyKey)}`, propertyValue);\n        }\n    }\n}\nfunction* FromRef(schema, references, path, value) {\n    yield* Visit(Deref(schema, references), references, path, value);\n}\nfunction* FromRegExp(schema, references, path, value) {\n    if (!IsString(value))\n        return yield Create(ValueErrorType.String, schema, path, value);\n    if (IsDefined(schema.minLength) && !(value.length >= schema.minLength)) {\n        yield Create(ValueErrorType.StringMinLength, schema, path, value);\n    }\n    if (IsDefined(schema.maxLength) && !(value.length <= schema.maxLength)) {\n        yield Create(ValueErrorType.StringMaxLength, schema, path, value);\n    }\n    const regex = new RegExp(schema.source, schema.flags);\n    if (!regex.test(value)) {\n        return yield Create(ValueErrorType.RegExp, schema, path, value);\n    }\n}\nfunction* FromString(schema, references, path, value) {\n    if (!IsString(value))\n        return yield Create(ValueErrorType.String, schema, path, value);\n    if (IsDefined(schema.minLength) && !(value.length >= schema.minLength)) {\n        yield Create(ValueErrorType.StringMinLength, schema, path, value);\n    }\n    if (IsDefined(schema.maxLength) && !(value.length <= schema.maxLength)) {\n        yield Create(ValueErrorType.StringMaxLength, schema, path, value);\n    }\n    if (IsString(schema.pattern)) {\n        const regex = new RegExp(schema.pattern);\n        if (!regex.test(value)) {\n            yield Create(ValueErrorType.StringPattern, schema, path, value);\n        }\n    }\n    if (IsString(schema.format)) {\n        if (!FormatRegistry.Has(schema.format)) {\n            yield Create(ValueErrorType.StringFormatUnknown, schema, path, value);\n        }\n        else {\n            const format = FormatRegistry.Get(schema.format);\n            if (!format(value)) {\n                yield Create(ValueErrorType.StringFormat, schema, path, value);\n            }\n        }\n    }\n}\nfunction* FromSymbol(schema, references, path, value) {\n    if (!IsSymbol(value))\n        yield Create(ValueErrorType.Symbol, schema, path, value);\n}\nfunction* FromTemplateLiteral(schema, references, path, value) {\n    if (!IsString(value))\n        return yield Create(ValueErrorType.String, schema, path, value);\n    const regex = new RegExp(schema.pattern);\n    if (!regex.test(value)) {\n        yield Create(ValueErrorType.StringPattern, schema, path, value);\n    }\n}\nfunction* FromThis(schema, references, path, value) {\n    yield* Visit(Deref(schema, references), references, path, value);\n}\nfunction* FromTuple(schema, references, path, value) {\n    if (!IsArray(value))\n        return yield Create(ValueErrorType.Tuple, schema, path, value);\n    if (schema.items === undefined && !(value.length === 0)) {\n        return yield Create(ValueErrorType.TupleLength, schema, path, value);\n    }\n    if (!(value.length === schema.maxItems)) {\n        return yield Create(ValueErrorType.TupleLength, schema, path, value);\n    }\n    if (!schema.items) {\n        return;\n    }\n    for (let i = 0; i < schema.items.length; i++) {\n        yield* Visit(schema.items[i], references, `${path}/${i}`, value[i]);\n    }\n}\nfunction* FromUndefined(schema, references, path, value) {\n    if (!IsUndefined(value))\n        yield Create(ValueErrorType.Undefined, schema, path, value);\n}\nfunction* FromUnion(schema, references, path, value) {\n    if (Check(schema, references, value))\n        return;\n    const errors = schema.anyOf.map((variant) => new ValueErrorIterator(Visit(variant, references, path, value)));\n    yield Create(ValueErrorType.Union, schema, path, value, errors);\n}\nfunction* FromUint8Array(schema, references, path, value) {\n    if (!IsUint8Array(value))\n        return yield Create(ValueErrorType.Uint8Array, schema, path, value);\n    if (IsDefined(schema.maxByteLength) && !(value.length <= schema.maxByteLength)) {\n        yield Create(ValueErrorType.Uint8ArrayMaxByteLength, schema, path, value);\n    }\n    if (IsDefined(schema.minByteLength) && !(value.length >= schema.minByteLength)) {\n        yield Create(ValueErrorType.Uint8ArrayMinByteLength, schema, path, value);\n    }\n}\nfunction* FromUnknown(schema, references, path, value) { }\nfunction* FromVoid(schema, references, path, value) {\n    if (!TypeSystemPolicy.IsVoidLike(value))\n        yield Create(ValueErrorType.Void, schema, path, value);\n}\nfunction* FromKind(schema, references, path, value) {\n    const check = TypeRegistry.Get(schema[Kind]);\n    if (!check(schema, value))\n        yield Create(ValueErrorType.Kind, schema, path, value);\n}\nfunction* Visit(schema, references, path, value) {\n    const references_ = IsDefined(schema.$id) ? [...references, schema] : references;\n    const schema_ = schema;\n    switch (schema_[Kind]) {\n        case 'Any':\n            return yield* FromAny(schema_, references_, path, value);\n        case 'Array':\n            return yield* FromArray(schema_, references_, path, value);\n        case 'AsyncIterator':\n            return yield* FromAsyncIterator(schema_, references_, path, value);\n        case 'BigInt':\n            return yield* FromBigInt(schema_, references_, path, value);\n        case 'Boolean':\n            return yield* FromBoolean(schema_, references_, path, value);\n        case 'Constructor':\n            return yield* FromConstructor(schema_, references_, path, value);\n        case 'Date':\n            return yield* FromDate(schema_, references_, path, value);\n        case 'Function':\n            return yield* FromFunction(schema_, references_, path, value);\n        case 'Integer':\n            return yield* FromInteger(schema_, references_, path, value);\n        case 'Intersect':\n            return yield* FromIntersect(schema_, references_, path, value);\n        case 'Iterator':\n            return yield* FromIterator(schema_, references_, path, value);\n        case 'Literal':\n            return yield* FromLiteral(schema_, references_, path, value);\n        case 'Never':\n            return yield* FromNever(schema_, references_, path, value);\n        case 'Not':\n            return yield* FromNot(schema_, references_, path, value);\n        case 'Null':\n            return yield* FromNull(schema_, references_, path, value);\n        case 'Number':\n            return yield* FromNumber(schema_, references_, path, value);\n        case 'Object':\n            return yield* FromObject(schema_, references_, path, value);\n        case 'Promise':\n            return yield* FromPromise(schema_, references_, path, value);\n        case 'Record':\n            return yield* FromRecord(schema_, references_, path, value);\n        case 'Ref':\n            return yield* FromRef(schema_, references_, path, value);\n        case 'RegExp':\n            return yield* FromRegExp(schema_, references_, path, value);\n        case 'String':\n            return yield* FromString(schema_, references_, path, value);\n        case 'Symbol':\n            return yield* FromSymbol(schema_, references_, path, value);\n        case 'TemplateLiteral':\n            return yield* FromTemplateLiteral(schema_, references_, path, value);\n        case 'This':\n            return yield* FromThis(schema_, references_, path, value);\n        case 'Tuple':\n            return yield* FromTuple(schema_, references_, path, value);\n        case 'Undefined':\n            return yield* FromUndefined(schema_, references_, path, value);\n        case 'Union':\n            return yield* FromUnion(schema_, references_, path, value);\n        case 'Uint8Array':\n            return yield* FromUint8Array(schema_, references_, path, value);\n        case 'Unknown':\n            return yield* FromUnknown(schema_, references_, path, value);\n        case 'Void':\n            return yield* FromVoid(schema_, references_, path, value);\n        default:\n            if (!TypeRegistry.Has(schema_[Kind]))\n                throw new ValueErrorsUnknownTypeError(schema);\n            return yield* FromKind(schema_, references_, path, value);\n    }\n}\n/** Returns an iterator for each error in this value. */\nexport function Errors(...args) {\n    const iterator = args.length === 3 ? Visit(args[0], args[1], '', args[2]) : Visit(args[0], [], '', args[1]);\n    return new ValueErrorIterator(iterator);\n}\n", "import { TypeRegistry, FormatRegistry } from '../type/registry/index.mjs';\nimport { Unsafe } from '../type/unsafe/index.mjs';\nimport { Kind } from '../type/symbols/index.mjs';\nimport { TypeBoxError } from '../type/error/index.mjs';\n// ------------------------------------------------------------------\n// Errors\n// ------------------------------------------------------------------\nexport class TypeSystemDuplicateTypeKind extends TypeBoxError {\n    constructor(kind) {\n        super(`Duplicate type kind '${kind}' detected`);\n    }\n}\nexport class TypeSystemDuplicateFormat extends TypeBoxError {\n    constructor(kind) {\n        super(`Duplicate string format '${kind}' detected`);\n    }\n}\n/** Creates user defined types and formats and provides overrides for value checking behaviours */\nexport var TypeSystem;\n(function (TypeSystem) {\n    /** Creates a new type */\n    function Type(kind, check) {\n        if (TypeRegistry.Has(kind))\n            throw new TypeSystemDuplicateTypeKind(kind);\n        TypeRegistry.Set(kind, check);\n        return (options = {}) => Unsafe({ ...options, [Kind]: kind });\n    }\n    TypeSystem.Type = Type;\n    /** Creates a new string format */\n    function Format(format, check) {\n        if (FormatRegistry.Has(format))\n            throw new TypeSystemDuplicateFormat(format);\n        FormatRegistry.Set(format, check);\n        return format;\n    }\n    TypeSystem.Format = Format;\n})(TypeSystem || (TypeSystem = {}));\n", "import { Kind } from '../type/symbols/index.mjs';\nimport { ValueErrorType } from './errors.mjs';\n/** Creates an error message using en-US as the default locale */\nexport function DefaultErrorFunction(error) {\n    switch (error.errorType) {\n        case ValueErrorType.ArrayContains:\n            return 'Expected array to contain at least one matching value';\n        case ValueErrorType.ArrayMaxContains:\n            return `Expected array to contain no more than ${error.schema.maxContains} matching values`;\n        case ValueErrorType.ArrayMinContains:\n            return `Expected array to contain at least ${error.schema.minContains} matching values`;\n        case ValueErrorType.ArrayMaxItems:\n            return `Expected array length to be less or equal to ${error.schema.maxItems}`;\n        case ValueErrorType.ArrayMinItems:\n            return `Expected array length to be greater or equal to ${error.schema.minItems}`;\n        case ValueErrorType.ArrayUniqueItems:\n            return 'Expected array elements to be unique';\n        case ValueErrorType.Array:\n            return 'Expected array';\n        case ValueErrorType.AsyncIterator:\n            return 'Expected AsyncIterator';\n        case ValueErrorType.BigIntExclusiveMaximum:\n            return `Expected bigint to be less than ${error.schema.exclusiveMaximum}`;\n        case ValueErrorType.BigIntExclusiveMinimum:\n            return `Expected bigint to be greater than ${error.schema.exclusiveMinimum}`;\n        case ValueErrorType.BigIntMaximum:\n            return `Expected bigint to be less or equal to ${error.schema.maximum}`;\n        case ValueErrorType.BigIntMinimum:\n            return `Expected bigint to be greater or equal to ${error.schema.minimum}`;\n        case ValueErrorType.BigIntMultipleOf:\n            return `Expected bigint to be a multiple of ${error.schema.multipleOf}`;\n        case ValueErrorType.BigInt:\n            return 'Expected bigint';\n        case ValueErrorType.Boolean:\n            return 'Expected boolean';\n        case ValueErrorType.DateExclusiveMinimumTimestamp:\n            return `Expected Date timestamp to be greater than ${error.schema.exclusiveMinimumTimestamp}`;\n        case ValueErrorType.DateExclusiveMaximumTimestamp:\n            return `Expected Date timestamp to be less than ${error.schema.exclusiveMaximumTimestamp}`;\n        case ValueErrorType.DateMinimumTimestamp:\n            return `Expected Date timestamp to be greater or equal to ${error.schema.minimumTimestamp}`;\n        case ValueErrorType.DateMaximumTimestamp:\n            return `Expected Date timestamp to be less or equal to ${error.schema.maximumTimestamp}`;\n        case ValueErrorType.DateMultipleOfTimestamp:\n            return `Expected Date timestamp to be a multiple of ${error.schema.multipleOfTimestamp}`;\n        case ValueErrorType.Date:\n            return 'Expected Date';\n        case ValueErrorType.Function:\n            return 'Expected function';\n        case ValueErrorType.IntegerExclusiveMaximum:\n            return `Expected integer to be less than ${error.schema.exclusiveMaximum}`;\n        case ValueErrorType.IntegerExclusiveMinimum:\n            return `Expected integer to be greater than ${error.schema.exclusiveMinimum}`;\n        case ValueErrorType.IntegerMaximum:\n            return `Expected integer to be less or equal to ${error.schema.maximum}`;\n        case ValueErrorType.IntegerMinimum:\n            return `Expected integer to be greater or equal to ${error.schema.minimum}`;\n        case ValueErrorType.IntegerMultipleOf:\n            return `Expected integer to be a multiple of ${error.schema.multipleOf}`;\n        case ValueErrorType.Integer:\n            return 'Expected integer';\n        case ValueErrorType.IntersectUnevaluatedProperties:\n            return 'Unexpected property';\n        case ValueErrorType.Intersect:\n            return 'Expected all values to match';\n        case ValueErrorType.Iterator:\n            return 'Expected Iterator';\n        case ValueErrorType.Literal:\n            return `Expected ${typeof error.schema.const === 'string' ? `'${error.schema.const}'` : error.schema.const}`;\n        case ValueErrorType.Never:\n            return 'Never';\n        case ValueErrorType.Not:\n            return 'Value should not match';\n        case ValueErrorType.Null:\n            return 'Expected null';\n        case ValueErrorType.NumberExclusiveMaximum:\n            return `Expected number to be less than ${error.schema.exclusiveMaximum}`;\n        case ValueErrorType.NumberExclusiveMinimum:\n            return `Expected number to be greater than ${error.schema.exclusiveMinimum}`;\n        case ValueErrorType.NumberMaximum:\n            return `Expected number to be less or equal to ${error.schema.maximum}`;\n        case ValueErrorType.NumberMinimum:\n            return `Expected number to be greater or equal to ${error.schema.minimum}`;\n        case ValueErrorType.NumberMultipleOf:\n            return `Expected number to be a multiple of ${error.schema.multipleOf}`;\n        case ValueErrorType.Number:\n            return 'Expected number';\n        case ValueErrorType.Object:\n            return 'Expected object';\n        case ValueErrorType.ObjectAdditionalProperties:\n            return 'Unexpected property';\n        case ValueErrorType.ObjectMaxProperties:\n            return `Expected object to have no more than ${error.schema.maxProperties} properties`;\n        case ValueErrorType.ObjectMinProperties:\n            return `Expected object to have at least ${error.schema.minProperties} properties`;\n        case ValueErrorType.ObjectRequiredProperty:\n            return 'Expected required property';\n        case ValueErrorType.Promise:\n            return 'Expected Promise';\n        case ValueErrorType.RegExp:\n            return 'Expected string to match regular expression';\n        case ValueErrorType.StringFormatUnknown:\n            return `Unknown format '${error.schema.format}'`;\n        case ValueErrorType.StringFormat:\n            return `Expected string to match '${error.schema.format}' format`;\n        case ValueErrorType.StringMaxLength:\n            return `Expected string length less or equal to ${error.schema.maxLength}`;\n        case ValueErrorType.StringMinLength:\n            return `Expected string length greater or equal to ${error.schema.minLength}`;\n        case ValueErrorType.StringPattern:\n            return `Expected string to match '${error.schema.pattern}'`;\n        case ValueErrorType.String:\n            return 'Expected string';\n        case ValueErrorType.Symbol:\n            return 'Expected symbol';\n        case ValueErrorType.TupleLength:\n            return `Expected tuple to have ${error.schema.maxItems || 0} elements`;\n        case ValueErrorType.Tuple:\n            return 'Expected tuple';\n        case ValueErrorType.Uint8ArrayMaxByteLength:\n            return `Expected byte length less or equal to ${error.schema.maxByteLength}`;\n        case ValueErrorType.Uint8ArrayMinByteLength:\n            return `Expected byte length greater or equal to ${error.schema.minByteLength}`;\n        case ValueErrorType.Uint8Array:\n            return 'Expected Uint8Array';\n        case ValueErrorType.Undefined:\n            return 'Expected undefined';\n        case ValueErrorType.Union:\n            return 'Expected union value';\n        case ValueErrorType.Void:\n            return 'Expected void';\n        case ValueErrorType.Kind:\n            return `Expected kind '${error.schema[Kind]}'`;\n        default:\n            return 'Unknown error type';\n    }\n}\n/** Manages error message providers */\nlet errorFunction = DefaultErrorFunction;\n/** Sets the error function used to generate error messages. */\nexport function SetErrorFunction(callback) {\n    errorFunction = callback;\n}\n/** Gets the error function used to generate error messages */\nexport function GetErrorFunction() {\n    return errorFunction;\n}\n", "import { TypeBoxError } from '../../type/error/index.mjs';\nimport { Kind } from '../../type/symbols/index.mjs';\nimport { IsString } from '../guard/guard.mjs';\nexport class TypeDereferenceError extends TypeBoxError {\n    constructor(schema) {\n        super(`Unable to dereference schema with $id '${schema.$ref}'`);\n        this.schema = schema;\n    }\n}\nfunction Resolve(schema, references) {\n    const target = references.find((target) => target.$id === schema.$ref);\n    if (target === undefined)\n        throw new TypeDereferenceError(schema);\n    return Deref(target, references);\n}\n/** `[Internal]` Pushes a schema onto references if the schema has an $id and does not exist on references */\nexport function Pushref(schema, references) {\n    if (!IsString(schema.$id) || references.some((target) => target.$id === schema.$id))\n        return references;\n    references.push(schema);\n    return references;\n}\n/** `[Internal]` Dereferences a schema from the references array or throws if not found */\nexport function Deref(schema, references) {\n    // prettier-ignore\n    return (schema[Kind] === 'This' || schema[Kind] === 'Ref')\n        ? Resolve(schema, references)\n        : schema;\n}\n", "import { IsArray, IsBoolean, IsBigInt, IsDate, IsNull, IsNumber, IsObject, IsString, IsSymbol, IsUint8Array, IsUndefined } from '../guard/index.mjs';\nimport { TypeBoxError } from '../../type/error/index.mjs';\n// ------------------------------------------------------------------\n// Errors\n// ------------------------------------------------------------------\nexport class ValueHashError extends TypeBoxError {\n    constructor(value) {\n        super(`Unable to hash value`);\n        this.value = value;\n    }\n}\n// ------------------------------------------------------------------\n// ByteMarker\n// ------------------------------------------------------------------\nvar ByteMarker;\n(function (ByteMarker) {\n    ByteMarker[ByteMarker[\"Undefined\"] = 0] = \"Undefined\";\n    ByteMarker[ByteMarker[\"Null\"] = 1] = \"Null\";\n    ByteMarker[ByteMarker[\"Boolean\"] = 2] = \"Boolean\";\n    ByteMarker[ByteMarker[\"Number\"] = 3] = \"Number\";\n    ByteMarker[ByteMarker[\"String\"] = 4] = \"String\";\n    ByteMarker[ByteMarker[\"Object\"] = 5] = \"Object\";\n    ByteMarker[ByteMarker[\"Array\"] = 6] = \"Array\";\n    ByteMarker[ByteMarker[\"Date\"] = 7] = \"Date\";\n    ByteMarker[ByteMarker[\"Uint8Array\"] = 8] = \"Uint8Array\";\n    ByteMarker[ByteMarker[\"Symbol\"] = 9] = \"Symbol\";\n    ByteMarker[ByteMarker[\"BigInt\"] = 10] = \"BigInt\";\n})(ByteMarker || (ByteMarker = {}));\n// ------------------------------------------------------------------\n// State\n// ------------------------------------------------------------------\nlet Accumulator = BigInt('14695981039346656037');\nconst [Prime, Size] = [BigInt('1099511628211'), BigInt('18446744073709551616' /* 2 ^ 64 */)];\nconst Bytes = Array.from({ length: 256 }).map((_, i) => BigInt(i));\nconst F64 = new Float64Array(1);\nconst F64In = new DataView(F64.buffer);\nconst F64Out = new Uint8Array(F64.buffer);\n// ------------------------------------------------------------------\n// NumberToBytes\n// ------------------------------------------------------------------\nfunction* NumberToBytes(value) {\n    const byteCount = value === 0 ? 1 : Math.ceil(Math.floor(Math.log2(value) + 1) / 8);\n    for (let i = 0; i < byteCount; i++) {\n        yield (value >> (8 * (byteCount - 1 - i))) & 0xff;\n    }\n}\n// ------------------------------------------------------------------\n// Hashing Functions\n// ------------------------------------------------------------------\nfunction ArrayType(value) {\n    FNV1A64(ByteMarker.Array);\n    for (const item of value) {\n        Visit(item);\n    }\n}\nfunction BooleanType(value) {\n    FNV1A64(ByteMarker.Boolean);\n    FNV1A64(value ? 1 : 0);\n}\nfunction BigIntType(value) {\n    FNV1A64(ByteMarker.BigInt);\n    F64In.setBigInt64(0, value);\n    for (const byte of F64Out) {\n        FNV1A64(byte);\n    }\n}\nfunction DateType(value) {\n    FNV1A64(ByteMarker.Date);\n    Visit(value.getTime());\n}\nfunction NullType(value) {\n    FNV1A64(ByteMarker.Null);\n}\nfunction NumberType(value) {\n    FNV1A64(ByteMarker.Number);\n    F64In.setFloat64(0, value);\n    for (const byte of F64Out) {\n        FNV1A64(byte);\n    }\n}\nfunction ObjectType(value) {\n    FNV1A64(ByteMarker.Object);\n    for (const key of globalThis.Object.getOwnPropertyNames(value).sort()) {\n        Visit(key);\n        Visit(value[key]);\n    }\n}\nfunction StringType(value) {\n    FNV1A64(ByteMarker.String);\n    for (let i = 0; i < value.length; i++) {\n        for (const byte of NumberToBytes(value.charCodeAt(i))) {\n            FNV1A64(byte);\n        }\n    }\n}\nfunction SymbolType(value) {\n    FNV1A64(ByteMarker.Symbol);\n    Visit(value.description);\n}\nfunction Uint8ArrayType(value) {\n    FNV1A64(ByteMarker.Uint8Array);\n    for (let i = 0; i < value.length; i++) {\n        FNV1A64(value[i]);\n    }\n}\nfunction UndefinedType(value) {\n    return FNV1A64(ByteMarker.Undefined);\n}\nfunction Visit(value) {\n    if (IsArray(value))\n        return ArrayType(value);\n    if (IsBoolean(value))\n        return BooleanType(value);\n    if (IsBigInt(value))\n        return BigIntType(value);\n    if (IsDate(value))\n        return DateType(value);\n    if (IsNull(value))\n        return NullType(value);\n    if (IsNumber(value))\n        return NumberType(value);\n    if (IsObject(value))\n        return ObjectType(value);\n    if (IsString(value))\n        return StringType(value);\n    if (IsSymbol(value))\n        return SymbolType(value);\n    if (IsUint8Array(value))\n        return Uint8ArrayType(value);\n    if (IsUndefined(value))\n        return UndefinedType(value);\n    throw new ValueHashError(value);\n}\nfunction FNV1A64(byte) {\n    Accumulator = Accumulator ^ Bytes[byte];\n    Accumulator = (Accumulator * Prime) % Size;\n}\n// ------------------------------------------------------------------\n// Hash\n// ------------------------------------------------------------------\n/** Creates a FNV1A-64 non cryptographic hash of the given value */\nexport function Hash(value) {\n    Accumulator = BigInt('14695981039346656037');\n    Visit(value);\n    return Accumulator;\n}\n", "import { TypeSystemPolicy } from '../../system/index.mjs';\nimport { Deref } from '../deref/index.mjs';\nimport { Hash } from '../hash/index.mjs';\nimport { Kind } from '../../type/symbols/index.mjs';\nimport { KeyOfPattern } from '../../type/keyof/index.mjs';\nimport { ExtendsUndefinedCheck } from '../../type/extends/index.mjs';\nimport { TypeRegistry, FormatRegistry } from '../../type/registry/index.mjs';\nimport { TypeBoxError } from '../../type/error/index.mjs';\nimport { Never } from '../../type/never/index.mjs';\n// ------------------------------------------------------------------\n// ValueGuard\n// ------------------------------------------------------------------\nimport { IsArray, IsUint8Array, IsDate, IsPromise, IsFunction, IsAsyncIterator, IsIterator, IsBoolean, IsNumber, IsBigInt, IsString, IsSymbol, IsInteger, IsNull, IsUndefined } from '../guard/index.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsSchema } from '../../type/guard/type.mjs';\n// ------------------------------------------------------------------\n// Errors\n// ------------------------------------------------------------------\nexport class ValueCheckUnknownTypeError extends TypeBoxError {\n    constructor(schema) {\n        super(`Unknown type`);\n        this.schema = schema;\n    }\n}\n// ------------------------------------------------------------------\n// TypeGuards\n// ------------------------------------------------------------------\nfunction IsAnyOrUnknown(schema) {\n    return schema[Kind] === 'Any' || schema[Kind] === 'Unknown';\n}\n// ------------------------------------------------------------------\n// Guards\n// ------------------------------------------------------------------\nfunction IsDefined(value) {\n    return value !== undefined;\n}\n// ------------------------------------------------------------------\n// Types\n// ------------------------------------------------------------------\nfunction FromAny(schema, references, value) {\n    return true;\n}\nfunction FromArray(schema, references, value) {\n    if (!IsArray(value))\n        return false;\n    if (IsDefined(schema.minItems) && !(value.length >= schema.minItems)) {\n        return false;\n    }\n    if (IsDefined(schema.maxItems) && !(value.length <= schema.maxItems)) {\n        return false;\n    }\n    if (!value.every((value) => Visit(schema.items, references, value))) {\n        return false;\n    }\n    // prettier-ignore\n    if (schema.uniqueItems === true && !((function () { const set = new Set(); for (const element of value) {\n        const hashed = Hash(element);\n        if (set.has(hashed)) {\n            return false;\n        }\n        else {\n            set.add(hashed);\n        }\n    } return true; })())) {\n        return false;\n    }\n    // contains\n    if (!(IsDefined(schema.contains) || IsNumber(schema.minContains) || IsNumber(schema.maxContains))) {\n        return true; // exit\n    }\n    const containsSchema = IsDefined(schema.contains) ? schema.contains : Never();\n    const containsCount = value.reduce((acc, value) => (Visit(containsSchema, references, value) ? acc + 1 : acc), 0);\n    if (containsCount === 0) {\n        return false;\n    }\n    if (IsNumber(schema.minContains) && containsCount < schema.minContains) {\n        return false;\n    }\n    if (IsNumber(schema.maxContains) && containsCount > schema.maxContains) {\n        return false;\n    }\n    return true;\n}\nfunction FromAsyncIterator(schema, references, value) {\n    return IsAsyncIterator(value);\n}\nfunction FromBigInt(schema, references, value) {\n    if (!IsBigInt(value))\n        return false;\n    if (IsDefined(schema.exclusiveMaximum) && !(value < schema.exclusiveMaximum)) {\n        return false;\n    }\n    if (IsDefined(schema.exclusiveMinimum) && !(value > schema.exclusiveMinimum)) {\n        return false;\n    }\n    if (IsDefined(schema.maximum) && !(value <= schema.maximum)) {\n        return false;\n    }\n    if (IsDefined(schema.minimum) && !(value >= schema.minimum)) {\n        return false;\n    }\n    if (IsDefined(schema.multipleOf) && !(value % schema.multipleOf === BigInt(0))) {\n        return false;\n    }\n    return true;\n}\nfunction FromBoolean(schema, references, value) {\n    return IsBoolean(value);\n}\nfunction FromConstructor(schema, references, value) {\n    return Visit(schema.returns, references, value.prototype);\n}\nfunction FromDate(schema, references, value) {\n    if (!IsDate(value))\n        return false;\n    if (IsDefined(schema.exclusiveMaximumTimestamp) && !(value.getTime() < schema.exclusiveMaximumTimestamp)) {\n        return false;\n    }\n    if (IsDefined(schema.exclusiveMinimumTimestamp) && !(value.getTime() > schema.exclusiveMinimumTimestamp)) {\n        return false;\n    }\n    if (IsDefined(schema.maximumTimestamp) && !(value.getTime() <= schema.maximumTimestamp)) {\n        return false;\n    }\n    if (IsDefined(schema.minimumTimestamp) && !(value.getTime() >= schema.minimumTimestamp)) {\n        return false;\n    }\n    if (IsDefined(schema.multipleOfTimestamp) && !(value.getTime() % schema.multipleOfTimestamp === 0)) {\n        return false;\n    }\n    return true;\n}\nfunction FromFunction(schema, references, value) {\n    return IsFunction(value);\n}\nfunction FromInteger(schema, references, value) {\n    if (!IsInteger(value)) {\n        return false;\n    }\n    if (IsDefined(schema.exclusiveMaximum) && !(value < schema.exclusiveMaximum)) {\n        return false;\n    }\n    if (IsDefined(schema.exclusiveMinimum) && !(value > schema.exclusiveMinimum)) {\n        return false;\n    }\n    if (IsDefined(schema.maximum) && !(value <= schema.maximum)) {\n        return false;\n    }\n    if (IsDefined(schema.minimum) && !(value >= schema.minimum)) {\n        return false;\n    }\n    if (IsDefined(schema.multipleOf) && !(value % schema.multipleOf === 0)) {\n        return false;\n    }\n    return true;\n}\nfunction FromIntersect(schema, references, value) {\n    const check1 = schema.allOf.every((schema) => Visit(schema, references, value));\n    if (schema.unevaluatedProperties === false) {\n        const keyPattern = new RegExp(KeyOfPattern(schema));\n        const check2 = Object.getOwnPropertyNames(value).every((key) => keyPattern.test(key));\n        return check1 && check2;\n    }\n    else if (IsSchema(schema.unevaluatedProperties)) {\n        const keyCheck = new RegExp(KeyOfPattern(schema));\n        const check2 = Object.getOwnPropertyNames(value).every((key) => keyCheck.test(key) || Visit(schema.unevaluatedProperties, references, value[key]));\n        return check1 && check2;\n    }\n    else {\n        return check1;\n    }\n}\nfunction FromIterator(schema, references, value) {\n    return IsIterator(value);\n}\nfunction FromLiteral(schema, references, value) {\n    return value === schema.const;\n}\nfunction FromNever(schema, references, value) {\n    return false;\n}\nfunction FromNot(schema, references, value) {\n    return !Visit(schema.not, references, value);\n}\nfunction FromNull(schema, references, value) {\n    return IsNull(value);\n}\nfunction FromNumber(schema, references, value) {\n    if (!TypeSystemPolicy.IsNumberLike(value))\n        return false;\n    if (IsDefined(schema.exclusiveMaximum) && !(value < schema.exclusiveMaximum)) {\n        return false;\n    }\n    if (IsDefined(schema.exclusiveMinimum) && !(value > schema.exclusiveMinimum)) {\n        return false;\n    }\n    if (IsDefined(schema.minimum) && !(value >= schema.minimum)) {\n        return false;\n    }\n    if (IsDefined(schema.maximum) && !(value <= schema.maximum)) {\n        return false;\n    }\n    if (IsDefined(schema.multipleOf) && !(value % schema.multipleOf === 0)) {\n        return false;\n    }\n    return true;\n}\nfunction FromObject(schema, references, value) {\n    if (!TypeSystemPolicy.IsObjectLike(value))\n        return false;\n    if (IsDefined(schema.minProperties) && !(Object.getOwnPropertyNames(value).length >= schema.minProperties)) {\n        return false;\n    }\n    if (IsDefined(schema.maxProperties) && !(Object.getOwnPropertyNames(value).length <= schema.maxProperties)) {\n        return false;\n    }\n    const knownKeys = Object.getOwnPropertyNames(schema.properties);\n    for (const knownKey of knownKeys) {\n        const property = schema.properties[knownKey];\n        if (schema.required && schema.required.includes(knownKey)) {\n            if (!Visit(property, references, value[knownKey])) {\n                return false;\n            }\n            if ((ExtendsUndefinedCheck(property) || IsAnyOrUnknown(property)) && !(knownKey in value)) {\n                return false;\n            }\n        }\n        else {\n            if (TypeSystemPolicy.IsExactOptionalProperty(value, knownKey) && !Visit(property, references, value[knownKey])) {\n                return false;\n            }\n        }\n    }\n    if (schema.additionalProperties === false) {\n        const valueKeys = Object.getOwnPropertyNames(value);\n        // optimization: value is valid if schemaKey length matches the valueKey length\n        if (schema.required && schema.required.length === knownKeys.length && valueKeys.length === knownKeys.length) {\n            return true;\n        }\n        else {\n            return valueKeys.every((valueKey) => knownKeys.includes(valueKey));\n        }\n    }\n    else if (typeof schema.additionalProperties === 'object') {\n        const valueKeys = Object.getOwnPropertyNames(value);\n        return valueKeys.every((key) => knownKeys.includes(key) || Visit(schema.additionalProperties, references, value[key]));\n    }\n    else {\n        return true;\n    }\n}\nfunction FromPromise(schema, references, value) {\n    return IsPromise(value);\n}\nfunction FromRecord(schema, references, value) {\n    if (!TypeSystemPolicy.IsRecordLike(value)) {\n        return false;\n    }\n    if (IsDefined(schema.minProperties) && !(Object.getOwnPropertyNames(value).length >= schema.minProperties)) {\n        return false;\n    }\n    if (IsDefined(schema.maxProperties) && !(Object.getOwnPropertyNames(value).length <= schema.maxProperties)) {\n        return false;\n    }\n    const [patternKey, patternSchema] = Object.entries(schema.patternProperties)[0];\n    const regex = new RegExp(patternKey);\n    // prettier-ignore\n    const check1 = Object.entries(value).every(([key, value]) => {\n        return (regex.test(key)) ? Visit(patternSchema, references, value) : true;\n    });\n    // prettier-ignore\n    const check2 = typeof schema.additionalProperties === 'object' ? Object.entries(value).every(([key, value]) => {\n        return (!regex.test(key)) ? Visit(schema.additionalProperties, references, value) : true;\n    }) : true;\n    const check3 = schema.additionalProperties === false\n        ? Object.getOwnPropertyNames(value).every((key) => {\n            return regex.test(key);\n        })\n        : true;\n    return check1 && check2 && check3;\n}\nfunction FromRef(schema, references, value) {\n    return Visit(Deref(schema, references), references, value);\n}\nfunction FromRegExp(schema, references, value) {\n    const regex = new RegExp(schema.source, schema.flags);\n    if (IsDefined(schema.minLength)) {\n        if (!(value.length >= schema.minLength))\n            return false;\n    }\n    if (IsDefined(schema.maxLength)) {\n        if (!(value.length <= schema.maxLength))\n            return false;\n    }\n    return regex.test(value);\n}\nfunction FromString(schema, references, value) {\n    if (!IsString(value)) {\n        return false;\n    }\n    if (IsDefined(schema.minLength)) {\n        if (!(value.length >= schema.minLength))\n            return false;\n    }\n    if (IsDefined(schema.maxLength)) {\n        if (!(value.length <= schema.maxLength))\n            return false;\n    }\n    if (IsDefined(schema.pattern)) {\n        const regex = new RegExp(schema.pattern);\n        if (!regex.test(value))\n            return false;\n    }\n    if (IsDefined(schema.format)) {\n        if (!FormatRegistry.Has(schema.format))\n            return false;\n        const func = FormatRegistry.Get(schema.format);\n        return func(value);\n    }\n    return true;\n}\nfunction FromSymbol(schema, references, value) {\n    return IsSymbol(value);\n}\nfunction FromTemplateLiteral(schema, references, value) {\n    return IsString(value) && new RegExp(schema.pattern).test(value);\n}\nfunction FromThis(schema, references, value) {\n    return Visit(Deref(schema, references), references, value);\n}\nfunction FromTuple(schema, references, value) {\n    if (!IsArray(value)) {\n        return false;\n    }\n    if (schema.items === undefined && !(value.length === 0)) {\n        return false;\n    }\n    if (!(value.length === schema.maxItems)) {\n        return false;\n    }\n    if (!schema.items) {\n        return true;\n    }\n    for (let i = 0; i < schema.items.length; i++) {\n        if (!Visit(schema.items[i], references, value[i]))\n            return false;\n    }\n    return true;\n}\nfunction FromUndefined(schema, references, value) {\n    return IsUndefined(value);\n}\nfunction FromUnion(schema, references, value) {\n    return schema.anyOf.some((inner) => Visit(inner, references, value));\n}\nfunction FromUint8Array(schema, references, value) {\n    if (!IsUint8Array(value)) {\n        return false;\n    }\n    if (IsDefined(schema.maxByteLength) && !(value.length <= schema.maxByteLength)) {\n        return false;\n    }\n    if (IsDefined(schema.minByteLength) && !(value.length >= schema.minByteLength)) {\n        return false;\n    }\n    return true;\n}\nfunction FromUnknown(schema, references, value) {\n    return true;\n}\nfunction FromVoid(schema, references, value) {\n    return TypeSystemPolicy.IsVoidLike(value);\n}\nfunction FromKind(schema, references, value) {\n    if (!TypeRegistry.Has(schema[Kind]))\n        return false;\n    const func = TypeRegistry.Get(schema[Kind]);\n    return func(schema, value);\n}\nfunction Visit(schema, references, value) {\n    const references_ = IsDefined(schema.$id) ? [...references, schema] : references;\n    const schema_ = schema;\n    switch (schema_[Kind]) {\n        case 'Any':\n            return FromAny(schema_, references_, value);\n        case 'Array':\n            return FromArray(schema_, references_, value);\n        case 'AsyncIterator':\n            return FromAsyncIterator(schema_, references_, value);\n        case 'BigInt':\n            return FromBigInt(schema_, references_, value);\n        case 'Boolean':\n            return FromBoolean(schema_, references_, value);\n        case 'Constructor':\n            return FromConstructor(schema_, references_, value);\n        case 'Date':\n            return FromDate(schema_, references_, value);\n        case 'Function':\n            return FromFunction(schema_, references_, value);\n        case 'Integer':\n            return FromInteger(schema_, references_, value);\n        case 'Intersect':\n            return FromIntersect(schema_, references_, value);\n        case 'Iterator':\n            return FromIterator(schema_, references_, value);\n        case 'Literal':\n            return FromLiteral(schema_, references_, value);\n        case 'Never':\n            return FromNever(schema_, references_, value);\n        case 'Not':\n            return FromNot(schema_, references_, value);\n        case 'Null':\n            return FromNull(schema_, references_, value);\n        case 'Number':\n            return FromNumber(schema_, references_, value);\n        case 'Object':\n            return FromObject(schema_, references_, value);\n        case 'Promise':\n            return FromPromise(schema_, references_, value);\n        case 'Record':\n            return FromRecord(schema_, references_, value);\n        case 'Ref':\n            return FromRef(schema_, references_, value);\n        case 'RegExp':\n            return FromRegExp(schema_, references_, value);\n        case 'String':\n            return FromString(schema_, references_, value);\n        case 'Symbol':\n            return FromSymbol(schema_, references_, value);\n        case 'TemplateLiteral':\n            return FromTemplateLiteral(schema_, references_, value);\n        case 'This':\n            return FromThis(schema_, references_, value);\n        case 'Tuple':\n            return FromTuple(schema_, references_, value);\n        case 'Undefined':\n            return FromUndefined(schema_, references_, value);\n        case 'Union':\n            return FromUnion(schema_, references_, value);\n        case 'Uint8Array':\n            return FromUint8Array(schema_, references_, value);\n        case 'Unknown':\n            return FromUnknown(schema_, references_, value);\n        case 'Void':\n            return FromVoid(schema_, references_, value);\n        default:\n            if (!TypeRegistry.Has(schema_[Kind]))\n                throw new ValueCheckUnknownTypeError(schema_);\n            return FromKind(schema_, references_, value);\n    }\n}\n/** Returns true if the value matches the given type. */\nexport function Check(...args) {\n    return args.length === 3 ? Visit(args[0], args[1], args[2]) : Visit(args[0], [], args[1]);\n}\n", "// ------------------------------------------------------------------\n// Errors (re-export)\n// ------------------------------------------------------------------\nexport { ValueErrorType, ValueErrorIterator } from '../errors/index.mjs';\n// ------------------------------------------------------------------\n// Guards\n// ------------------------------------------------------------------\nexport * from './guard/index.mjs';\n// ------------------------------------------------------------------\n// Operators\n// ------------------------------------------------------------------\nexport * from './assert/index.mjs';\nexport * from './cast/index.mjs';\nexport * from './check/index.mjs';\nexport * from './clean/index.mjs';\nexport * from './clone/index.mjs';\nexport * from './convert/index.mjs';\nexport * from './create/index.mjs';\nexport * from './decode/index.mjs';\nexport * from './default/index.mjs';\nexport * from './delta/index.mjs';\nexport * from './encode/index.mjs';\nexport * from './equal/index.mjs';\nexport * from './hash/index.mjs';\nexport * from './mutate/index.mjs';\nexport * from './parse/index.mjs';\nexport * from './pointer/index.mjs';\nexport * from './transform/index.mjs';\n// ------------------------------------------------------------------\n// Namespace\n// ------------------------------------------------------------------\nexport { Value } from './value/index.mjs';\n", "var __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _AssertError_instances, _AssertError_iterator, _AssertError_Iterator;\nimport { Errors, ValueErrorIterator } from '../../errors/index.mjs';\nimport { TypeBoxError } from '../../type/error/error.mjs';\nimport { Check } from '../check/check.mjs';\n// ------------------------------------------------------------------\n// AssertError\n// ------------------------------------------------------------------\nexport class AssertError extends TypeBoxError {\n    constructor(iterator) {\n        const error = iterator.First();\n        super(error === undefined ? 'Invalid Value' : error.message);\n        _AssertError_instances.add(this);\n        _AssertError_iterator.set(this, void 0);\n        __classPrivateFieldSet(this, _AssertError_iterator, iterator, \"f\");\n        this.error = error;\n    }\n    /** Returns an iterator for each error in this value. */\n    Errors() {\n        return new ValueErrorIterator(__classPrivateFieldGet(this, _AssertError_instances, \"m\", _AssertError_Iterator).call(this));\n    }\n}\n_AssertError_iterator = new WeakMap(), _AssertError_instances = new WeakSet(), _AssertError_Iterator = function* _AssertError_Iterator() {\n    if (this.error)\n        yield this.error;\n    yield* __classPrivateFieldGet(this, _AssertError_iterator, \"f\");\n};\n// ------------------------------------------------------------------\n// AssertValue\n// ------------------------------------------------------------------\nfunction AssertValue(schema, references, value) {\n    if (Check(schema, references, value))\n        return;\n    throw new AssertError(Errors(schema, references, value));\n}\n/** Asserts a value matches the given type or throws an `AssertError` if invalid */\nexport function Assert(...args) {\n    return args.length === 3 ? AssertValue(args[0], args[1], args[2]) : AssertValue(args[0], [], args[1]);\n}\n", "import { IsObject, IsArray, IsString, IsNumber, IsNull } from '../guard/index.mjs';\nimport { TypeBoxError } from '../../type/error/index.mjs';\nimport { Kind } from '../../type/symbols/index.mjs';\nimport { Create } from '../create/index.mjs';\nimport { Check } from '../check/index.mjs';\nimport { Clone } from '../clone/index.mjs';\nimport { Deref } from '../deref/index.mjs';\n// ------------------------------------------------------------------\n// Errors\n// ------------------------------------------------------------------\nexport class ValueCastError extends TypeBoxError {\n    constructor(schema, message) {\n        super(message);\n        this.schema = schema;\n    }\n}\n// ------------------------------------------------------------------\n// The following will score a schema against a value. For objects,\n// the score is the tally of points awarded for each property of\n// the value. Property points are (1.0 / propertyCount) to prevent\n// large property counts biasing results. Properties that match\n// literal values are maximally awarded as literals are typically\n// used as union discriminator fields.\n// ------------------------------------------------------------------\nfunction ScoreUnion(schema, references, value) {\n    if (schema[Kind] === 'Object' && typeof value === 'object' && !IsNull(value)) {\n        const object = schema;\n        const keys = Object.getOwnPropertyNames(value);\n        const entries = Object.entries(object.properties);\n        const [point, max] = [1 / entries.length, entries.length];\n        return entries.reduce((acc, [key, schema]) => {\n            const literal = schema[Kind] === 'Literal' && schema.const === value[key] ? max : 0;\n            const checks = Check(schema, references, value[key]) ? point : 0;\n            const exists = keys.includes(key) ? point : 0;\n            return acc + (literal + checks + exists);\n        }, 0);\n    }\n    else {\n        return Check(schema, references, value) ? 1 : 0;\n    }\n}\nfunction SelectUnion(union, references, value) {\n    const schemas = union.anyOf.map((schema) => Deref(schema, references));\n    let [select, best] = [schemas[0], 0];\n    for (const schema of schemas) {\n        const score = ScoreUnion(schema, references, value);\n        if (score > best) {\n            select = schema;\n            best = score;\n        }\n    }\n    return select;\n}\nfunction CastUnion(union, references, value) {\n    if ('default' in union) {\n        return typeof value === 'function' ? union.default : Clone(union.default);\n    }\n    else {\n        const schema = SelectUnion(union, references, value);\n        return Cast(schema, references, value);\n    }\n}\n// ------------------------------------------------------------------\n// Default\n// ------------------------------------------------------------------\nfunction DefaultClone(schema, references, value) {\n    return Check(schema, references, value) ? Clone(value) : Create(schema, references);\n}\nfunction Default(schema, references, value) {\n    return Check(schema, references, value) ? value : Create(schema, references);\n}\n// ------------------------------------------------------------------\n// Cast\n// ------------------------------------------------------------------\nfunction FromArray(schema, references, value) {\n    if (Check(schema, references, value))\n        return Clone(value);\n    const created = IsArray(value) ? Clone(value) : Create(schema, references);\n    const minimum = IsNumber(schema.minItems) && created.length < schema.minItems ? [...created, ...Array.from({ length: schema.minItems - created.length }, () => null)] : created;\n    const maximum = IsNumber(schema.maxItems) && minimum.length > schema.maxItems ? minimum.slice(0, schema.maxItems) : minimum;\n    const casted = maximum.map((value) => Visit(schema.items, references, value));\n    if (schema.uniqueItems !== true)\n        return casted;\n    const unique = [...new Set(casted)];\n    if (!Check(schema, references, unique))\n        throw new ValueCastError(schema, 'Array cast produced invalid data due to uniqueItems constraint');\n    return unique;\n}\nfunction FromConstructor(schema, references, value) {\n    if (Check(schema, references, value))\n        return Create(schema, references);\n    const required = new Set(schema.returns.required || []);\n    const result = function () { };\n    for (const [key, property] of Object.entries(schema.returns.properties)) {\n        if (!required.has(key) && value.prototype[key] === undefined)\n            continue;\n        result.prototype[key] = Visit(property, references, value.prototype[key]);\n    }\n    return result;\n}\nfunction FromIntersect(schema, references, value) {\n    const created = Create(schema, references);\n    const mapped = IsObject(created) && IsObject(value) ? { ...created, ...value } : value;\n    return Check(schema, references, mapped) ? mapped : Create(schema, references);\n}\nfunction FromNever(schema, references, value) {\n    throw new ValueCastError(schema, 'Never types cannot be cast');\n}\nfunction FromObject(schema, references, value) {\n    if (Check(schema, references, value))\n        return value;\n    if (value === null || typeof value !== 'object')\n        return Create(schema, references);\n    const required = new Set(schema.required || []);\n    const result = {};\n    for (const [key, property] of Object.entries(schema.properties)) {\n        if (!required.has(key) && value[key] === undefined)\n            continue;\n        result[key] = Visit(property, references, value[key]);\n    }\n    // additional schema properties\n    if (typeof schema.additionalProperties === 'object') {\n        const propertyNames = Object.getOwnPropertyNames(schema.properties);\n        for (const propertyName of Object.getOwnPropertyNames(value)) {\n            if (propertyNames.includes(propertyName))\n                continue;\n            result[propertyName] = Visit(schema.additionalProperties, references, value[propertyName]);\n        }\n    }\n    return result;\n}\nfunction FromRecord(schema, references, value) {\n    if (Check(schema, references, value))\n        return Clone(value);\n    if (value === null || typeof value !== 'object' || Array.isArray(value) || value instanceof Date)\n        return Create(schema, references);\n    const subschemaPropertyName = Object.getOwnPropertyNames(schema.patternProperties)[0];\n    const subschema = schema.patternProperties[subschemaPropertyName];\n    const result = {};\n    for (const [propKey, propValue] of Object.entries(value)) {\n        result[propKey] = Visit(subschema, references, propValue);\n    }\n    return result;\n}\nfunction FromRef(schema, references, value) {\n    return Visit(Deref(schema, references), references, value);\n}\nfunction FromThis(schema, references, value) {\n    return Visit(Deref(schema, references), references, value);\n}\nfunction FromTuple(schema, references, value) {\n    if (Check(schema, references, value))\n        return Clone(value);\n    if (!IsArray(value))\n        return Create(schema, references);\n    if (schema.items === undefined)\n        return [];\n    return schema.items.map((schema, index) => Visit(schema, references, value[index]));\n}\nfunction FromUnion(schema, references, value) {\n    return Check(schema, references, value) ? Clone(value) : CastUnion(schema, references, value);\n}\nfunction Visit(schema, references, value) {\n    const references_ = IsString(schema.$id) ? [...references, schema] : references;\n    const schema_ = schema;\n    switch (schema[Kind]) {\n        // --------------------------------------------------------------\n        // Structural\n        // --------------------------------------------------------------\n        case 'Array':\n            return FromArray(schema_, references_, value);\n        case 'Constructor':\n            return FromConstructor(schema_, references_, value);\n        case 'Intersect':\n            return FromIntersect(schema_, references_, value);\n        case 'Never':\n            return FromNever(schema_, references_, value);\n        case 'Object':\n            return FromObject(schema_, references_, value);\n        case 'Record':\n            return FromRecord(schema_, references_, value);\n        case 'Ref':\n            return FromRef(schema_, references_, value);\n        case 'This':\n            return FromThis(schema_, references_, value);\n        case 'Tuple':\n            return FromTuple(schema_, references_, value);\n        case 'Union':\n            return FromUnion(schema_, references_, value);\n        // --------------------------------------------------------------\n        // DefaultClone\n        // --------------------------------------------------------------\n        case 'Date':\n        case 'Symbol':\n        case 'Uint8Array':\n            return DefaultClone(schema, references, value);\n        // --------------------------------------------------------------\n        // Default\n        // --------------------------------------------------------------\n        default:\n            return Default(schema_, references_, value);\n    }\n}\n/** Casts a value into a given type. The return value will retain as much information of the original value as possible. */\nexport function Cast(...args) {\n    return args.length === 3 ? Visit(args[0], args[1], args[2]) : Visit(args[0], [], args[1]);\n}\n", "import { HasPropertyKey } from '../guard/index.mjs';\nimport { Check } from '../check/index.mjs';\nimport { Clone } from '../clone/index.mjs';\nimport { Deref, Pushref } from '../deref/index.mjs';\nimport { TemplateLiteralGenerate, IsTemplateLiteralFinite } from '../../type/template-literal/index.mjs';\nimport { PatternStringExact, PatternNumberExact } from '../../type/patterns/index.mjs';\nimport { TypeRegistry } from '../../type/registry/index.mjs';\nimport { Kind } from '../../type/symbols/index.mjs';\nimport { TypeBoxError } from '../../type/error/index.mjs';\nimport { IsFunction } from '../guard/guard.mjs';\n// ------------------------------------------------------------------\n// Errors\n// ------------------------------------------------------------------\nexport class ValueCreateError extends TypeBoxError {\n    constructor(schema, message) {\n        super(message);\n        this.schema = schema;\n    }\n}\n// ------------------------------------------------------------------\n// Default\n// ------------------------------------------------------------------\nfunction FromDefault(value) {\n    return IsFunction(value) ? value() : Clone(value);\n}\n// ------------------------------------------------------------------\n// Create\n// ------------------------------------------------------------------\nfunction FromAny(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        return {};\n    }\n}\nfunction FromArray(schema, references) {\n    if (schema.uniqueItems === true && !HasPropertyKey(schema, 'default')) {\n        throw new ValueCreateError(schema, 'Array with the uniqueItems constraint requires a default value');\n    }\n    else if ('contains' in schema && !HasPropertyKey(schema, 'default')) {\n        throw new ValueCreateError(schema, 'Array with the contains constraint requires a default value');\n    }\n    else if ('default' in schema) {\n        return FromDefault(schema.default);\n    }\n    else if (schema.minItems !== undefined) {\n        return Array.from({ length: schema.minItems }).map((item) => {\n            return Visit(schema.items, references);\n        });\n    }\n    else {\n        return [];\n    }\n}\nfunction FromAsyncIterator(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        return (async function* () { })();\n    }\n}\nfunction FromBigInt(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        return BigInt(0);\n    }\n}\nfunction FromBoolean(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        return false;\n    }\n}\nfunction FromConstructor(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        const value = Visit(schema.returns, references);\n        if (typeof value === 'object' && !Array.isArray(value)) {\n            return class {\n                constructor() {\n                    for (const [key, val] of Object.entries(value)) {\n                        const self = this;\n                        self[key] = val;\n                    }\n                }\n            };\n        }\n        else {\n            return class {\n            };\n        }\n    }\n}\nfunction FromDate(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else if (schema.minimumTimestamp !== undefined) {\n        return new Date(schema.minimumTimestamp);\n    }\n    else {\n        return new Date();\n    }\n}\nfunction FromFunction(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        return () => Visit(schema.returns, references);\n    }\n}\nfunction FromInteger(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else if (schema.minimum !== undefined) {\n        return schema.minimum;\n    }\n    else {\n        return 0;\n    }\n}\nfunction FromIntersect(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        // --------------------------------------------------------------\n        // Note: The best we can do here is attempt to instance each\n        // sub type and apply through object assign. For non-object\n        // sub types, we just escape the assignment and just return\n        // the value. In the latter case, this is typically going to\n        // be a consequence of an illogical intersection.\n        // --------------------------------------------------------------\n        const value = schema.allOf.reduce((acc, schema) => {\n            const next = Visit(schema, references);\n            return typeof next === 'object' ? { ...acc, ...next } : next;\n        }, {});\n        if (!Check(schema, references, value))\n            throw new ValueCreateError(schema, 'Intersect produced invalid value. Consider using a default value.');\n        return value;\n    }\n}\nfunction FromIterator(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        return (function* () { })();\n    }\n}\nfunction FromLiteral(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        return schema.const;\n    }\n}\nfunction FromNever(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        throw new ValueCreateError(schema, 'Never types cannot be created. Consider using a default value.');\n    }\n}\nfunction FromNot(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        throw new ValueCreateError(schema, 'Not types must have a default value');\n    }\n}\nfunction FromNull(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        return null;\n    }\n}\nfunction FromNumber(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else if (schema.minimum !== undefined) {\n        return schema.minimum;\n    }\n    else {\n        return 0;\n    }\n}\nfunction FromObject(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        const required = new Set(schema.required);\n        const Acc = {};\n        for (const [key, subschema] of Object.entries(schema.properties)) {\n            if (!required.has(key))\n                continue;\n            Acc[key] = Visit(subschema, references);\n        }\n        return Acc;\n    }\n}\nfunction FromPromise(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        return Promise.resolve(Visit(schema.item, references));\n    }\n}\nfunction FromRecord(schema, references) {\n    const [keyPattern, valueSchema] = Object.entries(schema.patternProperties)[0];\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else if (!(keyPattern === PatternStringExact || keyPattern === PatternNumberExact)) {\n        const propertyKeys = keyPattern.slice(1, keyPattern.length - 1).split('|');\n        const Acc = {};\n        for (const key of propertyKeys)\n            Acc[key] = Visit(valueSchema, references);\n        return Acc;\n    }\n    else {\n        return {};\n    }\n}\nfunction FromRef(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        return Visit(Deref(schema, references), references);\n    }\n}\nfunction FromRegExp(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        throw new ValueCreateError(schema, 'RegExp types cannot be created. Consider using a default value.');\n    }\n}\nfunction FromString(schema, references) {\n    if (schema.pattern !== undefined) {\n        if (!HasPropertyKey(schema, 'default')) {\n            throw new ValueCreateError(schema, 'String types with patterns must specify a default value');\n        }\n        else {\n            return FromDefault(schema.default);\n        }\n    }\n    else if (schema.format !== undefined) {\n        if (!HasPropertyKey(schema, 'default')) {\n            throw new ValueCreateError(schema, 'String types with formats must specify a default value');\n        }\n        else {\n            return FromDefault(schema.default);\n        }\n    }\n    else {\n        if (HasPropertyKey(schema, 'default')) {\n            return FromDefault(schema.default);\n        }\n        else if (schema.minLength !== undefined) {\n            // prettier-ignore\n            return Array.from({ length: schema.minLength }).map(() => ' ').join('');\n        }\n        else {\n            return '';\n        }\n    }\n}\nfunction FromSymbol(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else if ('value' in schema) {\n        return Symbol.for(schema.value);\n    }\n    else {\n        return Symbol();\n    }\n}\nfunction FromTemplateLiteral(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    if (!IsTemplateLiteralFinite(schema))\n        throw new ValueCreateError(schema, 'Can only create template literals that produce a finite variants. Consider using a default value.');\n    const generated = TemplateLiteralGenerate(schema);\n    return generated[0];\n}\nfunction FromThis(schema, references) {\n    if (recursiveDepth++ > recursiveMaxDepth)\n        throw new ValueCreateError(schema, 'Cannot create recursive type as it appears possibly infinite. Consider using a default.');\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        return Visit(Deref(schema, references), references);\n    }\n}\nfunction FromTuple(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    if (schema.items === undefined) {\n        return [];\n    }\n    else {\n        return Array.from({ length: schema.minItems }).map((_, index) => Visit(schema.items[index], references));\n    }\n}\nfunction FromUndefined(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        return undefined;\n    }\n}\nfunction FromUnion(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else if (schema.anyOf.length === 0) {\n        throw new Error('ValueCreate.Union: Cannot create Union with zero variants');\n    }\n    else {\n        return Visit(schema.anyOf[0], references);\n    }\n}\nfunction FromUint8Array(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else if (schema.minByteLength !== undefined) {\n        return new Uint8Array(schema.minByteLength);\n    }\n    else {\n        return new Uint8Array(0);\n    }\n}\nfunction FromUnknown(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        return {};\n    }\n}\nfunction FromVoid(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        return void 0;\n    }\n}\nfunction FromKind(schema, references) {\n    if (HasPropertyKey(schema, 'default')) {\n        return FromDefault(schema.default);\n    }\n    else {\n        throw new Error('User defined types must specify a default value');\n    }\n}\nfunction Visit(schema, references) {\n    const references_ = Pushref(schema, references);\n    const schema_ = schema;\n    switch (schema_[Kind]) {\n        case 'Any':\n            return FromAny(schema_, references_);\n        case 'Array':\n            return FromArray(schema_, references_);\n        case 'AsyncIterator':\n            return FromAsyncIterator(schema_, references_);\n        case 'BigInt':\n            return FromBigInt(schema_, references_);\n        case 'Boolean':\n            return FromBoolean(schema_, references_);\n        case 'Constructor':\n            return FromConstructor(schema_, references_);\n        case 'Date':\n            return FromDate(schema_, references_);\n        case 'Function':\n            return FromFunction(schema_, references_);\n        case 'Integer':\n            return FromInteger(schema_, references_);\n        case 'Intersect':\n            return FromIntersect(schema_, references_);\n        case 'Iterator':\n            return FromIterator(schema_, references_);\n        case 'Literal':\n            return FromLiteral(schema_, references_);\n        case 'Never':\n            return FromNever(schema_, references_);\n        case 'Not':\n            return FromNot(schema_, references_);\n        case 'Null':\n            return FromNull(schema_, references_);\n        case 'Number':\n            return FromNumber(schema_, references_);\n        case 'Object':\n            return FromObject(schema_, references_);\n        case 'Promise':\n            return FromPromise(schema_, references_);\n        case 'Record':\n            return FromRecord(schema_, references_);\n        case 'Ref':\n            return FromRef(schema_, references_);\n        case 'RegExp':\n            return FromRegExp(schema_, references_);\n        case 'String':\n            return FromString(schema_, references_);\n        case 'Symbol':\n            return FromSymbol(schema_, references_);\n        case 'TemplateLiteral':\n            return FromTemplateLiteral(schema_, references_);\n        case 'This':\n            return FromThis(schema_, references_);\n        case 'Tuple':\n            return FromTuple(schema_, references_);\n        case 'Undefined':\n            return FromUndefined(schema_, references_);\n        case 'Union':\n            return FromUnion(schema_, references_);\n        case 'Uint8Array':\n            return FromUint8Array(schema_, references_);\n        case 'Unknown':\n            return FromUnknown(schema_, references_);\n        case 'Void':\n            return FromVoid(schema_, references_);\n        default:\n            if (!TypeRegistry.Has(schema_[Kind]))\n                throw new ValueCreateError(schema_, 'Unknown type');\n            return FromKind(schema_, references_);\n    }\n}\n// ------------------------------------------------------------------\n// State\n// ------------------------------------------------------------------\nconst recursiveMaxDepth = 512;\nlet recursiveDepth = 0;\n/** Creates a value from the given schema */\nexport function Create(...args) {\n    recursiveDepth = 0;\n    return args.length === 2 ? Visit(args[0], args[1]) : Visit(args[0], []);\n}\n", "// ------------------------------------------------------------------\n// ValueGuard\n// ------------------------------------------------------------------\nimport { IsArray, IsDate, IsMap, IsSet, IsObject, IsTypedArray, IsValueType } from '../guard/index.mjs';\n// ------------------------------------------------------------------\n// Clonable\n// ------------------------------------------------------------------\nfunction FromObject(value) {\n    const Acc = {};\n    for (const key of Object.getOwnPropertyNames(value)) {\n        Acc[key] = Clone(value[key]);\n    }\n    for (const key of Object.getOwnPropertySymbols(value)) {\n        Acc[key] = Clone(value[key]);\n    }\n    return Acc;\n}\nfunction FromArray(value) {\n    return value.map((element) => Clone(element));\n}\nfunction FromTypedArray(value) {\n    return value.slice();\n}\nfunction FromMap(value) {\n    return new Map(Clone([...value.entries()]));\n}\nfunction FromSet(value) {\n    return new Set(Clone([...value.entries()]));\n}\nfunction FromDate(value) {\n    return new Date(value.toISOString());\n}\nfunction FromValue(value) {\n    return value;\n}\n// ------------------------------------------------------------------\n// Clone\n// ------------------------------------------------------------------\n/** Returns a clone of the given value */\nexport function Clone(value) {\n    if (IsArray(value))\n        return FromArray(value);\n    if (IsDate(value))\n        return FromDate(value);\n    if (IsTypedArray(value))\n        return FromTypedArray(value);\n    if (IsMap(value))\n        return FromMap(value);\n    if (IsSet(value))\n        return FromSet(value);\n    if (IsObject(value))\n        return FromObject(value);\n    if (IsValueType(value))\n        return FromValue(value);\n    throw new Error('ValueClone: Unable to clone value');\n}\n", "import { KeyOfPropertyKeys } from '../../type/keyof/index.mjs';\nimport { Check } from '../check/index.mjs';\nimport { Clone } from '../clone/index.mjs';\nimport { Deref } from '../deref/index.mjs';\nimport { Kind } from '../../type/symbols/index.mjs';\n// ------------------------------------------------------------------\n// ValueGuard\n// ------------------------------------------------------------------\n// prettier-ignore\nimport { HasPropertyKey, IsString, IsObject, IsArray, IsUndefined } from '../guard/index.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\n// prettier-ignore\nimport { IsKind } from '../../type/guard/kind.mjs';\n// ------------------------------------------------------------------\n// IsCheckable\n// ------------------------------------------------------------------\nfunction IsCheckable(schema) {\n    return IsKind(schema) && schema[Kind] !== 'Unsafe';\n}\n// ------------------------------------------------------------------\n// Types\n// ------------------------------------------------------------------\nfunction FromArray(schema, references, value) {\n    if (!IsArray(value))\n        return value;\n    return value.map((value) => Visit(schema.items, references, value));\n}\nfunction FromIntersect(schema, references, value) {\n    const unevaluatedProperties = schema.unevaluatedProperties;\n    const intersections = schema.allOf.map((schema) => Visit(schema, references, Clone(value)));\n    const composite = intersections.reduce((acc, value) => (IsObject(value) ? { ...acc, ...value } : value), {});\n    if (!IsObject(value) || !IsObject(composite) || !IsKind(unevaluatedProperties))\n        return composite;\n    const knownkeys = KeyOfPropertyKeys(schema);\n    for (const key of Object.getOwnPropertyNames(value)) {\n        if (knownkeys.includes(key))\n            continue;\n        if (Check(unevaluatedProperties, references, value[key])) {\n            composite[key] = Visit(unevaluatedProperties, references, value[key]);\n        }\n    }\n    return composite;\n}\nfunction FromObject(schema, references, value) {\n    if (!IsObject(value) || IsArray(value))\n        return value; // Check IsArray for AllowArrayObject configuration\n    const additionalProperties = schema.additionalProperties;\n    for (const key of Object.getOwnPropertyNames(value)) {\n        if (HasPropertyKey(schema.properties, key)) {\n            value[key] = Visit(schema.properties[key], references, value[key]);\n            continue;\n        }\n        if (IsKind(additionalProperties) && Check(additionalProperties, references, value[key])) {\n            value[key] = Visit(additionalProperties, references, value[key]);\n            continue;\n        }\n        delete value[key];\n    }\n    return value;\n}\nfunction FromRecord(schema, references, value) {\n    if (!IsObject(value))\n        return value;\n    const additionalProperties = schema.additionalProperties;\n    const propertyKeys = Object.getOwnPropertyNames(value);\n    const [propertyKey, propertySchema] = Object.entries(schema.patternProperties)[0];\n    const propertyKeyTest = new RegExp(propertyKey);\n    for (const key of propertyKeys) {\n        if (propertyKeyTest.test(key)) {\n            value[key] = Visit(propertySchema, references, value[key]);\n            continue;\n        }\n        if (IsKind(additionalProperties) && Check(additionalProperties, references, value[key])) {\n            value[key] = Visit(additionalProperties, references, value[key]);\n            continue;\n        }\n        delete value[key];\n    }\n    return value;\n}\nfunction FromRef(schema, references, value) {\n    return Visit(Deref(schema, references), references, value);\n}\nfunction FromThis(schema, references, value) {\n    return Visit(Deref(schema, references), references, value);\n}\nfunction FromTuple(schema, references, value) {\n    if (!IsArray(value))\n        return value;\n    if (IsUndefined(schema.items))\n        return [];\n    const length = Math.min(value.length, schema.items.length);\n    for (let i = 0; i < length; i++) {\n        value[i] = Visit(schema.items[i], references, value[i]);\n    }\n    // prettier-ignore\n    return value.length > length\n        ? value.slice(0, length)\n        : value;\n}\nfunction FromUnion(schema, references, value) {\n    for (const inner of schema.anyOf) {\n        if (IsCheckable(inner) && Check(inner, references, value)) {\n            return Visit(inner, references, value);\n        }\n    }\n    return value;\n}\nfunction Visit(schema, references, value) {\n    const references_ = IsString(schema.$id) ? [...references, schema] : references;\n    const schema_ = schema;\n    switch (schema_[Kind]) {\n        case 'Array':\n            return FromArray(schema_, references_, value);\n        case 'Intersect':\n            return FromIntersect(schema_, references_, value);\n        case 'Object':\n            return FromObject(schema_, references_, value);\n        case 'Record':\n            return FromRecord(schema_, references_, value);\n        case 'Ref':\n            return FromRef(schema_, references_, value);\n        case 'This':\n            return FromThis(schema_, references_, value);\n        case 'Tuple':\n            return FromTuple(schema_, references_, value);\n        case 'Union':\n            return FromUnion(schema_, references_, value);\n        default:\n            return value;\n    }\n}\n/** `[Mutable]` Removes excess properties from a value and returns the result. This function does not check the value and returns an unknown type. You should Check the result before use. Clean is a mutable operation. To avoid mutation, Clone the value first. */\nexport function Clean(...args) {\n    return args.length === 3 ? Visit(args[0], args[1], args[2]) : Visit(args[0], [], args[1]);\n}\n", "import { Clone } from '../clone/index.mjs';\nimport { Check } from '../check/index.mjs';\nimport { Deref, Pushref } from '../deref/index.mjs';\nimport { Kind } from '../../type/symbols/index.mjs';\n// ------------------------------------------------------------------\n// ValueGuard\n// ------------------------------------------------------------------\nimport { IsArray, IsObject, IsDate, IsUndefined, IsString, IsNumber, IsBoolean, IsBigInt, IsSymbol, HasPropertyKey } from '../guard/index.mjs';\n// ------------------------------------------------------------------\n// Conversions\n// ------------------------------------------------------------------\nfunction IsStringNumeric(value) {\n    return IsString(value) && !isNaN(value) && !isNaN(parseFloat(value));\n}\nfunction IsValueToString(value) {\n    return IsBigInt(value) || IsBoolean(value) || IsNumber(value);\n}\nfunction IsValueTrue(value) {\n    return value === true || (IsNumber(value) && value === 1) || (IsBigInt(value) && value === BigInt('1')) || (IsString(value) && (value.toLowerCase() === 'true' || value === '1'));\n}\nfunction IsValueFalse(value) {\n    return value === false || (IsNumber(value) && (value === 0 || Object.is(value, -0))) || (IsBigInt(value) && value === BigInt('0')) || (IsString(value) && (value.toLowerCase() === 'false' || value === '0' || value === '-0'));\n}\nfunction IsTimeStringWithTimeZone(value) {\n    return IsString(value) && /^(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)(?:\\.\\d+)?(?:z|[+-]\\d\\d(?::?\\d\\d)?)$/i.test(value);\n}\nfunction IsTimeStringWithoutTimeZone(value) {\n    return IsString(value) && /^(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)?$/i.test(value);\n}\nfunction IsDateTimeStringWithTimeZone(value) {\n    return IsString(value) && /^\\d\\d\\d\\d-[0-1]\\d-[0-3]\\dt(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)(?:\\.\\d+)?(?:z|[+-]\\d\\d(?::?\\d\\d)?)$/i.test(value);\n}\nfunction IsDateTimeStringWithoutTimeZone(value) {\n    return IsString(value) && /^\\d\\d\\d\\d-[0-1]\\d-[0-3]\\dt(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)?$/i.test(value);\n}\nfunction IsDateString(value) {\n    return IsString(value) && /^\\d\\d\\d\\d-[0-1]\\d-[0-3]\\d$/i.test(value);\n}\n// ------------------------------------------------------------------\n// Convert\n// ------------------------------------------------------------------\nfunction TryConvertLiteralString(value, target) {\n    const conversion = TryConvertString(value);\n    return conversion === target ? conversion : value;\n}\nfunction TryConvertLiteralNumber(value, target) {\n    const conversion = TryConvertNumber(value);\n    return conversion === target ? conversion : value;\n}\nfunction TryConvertLiteralBoolean(value, target) {\n    const conversion = TryConvertBoolean(value);\n    return conversion === target ? conversion : value;\n}\n// prettier-ignore\nfunction TryConvertLiteral(schema, value) {\n    return (IsString(schema.const) ? TryConvertLiteralString(value, schema.const) :\n        IsNumber(schema.const) ? TryConvertLiteralNumber(value, schema.const) :\n            IsBoolean(schema.const) ? TryConvertLiteralBoolean(value, schema.const) :\n                value);\n}\nfunction TryConvertBoolean(value) {\n    return IsValueTrue(value) ? true : IsValueFalse(value) ? false : value;\n}\nfunction TryConvertBigInt(value) {\n    const truncateInteger = (value) => value.split('.')[0];\n    return IsStringNumeric(value) ? BigInt(truncateInteger(value)) : IsNumber(value) ? BigInt(Math.trunc(value)) : IsValueFalse(value) ? BigInt(0) : IsValueTrue(value) ? BigInt(1) : value;\n}\nfunction TryConvertString(value) {\n    return IsValueToString(value) ? value.toString() : IsSymbol(value) && value.description !== undefined ? value.description.toString() : value;\n}\nfunction TryConvertNumber(value) {\n    return IsStringNumeric(value) ? parseFloat(value) : IsValueTrue(value) ? 1 : IsValueFalse(value) ? 0 : value;\n}\nfunction TryConvertInteger(value) {\n    return IsStringNumeric(value) ? parseInt(value) : IsNumber(value) ? value | 0 : IsValueTrue(value) ? 1 : IsValueFalse(value) ? 0 : value;\n}\nfunction TryConvertNull(value) {\n    return IsString(value) && value.toLowerCase() === 'null' ? null : value;\n}\nfunction TryConvertUndefined(value) {\n    return IsString(value) && value === 'undefined' ? undefined : value;\n}\n// ------------------------------------------------------------------\n// note: this function may return an invalid dates for the regex\n// tests above. Invalid dates will however be checked during the\n// casting function and will return a epoch date if invalid.\n// Consider better string parsing for the iso dates in future\n// revisions.\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction TryConvertDate(value) {\n    return (IsDate(value) ? value :\n        IsNumber(value) ? new Date(value) :\n            IsValueTrue(value) ? new Date(1) :\n                IsValueFalse(value) ? new Date(0) :\n                    IsStringNumeric(value) ? new Date(parseInt(value)) :\n                        IsTimeStringWithoutTimeZone(value) ? new Date(`1970-01-01T${value}.000Z`) :\n                            IsTimeStringWithTimeZone(value) ? new Date(`1970-01-01T${value}`) :\n                                IsDateTimeStringWithoutTimeZone(value) ? new Date(`${value}.000Z`) :\n                                    IsDateTimeStringWithTimeZone(value) ? new Date(value) :\n                                        IsDateString(value) ? new Date(`${value}T00:00:00.000Z`) :\n                                            value);\n}\n// ------------------------------------------------------------------\n// Default\n// ------------------------------------------------------------------\nfunction Default(value) {\n    return value;\n}\n// ------------------------------------------------------------------\n// Convert\n// ------------------------------------------------------------------\nfunction FromArray(schema, references, value) {\n    const elements = IsArray(value) ? value : [value];\n    return elements.map((element) => Visit(schema.items, references, element));\n}\nfunction FromBigInt(schema, references, value) {\n    return TryConvertBigInt(value);\n}\nfunction FromBoolean(schema, references, value) {\n    return TryConvertBoolean(value);\n}\nfunction FromDate(schema, references, value) {\n    return TryConvertDate(value);\n}\nfunction FromInteger(schema, references, value) {\n    return TryConvertInteger(value);\n}\nfunction FromIntersect(schema, references, value) {\n    return schema.allOf.reduce((value, schema) => Visit(schema, references, value), value);\n}\nfunction FromLiteral(schema, references, value) {\n    return TryConvertLiteral(schema, value);\n}\nfunction FromNull(schema, references, value) {\n    return TryConvertNull(value);\n}\nfunction FromNumber(schema, references, value) {\n    return TryConvertNumber(value);\n}\n// prettier-ignore\nfunction FromObject(schema, references, value) {\n    if (!IsObject(value))\n        return value;\n    for (const propertyKey of Object.getOwnPropertyNames(schema.properties)) {\n        if (!HasPropertyKey(value, propertyKey))\n            continue;\n        value[propertyKey] = Visit(schema.properties[propertyKey], references, value[propertyKey]);\n    }\n    return value;\n}\nfunction FromRecord(schema, references, value) {\n    const isConvertable = IsObject(value);\n    if (!isConvertable)\n        return value;\n    const propertyKey = Object.getOwnPropertyNames(schema.patternProperties)[0];\n    const property = schema.patternProperties[propertyKey];\n    for (const [propKey, propValue] of Object.entries(value)) {\n        value[propKey] = Visit(property, references, propValue);\n    }\n    return value;\n}\nfunction FromRef(schema, references, value) {\n    return Visit(Deref(schema, references), references, value);\n}\nfunction FromString(schema, references, value) {\n    return TryConvertString(value);\n}\nfunction FromSymbol(schema, references, value) {\n    return IsString(value) || IsNumber(value) ? Symbol(value) : value;\n}\nfunction FromThis(schema, references, value) {\n    return Visit(Deref(schema, references), references, value);\n}\n// prettier-ignore\nfunction FromTuple(schema, references, value) {\n    const isConvertable = IsArray(value) && !IsUndefined(schema.items);\n    if (!isConvertable)\n        return value;\n    return value.map((value, index) => {\n        return (index < schema.items.length)\n            ? Visit(schema.items[index], references, value)\n            : value;\n    });\n}\nfunction FromUndefined(schema, references, value) {\n    return TryConvertUndefined(value);\n}\nfunction FromUnion(schema, references, value) {\n    for (const subschema of schema.anyOf) {\n        const converted = Visit(subschema, references, Clone(value));\n        if (!Check(subschema, references, converted))\n            continue;\n        return converted;\n    }\n    return value;\n}\nfunction Visit(schema, references, value) {\n    const references_ = Pushref(schema, references);\n    const schema_ = schema;\n    switch (schema[Kind]) {\n        case 'Array':\n            return FromArray(schema_, references_, value);\n        case 'BigInt':\n            return FromBigInt(schema_, references_, value);\n        case 'Boolean':\n            return FromBoolean(schema_, references_, value);\n        case 'Date':\n            return FromDate(schema_, references_, value);\n        case 'Integer':\n            return FromInteger(schema_, references_, value);\n        case 'Intersect':\n            return FromIntersect(schema_, references_, value);\n        case 'Literal':\n            return FromLiteral(schema_, references_, value);\n        case 'Null':\n            return FromNull(schema_, references_, value);\n        case 'Number':\n            return FromNumber(schema_, references_, value);\n        case 'Object':\n            return FromObject(schema_, references_, value);\n        case 'Record':\n            return FromRecord(schema_, references_, value);\n        case 'Ref':\n            return FromRef(schema_, references_, value);\n        case 'String':\n            return FromString(schema_, references_, value);\n        case 'Symbol':\n            return FromSymbol(schema_, references_, value);\n        case 'This':\n            return FromThis(schema_, references_, value);\n        case 'Tuple':\n            return FromTuple(schema_, references_, value);\n        case 'Undefined':\n            return FromUndefined(schema_, references_, value);\n        case 'Union':\n            return FromUnion(schema_, references_, value);\n        default:\n            return Default(value);\n    }\n}\n/** `[Mutable]` Converts any type mismatched values to their target type if a reasonable conversion is possible. */\n// prettier-ignore\nexport function Convert(...args) {\n    return args.length === 3 ? Visit(args[0], args[1], args[2]) : Visit(args[0], [], args[1]);\n}\n", "import { HasTransform, TransformDecode, TransformDecodeCheckError } from '../transform/index.mjs';\nimport { Check } from '../check/index.mjs';\nimport { Errors } from '../../errors/index.mjs';\n/** Decodes a value or throws if error */\nexport function Decode(...args) {\n    const [schema, references, value] = args.length === 3 ? [args[0], args[1], args[2]] : [args[0], [], args[1]];\n    if (!Check(schema, references, value))\n        throw new TransformDecodeCheckError(schema, value, Errors(schema, references, value).First());\n    return HasTransform(schema, references) ? TransformDecode(schema, references, value) : value;\n}\n", "import { TypeSystemPolicy } from '../../system/policy.mjs';\nimport { Kind, TransformKind } from '../../type/symbols/index.mjs';\nimport { TypeBoxError } from '../../type/error/index.mjs';\nimport { KeyOfPropertyKeys, KeyOfPropertyEntries } from '../../type/keyof/index.mjs';\nimport { Deref, Pushref } from '../deref/index.mjs';\nimport { Check } from '../check/index.mjs';\n// ------------------------------------------------------------------\n// ValueGuard\n// ------------------------------------------------------------------\nimport { HasPropertyKey, IsObject, IsArray, IsValueType, IsUndefined as IsUndefinedValue } from '../guard/index.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsTransform, IsSchema, IsUndefined } from '../../type/guard/type.mjs';\n// ------------------------------------------------------------------\n// Errors\n// ------------------------------------------------------------------\n// thrown externally\n// prettier-ignore\nexport class TransformDecodeCheckError extends TypeBoxError {\n    constructor(schema, value, error) {\n        super(`Unable to decode value as it does not match the expected schema`);\n        this.schema = schema;\n        this.value = value;\n        this.error = error;\n    }\n}\n// prettier-ignore\nexport class TransformDecodeError extends TypeBoxError {\n    constructor(schema, path, value, error) {\n        super(error instanceof Error ? error.message : 'Unknown error');\n        this.schema = schema;\n        this.path = path;\n        this.value = value;\n        this.error = error;\n    }\n}\n// ------------------------------------------------------------------\n// Decode\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction Default(schema, path, value) {\n    try {\n        return IsTransform(schema) ? schema[TransformKind].Decode(value) : value;\n    }\n    catch (error) {\n        throw new TransformDecodeError(schema, path, value, error);\n    }\n}\n// prettier-ignore\nfunction FromArray(schema, references, path, value) {\n    return (IsArray(value))\n        ? Default(schema, path, value.map((value, index) => Visit(schema.items, references, `${path}/${index}`, value)))\n        : Default(schema, path, value);\n}\n// prettier-ignore\nfunction FromIntersect(schema, references, path, value) {\n    if (!IsObject(value) || IsValueType(value))\n        return Default(schema, path, value);\n    const knownEntries = KeyOfPropertyEntries(schema);\n    const knownKeys = knownEntries.map(entry => entry[0]);\n    const knownProperties = { ...value };\n    for (const [knownKey, knownSchema] of knownEntries)\n        if (knownKey in knownProperties) {\n            knownProperties[knownKey] = Visit(knownSchema, references, `${path}/${knownKey}`, knownProperties[knownKey]);\n        }\n    if (!IsTransform(schema.unevaluatedProperties)) {\n        return Default(schema, path, knownProperties);\n    }\n    const unknownKeys = Object.getOwnPropertyNames(knownProperties);\n    const unevaluatedProperties = schema.unevaluatedProperties;\n    const unknownProperties = { ...knownProperties };\n    for (const key of unknownKeys)\n        if (!knownKeys.includes(key)) {\n            unknownProperties[key] = Default(unevaluatedProperties, `${path}/${key}`, unknownProperties[key]);\n        }\n    return Default(schema, path, unknownProperties);\n}\nfunction FromNot(schema, references, path, value) {\n    return Default(schema, path, Visit(schema.not, references, path, value));\n}\n// prettier-ignore\nfunction FromObject(schema, references, path, value) {\n    if (!IsObject(value))\n        return Default(schema, path, value);\n    const knownKeys = KeyOfPropertyKeys(schema);\n    const knownProperties = { ...value };\n    for (const key of knownKeys) {\n        if (!HasPropertyKey(knownProperties, key))\n            continue;\n        // if the property value is undefined, but the target is not, nor does it satisfy exact optional \n        // property policy, then we need to continue. This is a special case for optional property handling \n        // where a transforms wrapped in a optional modifiers should not run.\n        if (IsUndefinedValue(knownProperties[key]) && (!IsUndefined(schema.properties[key]) ||\n            TypeSystemPolicy.IsExactOptionalProperty(knownProperties, key)))\n            continue;\n        // decode property\n        knownProperties[key] = Visit(schema.properties[key], references, `${path}/${key}`, knownProperties[key]);\n    }\n    if (!IsSchema(schema.additionalProperties)) {\n        return Default(schema, path, knownProperties);\n    }\n    const unknownKeys = Object.getOwnPropertyNames(knownProperties);\n    const additionalProperties = schema.additionalProperties;\n    const unknownProperties = { ...knownProperties };\n    for (const key of unknownKeys)\n        if (!knownKeys.includes(key)) {\n            unknownProperties[key] = Default(additionalProperties, `${path}/${key}`, unknownProperties[key]);\n        }\n    return Default(schema, path, unknownProperties);\n}\n// prettier-ignore\nfunction FromRecord(schema, references, path, value) {\n    if (!IsObject(value))\n        return Default(schema, path, value);\n    const pattern = Object.getOwnPropertyNames(schema.patternProperties)[0];\n    const knownKeys = new RegExp(pattern);\n    const knownProperties = { ...value };\n    for (const key of Object.getOwnPropertyNames(value))\n        if (knownKeys.test(key)) {\n            knownProperties[key] = Visit(schema.patternProperties[pattern], references, `${path}/${key}`, knownProperties[key]);\n        }\n    if (!IsSchema(schema.additionalProperties)) {\n        return Default(schema, path, knownProperties);\n    }\n    const unknownKeys = Object.getOwnPropertyNames(knownProperties);\n    const additionalProperties = schema.additionalProperties;\n    const unknownProperties = { ...knownProperties };\n    for (const key of unknownKeys)\n        if (!knownKeys.test(key)) {\n            unknownProperties[key] = Default(additionalProperties, `${path}/${key}`, unknownProperties[key]);\n        }\n    return Default(schema, path, unknownProperties);\n}\n// prettier-ignore\nfunction FromRef(schema, references, path, value) {\n    const target = Deref(schema, references);\n    return Default(schema, path, Visit(target, references, path, value));\n}\n// prettier-ignore\nfunction FromThis(schema, references, path, value) {\n    const target = Deref(schema, references);\n    return Default(schema, path, Visit(target, references, path, value));\n}\n// prettier-ignore\nfunction FromTuple(schema, references, path, value) {\n    return (IsArray(value) && IsArray(schema.items))\n        ? Default(schema, path, schema.items.map((schema, index) => Visit(schema, references, `${path}/${index}`, value[index])))\n        : Default(schema, path, value);\n}\n// prettier-ignore\nfunction FromUnion(schema, references, path, value) {\n    for (const subschema of schema.anyOf) {\n        if (!Check(subschema, references, value))\n            continue;\n        // note: ensure interior is decoded first\n        const decoded = Visit(subschema, references, path, value);\n        return Default(schema, path, decoded);\n    }\n    return Default(schema, path, value);\n}\n// prettier-ignore\nfunction Visit(schema, references, path, value) {\n    const references_ = Pushref(schema, references);\n    const schema_ = schema;\n    switch (schema[Kind]) {\n        case 'Array':\n            return FromArray(schema_, references_, path, value);\n        case 'Intersect':\n            return FromIntersect(schema_, references_, path, value);\n        case 'Not':\n            return FromNot(schema_, references_, path, value);\n        case 'Object':\n            return FromObject(schema_, references_, path, value);\n        case 'Record':\n            return FromRecord(schema_, references_, path, value);\n        case 'Ref':\n            return FromRef(schema_, references_, path, value);\n        case 'Symbol':\n            return Default(schema_, path, value);\n        case 'This':\n            return FromThis(schema_, references_, path, value);\n        case 'Tuple':\n            return FromTuple(schema_, references_, path, value);\n        case 'Union':\n            return FromUnion(schema_, references_, path, value);\n        default:\n            return Default(schema_, path, value);\n    }\n}\n/**\n * `[Internal]` Decodes the value and returns the result. This function requires that\n * the caller `Check` the value before use. Passing unchecked values may result in\n * undefined behavior. Refer to the `Value.Decode()` for implementation details.\n */\nexport function TransformDecode(schema, references, value) {\n    return Visit(schema, references, '', value);\n}\n", "import { TypeSystemPolicy } from '../../system/policy.mjs';\nimport { Kind, TransformKind } from '../../type/symbols/index.mjs';\nimport { TypeBoxError } from '../../type/error/index.mjs';\nimport { KeyOfPropertyKeys, KeyOfPropertyEntries } from '../../type/keyof/index.mjs';\nimport { Deref, Pushref } from '../deref/index.mjs';\nimport { Check } from '../check/index.mjs';\n// ------------------------------------------------------------------\n// ValueGuard\n// ------------------------------------------------------------------\nimport { HasPropertyKey, IsObject, IsArray, IsValueType, IsUndefined as IsUndefinedValue } from '../guard/index.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsTransform, IsSchema, IsUndefined } from '../../type/guard/type.mjs';\n// ------------------------------------------------------------------\n// Errors\n// ------------------------------------------------------------------\n// prettier-ignore\nexport class TransformEncodeCheckError extends TypeBoxError {\n    constructor(schema, value, error) {\n        super(`The encoded value does not match the expected schema`);\n        this.schema = schema;\n        this.value = value;\n        this.error = error;\n    }\n}\n// prettier-ignore\nexport class TransformEncodeError extends TypeBoxError {\n    constructor(schema, path, value, error) {\n        super(`${error instanceof Error ? error.message : 'Unknown error'}`);\n        this.schema = schema;\n        this.path = path;\n        this.value = value;\n        this.error = error;\n    }\n}\n// ------------------------------------------------------------------\n// Encode\n// ------------------------------------------------------------------\n// prettier-ignore\nfunction Default(schema, path, value) {\n    try {\n        return IsTransform(schema) ? schema[TransformKind].Encode(value) : value;\n    }\n    catch (error) {\n        throw new TransformEncodeError(schema, path, value, error);\n    }\n}\n// prettier-ignore\nfunction FromArray(schema, references, path, value) {\n    const defaulted = Default(schema, path, value);\n    return IsArray(defaulted)\n        ? defaulted.map((value, index) => Visit(schema.items, references, `${path}/${index}`, value))\n        : defaulted;\n}\n// prettier-ignore\nfunction FromIntersect(schema, references, path, value) {\n    const defaulted = Default(schema, path, value);\n    if (!IsObject(value) || IsValueType(value))\n        return defaulted;\n    const knownEntries = KeyOfPropertyEntries(schema);\n    const knownKeys = knownEntries.map(entry => entry[0]);\n    const knownProperties = { ...defaulted };\n    for (const [knownKey, knownSchema] of knownEntries)\n        if (knownKey in knownProperties) {\n            knownProperties[knownKey] = Visit(knownSchema, references, `${path}/${knownKey}`, knownProperties[knownKey]);\n        }\n    if (!IsTransform(schema.unevaluatedProperties)) {\n        return knownProperties;\n    }\n    const unknownKeys = Object.getOwnPropertyNames(knownProperties);\n    const unevaluatedProperties = schema.unevaluatedProperties;\n    const properties = { ...knownProperties };\n    for (const key of unknownKeys)\n        if (!knownKeys.includes(key)) {\n            properties[key] = Default(unevaluatedProperties, `${path}/${key}`, properties[key]);\n        }\n    return properties;\n}\n// prettier-ignore\nfunction FromNot(schema, references, path, value) {\n    return Default(schema.not, path, Default(schema, path, value));\n}\n// prettier-ignore\nfunction FromObject(schema, references, path, value) {\n    const defaulted = Default(schema, path, value);\n    if (!IsObject(defaulted))\n        return defaulted;\n    const knownKeys = KeyOfPropertyKeys(schema);\n    const knownProperties = { ...defaulted };\n    for (const key of knownKeys) {\n        if (!HasPropertyKey(knownProperties, key))\n            continue;\n        // if the property value is undefined, but the target is not, nor does it satisfy exact optional \n        // property policy, then we need to continue. This is a special case for optional property handling \n        // where a transforms wrapped in a optional modifiers should not run.\n        if (IsUndefinedValue(knownProperties[key]) && (!IsUndefined(schema.properties[key]) ||\n            TypeSystemPolicy.IsExactOptionalProperty(knownProperties, key)))\n            continue;\n        // encode property\n        knownProperties[key] = Visit(schema.properties[key], references, `${path}/${key}`, knownProperties[key]);\n    }\n    if (!IsSchema(schema.additionalProperties)) {\n        return knownProperties;\n    }\n    const unknownKeys = Object.getOwnPropertyNames(knownProperties);\n    const additionalProperties = schema.additionalProperties;\n    const properties = { ...knownProperties };\n    for (const key of unknownKeys)\n        if (!knownKeys.includes(key)) {\n            properties[key] = Default(additionalProperties, `${path}/${key}`, properties[key]);\n        }\n    return properties;\n}\n// prettier-ignore\nfunction FromRecord(schema, references, path, value) {\n    const defaulted = Default(schema, path, value);\n    if (!IsObject(value))\n        return defaulted;\n    const pattern = Object.getOwnPropertyNames(schema.patternProperties)[0];\n    const knownKeys = new RegExp(pattern);\n    const knownProperties = { ...defaulted };\n    for (const key of Object.getOwnPropertyNames(value))\n        if (knownKeys.test(key)) {\n            knownProperties[key] = Visit(schema.patternProperties[pattern], references, `${path}/${key}`, knownProperties[key]);\n        }\n    if (!IsSchema(schema.additionalProperties)) {\n        return knownProperties;\n    }\n    const unknownKeys = Object.getOwnPropertyNames(knownProperties);\n    const additionalProperties = schema.additionalProperties;\n    const properties = { ...knownProperties };\n    for (const key of unknownKeys)\n        if (!knownKeys.test(key)) {\n            properties[key] = Default(additionalProperties, `${path}/${key}`, properties[key]);\n        }\n    return properties;\n}\n// prettier-ignore\nfunction FromRef(schema, references, path, value) {\n    const target = Deref(schema, references);\n    const resolved = Visit(target, references, path, value);\n    return Default(schema, path, resolved);\n}\n// prettier-ignore\nfunction FromThis(schema, references, path, value) {\n    const target = Deref(schema, references);\n    const resolved = Visit(target, references, path, value);\n    return Default(schema, path, resolved);\n}\n// prettier-ignore\nfunction FromTuple(schema, references, path, value) {\n    const value1 = Default(schema, path, value);\n    return IsArray(schema.items) ? schema.items.map((schema, index) => Visit(schema, references, `${path}/${index}`, value1[index])) : [];\n}\n// prettier-ignore\nfunction FromUnion(schema, references, path, value) {\n    // test value against union variants\n    for (const subschema of schema.anyOf) {\n        if (!Check(subschema, references, value))\n            continue;\n        const value1 = Visit(subschema, references, path, value);\n        return Default(schema, path, value1);\n    }\n    // test transformed value against union variants\n    for (const subschema of schema.anyOf) {\n        const value1 = Visit(subschema, references, path, value);\n        if (!Check(schema, references, value1))\n            continue;\n        return Default(schema, path, value1);\n    }\n    return Default(schema, path, value);\n}\n// prettier-ignore\nfunction Visit(schema, references, path, value) {\n    const references_ = Pushref(schema, references);\n    const schema_ = schema;\n    switch (schema[Kind]) {\n        case 'Array':\n            return FromArray(schema_, references_, path, value);\n        case 'Intersect':\n            return FromIntersect(schema_, references_, path, value);\n        case 'Not':\n            return FromNot(schema_, references_, path, value);\n        case 'Object':\n            return FromObject(schema_, references_, path, value);\n        case 'Record':\n            return FromRecord(schema_, references_, path, value);\n        case 'Ref':\n            return FromRef(schema_, references_, path, value);\n        case 'This':\n            return FromThis(schema_, references_, path, value);\n        case 'Tuple':\n            return FromTuple(schema_, references_, path, value);\n        case 'Union':\n            return FromUnion(schema_, references_, path, value);\n        default:\n            return Default(schema_, path, value);\n    }\n}\n/**\n * `[Internal]` Encodes the value and returns the result. This function expects the\n * caller to pass a statically checked value. This function does not check the encoded\n * result, meaning the result should be passed to `Check` before use. Refer to the\n * `Value.Encode()` function for implementation details.\n */\nexport function TransformEncode(schema, references, value) {\n    return Visit(schema, references, '', value);\n}\n", "import { Deref, Pushref } from '../deref/index.mjs';\nimport { Kind } from '../../type/symbols/index.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsTransform, IsSchema } from '../../type/guard/type.mjs';\n// ------------------------------------------------------------------\n// ValueGuard\n// ------------------------------------------------------------------\nimport { IsUndefined } from '../guard/index.mjs';\n// prettier-ignore\nfunction FromArray(schema, references) {\n    return IsTransform(schema) || Visit(schema.items, references);\n}\n// prettier-ignore\nfunction FromAsyncIterator(schema, references) {\n    return IsTransform(schema) || Visit(schema.items, references);\n}\n// prettier-ignore\nfunction FromConstructor(schema, references) {\n    return IsTransform(schema) || Visit(schema.returns, references) || schema.parameters.some((schema) => Visit(schema, references));\n}\n// prettier-ignore\nfunction FromFunction(schema, references) {\n    return IsTransform(schema) || Visit(schema.returns, references) || schema.parameters.some((schema) => Visit(schema, references));\n}\n// prettier-ignore\nfunction FromIntersect(schema, references) {\n    return IsTransform(schema) || IsTransform(schema.unevaluatedProperties) || schema.allOf.some((schema) => Visit(schema, references));\n}\n// prettier-ignore\nfunction FromIterator(schema, references) {\n    return IsTransform(schema) || Visit(schema.items, references);\n}\n// prettier-ignore\nfunction FromNot(schema, references) {\n    return IsTransform(schema) || Visit(schema.not, references);\n}\n// prettier-ignore\nfunction FromObject(schema, references) {\n    return (IsTransform(schema) ||\n        Object.values(schema.properties).some((schema) => Visit(schema, references)) ||\n        (IsSchema(schema.additionalProperties) && Visit(schema.additionalProperties, references)));\n}\n// prettier-ignore\nfunction FromPromise(schema, references) {\n    return IsTransform(schema) || Visit(schema.item, references);\n}\n// prettier-ignore\nfunction FromRecord(schema, references) {\n    const pattern = Object.getOwnPropertyNames(schema.patternProperties)[0];\n    const property = schema.patternProperties[pattern];\n    return IsTransform(schema) || Visit(property, references) || (IsSchema(schema.additionalProperties) && IsTransform(schema.additionalProperties));\n}\n// prettier-ignore\nfunction FromRef(schema, references) {\n    if (IsTransform(schema))\n        return true;\n    return Visit(Deref(schema, references), references);\n}\n// prettier-ignore\nfunction FromThis(schema, references) {\n    if (IsTransform(schema))\n        return true;\n    return Visit(Deref(schema, references), references);\n}\n// prettier-ignore\nfunction FromTuple(schema, references) {\n    return IsTransform(schema) || (!IsUndefined(schema.items) && schema.items.some((schema) => Visit(schema, references)));\n}\n// prettier-ignore\nfunction FromUnion(schema, references) {\n    return IsTransform(schema) || schema.anyOf.some((schema) => Visit(schema, references));\n}\n// prettier-ignore\nfunction Visit(schema, references) {\n    const references_ = Pushref(schema, references);\n    const schema_ = schema;\n    if (schema.$id && visited.has(schema.$id))\n        return false;\n    if (schema.$id)\n        visited.add(schema.$id);\n    switch (schema[Kind]) {\n        case 'Array':\n            return FromArray(schema_, references_);\n        case 'AsyncIterator':\n            return FromAsyncIterator(schema_, references_);\n        case 'Constructor':\n            return FromConstructor(schema_, references_);\n        case 'Function':\n            return FromFunction(schema_, references_);\n        case 'Intersect':\n            return FromIntersect(schema_, references_);\n        case 'Iterator':\n            return FromIterator(schema_, references_);\n        case 'Not':\n            return FromNot(schema_, references_);\n        case 'Object':\n            return FromObject(schema_, references_);\n        case 'Promise':\n            return FromPromise(schema_, references_);\n        case 'Record':\n            return FromRecord(schema_, references_);\n        case 'Ref':\n            return FromRef(schema_, references_);\n        case 'This':\n            return FromThis(schema_, references_);\n        case 'Tuple':\n            return FromTuple(schema_, references_);\n        case 'Union':\n            return FromUnion(schema_, references_);\n        default:\n            return IsTransform(schema);\n    }\n}\nconst visited = new Set();\n/** Returns true if this schema contains a transform codec */\nexport function HasTransform(schema, references) {\n    visited.clear();\n    return Visit(schema, references);\n}\n", "import { Check } from '../check/index.mjs';\nimport { Clone } from '../clone/index.mjs';\nimport { Deref, Pushref } from '../deref/index.mjs';\nimport { Kind } from '../../type/symbols/index.mjs';\n// ------------------------------------------------------------------\n// ValueGuard\n// ------------------------------------------------------------------\nimport { IsArray, IsDate, IsFunction, IsObject, IsUndefined, HasPropertyKey } from '../guard/index.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsKind } from '../../type/guard/kind.mjs';\n// ------------------------------------------------------------------\n// ValueOrDefault\n// ------------------------------------------------------------------\nfunction ValueOrDefault(schema, value) {\n    const defaultValue = HasPropertyKey(schema, 'default') ? schema.default : undefined;\n    const clone = IsFunction(defaultValue) ? defaultValue() : Clone(defaultValue);\n    return IsUndefined(value) ? clone : IsObject(value) && IsObject(clone) ? Object.assign(clone, value) : value;\n}\n// ------------------------------------------------------------------\n// HasDefaultProperty\n// ------------------------------------------------------------------\nfunction HasDefaultProperty(schema) {\n    return IsKind(schema) && 'default' in schema;\n}\n// ------------------------------------------------------------------\n// Types\n// ------------------------------------------------------------------\nfunction FromArray(schema, references, value) {\n    const defaulted = ValueOrDefault(schema, value);\n    if (!IsArray(defaulted))\n        return defaulted;\n    for (let i = 0; i < defaulted.length; i++) {\n        defaulted[i] = Visit(schema.items, references, defaulted[i]);\n    }\n    return defaulted;\n}\nfunction FromDate(schema, references, value) {\n    // special case intercept for dates\n    return IsDate(value) ? value : ValueOrDefault(schema, value);\n}\nfunction FromIntersect(schema, references, value) {\n    const defaulted = ValueOrDefault(schema, value);\n    return schema.allOf.reduce((acc, schema) => {\n        const next = Visit(schema, references, defaulted);\n        return IsObject(next) ? { ...acc, ...next } : next;\n    }, {});\n}\nfunction FromObject(schema, references, value) {\n    const defaulted = ValueOrDefault(schema, value);\n    // return defaulted\n    if (!IsObject(defaulted))\n        return defaulted;\n    const knownPropertyKeys = Object.getOwnPropertyNames(schema.properties);\n    // properties\n    for (const key of knownPropertyKeys) {\n        // note: we need to traverse into the object and test if the return value\n        // yielded a non undefined result. Here we interpret an undefined result as\n        // a non assignable property and continue.\n        const propertyValue = Visit(schema.properties[key], references, defaulted[key]);\n        if (IsUndefined(propertyValue))\n            continue;\n        defaulted[key] = Visit(schema.properties[key], references, defaulted[key]);\n    }\n    // return if not additional properties\n    if (!HasDefaultProperty(schema.additionalProperties))\n        return defaulted;\n    // additional properties\n    for (const key of Object.getOwnPropertyNames(defaulted)) {\n        if (knownPropertyKeys.includes(key))\n            continue;\n        defaulted[key] = Visit(schema.additionalProperties, references, defaulted[key]);\n    }\n    return defaulted;\n}\nfunction FromRecord(schema, references, value) {\n    const defaulted = ValueOrDefault(schema, value);\n    if (!IsObject(defaulted))\n        return defaulted;\n    const additionalPropertiesSchema = schema.additionalProperties;\n    const [propertyKeyPattern, propertySchema] = Object.entries(schema.patternProperties)[0];\n    const knownPropertyKey = new RegExp(propertyKeyPattern);\n    // properties\n    for (const key of Object.getOwnPropertyNames(defaulted)) {\n        if (!(knownPropertyKey.test(key) && HasDefaultProperty(propertySchema)))\n            continue;\n        defaulted[key] = Visit(propertySchema, references, defaulted[key]);\n    }\n    // return if not additional properties\n    if (!HasDefaultProperty(additionalPropertiesSchema))\n        return defaulted;\n    // additional properties\n    for (const key of Object.getOwnPropertyNames(defaulted)) {\n        if (knownPropertyKey.test(key))\n            continue;\n        defaulted[key] = Visit(additionalPropertiesSchema, references, defaulted[key]);\n    }\n    return defaulted;\n}\nfunction FromRef(schema, references, value) {\n    return Visit(Deref(schema, references), references, ValueOrDefault(schema, value));\n}\nfunction FromThis(schema, references, value) {\n    return Visit(Deref(schema, references), references, value);\n}\nfunction FromTuple(schema, references, value) {\n    const defaulted = ValueOrDefault(schema, value);\n    if (!IsArray(defaulted) || IsUndefined(schema.items))\n        return defaulted;\n    const [items, max] = [schema.items, Math.max(schema.items.length, defaulted.length)];\n    for (let i = 0; i < max; i++) {\n        if (i < items.length)\n            defaulted[i] = Visit(items[i], references, defaulted[i]);\n    }\n    return defaulted;\n}\nfunction FromUnion(schema, references, value) {\n    const defaulted = ValueOrDefault(schema, value);\n    for (const inner of schema.anyOf) {\n        const result = Visit(inner, references, Clone(defaulted));\n        if (Check(inner, references, result)) {\n            return result;\n        }\n    }\n    return defaulted;\n}\nfunction Visit(schema, references, value) {\n    const references_ = Pushref(schema, references);\n    const schema_ = schema;\n    switch (schema_[Kind]) {\n        case 'Array':\n            return FromArray(schema_, references_, value);\n        case 'Date':\n            return FromDate(schema_, references_, value);\n        case 'Intersect':\n            return FromIntersect(schema_, references_, value);\n        case 'Object':\n            return FromObject(schema_, references_, value);\n        case 'Record':\n            return FromRecord(schema_, references_, value);\n        case 'Ref':\n            return FromRef(schema_, references_, value);\n        case 'This':\n            return FromThis(schema_, references_, value);\n        case 'Tuple':\n            return FromTuple(schema_, references_, value);\n        case 'Union':\n            return FromUnion(schema_, references_, value);\n        default:\n            return ValueOrDefault(schema_, value);\n    }\n}\n/** `[Mutable]` Generates missing properties on a value using default schema annotations if available. This function does not check the value and returns an unknown type. You should Check the result before use. Default is a mutable operation. To avoid mutation, Clone the value first. */\nexport function Default(...args) {\n    return args.length === 3 ? Visit(args[0], args[1], args[2]) : Visit(args[0], [], args[1]);\n}\n", "import { HasPropertyKey, IsStandardObject, IsArray, IsTypedArray, IsValueType } from '../guard/index.mjs';\nimport { ValuePointer } from '../pointer/index.mjs';\nimport { Clone } from '../clone/index.mjs';\nimport { Equal } from '../equal/equal.mjs';\nimport { TypeBoxError } from '../../type/error/index.mjs';\nimport { Literal } from '../../type/literal/index.mjs';\nimport { Object } from '../../type/object/index.mjs';\nimport { String } from '../../type/string/index.mjs';\nimport { Unknown } from '../../type/unknown/index.mjs';\nimport { Union } from '../../type/union/index.mjs';\nexport const Insert = Object({\n    type: Literal('insert'),\n    path: String(),\n    value: Unknown(),\n});\nexport const Update = Object({\n    type: Literal('update'),\n    path: String(),\n    value: Unknown(),\n});\nexport const Delete = Object({\n    type: Literal('delete'),\n    path: String(),\n});\nexport const Edit = Union([Insert, Update, Delete]);\n// ------------------------------------------------------------------\n// Errors\n// ------------------------------------------------------------------\nexport class ValueDiffError extends TypeBoxError {\n    constructor(value, message) {\n        super(message);\n        this.value = value;\n    }\n}\n// ------------------------------------------------------------------\n// Command Factory\n// ------------------------------------------------------------------\nfunction CreateUpdate(path, value) {\n    return { type: 'update', path, value };\n}\nfunction CreateInsert(path, value) {\n    return { type: 'insert', path, value };\n}\nfunction CreateDelete(path) {\n    return { type: 'delete', path };\n}\n// ------------------------------------------------------------------\n// AssertDiffable\n// ------------------------------------------------------------------\nfunction AssertDiffable(value) {\n    if (globalThis.Object.getOwnPropertySymbols(value).length > 0)\n        throw new ValueDiffError(value, 'Cannot diff objects with symbols');\n}\n// ------------------------------------------------------------------\n// Diffing Generators\n// ------------------------------------------------------------------\nfunction* ObjectType(path, current, next) {\n    AssertDiffable(current);\n    AssertDiffable(next);\n    if (!IsStandardObject(next))\n        return yield CreateUpdate(path, next);\n    const currentKeys = globalThis.Object.getOwnPropertyNames(current);\n    const nextKeys = globalThis.Object.getOwnPropertyNames(next);\n    // ----------------------------------------------------------------\n    // inserts\n    // ----------------------------------------------------------------\n    for (const key of nextKeys) {\n        if (HasPropertyKey(current, key))\n            continue;\n        yield CreateInsert(`${path}/${key}`, next[key]);\n    }\n    // ----------------------------------------------------------------\n    // updates\n    // ----------------------------------------------------------------\n    for (const key of currentKeys) {\n        if (!HasPropertyKey(next, key))\n            continue;\n        if (Equal(current, next))\n            continue;\n        yield* Visit(`${path}/${key}`, current[key], next[key]);\n    }\n    // ----------------------------------------------------------------\n    // deletes\n    // ----------------------------------------------------------------\n    for (const key of currentKeys) {\n        if (HasPropertyKey(next, key))\n            continue;\n        yield CreateDelete(`${path}/${key}`);\n    }\n}\nfunction* ArrayType(path, current, next) {\n    if (!IsArray(next))\n        return yield CreateUpdate(path, next);\n    for (let i = 0; i < Math.min(current.length, next.length); i++) {\n        yield* Visit(`${path}/${i}`, current[i], next[i]);\n    }\n    for (let i = 0; i < next.length; i++) {\n        if (i < current.length)\n            continue;\n        yield CreateInsert(`${path}/${i}`, next[i]);\n    }\n    for (let i = current.length - 1; i >= 0; i--) {\n        if (i < next.length)\n            continue;\n        yield CreateDelete(`${path}/${i}`);\n    }\n}\nfunction* TypedArrayType(path, current, next) {\n    if (!IsTypedArray(next) || current.length !== next.length || globalThis.Object.getPrototypeOf(current).constructor.name !== globalThis.Object.getPrototypeOf(next).constructor.name)\n        return yield CreateUpdate(path, next);\n    for (let i = 0; i < Math.min(current.length, next.length); i++) {\n        yield* Visit(`${path}/${i}`, current[i], next[i]);\n    }\n}\nfunction* ValueType(path, current, next) {\n    if (current === next)\n        return;\n    yield CreateUpdate(path, next);\n}\nfunction* Visit(path, current, next) {\n    if (IsStandardObject(current))\n        return yield* ObjectType(path, current, next);\n    if (IsArray(current))\n        return yield* ArrayType(path, current, next);\n    if (IsTypedArray(current))\n        return yield* TypedArrayType(path, current, next);\n    if (IsValueType(current))\n        return yield* ValueType(path, current, next);\n    throw new ValueDiffError(current, 'Unable to diff value');\n}\n// ------------------------------------------------------------------\n// Diff\n// ------------------------------------------------------------------\nexport function Diff(current, next) {\n    return [...Visit('', current, next)];\n}\n// ------------------------------------------------------------------\n// Patch\n// ------------------------------------------------------------------\nfunction IsRootUpdate(edits) {\n    return edits.length > 0 && edits[0].path === '' && edits[0].type === 'update';\n}\nfunction IsIdentity(edits) {\n    return edits.length === 0;\n}\nexport function Patch(current, edits) {\n    if (IsRootUpdate(edits)) {\n        return Clone(edits[0].value);\n    }\n    if (IsIdentity(edits)) {\n        return Clone(current);\n    }\n    const clone = Clone(current);\n    for (const edit of edits) {\n        switch (edit.type) {\n            case 'insert': {\n                ValuePointer.Set(clone, edit.path, edit.value);\n                break;\n            }\n            case 'update': {\n                ValuePointer.Set(clone, edit.path, edit.value);\n                break;\n            }\n            case 'delete': {\n                ValuePointer.Delete(clone, edit.path);\n                break;\n            }\n        }\n    }\n    return clone;\n}\n", "export * as ValuePointer from './pointer.mjs';\n", "import { TypeBoxError } from '../../type/error/index.mjs';\n// ------------------------------------------------------------------\n// Errors\n// ------------------------------------------------------------------\nexport class ValuePointerRootSetError extends TypeBoxError {\n    constructor(value, path, update) {\n        super('Cannot set root value');\n        this.value = value;\n        this.path = path;\n        this.update = update;\n    }\n}\nexport class ValuePointerRootDeleteError extends TypeBoxError {\n    constructor(value, path) {\n        super('Cannot delete root value');\n        this.value = value;\n        this.path = path;\n    }\n}\n// ------------------------------------------------------------------\n// ValuePointer\n// ------------------------------------------------------------------\n/** Provides functionality to update values through RFC6901 string pointers */\n// prettier-ignore\nfunction Escape(component) {\n    return component.indexOf('~') === -1 ? component : component.replace(/~1/g, '/').replace(/~0/g, '~');\n}\n/** Formats the given pointer into navigable key components */\n// prettier-ignore\nexport function* Format(pointer) {\n    if (pointer === '')\n        return;\n    let [start, end] = [0, 0];\n    for (let i = 0; i < pointer.length; i++) {\n        const char = pointer.charAt(i);\n        if (char === '/') {\n            if (i === 0) {\n                start = i + 1;\n            }\n            else {\n                end = i;\n                yield Escape(pointer.slice(start, end));\n                start = i + 1;\n            }\n        }\n        else {\n            end = i;\n        }\n    }\n    yield Escape(pointer.slice(start));\n}\n/** Sets the value at the given pointer. If the value at the pointer does not exist it is created */\n// prettier-ignore\nexport function Set(value, pointer, update) {\n    if (pointer === '')\n        throw new ValuePointerRootSetError(value, pointer, update);\n    let [owner, next, key] = [null, value, ''];\n    for (const component of Format(pointer)) {\n        if (next[component] === undefined)\n            next[component] = {};\n        owner = next;\n        next = next[component];\n        key = component;\n    }\n    owner[key] = update;\n}\n/** Deletes a value at the given pointer */\n// prettier-ignore\nexport function Delete(value, pointer) {\n    if (pointer === '')\n        throw new ValuePointerRootDeleteError(value, pointer);\n    let [owner, next, key] = [null, value, ''];\n    for (const component of Format(pointer)) {\n        if (next[component] === undefined || next[component] === null)\n            return;\n        owner = next;\n        next = next[component];\n        key = component;\n    }\n    if (Array.isArray(owner)) {\n        const index = parseInt(key);\n        owner.splice(index, 1);\n    }\n    else {\n        delete owner[key];\n    }\n}\n/** Returns true if a value exists at the given pointer */\n// prettier-ignore\nexport function Has(value, pointer) {\n    if (pointer === '')\n        return true;\n    let [owner, next, key] = [null, value, ''];\n    for (const component of Format(pointer)) {\n        if (next[component] === undefined)\n            return false;\n        owner = next;\n        next = next[component];\n        key = component;\n    }\n    return Object.getOwnPropertyNames(owner).includes(key);\n}\n/** Gets the value at the given pointer */\n// prettier-ignore\nexport function Get(value, pointer) {\n    if (pointer === '')\n        return value;\n    let current = value;\n    for (const component of Format(pointer)) {\n        if (current[component] === undefined)\n            return undefined;\n        current = current[component];\n    }\n    return current;\n}\n", "import { IsObject, IsDate, IsArray, IsTypedArray, IsValueType } from '../guard/index.mjs';\n// ------------------------------------------------------------------\n// Equality Checks\n// ------------------------------------------------------------------\nfunction ObjectType(left, right) {\n    if (!IsObject(right))\n        return false;\n    const leftKeys = [...Object.keys(left), ...Object.getOwnPropertySymbols(left)];\n    const rightKeys = [...Object.keys(right), ...Object.getOwnPropertySymbols(right)];\n    if (leftKeys.length !== rightKeys.length)\n        return false;\n    return leftKeys.every((key) => Equal(left[key], right[key]));\n}\nfunction DateType(left, right) {\n    return IsDate(right) && left.getTime() === right.getTime();\n}\nfunction ArrayType(left, right) {\n    if (!IsArray(right) || left.length !== right.length)\n        return false;\n    return left.every((value, index) => Equal(value, right[index]));\n}\nfunction TypedArrayType(left, right) {\n    if (!IsTypedArray(right) || left.length !== right.length || Object.getPrototypeOf(left).constructor.name !== Object.getPrototypeOf(right).constructor.name)\n        return false;\n    return left.every((value, index) => Equal(value, right[index]));\n}\nfunction ValueType(left, right) {\n    return left === right;\n}\n// ------------------------------------------------------------------\n// Equal\n// ------------------------------------------------------------------\n/** Returns true if the left value deep-equals the right */\nexport function Equal(left, right) {\n    if (IsDate(left))\n        return DateType(left, right);\n    if (IsTypedArray(left))\n        return TypedArrayType(left, right);\n    if (IsArray(left))\n        return ArrayType(left, right);\n    if (IsObject(left))\n        return ObjectType(left, right);\n    if (IsValueType(left))\n        return ValueType(left, right);\n    throw new Error('ValueEquals: Unable to compare value');\n}\n", "import { HasTransform, TransformEncode, TransformEncodeCheckError } from '../transform/index.mjs';\nimport { Check } from '../check/index.mjs';\nimport { Errors } from '../../errors/index.mjs';\n/** Encodes a value or throws if error */\nexport function Encode(...args) {\n    const [schema, references, value] = args.length === 3 ? [args[0], args[1], args[2]] : [args[0], [], args[1]];\n    const encoded = HasTransform(schema, references) ? TransformEncode(schema, references, value) : value;\n    if (!Check(schema, references, encoded))\n        throw new TransformEncodeCheckError(schema, encoded, Errors(schema, references, encoded).First());\n    return encoded;\n}\n", "import { IsObject, IsArray, IsTypedArray, IsValueType } from '../guard/index.mjs';\nimport { ValuePointer } from '../pointer/index.mjs';\nimport { Clone } from '../clone/index.mjs';\nimport { TypeBoxError } from '../../type/error/index.mjs';\n// ------------------------------------------------------------------\n// Errors\n// ------------------------------------------------------------------\nexport class ValueMutateError extends TypeBoxError {\n    constructor(message) {\n        super(message);\n    }\n}\nfunction ObjectType(root, path, current, next) {\n    if (!IsObject(current)) {\n        ValuePointer.Set(root, path, Clone(next));\n    }\n    else {\n        const currentKeys = Object.getOwnPropertyNames(current);\n        const nextKeys = Object.getOwnPropertyNames(next);\n        for (const currentKey of currentKeys) {\n            if (!nextKeys.includes(currentKey)) {\n                delete current[currentKey];\n            }\n        }\n        for (const nextKey of nextKeys) {\n            if (!currentKeys.includes(nextKey)) {\n                current[nextKey] = null;\n            }\n        }\n        for (const nextKey of nextKeys) {\n            Visit(root, `${path}/${nextKey}`, current[nextKey], next[nextKey]);\n        }\n    }\n}\nfunction ArrayType(root, path, current, next) {\n    if (!IsArray(current)) {\n        ValuePointer.Set(root, path, Clone(next));\n    }\n    else {\n        for (let index = 0; index < next.length; index++) {\n            Visit(root, `${path}/${index}`, current[index], next[index]);\n        }\n        current.splice(next.length);\n    }\n}\nfunction TypedArrayType(root, path, current, next) {\n    if (IsTypedArray(current) && current.length === next.length) {\n        for (let i = 0; i < current.length; i++) {\n            current[i] = next[i];\n        }\n    }\n    else {\n        ValuePointer.Set(root, path, Clone(next));\n    }\n}\nfunction ValueType(root, path, current, next) {\n    if (current === next)\n        return;\n    ValuePointer.Set(root, path, next);\n}\nfunction Visit(root, path, current, next) {\n    if (IsArray(next))\n        return ArrayType(root, path, current, next);\n    if (IsTypedArray(next))\n        return TypedArrayType(root, path, current, next);\n    if (IsObject(next))\n        return ObjectType(root, path, current, next);\n    if (IsValueType(next))\n        return ValueType(root, path, current, next);\n}\n// ------------------------------------------------------------------\n// IsNonMutableValue\n// ------------------------------------------------------------------\nfunction IsNonMutableValue(value) {\n    return IsTypedArray(value) || IsValueType(value);\n}\nfunction IsMismatchedValue(current, next) {\n    // prettier-ignore\n    return ((IsObject(current) && IsArray(next)) ||\n        (IsArray(current) && IsObject(next)));\n}\n// ------------------------------------------------------------------\n// Mutate\n// ------------------------------------------------------------------\n/** `[Mutable]` Performs a deep mutable value assignment while retaining internal references */\nexport function Mutate(current, next) {\n    if (IsNonMutableValue(current) || IsNonMutableValue(next))\n        throw new ValueMutateError('Only object and array types can be mutated at the root level');\n    if (IsMismatchedValue(current, next))\n        throw new ValueMutateError('Cannot assign due type mismatch of assignable values');\n    Visit(current, '', current, next);\n}\n", "import { TransformDecode, HasTransform } from '../transform/index.mjs';\nimport { Assert } from '../assert/assert.mjs';\nimport { Default } from '../default/default.mjs';\nimport { Convert } from '../convert/convert.mjs';\nimport { Clean } from '../clean/clean.mjs';\nimport { Clone } from '../clone/index.mjs';\n// prettier-ignore\nconst ParseReducer = [\n    (_schema, _references, value) => Clone(value),\n    (schema, references, value) => Default(schema, references, value),\n    (schema, references, value) => Clean(schema, references, value),\n    (schema, references, value) => Convert(schema, references, value),\n    (schema, references, value) => { Assert(schema, references, value); return value; },\n    (schema, references, value) => (HasTransform(schema, references) ? TransformDecode(schema, references, value) : value),\n];\n// ------------------------------------------------------------------\n// ParseValue\n// ------------------------------------------------------------------\nfunction ParseValue(schema, references, value) {\n    return ParseReducer.reduce((value, reducer) => reducer(schema, references, value), value);\n}\n/** Parses a value or throws an `AssertError` if invalid. */\nexport function Parse(...args) {\n    return args.length === 3 ? ParseValue(args[0], args[1], args[2]) : ParseValue(args[0], [], args[1]);\n}\n", "export * as Value from './value.mjs';\n", "export { Errors, ValueErrorIterator } from '../../errors/index.mjs';\nexport { Assert } from '../assert/index.mjs';\nexport { Cast } from '../cast/index.mjs';\nexport { Check } from '../check/index.mjs';\nexport { Clean } from '../clean/index.mjs';\nexport { Clone } from '../clone/index.mjs';\nexport { Convert } from '../convert/index.mjs';\nexport { Create } from '../create/index.mjs';\nexport { Decode } from '../decode/index.mjs';\nexport { Default } from '../default/index.mjs';\nexport { Diff, Patch, Edit } from '../delta/index.mjs';\nexport { Encode } from '../encode/index.mjs';\nexport { Equal } from '../equal/index.mjs';\nexport { Hash } from '../hash/index.mjs';\nexport { Mutate } from '../mutate/index.mjs';\nexport { Parse } from '../parse/index.mjs';\n", "// DEFLATE is a complex format; to read this code, you should probably check the RFC first:\n// https://tools.ietf.org/html/rfc1951\n// You may also wish to take a look at the guide I made about this program:\n// https://gist.github.com/101arrowz/253f31eb5abc3d9275ab943003ffecad\n// Some of the following code is similar to that of UZIP.js:\n// https://github.com/photopea/UZIP.js\n// However, the vast majority of the codebase has diverged from UZIP.js to increase performance and reduce bundle size.\n// Sometimes 0 will appear where -1 would be more appropriate. This is because using a uint\n// is better for memory in most engines (I *think*).\nvar ch2 = {};\nvar wk = (function (c, id, msg, transfer, cb) {\n    var w = new Worker(ch2[id] || (ch2[id] = URL.createObjectURL(new Blob([\n        c + ';addEventListener(\"error\",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'\n    ], { type: 'text/javascript' }))));\n    w.onmessage = function (e) {\n        var d = e.data, ed = d.$e$;\n        if (ed) {\n            var err = new Error(ed[0]);\n            err['code'] = ed[1];\n            err.stack = ed[2];\n            cb(err, null);\n        }\n        else\n            cb(null, d);\n    };\n    w.postMessage(msg, transfer);\n    return w;\n});\n\n// aliases for shorter compressed code (most minifers don't do this)\nvar u8 = Uint8Array, u16 = Uint16Array, i32 = Int32Array;\n// fixed length extra bits\nvar fleb = new u8([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, /* unused */ 0, 0, /* impossible */ 0]);\n// fixed distance extra bits\nvar fdeb = new u8([0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, /* unused */ 0, 0]);\n// code length index map\nvar clim = new u8([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]);\n// get base, reverse index map from extra bits\nvar freb = function (eb, start) {\n    var b = new u16(31);\n    for (var i = 0; i < 31; ++i) {\n        b[i] = start += 1 << eb[i - 1];\n    }\n    // numbers here are at max 18 bits\n    var r = new i32(b[30]);\n    for (var i = 1; i < 30; ++i) {\n        for (var j = b[i]; j < b[i + 1]; ++j) {\n            r[j] = ((j - b[i]) << 5) | i;\n        }\n    }\n    return { b: b, r: r };\n};\nvar _a = freb(fleb, 2), fl = _a.b, revfl = _a.r;\n// we can ignore the fact that the other numbers are wrong; they never happen anyway\nfl[28] = 258, revfl[258] = 28;\nvar _b = freb(fdeb, 0), fd = _b.b, revfd = _b.r;\n// map of value to reverse (assuming 16 bits)\nvar rev = new u16(32768);\nfor (var i = 0; i < 32768; ++i) {\n    // reverse table algorithm from SO\n    var x = ((i & 0xAAAA) >> 1) | ((i & 0x5555) << 1);\n    x = ((x & 0xCCCC) >> 2) | ((x & 0x3333) << 2);\n    x = ((x & 0xF0F0) >> 4) | ((x & 0x0F0F) << 4);\n    rev[i] = (((x & 0xFF00) >> 8) | ((x & 0x00FF) << 8)) >> 1;\n}\n// create huffman tree from u8 \"map\": index -> code length for code index\n// mb (max bits) must be at most 15\n// TODO: optimize/split up?\nvar hMap = (function (cd, mb, r) {\n    var s = cd.length;\n    // index\n    var i = 0;\n    // u16 \"map\": index -> # of codes with bit length = index\n    var l = new u16(mb);\n    // length of cd must be 288 (total # of codes)\n    for (; i < s; ++i) {\n        if (cd[i])\n            ++l[cd[i] - 1];\n    }\n    // u16 \"map\": index -> minimum code for bit length = index\n    var le = new u16(mb);\n    for (i = 1; i < mb; ++i) {\n        le[i] = (le[i - 1] + l[i - 1]) << 1;\n    }\n    var co;\n    if (r) {\n        // u16 \"map\": index -> number of actual bits, symbol for code\n        co = new u16(1 << mb);\n        // bits to remove for reverser\n        var rvb = 15 - mb;\n        for (i = 0; i < s; ++i) {\n            // ignore 0 lengths\n            if (cd[i]) {\n                // num encoding both symbol and bits read\n                var sv = (i << 4) | cd[i];\n                // free bits\n                var r_1 = mb - cd[i];\n                // start value\n                var v = le[cd[i] - 1]++ << r_1;\n                // m is end value\n                for (var m = v | ((1 << r_1) - 1); v <= m; ++v) {\n                    // every 16 bit value starting with the code yields the same result\n                    co[rev[v] >> rvb] = sv;\n                }\n            }\n        }\n    }\n    else {\n        co = new u16(s);\n        for (i = 0; i < s; ++i) {\n            if (cd[i]) {\n                co[i] = rev[le[cd[i] - 1]++] >> (15 - cd[i]);\n            }\n        }\n    }\n    return co;\n});\n// fixed length tree\nvar flt = new u8(288);\nfor (var i = 0; i < 144; ++i)\n    flt[i] = 8;\nfor (var i = 144; i < 256; ++i)\n    flt[i] = 9;\nfor (var i = 256; i < 280; ++i)\n    flt[i] = 7;\nfor (var i = 280; i < 288; ++i)\n    flt[i] = 8;\n// fixed distance tree\nvar fdt = new u8(32);\nfor (var i = 0; i < 32; ++i)\n    fdt[i] = 5;\n// fixed length map\nvar flm = /*#__PURE__*/ hMap(flt, 9, 0), flrm = /*#__PURE__*/ hMap(flt, 9, 1);\n// fixed distance map\nvar fdm = /*#__PURE__*/ hMap(fdt, 5, 0), fdrm = /*#__PURE__*/ hMap(fdt, 5, 1);\n// find max of array\nvar max = function (a) {\n    var m = a[0];\n    for (var i = 1; i < a.length; ++i) {\n        if (a[i] > m)\n            m = a[i];\n    }\n    return m;\n};\n// read d, starting at bit p and mask with m\nvar bits = function (d, p, m) {\n    var o = (p / 8) | 0;\n    return ((d[o] | (d[o + 1] << 8)) >> (p & 7)) & m;\n};\n// read d, starting at bit p continuing for at least 16 bits\nvar bits16 = function (d, p) {\n    var o = (p / 8) | 0;\n    return ((d[o] | (d[o + 1] << 8) | (d[o + 2] << 16)) >> (p & 7));\n};\n// get end of byte\nvar shft = function (p) { return ((p + 7) / 8) | 0; };\n// typed array slice - allows garbage collector to free original reference,\n// while being more compatible than .slice\nvar slc = function (v, s, e) {\n    if (s == null || s < 0)\n        s = 0;\n    if (e == null || e > v.length)\n        e = v.length;\n    // can't use .constructor in case user-supplied\n    return new u8(v.subarray(s, e));\n};\n/**\n * Codes for errors generated within this library\n */\nexport var FlateErrorCode = {\n    UnexpectedEOF: 0,\n    InvalidBlockType: 1,\n    InvalidLengthLiteral: 2,\n    InvalidDistance: 3,\n    StreamFinished: 4,\n    NoStreamHandler: 5,\n    InvalidHeader: 6,\n    NoCallback: 7,\n    InvalidUTF8: 8,\n    ExtraFieldTooLong: 9,\n    InvalidDate: 10,\n    FilenameTooLong: 11,\n    StreamFinishing: 12,\n    InvalidZipData: 13,\n    UnknownCompressionMethod: 14\n};\n// error codes\nvar ec = [\n    'unexpected EOF',\n    'invalid block type',\n    'invalid length/literal',\n    'invalid distance',\n    'stream finished',\n    'no stream handler',\n    ,\n    'no callback',\n    'invalid UTF-8 data',\n    'extra field too long',\n    'date not in range 1980-2099',\n    'filename too long',\n    'stream finishing',\n    'invalid zip data'\n    // determined by unknown compression method\n];\n;\nvar err = function (ind, msg, nt) {\n    var e = new Error(msg || ec[ind]);\n    e.code = ind;\n    if (Error.captureStackTrace)\n        Error.captureStackTrace(e, err);\n    if (!nt)\n        throw e;\n    return e;\n};\n// expands raw DEFLATE data\nvar inflt = function (dat, st, buf, dict) {\n    // source length       dict length\n    var sl = dat.length, dl = dict ? dict.length : 0;\n    if (!sl || st.f && !st.l)\n        return buf || new u8(0);\n    var noBuf = !buf;\n    // have to estimate size\n    var resize = noBuf || st.i != 2;\n    // no state\n    var noSt = st.i;\n    // Assumes roughly 33% compression ratio average\n    if (noBuf)\n        buf = new u8(sl * 3);\n    // ensure buffer can fit at least l elements\n    var cbuf = function (l) {\n        var bl = buf.length;\n        // need to increase size to fit\n        if (l > bl) {\n            // Double or set to necessary, whichever is greater\n            var nbuf = new u8(Math.max(bl * 2, l));\n            nbuf.set(buf);\n            buf = nbuf;\n        }\n    };\n    //  last chunk         bitpos           bytes\n    var final = st.f || 0, pos = st.p || 0, bt = st.b || 0, lm = st.l, dm = st.d, lbt = st.m, dbt = st.n;\n    // total bits\n    var tbts = sl * 8;\n    do {\n        if (!lm) {\n            // BFINAL - this is only 1 when last chunk is next\n            final = bits(dat, pos, 1);\n            // type: 0 = no compression, 1 = fixed huffman, 2 = dynamic huffman\n            var type = bits(dat, pos + 1, 3);\n            pos += 3;\n            if (!type) {\n                // go to end of byte boundary\n                var s = shft(pos) + 4, l = dat[s - 4] | (dat[s - 3] << 8), t = s + l;\n                if (t > sl) {\n                    if (noSt)\n                        err(0);\n                    break;\n                }\n                // ensure size\n                if (resize)\n                    cbuf(bt + l);\n                // Copy over uncompressed data\n                buf.set(dat.subarray(s, t), bt);\n                // Get new bitpos, update byte count\n                st.b = bt += l, st.p = pos = t * 8, st.f = final;\n                continue;\n            }\n            else if (type == 1)\n                lm = flrm, dm = fdrm, lbt = 9, dbt = 5;\n            else if (type == 2) {\n                //  literal                            lengths\n                var hLit = bits(dat, pos, 31) + 257, hcLen = bits(dat, pos + 10, 15) + 4;\n                var tl = hLit + bits(dat, pos + 5, 31) + 1;\n                pos += 14;\n                // length+distance tree\n                var ldt = new u8(tl);\n                // code length tree\n                var clt = new u8(19);\n                for (var i = 0; i < hcLen; ++i) {\n                    // use index map to get real code\n                    clt[clim[i]] = bits(dat, pos + i * 3, 7);\n                }\n                pos += hcLen * 3;\n                // code lengths bits\n                var clb = max(clt), clbmsk = (1 << clb) - 1;\n                // code lengths map\n                var clm = hMap(clt, clb, 1);\n                for (var i = 0; i < tl;) {\n                    var r = clm[bits(dat, pos, clbmsk)];\n                    // bits read\n                    pos += r & 15;\n                    // symbol\n                    var s = r >> 4;\n                    // code length to copy\n                    if (s < 16) {\n                        ldt[i++] = s;\n                    }\n                    else {\n                        //  copy   count\n                        var c = 0, n = 0;\n                        if (s == 16)\n                            n = 3 + bits(dat, pos, 3), pos += 2, c = ldt[i - 1];\n                        else if (s == 17)\n                            n = 3 + bits(dat, pos, 7), pos += 3;\n                        else if (s == 18)\n                            n = 11 + bits(dat, pos, 127), pos += 7;\n                        while (n--)\n                            ldt[i++] = c;\n                    }\n                }\n                //    length tree                 distance tree\n                var lt = ldt.subarray(0, hLit), dt = ldt.subarray(hLit);\n                // max length bits\n                lbt = max(lt);\n                // max dist bits\n                dbt = max(dt);\n                lm = hMap(lt, lbt, 1);\n                dm = hMap(dt, dbt, 1);\n            }\n            else\n                err(1);\n            if (pos > tbts) {\n                if (noSt)\n                    err(0);\n                break;\n            }\n        }\n        // Make sure the buffer can hold this + the largest possible addition\n        // Maximum chunk size (practically, theoretically infinite) is 2^17\n        if (resize)\n            cbuf(bt + 131072);\n        var lms = (1 << lbt) - 1, dms = (1 << dbt) - 1;\n        var lpos = pos;\n        for (;; lpos = pos) {\n            // bits read, code\n            var c = lm[bits16(dat, pos) & lms], sym = c >> 4;\n            pos += c & 15;\n            if (pos > tbts) {\n                if (noSt)\n                    err(0);\n                break;\n            }\n            if (!c)\n                err(2);\n            if (sym < 256)\n                buf[bt++] = sym;\n            else if (sym == 256) {\n                lpos = pos, lm = null;\n                break;\n            }\n            else {\n                var add = sym - 254;\n                // no extra bits needed if less\n                if (sym > 264) {\n                    // index\n                    var i = sym - 257, b = fleb[i];\n                    add = bits(dat, pos, (1 << b) - 1) + fl[i];\n                    pos += b;\n                }\n                // dist\n                var d = dm[bits16(dat, pos) & dms], dsym = d >> 4;\n                if (!d)\n                    err(3);\n                pos += d & 15;\n                var dt = fd[dsym];\n                if (dsym > 3) {\n                    var b = fdeb[dsym];\n                    dt += bits16(dat, pos) & (1 << b) - 1, pos += b;\n                }\n                if (pos > tbts) {\n                    if (noSt)\n                        err(0);\n                    break;\n                }\n                if (resize)\n                    cbuf(bt + 131072);\n                var end = bt + add;\n                if (bt < dt) {\n                    var shift = dl - dt, dend = Math.min(dt, end);\n                    if (shift + bt < 0)\n                        err(3);\n                    for (; bt < dend; ++bt)\n                        buf[bt] = dict[shift + bt];\n                }\n                for (; bt < end; ++bt)\n                    buf[bt] = buf[bt - dt];\n            }\n        }\n        st.l = lm, st.p = lpos, st.b = bt, st.f = final;\n        if (lm)\n            final = 1, st.m = lbt, st.d = dm, st.n = dbt;\n    } while (!final);\n    // don't reallocate for streams or user buffers\n    return bt != buf.length && noBuf ? slc(buf, 0, bt) : buf.subarray(0, bt);\n};\n// starting at p, write the minimum number of bits that can hold v to d\nvar wbits = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) | 0;\n    d[o] |= v;\n    d[o + 1] |= v >> 8;\n};\n// starting at p, write the minimum number of bits (>8) that can hold v to d\nvar wbits16 = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) | 0;\n    d[o] |= v;\n    d[o + 1] |= v >> 8;\n    d[o + 2] |= v >> 16;\n};\n// creates code lengths from a frequency table\nvar hTree = function (d, mb) {\n    // Need extra info to make a tree\n    var t = [];\n    for (var i = 0; i < d.length; ++i) {\n        if (d[i])\n            t.push({ s: i, f: d[i] });\n    }\n    var s = t.length;\n    var t2 = t.slice();\n    if (!s)\n        return { t: et, l: 0 };\n    if (s == 1) {\n        var v = new u8(t[0].s + 1);\n        v[t[0].s] = 1;\n        return { t: v, l: 1 };\n    }\n    t.sort(function (a, b) { return a.f - b.f; });\n    // after i2 reaches last ind, will be stopped\n    // freq must be greater than largest possible number of symbols\n    t.push({ s: -1, f: 25001 });\n    var l = t[0], r = t[1], i0 = 0, i1 = 1, i2 = 2;\n    t[0] = { s: -1, f: l.f + r.f, l: l, r: r };\n    // efficient algorithm from UZIP.js\n    // i0 is lookbehind, i2 is lookahead - after processing two low-freq\n    // symbols that combined have high freq, will start processing i2 (high-freq,\n    // non-composite) symbols instead\n    // see https://reddit.com/r/photopea/comments/ikekht/uzipjs_questions/\n    while (i1 != s - 1) {\n        l = t[t[i0].f < t[i2].f ? i0++ : i2++];\n        r = t[i0 != i1 && t[i0].f < t[i2].f ? i0++ : i2++];\n        t[i1++] = { s: -1, f: l.f + r.f, l: l, r: r };\n    }\n    var maxSym = t2[0].s;\n    for (var i = 1; i < s; ++i) {\n        if (t2[i].s > maxSym)\n            maxSym = t2[i].s;\n    }\n    // code lengths\n    var tr = new u16(maxSym + 1);\n    // max bits in tree\n    var mbt = ln(t[i1 - 1], tr, 0);\n    if (mbt > mb) {\n        // more algorithms from UZIP.js\n        // TODO: find out how this code works (debt)\n        //  ind    debt\n        var i = 0, dt = 0;\n        //    left            cost\n        var lft = mbt - mb, cst = 1 << lft;\n        t2.sort(function (a, b) { return tr[b.s] - tr[a.s] || a.f - b.f; });\n        for (; i < s; ++i) {\n            var i2_1 = t2[i].s;\n            if (tr[i2_1] > mb) {\n                dt += cst - (1 << (mbt - tr[i2_1]));\n                tr[i2_1] = mb;\n            }\n            else\n                break;\n        }\n        dt >>= lft;\n        while (dt > 0) {\n            var i2_2 = t2[i].s;\n            if (tr[i2_2] < mb)\n                dt -= 1 << (mb - tr[i2_2]++ - 1);\n            else\n                ++i;\n        }\n        for (; i >= 0 && dt; --i) {\n            var i2_3 = t2[i].s;\n            if (tr[i2_3] == mb) {\n                --tr[i2_3];\n                ++dt;\n            }\n        }\n        mbt = mb;\n    }\n    return { t: new u8(tr), l: mbt };\n};\n// get the max length and assign length codes\nvar ln = function (n, l, d) {\n    return n.s == -1\n        ? Math.max(ln(n.l, l, d + 1), ln(n.r, l, d + 1))\n        : (l[n.s] = d);\n};\n// length codes generation\nvar lc = function (c) {\n    var s = c.length;\n    // Note that the semicolon was intentional\n    while (s && !c[--s])\n        ;\n    var cl = new u16(++s);\n    //  ind      num         streak\n    var cli = 0, cln = c[0], cls = 1;\n    var w = function (v) { cl[cli++] = v; };\n    for (var i = 1; i <= s; ++i) {\n        if (c[i] == cln && i != s)\n            ++cls;\n        else {\n            if (!cln && cls > 2) {\n                for (; cls > 138; cls -= 138)\n                    w(32754);\n                if (cls > 2) {\n                    w(cls > 10 ? ((cls - 11) << 5) | 28690 : ((cls - 3) << 5) | 12305);\n                    cls = 0;\n                }\n            }\n            else if (cls > 3) {\n                w(cln), --cls;\n                for (; cls > 6; cls -= 6)\n                    w(8304);\n                if (cls > 2)\n                    w(((cls - 3) << 5) | 8208), cls = 0;\n            }\n            while (cls--)\n                w(cln);\n            cls = 1;\n            cln = c[i];\n        }\n    }\n    return { c: cl.subarray(0, cli), n: s };\n};\n// calculate the length of output from tree, code lengths\nvar clen = function (cf, cl) {\n    var l = 0;\n    for (var i = 0; i < cl.length; ++i)\n        l += cf[i] * cl[i];\n    return l;\n};\n// writes a fixed block\n// returns the new bit pos\nvar wfblk = function (out, pos, dat) {\n    // no need to write 00 as type: TypedArray defaults to 0\n    var s = dat.length;\n    var o = shft(pos + 2);\n    out[o] = s & 255;\n    out[o + 1] = s >> 8;\n    out[o + 2] = out[o] ^ 255;\n    out[o + 3] = out[o + 1] ^ 255;\n    for (var i = 0; i < s; ++i)\n        out[o + i + 4] = dat[i];\n    return (o + 4 + s) * 8;\n};\n// writes a block\nvar wblk = function (dat, out, final, syms, lf, df, eb, li, bs, bl, p) {\n    wbits(out, p++, final);\n    ++lf[256];\n    var _a = hTree(lf, 15), dlt = _a.t, mlb = _a.l;\n    var _b = hTree(df, 15), ddt = _b.t, mdb = _b.l;\n    var _c = lc(dlt), lclt = _c.c, nlc = _c.n;\n    var _d = lc(ddt), lcdt = _d.c, ndc = _d.n;\n    var lcfreq = new u16(19);\n    for (var i = 0; i < lclt.length; ++i)\n        ++lcfreq[lclt[i] & 31];\n    for (var i = 0; i < lcdt.length; ++i)\n        ++lcfreq[lcdt[i] & 31];\n    var _e = hTree(lcfreq, 7), lct = _e.t, mlcb = _e.l;\n    var nlcc = 19;\n    for (; nlcc > 4 && !lct[clim[nlcc - 1]]; --nlcc)\n        ;\n    var flen = (bl + 5) << 3;\n    var ftlen = clen(lf, flt) + clen(df, fdt) + eb;\n    var dtlen = clen(lf, dlt) + clen(df, ddt) + eb + 14 + 3 * nlcc + clen(lcfreq, lct) + 2 * lcfreq[16] + 3 * lcfreq[17] + 7 * lcfreq[18];\n    if (bs >= 0 && flen <= ftlen && flen <= dtlen)\n        return wfblk(out, p, dat.subarray(bs, bs + bl));\n    var lm, ll, dm, dl;\n    wbits(out, p, 1 + (dtlen < ftlen)), p += 2;\n    if (dtlen < ftlen) {\n        lm = hMap(dlt, mlb, 0), ll = dlt, dm = hMap(ddt, mdb, 0), dl = ddt;\n        var llm = hMap(lct, mlcb, 0);\n        wbits(out, p, nlc - 257);\n        wbits(out, p + 5, ndc - 1);\n        wbits(out, p + 10, nlcc - 4);\n        p += 14;\n        for (var i = 0; i < nlcc; ++i)\n            wbits(out, p + 3 * i, lct[clim[i]]);\n        p += 3 * nlcc;\n        var lcts = [lclt, lcdt];\n        for (var it = 0; it < 2; ++it) {\n            var clct = lcts[it];\n            for (var i = 0; i < clct.length; ++i) {\n                var len = clct[i] & 31;\n                wbits(out, p, llm[len]), p += lct[len];\n                if (len > 15)\n                    wbits(out, p, (clct[i] >> 5) & 127), p += clct[i] >> 12;\n            }\n        }\n    }\n    else {\n        lm = flm, ll = flt, dm = fdm, dl = fdt;\n    }\n    for (var i = 0; i < li; ++i) {\n        var sym = syms[i];\n        if (sym > 255) {\n            var len = (sym >> 18) & 31;\n            wbits16(out, p, lm[len + 257]), p += ll[len + 257];\n            if (len > 7)\n                wbits(out, p, (sym >> 23) & 31), p += fleb[len];\n            var dst = sym & 31;\n            wbits16(out, p, dm[dst]), p += dl[dst];\n            if (dst > 3)\n                wbits16(out, p, (sym >> 5) & 8191), p += fdeb[dst];\n        }\n        else {\n            wbits16(out, p, lm[sym]), p += ll[sym];\n        }\n    }\n    wbits16(out, p, lm[256]);\n    return p + ll[256];\n};\n// deflate options (nice << 13) | chain\nvar deo = /*#__PURE__*/ new i32([65540, 131080, 131088, 131104, 262176, 1048704, 1048832, 2114560, 2117632]);\n// empty\nvar et = /*#__PURE__*/ new u8(0);\n// compresses data into a raw DEFLATE buffer\nvar dflt = function (dat, lvl, plvl, pre, post, st) {\n    var s = st.z || dat.length;\n    var o = new u8(pre + s + 5 * (1 + Math.ceil(s / 7000)) + post);\n    // writing to this writes to the output buffer\n    var w = o.subarray(pre, o.length - post);\n    var lst = st.l;\n    var pos = (st.r || 0) & 7;\n    if (lvl) {\n        if (pos)\n            w[0] = st.r >> 3;\n        var opt = deo[lvl - 1];\n        var n = opt >> 13, c = opt & 8191;\n        var msk_1 = (1 << plvl) - 1;\n        //    prev 2-byte val map    curr 2-byte val map\n        var prev = st.p || new u16(32768), head = st.h || new u16(msk_1 + 1);\n        var bs1_1 = Math.ceil(plvl / 3), bs2_1 = 2 * bs1_1;\n        var hsh = function (i) { return (dat[i] ^ (dat[i + 1] << bs1_1) ^ (dat[i + 2] << bs2_1)) & msk_1; };\n        // 24576 is an arbitrary number of maximum symbols per block\n        // 424 buffer for last block\n        var syms = new i32(25000);\n        // length/literal freq   distance freq\n        var lf = new u16(288), df = new u16(32);\n        //  l/lcnt  exbits  index          l/lind  waitdx          blkpos\n        var lc_1 = 0, eb = 0, i = st.i || 0, li = 0, wi = st.w || 0, bs = 0;\n        for (; i + 2 < s; ++i) {\n            // hash value\n            var hv = hsh(i);\n            // index mod 32768    previous index mod\n            var imod = i & 32767, pimod = head[hv];\n            prev[imod] = pimod;\n            head[hv] = imod;\n            // We always should modify head and prev, but only add symbols if\n            // this data is not yet processed (\"wait\" for wait index)\n            if (wi <= i) {\n                // bytes remaining\n                var rem = s - i;\n                if ((lc_1 > 7000 || li > 24576) && (rem > 423 || !lst)) {\n                    pos = wblk(dat, w, 0, syms, lf, df, eb, li, bs, i - bs, pos);\n                    li = lc_1 = eb = 0, bs = i;\n                    for (var j = 0; j < 286; ++j)\n                        lf[j] = 0;\n                    for (var j = 0; j < 30; ++j)\n                        df[j] = 0;\n                }\n                //  len    dist   chain\n                var l = 2, d = 0, ch_1 = c, dif = imod - pimod & 32767;\n                if (rem > 2 && hv == hsh(i - dif)) {\n                    var maxn = Math.min(n, rem) - 1;\n                    var maxd = Math.min(32767, i);\n                    // max possible length\n                    // not capped at dif because decompressors implement \"rolling\" index population\n                    var ml = Math.min(258, rem);\n                    while (dif <= maxd && --ch_1 && imod != pimod) {\n                        if (dat[i + l] == dat[i + l - dif]) {\n                            var nl = 0;\n                            for (; nl < ml && dat[i + nl] == dat[i + nl - dif]; ++nl)\n                                ;\n                            if (nl > l) {\n                                l = nl, d = dif;\n                                // break out early when we reach \"nice\" (we are satisfied enough)\n                                if (nl > maxn)\n                                    break;\n                                // now, find the rarest 2-byte sequence within this\n                                // length of literals and search for that instead.\n                                // Much faster than just using the start\n                                var mmd = Math.min(dif, nl - 2);\n                                var md = 0;\n                                for (var j = 0; j < mmd; ++j) {\n                                    var ti = i - dif + j & 32767;\n                                    var pti = prev[ti];\n                                    var cd = ti - pti & 32767;\n                                    if (cd > md)\n                                        md = cd, pimod = ti;\n                                }\n                            }\n                        }\n                        // check the previous match\n                        imod = pimod, pimod = prev[imod];\n                        dif += imod - pimod & 32767;\n                    }\n                }\n                // d will be nonzero only when a match was found\n                if (d) {\n                    // store both dist and len data in one int32\n                    // Make sure this is recognized as a len/dist with 28th bit (2^28)\n                    syms[li++] = 268435456 | (revfl[l] << 18) | revfd[d];\n                    var lin = revfl[l] & 31, din = revfd[d] & 31;\n                    eb += fleb[lin] + fdeb[din];\n                    ++lf[257 + lin];\n                    ++df[din];\n                    wi = i + l;\n                    ++lc_1;\n                }\n                else {\n                    syms[li++] = dat[i];\n                    ++lf[dat[i]];\n                }\n            }\n        }\n        for (i = Math.max(i, wi); i < s; ++i) {\n            syms[li++] = dat[i];\n            ++lf[dat[i]];\n        }\n        pos = wblk(dat, w, lst, syms, lf, df, eb, li, bs, i - bs, pos);\n        if (!lst) {\n            st.r = (pos & 7) | w[(pos / 8) | 0] << 3;\n            // shft(pos) now 1 less if pos & 7 != 0\n            pos -= 7;\n            st.h = head, st.p = prev, st.i = i, st.w = wi;\n        }\n    }\n    else {\n        for (var i = st.w || 0; i < s + lst; i += 65535) {\n            // end\n            var e = i + 65535;\n            if (e >= s) {\n                // write final block\n                w[(pos / 8) | 0] = lst;\n                e = s;\n            }\n            pos = wfblk(w, pos + 1, dat.subarray(i, e));\n        }\n        st.i = s;\n    }\n    return slc(o, 0, pre + shft(pos) + post);\n};\n// CRC32 table\nvar crct = /*#__PURE__*/ (function () {\n    var t = new Int32Array(256);\n    for (var i = 0; i < 256; ++i) {\n        var c = i, k = 9;\n        while (--k)\n            c = ((c & 1) && -306674912) ^ (c >>> 1);\n        t[i] = c;\n    }\n    return t;\n})();\n// CRC32\nvar crc = function () {\n    var c = -1;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var cr = c;\n            for (var i = 0; i < d.length; ++i)\n                cr = crct[(cr & 255) ^ d[i]] ^ (cr >>> 8);\n            c = cr;\n        },\n        d: function () { return ~c; }\n    };\n};\n// Adler32\nvar adler = function () {\n    var a = 1, b = 0;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var n = a, m = b;\n            var l = d.length | 0;\n            for (var i = 0; i != l;) {\n                var e = Math.min(i + 2655, l);\n                for (; i < e; ++i)\n                    m += n += d[i];\n                n = (n & 65535) + 15 * (n >> 16), m = (m & 65535) + 15 * (m >> 16);\n            }\n            a = n, b = m;\n        },\n        d: function () {\n            a %= 65521, b %= 65521;\n            return (a & 255) << 24 | (a & 0xFF00) << 8 | (b & 255) << 8 | (b >> 8);\n        }\n    };\n};\n;\n// deflate with opts\nvar dopt = function (dat, opt, pre, post, st) {\n    if (!st) {\n        st = { l: 1 };\n        if (opt.dictionary) {\n            var dict = opt.dictionary.subarray(-32768);\n            var newDat = new u8(dict.length + dat.length);\n            newDat.set(dict);\n            newDat.set(dat, dict.length);\n            dat = newDat;\n            st.w = dict.length;\n        }\n    }\n    return dflt(dat, opt.level == null ? 6 : opt.level, opt.mem == null ? (st.l ? Math.ceil(Math.max(8, Math.min(13, Math.log(dat.length))) * 1.5) : 20) : (12 + opt.mem), pre, post, st);\n};\n// Walmart object spread\nvar mrg = function (a, b) {\n    var o = {};\n    for (var k in a)\n        o[k] = a[k];\n    for (var k in b)\n        o[k] = b[k];\n    return o;\n};\n// worker clone\n// This is possibly the craziest part of the entire codebase, despite how simple it may seem.\n// The only parameter to this function is a closure that returns an array of variables outside of the function scope.\n// We're going to try to figure out the variable names used in the closure as strings because that is crucial for workerization.\n// We will return an object mapping of true variable name to value (basically, the current scope as a JS object).\n// The reason we can't just use the original variable names is minifiers mangling the toplevel scope.\n// This took me three weeks to figure out how to do.\nvar wcln = function (fn, fnStr, td) {\n    var dt = fn();\n    var st = fn.toString();\n    var ks = st.slice(st.indexOf('[') + 1, st.lastIndexOf(']')).replace(/\\s+/g, '').split(',');\n    for (var i = 0; i < dt.length; ++i) {\n        var v = dt[i], k = ks[i];\n        if (typeof v == 'function') {\n            fnStr += ';' + k + '=';\n            var st_1 = v.toString();\n            if (v.prototype) {\n                // for global objects\n                if (st_1.indexOf('[native code]') != -1) {\n                    var spInd = st_1.indexOf(' ', 8) + 1;\n                    fnStr += st_1.slice(spInd, st_1.indexOf('(', spInd));\n                }\n                else {\n                    fnStr += st_1;\n                    for (var t in v.prototype)\n                        fnStr += ';' + k + '.prototype.' + t + '=' + v.prototype[t].toString();\n                }\n            }\n            else\n                fnStr += st_1;\n        }\n        else\n            td[k] = v;\n    }\n    return fnStr;\n};\nvar ch = [];\n// clone bufs\nvar cbfs = function (v) {\n    var tl = [];\n    for (var k in v) {\n        if (v[k].buffer) {\n            tl.push((v[k] = new v[k].constructor(v[k])).buffer);\n        }\n    }\n    return tl;\n};\n// use a worker to execute code\nvar wrkr = function (fns, init, id, cb) {\n    if (!ch[id]) {\n        var fnStr = '', td_1 = {}, m = fns.length - 1;\n        for (var i = 0; i < m; ++i)\n            fnStr = wcln(fns[i], fnStr, td_1);\n        ch[id] = { c: wcln(fns[m], fnStr, td_1), e: td_1 };\n    }\n    var td = mrg({}, ch[id].e);\n    return wk(ch[id].c + ';onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage=' + init.toString() + '}', id, td, cbfs(td), cb);\n};\n// base async inflate fn\nvar bInflt = function () { return [u8, u16, i32, fleb, fdeb, clim, fl, fd, flrm, fdrm, rev, ec, hMap, max, bits, bits16, shft, slc, err, inflt, inflateSync, pbf, gopt]; };\nvar bDflt = function () { return [u8, u16, i32, fleb, fdeb, clim, revfl, revfd, flm, flt, fdm, fdt, rev, deo, et, hMap, wbits, wbits16, hTree, ln, lc, clen, wfblk, wblk, shft, slc, dflt, dopt, deflateSync, pbf]; };\n// gzip extra\nvar gze = function () { return [gzh, gzhl, wbytes, crc, crct]; };\n// gunzip extra\nvar guze = function () { return [gzs, gzl]; };\n// zlib extra\nvar zle = function () { return [zlh, wbytes, adler]; };\n// unzlib extra\nvar zule = function () { return [zls]; };\n// post buf\nvar pbf = function (msg) { return postMessage(msg, [msg.buffer]); };\n// get opts\nvar gopt = function (o) { return o && {\n    out: o.size && new u8(o.size),\n    dictionary: o.dictionary\n}; };\n// async helper\nvar cbify = function (dat, opts, fns, init, id, cb) {\n    var w = wrkr(fns, init, id, function (err, dat) {\n        w.terminate();\n        cb(err, dat);\n    });\n    w.postMessage([dat, opts], opts.consume ? [dat.buffer] : []);\n    return function () { w.terminate(); };\n};\n// auto stream\nvar astrm = function (strm) {\n    strm.ondata = function (dat, final) { return postMessage([dat, final], [dat.buffer]); };\n    return function (ev) {\n        if (ev.data.length) {\n            strm.push(ev.data[0], ev.data[1]);\n            postMessage([ev.data[0].length]);\n        }\n        else\n            strm.flush();\n    };\n};\n// async stream attach\nvar astrmify = function (fns, strm, opts, init, id, flush, ext) {\n    var t;\n    var w = wrkr(fns, init, id, function (err, dat) {\n        if (err)\n            w.terminate(), strm.ondata.call(strm, err);\n        else if (!Array.isArray(dat))\n            ext(dat);\n        else if (dat.length == 1) {\n            strm.queuedSize -= dat[0];\n            if (strm.ondrain)\n                strm.ondrain(dat[0]);\n        }\n        else {\n            if (dat[1])\n                w.terminate();\n            strm.ondata.call(strm, err, dat[0], dat[1]);\n        }\n    });\n    w.postMessage(opts);\n    strm.queuedSize = 0;\n    strm.push = function (d, f) {\n        if (!strm.ondata)\n            err(5);\n        if (t)\n            strm.ondata(err(4, 0, 1), null, !!f);\n        strm.queuedSize += d.length;\n        w.postMessage([d, t = f], [d.buffer]);\n    };\n    strm.terminate = function () { w.terminate(); };\n    if (flush) {\n        strm.flush = function () { w.postMessage([]); };\n    }\n};\n// read 2 bytes\nvar b2 = function (d, b) { return d[b] | (d[b + 1] << 8); };\n// read 4 bytes\nvar b4 = function (d, b) { return (d[b] | (d[b + 1] << 8) | (d[b + 2] << 16) | (d[b + 3] << 24)) >>> 0; };\nvar b8 = function (d, b) { return b4(d, b) + (b4(d, b + 4) * 4294967296); };\n// write bytes\nvar wbytes = function (d, b, v) {\n    for (; v; ++b)\n        d[b] = v, v >>>= 8;\n};\n// gzip header\nvar gzh = function (c, o) {\n    var fn = o.filename;\n    c[0] = 31, c[1] = 139, c[2] = 8, c[8] = o.level < 2 ? 4 : o.level == 9 ? 2 : 0, c[9] = 3; // assume Unix\n    if (o.mtime != 0)\n        wbytes(c, 4, Math.floor(new Date(o.mtime || Date.now()) / 1000));\n    if (fn) {\n        c[3] = 8;\n        for (var i = 0; i <= fn.length; ++i)\n            c[i + 10] = fn.charCodeAt(i);\n    }\n};\n// gzip footer: -8 to -4 = CRC, -4 to -0 is length\n// gzip start\nvar gzs = function (d) {\n    if (d[0] != 31 || d[1] != 139 || d[2] != 8)\n        err(6, 'invalid gzip data');\n    var flg = d[3];\n    var st = 10;\n    if (flg & 4)\n        st += (d[10] | d[11] << 8) + 2;\n    for (var zs = (flg >> 3 & 1) + (flg >> 4 & 1); zs > 0; zs -= !d[st++])\n        ;\n    return st + (flg & 2);\n};\n// gzip length\nvar gzl = function (d) {\n    var l = d.length;\n    return (d[l - 4] | d[l - 3] << 8 | d[l - 2] << 16 | d[l - 1] << 24) >>> 0;\n};\n// gzip header length\nvar gzhl = function (o) { return 10 + (o.filename ? o.filename.length + 1 : 0); };\n// zlib header\nvar zlh = function (c, o) {\n    var lv = o.level, fl = lv == 0 ? 0 : lv < 6 ? 1 : lv == 9 ? 3 : 2;\n    c[0] = 120, c[1] = (fl << 6) | (o.dictionary && 32);\n    c[1] |= 31 - ((c[0] << 8) | c[1]) % 31;\n    if (o.dictionary) {\n        var h = adler();\n        h.p(o.dictionary);\n        wbytes(c, 2, h.d());\n    }\n};\n// zlib start\nvar zls = function (d, dict) {\n    if ((d[0] & 15) != 8 || (d[0] >> 4) > 7 || ((d[0] << 8 | d[1]) % 31))\n        err(6, 'invalid zlib data');\n    if ((d[1] >> 5 & 1) == +!dict)\n        err(6, 'invalid zlib data: ' + (d[1] & 32 ? 'need' : 'unexpected') + ' dictionary');\n    return (d[1] >> 3 & 4) + 2;\n};\nfunction StrmOpt(opts, cb) {\n    if (typeof opts == 'function')\n        cb = opts, opts = {};\n    this.ondata = cb;\n    return opts;\n}\n/**\n * Streaming DEFLATE compression\n */\nvar Deflate = /*#__PURE__*/ (function () {\n    function Deflate(opts, cb) {\n        if (typeof opts == 'function')\n            cb = opts, opts = {};\n        this.ondata = cb;\n        this.o = opts || {};\n        this.s = { l: 0, i: 32768, w: 32768, z: 32768 };\n        // Buffer length must always be 0 mod 32768 for index calculations to be correct when modifying head and prev\n        // 98304 = 32768 (lookback) + 65536 (common chunk size)\n        this.b = new u8(98304);\n        if (this.o.dictionary) {\n            var dict = this.o.dictionary.subarray(-32768);\n            this.b.set(dict, 32768 - dict.length);\n            this.s.i = 32768 - dict.length;\n        }\n    }\n    Deflate.prototype.p = function (c, f) {\n        this.ondata(dopt(c, this.o, 0, 0, this.s), f);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Deflate.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (this.s.l)\n            err(4);\n        var endLen = chunk.length + this.s.z;\n        if (endLen > this.b.length) {\n            if (endLen > 2 * this.b.length - 32768) {\n                var newBuf = new u8(endLen & -32768);\n                newBuf.set(this.b.subarray(0, this.s.z));\n                this.b = newBuf;\n            }\n            var split = this.b.length - this.s.z;\n            this.b.set(chunk.subarray(0, split), this.s.z);\n            this.s.z = this.b.length;\n            this.p(this.b, false);\n            this.b.set(this.b.subarray(-32768));\n            this.b.set(chunk.subarray(split), 32768);\n            this.s.z = chunk.length - split + 32768;\n            this.s.i = 32766, this.s.w = 32768;\n        }\n        else {\n            this.b.set(chunk, this.s.z);\n            this.s.z += chunk.length;\n        }\n        this.s.l = final & 1;\n        if (this.s.z > this.s.w + 8191 || final) {\n            this.p(this.b, final || false);\n            this.s.w = this.s.i, this.s.i -= 2;\n        }\n    };\n    /**\n     * Flushes buffered uncompressed data. Useful to immediately retrieve the\n     * deflated output for small inputs.\n     */\n    Deflate.prototype.flush = function () {\n        if (!this.ondata)\n            err(5);\n        if (this.s.l)\n            err(4);\n        this.p(this.b, false);\n        this.s.w = this.s.i, this.s.i -= 2;\n    };\n    return Deflate;\n}());\nexport { Deflate };\n/**\n * Asynchronous streaming DEFLATE compression\n */\nvar AsyncDeflate = /*#__PURE__*/ (function () {\n    function AsyncDeflate(opts, cb) {\n        astrmify([\n            bDflt,\n            function () { return [astrm, Deflate]; }\n        ], this, StrmOpt.call(this, opts, cb), function (ev) {\n            var strm = new Deflate(ev.data);\n            onmessage = astrm(strm);\n        }, 6, 1);\n    }\n    return AsyncDeflate;\n}());\nexport { AsyncDeflate };\nexport function deflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n    ], function (ev) { return pbf(deflateSync(ev.data[0], ev.data[1])); }, 0, cb);\n}\n/**\n * Compresses data with DEFLATE without any wrapper\n * @param data The data to compress\n * @param opts The compression options\n * @returns The deflated version of the data\n */\nexport function deflateSync(data, opts) {\n    return dopt(data, opts || {}, 0, 0);\n}\n/**\n * Streaming DEFLATE decompression\n */\nvar Inflate = /*#__PURE__*/ (function () {\n    function Inflate(opts, cb) {\n        // no StrmOpt here to avoid adding to workerizer\n        if (typeof opts == 'function')\n            cb = opts, opts = {};\n        this.ondata = cb;\n        var dict = opts && opts.dictionary && opts.dictionary.subarray(-32768);\n        this.s = { i: 0, b: dict ? dict.length : 0 };\n        this.o = new u8(32768);\n        this.p = new u8(0);\n        if (dict)\n            this.o.set(dict);\n    }\n    Inflate.prototype.e = function (c) {\n        if (!this.ondata)\n            err(5);\n        if (this.d)\n            err(4);\n        if (!this.p.length)\n            this.p = c;\n        else if (c.length) {\n            var n = new u8(this.p.length + c.length);\n            n.set(this.p), n.set(c, this.p.length), this.p = n;\n        }\n    };\n    Inflate.prototype.c = function (final) {\n        this.s.i = +(this.d = final || false);\n        var bts = this.s.b;\n        var dt = inflt(this.p, this.s, this.o);\n        this.ondata(slc(dt, bts, this.s.b), this.d);\n        this.o = slc(dt, this.s.b - 32768), this.s.b = this.o.length;\n        this.p = slc(this.p, (this.s.p / 8) | 0), this.s.p &= 7;\n    };\n    /**\n     * Pushes a chunk to be inflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the final chunk\n     */\n    Inflate.prototype.push = function (chunk, final) {\n        this.e(chunk), this.c(final);\n    };\n    return Inflate;\n}());\nexport { Inflate };\n/**\n * Asynchronous streaming DEFLATE decompression\n */\nvar AsyncInflate = /*#__PURE__*/ (function () {\n    function AsyncInflate(opts, cb) {\n        astrmify([\n            bInflt,\n            function () { return [astrm, Inflate]; }\n        ], this, StrmOpt.call(this, opts, cb), function (ev) {\n            var strm = new Inflate(ev.data);\n            onmessage = astrm(strm);\n        }, 7, 0);\n    }\n    return AsyncInflate;\n}());\nexport { AsyncInflate };\nexport function inflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt\n    ], function (ev) { return pbf(inflateSync(ev.data[0], gopt(ev.data[1]))); }, 1, cb);\n}\n/**\n * Expands DEFLATE data with no wrapper\n * @param data The data to decompress\n * @param opts The decompression options\n * @returns The decompressed version of the data\n */\nexport function inflateSync(data, opts) {\n    return inflt(data, { i: 2 }, opts && opts.out, opts && opts.dictionary);\n}\n// before you yell at me for not just using extends, my reason is that TS inheritance is hard to workerize.\n/**\n * Streaming GZIP compression\n */\nvar Gzip = /*#__PURE__*/ (function () {\n    function Gzip(opts, cb) {\n        this.c = crc();\n        this.l = 0;\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be GZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gzip.prototype.push = function (chunk, final) {\n        this.c.p(chunk);\n        this.l += chunk.length;\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Gzip.prototype.p = function (c, f) {\n        var raw = dopt(c, this.o, this.v && gzhl(this.o), f && 8, this.s);\n        if (this.v)\n            gzh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 8, this.c.d()), wbytes(raw, raw.length - 4, this.l);\n        this.ondata(raw, f);\n    };\n    /**\n     * Flushes buffered uncompressed data. Useful to immediately retrieve the\n     * GZIPped output for small inputs.\n     */\n    Gzip.prototype.flush = function () {\n        Deflate.prototype.flush.call(this);\n    };\n    return Gzip;\n}());\nexport { Gzip };\n/**\n * Asynchronous streaming GZIP compression\n */\nvar AsyncGzip = /*#__PURE__*/ (function () {\n    function AsyncGzip(opts, cb) {\n        astrmify([\n            bDflt,\n            gze,\n            function () { return [astrm, Deflate, Gzip]; }\n        ], this, StrmOpt.call(this, opts, cb), function (ev) {\n            var strm = new Gzip(ev.data);\n            onmessage = astrm(strm);\n        }, 8, 1);\n    }\n    return AsyncGzip;\n}());\nexport { AsyncGzip };\nexport function gzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n        gze,\n        function () { return [gzipSync]; }\n    ], function (ev) { return pbf(gzipSync(ev.data[0], ev.data[1])); }, 2, cb);\n}\n/**\n * Compresses data with GZIP\n * @param data The data to compress\n * @param opts The compression options\n * @returns The gzipped version of the data\n */\nexport function gzipSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var c = crc(), l = data.length;\n    c.p(data);\n    var d = dopt(data, opts, gzhl(opts), 8), s = d.length;\n    return gzh(d, opts), wbytes(d, s - 8, c.d()), wbytes(d, s - 4, l), d;\n}\n/**\n * Streaming single or multi-member GZIP decompression\n */\nvar Gunzip = /*#__PURE__*/ (function () {\n    function Gunzip(opts, cb) {\n        this.v = 1;\n        this.r = 0;\n        Inflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be GUNZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gunzip.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        this.r += chunk.length;\n        if (this.v) {\n            var p = this.p.subarray(this.v - 1);\n            var s = p.length > 3 ? gzs(p) : 4;\n            if (s > p.length) {\n                if (!final)\n                    return;\n            }\n            else if (this.v > 1 && this.onmember) {\n                this.onmember(this.r - p.length);\n            }\n            this.p = p.subarray(s), this.v = 0;\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n        // process concatenated GZIP\n        if (this.s.f && !this.s.l && !final) {\n            this.v = shft(this.s.p) + 9;\n            this.s = { i: 0 };\n            this.o = new u8(0);\n            this.push(new u8(0), final);\n        }\n    };\n    return Gunzip;\n}());\nexport { Gunzip };\n/**\n * Asynchronous streaming single or multi-member GZIP decompression\n */\nvar AsyncGunzip = /*#__PURE__*/ (function () {\n    function AsyncGunzip(opts, cb) {\n        var _this = this;\n        astrmify([\n            bInflt,\n            guze,\n            function () { return [astrm, Inflate, Gunzip]; }\n        ], this, StrmOpt.call(this, opts, cb), function (ev) {\n            var strm = new Gunzip(ev.data);\n            strm.onmember = function (offset) { return postMessage(offset); };\n            onmessage = astrm(strm);\n        }, 9, 0, function (offset) { return _this.onmember && _this.onmember(offset); });\n    }\n    return AsyncGunzip;\n}());\nexport { AsyncGunzip };\nexport function gunzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt,\n        guze,\n        function () { return [gunzipSync]; }\n    ], function (ev) { return pbf(gunzipSync(ev.data[0], ev.data[1])); }, 3, cb);\n}\n/**\n * Expands GZIP data\n * @param data The data to decompress\n * @param opts The decompression options\n * @returns The decompressed version of the data\n */\nexport function gunzipSync(data, opts) {\n    var st = gzs(data);\n    if (st + 8 > data.length)\n        err(6, 'invalid gzip data');\n    return inflt(data.subarray(st, -8), { i: 2 }, opts && opts.out || new u8(gzl(data)), opts && opts.dictionary);\n}\n/**\n * Streaming Zlib compression\n */\nvar Zlib = /*#__PURE__*/ (function () {\n    function Zlib(opts, cb) {\n        this.c = adler();\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be zlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Zlib.prototype.push = function (chunk, final) {\n        this.c.p(chunk);\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Zlib.prototype.p = function (c, f) {\n        var raw = dopt(c, this.o, this.v && (this.o.dictionary ? 6 : 2), f && 4, this.s);\n        if (this.v)\n            zlh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 4, this.c.d());\n        this.ondata(raw, f);\n    };\n    /**\n     * Flushes buffered uncompressed data. Useful to immediately retrieve the\n     * zlibbed output for small inputs.\n     */\n    Zlib.prototype.flush = function () {\n        Deflate.prototype.flush.call(this);\n    };\n    return Zlib;\n}());\nexport { Zlib };\n/**\n * Asynchronous streaming Zlib compression\n */\nvar AsyncZlib = /*#__PURE__*/ (function () {\n    function AsyncZlib(opts, cb) {\n        astrmify([\n            bDflt,\n            zle,\n            function () { return [astrm, Deflate, Zlib]; }\n        ], this, StrmOpt.call(this, opts, cb), function (ev) {\n            var strm = new Zlib(ev.data);\n            onmessage = astrm(strm);\n        }, 10, 1);\n    }\n    return AsyncZlib;\n}());\nexport { AsyncZlib };\nexport function zlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n        zle,\n        function () { return [zlibSync]; }\n    ], function (ev) { return pbf(zlibSync(ev.data[0], ev.data[1])); }, 4, cb);\n}\n/**\n * Compress data with Zlib\n * @param data The data to compress\n * @param opts The compression options\n * @returns The zlib-compressed version of the data\n */\nexport function zlibSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var a = adler();\n    a.p(data);\n    var d = dopt(data, opts, opts.dictionary ? 6 : 2, 4);\n    return zlh(d, opts), wbytes(d, d.length - 4, a.d()), d;\n}\n/**\n * Streaming Zlib decompression\n */\nvar Unzlib = /*#__PURE__*/ (function () {\n    function Unzlib(opts, cb) {\n        Inflate.call(this, opts, cb);\n        this.v = opts && opts.dictionary ? 2 : 1;\n    }\n    /**\n     * Pushes a chunk to be unzlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzlib.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            if (this.p.length < 6 && !final)\n                return;\n            this.p = this.p.subarray(zls(this.p, this.v - 1)), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 4)\n                err(6, 'invalid zlib data');\n            this.p = this.p.subarray(0, -4);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Unzlib;\n}());\nexport { Unzlib };\n/**\n * Asynchronous streaming Zlib decompression\n */\nvar AsyncUnzlib = /*#__PURE__*/ (function () {\n    function AsyncUnzlib(opts, cb) {\n        astrmify([\n            bInflt,\n            zule,\n            function () { return [astrm, Inflate, Unzlib]; }\n        ], this, StrmOpt.call(this, opts, cb), function (ev) {\n            var strm = new Unzlib(ev.data);\n            onmessage = astrm(strm);\n        }, 11, 0);\n    }\n    return AsyncUnzlib;\n}());\nexport { AsyncUnzlib };\nexport function unzlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt,\n        zule,\n        function () { return [unzlibSync]; }\n    ], function (ev) { return pbf(unzlibSync(ev.data[0], gopt(ev.data[1]))); }, 5, cb);\n}\n/**\n * Expands Zlib data\n * @param data The data to decompress\n * @param opts The decompression options\n * @returns The decompressed version of the data\n */\nexport function unzlibSync(data, opts) {\n    return inflt(data.subarray(zls(data, opts && opts.dictionary), -4), { i: 2 }, opts && opts.out, opts && opts.dictionary);\n}\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzip as compress, AsyncGzip as AsyncCompress };\nexport { gzipSync as compressSync, Gzip as Compress };\n/**\n * Streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar Decompress = /*#__PURE__*/ (function () {\n    function Decompress(opts, cb) {\n        this.o = StrmOpt.call(this, opts, cb) || {};\n        this.G = Gunzip;\n        this.I = Inflate;\n        this.Z = Unzlib;\n    }\n    // init substream\n    // overriden by AsyncDecompress\n    Decompress.prototype.i = function () {\n        var _this = this;\n        this.s.ondata = function (dat, final) {\n            _this.ondata(dat, final);\n        };\n    };\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Decompress.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (!this.s) {\n            if (this.p && this.p.length) {\n                var n = new u8(this.p.length + chunk.length);\n                n.set(this.p), n.set(chunk, this.p.length);\n            }\n            else\n                this.p = chunk;\n            if (this.p.length > 2) {\n                this.s = (this.p[0] == 31 && this.p[1] == 139 && this.p[2] == 8)\n                    ? new this.G(this.o)\n                    : ((this.p[0] & 15) != 8 || (this.p[0] >> 4) > 7 || ((this.p[0] << 8 | this.p[1]) % 31))\n                        ? new this.I(this.o)\n                        : new this.Z(this.o);\n                this.i();\n                this.s.push(this.p, final);\n                this.p = null;\n            }\n        }\n        else\n            this.s.push(chunk, final);\n    };\n    return Decompress;\n}());\nexport { Decompress };\n/**\n * Asynchronous streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar AsyncDecompress = /*#__PURE__*/ (function () {\n    function AsyncDecompress(opts, cb) {\n        Decompress.call(this, opts, cb);\n        this.queuedSize = 0;\n        this.G = AsyncGunzip;\n        this.I = AsyncInflate;\n        this.Z = AsyncUnzlib;\n    }\n    AsyncDecompress.prototype.i = function () {\n        var _this = this;\n        this.s.ondata = function (err, dat, final) {\n            _this.ondata(err, dat, final);\n        };\n        this.s.ondrain = function (size) {\n            _this.queuedSize -= size;\n            if (_this.ondrain)\n                _this.ondrain(size);\n        };\n    };\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncDecompress.prototype.push = function (chunk, final) {\n        this.queuedSize += chunk.length;\n        Decompress.prototype.push.call(this, chunk, final);\n    };\n    return AsyncDecompress;\n}());\nexport { AsyncDecompress };\nexport function decompress(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzip(data, opts, cb)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflate(data, opts, cb)\n            : unzlib(data, opts, cb);\n}\n/**\n * Expands compressed GZIP, Zlib, or raw DEFLATE data, automatically detecting the format\n * @param data The data to decompress\n * @param opts The decompression options\n * @returns The decompressed version of the data\n */\nexport function decompressSync(data, opts) {\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzipSync(data, opts)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflateSync(data, opts)\n            : unzlibSync(data, opts);\n}\n// flatten a directory structure\nvar fltn = function (d, p, t, o) {\n    for (var k in d) {\n        var val = d[k], n = p + k, op = o;\n        if (Array.isArray(val))\n            op = mrg(o, val[1]), val = val[0];\n        if (val instanceof u8)\n            t[n] = [val, op];\n        else {\n            t[n += '/'] = [new u8(0), op];\n            fltn(val, n, t, o);\n        }\n    }\n};\n// text encoder\nvar te = typeof TextEncoder != 'undefined' && /*#__PURE__*/ new TextEncoder();\n// text decoder\nvar td = typeof TextDecoder != 'undefined' && /*#__PURE__*/ new TextDecoder();\n// text decoder stream\nvar tds = 0;\ntry {\n    td.decode(et, { stream: true });\n    tds = 1;\n}\ncatch (e) { }\n// decode UTF8\nvar dutf8 = function (d) {\n    for (var r = '', i = 0;;) {\n        var c = d[i++];\n        var eb = (c > 127) + (c > 223) + (c > 239);\n        if (i + eb > d.length)\n            return { s: r, r: slc(d, i - 1) };\n        if (!eb)\n            r += String.fromCharCode(c);\n        else if (eb == 3) {\n            c = ((c & 15) << 18 | (d[i++] & 63) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63)) - 65536,\n                r += String.fromCharCode(55296 | (c >> 10), 56320 | (c & 1023));\n        }\n        else if (eb & 1)\n            r += String.fromCharCode((c & 31) << 6 | (d[i++] & 63));\n        else\n            r += String.fromCharCode((c & 15) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63));\n    }\n};\n/**\n * Streaming UTF-8 decoding\n */\nvar DecodeUTF8 = /*#__PURE__*/ (function () {\n    /**\n     * Creates a UTF-8 decoding stream\n     * @param cb The callback to call whenever data is decoded\n     */\n    function DecodeUTF8(cb) {\n        this.ondata = cb;\n        if (tds)\n            this.t = new TextDecoder();\n        else\n            this.p = et;\n    }\n    /**\n     * Pushes a chunk to be decoded from UTF-8 binary\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    DecodeUTF8.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        final = !!final;\n        if (this.t) {\n            this.ondata(this.t.decode(chunk, { stream: true }), final);\n            if (final) {\n                if (this.t.decode().length)\n                    err(8);\n                this.t = null;\n            }\n            return;\n        }\n        if (!this.p)\n            err(4);\n        var dat = new u8(this.p.length + chunk.length);\n        dat.set(this.p);\n        dat.set(chunk, this.p.length);\n        var _a = dutf8(dat), s = _a.s, r = _a.r;\n        if (final) {\n            if (r.length)\n                err(8);\n            this.p = null;\n        }\n        else\n            this.p = r;\n        this.ondata(s, final);\n    };\n    return DecodeUTF8;\n}());\nexport { DecodeUTF8 };\n/**\n * Streaming UTF-8 encoding\n */\nvar EncodeUTF8 = /*#__PURE__*/ (function () {\n    /**\n     * Creates a UTF-8 decoding stream\n     * @param cb The callback to call whenever data is encoded\n     */\n    function EncodeUTF8(cb) {\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be encoded to UTF-8\n     * @param chunk The string data to push\n     * @param final Whether this is the last chunk\n     */\n    EncodeUTF8.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (this.d)\n            err(4);\n        this.ondata(strToU8(chunk), this.d = final || false);\n    };\n    return EncodeUTF8;\n}());\nexport { EncodeUTF8 };\n/**\n * Converts a string into a Uint8Array for use with compression/decompression methods\n * @param str The string to encode\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless decoding a binary string.\n * @returns The string encoded in UTF-8/Latin-1 binary\n */\nexport function strToU8(str, latin1) {\n    if (latin1) {\n        var ar_1 = new u8(str.length);\n        for (var i = 0; i < str.length; ++i)\n            ar_1[i] = str.charCodeAt(i);\n        return ar_1;\n    }\n    if (te)\n        return te.encode(str);\n    var l = str.length;\n    var ar = new u8(str.length + (str.length >> 1));\n    var ai = 0;\n    var w = function (v) { ar[ai++] = v; };\n    for (var i = 0; i < l; ++i) {\n        if (ai + 5 > ar.length) {\n            var n = new u8(ai + 8 + ((l - i) << 1));\n            n.set(ar);\n            ar = n;\n        }\n        var c = str.charCodeAt(i);\n        if (c < 128 || latin1)\n            w(c);\n        else if (c < 2048)\n            w(192 | (c >> 6)), w(128 | (c & 63));\n        else if (c > 55295 && c < 57344)\n            c = 65536 + (c & 1023 << 10) | (str.charCodeAt(++i) & 1023),\n                w(240 | (c >> 18)), w(128 | ((c >> 12) & 63)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\n        else\n            w(224 | (c >> 12)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\n    }\n    return slc(ar, 0, ai);\n}\n/**\n * Converts a Uint8Array to a string\n * @param dat The data to decode to string\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless encoding to binary string.\n * @returns The original UTF-8/Latin-1 string\n */\nexport function strFromU8(dat, latin1) {\n    if (latin1) {\n        var r = '';\n        for (var i = 0; i < dat.length; i += 16384)\n            r += String.fromCharCode.apply(null, dat.subarray(i, i + 16384));\n        return r;\n    }\n    else if (td) {\n        return td.decode(dat);\n    }\n    else {\n        var _a = dutf8(dat), s = _a.s, r = _a.r;\n        if (r.length)\n            err(8);\n        return s;\n    }\n}\n;\n// deflate bit flag\nvar dbf = function (l) { return l == 1 ? 3 : l < 6 ? 2 : l == 9 ? 1 : 0; };\n// skip local zip header\nvar slzh = function (d, b) { return b + 30 + b2(d, b + 26) + b2(d, b + 28); };\n// read zip header\nvar zh = function (d, b, z) {\n    var fnl = b2(d, b + 28), fn = strFromU8(d.subarray(b + 46, b + 46 + fnl), !(b2(d, b + 8) & 2048)), es = b + 46 + fnl, bs = b4(d, b + 20);\n    var _a = z && bs == 4294967295 ? z64e(d, es) : [bs, b4(d, b + 24), b4(d, b + 42)], sc = _a[0], su = _a[1], off = _a[2];\n    return [b2(d, b + 10), sc, su, fn, es + b2(d, b + 30) + b2(d, b + 32), off];\n};\n// read zip64 extra field\nvar z64e = function (d, b) {\n    for (; b2(d, b) != 1; b += 4 + b2(d, b + 2))\n        ;\n    return [b8(d, b + 12), b8(d, b + 4), b8(d, b + 20)];\n};\n// extra field length\nvar exfl = function (ex) {\n    var le = 0;\n    if (ex) {\n        for (var k in ex) {\n            var l = ex[k].length;\n            if (l > 65535)\n                err(9);\n            le += l + 4;\n        }\n    }\n    return le;\n};\n// write zip header\nvar wzh = function (d, b, f, fn, u, c, ce, co) {\n    var fl = fn.length, ex = f.extra, col = co && co.length;\n    var exl = exfl(ex);\n    wbytes(d, b, ce != null ? 0x2014B50 : 0x4034B50), b += 4;\n    if (ce != null)\n        d[b++] = 20, d[b++] = f.os;\n    d[b] = 20, b += 2; // spec compliance? what's that?\n    d[b++] = (f.flag << 1) | (c < 0 && 8), d[b++] = u && 8;\n    d[b++] = f.compression & 255, d[b++] = f.compression >> 8;\n    var dt = new Date(f.mtime == null ? Date.now() : f.mtime), y = dt.getFullYear() - 1980;\n    if (y < 0 || y > 119)\n        err(10);\n    wbytes(d, b, (y << 25) | ((dt.getMonth() + 1) << 21) | (dt.getDate() << 16) | (dt.getHours() << 11) | (dt.getMinutes() << 5) | (dt.getSeconds() >> 1)), b += 4;\n    if (c != -1) {\n        wbytes(d, b, f.crc);\n        wbytes(d, b + 4, c < 0 ? -c - 2 : c);\n        wbytes(d, b + 8, f.size);\n    }\n    wbytes(d, b + 12, fl);\n    wbytes(d, b + 14, exl), b += 16;\n    if (ce != null) {\n        wbytes(d, b, col);\n        wbytes(d, b + 6, f.attrs);\n        wbytes(d, b + 10, ce), b += 14;\n    }\n    d.set(fn, b);\n    b += fl;\n    if (exl) {\n        for (var k in ex) {\n            var exf = ex[k], l = exf.length;\n            wbytes(d, b, +k);\n            wbytes(d, b + 2, l);\n            d.set(exf, b + 4), b += 4 + l;\n        }\n    }\n    if (col)\n        d.set(co, b), b += col;\n    return b;\n};\n// write zip footer (end of central directory)\nvar wzf = function (o, b, c, d, e) {\n    wbytes(o, b, 0x6054B50); // skip disk\n    wbytes(o, b + 8, c);\n    wbytes(o, b + 10, c);\n    wbytes(o, b + 12, d);\n    wbytes(o, b + 16, e);\n};\n/**\n * A pass-through stream to keep data uncompressed in a ZIP archive.\n */\nvar ZipPassThrough = /*#__PURE__*/ (function () {\n    /**\n     * Creates a pass-through stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     */\n    function ZipPassThrough(filename) {\n        this.filename = filename;\n        this.c = crc();\n        this.size = 0;\n        this.compression = 0;\n    }\n    /**\n     * Processes a chunk and pushes to the output stream. You can override this\n     * method in a subclass for custom behavior, but by default this passes\n     * the data through. You must call this.ondata(err, chunk, final) at some\n     * point in this method.\n     * @param chunk The chunk to process\n     * @param final Whether this is the last chunk\n     */\n    ZipPassThrough.prototype.process = function (chunk, final) {\n        this.ondata(null, chunk, final);\n    };\n    /**\n     * Pushes a chunk to be added. If you are subclassing this with a custom\n     * compression algorithm, note that you must push data from the source\n     * file only, pre-compression.\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    ZipPassThrough.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        this.c.p(chunk);\n        this.size += chunk.length;\n        if (final)\n            this.crc = this.c.d();\n        this.process(chunk, final || false);\n    };\n    return ZipPassThrough;\n}());\nexport { ZipPassThrough };\n// I don't extend because TypeScript extension adds 1kB of runtime bloat\n/**\n * Streaming DEFLATE compression for ZIP archives. Prefer using AsyncZipDeflate\n * for better performance\n */\nvar ZipDeflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     * @param opts The compression options\n     */\n    function ZipDeflate(filename, opts) {\n        var _this = this;\n        if (!opts)\n            opts = {};\n        ZipPassThrough.call(this, filename);\n        this.d = new Deflate(opts, function (dat, final) {\n            _this.ondata(null, dat, final);\n        });\n        this.compression = 8;\n        this.flag = dbf(opts.level);\n    }\n    ZipDeflate.prototype.process = function (chunk, final) {\n        try {\n            this.d.push(chunk, final);\n        }\n        catch (e) {\n            this.ondata(e, null, final);\n        }\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    ZipDeflate.prototype.push = function (chunk, final) {\n        ZipPassThrough.prototype.push.call(this, chunk, final);\n    };\n    return ZipDeflate;\n}());\nexport { ZipDeflate };\n/**\n * Asynchronous streaming DEFLATE compression for ZIP archives\n */\nvar AsyncZipDeflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous DEFLATE stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     * @param opts The compression options\n     */\n    function AsyncZipDeflate(filename, opts) {\n        var _this = this;\n        if (!opts)\n            opts = {};\n        ZipPassThrough.call(this, filename);\n        this.d = new AsyncDeflate(opts, function (err, dat, final) {\n            _this.ondata(err, dat, final);\n        });\n        this.compression = 8;\n        this.flag = dbf(opts.level);\n        this.terminate = this.d.terminate;\n    }\n    AsyncZipDeflate.prototype.process = function (chunk, final) {\n        this.d.push(chunk, final);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncZipDeflate.prototype.push = function (chunk, final) {\n        ZipPassThrough.prototype.push.call(this, chunk, final);\n    };\n    return AsyncZipDeflate;\n}());\nexport { AsyncZipDeflate };\n// TODO: Better tree shaking\n/**\n * A zippable archive to which files can incrementally be added\n */\nvar Zip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an empty ZIP archive to which files can be added\n     * @param cb The callback to call whenever data for the generated ZIP archive\n     *           is available\n     */\n    function Zip(cb) {\n        this.ondata = cb;\n        this.u = [];\n        this.d = 1;\n    }\n    /**\n     * Adds a file to the ZIP archive\n     * @param file The file stream to add\n     */\n    Zip.prototype.add = function (file) {\n        var _this = this;\n        if (!this.ondata)\n            err(5);\n        // finishing or finished\n        if (this.d & 2)\n            this.ondata(err(4 + (this.d & 1) * 8, 0, 1), null, false);\n        else {\n            var f = strToU8(file.filename), fl_1 = f.length;\n            var com = file.comment, o = com && strToU8(com);\n            var u = fl_1 != file.filename.length || (o && (com.length != o.length));\n            var hl_1 = fl_1 + exfl(file.extra) + 30;\n            if (fl_1 > 65535)\n                this.ondata(err(11, 0, 1), null, false);\n            var header = new u8(hl_1);\n            wzh(header, 0, file, f, u, -1);\n            var chks_1 = [header];\n            var pAll_1 = function () {\n                for (var _i = 0, chks_2 = chks_1; _i < chks_2.length; _i++) {\n                    var chk = chks_2[_i];\n                    _this.ondata(null, chk, false);\n                }\n                chks_1 = [];\n            };\n            var tr_1 = this.d;\n            this.d = 0;\n            var ind_1 = this.u.length;\n            var uf_1 = mrg(file, {\n                f: f,\n                u: u,\n                o: o,\n                t: function () {\n                    if (file.terminate)\n                        file.terminate();\n                },\n                r: function () {\n                    pAll_1();\n                    if (tr_1) {\n                        var nxt = _this.u[ind_1 + 1];\n                        if (nxt)\n                            nxt.r();\n                        else\n                            _this.d = 1;\n                    }\n                    tr_1 = 1;\n                }\n            });\n            var cl_1 = 0;\n            file.ondata = function (err, dat, final) {\n                if (err) {\n                    _this.ondata(err, dat, final);\n                    _this.terminate();\n                }\n                else {\n                    cl_1 += dat.length;\n                    chks_1.push(dat);\n                    if (final) {\n                        var dd = new u8(16);\n                        wbytes(dd, 0, 0x8074B50);\n                        wbytes(dd, 4, file.crc);\n                        wbytes(dd, 8, cl_1);\n                        wbytes(dd, 12, file.size);\n                        chks_1.push(dd);\n                        uf_1.c = cl_1, uf_1.b = hl_1 + cl_1 + 16, uf_1.crc = file.crc, uf_1.size = file.size;\n                        if (tr_1)\n                            uf_1.r();\n                        tr_1 = 1;\n                    }\n                    else if (tr_1)\n                        pAll_1();\n                }\n            };\n            this.u.push(uf_1);\n        }\n    };\n    /**\n     * Ends the process of adding files and prepares to emit the final chunks.\n     * This *must* be called after adding all desired files for the resulting\n     * ZIP file to work properly.\n     */\n    Zip.prototype.end = function () {\n        var _this = this;\n        if (this.d & 2) {\n            this.ondata(err(4 + (this.d & 1) * 8, 0, 1), null, true);\n            return;\n        }\n        if (this.d)\n            this.e();\n        else\n            this.u.push({\n                r: function () {\n                    if (!(_this.d & 1))\n                        return;\n                    _this.u.splice(-1, 1);\n                    _this.e();\n                },\n                t: function () { }\n            });\n        this.d = 3;\n    };\n    Zip.prototype.e = function () {\n        var bt = 0, l = 0, tl = 0;\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\n            var f = _a[_i];\n            tl += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0);\n        }\n        var out = new u8(tl + 22);\n        for (var _b = 0, _c = this.u; _b < _c.length; _b++) {\n            var f = _c[_b];\n            wzh(out, bt, f, f.f, f.u, -f.c - 2, l, f.o);\n            bt += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0), l += f.b;\n        }\n        wzf(out, bt, this.u.length, tl, l);\n        this.ondata(null, out, true);\n        this.d = 2;\n    };\n    /**\n     * A method to terminate any internal workers used by the stream. Subsequent\n     * calls to add() will fail.\n     */\n    Zip.prototype.terminate = function () {\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\n            var f = _a[_i];\n            f.t();\n        }\n        this.d = 2;\n    };\n    return Zip;\n}());\nexport { Zip };\nexport function zip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    var r = {};\n    fltn(data, '', r, opts);\n    var k = Object.keys(r);\n    var lft = k.length, o = 0, tot = 0;\n    var slft = lft, files = new Array(lft);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var cbd = function (a, b) {\n        mt(function () { cb(a, b); });\n    };\n    mt(function () { cbd = cb; });\n    var cbf = function () {\n        var out = new u8(tot + 22), oe = o, cdl = tot - o;\n        tot = 0;\n        for (var i = 0; i < slft; ++i) {\n            var f = files[i];\n            try {\n                var l = f.c.length;\n                wzh(out, tot, f, f.f, f.u, l);\n                var badd = 30 + f.f.length + exfl(f.extra);\n                var loc = tot + badd;\n                out.set(f.c, loc);\n                wzh(out, o, f, f.f, f.u, l, tot, f.m), o += 16 + badd + (f.m ? f.m.length : 0), tot = loc + l;\n            }\n            catch (e) {\n                return cbd(e, null);\n            }\n        }\n        wzf(out, o, files.length, cdl, oe);\n        cbd(null, out);\n    };\n    if (!lft)\n        cbf();\n    var _loop_1 = function (i) {\n        var fn = k[i];\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var c = crc(), size = file.length;\n        c.p(file);\n        var f = strToU8(fn), s = f.length;\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\n        var exl = exfl(p.extra);\n        var compression = p.level == 0 ? 0 : 8;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cbd(e, null);\n            }\n            else {\n                var l = d.length;\n                files[i] = mrg(p, {\n                    size: size,\n                    crc: c.d(),\n                    c: d,\n                    f: f,\n                    m: m,\n                    u: s != fn.length || (m && (com.length != ms)),\n                    compression: compression\n                });\n                o += 30 + s + exl + l;\n                tot += 76 + 2 * (s + exl) + (ms || 0) + l;\n                if (!--lft)\n                    cbf();\n            }\n        };\n        if (s > 65535)\n            cbl(err(11, 0, 1), null);\n        if (!compression)\n            cbl(null, file);\n        else if (size < 160000) {\n            try {\n                cbl(null, deflateSync(file, p));\n            }\n            catch (e) {\n                cbl(e, null);\n            }\n        }\n        else\n            term.push(deflate(file, p, cbl));\n    };\n    // Cannot use lft because it can decrease\n    for (var i = 0; i < slft; ++i) {\n        _loop_1(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously creates a ZIP file. Prefer using `zip` for better performance\n * with more than one file.\n * @param data The directory structure for the ZIP archive\n * @param opts The main options, merged with per-file options\n * @returns The generated ZIP archive\n */\nexport function zipSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var r = {};\n    var files = [];\n    fltn(data, '', r, opts);\n    var o = 0;\n    var tot = 0;\n    for (var fn in r) {\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var compression = p.level == 0 ? 0 : 8;\n        var f = strToU8(fn), s = f.length;\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\n        var exl = exfl(p.extra);\n        if (s > 65535)\n            err(11);\n        var d = compression ? deflateSync(file, p) : file, l = d.length;\n        var c = crc();\n        c.p(file);\n        files.push(mrg(p, {\n            size: file.length,\n            crc: c.d(),\n            c: d,\n            f: f,\n            m: m,\n            u: s != fn.length || (m && (com.length != ms)),\n            o: o,\n            compression: compression\n        }));\n        o += 30 + s + exl + l;\n        tot += 76 + 2 * (s + exl) + (ms || 0) + l;\n    }\n    var out = new u8(tot + 22), oe = o, cdl = tot - o;\n    for (var i = 0; i < files.length; ++i) {\n        var f = files[i];\n        wzh(out, f.o, f, f.f, f.u, f.c.length);\n        var badd = 30 + f.f.length + exfl(f.extra);\n        out.set(f.c, f.o + badd);\n        wzh(out, o, f, f.f, f.u, f.c.length, f.o, f.m), o += 16 + badd + (f.m ? f.m.length : 0);\n    }\n    wzf(out, o, files.length, cdl, oe);\n    return out;\n}\n/**\n * Streaming pass-through decompression for ZIP archives\n */\nvar UnzipPassThrough = /*#__PURE__*/ (function () {\n    function UnzipPassThrough() {\n    }\n    UnzipPassThrough.prototype.push = function (data, final) {\n        this.ondata(null, data, final);\n    };\n    UnzipPassThrough.compression = 0;\n    return UnzipPassThrough;\n}());\nexport { UnzipPassThrough };\n/**\n * Streaming DEFLATE decompression for ZIP archives. Prefer AsyncZipInflate for\n * better performance.\n */\nvar UnzipInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE decompression that can be used in ZIP archives\n     */\n    function UnzipInflate() {\n        var _this = this;\n        this.i = new Inflate(function (dat, final) {\n            _this.ondata(null, dat, final);\n        });\n    }\n    UnzipInflate.prototype.push = function (data, final) {\n        try {\n            this.i.push(data, final);\n        }\n        catch (e) {\n            this.ondata(e, null, final);\n        }\n    };\n    UnzipInflate.compression = 8;\n    return UnzipInflate;\n}());\nexport { UnzipInflate };\n/**\n * Asynchronous streaming DEFLATE decompression for ZIP archives\n */\nvar AsyncUnzipInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE decompression that can be used in ZIP archives\n     */\n    function AsyncUnzipInflate(_, sz) {\n        var _this = this;\n        if (sz < 320000) {\n            this.i = new Inflate(function (dat, final) {\n                _this.ondata(null, dat, final);\n            });\n        }\n        else {\n            this.i = new AsyncInflate(function (err, dat, final) {\n                _this.ondata(err, dat, final);\n            });\n            this.terminate = this.i.terminate;\n        }\n    }\n    AsyncUnzipInflate.prototype.push = function (data, final) {\n        if (this.i.terminate)\n            data = slc(data, 0);\n        this.i.push(data, final);\n    };\n    AsyncUnzipInflate.compression = 8;\n    return AsyncUnzipInflate;\n}());\nexport { AsyncUnzipInflate };\n/**\n * A ZIP archive decompression stream that emits files as they are discovered\n */\nvar Unzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a ZIP decompression stream\n     * @param cb The callback to call whenever a file in the ZIP archive is found\n     */\n    function Unzip(cb) {\n        this.onfile = cb;\n        this.k = [];\n        this.o = {\n            0: UnzipPassThrough\n        };\n        this.p = et;\n    }\n    /**\n     * Pushes a chunk to be unzipped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzip.prototype.push = function (chunk, final) {\n        var _this = this;\n        if (!this.onfile)\n            err(5);\n        if (!this.p)\n            err(4);\n        if (this.c > 0) {\n            var len = Math.min(this.c, chunk.length);\n            var toAdd = chunk.subarray(0, len);\n            this.c -= len;\n            if (this.d)\n                this.d.push(toAdd, !this.c);\n            else\n                this.k[0].push(toAdd);\n            chunk = chunk.subarray(len);\n            if (chunk.length)\n                return this.push(chunk, final);\n        }\n        else {\n            var f = 0, i = 0, is = void 0, buf = void 0;\n            if (!this.p.length)\n                buf = chunk;\n            else if (!chunk.length)\n                buf = this.p;\n            else {\n                buf = new u8(this.p.length + chunk.length);\n                buf.set(this.p), buf.set(chunk, this.p.length);\n            }\n            var l = buf.length, oc = this.c, add = oc && this.d;\n            var _loop_2 = function () {\n                var _a;\n                var sig = b4(buf, i);\n                if (sig == 0x4034B50) {\n                    f = 1, is = i;\n                    this_1.d = null;\n                    this_1.c = 0;\n                    var bf = b2(buf, i + 6), cmp_1 = b2(buf, i + 8), u = bf & 2048, dd = bf & 8, fnl = b2(buf, i + 26), es = b2(buf, i + 28);\n                    if (l > i + 30 + fnl + es) {\n                        var chks_3 = [];\n                        this_1.k.unshift(chks_3);\n                        f = 2;\n                        var sc_1 = b4(buf, i + 18), su_1 = b4(buf, i + 22);\n                        var fn_1 = strFromU8(buf.subarray(i + 30, i += 30 + fnl), !u);\n                        if (sc_1 == 4294967295) {\n                            _a = dd ? [-2] : z64e(buf, i), sc_1 = _a[0], su_1 = _a[1];\n                        }\n                        else if (dd)\n                            sc_1 = -1;\n                        i += es;\n                        this_1.c = sc_1;\n                        var d_1;\n                        var file_1 = {\n                            name: fn_1,\n                            compression: cmp_1,\n                            start: function () {\n                                if (!file_1.ondata)\n                                    err(5);\n                                if (!sc_1)\n                                    file_1.ondata(null, et, true);\n                                else {\n                                    var ctr = _this.o[cmp_1];\n                                    if (!ctr)\n                                        file_1.ondata(err(14, 'unknown compression type ' + cmp_1, 1), null, false);\n                                    d_1 = sc_1 < 0 ? new ctr(fn_1) : new ctr(fn_1, sc_1, su_1);\n                                    d_1.ondata = function (err, dat, final) { file_1.ondata(err, dat, final); };\n                                    for (var _i = 0, chks_4 = chks_3; _i < chks_4.length; _i++) {\n                                        var dat = chks_4[_i];\n                                        d_1.push(dat, false);\n                                    }\n                                    if (_this.k[0] == chks_3 && _this.c)\n                                        _this.d = d_1;\n                                    else\n                                        d_1.push(et, true);\n                                }\n                            },\n                            terminate: function () {\n                                if (d_1 && d_1.terminate)\n                                    d_1.terminate();\n                            }\n                        };\n                        if (sc_1 >= 0)\n                            file_1.size = sc_1, file_1.originalSize = su_1;\n                        this_1.onfile(file_1);\n                    }\n                    return \"break\";\n                }\n                else if (oc) {\n                    if (sig == 0x8074B50) {\n                        is = i += 12 + (oc == -2 && 8), f = 3, this_1.c = 0;\n                        return \"break\";\n                    }\n                    else if (sig == 0x2014B50) {\n                        is = i -= 4, f = 3, this_1.c = 0;\n                        return \"break\";\n                    }\n                }\n            };\n            var this_1 = this;\n            for (; i < l - 4; ++i) {\n                var state_1 = _loop_2();\n                if (state_1 === \"break\")\n                    break;\n            }\n            this.p = et;\n            if (oc < 0) {\n                var dat = f ? buf.subarray(0, is - 12 - (oc == -2 && 8) - (b4(buf, is - 16) == 0x8074B50 && 4)) : buf.subarray(0, i);\n                if (add)\n                    add.push(dat, !!f);\n                else\n                    this.k[+(f == 2)].push(dat);\n            }\n            if (f & 2)\n                return this.push(buf.subarray(i), final);\n            this.p = buf.subarray(i);\n        }\n        if (final) {\n            if (this.c)\n                err(13);\n            this.p = null;\n        }\n    };\n    /**\n     * Registers a decoder with the stream, allowing for files compressed with\n     * the compression type provided to be expanded correctly\n     * @param decoder The decoder constructor\n     */\n    Unzip.prototype.register = function (decoder) {\n        this.o[decoder.compression] = decoder;\n    };\n    return Unzip;\n}());\nexport { Unzip };\nvar mt = typeof queueMicrotask == 'function' ? queueMicrotask : typeof setTimeout == 'function' ? setTimeout : function (fn) { fn(); };\nexport function unzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var files = {};\n    var cbd = function (a, b) {\n        mt(function () { cb(a, b); });\n    };\n    mt(function () { cbd = cb; });\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558) {\n            cbd(err(13, 0, 1), null);\n            return tAll;\n        }\n    }\n    ;\n    var lft = b2(data, e + 8);\n    if (lft) {\n        var c = lft;\n        var o = b4(data, e + 16);\n        var z = o == 4294967295 || c == 65535;\n        if (z) {\n            var ze = b4(data, e - 12);\n            z = b4(data, ze) == 0x6064B50;\n            if (z) {\n                c = lft = b4(data, ze + 32);\n                o = b4(data, ze + 48);\n            }\n        }\n        var fltr = opts && opts.filter;\n        var _loop_3 = function (i) {\n            var _a = zh(data, o, z), c_1 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n            o = no;\n            var cbl = function (e, d) {\n                if (e) {\n                    tAll();\n                    cbd(e, null);\n                }\n                else {\n                    if (d)\n                        files[fn] = d;\n                    if (!--lft)\n                        cbd(null, files);\n                }\n            };\n            if (!fltr || fltr({\n                name: fn,\n                size: sc,\n                originalSize: su,\n                compression: c_1\n            })) {\n                if (!c_1)\n                    cbl(null, slc(data, b, b + sc));\n                else if (c_1 == 8) {\n                    var infl = data.subarray(b, b + sc);\n                    // Synchronously decompress under 512KB, or barely-compressed data\n                    if (su < 524288 || sc > 0.8 * su) {\n                        try {\n                            cbl(null, inflateSync(infl, { out: new u8(su) }));\n                        }\n                        catch (e) {\n                            cbl(e, null);\n                        }\n                    }\n                    else\n                        term.push(inflate(infl, { size: su }, cbl));\n                }\n                else\n                    cbl(err(14, 'unknown compression type ' + c_1, 1), null);\n            }\n            else\n                cbl(null, null);\n        };\n        for (var i = 0; i < c; ++i) {\n            _loop_3(i);\n        }\n    }\n    else\n        cbd(null, {});\n    return tAll;\n}\n/**\n * Synchronously decompresses a ZIP archive. Prefer using `unzip` for better\n * performance with more than one file.\n * @param data The raw compressed ZIP file\n * @param opts The ZIP extraction options\n * @returns The decompressed files\n */\nexport function unzipSync(data, opts) {\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558)\n            err(13);\n    }\n    ;\n    var c = b2(data, e + 8);\n    if (!c)\n        return {};\n    var o = b4(data, e + 16);\n    var z = o == 4294967295 || c == 65535;\n    if (z) {\n        var ze = b4(data, e - 12);\n        z = b4(data, ze) == 0x6064B50;\n        if (z) {\n            c = b4(data, ze + 32);\n            o = b4(data, ze + 48);\n        }\n    }\n    var fltr = opts && opts.filter;\n    for (var i = 0; i < c; ++i) {\n        var _a = zh(data, o, z), c_2 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        if (!fltr || fltr({\n            name: fn,\n            size: sc,\n            originalSize: su,\n            compression: c_2\n        })) {\n            if (!c_2)\n                files[fn] = slc(data, b, b + sc);\n            else if (c_2 == 8)\n                files[fn] = inflateSync(data.subarray(b, b + sc), { out: new u8(su) });\n            else\n                err(14, 'unknown compression type ' + c_2);\n        }\n    }\n    return files;\n}\n", null, null, null, null, null, null, null, null, null, null, null, null, null, null, "import { TransformEncode, TransformDecode, HasTransform, TransformDecodeCheckError, TransformEncodeCheckError } from '../value/transform/index.mjs';\nimport { Errors } from '../errors/index.mjs';\nimport { TypeSystemPolicy } from '../system/index.mjs';\nimport { TypeBoxError } from '../type/error/index.mjs';\nimport { Deref } from '../value/deref/index.mjs';\nimport { Hash } from '../value/hash/index.mjs';\nimport { Kind } from '../type/symbols/index.mjs';\nimport { TypeRegistry, FormatRegistry } from '../type/registry/index.mjs';\nimport { KeyOfPattern } from '../type/keyof/index.mjs';\nimport { ExtendsUndefinedCheck } from '../type/extends/extends-undefined.mjs';\nimport { Never } from '../type/never/index.mjs';\n// ------------------------------------------------------------------\n// ValueGuard\n// ------------------------------------------------------------------\nimport { IsArray, IsString, IsNumber, IsBigInt } from '../value/guard/index.mjs';\n// ------------------------------------------------------------------\n// TypeGuard\n// ------------------------------------------------------------------\nimport { IsSchema } from '../type/guard/type.mjs';\n// ------------------------------------------------------------------\n// TypeCheck\n// ------------------------------------------------------------------\nexport class TypeCheck {\n    constructor(schema, references, checkFunc, code) {\n        this.schema = schema;\n        this.references = references;\n        this.checkFunc = checkFunc;\n        this.code = code;\n        this.hasTransform = HasTransform(schema, references);\n    }\n    /** Returns the generated assertion code used to validate this type. */\n    Code() {\n        return this.code;\n    }\n    /** Returns an iterator for each error in this value. */\n    Errors(value) {\n        return Errors(this.schema, this.references, value);\n    }\n    /** Returns true if the value matches the compiled type. */\n    Check(value) {\n        return this.checkFunc(value);\n    }\n    /** Decodes a value or throws if error */\n    Decode(value) {\n        if (!this.checkFunc(value))\n            throw new TransformDecodeCheckError(this.schema, value, this.Errors(value).First());\n        return (this.hasTransform ? TransformDecode(this.schema, this.references, value) : value);\n    }\n    /** Encodes a value or throws if error */\n    Encode(value) {\n        const encoded = this.hasTransform ? TransformEncode(this.schema, this.references, value) : value;\n        if (!this.checkFunc(encoded))\n            throw new TransformEncodeCheckError(this.schema, value, this.Errors(value).First());\n        return encoded;\n    }\n}\n// ------------------------------------------------------------------\n// Character\n// ------------------------------------------------------------------\nvar Character;\n(function (Character) {\n    function DollarSign(code) {\n        return code === 36;\n    }\n    Character.DollarSign = DollarSign;\n    function IsUnderscore(code) {\n        return code === 95;\n    }\n    Character.IsUnderscore = IsUnderscore;\n    function IsAlpha(code) {\n        return (code >= 65 && code <= 90) || (code >= 97 && code <= 122);\n    }\n    Character.IsAlpha = IsAlpha;\n    function IsNumeric(code) {\n        return code >= 48 && code <= 57;\n    }\n    Character.IsNumeric = IsNumeric;\n})(Character || (Character = {}));\n// ------------------------------------------------------------------\n// MemberExpression\n// ------------------------------------------------------------------\nvar MemberExpression;\n(function (MemberExpression) {\n    function IsFirstCharacterNumeric(value) {\n        if (value.length === 0)\n            return false;\n        return Character.IsNumeric(value.charCodeAt(0));\n    }\n    function IsAccessor(value) {\n        if (IsFirstCharacterNumeric(value))\n            return false;\n        for (let i = 0; i < value.length; i++) {\n            const code = value.charCodeAt(i);\n            const check = Character.IsAlpha(code) || Character.IsNumeric(code) || Character.DollarSign(code) || Character.IsUnderscore(code);\n            if (!check)\n                return false;\n        }\n        return true;\n    }\n    function EscapeHyphen(key) {\n        return key.replace(/'/g, \"\\\\'\");\n    }\n    function Encode(object, key) {\n        return IsAccessor(key) ? `${object}.${key}` : `${object}['${EscapeHyphen(key)}']`;\n    }\n    MemberExpression.Encode = Encode;\n})(MemberExpression || (MemberExpression = {}));\n// ------------------------------------------------------------------\n// Identifier\n// ------------------------------------------------------------------\nvar Identifier;\n(function (Identifier) {\n    function Encode($id) {\n        const buffer = [];\n        for (let i = 0; i < $id.length; i++) {\n            const code = $id.charCodeAt(i);\n            if (Character.IsNumeric(code) || Character.IsAlpha(code)) {\n                buffer.push($id.charAt(i));\n            }\n            else {\n                buffer.push(`_${code}_`);\n            }\n        }\n        return buffer.join('').replace(/__/g, '_');\n    }\n    Identifier.Encode = Encode;\n})(Identifier || (Identifier = {}));\n// ------------------------------------------------------------------\n// LiteralString\n// ------------------------------------------------------------------\nvar LiteralString;\n(function (LiteralString) {\n    function Escape(content) {\n        return content.replace(/'/g, \"\\\\'\");\n    }\n    LiteralString.Escape = Escape;\n})(LiteralString || (LiteralString = {}));\n// ------------------------------------------------------------------\n// Errors\n// ------------------------------------------------------------------\nexport class TypeCompilerUnknownTypeError extends TypeBoxError {\n    constructor(schema) {\n        super('Unknown type');\n        this.schema = schema;\n    }\n}\nexport class TypeCompilerTypeGuardError extends TypeBoxError {\n    constructor(schema) {\n        super('Preflight validation check failed to guard for the given schema');\n        this.schema = schema;\n    }\n}\n// ------------------------------------------------------------------\n// Policy\n// ------------------------------------------------------------------\nexport var Policy;\n(function (Policy) {\n    function IsExactOptionalProperty(value, key, expression) {\n        return TypeSystemPolicy.ExactOptionalPropertyTypes ? `('${key}' in ${value} ? ${expression} : true)` : `(${MemberExpression.Encode(value, key)} !== undefined ? ${expression} : true)`;\n    }\n    Policy.IsExactOptionalProperty = IsExactOptionalProperty;\n    function IsObjectLike(value) {\n        return !TypeSystemPolicy.AllowArrayObject ? `(typeof ${value} === 'object' && ${value} !== null && !Array.isArray(${value}))` : `(typeof ${value} === 'object' && ${value} !== null)`;\n    }\n    Policy.IsObjectLike = IsObjectLike;\n    function IsRecordLike(value) {\n        return !TypeSystemPolicy.AllowArrayObject\n            ? `(typeof ${value} === 'object' && ${value} !== null && !Array.isArray(${value}) && !(${value} instanceof Date) && !(${value} instanceof Uint8Array))`\n            : `(typeof ${value} === 'object' && ${value} !== null && !(${value} instanceof Date) && !(${value} instanceof Uint8Array))`;\n    }\n    Policy.IsRecordLike = IsRecordLike;\n    function IsNumberLike(value) {\n        return TypeSystemPolicy.AllowNaN ? `typeof ${value} === 'number'` : `Number.isFinite(${value})`;\n    }\n    Policy.IsNumberLike = IsNumberLike;\n    function IsVoidLike(value) {\n        return TypeSystemPolicy.AllowNullVoid ? `(${value} === undefined || ${value} === null)` : `${value} === undefined`;\n    }\n    Policy.IsVoidLike = IsVoidLike;\n})(Policy || (Policy = {}));\n/** Compiles Types for Runtime Type Checking */\nexport var TypeCompiler;\n(function (TypeCompiler) {\n    // ----------------------------------------------------------------\n    // Guards\n    // ----------------------------------------------------------------\n    function IsAnyOrUnknown(schema) {\n        return schema[Kind] === 'Any' || schema[Kind] === 'Unknown';\n    }\n    // ----------------------------------------------------------------\n    // Types\n    // ----------------------------------------------------------------\n    function* FromAny(schema, references, value) {\n        yield 'true';\n    }\n    function* FromArray(schema, references, value) {\n        yield `Array.isArray(${value})`;\n        const [parameter, accumulator] = [CreateParameter('value', 'any'), CreateParameter('acc', 'number')];\n        if (IsNumber(schema.maxItems))\n            yield `${value}.length <= ${schema.maxItems}`;\n        if (IsNumber(schema.minItems))\n            yield `${value}.length >= ${schema.minItems}`;\n        const elementExpression = CreateExpression(schema.items, references, 'value');\n        yield `${value}.every((${parameter}) => ${elementExpression})`;\n        if (IsSchema(schema.contains) || IsNumber(schema.minContains) || IsNumber(schema.maxContains)) {\n            const containsSchema = IsSchema(schema.contains) ? schema.contains : Never();\n            const checkExpression = CreateExpression(containsSchema, references, 'value');\n            const checkMinContains = IsNumber(schema.minContains) ? [`(count >= ${schema.minContains})`] : [];\n            const checkMaxContains = IsNumber(schema.maxContains) ? [`(count <= ${schema.maxContains})`] : [];\n            const checkCount = `const count = value.reduce((${accumulator}, ${parameter}) => ${checkExpression} ? acc + 1 : acc, 0)`;\n            const check = [`(count > 0)`, ...checkMinContains, ...checkMaxContains].join(' && ');\n            yield `((${parameter}) => { ${checkCount}; return ${check}})(${value})`;\n        }\n        if (schema.uniqueItems === true) {\n            const check = `const hashed = hash(element); if(set.has(hashed)) { return false } else { set.add(hashed) } } return true`;\n            const block = `const set = new Set(); for(const element of value) { ${check} }`;\n            yield `((${parameter}) => { ${block} )(${value})`;\n        }\n    }\n    function* FromAsyncIterator(schema, references, value) {\n        yield `(typeof value === 'object' && Symbol.asyncIterator in ${value})`;\n    }\n    function* FromBigInt(schema, references, value) {\n        yield `(typeof ${value} === 'bigint')`;\n        if (IsBigInt(schema.exclusiveMaximum))\n            yield `${value} < BigInt(${schema.exclusiveMaximum})`;\n        if (IsBigInt(schema.exclusiveMinimum))\n            yield `${value} > BigInt(${schema.exclusiveMinimum})`;\n        if (IsBigInt(schema.maximum))\n            yield `${value} <= BigInt(${schema.maximum})`;\n        if (IsBigInt(schema.minimum))\n            yield `${value} >= BigInt(${schema.minimum})`;\n        if (IsBigInt(schema.multipleOf))\n            yield `(${value} % BigInt(${schema.multipleOf})) === 0`;\n    }\n    function* FromBoolean(schema, references, value) {\n        yield `(typeof ${value} === 'boolean')`;\n    }\n    function* FromConstructor(schema, references, value) {\n        yield* Visit(schema.returns, references, `${value}.prototype`);\n    }\n    function* FromDate(schema, references, value) {\n        yield `(${value} instanceof Date) && Number.isFinite(${value}.getTime())`;\n        if (IsNumber(schema.exclusiveMaximumTimestamp))\n            yield `${value}.getTime() < ${schema.exclusiveMaximumTimestamp}`;\n        if (IsNumber(schema.exclusiveMinimumTimestamp))\n            yield `${value}.getTime() > ${schema.exclusiveMinimumTimestamp}`;\n        if (IsNumber(schema.maximumTimestamp))\n            yield `${value}.getTime() <= ${schema.maximumTimestamp}`;\n        if (IsNumber(schema.minimumTimestamp))\n            yield `${value}.getTime() >= ${schema.minimumTimestamp}`;\n        if (IsNumber(schema.multipleOfTimestamp))\n            yield `(${value}.getTime() % ${schema.multipleOfTimestamp}) === 0`;\n    }\n    function* FromFunction(schema, references, value) {\n        yield `(typeof ${value} === 'function')`;\n    }\n    function* FromInteger(schema, references, value) {\n        yield `Number.isInteger(${value})`;\n        if (IsNumber(schema.exclusiveMaximum))\n            yield `${value} < ${schema.exclusiveMaximum}`;\n        if (IsNumber(schema.exclusiveMinimum))\n            yield `${value} > ${schema.exclusiveMinimum}`;\n        if (IsNumber(schema.maximum))\n            yield `${value} <= ${schema.maximum}`;\n        if (IsNumber(schema.minimum))\n            yield `${value} >= ${schema.minimum}`;\n        if (IsNumber(schema.multipleOf))\n            yield `(${value} % ${schema.multipleOf}) === 0`;\n    }\n    function* FromIntersect(schema, references, value) {\n        const check1 = schema.allOf.map((schema) => CreateExpression(schema, references, value)).join(' && ');\n        if (schema.unevaluatedProperties === false) {\n            const keyCheck = CreateVariable(`${new RegExp(KeyOfPattern(schema))};`);\n            const check2 = `Object.getOwnPropertyNames(${value}).every(key => ${keyCheck}.test(key))`;\n            yield `(${check1} && ${check2})`;\n        }\n        else if (IsSchema(schema.unevaluatedProperties)) {\n            const keyCheck = CreateVariable(`${new RegExp(KeyOfPattern(schema))};`);\n            const check2 = `Object.getOwnPropertyNames(${value}).every(key => ${keyCheck}.test(key) || ${CreateExpression(schema.unevaluatedProperties, references, `${value}[key]`)})`;\n            yield `(${check1} && ${check2})`;\n        }\n        else {\n            yield `(${check1})`;\n        }\n    }\n    function* FromIterator(schema, references, value) {\n        yield `(typeof value === 'object' && Symbol.iterator in ${value})`;\n    }\n    function* FromLiteral(schema, references, value) {\n        if (typeof schema.const === 'number' || typeof schema.const === 'boolean') {\n            yield `(${value} === ${schema.const})`;\n        }\n        else {\n            yield `(${value} === '${LiteralString.Escape(schema.const)}')`;\n        }\n    }\n    function* FromNever(schema, references, value) {\n        yield `false`;\n    }\n    function* FromNot(schema, references, value) {\n        const expression = CreateExpression(schema.not, references, value);\n        yield `(!${expression})`;\n    }\n    function* FromNull(schema, references, value) {\n        yield `(${value} === null)`;\n    }\n    function* FromNumber(schema, references, value) {\n        yield Policy.IsNumberLike(value);\n        if (IsNumber(schema.exclusiveMaximum))\n            yield `${value} < ${schema.exclusiveMaximum}`;\n        if (IsNumber(schema.exclusiveMinimum))\n            yield `${value} > ${schema.exclusiveMinimum}`;\n        if (IsNumber(schema.maximum))\n            yield `${value} <= ${schema.maximum}`;\n        if (IsNumber(schema.minimum))\n            yield `${value} >= ${schema.minimum}`;\n        if (IsNumber(schema.multipleOf))\n            yield `(${value} % ${schema.multipleOf}) === 0`;\n    }\n    function* FromObject(schema, references, value) {\n        yield Policy.IsObjectLike(value);\n        if (IsNumber(schema.minProperties))\n            yield `Object.getOwnPropertyNames(${value}).length >= ${schema.minProperties}`;\n        if (IsNumber(schema.maxProperties))\n            yield `Object.getOwnPropertyNames(${value}).length <= ${schema.maxProperties}`;\n        const knownKeys = Object.getOwnPropertyNames(schema.properties);\n        for (const knownKey of knownKeys) {\n            const memberExpression = MemberExpression.Encode(value, knownKey);\n            const property = schema.properties[knownKey];\n            if (schema.required && schema.required.includes(knownKey)) {\n                yield* Visit(property, references, memberExpression);\n                if (ExtendsUndefinedCheck(property) || IsAnyOrUnknown(property))\n                    yield `('${knownKey}' in ${value})`;\n            }\n            else {\n                const expression = CreateExpression(property, references, memberExpression);\n                yield Policy.IsExactOptionalProperty(value, knownKey, expression);\n            }\n        }\n        if (schema.additionalProperties === false) {\n            if (schema.required && schema.required.length === knownKeys.length) {\n                yield `Object.getOwnPropertyNames(${value}).length === ${knownKeys.length}`;\n            }\n            else {\n                const keys = `[${knownKeys.map((key) => `'${key}'`).join(', ')}]`;\n                yield `Object.getOwnPropertyNames(${value}).every(key => ${keys}.includes(key))`;\n            }\n        }\n        if (typeof schema.additionalProperties === 'object') {\n            const expression = CreateExpression(schema.additionalProperties, references, `${value}[key]`);\n            const keys = `[${knownKeys.map((key) => `'${key}'`).join(', ')}]`;\n            yield `(Object.getOwnPropertyNames(${value}).every(key => ${keys}.includes(key) || ${expression}))`;\n        }\n    }\n    function* FromPromise(schema, references, value) {\n        yield `(typeof value === 'object' && typeof ${value}.then === 'function')`;\n    }\n    function* FromRecord(schema, references, value) {\n        yield Policy.IsRecordLike(value);\n        if (IsNumber(schema.minProperties))\n            yield `Object.getOwnPropertyNames(${value}).length >= ${schema.minProperties}`;\n        if (IsNumber(schema.maxProperties))\n            yield `Object.getOwnPropertyNames(${value}).length <= ${schema.maxProperties}`;\n        const [patternKey, patternSchema] = Object.entries(schema.patternProperties)[0];\n        const variable = CreateVariable(`${new RegExp(patternKey)}`);\n        const check1 = CreateExpression(patternSchema, references, 'value');\n        const check2 = IsSchema(schema.additionalProperties) ? CreateExpression(schema.additionalProperties, references, value) : schema.additionalProperties === false ? 'false' : 'true';\n        const expression = `(${variable}.test(key) ? ${check1} : ${check2})`;\n        yield `(Object.entries(${value}).every(([key, value]) => ${expression}))`;\n    }\n    function* FromRef(schema, references, value) {\n        const target = Deref(schema, references);\n        // Reference: If we have seen this reference before we can just yield and return the function call.\n        // If this isn't the case we defer to visit to generate and set the function for subsequent passes.\n        if (state.functions.has(schema.$ref))\n            return yield `${CreateFunctionName(schema.$ref)}(${value})`;\n        yield* Visit(target, references, value);\n    }\n    function* FromRegExp(schema, references, value) {\n        const variable = CreateVariable(`${new RegExp(schema.source, schema.flags)};`);\n        yield `(typeof ${value} === 'string')`;\n        if (IsNumber(schema.maxLength))\n            yield `${value}.length <= ${schema.maxLength}`;\n        if (IsNumber(schema.minLength))\n            yield `${value}.length >= ${schema.minLength}`;\n        yield `${variable}.test(${value})`;\n    }\n    function* FromString(schema, references, value) {\n        yield `(typeof ${value} === 'string')`;\n        if (IsNumber(schema.maxLength))\n            yield `${value}.length <= ${schema.maxLength}`;\n        if (IsNumber(schema.minLength))\n            yield `${value}.length >= ${schema.minLength}`;\n        if (schema.pattern !== undefined) {\n            const variable = CreateVariable(`${new RegExp(schema.pattern)};`);\n            yield `${variable}.test(${value})`;\n        }\n        if (schema.format !== undefined) {\n            yield `format('${schema.format}', ${value})`;\n        }\n    }\n    function* FromSymbol(schema, references, value) {\n        yield `(typeof ${value} === 'symbol')`;\n    }\n    function* FromTemplateLiteral(schema, references, value) {\n        yield `(typeof ${value} === 'string')`;\n        const variable = CreateVariable(`${new RegExp(schema.pattern)};`);\n        yield `${variable}.test(${value})`;\n    }\n    function* FromThis(schema, references, value) {\n        // Note: This types are assured to be hoisted prior to this call. Just yield the function.\n        yield `${CreateFunctionName(schema.$ref)}(${value})`;\n    }\n    function* FromTuple(schema, references, value) {\n        yield `Array.isArray(${value})`;\n        if (schema.items === undefined)\n            return yield `${value}.length === 0`;\n        yield `(${value}.length === ${schema.maxItems})`;\n        for (let i = 0; i < schema.items.length; i++) {\n            const expression = CreateExpression(schema.items[i], references, `${value}[${i}]`);\n            yield `${expression}`;\n        }\n    }\n    function* FromUndefined(schema, references, value) {\n        yield `${value} === undefined`;\n    }\n    function* FromUnion(schema, references, value) {\n        const expressions = schema.anyOf.map((schema) => CreateExpression(schema, references, value));\n        yield `(${expressions.join(' || ')})`;\n    }\n    function* FromUint8Array(schema, references, value) {\n        yield `${value} instanceof Uint8Array`;\n        if (IsNumber(schema.maxByteLength))\n            yield `(${value}.length <= ${schema.maxByteLength})`;\n        if (IsNumber(schema.minByteLength))\n            yield `(${value}.length >= ${schema.minByteLength})`;\n    }\n    function* FromUnknown(schema, references, value) {\n        yield 'true';\n    }\n    function* FromVoid(schema, references, value) {\n        yield Policy.IsVoidLike(value);\n    }\n    function* FromKind(schema, references, value) {\n        const instance = state.instances.size;\n        state.instances.set(instance, schema);\n        yield `kind('${schema[Kind]}', ${instance}, ${value})`;\n    }\n    function* Visit(schema, references, value, useHoisting = true) {\n        const references_ = IsString(schema.$id) ? [...references, schema] : references;\n        const schema_ = schema;\n        // --------------------------------------------------------------\n        // Hoisting\n        // --------------------------------------------------------------\n        if (useHoisting && IsString(schema.$id)) {\n            const functionName = CreateFunctionName(schema.$id);\n            if (state.functions.has(functionName)) {\n                return yield `${functionName}(${value})`;\n            }\n            else {\n                const functionCode = CreateFunction(functionName, schema, references, 'value', false);\n                state.functions.set(functionName, functionCode);\n                return yield `${functionName}(${value})`;\n            }\n        }\n        switch (schema_[Kind]) {\n            case 'Any':\n                return yield* FromAny(schema_, references_, value);\n            case 'Array':\n                return yield* FromArray(schema_, references_, value);\n            case 'AsyncIterator':\n                return yield* FromAsyncIterator(schema_, references_, value);\n            case 'BigInt':\n                return yield* FromBigInt(schema_, references_, value);\n            case 'Boolean':\n                return yield* FromBoolean(schema_, references_, value);\n            case 'Constructor':\n                return yield* FromConstructor(schema_, references_, value);\n            case 'Date':\n                return yield* FromDate(schema_, references_, value);\n            case 'Function':\n                return yield* FromFunction(schema_, references_, value);\n            case 'Integer':\n                return yield* FromInteger(schema_, references_, value);\n            case 'Intersect':\n                return yield* FromIntersect(schema_, references_, value);\n            case 'Iterator':\n                return yield* FromIterator(schema_, references_, value);\n            case 'Literal':\n                return yield* FromLiteral(schema_, references_, value);\n            case 'Never':\n                return yield* FromNever(schema_, references_, value);\n            case 'Not':\n                return yield* FromNot(schema_, references_, value);\n            case 'Null':\n                return yield* FromNull(schema_, references_, value);\n            case 'Number':\n                return yield* FromNumber(schema_, references_, value);\n            case 'Object':\n                return yield* FromObject(schema_, references_, value);\n            case 'Promise':\n                return yield* FromPromise(schema_, references_, value);\n            case 'Record':\n                return yield* FromRecord(schema_, references_, value);\n            case 'Ref':\n                return yield* FromRef(schema_, references_, value);\n            case 'RegExp':\n                return yield* FromRegExp(schema_, references_, value);\n            case 'String':\n                return yield* FromString(schema_, references_, value);\n            case 'Symbol':\n                return yield* FromSymbol(schema_, references_, value);\n            case 'TemplateLiteral':\n                return yield* FromTemplateLiteral(schema_, references_, value);\n            case 'This':\n                return yield* FromThis(schema_, references_, value);\n            case 'Tuple':\n                return yield* FromTuple(schema_, references_, value);\n            case 'Undefined':\n                return yield* FromUndefined(schema_, references_, value);\n            case 'Union':\n                return yield* FromUnion(schema_, references_, value);\n            case 'Uint8Array':\n                return yield* FromUint8Array(schema_, references_, value);\n            case 'Unknown':\n                return yield* FromUnknown(schema_, references_, value);\n            case 'Void':\n                return yield* FromVoid(schema_, references_, value);\n            default:\n                if (!TypeRegistry.Has(schema_[Kind]))\n                    throw new TypeCompilerUnknownTypeError(schema);\n                return yield* FromKind(schema_, references_, value);\n        }\n    }\n    // ----------------------------------------------------------------\n    // Compiler State\n    // ----------------------------------------------------------------\n    // prettier-ignore\n    const state = {\n        language: 'javascript', // target language\n        functions: new Map(), // local functions\n        variables: new Map(), // local variables\n        instances: new Map() // exterior kind instances\n    };\n    // ----------------------------------------------------------------\n    // Compiler Factory\n    // ----------------------------------------------------------------\n    function CreateExpression(schema, references, value, useHoisting = true) {\n        return `(${[...Visit(schema, references, value, useHoisting)].join(' && ')})`;\n    }\n    function CreateFunctionName($id) {\n        return `check_${Identifier.Encode($id)}`;\n    }\n    function CreateVariable(expression) {\n        const variableName = `local_${state.variables.size}`;\n        state.variables.set(variableName, `const ${variableName} = ${expression}`);\n        return variableName;\n    }\n    function CreateFunction(name, schema, references, value, useHoisting = true) {\n        const [newline, pad] = ['\\n', (length) => ''.padStart(length, ' ')];\n        const parameter = CreateParameter('value', 'any');\n        const returns = CreateReturns('boolean');\n        const expression = [...Visit(schema, references, value, useHoisting)].map((expression) => `${pad(4)}${expression}`).join(` &&${newline}`);\n        return `function ${name}(${parameter})${returns} {${newline}${pad(2)}return (${newline}${expression}${newline}${pad(2)})\\n}`;\n    }\n    function CreateParameter(name, type) {\n        const annotation = state.language === 'typescript' ? `: ${type}` : '';\n        return `${name}${annotation}`;\n    }\n    function CreateReturns(type) {\n        return state.language === 'typescript' ? `: ${type}` : '';\n    }\n    // ----------------------------------------------------------------\n    // Compile\n    // ----------------------------------------------------------------\n    function Build(schema, references, options) {\n        const functionCode = CreateFunction('check', schema, references, 'value'); // will populate functions and variables\n        const parameter = CreateParameter('value', 'any');\n        const returns = CreateReturns('boolean');\n        const functions = [...state.functions.values()];\n        const variables = [...state.variables.values()];\n        // prettier-ignore\n        const checkFunction = IsString(schema.$id) // ensure top level schemas with $id's are hoisted\n            ? `return function check(${parameter})${returns} {\\n  return ${CreateFunctionName(schema.$id)}(value)\\n}`\n            : `return ${functionCode}`;\n        return [...variables, ...functions, checkFunction].join('\\n');\n    }\n    /** Generates the code used to assert this type and returns it as a string */\n    function Code(...args) {\n        const defaults = { language: 'javascript' };\n        // prettier-ignore\n        const [schema, references, options] = (args.length === 2 && IsArray(args[1]) ? [args[0], args[1], defaults] :\n            args.length === 2 && !IsArray(args[1]) ? [args[0], [], args[1]] :\n                args.length === 3 ? [args[0], args[1], args[2]] :\n                    args.length === 1 ? [args[0], [], defaults] :\n                        [null, [], defaults]);\n        // compiler-reset\n        state.language = options.language;\n        state.variables.clear();\n        state.functions.clear();\n        state.instances.clear();\n        if (!IsSchema(schema))\n            throw new TypeCompilerTypeGuardError(schema);\n        for (const schema of references)\n            if (!IsSchema(schema))\n                throw new TypeCompilerTypeGuardError(schema);\n        return Build(schema, references, options);\n    }\n    TypeCompiler.Code = Code;\n    /** Compiles a TypeBox type for optimal runtime type checking. Types must be valid TypeBox types of TSchema */\n    function Compile(schema, references = []) {\n        const generatedCode = Code(schema, references, { language: 'javascript' });\n        const compiledFunction = globalThis.Function('kind', 'format', 'hash', generatedCode);\n        const instances = new Map(state.instances);\n        function typeRegistryFunction(kind, instance, value) {\n            if (!TypeRegistry.Has(kind) || !instances.has(instance))\n                return false;\n            const checkFunc = TypeRegistry.Get(kind);\n            const schema = instances.get(instance);\n            return checkFunc(schema, value);\n        }\n        function formatRegistryFunction(format, value) {\n            if (!FormatRegistry.Has(format))\n                return false;\n            const checkFunc = FormatRegistry.Get(format);\n            return checkFunc(value);\n        }\n        function hashFunction(value) {\n            return Hash(value);\n        }\n        const checkFunction = compiledFunction(typeRegistryFunction, formatRegistryFunction, hashFunction);\n        return new TypeCheck(schema, references, checkFunction, generatedCode);\n    }\n    TypeCompiler.Compile = Compile;\n})(TypeCompiler || (TypeCompiler = {}));\n", null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, "import type { ParsedMVF, RawMVF } from './types/bundle.js';\n\nexport type TextDecoderFn = typeof TextDecoder.prototype.decode;\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\ntype FolderKey<S extends string> = S extends `${infer _}.geojson` ? never : S extends `${infer _}.json` ? never : S;\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\ntype FileKey<S extends string> = S extends `${infer _}.geojson` ? S : S extends `${infer _}.json` ? S : never;\n\ntype ExhaustiveArray<T extends readonly unknown[], U> = [U] extends [T[number]] ? T : [...T, Exclude<U, T[number]>];\n\nconst defaultEntry = <K extends FolderKey<keyof RawMVF>>(folder: K): ParsedMVF[K] => {\n\t// Per the spec, these are required to exist, but could potentially be empty.\n\tif (folder === 'space' || folder === 'obstruction' || folder === 'entrance') {\n\t\treturn {} as unknown as ParsedMVF[K];\n\t}\n\treturn undefined as unknown as ParsedMVF[K];\n};\n\nconst FILE_EXTENSION = /\\.json|\\.geojson$/;\n\nconst rawFolderToParsed = <K extends FolderKey<keyof RawMVF>>(\n\traw: RawMVF,\n\tfolder: K,\n\tdecode: TextDecoderFn,\n): ParsedMVF[K] => {\n\tconst rawFolder = raw[folder];\n\tif (typeof rawFolder !== 'object' || Object.keys(rawFolder).length === 0) {\n\t\treturn defaultEntry(folder);\n\t}\n\n\tconst contents: Record<string, string> = {};\n\tfor (const [key, value] of Object.entries(rawFolder)) {\n\t\tconst floorId = key.replace(FILE_EXTENSION, '');\n\t\tcontents[floorId] = JSON.parse(decode(value));\n\t}\n\treturn contents as unknown as ParsedMVF[K];\n};\n\n// This oddity is a way to enforce a compiler error if either of these arrays\n// is missing a file or folder that should be mentioned.\n\ntype OptionalKeys<O> = { [K in keyof O]-?: undefined extends O[K] ? K : never }[keyof O];\ntype OptionalFiles = FileKey<OptionalKeys<RawMVF>>;\nconst _OPTIONAL_FILES = [\n\t'floorstack.json',\n\t'styles.json',\n\t'shapes.json',\n\t'mapstack.json',\n\t'floor.geojson',\n\t'tileset.json',\n\t'location.json',\n\t'category.json',\n\t'navigationFlags.json',\n] as const;\nconst OPTIONAL_FILES = _OPTIONAL_FILES satisfies ExhaustiveArray<typeof _OPTIONAL_FILES, OptionalFiles>;\n\ntype OptionalFolders = FolderKey<OptionalKeys<RawMVF>>;\nconst _OPTIONAL_FOLDERS = [\n\t'annotation',\n\t'textAreas',\n\t'enterprise',\n\t'floorImages',\n\t'shapeInstances',\n\t'modelInstances',\n\t'window',\n\t'area',\n\t'facade',\n] as const;\nconst OPTIONAL_FOLDERS = _OPTIONAL_FOLDERS satisfies ExhaustiveArray<typeof _OPTIONAL_FOLDERS, OptionalFolders>;\n\nexport const rawToParsedMVF = (raw: RawMVF): ParsedMVF => {\n\tconst decoder = new TextDecoder('utf-8');\n\tconst decode = decoder.decode.bind(decoder) satisfies TextDecoderFn;\n\n\tconst parsedMVF: ParsedMVF = {\n\t\t'manifest.geojson': JSON.parse(decode(raw['manifest.geojson'])),\n\t\t'mapstack.geojson': JSON.parse(decode(raw['mapstack.geojson'])),\n\t\t'map.geojson': JSON.parse(decode(raw['map.geojson'])),\n\t\t'node.geojson': JSON.parse(decode(raw['node.geojson'])),\n\t\t'connection.json': JSON.parse(decode(raw['connection.json'])),\n\t\tspace: rawFolderToParsed(raw, 'space', decode),\n\t\tobstruction: rawFolderToParsed(raw, 'obstruction', decode),\n\t\tentrance: rawFolderToParsed(raw, 'entrance', decode),\n\t};\n\n\tfor (const key of OPTIONAL_FILES) {\n\t\tif (raw[key]) {\n\t\t\tparsedMVF[key] = JSON.parse(decode(raw[key]));\n\t\t}\n\t}\n\n\tfor (const key of OPTIONAL_FOLDERS) {\n\t\tif (raw[key]) {\n\t\t\t// @ts-expect-error since the type of each of these keys when parsed\n\t\t\t// is different.\n\t\t\tparsedMVF[key] = rawFolderToParsed(raw, key, decode);\n\t\t}\n\t}\n\n\treturn parsedMVF;\n};\n", "import { AnnotationsExtension } from '@mappedin/mvf-annotations';\nimport { CMSExtension } from '@mappedin/mvf-cms';\nimport { ConnectionsExtension } from '@mappedin/mvf-connections';\nimport { type DecompressError, type MVFParserTransformedBundle, createParser } from '@mappedin/mvf-core';\nimport { DefaultStyleExtension } from '@mappedin/mvf-default-style';\nimport { FacadeExtension } from '@mappedin/mvf-facade';\nimport { FloorImagesExtension } from '@mappedin/mvf-floor-images';\nimport { FloorStackExtension } from '@mappedin/mvf-floor-stacks';\nimport { KindsExtension } from '@mappedin/mvf-kinds';\nimport { LocationsExtension } from '@mappedin/mvf-locations';\nimport { NavigationFlagsExtension } from '@mappedin/mvf-navigation-flags';\nimport { NodesExtension } from '@mappedin/mvf-nodes';\nimport { OutdoorsExtension } from '@mappedin/mvf-outdoors';\nimport { TilesetExtension } from '@mappedin/mvf-tileset';\nimport { TraversabilityExtension } from '@mappedin/mvf-traversability';\nimport { type Result, err, ok } from '@mappedin/safe-types/result';\nimport type { ParsedMVF } from '../types/bundle.js';\nimport { buildBuilderOptions } from './builderOptions.js';\nimport { buildAnnotations } from './builders/annotationBuilder.js';\nimport { buildConnections } from './builders/connectionBuilder.js';\nimport { buildEnterprise } from './builders/enterpriseBuilder.js';\nimport { buildFacade } from './builders/facadeBuilder.js';\nimport { buildFloors } from './builders/floorBuilder.js';\nimport { buildFloorImages } from './builders/floorImagesBuilder.js';\nimport { buildFloorStacks } from './builders/floorStackBuilder.js';\nimport { buildGeometry } from './builders/geometryBuilder.js';\nimport { buildLocations } from './builders/locationBuilder.js';\nimport { buildManifest } from './builders/manifestBuilder.js';\nimport { buildNodes } from './builders/nodeBuilder.js';\nimport { buildStyles } from './builders/styleBuilder.js';\n\nconst STANDARD_MVF_V3_PARSER = createParser()\n\t.extendOptional(NavigationFlagsExtension)\n\t.extendOptional(NodesExtension)\n\t.extendOptional(ConnectionsExtension)\n\t.extendOptional(KindsExtension)\n\t.extendOptional(TraversabilityExtension)\n\t.extendOptional(DefaultStyleExtension)\n\t.extendOptional(FloorStackExtension)\n\t.extendOptional(OutdoorsExtension)\n\t.extendOptional(TilesetExtension)\n\t.extendOptional(FloorImagesExtension)\n\t.extendOptional(FacadeExtension)\n\t.extendOptional(AnnotationsExtension)\n\t.extendOptional(LocationsExtension)\n\t.extendOptional(CMSExtension)\n\t.build({ cspSafe: true })\n\t.expect('Invalid parser, this should never happen. Likely a bug in the MVFv2 library, or one of the extensions.');\n\n/**\n * This represents the result of parsing an MVFv3 object with the extensions the MVFv2 converter\n * can use. Note that nearly all extensions are actually optional.\n */\nexport type MVFv2_STANDARD_MVFv3 = MVFParserTransformedBundle<typeof STANDARD_MVF_V3_PARSER>;\n\n/**\n * Converts an unzipped MVFv3 object that has the extensions needed for the MVFv2 converter\n * into a MVFv2 object.\n *\n * If the MVFv3 is still zipped, use {@link extractAndConvertMVFv3} instead.\n *\n * @param v3 - The unzipped MVFv3 object to convert.\n * @returns The converted MVFv2 object.\n */\nexport function convertUnzippedStandardMVFv3ToParsedMVFv2(v3: MVFv2_STANDARD_MVFv3): ParsedMVF {\n\tconst builderOptions = buildBuilderOptions(v3);\n\n\tconst floors = buildFloors(v3, builderOptions);\n\tconst geometry = buildGeometry(v3, builderOptions);\n\tconst nodes = buildNodes(v3, builderOptions);\n\tconst connections = buildConnections(v3, builderOptions);\n\tconst styles = buildStyles(v3, builderOptions);\n\tconst floorStacks = buildFloorStacks(v3, builderOptions);\n\tconst floorImages = buildFloorImages(v3, builderOptions);\n\tconst facade = buildFacade(v3, builderOptions);\n\tconst annotations = buildAnnotations(v3, builderOptions);\n\tconst locations = buildLocations(v3, builderOptions);\n\tconst enterprise = buildEnterprise(v3, builderOptions);\n\tconst manifest = buildManifest(v3, builderOptions);\n\tconst v2: ParsedMVF = {\n\t\t// Slightly risky, extending these v3 definitions will add those properties to the v2 object\n\t\t...(v3.tileset ? { 'tileset.json': v3.tileset } : {}),\n\t\t...(v3.navigationFlags ? { 'navigationFlags.json': v3.navigationFlags } : {}),\n\t\t...floors,\n\t\t...geometry,\n\t\t...nodes,\n\t\t...connections,\n\t\t...styles,\n\t\t...floorStacks,\n\t\t...floorImages,\n\t\t...facade,\n\t\t...annotations,\n\t\t...locations,\n\t\t...enterprise,\n\t\t...manifest,\n\t};\n\n\treturn v2;\n}\n\n/**\n * Converts a zip file that hopefully contains an MVFv3 object to an MVFv2 format.\n * This is the main entry point for MVF conversion.\n *\n * @param data - The MVFv3 zip file data to convert.\n * @returns A promise containing the Result of the conversion, which can be unwrapped into an MVFv2 object or an error if the MVFv3 is invalid.\n */\nexport async function extractAndConvertMVFv3(data: Uint8Array): Promise<Result<ParsedMVF, DecompressError>> {\n\tconst result = await STANDARD_MVF_V3_PARSER.decompress(data);\n\tif (result.isOk()) {\n\t\treturn ok(convertUnzippedStandardMVFv3ToParsedMVFv2(result.value));\n\t} else {\n\t\treturn err(result.error);\n\t}\n}\n\n/**\n * Converts an MVFv3 zip file to an MVFv2 format, WITHOUT validating the structure of the MVFv3.\n *\n * If you are absolutely sure that the MVFv3 is valid, and do not want to pay the validation cost, you can use this function.\n *\n * However, if this is NOT a valid MVFv3, you may get unexpected results.\n *\n * @param data - The MVFv3 zip file data to convert.\n * @returns A promise containing the Result of the conversion, which can be unwrapped into an MVFv2 object or an error if the MVFv3 is invalid.\n */\nexport async function extractAndConvertMVFv3Unsafe(data: Uint8Array): Promise<Result<ParsedMVF, DecompressError>> {\n\tconst result = await STANDARD_MVF_V3_PARSER.decompressUnsafe(data);\n\tif (result.isOk()) {\n\t\treturn ok(convertUnzippedStandardMVFv3ToParsedMVFv2(result.value as MVFv2_STANDARD_MVFv3));\n\t} else {\n\t\treturn err(result.error);\n\t}\n}\n\n/**\n * Converts a zip file that hopefully contains an MVFv3 object to an MVFv2 format, synchronously.\n *\n * @param data - The MVFv3 zip file data to convert.\n * @returns A promise containing the Result of the conversion, which can be unwrapped into an MVFv2 object or an error if the MVFv3 is invalid.\n */\nexport function extractAndConvertMVFv3Sync(data: Uint8Array): Result<ParsedMVF, DecompressError> {\n\tconst result = STANDARD_MVF_V3_PARSER.decompressSync(data);\n\tif (result.isOk()) {\n\t\treturn ok(convertUnzippedStandardMVFv3ToParsedMVFv2(result.value as MVFv2_STANDARD_MVFv3));\n\t} else {\n\t\treturn err(result.error);\n\t}\n}\n\n/**\n * Converts an MVFv3 zip file to an MVFv2 format synchronously, WITHOUT validating the structure of the MVFv3.\n *\n * If you are absolutely sure that the MVFv3 is valid, and do not want to pay the validation cost, you can use this function.\n *\n * However, if this is NOT a valid MVFv3, you may get unexpected results.\n *\n * @param data - The MVFv3 zip file data to convert.\n * @returns A promise containing the Result of the conversion, which can be unwrapped into an MVFv2 object or an error if the MVFv3 is invalid.\n */\nexport function extractAndConvertMVFv3UnsafeSync(data: Uint8Array): Result<ParsedMVF, DecompressError> {\n\tconst result = STANDARD_MVF_V3_PARSER.decompressUnsafeSync(data);\n\tif (result.isOk()) {\n\t\treturn ok(convertUnzippedStandardMVFv3ToParsedMVFv2(result.value as MVFv2_STANDARD_MVFv3));\n\t} else {\n\t\treturn err(result.error);\n\t}\n}\n", null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, "import type { GeometryFeature, GeometryId } from '@mappedin/mvf-core';\nimport type { NavigationFlagDeclarations } from '@mappedin/mvf-navigation-flags';\nimport type { NodeFeature, NodeId, NodeNeighbor } from '@mappedin/mvf-nodes';\nimport { type GeometryMaps, createGeometryMaps } from './converterUtils.js';\nimport type { MVFv2_STANDARD_MVFv3 } from './index.js';\n\nexport type BuilderOptions = {\n\tgeometryMaps: GeometryMaps;\n\tnodesByGeometryId: Map<GeometryId, NodeId[]>;\n\tgeometryFeatureById: Map<GeometryId, GeometryFeature>;\n\tnavigationFlags: NavigationFlagDeclarations;\n\tincomingEdgesByNodeId: Map<NodeId, Array<NodeNeighbor>>;\n\tnodesById: Map<NodeId, NodeFeature>;\n};\nexport function buildBuilderOptions(v3: Partial<MVFv2_STANDARD_MVFv3>): BuilderOptions {\n\tconst { nodesByGeometryId, incomingEdgesByNodeId, nodesById } = buildNodeMaps(v3);\n\tconst geometryMaps = createGeometryMaps(v3);\n\tconst geometryFeatureById = buildGeometryFeatureById(v3);\n\tconst navigationFlags = v3.navigationFlags ?? {};\n\tconst options: BuilderOptions = {\n\t\tgeometryMaps,\n\t\tnodesByGeometryId,\n\t\tgeometryFeatureById,\n\t\tnavigationFlags,\n\t\tincomingEdgesByNodeId,\n\t\tnodesById,\n\t};\n\n\treturn options;\n}\n\nexport function buildNodeMaps(v3: Pick<MVFv2_STANDARD_MVFv3, 'nodes'>): {\n\tnodesByGeometryId: Map<GeometryId, NodeId[]>;\n\tincomingEdgesByNodeId: Map<NodeId, Array<NodeNeighbor>>;\n\tnodesById: Map<NodeId, NodeFeature>;\n} {\n\tconst nodesByGeometryId: Map<GeometryId, NodeId[]> = new Map();\n\tconst incomingEdgesByNodeId: Map<NodeId, Array<NodeNeighbor>> = new Map();\n\tconst nodesById: Map<NodeId, NodeFeature> = new Map();\n\tfor (const floorNodes of Object.values(v3.nodes ?? {})) {\n\t\tfor (const node of floorNodes?.features ?? []) {\n\t\t\tnodesById.set(node.properties.id, node);\n\t\t\tif (node.properties.geometryIds.length > 0) {\n\t\t\t\tfor (const geometryId of node.properties.geometryIds) {\n\t\t\t\t\tconst existingNodes = nodesByGeometryId.get(geometryId) ?? [];\n\t\t\t\t\texistingNodes.push(node.properties.id);\n\t\t\t\t\tnodesByGeometryId.set(geometryId, existingNodes);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (node.properties.neighbors.length > 0) {\n\t\t\t\tfor (const neighbor of node.properties.neighbors) {\n\t\t\t\t\tconst existing = incomingEdgesByNodeId.get(neighbor.id);\n\t\t\t\t\tif (existing != null) {\n\t\t\t\t\t\texisting.push(neighbor);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tincomingEdgesByNodeId.set(neighbor.id, [neighbor]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn { nodesByGeometryId, incomingEdgesByNodeId, nodesById };\n}\n\nexport function buildGeometryFeatureById(\n\tv3: Partial<Pick<MVFv2_STANDARD_MVFv3, 'geometry'>>,\n): Map<GeometryId, GeometryFeature> {\n\tconst geometryFeatureById: Map<GeometryId, GeometryFeature> = new Map();\n\tfor (const floorGeometry of Object.values(v3.geometry ?? {})) {\n\t\tfor (const geometry of floorGeometry?.features ?? []) {\n\t\t\tgeometryFeatureById.set(geometry.properties.id, geometry);\n\t\t}\n\t}\n\treturn geometryFeatureById;\n}\n", "import type { EnterpriseCategoryId, EnterpriseLocationId, EnterpriseLocationInstanceId } from '@mappedin/mvf-cms';\nimport type { GeometryFeature, GeometryId } from '@mappedin/mvf-core';\nimport { typedEntries, typedKeys } from '@mappedin/mvf-core/utils';\nimport type { LocationCategoryId, LocationId, LocationInstanceId } from '@mappedin/mvf-locations';\nimport type { AreaId } from '../extensions/area.js';\nimport type { WindowId } from '../extensions/window.js';\nimport type { NodeId, ObstructionId } from '../types/core.js';\nimport type { SpaceId } from '../types/core.js';\nimport type { MVFv2_STANDARD_MVFv3 } from './index.js';\n\nexport function toSpaceId(id: GeometryId): SpaceId {\n\treturn id.replace(/^g_/, 's_');\n}\n\nexport function toObstructionId(id: GeometryId): ObstructionId {\n\treturn id.replace(/^g_/, 'o_');\n}\nexport function convertGeometryId(id: GeometryId, obstructionIds: Set<GeometryId>): SpaceId | ObstructionId {\n\tif (obstructionIds.has(id)) {\n\t\treturn toObstructionId(id);\n\t}\n\treturn toSpaceId(id);\n}\n\nexport function toWindowId(id: GeometryId): WindowId {\n\treturn id.replace(/^g_/, 'w_');\n}\n\nexport function convertLocationInstanceId(id: LocationInstanceId): EnterpriseLocationInstanceId {\n\treturn id.replace(/^loci_/, 'eli_') as EnterpriseLocationInstanceId;\n}\n\nexport function convertLocationId(id: LocationId): EnterpriseLocationId {\n\treturn id.replace(/^loc_/, 'el_') as EnterpriseLocationId;\n}\n\nexport function convertLocationCategoryId(id: LocationCategoryId): EnterpriseCategoryId {\n\treturn id.replace(/^lcat_/, 'ec_') as EnterpriseCategoryId;\n}\n\nexport type GeometryIdConverter = (id: GeometryId) => SpaceId | ObstructionId;\n\nexport function generateIdConverter(obstructionIds: Set<GeometryId>): GeometryIdConverter {\n\treturn (id: GeometryId) => convertGeometryId(id, obstructionIds);\n}\n\nexport function convertAreaId(id: GeometryId): AreaId {\n\treturn id.replace(/^g_/, 'ar_');\n}\n\nexport function convertNodeToSpaceId(id: NodeId): SpaceId {\n\treturn id.replace(/^n_/, 's_');\n}\n\nexport function splitMultiPartGeometryFeatureWithNewId<T extends string>(\n\tfeature: GeometryFeature,\n\tnewId: T,\n\tkind?: string,\n): PartiallyTransformedGeometryFeature<T>[] {\n\tswitch (feature.geometry.type) {\n\t\tcase 'MultiPoint':\n\t\tcase 'MultiLineString':\n\t\tcase 'MultiPolygon': {\n\t\t\tconst result: PartiallyTransformedGeometryFeature<T>[] = [];\n\t\t\tlet index = 0;\n\t\t\tconst type = feature.geometry.type.replace('Multi', '') as 'Point' | 'LineString' | 'Polygon';\n\t\t\tfor (const coordinates of feature.geometry.coordinates) {\n\t\t\t\tresult.push({\n\t\t\t\t\t...feature,\n\t\t\t\t\tgeometry: { type, coordinates } as GeometryFeature['geometry'],\n\t\t\t\t\tproperties: { ...feature.properties, id: `${newId}-${index++}` as T, kind },\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\tdefault:\n\t\t\treturn [{ ...feature, properties: { ...feature.properties, id: newId, kind } }];\n\t}\n}\n\n/**\n * A geometry feature that has been partially transformed into v2. In particular,\n * the `id` has been converted to the new ID type, and the `kind` has been added.\n * These are also probably not multi geometry features, but this is not actually enforced.\n *\n */\nexport type PartiallyTransformedGeometryFeature<T> = Omit<GeometryFeature, 'properties'> & {\n\tproperties: Omit<GeometryFeature['properties'], 'id'> & { id: T; kind: string | undefined };\n};\n\nexport type MappedGeometry<T> = Map<\n\tGeometryId,\n\t{\n\t\tids: T[];\n\t\tfeatures: PartiallyTransformedGeometryFeature<T>[];\n\t\tanchors: {\n\t\t\tgeometryId: T;\n\t\t\tfloorId: string;\n\t\t}[];\n\t}\n>;\n\nexport function mapGeometryToOtherIds<T extends string>(\n\tgeometry: { feature: GeometryFeature; floorId: string }[],\n\txIds: { has: (id: GeometryId) => boolean }, // Probably a set, but can be any object with that function\n\tconvertToX: (id: GeometryId) => T,\n\tkindsMap: Map<GeometryId, string | undefined>,\n): MappedGeometry<T> {\n\tconst result: MappedGeometry<T> = new Map();\n\tfor (const { feature, floorId } of geometry) {\n\t\tconst id = feature.properties.id;\n\t\tconst kind = kindsMap.get(id);\n\t\tif (xIds.has(id)) {\n\t\t\tconst converted = splitMultiPartGeometryFeatureWithNewId(feature, convertToX(id), kind);\n\t\t\tconst ids = converted.map((x) => x.properties.id);\n\t\t\tconst anchors = ids.map((geometryId) => ({\n\t\t\t\tgeometryId,\n\t\t\t\tfloorId,\n\t\t\t}));\n\t\t\tresult.set(id, { ids, features: converted, anchors });\n\t\t}\n\t}\n\treturn result;\n}\n\nexport type GeometryMaps = {\n\tspace: MappedGeometry<SpaceId>;\n\tobstruction: MappedGeometry<ObstructionId>;\n\tarea: MappedGeometry<AreaId>;\n\twindow: MappedGeometry<WindowId>;\n\tobject: MappedGeometry<ObstructionId>;\n};\n\nexport function createGeometryMaps(\n\tv3: Partial<Pick<MVFv2_STANDARD_MVFv3, 'geometry' | 'kinds' | 'nonwalkable' | 'walkable' | 'connections'>>,\n): GeometryMaps {\n\tconst result: GeometryMaps = {\n\t\tspace: new Map(),\n\t\tobstruction: new Map(),\n\t\tarea: new Map(),\n\t\twindow: new Map(),\n\t\tobject: new Map(),\n\t};\n\tif (!v3.geometry) {\n\t\treturn result;\n\t}\n\n\tconst kindsMap = createKindsMap(v3);\n\n\tconst flatFeatures = typedEntries(v3.geometry)\n\t\t.flatMap(([floor, featureCollection]) =>\n\t\t\t(featureCollection?.features ?? []).map((x) => ({ feature: x, floorId: floor })),\n\t\t)\n\t\t.flat();\n\n\tconst walkableIds = new Set(\n\t\tObject.values(v3.walkable ?? {})\n\t\t\t.filter((x) => x !== undefined)\n\t\t\t.flatMap(typedKeys),\n\t);\n\tconst obstructionIds = new Set(\n\t\tObject.values(v3.nonwalkable ?? {})\n\t\t\t.filter((x) => x !== undefined)\n\t\t\t.flatMap(typedKeys),\n\t);\n\n\tconst areaIds = new Set(\n\t\tArray.from(kindsMap.entries())\n\t\t\t.filter(([_, kind]) => kind === 'area')\n\t\t\t.map(([id]) => id),\n\t);\n\n\tconst objectsIds = new Set(\n\t\tArray.from(kindsMap.entries())\n\t\t\t.filter(([_, kind]) => kind === 'object')\n\t\t\t.map(([id]) => id),\n\t);\n\n\tconst windowIds = new Set(\n\t\tArray.from(kindsMap.entries())\n\t\t\t.filter(([_, kind]) => kind === 'window')\n\t\t\t.map(([id]) => id),\n\t);\n\n\tif (walkableIds.size > 0) {\n\t\tresult.space = mapGeometryToOtherIds(flatFeatures, walkableIds, toSpaceId, kindsMap);\n\t}\n\tif (obstructionIds.size > 0) {\n\t\tresult.obstruction = mapGeometryToOtherIds(flatFeatures, obstructionIds, toObstructionId, kindsMap);\n\t}\n\tif (areaIds.size > 0) {\n\t\tresult.area = mapGeometryToOtherIds(flatFeatures, areaIds, convertAreaId, kindsMap);\n\t}\n\tif (objectsIds.size > 0) {\n\t\tresult.object = mapGeometryToOtherIds(flatFeatures, objectsIds, toObstructionId, kindsMap);\n\t}\n\n\t// I don't think anyone actually cares about window ids to keep the MVFv3 ones vs re-writing them like this\n\tif (windowIds.size > 0) {\n\t\tresult.window = mapGeometryToOtherIds(flatFeatures, windowIds, toWindowId, kindsMap);\n\t}\n\n\t// Incase we have no information about the geometry, we will just map everything to a space\n\t// This is the Enterprise case.\n\t// If Enterprise ever produces v3 data with areas, it will need to fill in walkable to get spaces again.\n\tif (walkableIds.size === 0 && obstructionIds.size === 0 && areaIds.size === 0) {\n\t\tresult.space = mapGeometryToOtherIds(\n\t\t\tflatFeatures,\n\t\t\tnew Set(flatFeatures.map((x) => x.feature.properties.id)),\n\t\t\ttoSpaceId,\n\t\t\tkindsMap,\n\t\t);\n\t}\n\n\treturn result;\n}\n\nexport function createKindsMap(v3: Pick<MVFv2_STANDARD_MVFv3, 'kinds' | 'connections'>): Map<GeometryId, string> {\n\tconst kindsMap = new Map(\n\t\tObject.values(v3.kinds ?? {})\n\t\t\t.filter((x) => x !== undefined)\n\t\t\t.flatMap(typedEntries),\n\t) as Map<GeometryId, string>;\n\n\t// All connections (except doors) should override the kind of their geometry to connection.<type>\n\tfor (const connection of v3.connections?.filter((c) => c.type !== 'door') ?? []) {\n\t\tfor (const entrance of connection.entrances) {\n\t\t\tkindsMap.set(entrance.geometryId, `connection.${connection.type}`);\n\t\t}\n\t\tfor (const exit of connection.exits) {\n\t\t\tkindsMap.set(exit.geometryId, `connection.${connection.type}`);\n\t\t}\n\t}\n\treturn kindsMap;\n}\n", "import { typedEntries } from '@mappedin/mvf-core/utils';\nimport type { AnnotationCollection, AnnotationProperties } from '../../extensions/annotation.js';\nimport type { ParsedMVF } from '../../types/bundle.js';\nimport type { MVFv2_STANDARD_MVFv3 } from '../index.js';\n\nexport type V3Annotations = Pick<MVFv2_STANDARD_MVFv3, 'annotations' | 'annotationSymbols' | 'geometry'>;\nexport type V2Annotations = Pick<ParsedMVF, 'annotation'>;\n\nexport function buildAnnotations(v3: V3Annotations, _: Record<string, unknown>): V2Annotations {\n\tif (!v3.annotations || !v3.annotationSymbols || !v3.geometry) {\n\t\treturn {};\n\t}\n\n\tconst v2Annotations: V2Annotations['annotation'] = {};\n\n\tfor (const [floorId, annotations] of typedEntries(v3.annotations)) {\n\t\tif (\n\t\t\t!annotations ||\n\t\t\tannotations.length === 0 ||\n\t\t\t!v3.geometry[floorId] ||\n\t\t\tv3.geometry[floorId].features.length === 0\n\t\t) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst geometryById = new Map(v3.geometry[floorId].features.map((g) => [g.properties.id, g]));\n\n\t\tconst v2AnnotationCollection: AnnotationCollection = {\n\t\t\ttype: 'FeatureCollection',\n\t\t\tfeatures: [],\n\t\t};\n\n\t\tfor (const v3Annotation of annotations) {\n\t\t\tconst geometry = geometryById.get(v3Annotation.geometryId);\n\t\t\tif (!geometry || geometry.geometry.type !== 'Point') {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst v2AnnotationProperties: AnnotationProperties = {\n\t\t\t\tid: v3Annotation.id,\n\t\t\t\texternalId: v3Annotation.externalId,\n\t\t\t\tsymbolId: v3Annotation.symbolKey,\n\t\t\t};\n\n\t\t\tv2AnnotationCollection.features.push({\n\t\t\t\ttype: 'Feature',\n\t\t\t\tgeometry: geometry.geometry,\n\t\t\t\tproperties: v2AnnotationProperties,\n\t\t\t});\n\t\t}\n\n\t\tv2Annotations[floorId] = v2AnnotationCollection;\n\t}\n\n\treturn {\n\t\tannotation: v2Annotations,\n\t};\n}\n", "import { CONNECTION_TYPE, type Connection } from '@mappedin/mvf-connections';\nimport type { FloorId, GeometryFeature } from '@mappedin/mvf-core';\nimport { type NavigationFlagDeclaration, WELL_KNOWN_FLAGS, hasFlag } from '@mappedin/mvf-navigation-flags';\nimport type { ParsedMVF } from '../../types/bundle.js';\nimport type { EntranceFeature } from '../../types/core.js';\nimport type { BuilderOptions } from '../builderOptions.js';\nimport type { MVFv2_STANDARD_MVFv3 } from '../index.js';\n\nexport type V3Connections = Pick<MVFv2_STANDARD_MVFv3, 'connections' | 'navigationFlags' | 'nodes' | 'geometry'>;\nexport type V2Connections = Pick<ParsedMVF, 'connection.json' | 'entrance'>;\nexport type V2Connection = V2Connections['connection.json'][number];\n\nexport function buildConnections(\n\tv3: V3Connections,\n\t{ nodesByGeometryId }: Pick<BuilderOptions, 'nodesByGeometryId'>,\n): V2Connections {\n\tconst v2: V2Connections = {\n\t\t'connection.json': [],\n\t\tentrance: {},\n\t};\n\n\tconst ACCESSIBLE_FLAG = v3.navigationFlags?.[WELL_KNOWN_FLAGS.accessible];\n\tconst OUTDOORS_FLAG = v3.navigationFlags?.[WELL_KNOWN_FLAGS.outdoors];\n\tconst geometryFeatureById = new Map(\n\t\tObject.values(v3.geometry ?? {})\n\t\t\t.flatMap((floor) => floor?.features ?? [])\n\t\t\t.map((f) => [f.properties.id, f]),\n\t);\n\n\tfor (const connection of v3.connections ?? []) {\n\t\t// Convert line string doors to entrances, except when they transition\n\t\t// between floors (as these then become \"real\" connections). Keep CMS\n\t\t// style point doors\n\t\tif (isLineDoor(connection, geometryFeatureById) && !doesConnectionTransitionFloors(connection)) {\n\t\t\tconst entrances = buildEntranceFeaturesFromConnection(\n\t\t\t\tconnection,\n\t\t\t\tgeometryFeatureById,\n\t\t\t\tnodesByGeometryId,\n\t\t\t\tOUTDOORS_FLAG,\n\t\t\t);\n\t\t\tfor (const [floorId, entrance] of entrances) {\n\t\t\t\tif (!v2.entrance[floorId]) {\n\t\t\t\t\tv2.entrance[floorId] = {\n\t\t\t\t\t\ttype: 'FeatureCollection',\n\t\t\t\t\t\tfeatures: [],\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tv2.entrance[floorId].features.push(entrance);\n\t\t\t}\n\t\t\tcontinue;\n\t\t}\n\n\t\t// A connection is accessible if it has the accessible flag set for some entrance and exit\n\t\tconst accessible =\n\t\t\tACCESSIBLE_FLAG != undefined &&\n\t\t\tconnection.entrances.some((e) => hasFlag(e, ACCESSIBLE_FLAG)) &&\n\t\t\tconnection.exits.some((e) => hasFlag(e, ACCESSIBLE_FLAG));\n\n\t\t// Asymmetric connections are not supported in V2, so we just give it all the nodes\n\t\tconst nodes = Array.from(\n\t\t\tnew Set(\n\t\t\t\t[\n\t\t\t\t\t...connection.entrances.map((e) => nodesByGeometryId.get(e.geometryId)),\n\t\t\t\t\t...connection.exits.map((e) => nodesByGeometryId.get(e.geometryId)),\n\t\t\t\t]\n\t\t\t\t\t.flat()\n\t\t\t\t\t.filter((n) => n != undefined),\n\t\t\t),\n\t\t);\n\n\t\tconst v2Connection: V2Connection = {\n\t\t\tid: connection.id,\n\t\t\texternalId: connection.details?.externalId ?? '',\n\t\t\ttype: connection.type,\n\t\t\taccessible,\n\t\t\tnodes,\n\t\t};\n\t\tif (connection.details?.name) {\n\t\t\tv2Connection.details = { name: connection.details.name };\n\t\t}\n\t\tif (connection.extra) {\n\t\t\tv2Connection.extra = connection.extra;\n\t\t}\n\n\t\tv2['connection.json'].push(v2Connection);\n\t}\n\treturn v2;\n}\n\nexport function isLineDoor(connection: Connection, geometryFeatureById: Map<string, GeometryFeature>): boolean {\n\treturn (\n\t\tconnection.type == CONNECTION_TYPE.door &&\n\t\tconnection.entrances.every((e) => {\n\t\t\tconst feature = geometryFeatureById.get(e.geometryId);\n\t\t\t// It's not clear what to do in MVFv2 if this was a multi-line string. Probably not multiple identical entrances.\n\t\t\treturn feature?.geometry.type === 'LineString';\n\t\t})\n\t);\n}\n\nexport function doesConnectionTransitionFloors(connection: Connection): boolean {\n\tif (connection.entrances.length === 0 || connection.exits.length === 0) {\n\t\t// If a connection can't be traversed, it can't transition floors\n\t\treturn false;\n\t}\n\tconst visitedFloors = new Set([\n\t\t...connection.entrances.map((e) => e.floorId),\n\t\t...connection.exits.map((e) => e.floorId),\n\t]);\n\treturn visitedFloors.size >= 2;\n}\n\n/**\n * This builds one or more entrances from a connection. It will only produce anything if isLineDoor\n * is true for this connection, but it doesn't rely on that function.\n *\n * It will produce tuples of [FloorId, EntranceFeature[]] for every entrance line string entrance in the connection\n * in the connection.\n * @param connection\n * @param geometryFeatureById\n */\nexport function buildEntranceFeaturesFromConnection(\n\tconnection: Connection,\n\tgeometryFeatureById: Map<string, GeometryFeature>,\n\tnodesByGeometryId: BuilderOptions['nodesByGeometryId'],\n\toutdoorsFlag?: NavigationFlagDeclaration,\n): [FloorId, EntranceFeature][] {\n\tif (connection.type !== CONNECTION_TYPE.door) {\n\t\treturn [];\n\t}\n\n\tconst entrances: [FloorId, EntranceFeature][] = [];\n\n\tfor (const entrance of connection.entrances) {\n\t\tconst geometryFeature = geometryFeatureById.get(entrance.geometryId);\n\t\tif (geometryFeature?.geometry.type === 'LineString') {\n\t\t\tconst entranceFeature: EntranceFeature = {\n\t\t\t\ttype: 'Feature',\n\t\t\t\tgeometry: geometryFeature.geometry,\n\t\t\t\tproperties: {\n\t\t\t\t\tid: connection.id, // Entrance IDs will not be unique. Is that a problem?\n\t\t\t\t\texternalId: connection.details?.externalId ?? '',\n\t\t\t\t\tisExterior: isExterior(connection, outdoorsFlag),\n\t\t\t\t},\n\t\t\t};\n\t\t\tconst details = connection.details;\n\t\t\tif (details) {\n\t\t\t\tentranceFeature.properties.details = {\n\t\t\t\t\tname: details.name,\n\t\t\t\t\tdescription: details.description,\n\t\t\t\t};\n\t\t\t\tif (details.icon) {\n\t\t\t\t\tentranceFeature.properties.details.images = [{ url: details.icon, altText: `${details.name} icon` }];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst nodes = nodesByGeometryId.get(entrance.geometryId);\n\t\t\tif (nodes && nodes.length > 0) {\n\t\t\t\tentranceFeature.properties.node = nodes[0];\n\t\t\t}\n\t\t\tentrances.push([entrance.floorId, entranceFeature]);\n\t\t}\n\t}\n\treturn entrances;\n}\n\n/**\n * A connection is exterior if ANY of it's entrances or exits have the well-known outdoors flag.\n *\n * This also means a connection that is fully outdoors (such as a pedestrian bridge) is also exterior.\n * @param connection\n * @param outdoorsFlag\n * @returns true if the connection goes or comes from the exterior\n */\nexport function isExterior(connection: Connection, outdoorsFlag?: NavigationFlagDeclaration): boolean {\n\treturn (\n\t\tconnection.entrances.some((e) => hasFlag(e, outdoorsFlag)) || connection.exits.some((e) => hasFlag(e, outdoorsFlag))\n\t);\n}\n", "import type {\n\tEnterpriseCategoryId,\n\tEnterpriseCategory as V3EnterpriseCategory,\n\tEnterpriseCategoryId as V3EnterpriseCategoryId,\n\tEnterpriseLocation as V3EnterpriseLocation,\n\tEnterpriseLocationInstance as V3EnterpriseLocationInstance,\n\tEnterpriseVenue as V3EnterpriseVenue,\n} from '@mappedin/mvf-cms';\nimport type { FloorId } from '@mappedin/mvf-core/identifiers';\nimport { typedEntries } from '@mappedin/mvf-core/utils';\nimport type { Location, LocationCategory, LocationCategoryId, LocationId } from '@mappedin/mvf-locations';\nimport type {\n\tAnchoredFloorTextProperties,\n\tEnterpriseCategoryPriority,\n\tEnterpriseCollection,\n\tEnterpriseFloorText,\n\tEnterpriseLayer,\n\tEnterpriseStyles,\n\tEnterpriseTexture,\n\tFloatingFloorTextProperties,\n\tFloorTextCommonProperties,\n\tFloorTextFeatureCollection,\n\tFloorTextProperties,\n\tEnterpriseCategory as V2EnterpriseCategory,\n\tEnterpriseLocation as V2EnterpriseLocation,\n\tEnterpriseLocationInstance as V2EnterpriseLocationInstance,\n} from '../../extensions/enterprise.js';\nimport type {\n\tAnchoredTextAreaProperties,\n\tBaseTextAreaProperties,\n\tFloatingTextAreaProperties,\n\tTextAreaFeature,\n\tTextAreaFeatureCollection,\n\tTextAreaProperties,\n} from '../../extensions/textArea.js';\nimport type { ParsedMVF } from '../../types/bundle.js';\nimport type { BuilderOptions } from '../builderOptions.js';\nimport { convertLocationCategoryId, convertLocationId, convertLocationInstanceId } from '../converterUtils.js';\nimport type { MVFv2_STANDARD_MVFv3 } from '../index.js';\n\nexport type V3Enterprise = Pick<\n\tMVFv2_STANDARD_MVFv3,\n\t'cms' | 'manifest' | 'locations' | 'locationCategories' | 'defaultStyle' | 'locationInstances'\n>;\nexport type V2Enterprise = Pick<ParsedMVF, 'enterprise' | 'textAreas'>;\n\nexport function buildEnterprise(\n\tv3: V3Enterprise,\n\t{ geometryMaps, nodesByGeometryId }: Pick<BuilderOptions, 'geometryMaps' | 'nodesByGeometryId'>,\n): V2Enterprise {\n\tconst v2Enterprise: EnterpriseCollection = {\n\t\tcategories: [],\n\t\tlocations: [],\n\t\tlocationInstances: [],\n\t\tlayers: [],\n\t\tvenue: {\n\t\t\tslug: '',\n\t\t\tname: '',\n\t\t\texternalId: '',\n\t\t\tdefaultLanguage: {\n\t\t\t\tname: 'English',\n\t\t\t\tcode: 'en',\n\t\t\t},\n\t\t\tlanguages: [],\n\t\t},\n\t};\n\n\t// Enterprise Venue\n\tconst v3Manifest = v3.manifest?.features[0];\n\n\t// Start by filling in what we can off the manifest\n\tif (v3Manifest) {\n\t\tv2Enterprise.venue.defaultFloor = v3Manifest.properties.defaultFloor;\n\t\tv2Enterprise.venue.tzid = v3Manifest.properties.tzid;\n\t\tv2Enterprise.venue.name = v3Manifest.properties.name;\n\t\tv2Enterprise.venue.defaultLanguage = {\n\t\t\tname: v3Manifest.properties.language ?? 'English',\n\t\t\tcode: v3Manifest.properties.language ?? 'en',\n\t\t};\n\t}\n\t//  Then fill in the rest off the enterprise\n\n\tconst v3Venue = v3.cms?.venue;\n\n\tif (v3Venue) {\n\t\tv2Enterprise.venue = {\n\t\t\t...v2Enterprise.venue,\n\t\t\tslug: v3Venue.slug,\n\t\t\tname: v3Venue.details?.name ?? v2Enterprise.venue.name ?? v3Manifest.properties.name,\n\t\t\texternalId: v3Venue.details?.externalId ?? '',\n\t\t\tdefaultLanguage: v3Venue.defaultLanguage,\n\t\t\tlanguages: v3Venue.languages ?? [],\n\t\t\tcountrycode: v3Venue.countrycode,\n\t\t\tcoverImage: v3Venue.coverImage,\n\t\t\tlogo: v3Venue.logo,\n\t\t\ticon: v3Venue.details?.icon,\n\t\t\textra: v3Venue.extra,\n\t\t\tmappedinWebUrl: v3Venue.mappedinWebUrl,\n\t\t\toperationHours: v3Venue.operationHours,\n\t\t\ttopLocations: v3Venue.topLocations,\n\t\t};\n\t}\n\n\t// Build this for the Enterprise Categories to use later\n\tconst locationsByLocationCategoryId = new Map<LocationCategoryId, LocationId[]>();\n\n\t// Enterprise Locations\n\tconst v3Locations = v3.locations ?? [];\n\tconst v3EnterpriseLocations = v3.cms?.locations ?? [];\n\tconst v3EnterpriseCategories = v3.cms?.categories ?? [];\n\n\t// Create mapping from V3 location category IDs to V2 enterprise category IDs\n\tconst enterpriseCategoryByLocationCategoryId = new Map<LocationCategoryId | undefined, V3EnterpriseCategory>(\n\t\t(v3EnterpriseCategories ?? []).map((cat) => [cat.categoryId, cat]),\n\t);\n\n\tif (v3Locations.length > 0) {\n\t\tconst eneterpriseLocationsByLocationId = new Map(\n\t\t\tv3EnterpriseLocations.map((enterpriseLocation) => [enterpriseLocation.locationId, enterpriseLocation]),\n\t\t);\n\t\tfor (const v3Location of v3Locations) {\n\t\t\tconst v3EnterpriseLocation = (eneterpriseLocationsByLocationId.get(v3Location.id) ??\n\t\t\t\t{}) as Partial<V3EnterpriseLocation>;\n\t\t\tif (v3Location) {\n\t\t\t\tconst details = v3Location.details;\n\t\t\t\tconst v2EnterpriseLocation: V2EnterpriseLocation = {\n\t\t\t\t\tid:\n\t\t\t\t\t\tv3EnterpriseLocation?.cmsId !== undefined\n\t\t\t\t\t\t\t? `el_${v3EnterpriseLocation?.cmsId}`\n\t\t\t\t\t\t\t: convertLocationId(v3Location.id),\n\t\t\t\t\tname: details.name,\n\t\t\t\t\texternalId: details.externalId ?? '',\n\t\t\t\t\ttype: v3EnterpriseLocation.type ?? 'location',\n\t\t\t\t\tsortOrder: v3EnterpriseLocation.sortOrder ?? 0,\n\t\t\t\t\tamenity: v3EnterpriseLocation.amenity,\n\t\t\t\t\tdescription: details.description,\n\t\t\t\t\textra: v3Location.extra,\n\t\t\t\t\tlinks: v3Location.links,\n\t\t\t\t\toperationHours: v3Location.openingHours,\n\t\t\t\t\tgallery: v3EnterpriseLocation.gallery,\n\t\t\t\t\tlogo: v3Location.logo,\n\t\t\t\t\tshortName: details.shortName,\n\t\t\t\t\tpicture: v3EnterpriseLocation.picture,\n\t\t\t\t\tshowFloatingLabelWhenImagePresent: v3EnterpriseLocation.showFloatingLabelWhenImagePresent,\n\t\t\t\t\tshowLogo: v3EnterpriseLocation.showLogo,\n\t\t\t\t\tsiblingGroups: v3EnterpriseLocation.siblingGroups,\n\t\t\t\t\tstates: v3EnterpriseLocation.states,\n\t\t\t\t\ttags: v3EnterpriseLocation.tags,\n\t\t\t\t\tspaces: [],\n\t\t\t\t\tnodes: [],\n\t\t\t\t\tpolygons: [],\n\t\t\t\t};\n\n\t\t\t\tif (v3Location.phone) {\n\t\t\t\t\tv2EnterpriseLocation.phone = { number: v3Location.phone };\n\t\t\t\t}\n\t\t\t\tif (v3EnterpriseLocation.primaryCategory) {\n\t\t\t\t\tconst v2EnterpriseCategory = enterpriseCategoryByLocationCategoryId.get(v3EnterpriseLocation.primaryCategory);\n\t\t\t\t\tif (v2EnterpriseCategory) {\n\t\t\t\t\t\tv2EnterpriseLocation.primaryCategory = v2EnterpriseCategory.id;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst social = convertSocials(v3Location.social);\n\n\t\t\t\tif (v3Location.website) {\n\t\t\t\t\tsocial.website = v3Location.website.url;\n\t\t\t\t}\n\t\t\t\tv2EnterpriseLocation.social = social;\n\n\t\t\t\tfor (const anchor of v3Location.geometryAnchors) {\n\t\t\t\t\tconst space = geometryMaps.space.get(anchor.geometryId);\n\t\t\t\t\tconst obstruction = geometryMaps.obstruction.get(anchor.geometryId);\n\t\t\t\t\t// A CMS generated MVFv3 will never have obstruction anchors\n\t\t\t\t\tconst converted = space ?? obstruction;\n\t\t\t\t\tif (converted) {\n\t\t\t\t\t\tconst polygons = new Set<string>(\n\t\t\t\t\t\t\tconverted.features.filter((f) => f.geometry.type === 'Polygon').map((f) => f.properties.id),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tfor (const anchor of converted.anchors) {\n\t\t\t\t\t\t\tif (space != null && converted === space) {\n\t\t\t\t\t\t\t\tv2EnterpriseLocation.spaces.push({\n\t\t\t\t\t\t\t\t\tfloor: anchor.floorId,\n\t\t\t\t\t\t\t\t\tid: anchor.geometryId,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (polygons.has(anchor.geometryId)) {\n\t\t\t\t\t\t\t\tv2EnterpriseLocation.polygons.push({\n\t\t\t\t\t\t\t\t\tmap: anchor.floorId,\n\t\t\t\t\t\t\t\t\tid: anchor.geometryId,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst nodes = nodesByGeometryId.get(anchor.geometryId);\n\t\t\t\t\tfor (const node of nodes ?? []) {\n\t\t\t\t\t\tv2EnterpriseLocation.nodes.push({\n\t\t\t\t\t\t\tmap: anchor.floorId,\n\t\t\t\t\t\t\tid: node,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tv2Enterprise.locations.push(v2EnterpriseLocation);\n\n\t\t\t\t// To be used when building enterprise categories\n\t\t\t\tfor (const category of v3Location.categories) {\n\t\t\t\t\tlocationsByLocationCategoryId.set(category, [\n\t\t\t\t\t\t...(locationsByLocationCategoryId.get(category) ?? []),\n\t\t\t\t\t\tv3Location.id,\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Enterprise Location Instances\n\tconst v3EnterpriseLocationInstances = v3.cms?.locationInstances ?? [];\n\tconst v3LocationInstances = v3.locationInstances;\n\tif (v3LocationInstances) {\n\t\tconst v3EnterpriseLocationInstancesByLocationInstanceId = new Map(\n\t\t\tv3EnterpriseLocationInstances.map((instance) => [instance.locationInstanceId, instance]),\n\t\t);\n\t\tconst v2EnterpriseLocationInstances: V2EnterpriseLocationInstance[] = [];\n\n\t\tfor (const v3LocationInstance of v3LocationInstances) {\n\t\t\tconst v3EnterpriseLocationInstance =\n\t\t\t\tv3EnterpriseLocationInstancesByLocationInstanceId.get(v3LocationInstance.id) ??\n\t\t\t\t({} as Partial<V3EnterpriseLocationInstance>);\n\n\t\t\tif (v3LocationInstance) {\n\t\t\t\tconst v2EnterpriseLocationInstance: V2EnterpriseLocationInstance = {\n\t\t\t\t\tid: convertLocationInstanceId(v3LocationInstance.id),\n\t\t\t\t\tparent: v3EnterpriseLocationInstance.parentId ?? convertLocationId(v3LocationInstance.parentId),\n\t\t\t\t\tname: v3LocationInstance.details?.name,\n\t\t\t\t\texternalId: v3LocationInstance.details?.externalId,\n\t\t\t\t\ttype: v3EnterpriseLocationInstance.type,\n\t\t\t\t\tsortOrder: v3EnterpriseLocationInstance.sortOrder,\n\t\t\t\t\tamenity: v3EnterpriseLocationInstance.amenity,\n\t\t\t\t\tdescription: v3LocationInstance.details?.description,\n\t\t\t\t\textra: v3LocationInstance.extra,\n\t\t\t\t\tlinks: v3LocationInstance.links,\n\t\t\t\t\toperationHours: v3LocationInstance.openingHours,\n\t\t\t\t\tgallery: v3EnterpriseLocationInstance.gallery,\n\t\t\t\t\tpicture: v3EnterpriseLocationInstance.picture,\n\t\t\t\t\tshowFloatingLabelWhenImagePresent: v3EnterpriseLocationInstance.showFloatingLabelWhenImagePresent,\n\t\t\t\t\tshowLogo: v3EnterpriseLocationInstance.showLogo,\n\t\t\t\t\tsiblingGroups: v3EnterpriseLocationInstance.siblingGroups,\n\t\t\t\t\tstates: v3EnterpriseLocationInstance.states,\n\t\t\t\t\ttags: v3EnterpriseLocationInstance.tags,\n\t\t\t\t\tlogo: v3LocationInstance.logo,\n\t\t\t\t\tshortName: v3LocationInstance.details?.shortName,\n\t\t\t\t};\n\t\t\t\tif (v3LocationInstance.phone) {\n\t\t\t\t\tv2EnterpriseLocationInstance.phone = { number: v3LocationInstance.phone };\n\t\t\t\t}\n\t\t\t\tconst social = convertSocials(v3LocationInstance.social ?? []);\n\t\t\t\tif (v3LocationInstance.website) {\n\t\t\t\t\tsocial.website = v3LocationInstance.website.url;\n\t\t\t\t}\n\n\t\t\t\tif (Object.keys(social).length > 0) {\n\t\t\t\t\tv2EnterpriseLocationInstance.social = social;\n\t\t\t\t}\n\t\t\t\tif (v3LocationInstance.geometryAnchors?.length) {\n\t\t\t\t\tconst spaces = v3LocationInstance.geometryAnchors.flatMap(\n\t\t\t\t\t\t(anchor) => geometryMaps.space.get(anchor.geometryId)?.anchors ?? [],\n\t\t\t\t\t);\n\t\t\t\t\tif (spaces.length > 0) {\n\t\t\t\t\t\tv2EnterpriseLocationInstance.spaces = spaces.map((space) => ({\n\t\t\t\t\t\t\tfloor: space.floorId,\n\t\t\t\t\t\t\tid: space.geometryId,\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If we have any geometry anchors, we must have overrides for spaces, polygons, and ndoes.\n\t\t\t\tif (v3LocationInstance.geometryAnchors) {\n\t\t\t\t\tv2EnterpriseLocationInstance.spaces = [];\n\t\t\t\t\tv2EnterpriseLocationInstance.polygons = [];\n\t\t\t\t\tv2EnterpriseLocationInstance.nodes = [];\n\t\t\t\t\tfor (const anchor of v3LocationInstance.geometryAnchors) {\n\t\t\t\t\t\tconst converted = geometryMaps.space.get(anchor.geometryId);\n\t\t\t\t\t\tif (converted) {\n\t\t\t\t\t\t\tconst polygons = new Set<string>(\n\t\t\t\t\t\t\t\tconverted.features.filter((f) => f.geometry.type === 'Polygon').map((f) => f.properties.id),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tfor (const anchor of converted.anchors) {\n\t\t\t\t\t\t\t\tv2EnterpriseLocationInstance.spaces.push({\n\t\t\t\t\t\t\t\t\tfloor: anchor.floorId,\n\t\t\t\t\t\t\t\t\tid: anchor.geometryId,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (polygons.has(anchor.geometryId)) {\n\t\t\t\t\t\t\t\t\tv2EnterpriseLocationInstance.polygons.push({\n\t\t\t\t\t\t\t\t\t\tmap: anchor.floorId,\n\t\t\t\t\t\t\t\t\t\tid: anchor.geometryId,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst nodes = nodesByGeometryId.get(anchor.geometryId);\n\t\t\t\t\t\tfor (const node of nodes ?? []) {\n\t\t\t\t\t\t\tv2EnterpriseLocationInstance.nodes.push({\n\t\t\t\t\t\t\t\tmap: anchor.floorId,\n\t\t\t\t\t\t\t\tid: node,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tv2EnterpriseLocationInstances.push(v2EnterpriseLocationInstance);\n\t\t\t}\n\t\t}\n\t\tif (v2EnterpriseLocationInstances.length > 0) {\n\t\t\tv2Enterprise.locationInstances = v2EnterpriseLocationInstances;\n\t\t}\n\t}\n\n\t// Enterprise Categories\n\tconst v3Categories = v3.locationCategories;\n\tif (v3Categories) {\n\t\t// V2 Enterprise Categories have children references to other Enterprise Categories,\n\t\t// but V3 Enterprise categories have a parent to a Location Category, which then has a parent to another Location category.\n\t\t// This means we need to pre-build a map of children.\n\t\tconst v2EnterpriseCategories: V2EnterpriseCategory[] = [];\n\t\tconst v3CategoriesById = new Map<LocationCategoryId | undefined, LocationCategory>(\n\t\t\tv3Categories.map((cat) => [cat.id, cat]),\n\t\t);\n\t\tconst enterpriseCategoryByLocationCategoryId = new Map<LocationCategoryId | undefined, V3EnterpriseCategory>(\n\t\t\t(v3EnterpriseCategories ?? []).map((cat) => [cat.categoryId, cat]),\n\t\t);\n\t\tconst categoryChildren = new Map<LocationCategoryId, LocationCategoryId[]>();\n\n\t\tfor (const v3Category of v3Categories) {\n\t\t\tconst parent = v3CategoriesById.get(v3Category.parent);\n\t\t\tif (parent) {\n\t\t\t\tconst children = categoryChildren.get(parent.id) ?? [];\n\t\t\t\tchildren.push(v3Category.id);\n\t\t\t\tcategoryChildren.set(parent.id, children);\n\t\t\t}\n\t\t}\n\t\t// Now build the actual Enterprise Categories\n\t\tfor (const v3Category of v3Categories) {\n\t\t\tconst v3EnterpriseCategory = enterpriseCategoryByLocationCategoryId.get(v3Category.id);\n\t\t\tif (v3Category) {\n\t\t\t\tconst children = (categoryChildren.get(v3Category.id) ?? []).map(convertLocationCategoryId);\n\n\t\t\t\tconst v2EnterpriseCategory: V2EnterpriseCategory = {\n\t\t\t\t\tid: convertLocationCategoryId(v3Category.id),\n\t\t\t\t\tname: v3Category.details.name,\n\t\t\t\t\texternalId: v3Category.details.externalId ?? '',\n\t\t\t\t\tsortOrder: v3EnterpriseCategory?.sortOrder ?? 0,\n\t\t\t\t\tchildren,\n\t\t\t\t\tlocations: (locationsByLocationCategoryId.get(v3Category.id) ?? []).map(convertLocationId),\n\t\t\t\t\ticon: v3Category.details.icon,\n\t\t\t\t\tpicture: v3EnterpriseCategory?.picture,\n\t\t\t\t\tcolor: v3EnterpriseCategory?.color,\n\t\t\t\t\textra: v3Category.extra,\n\t\t\t\t\ticonFromDefaultList: v3EnterpriseCategory?.iconFromDefaultList,\n\t\t\t\t};\n\t\t\t\tv2EnterpriseCategories.push(v2EnterpriseCategory);\n\t\t\t}\n\t\t}\n\t\tv2Enterprise.categories = v2EnterpriseCategories;\n\n\t\t// Build the category priorities\n\t\tconst v2CategoryPriorities: EnterpriseCategoryPriority = {};\n\t\tfor (const v3Location of v3Locations) {\n\t\t\tv2CategoryPriorities[convertLocationId(v3Location.id)] = v3Location.categories\n\t\t\t\t.map(convertLocationCategoryId)\n\t\t\t\t.filter((e): e is V3EnterpriseCategoryId => e !== undefined);\n\t\t}\n\t\tv2Enterprise.categoryPriorities = v2CategoryPriorities;\n\t}\n\n\t// Build the enterprise styles\n\tconst v2EnterpriseStyles: EnterpriseStyles = {};\n\tfor (const [styleId, style] of Object.entries(v3.defaultStyle ?? {})) {\n\t\t// 0 or undefined buffers can be ignored. Positive or negative buffers get converted to edgeOffset.\n\t\tif (style.buffer) {\n\t\t\tconst convertedAnchors = style.geometryAnchors.flatMap(\n\t\t\t\t(anchor) => geometryMaps.space.get(anchor.geometryId)?.anchors ?? [],\n\t\t\t);\n\n\t\t\tv2EnterpriseStyles[styleId] = {\n\t\t\t\tedgeOffset: style.buffer,\n\t\t\t\tgeometryAnchors: convertedAnchors,\n\t\t\t};\n\t\t}\n\t}\n\tif (Object.keys(v2EnterpriseStyles).length > 0) {\n\t\tv2Enterprise.enterpriseStyles = v2EnterpriseStyles;\n\t}\n\n\t// Build the enterprise layers\n\tconst v2EnterpriseLayers: Map<string, EnterpriseLayer> = new Map();\n\tfor (const layers of Object.values(v3.cms?.layers ?? {})) {\n\t\tif (!layers) {\n\t\t\tcontinue;\n\t\t}\n\t\tfor (const [geometryId, layer] of typedEntries(layers)) {\n\t\t\t// This shouldn't happen, but typescript doesn't seem to know that\n\t\t\tif (typeof layer !== 'string') {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst v2EnterpriseLayer: EnterpriseLayer = v2EnterpriseLayers.get(layer) ?? {\n\t\t\t\tname: layer,\n\t\t\t\tid: `ely_${layer}`,\n\t\t\t\tspaces: [],\n\t\t\t};\n\t\t\tv2EnterpriseLayer.spaces.push(\n\t\t\t\t...(geometryMaps.space.get(geometryId)?.anchors.map((anchor) => ({\n\t\t\t\t\tfloorId: anchor.floorId,\n\t\t\t\t\tspaceId: anchor.geometryId,\n\t\t\t\t})) ?? []),\n\t\t\t);\n\t\t\tv2EnterpriseLayers.set(layer, v2EnterpriseLayer);\n\t\t}\n\t}\n\tif (v2EnterpriseLayers.size > 0) {\n\t\tv2Enterprise.layers = Array.from(v2EnterpriseLayers.values());\n\t}\n\n\t// Build the enterprise textures\n\tconst v2EnterpriseTextures: EnterpriseTexture[] = [];\n\tfor (const textures of Object.values(v3.cms?.textures ?? {})) {\n\t\tfor (const texture of textures) {\n\t\t\tconst anchors = geometryMaps.space.get(texture.geometryId)?.anchors;\n\t\t\t// No anchor,s or Unsupported texture types\n\t\t\tif (!anchors || anchors.length < 1 || texture.face === 'unknown' || texture.surface === 'unknown') {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tv2EnterpriseTextures.push({\n\t\t\t\trepeat: texture.repeat,\n\t\t\t\toffset: texture.offset,\n\t\t\t\trotation: texture.rotation,\n\t\t\t\tpath: texture.path,\n\t\t\t\tface: texture.face,\n\t\t\t\tsurface: texture.surface,\n\t\t\t\tbounds: texture.bounds,\n\t\t\t\tgeometryAnchors: anchors,\n\t\t\t});\n\t\t}\n\t}\n\tif (v2EnterpriseTextures.length > 0) {\n\t\tv2Enterprise.textures = v2EnterpriseTextures;\n\t}\n\n\t// Build the enterprise floor text\n\tconst v2EnterpriseFloorText: EnterpriseFloorText = {};\n\tfor (const [floorId, floorText] of Object.entries(v3.cms?.floorText ?? {})) {\n\t\tconst v2FloorTextFeatureCollection: FloorTextFeatureCollection = {\n\t\t\ttype: 'FeatureCollection',\n\t\t\tfeatures: [],\n\t\t};\n\t\tfor (const feature of floorText.features) {\n\t\t\tif (feature.properties.align === 'unknown') {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst commonProperties: FloorTextCommonProperties = {\n\t\t\t\talign: feature.properties.align as 'left' | 'center' | 'right',\n\t\t\t\tcolor: feature.properties.color,\n\t\t\t\tfontFamily: feature.properties.fontFamily,\n\t\t\t\tfontSize: feature.properties.fontSize,\n\t\t\t\trotation: feature.properties.rotation,\n\t\t\t\ttext: feature.properties.text,\n\t\t\t\tvisible: feature.properties.visible,\n\t\t\t};\n\t\t\tif ('geometryId' in feature.properties) {\n\t\t\t\t(commonProperties as AnchoredFloorTextProperties).geometryId = feature.properties.geometryId;\n\t\t\t} else {\n\t\t\t\t(commonProperties as FloatingFloorTextProperties).verticalOffset = feature.properties.verticalOffset;\n\t\t\t}\n\t\t\tv2FloorTextFeatureCollection.features.push({\n\t\t\t\ttype: 'Feature',\n\t\t\t\tgeometry: feature.geometry,\n\t\t\t\tproperties: commonProperties as FloorTextProperties,\n\t\t\t});\n\t\t}\n\t\tif (v2FloorTextFeatureCollection.features.length > 0) {\n\t\t\tv2EnterpriseFloorText[floorId] = v2FloorTextFeatureCollection;\n\t\t}\n\t}\n\tif (Object.keys(v2EnterpriseFloorText).length > 0) {\n\t\tv2Enterprise.floorText = v2EnterpriseFloorText;\n\t}\n\n\tconst result: V2Enterprise = { enterprise: v2Enterprise };\n\n\t// Build regular v2 text areas from enterprise text areas\n\tif (v3.cms?.textAreas) {\n\t\tconst v2TextAreas: { [floorId: FloorId]: TextAreaFeatureCollection } = {};\n\t\tfor (const [floorId, floorText] of typedEntries(v3.cms.textAreas)) {\n\t\t\tconst v2FloorTextFeatureCollection: TextAreaFeatureCollection = {\n\t\t\t\ttype: 'FeatureCollection',\n\t\t\t\tfeatures: [],\n\t\t\t};\n\t\t\tfor (const feature of floorText.features) {\n\t\t\t\tif (feature.properties.align === 'unknown') {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst commonProperties: BaseTextAreaProperties = {\n\t\t\t\t\talign: feature.properties.align as 'near' | 'center',\n\t\t\t\t\tmaxWidth: feature.properties.maxWidth,\n\t\t\t\t\tmaxHeight: feature.properties.maxHeight,\n\t\t\t\t\trotation: feature.properties.rotation,\n\t\t\t\t};\n\t\t\t\tif ('geometryId' in feature.properties) {\n\t\t\t\t\t(commonProperties as AnchoredTextAreaProperties).anchorId = feature.properties.geometryId;\n\t\t\t\t} else {\n\t\t\t\t\t(commonProperties as FloatingTextAreaProperties).verticalOffset = feature.properties.verticalOffset;\n\t\t\t\t}\n\t\t\t\tconst v2FloorTextFeature: TextAreaFeature = {\n\t\t\t\t\ttype: 'Feature',\n\t\t\t\t\tgeometry: feature.geometry,\n\t\t\t\t\tproperties: commonProperties as TextAreaProperties,\n\t\t\t\t};\n\t\t\t\tv2FloorTextFeatureCollection.features.push(v2FloorTextFeature);\n\t\t\t}\n\t\t\tv2TextAreas[floorId] = v2FloorTextFeatureCollection;\n\t\t}\n\t\tresult.textAreas = v2TextAreas;\n\t}\n\treturn result;\n}\n\nconst SUPPORTED_SOCIALS = ['facebook', 'instagram', 'twitter'] as const;\nexport function convertSocials(v3Socials: Location['social']): NonNullable<V2EnterpriseLocation['social']> {\n\tconst v2Socials: NonNullable<V2EnterpriseLocation['social']> = {};\n\tfor (const { name, url } of v3Socials) {\n\t\tconst lowerName = name.toLowerCase() as (typeof SUPPORTED_SOCIALS)[number];\n\t\tif (SUPPORTED_SOCIALS.includes(lowerName)) {\n\t\t\tv2Socials[lowerName] = url;\n\t\t}\n\t}\n\treturn v2Socials;\n}\n", "import { typedEntries } from '@mappedin/mvf-core/utils';\nimport type { FloorStackId } from '@mappedin/mvf-floor-stacks';\nimport type { ParsedMVF } from '../../types/bundle.js';\nimport type { BuilderOptions } from '../builderOptions.js';\nimport type { MVFv2_STANDARD_MVFv3 } from '../index.js';\n\nexport type V3Facade = Pick<MVFv2_STANDARD_MVFv3, 'facade'>;\nexport type V2Facade = Pick<ParsedMVF, 'facade'>;\n\nconst convertFloorStackIdToFacadeId = (floorStackId: FloorStackId) => `fc_${floorStackId.slice(3)}`;\n\nexport function buildFacade(v3: V3Facade, { geometryMaps }: Pick<BuilderOptions, 'geometryMaps'>): V2Facade {\n\tif (!v3.facade) {\n\t\treturn {};\n\t}\n\n\tconst v2: V2Facade = {};\n\n\tconst v2FacadeCollection: V2Facade['facade'] = {};\n\n\tfor (const [floorId, v3Facades] of typedEntries(v3.facade)) {\n\t\tif (!v3Facades) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tfor (const v3Facade of Object.values(v3Facades)) {\n\t\t\tconst { floorStackId, geometryIds } = v3Facade;\n\t\t\tconst facadeId = convertFloorStackIdToFacadeId(floorStackId);\n\n\t\t\tv2FacadeCollection[floorStackId] ??= {\n\t\t\t\tid: facadeId,\n\t\t\t\tspaces: [],\n\t\t\t};\n\n\t\t\tv2FacadeCollection[floorStackId].spaces.push(\n\t\t\t\t...geometryIds.map((geometryId) => ({\n\t\t\t\t\tfloorId,\n\t\t\t\t\tspaceId: geometryMaps.space.get(geometryId)?.ids[0] ?? '',\n\t\t\t\t})),\n\t\t\t);\n\t\t}\n\t}\n\n\tif (Object.keys(v2FacadeCollection).length > 0) {\n\t\tv2.facade = v2FacadeCollection;\n\t}\n\treturn v2;\n}\n", "import type { ParsedMVF } from '../../types/bundle.ts';\nimport type { BuilderOptions } from '../builderOptions.js';\nimport type { MVFv2_STANDARD_MVFv3 } from '../index.ts';\n\nexport type V3Floors = Pick<MVFv2_STANDARD_MVFv3, 'floors'>;\nexport type V2Floors = Pick<ParsedMVF, 'floor.geojson' | 'map.geojson'>;\n\nexport function buildFloors(v3: V3Floors, _builderOptions: Partial<BuilderOptions> = {}): V2Floors {\n\tconst floors: V2Floors['floor.geojson'] = {\n\t\ttype: 'FeatureCollection',\n\t\tfeatures: [],\n\t};\n\n\tconst maps: V2Floors['map.geojson'] = [];\n\n\tfor (const floor of v3.floors.features) {\n\t\tmaps.push({\n\t\t\tid: floor.properties.id,\n\t\t\texternalId: floor.properties.details?.externalId ?? '',\n\t\t\televation: floor.properties.elevation,\n\t\t\tname: floor.properties.details?.name ?? '',\n\t\t\tshortName: floor.properties.details?.shortName ?? '',\n\t\t\tsubtitle: floor.properties.subtitle,\n\t\t\tmaxHeight: floor.properties.maxHeight,\n\t\t});\n\n\t\tfloors.features.push({\n\t\t\ttype: 'Feature',\n\t\t\tgeometry: floor.geometry,\n\t\t\tproperties: {\n\t\t\t\tid: floor.properties.id,\n\t\t\t\texternalId: floor.properties.details?.externalId ?? '',\n\t\t\t\televation: floor.properties.elevation,\n\t\t\t\tname: floor.properties.details?.name ?? '',\n\t\t\t\tshortName: floor.properties.details?.shortName ?? '',\n\t\t\t\tsubtitle: floor.properties.subtitle,\n\t\t\t\tmaxHeight: floor.properties.maxHeight,\n\t\t\t},\n\t\t});\n\t}\n\treturn {\n\t\t'floor.geojson': floors,\n\t\t'map.geojson': maps,\n\t};\n}\n", "import { typedEntries } from '@mappedin/mvf-core/utils';\nimport type {\n\tAnchoredImageFeature,\n\tFloatingImageFeature,\n\tFloorImageFeature,\n\tFloorImageFeatureCollection,\n} from '../../extensions/floorImage.js';\nimport type { ParsedMVF } from '../../types/bundle.js';\nimport type { BuilderOptions } from '../builderOptions.js';\nimport type { MVFv2_STANDARD_MVFv3 } from '../index.js';\n\nexport type V3FloorImages = Pick<MVFv2_STANDARD_MVFv3, 'floorImages'>;\nexport type V2FloorImages = Pick<ParsedMVF, 'floorImages'>;\nexport type V2FloorImage = FloorImageFeature;\n\nexport function buildFloorImages(\n\tv3: V3FloorImages,\n\t{ geometryMaps }: Pick<BuilderOptions, 'geometryMaps'>,\n): V2FloorImages {\n\tconst v2: V2FloorImages = {};\n\n\tconst v2FloorImages: V2FloorImages['floorImages'] = {};\n\n\tfor (const [floorId, v3FloorImageCollection] of typedEntries(v3.floorImages ?? {})) {\n\t\tconst v2FloorImageCollection: FloorImageFeatureCollection = {\n\t\t\tfeatures: [],\n\t\t\ttype: 'FeatureCollection',\n\t\t};\n\n\t\tfor (const v3FloorImage of v3FloorImageCollection?.features ?? []) {\n\t\t\tif ('verticalOffset' in v3FloorImage.properties) {\n\t\t\t\tv2FloorImageCollection.features.push(v3FloorImage as FloatingImageFeature);\n\t\t\t} else {\n\t\t\t\tconst { geometryId, ...rest } = v3FloorImage.properties;\n\t\t\t\t// There's no way to assign an image to part of a multi-part geometry, so pulling the first ID is the best we can do\n\t\t\t\tconst anchorId = geometryMaps.space.get(geometryId)?.ids[0] ?? geometryMaps.obstruction.get(geometryId)?.ids[0];\n\t\t\t\tif (!anchorId) {\n\t\t\t\t\t// Images can only be anchored to spaces or obstructions, so if we don't have an anchor, skip it\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst feature: AnchoredImageFeature = {\n\t\t\t\t\tgeometry: v3FloorImage.geometry,\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\t...rest,\n\t\t\t\t\t\tanchorId,\n\t\t\t\t\t},\n\t\t\t\t\ttype: v3FloorImage.type,\n\t\t\t\t};\n\n\t\t\t\tv2FloorImageCollection.features.push(feature);\n\t\t\t}\n\t\t}\n\t\tv2FloorImages[floorId] = v2FloorImageCollection;\n\t}\n\tif (Object.keys(v2FloorImages).length > 0) {\n\t\tv2.floorImages = v2FloorImages;\n\t}\n\n\treturn v2;\n}\n", "import type { ParsedMVF } from '../../types/bundle.js';\nimport type { BuilderOptions } from '../builderOptions.js';\nimport type { MVFv2_STANDARD_MVFv3 } from '../index.js';\n\nexport type V3FloorStacks = Pick<MVFv2_STANDARD_MVFv3, 'floorStacks' | 'outdoors'>;\nexport type V2FloorStacks = Pick<ParsedMVF, 'floorstack.json' | 'mapstack.geojson'>;\nexport type V2FloorStack = NonNullable<V2FloorStacks['floorstack.json']>[number];\nexport type V2MapStack = NonNullable<V2FloorStacks['mapstack.geojson']>[number];\nexport function buildFloorStacks(v3: V3FloorStacks, _builderOptions: Partial<BuilderOptions> = {}): V2FloorStacks {\n\tconst floorStacks: V2FloorStacks['floorstack.json'] = [];\n\n\tfor (const floorStack of v3?.floorStacks ?? []) {\n\t\tconst v2FloorStack: V2FloorStack = {\n\t\t\tid: floorStack.id,\n\t\t\tfloors: floorStack.floors,\n\t\t\tmaps: floorStack.floors,\n\t\t\texternalId: floorStack.details?.externalId ?? '',\n\t\t\tname: floorStack.details?.name ?? '',\n\t\t\tshortName: floorStack.details?.shortName ?? '',\n\t\t\ttype: 'Building',\n\t\t};\n\t\tif (floorStack.defaultFloor) {\n\t\t\tv2FloorStack.defaultFloor = floorStack.defaultFloor;\n\t\t}\n\n\t\tfloorStacks.push(v2FloorStack);\n\t}\n\n\tif (v3.outdoors && v3.outdoors.floors.length > 0) {\n\t\tconst v2Outdoors: V2FloorStack = {\n\t\t\tid: 'outdoors',\n\t\t\tfloors: v3.outdoors.floors,\n\t\t\tmaps: v3.outdoors.floors,\n\t\t\ttype: 'Outdoor',\n\t\t\tname: 'Outdoors',\n\t\t\texternalId: 'outdoors',\n\t\t};\n\t\tfloorStacks.push(v2Outdoors);\n\t}\n\n\tconst v2: V2FloorStacks = {\n\t\t'floorstack.json': floorStacks,\n\t\t'mapstack.geojson': floorStacks,\n\t};\n\n\treturn v2;\n}\n", "import type { GeometryId } from '@mappedin/mvf-core/identifiers';\nimport { typedKeys } from '@mappedin/mvf-core/utils';\nimport type { DefaultStyleCollection } from '@mappedin/mvf-default-style';\nimport type { Area, AreaId } from '../../extensions/area.js';\nimport type { WindowFeature, WindowId } from '../../extensions/window.js';\nimport type { ParsedMVF } from '../../types/bundle.ts';\nimport type { NodeId, ObstructionFeature, ObstructionId, SpaceFeature, SpaceId } from '../../types/core.js';\nimport type { Feature, Geometry, Polygon } from '../../types/geojson.js';\nimport type { BuilderOptions } from '../builderOptions.js';\nimport { type PartiallyTransformedGeometryFeature, convertNodeToSpaceId, toObstructionId } from '../converterUtils.js';\nimport { labelCenter } from '../geoCenter.js';\nimport type { MVFv2_STANDARD_MVFv3 } from '../index.ts';\n\nexport type V3Geometry = Pick<MVFv2_STANDARD_MVFv3, 'geometry' | 'defaultStyle'>;\nexport type V2Geometry = Pick<ParsedMVF, 'space' | 'obstruction' | 'area' | 'window'>;\n\n// Helper function to check if a feature has a Polygon geometry\nfunction isPolygonFeature(feature: Feature<Geometry, unknown>): feature is Feature<Polygon, unknown> {\n\treturn feature?.geometry?.type === 'Polygon';\n}\n\nexport function buildGeometry(\n\tv3: V3Geometry,\n\t{\n\t\tgeometryMaps,\n\t\tnodesByGeometryId,\n\t\tnodesById,\n\t}: Pick<BuilderOptions, 'geometryMaps' | 'nodesByGeometryId' | 'nodesById'>,\n): V2Geometry {\n\tconst footprintGeometryIds = calculateFootprintGeometry(v3.defaultStyle);\n\tconst spaces: V2Geometry['space'] = {};\n\tconst obstructions: V2Geometry['obstruction'] = {};\n\tconst areas: V2Geometry['area'] = {};\n\tconst windows: V2Geometry['window'] = {};\n\tfor (const floorId of typedKeys(v3.geometry)) {\n\t\tconst floorFeatureCollection = v3.geometry[floorId];\n\t\tif (!floorFeatureCollection) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst spaceFeatures: (SpaceFeature | null)[] = [];\n\t\tconst obstructionFeatures: (ObstructionFeature | null)[] = [];\n\t\tconst areaFeatures: (Area | null)[] = [];\n\t\tconst windowFeatures: (WindowFeature | null)[] = [];\n\t\tfor (const feature of floorFeatureCollection.features) {\n\t\t\tconst id = feature.properties.id;\n\t\t\tconst isFootprint = footprintGeometryIds.has(id);\n\n\t\t\tconst nodes = nodesByGeometryId.get(id) ?? [];\n\n\t\t\tfor (const space of geometryMaps.space.get(id)?.features ?? []) {\n\t\t\t\tspaceFeatures.push(buildSpace(space, nodes));\n\t\t\t}\n\n\t\t\tfor (const obstruction of geometryMaps.obstruction.get(id)?.features ?? []) {\n\t\t\t\tobstructionFeatures.push(buildObstruction(obstruction, isFootprint));\n\t\t\t\tconst object = geometryMaps.object.get(id);\n\t\t\t\tif (object) {\n\t\t\t\t\t/**\n\t\t\t\t\t * Objects in MVFv2 don't have destination nodes like spaces do. So in order to navigate to objects in MVFv2,\n\t\t\t\t\t * we need to create entrance spaces for each of its nodes, where the externalId is the ID of the object.\n\t\t\t\t\t */\n\t\t\t\t\tconst entranceNodeIds = nodesByGeometryId.get(id) ?? [];\n\t\t\t\t\tconst entranceNodes = entranceNodeIds.map((nodeId) => nodesById.get(nodeId)).filter((x) => x != null);\n\t\t\t\t\tfor (const node of entranceNodes) {\n\t\t\t\t\t\tconst entranceSpace = buildSpace(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: 'Feature',\n\t\t\t\t\t\t\t\tgeometry: node.geometry,\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\tid: convertNodeToSpaceId(node.properties.id),\n\t\t\t\t\t\t\t\t\tkind: 'desk-entrance', // This identifies these special spaces\n\t\t\t\t\t\t\t\t\tdetails: {\n\t\t\t\t\t\t\t\t\t\texternalId: toObstructionId(id),\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tentranceNodeIds,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tspaceFeatures.push(entranceSpace);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const area of geometryMaps.area.get(id)?.features ?? []) {\n\t\t\t\tareaFeatures.push(buildArea(area, nodes));\n\t\t\t}\n\n\t\t\tfor (const window of geometryMaps.window.get(id)?.features ?? []) {\n\t\t\t\twindowFeatures.push(buildWindow(window));\n\t\t\t}\n\t\t}\n\n\t\tif (spaceFeatures.length > 0) {\n\t\t\tspaces[floorId] = {\n\t\t\t\ttype: 'FeatureCollection',\n\t\t\t\tfeatures: spaceFeatures.filter((x) => x !== null),\n\t\t\t};\n\t\t}\n\n\t\tif (obstructionFeatures.length > 0) {\n\t\t\tobstructions[floorId] = {\n\t\t\t\ttype: 'FeatureCollection',\n\t\t\t\tfeatures: obstructionFeatures.filter((x) => x !== null),\n\t\t\t};\n\t\t}\n\n\t\tif (areaFeatures.length > 0) {\n\t\t\tareas[floorId] = {\n\t\t\t\ttype: 'FeatureCollection',\n\t\t\t\tfeatures: areaFeatures.filter((x) => x !== null),\n\t\t\t};\n\t\t}\n\n\t\tif (windowFeatures.length > 0) {\n\t\t\twindows[floorId] = {\n\t\t\t\ttype: 'FeatureCollection',\n\t\t\t\tfeatures: windowFeatures.filter((x) => x !== null),\n\t\t\t};\n\t\t}\n\t}\n\tconst result: V2Geometry = {\n\t\tspace: spaces,\n\t\tobstruction: obstructions,\n\t};\n\tif (Object.keys(areas).length > 0) {\n\t\tresult.area = areas;\n\t}\n\tif (Object.keys(windows).length > 0) {\n\t\tresult.window = windows;\n\t}\n\n\treturn result;\n}\n\nexport function buildSpace(\n\tfeature: PartiallyTransformedGeometryFeature<SpaceId>,\n\tnodes: NodeId[],\n): SpaceFeature | null {\n\tswitch (feature.geometry.type) {\n\t\tcase 'MultiPoint':\n\t\tcase 'MultiLineString':\n\t\tcase 'MultiPolygon':\n\t\t\t// Multis will have already been split\n\t\t\treturn null;\n\t}\n\tconst space: SpaceFeature = {\n\t\ttype: 'Feature',\n\t\tgeometry: feature.geometry,\n\t\tproperties: {\n\t\t\tdestinationNodes: nodes,\n\t\t\tid: feature.properties.id,\n\t\t\texternalId: feature.properties.details?.externalId ?? '',\n\t\t\tkind: feature.properties.kind,\n\t\t},\n\t};\n\tif (feature.properties.details) {\n\t\tspace.properties.details = {\n\t\t\tname: feature.properties.details.name,\n\t\t\tdescription: feature.properties.details.description,\n\t\t\timages: feature.properties.details.icon\n\t\t\t\t? [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\turl: feature.properties.details.icon,\n\t\t\t\t\t\t\taltText: feature.properties.details.name ? `${feature.properties.details.name} icon` : 'icon',\n\t\t\t\t\t\t},\n\t\t\t\t\t]\n\t\t\t\t: undefined,\n\t\t};\n\t}\n\n\tif (isPolygonFeature(space)) {\n\t\tspace.properties.center = labelCenter(space).unwrapOr(undefined);\n\t}\n\n\treturn space;\n}\n\nexport function buildObstruction(\n\tfeature: PartiallyTransformedGeometryFeature<ObstructionId>,\n\tfootprintComponent: boolean,\n): ObstructionFeature | null {\n\tswitch (feature.geometry.type) {\n\t\tcase 'MultiPoint':\n\t\tcase 'MultiLineString':\n\t\tcase 'MultiPolygon':\n\t\tcase 'Point':\n\t\t\t// Multis will have already been split, point obstructions are meaningless\n\t\t\treturn null;\n\t}\n\n\tconst properties = feature.properties;\n\tconst obstruction: ObstructionFeature = {\n\t\ttype: 'Feature' as const,\n\t\tgeometry: feature.geometry,\n\t\tproperties: {\n\t\t\tid: properties.id,\n\t\t\texternalId: properties.details?.externalId ?? '',\n\t\t\tentrances: [],\n\t\t\tkind: properties.kind,\n\t\t\tfootprintComponent,\n\t\t},\n\t};\n\n\tif (isPolygonFeature(obstruction)) {\n\t\tobstruction.properties.center = labelCenter(obstruction).unwrapOr(undefined);\n\t}\n\n\tif (properties.details) {\n\t\tobstruction.properties.details = {\n\t\t\tname: properties.details.name,\n\t\t\tdescription: properties.details.description,\n\t\t\timages: properties.details.icon\n\t\t\t\t? [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\turl: properties.details.icon,\n\t\t\t\t\t\t\taltText: properties.details.name ? `${properties.details.name} icon` : 'icon',\n\t\t\t\t\t\t},\n\t\t\t\t\t]\n\t\t\t\t: undefined,\n\t\t};\n\t}\n\n\treturn obstruction;\n}\n\nexport function buildArea(feature: PartiallyTransformedGeometryFeature<AreaId>, nodes: NodeId[]): Area | null {\n\tif (feature.geometry.type !== 'Polygon') {\n\t\t//  Multi polygons are already split. Otherwise, it is nonsense\n\t\treturn null;\n\t}\n\tconst properties = feature.properties;\n\tconst area: Area = {\n\t\ttype: 'Feature',\n\t\tgeometry: feature.geometry,\n\t\tproperties: {\n\t\t\tid: properties.id,\n\t\t\texternalId: properties.details?.externalId ?? '',\n\t\t\tdestinationNodes: nodes,\n\t\t},\n\t};\n\n\tif (isPolygonFeature(area)) {\n\t\tarea.properties.center = labelCenter(area).unwrapOr(undefined);\n\t}\n\n\tif (properties.details) {\n\t\tarea.properties.details = {\n\t\t\tname: properties.details.name,\n\t\t\tdescription: properties.details.description,\n\t\t\timages: properties.details.icon\n\t\t\t\t? [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\turl: properties.details.icon,\n\t\t\t\t\t\t\taltText: properties.details.name ? `${properties.details.name} icon` : 'icon',\n\t\t\t\t\t\t},\n\t\t\t\t\t]\n\t\t\t\t: undefined,\n\t\t};\n\t}\n\n\treturn area;\n}\n\nexport function buildWindow(feature: PartiallyTransformedGeometryFeature<WindowId>): WindowFeature | null {\n\tif (feature.geometry.type !== 'LineString') {\n\t\treturn null;\n\t}\n\tconst window: WindowFeature = {\n\t\ttype: 'Feature',\n\t\tgeometry: feature.geometry,\n\t\tproperties: {\n\t\t\tid: feature.properties.id,\n\t\t},\n\t};\n\treturn window;\n}\n\nexport function calculateFootprintGeometry(styles?: DefaultStyleCollection): Set<GeometryId> {\n\tconst geometries = new Set<GeometryId>((styles?.ExteriorWalls?.geometryAnchors ?? []).map((a) => a.geometryId));\n\treturn geometries;\n}\n", "// Stolen from https://github.com/MappedIn/self-serve/blob/master/packages/lib/src/transformers/mvf/utils/label-center.ts\n\nimport { type Result, err, ok } from '@mappedin/safe-types/result';\nimport polylabel from 'polylabel';\nimport type { Feature, Polygon } from '../types/geojson.js';\n\n/**\n * Calculate the area of a polygon using the shoelace formula\n */\nconst calculateArea = (polygon: Feature<Polygon, any>): number => {\n\t// Handle first ring (outer ring)\n\tconst coordinates = polygon.geometry.coordinates[0];\n\tlet area = 0;\n\n\t// Shoelace formula\n\tfor (let i = 0; i < coordinates.length - 1; i++) {\n\t\tarea += coordinates[i][0] * coordinates[i + 1][1] - coordinates[i + 1][0] * coordinates[i][1];\n\t}\n\n\t// Return absolute value of half the sum\n\treturn Math.abs(area / 2);\n};\n\n/**\n * Check if a point is inside a polygon using ray casting algorithm\n */\nconst pointInPolygon = (point: [number, number], polygon: Feature<Polygon, any>): boolean => {\n\tconst [x, y] = point;\n\tconst coordinates = polygon.geometry.coordinates[0];\n\n\tlet inside = false;\n\tfor (let i = 0, j = coordinates.length - 1; i < coordinates.length; j = i++) {\n\t\tconst [xi, yi] = coordinates[i];\n\t\tconst [xj, yj] = coordinates[j];\n\n\t\tconst intersect = yi > y !== yj > y && x < ((xj - xi) * (y - yi)) / (yj - yi) + xi;\n\n\t\tif (intersect) inside = !inside;\n\t}\n\n\treturn inside;\n};\n\n/**\n * Calculate the center of mass of a polygon\n */\nconst calculateCenterOfMass = (polygon: Feature<Polygon, any>): { geometry: { coordinates: [number, number] } } => {\n\tconst coordinates = polygon.geometry.coordinates[0];\n\tlet sumX = 0;\n\tlet sumY = 0;\n\n\tfor (let i = 0; i < coordinates.length - 1; i++) {\n\t\tsumX += coordinates[i][0];\n\t\tsumY += coordinates[i][1];\n\t}\n\n\treturn {\n\t\tgeometry: {\n\t\t\tcoordinates: [sumX / (coordinates.length - 1), sumY / (coordinates.length - 1)] as [number, number],\n\t\t},\n\t};\n};\n\n/**\n * Picks a precision to use for polylabel based on the size of the polygon. Using\n * a fixed precision means for large polygons, it can take a huge amount of time\n * and memory to compute a center that is \"good enough\".\n */\nconst estimatePrecision = (f: Feature<Polygon, any>): number => {\n\tconst polygonArea = calculateArea(f);\n\tconst safePolygonArea = Number.isFinite(polygonArea) ? Math.max(polygonArea, 1) : 1;\n\t// sqrt makes this behave more consistently from what I've found in terms of\n\t// finding a near-optimal value without taking too long.\n\treturn Math.sqrt(safePolygonArea) * 0.000001;\n};\n\nexport const labelCenter = (f: Feature<Polygon, any>): Result<[number, number], Error> => {\n\ttry {\n\t\tconst center = calculateCenterOfMass(f);\n\t\tconst centerCoords = center.geometry.coordinates;\n\t\tconst isInside = pointInPolygon(centerCoords, f);\n\n\t\tif (!isInside) {\n\t\t\t// @ts-expect-error the polylabel types are wrong\n\t\t\tconst centerPt = polylabel(f.geometry.coordinates, estimatePrecision(f));\n\t\t\treturn ok([centerPt[0], centerPt[1]]);\n\t\t}\n\n\t\treturn ok(centerCoords);\n\t} catch (error) {\n\t\treturn err(new Error('Unable to calculate center of polygon'));\n\t}\n};\n", "import type { AnnotationId } from '@mappedin/mvf-annotations';\nimport { typedEntries } from '@mappedin/mvf-core/utils';\nimport type { Category } from '../../extensions/category.js';\nimport type { Location, LocationAnnotationMapping, LocationEntranceMapping } from '../../extensions/location.js';\nimport type { ParsedMVF } from '../../types/bundle.js';\nimport { Connection, type ConnectionId, type EntranceId } from '../../types/core.js';\nimport type { BuilderOptions } from '../builderOptions.js';\nimport type { MVFv2_STANDARD_MVFv3 } from '../index.js';\nimport { isLineDoor } from './connectionBuilder.js';\n\nexport type V3Locations = Pick<\n\tMVFv2_STANDARD_MVFv3,\n\t'locationCategories' | 'locations' | 'annotations' | 'connections'\n>;\nexport type V2Locations = Pick<ParsedMVF, 'category.json' | 'location.json'>;\n\n/**\n * Builds locations and categories, primarily based on the Locations extension\n * @param v3\n * @returns\n */\nexport function buildLocations(\n\tv3: V3Locations,\n\t{ geometryMaps, geometryFeatureById }: Pick<BuilderOptions, 'geometryMaps' | 'geometryFeatureById'>,\n): V2Locations {\n\tif (!v3.locationCategories && !v3.locations) {\n\t\treturn {};\n\t}\n\n\tconst v2: V2Locations = {};\n\n\tif (v3.locationCategories?.length) {\n\t\tconst v2Categories: Category[] = [];\n\t\tfor (const v3Category of v3.locationCategories) {\n\t\t\tconst v2Category: Category = {\n\t\t\t\tid: v3Category.id,\n\t\t\t\tname: v3Category.details.name,\n\t\t\t\ticon: v3Category.details.icon ?? '',\n\t\t\t};\n\t\t\tif (v3Category.parent) {\n\t\t\t\tv2Category.parent = v3Category.parent;\n\t\t\t}\n\t\t\tv2Categories.push(v2Category);\n\t\t}\n\t\tv2['category.json'] = v2Categories;\n\t}\n\n\tif (v3.locations?.length) {\n\t\tconst attachmentMaps = buildLocationAttachmentMaps(v3, { geometryFeatureById });\n\n\t\tconst v2Locations: Location[] = [];\n\t\tfor (const v3Location of v3.locations) {\n\t\t\tconst v2Location: Location = {\n\t\t\t\tid: v3Location.id,\n\t\t\t\tname: v3Location.details.name,\n\t\t\t\tcategories: v3Location.categories,\n\t\t\t\tspaces: [],\n\t\t\t\tobstructions: [],\n\t\t\t\tareas: [],\n\t\t\t\tannotations: [],\n\t\t\t\tconnections: [],\n\t\t\t\tentrances: [],\n\t\t\t\tlinks: v3Location.links,\n\t\t\t\topeningHoursSpecification: v3Location.openingHours ?? [],\n\t\t\t\tpictures: v3Location.images,\n\t\t\t\tsocial: v3Location.social,\n\t\t\t\tdescription: v3Location.details.description,\n\t\t\t\texternalId: v3Location.details.externalId,\n\t\t\t\ticon: v3Location.details.icon,\n\t\t\t\tlogo: v3Location.logo,\n\t\t\t\tphone: v3Location.phone,\n\t\t\t\twebsite: v3Location.website,\n\t\t\t};\n\t\t\tv2Locations.push(v2Location);\n\n\t\t\tfor (const { geometryId, floorId } of v3Location.geometryAnchors) {\n\t\t\t\tv2Location.spaces.push(\n\t\t\t\t\t...(geometryMaps.space.get(geometryId)?.ids.map((id) => ({ id, floor: floorId })) ?? []),\n\t\t\t\t);\n\t\t\t\tv2Location.obstructions.push(\n\t\t\t\t\t...(geometryMaps.obstruction.get(geometryId)?.ids.map((id) => ({ id, floor: floorId })) ?? []),\n\t\t\t\t);\n\t\t\t\tv2Location.areas.push(...(geometryMaps.area.get(geometryId)?.ids.map((id) => ({ id, floor: floorId })) ?? []));\n\n\t\t\t\tv2Location.entrances.push(...(attachmentMaps.entrancesByGeometryId.get(geometryId) ?? []));\n\t\t\t\tv2Location.connections.push(...(attachmentMaps.connectionsByGeometryId.get(geometryId) ?? []));\n\t\t\t\tv2Location.annotations.push(...(attachmentMaps.annotationsByGeometryId.get(geometryId) ?? []));\n\t\t\t}\n\t\t}\n\t\tv2['location.json'] = v2Locations;\n\t}\n\treturn v2;\n}\n\nexport type LocationAttachmentMaps = {\n\tannotationsByGeometryId: Map<string, LocationAnnotationMapping[]>;\n\tconnectionsByGeometryId: Map<string, ConnectionId[]>;\n\tentrancesByGeometryId: Map<string, LocationEntranceMapping[]>;\n};\nexport function buildLocationAttachmentMaps(\n\tv3: Pick<V3Locations, 'annotations' | 'connections'>,\n\t{ geometryFeatureById }: Pick<BuilderOptions, 'geometryFeatureById'>,\n): LocationAttachmentMaps {\n\tconst maps: LocationAttachmentMaps = {\n\t\tannotationsByGeometryId: new Map(),\n\t\tconnectionsByGeometryId: new Map(),\n\t\tentrancesByGeometryId: new Map(),\n\t};\n\n\tif (v3.annotations) {\n\t\tfor (const [floorId, annotations] of typedEntries(v3.annotations)) {\n\t\t\tfor (const annotation of annotations ?? []) {\n\t\t\t\tconst geometryId = annotation.geometryId;\n\t\t\t\tconst annotationId = annotation.id;\n\t\t\t\tconst annotationIds = maps.annotationsByGeometryId.get(geometryId) ?? [];\n\t\t\t\tannotationIds.push({ floor: floorId, id: annotationId });\n\t\t\t\tmaps.annotationsByGeometryId.set(geometryId, annotationIds);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (v3.connections) {\n\t\tfor (const connection of v3.connections) {\n\t\t\tconst isEntrance = isLineDoor(connection, geometryFeatureById);\n\t\t\t// Make a unique array of geometryIds for the connection\n\t\t\t// Create a unique array of geometry anchors by comparing geometryId and floorId\n\t\t\tconst geometryAnchors = Array.from(\n\t\t\t\tnew Map(\n\t\t\t\t\t[...connection.entrances, ...connection.exits].map((anchor) => [\n\t\t\t\t\t\t`${anchor.geometryId}_${anchor.floorId}`,\n\t\t\t\t\t\tanchor,\n\t\t\t\t\t]),\n\t\t\t\t).values(),\n\t\t\t);\n\t\t\tfor (const anchor of geometryAnchors) {\n\t\t\t\tconst geometryId = anchor.geometryId;\n\t\t\t\tif (isEntrance) {\n\t\t\t\t\tconst entranceIds = maps.entrancesByGeometryId.get(geometryId) ?? [];\n\t\t\t\t\tentranceIds.push({ floor: anchor.floorId, id: connection.id });\n\t\t\t\t\tmaps.entrancesByGeometryId.set(geometryId, entranceIds);\n\t\t\t\t} else {\n\t\t\t\t\tconst connectionIds = maps.connectionsByGeometryId.get(geometryId) ?? [];\n\t\t\t\t\tconnectionIds.push(connection.id);\n\t\t\t\t\tmaps.connectionsByGeometryId.set(geometryId, connectionIds);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn maps;\n}\n", "import type { ManifestCollection, ManifestFeature, ParsedMVF } from '../../types/bundle.js';\nimport type { BuilderOptions } from '../builderOptions.js';\nimport type { MVFv2_STANDARD_MVFv3 } from '../index.js';\n\nexport type V3Manifest = Pick<MVFv2_STANDARD_MVFv3, 'manifest'>;\nexport type V2Manifest = Pick<ParsedMVF, 'manifest.geojson'>;\n\nexport function buildManifest(v3: V3Manifest, _builderOptions: Partial<BuilderOptions>): V2Manifest {\n\tconst v2Manifest: ManifestCollection = {\n\t\tfeatures: [],\n\t\ttype: 'FeatureCollection',\n\t};\n\tconst v2: V2Manifest = {\n\t\t'manifest.geojson': v2Manifest,\n\t};\n\tconst v3Manifest = v3.manifest;\n\tif (v3Manifest.features.length > 0) {\n\t\tconst v3ManifestFeature = v3Manifest.features[0];\n\n\t\tconst properties = v3ManifestFeature.properties;\n\t\tconst v2ManifestFeature: ManifestFeature = {\n\t\t\ttype: 'Feature',\n\t\t\tgeometry: v3ManifestFeature.geometry,\n\t\t\tproperties: {\n\t\t\t\t// Intentionally empty\n\t\t\t\tfolder_struct: [],\n\t\t\t\tversion: '2.0.0',\n\t\t\t\ttime: properties.time,\n\t\t\t\tname: properties.name,\n\t\t\t\tnaturalBearing: properties.naturalBearing,\n\t\t\t\ttzid: properties.tzid,\n\t\t\t\tmap: properties.mapId,\n\t\t\t\torg_id: properties.orgId,\n\t\t\t\tlanguage: properties.language,\n\t\t\t},\n\t\t};\n\n\t\tv2Manifest.features.push(v2ManifestFeature);\n\t}\n\treturn v2;\n}\n", "import type { Connection } from '@mappedin/mvf-connections';\nimport type { FloorId, GeometryId } from '@mappedin/mvf-core';\nimport { typedEntries } from '@mappedin/mvf-core/utils';\nimport type { NavigationFlagDeclaration, NavigationFlagDeclarations } from '@mappedin/mvf-navigation-flags';\nimport { hasFlag } from '@mappedin/mvf-navigation-flags';\nimport type { NodeId } from '@mappedin/mvf-nodes';\nimport type { ParsedMVF } from '../../types/bundle.js';\nimport type { BuilderOptions } from '../builderOptions.js';\nimport type { MVFv2_STANDARD_MVFv3 } from '../index.js';\n\nexport type V3Nodes = Pick<MVFv2_STANDARD_MVFv3, 'nodes' | 'connections' | 'floors'>;\nexport type V2Nodes = Pick<ParsedMVF, 'node.geojson'>;\nexport type V2Node = V2Nodes['node.geojson']['features'][number];\n\nexport function buildNodes(\n\tv3: V3Nodes,\n\t{\n\t\tgeometryMaps,\n\t\tnavigationFlags,\n\t\tincomingEdgesByNodeId,\n\t}: Pick<BuilderOptions, 'geometryMaps' | 'navigationFlags' | 'incomingEdgesByNodeId'>,\n): V2Nodes {\n\tconst v2: V2Nodes = {\n\t\t'node.geojson': {\n\t\t\ttype: 'FeatureCollection',\n\t\t\tfeatures: [],\n\t\t},\n\t};\n\tconst v2Nodes = v2['node.geojson'].features;\n\n\t/**\n\t * Connections\n\t *\n\t * Connections in MVFv3 don't depend on nodes directly. Their entrances and exits should\n\t * link to geometry, and then nodes should also link to those geometries. These can all be\n\t * many to many relationships.\n\t *\n\t * We also need to know the change in elevation between floors to correctly calculate the cost\n\t * of traversing a connection.\n\t *\n\t * In MVFv2, there is a single giant node graph, connecting all the floors. Connections are decoration\n\t * that adds information to a path, like icons and whether it's accessible or not.\n\t *\n\t * Therefore, we have to do a fair bit of transformation to generate V2 node edges from V3 connections\n\t */\n\n\t// Map of floor id to elevation for determining elevation deltas between floors\n\tconst floorElevationById = createFloorElevationById(v3);\n\n\t// A map of the nodes that reference a particular geometry id, so we can connect Connection entrances and exits\n\t// to the correct nodes\n\tconst nodesByGeometryId = createNodesByGeometryId(v3);\n\n\t// A map of the neighbors a node should get from Connections\n\tconst connectionNeighborsByNodeId = createConnectionNeighborsByNodeId(v3, nodesByGeometryId, floorElevationById);\n\n\tfor (const [floorId, v3Nodes] of typedEntries(v3.nodes ?? {})) {\n\t\tfor (const v3node of v3Nodes?.features ?? []) {\n\t\t\tconst firstSpace = geometryMaps.space.get(v3node.properties.geometryIds[0])?.features[0];\n\t\t\tconst externalId =\n\t\t\t\tfirstSpace?.geometry.type === 'Point' && firstSpace?.properties.details?.externalId\n\t\t\t\t\t? firstSpace.properties.details.externalId\n\t\t\t\t\t: '';\n\n\t\t\t// A node has a flag if:\n\t\t\t// - It has incoming edges\n\t\t\t// - Some incoming edge has that flag\n\t\t\tconst incomingEdges = incomingEdgesByNodeId.get(v3node.properties.id) ?? [];\n\t\t\tconst knownFlags = Object.keys(navigationFlags ?? {});\n\t\t\tconst declarations: NavigationFlagDeclaration[] = [];\n\t\t\tfor (const edge of incomingEdges) {\n\t\t\t\tfor (const knownFlag of knownFlags) {\n\t\t\t\t\tif (hasFlag(edge, navigationFlags[knownFlag])) {\n\t\t\t\t\t\tdeclarations.push(navigationFlags[knownFlag]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst v2node: V2Node = {\n\t\t\t\ttype: 'Feature',\n\t\t\t\tgeometry: v3node.geometry,\n\t\t\t\tproperties: {\n\t\t\t\t\tid: v3node.properties.id,\n\t\t\t\t\tfloor: floorId,\n\t\t\t\t\t// If connections are not walkable, they won't make it into V2. V2 expects connections to attach to spaces.\n\t\t\t\t\tspace: v3node.properties.geometryIds\n\t\t\t\t\t\t.map((id) => geometryMaps.space.get(id)?.ids)\n\t\t\t\t\t\t.flat()\n\t\t\t\t\t\t.filter((x) => x !== undefined),\n\t\t\t\t\tneighbors: [\n\t\t\t\t\t\t...v3node.properties.neighbors.map((n) => ({ id: n.id, weight: n.extraCost })),\n\t\t\t\t\t\t...(connectionNeighborsByNodeId.get(v3node.properties.id) ?? []),\n\t\t\t\t\t],\n\t\t\t\t\tmap: floorId,\n\t\t\t\t\texternalId,\n\t\t\t\t\tflags: declarations.length > 0 ? buildFlagsArray(declarations) : undefined,\n\t\t\t\t},\n\t\t\t};\n\t\t\tv2Nodes.push(v2node);\n\t\t}\n\t}\n\treturn v2;\n}\n\nexport function createFloorElevationById(v3: Pick<V3Nodes, 'floors'>): Map<FloorId, number> {\n\tconst floorElevationById = new Map<FloorId, number>();\n\tfor (const floor of v3.floors?.features ?? []) {\n\t\tfloorElevationById.set(floor.properties.id, floor.properties.elevation);\n\t}\n\treturn floorElevationById;\n}\n\nexport function createNodesByGeometryId(v3: Pick<V3Nodes, 'nodes'>): Map<GeometryId, NodeId[]> {\n\tconst nodesByGeometryId = new Map<GeometryId, NodeId[]>();\n\tfor (const floorNodes of Object.values(v3.nodes ?? {})) {\n\t\tfor (const node of floorNodes?.features ?? []) {\n\t\t\tif (node.properties.geometryIds.length === 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (const geometryId of node.properties.geometryIds) {\n\t\t\t\tconst existingNodes = nodesByGeometryId.get(geometryId) ?? [];\n\t\t\t\tif (existingNodes.includes(node.properties.id)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\texistingNodes.push(node.properties.id);\n\t\t\t\tnodesByGeometryId.set(geometryId, existingNodes);\n\t\t\t}\n\t\t}\n\t}\n\treturn nodesByGeometryId;\n}\n\nexport function createConnectionNeighborsByNodeId(\n\tv3: V3Nodes,\n\tnodesByGeometryId: Map<GeometryId, NodeId[]>,\n\tfloorElevationById: Map<FloorId, number>,\n): Map<NodeId, { id: NodeId; weight: number }[]> {\n\t// A map of the neighbors a node should get from Connections\n\tconst connectionNeighborsByNodeId = new Map<NodeId, { id: NodeId; weight: number }[]>();\n\n\t// For each connection, connect all nodes for all entrances to all nodes for all exits, using the difference\n\t// in elevation between floors plus the entry cost to calculate the cost\n\tfor (const connection of v3.connections ?? []) {\n\t\tconst exitNodes: (Connection['exits'][number] & { nodes: NodeId[] })[] = connection.exits.map((exit) => ({\n\t\t\t...exit,\n\t\t\tnodes: nodesByGeometryId.get(exit.geometryId) ?? [],\n\t\t}));\n\t\tfor (const entrance of connection.entrances) {\n\t\t\tconst entranceNodeIds = nodesByGeometryId.get(entrance.geometryId) ?? [];\n\t\t\tfor (const entranceNode of entranceNodeIds) {\n\t\t\t\tfor (const exitNode of exitNodes) {\n\t\t\t\t\tconst floorCost =\n\t\t\t\t\t\tMath.abs(\n\t\t\t\t\t\t\t(floorElevationById.get(entrance.floorId) ?? 0) - (floorElevationById.get(exitNode.floorId) ?? 0),\n\t\t\t\t\t\t) * connection.floorCostMultiplier;\n\t\t\t\t\tconst existingNeighbors = connectionNeighborsByNodeId.get(entranceNode) ?? [];\n\t\t\t\t\t// Technically there could be multiple nodes linked to the same geometry id, so we need to connect all of them\n\t\t\t\t\t// It will PROBABLY just be one though.\n\t\t\t\t\texistingNeighbors.push(\n\t\t\t\t\t\t...exitNode.nodes\n\t\t\t\t\t\t\t.filter((id) => id !== entranceNode)\n\t\t\t\t\t\t\t.map((id) => ({ id, weight: floorCost + connection.entryCost })),\n\t\t\t\t\t);\n\t\t\t\t\tconnectionNeighborsByNodeId.set(entranceNode, existingNeighbors);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn connectionNeighborsByNodeId;\n}\n\nexport function buildFlagsArray(\n\tflagDeclarations: NonNullable<NavigationFlagDeclarations[string]>[],\n): number[] | undefined {\n\tif (flagDeclarations == null || flagDeclarations.length === 0) {\n\t\treturn;\n\t}\n\n\tconst flags = new Array(Math.max(...flagDeclarations.map((f) => f.index)) + 1).fill(0);\n\n\tfor (const declaration of flagDeclarations) {\n\t\tflags[declaration.index] |= 1 << declaration.bit;\n\t}\n\n\treturn flags;\n}\n", "import type { GeometryFeature } from '@mappedin/mvf-core';\nimport { typedEntries } from '@mappedin/mvf-core/utils';\nimport type { LineStringStyle, PointStyle, PolygonStyle, StyleCollection } from '../../extensions/style.js';\nimport type { ParsedMVF } from '../../types/bundle.js';\nimport type { BuilderOptions } from '../builderOptions.js';\nimport type { MVFv2_STANDARD_MVFv3 } from '../index.js';\n\nexport type V3Styles = Pick<MVFv2_STANDARD_MVFv3, 'defaultStyle'>;\nexport type V2Styles = Pick<ParsedMVF, 'styles.json'>;\nexport type V2Style = StyleCollection[string];\n\ntype GeometryType = GeometryFeature['geometry']['type'];\nexport type GeometryByType = Map<string, GeometryType>;\n\nexport function groupGeometryByType(\n\tgeometryIds: string[],\n\tgeometryByType: GeometryByType,\n): Partial<Record<GeometryType, string[]>> {\n\tconst grouped: Partial<Record<GeometryType, string[]>> = {};\n\n\tfor (const id of geometryIds) {\n\t\tconst type = geometryByType.get(id);\n\t\tif (type) {\n\t\t\tgrouped[type] ??= [];\n\t\t\tgrouped[type].push(id);\n\t\t}\n\t}\n\n\treturn grouped;\n}\nexport function buildStyles(v3: V3Styles, { geometryMaps }: Pick<BuilderOptions, 'geometryMaps'>): V2Styles {\n\tif (!v3.defaultStyle) {\n\t\treturn {};\n\t}\n\tconst v2: V2Styles = {};\n\n\tconst styles: StyleCollection = {};\n\tv2['styles.json'] = styles;\n\n\tconst spacesAndObstructions = [\n\t\t...Array.from(geometryMaps.space.values()).map((space) => space.features),\n\t\t...Array.from(geometryMaps.obstruction.values()).map((obstruction) => obstruction.features),\n\t];\n\n\tconst geometryTypeById: GeometryByType = new Map(\n\t\tspacesAndObstructions.flatMap((feature) =>\n\t\t\tfeature.map((geometry) => [geometry.properties.id, geometry.geometry.type]),\n\t\t),\n\t);\n\n\tfor (const [groupId, v3Style] of typedEntries(v3.defaultStyle)) {\n\t\tconst grouped = groupGeometryByType(\n\t\t\tv3Style.geometryAnchors.flatMap((anchor) => [\n\t\t\t\t...(geometryMaps.space.get(anchor.geometryId)?.ids ?? []),\n\t\t\t\t...(geometryMaps.obstruction.get(anchor.geometryId)?.ids ?? []),\n\t\t\t]),\n\t\t\tgeometryTypeById,\n\t\t);\n\n\t\tif (grouped.Point && grouped.Point.length > 0) {\n\t\t\tconst pointStyle: PointStyle = {\n\t\t\t\tpoints: Array.from(grouped.Point.values()),\n\t\t\t\tshowImage: v3Style.extra?.showImage !== undefined ? v3Style.extra?.showImage === true : v3Style.opacity !== 0,\n\t\t\t};\n\t\t\tstyles[`${groupId}.Point`] = pointStyle;\n\t\t}\n\n\t\tif (grouped.LineString && grouped.LineString.length > 0) {\n\t\t\tconst lineStringStyle: LineStringStyle = {\n\t\t\t\tlineStrings: Array.from(grouped.LineString.values()),\n\t\t\t\taltitude: v3Style.altitude,\n\t\t\t\tcolor: v3Style.color,\n\t\t\t\theight: v3Style.height,\n\t\t\t\topacity: v3Style.opacity,\n\t\t\t\twidth: v3Style.buffer,\n\t\t\t};\n\t\t\tstyles[`${groupId}.LineString`] = lineStringStyle;\n\t\t}\n\n\t\tif (grouped.Polygon && grouped.Polygon.length > 0) {\n\t\t\tconst polygonStyle: PolygonStyle = {\n\t\t\t\tpolygons: Array.from(grouped.Polygon.values()),\n\t\t\t\taltitude: v3Style.altitude,\n\t\t\t\tcolor: v3Style.color,\n\t\t\t\theight: v3Style.height,\n\t\t\t\topacity: v3Style.opacity,\n\t\t\t};\n\t\t\tif (v3Style.extra?.showImage !== undefined) {\n\t\t\t\tpolygonStyle.showImage = v3Style.extra.showImage === true;\n\t\t\t}\n\t\t\tstyles[`${groupId}.Polygon`] = polygonStyle;\n\t\t}\n\t}\n\n\treturn v2;\n}\n", "export function normalizeUrl(url: string) {\n\treturn url.endsWith('/') ? url : `${url}/`;\n}\n", "export const DEFAULT_V6_URI = 'https://app.mappedin.com/';\nexport const DEFAULT_ENTERPRISE_AUTH_URL = 'https://auth.mappedin.com/';\n\n/**\n * Represents the environment state configuration.\n * @example\n * const mapData = getMapData({\n *  key: '',\n *  secret: '',\n *  environment: 'eu'\n * })\n */\nexport type Environment = {\n\t/**\n\t * The base URI for the API.\n\t */\n\tbaseUri: string;\n\n\t/**\n\t * The base URI for authentication.\n\t */\n\tbaseAuthUri: string;\n\n\t/**\n\t * The base URI for analytics.\n\t */\n\tanalyticsBaseUri: string;\n\n\t/**\n\t * The URI for the tile server.\n\t */\n\ttileServerUri: string;\n};\n\nexport type InternalServiceEnvironment =\n\t| 'us'\n\t| 'us-enterprise'\n\t| 'eu'\n\t| 'us-staging-enterprise'\n\t| 'us-staging-self-serve';\nexport type ServiceEnvironment = 'us' | 'eu';\n\nexport const US_SELF_SERVE_ENV: Readonly<Environment> = Object.freeze({\n\tbaseUri: 'https://app.mappedin.com/',\n\tbaseAuthUri: 'https://app.mappedin.com/',\n\tanalyticsBaseUri: 'https://api-gateway.mappedin.com/track-analytics/a/',\n\ttileServerUri: 'https://tiles-cdn.mappedin.com/styles/mappedin/style.json',\n});\n\nexport const US_ENTERPRISE_ENV: Readonly<Environment> = Object.freeze({\n\t...US_SELF_SERVE_ENV,\n\tbaseUri: 'https://api-gateway.mappedin.com/',\n\tbaseAuthUri: 'https://auth.mappedin.com/',\n});\n\nconst EU_ENV_ENTERPRISE: Readonly<Environment> = Object.freeze({\n\tbaseUri: 'https://api-gateway.eu.mappedin.com/',\n\tbaseAuthUri: 'https://auth.eu.mappedin.com/',\n\tanalyticsBaseUri: `https://api-gateway.eu.mappedin.com/track-analytics/a/`,\n\ttileServerUri: 'https://tiles-cdn.eu.mappedin.com/styles/mappedin/style.json',\n});\n\nconst US_STAGING_ENV: Readonly<Environment> = Object.freeze({\n\tbaseUri: 'https://api-gateway-staging.mappedin.net/',\n\tbaseAuthUri: 'https://auth-staging.mappedin.net/',\n\tanalyticsBaseUri: `https://api-gateway-staging.mappedin.net/track-analytics/a/`,\n\ttileServerUri: 'https://tiles-cdn.mappedin.com/styles/mappedin/style.json',\n});\n\nconst US_SELF_SERVE_STAGING_ENV: Readonly<Environment> = Object.freeze({\n\tbaseUri: 'https://app-staging.mappedin.net/',\n\tbaseAuthUri: 'https://app-staging.mappedin.net/',\n\tanalyticsBaseUri: `https://api-gateway-staging.mappedin.net/track-analytics/a/`,\n\ttileServerUri: 'https://tiles-cdn.mappedin.com/styles/mappedin/style.json',\n});\n\nconst ENV_MAP: Record<InternalServiceEnvironment, Readonly<Environment>> = {\n\teu: EU_ENV_ENTERPRISE,\n\tus: US_SELF_SERVE_ENV,\n\t'us-enterprise': US_ENTERPRISE_ENV,\n\t'us-staging-enterprise': US_STAGING_ENV,\n\t'us-staging-self-serve': US_SELF_SERVE_STAGING_ENV,\n};\n\nexport function getEnvironmentAuthState(env: InternalServiceEnvironment) {\n\treturn ENV_MAP[env];\n}\n", "import { normalizeUrl } from '../../common/normalize-url';\nimport { SafeStorage } from '../../common/storage';\nimport { DEFAULT_ENTERPRISE_AUTH_URL, DEFAULT_V6_URI } from '../constants';\nimport { isomorphicFetch, type TGetMapDataWithCredentialsOptions } from '../mvf-utils';\nimport { shouldRefreshToken } from './utils';\n\nexport const ACCESS_TOKEN_REFRESH_BUFFER_MINUTES = 60;\nexport const ACCESS_TOKEN_REFRESH_BUFFER_MS = ACCESS_TOKEN_REFRESH_BUFFER_MINUTES * 60 * 1000;\n\nexport const ACCESS_TOKEN_STORAGE_KEY = 'accessTokens';\n\ntype AccessToken = {\n\taccessToken: string;\n\texpiresTimestamp: number;\n};\n\ntype TGetAccessTokenOptions = Pick<\n\tTGetMapDataWithCredentialsOptions,\n\t'baseUri' | 'baseAuthUri' | 'key' | 'secret' | 'customAuthUri'\n>;\n\n/**\n * Get an access token from storage or fetch it from the API using API keys.\n */\nexport async function getAccessToken(userOptions: TGetAccessTokenOptions, enterprise = false): Promise<AccessToken> {\n\tconst key = `${userOptions.key}`;\n\tconst safeStorage = SafeStorage.getInstance();\n\tconst cachedTokens = (safeStorage?.loadSessionData(ACCESS_TOKEN_STORAGE_KEY) || {}) as Record<string, AccessToken>;\n\n\tconst currentTimestamp = Math.floor(Date.now() / 1000);\n\n\t// We have to store different access tokens for different Mappedin auth keys\n\t// to avoid conflicts when somebody uses multiple keys during the same session\n\tif (\n\t\tcachedTokens[key] &&\n\t\t!shouldRefreshToken(cachedTokens[key].expiresTimestamp * 1000, ACCESS_TOKEN_REFRESH_BUFFER_MINUTES)\n\t) {\n\t\treturn cachedTokens[key];\n\t}\n\n\tconst tokenData = enterprise\n\t\t? await fetchAccessTokenEnterprise(userOptions, currentTimestamp)\n\t\t: await fetchAccessToken(userOptions, currentTimestamp);\n\tconst newTokens = { ...cachedTokens, [key]: tokenData };\n\n\tsafeStorage?.saveSessionData(ACCESS_TOKEN_STORAGE_KEY, newTokens);\n\n\treturn tokenData;\n}\n\n/**\n * Fetch an access token for enterprise.\n */\nexport async function fetchAccessTokenEnterprise(\n\tuserOptions: TGetAccessTokenOptions,\n\tcurrentTimestamp: number,\n): Promise<AccessToken> {\n\tlet url: string | undefined;\n\tif (userOptions.customAuthUri) {\n\t\turl = userOptions.customAuthUri;\n\t} else {\n\t\turl = `${userOptions.baseAuthUri ?? DEFAULT_ENTERPRISE_AUTH_URL}oauth2/token`;\n\t}\n\tlet response: Awaited<ReturnType<typeof fetch>>;\n\n\ttry {\n\t\tresponse = await isomorphicFetch()(url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t},\n\t\t\tbody: JSON.stringify({\n\t\t\t\tgrant_type: 'client_credentials',\n\t\t\t\tclient_id: userOptions.key,\n\t\t\t\tclient_secret: userOptions.secret,\n\t\t\t}),\n\t\t});\n\t} catch (error) {\n\t\tconst errorMessage = error instanceof Error ? error.message : String(error);\n\t\tthrow new Error(`Failed to fetch enterprise access token from ${url}: ${errorMessage}`);\n\t}\n\n\tif (!response.ok) {\n\t\tthrow new Error(`${response.status} ${response.statusText}: ${await response.text()}`);\n\t}\n\n\tconst tokenData = (await response.json()) as unknown as { access_token: string; expires_in: number };\n\n\treturn { accessToken: tokenData.access_token, expiresTimestamp: currentTimestamp + tokenData.expires_in };\n}\n\n/**\n * Fetch an access token for self-serve.\n */\nasync function fetchAccessToken(userOptions: TGetAccessTokenOptions, currentTimestamp: number): Promise<AccessToken> {\n\tlet url: string | undefined;\n\tif (userOptions.customAuthUri) {\n\t\turl = userOptions.customAuthUri;\n\t} else {\n\t\turl = `${userOptions.baseAuthUri ? normalizeUrl(userOptions.baseAuthUri) : DEFAULT_V6_URI}api/v1/api-key/token`;\n\t}\n\tlet response: Awaited<ReturnType<typeof fetch>>;\n\ttry {\n\t\tresponse = await isomorphicFetch()(url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\tbody: JSON.stringify({ key: userOptions.key, secret: userOptions.secret }),\n\t\t});\n\t} catch (e) {\n\t\tconst errorMessage = e instanceof Error ? e.message : String(e);\n\t\tthrow new Error(`Failed to fetch access token from ${url}: ${errorMessage}`);\n\t}\n\n\tif (!response.ok) {\n\t\tthrow new Error(`${response.status} ${response.statusText}: ${await response.text()}`);\n\t}\n\n\tconst tokenData = (await response.json()) as unknown as { access_token: string; expires_in: number };\n\n\treturn { accessToken: tokenData.access_token, expiresTimestamp: currentTimestamp + tokenData.expires_in };\n}\n", "/**\n * Returns the remaining expiration time of a token.\n */\nexport const fromNow = (expires: number) => {\n\tconst currentTimestamp = Date.now();\n\tconst remainingExpirationTime = expires - currentTimestamp;\n\n\treturn remainingExpirationTime;\n};\n\n/**\n * Whether a token is within the buffer time before it expires.\n */\nexport const shouldRefreshToken = (expires: number, bufferMinutes) => {\n\tconst remainingExpirationTime = fromNow(expires);\n\n\treturn remainingExpirationTime <= bufferMinutes * 60 * 1000;\n};\n", "import { normalizeUrl } from '../../common/normalize-url';\nimport { SafeStorage } from '../../common/storage';\nimport { DEFAULT_V6_URI } from '../constants';\nimport { isomorphicFetch } from '../mvf-utils';\nimport { shouldRefreshToken } from './utils';\n\nexport const SAS_TOKEN_REFRESH_BUFFER_MINUTES = 60;\nexport const SAS_TOKEN_REFRESH_BUFFER_MS = SAS_TOKEN_REFRESH_BUFFER_MINUTES * 60 * 1000;\nexport const SAS_TOKEN_STORAGE_KEY = 'miSasTokens';\n\ntype SasToken = {\n\ttoken: string;\n\texpires: number;\n};\n\n/**\n * Fetch the SAS Token either from sesion storage or from the API using the access token.\n * @param userOptions - The user options.\n * @returns The SAS Token.\n */\nexport async function getSasToken(\n\tuserOptions: { mapId: string; baseUri?: string },\n\taccessToken: string,\n): Promise<SasToken> {\n\tconst key = `${accessToken}__${userOptions.mapId}`;\n\tconst safeStorage = SafeStorage.getInstance();\n\tconst cachedTokens = (safeStorage?.loadSessionData(SAS_TOKEN_STORAGE_KEY) || {}) as Record<string, SasToken>;\n\n\t// We have to store different sas tokens for different access tokens\n\t// to avoid conflicts when somebody uses multiple keys during the same session\n\tif (cachedTokens[key] && !shouldRefreshToken(cachedTokens[key].expires, SAS_TOKEN_REFRESH_BUFFER_MINUTES)) {\n\t\treturn cachedTokens[key];\n\t}\n\n\tconst tokenData = await fetchSasToken(userOptions, accessToken);\n\tconst newTokens = {\n\t\t...cachedTokens,\n\t\t[key]: { token: tokenData.token, expires: new Date(tokenData.expires).getTime() },\n\t};\n\n\tsafeStorage?.saveSessionData(SAS_TOKEN_STORAGE_KEY, newTokens);\n\n\treturn tokenData;\n}\n\n/**\n * Fetch the SAS Token for private images using the access token.\n * @param userOptions - The user options.\n * @param accessToken - The access token.\n * @returns The SAS Token.\n */\nexport async function fetchSasToken(userOptions: { mapId: string; baseUri?: string }, accessToken: string) {\n\tconst url = `${userOptions.baseUri ? normalizeUrl(userOptions.baseUri) : DEFAULT_V6_URI}api/v1/venue/${\n\t\tuserOptions.mapId\n\t}/sas-token`;\n\tconst response = await isomorphicFetch()(url, {\n\t\tmethod: 'GET',\n\t\theaders: { Authorization: `Bearer ${accessToken}` },\n\t});\n\n\tif (!response.ok) {\n\t\tthrow new Error(`${response.status} ${response.statusText}: ${await response.text()}`);\n\t}\n\n\tconst tokenData = (await response.json()) as unknown as SasToken;\n\n\treturn {\n\t\ttoken: tokenData.token,\n\t\texpires: new Date(tokenData.expires).getTime(),\n\t};\n}\n", "// DEFLATE is a complex format; to read this code, you should probably check the RFC first:\n// https://tools.ietf.org/html/rfc1951\n// You may also wish to take a look at the guide I made about this program:\n// https://gist.github.com/101arrowz/253f31eb5abc3d9275ab943003ffecad\n// Some of the following code is similar to that of UZIP.js:\n// https://github.com/photopea/UZIP.js\n// However, the vast majority of the codebase has diverged from UZIP.js to increase performance and reduce bundle size.\n// Sometimes 0 will appear where -1 would be more appropriate. This is because using a uint\n// is better for memory in most engines (I *think*).\nvar ch2 = {};\nvar wk = (function (c, id, msg, transfer, cb) {\n    var w = new Worker(ch2[id] || (ch2[id] = URL.createObjectURL(new Blob([\n        c + ';addEventListener(\"error\",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'\n    ], { type: 'text/javascript' }))));\n    w.onmessage = function (e) {\n        var d = e.data, ed = d.$e$;\n        if (ed) {\n            var err = new Error(ed[0]);\n            err['code'] = ed[1];\n            err.stack = ed[2];\n            cb(err, null);\n        }\n        else\n            cb(null, d);\n    };\n    w.postMessage(msg, transfer);\n    return w;\n});\n\n// aliases for shorter compressed code (most minifers don't do this)\nvar u8 = Uint8Array, u16 = Uint16Array, u32 = Uint32Array;\n// fixed length extra bits\nvar fleb = new u8([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, /* unused */ 0, 0, /* impossible */ 0]);\n// fixed distance extra bits\n// see fleb note\nvar fdeb = new u8([0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, /* unused */ 0, 0]);\n// code length index map\nvar clim = new u8([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]);\n// get base, reverse index map from extra bits\nvar freb = function (eb, start) {\n    var b = new u16(31);\n    for (var i = 0; i < 31; ++i) {\n        b[i] = start += 1 << eb[i - 1];\n    }\n    // numbers here are at max 18 bits\n    var r = new u32(b[30]);\n    for (var i = 1; i < 30; ++i) {\n        for (var j = b[i]; j < b[i + 1]; ++j) {\n            r[j] = ((j - b[i]) << 5) | i;\n        }\n    }\n    return [b, r];\n};\nvar _a = freb(fleb, 2), fl = _a[0], revfl = _a[1];\n// we can ignore the fact that the other numbers are wrong; they never happen anyway\nfl[28] = 258, revfl[258] = 28;\nvar _b = freb(fdeb, 0), fd = _b[0], revfd = _b[1];\n// map of value to reverse (assuming 16 bits)\nvar rev = new u16(32768);\nfor (var i = 0; i < 32768; ++i) {\n    // reverse table algorithm from SO\n    var x = ((i & 0xAAAA) >>> 1) | ((i & 0x5555) << 1);\n    x = ((x & 0xCCCC) >>> 2) | ((x & 0x3333) << 2);\n    x = ((x & 0xF0F0) >>> 4) | ((x & 0x0F0F) << 4);\n    rev[i] = (((x & 0xFF00) >>> 8) | ((x & 0x00FF) << 8)) >>> 1;\n}\n// create huffman tree from u8 \"map\": index -> code length for code index\n// mb (max bits) must be at most 15\n// TODO: optimize/split up?\nvar hMap = (function (cd, mb, r) {\n    var s = cd.length;\n    // index\n    var i = 0;\n    // u16 \"map\": index -> # of codes with bit length = index\n    var l = new u16(mb);\n    // length of cd must be 288 (total # of codes)\n    for (; i < s; ++i) {\n        if (cd[i])\n            ++l[cd[i] - 1];\n    }\n    // u16 \"map\": index -> minimum code for bit length = index\n    var le = new u16(mb);\n    for (i = 0; i < mb; ++i) {\n        le[i] = (le[i - 1] + l[i - 1]) << 1;\n    }\n    var co;\n    if (r) {\n        // u16 \"map\": index -> number of actual bits, symbol for code\n        co = new u16(1 << mb);\n        // bits to remove for reverser\n        var rvb = 15 - mb;\n        for (i = 0; i < s; ++i) {\n            // ignore 0 lengths\n            if (cd[i]) {\n                // num encoding both symbol and bits read\n                var sv = (i << 4) | cd[i];\n                // free bits\n                var r_1 = mb - cd[i];\n                // start value\n                var v = le[cd[i] - 1]++ << r_1;\n                // m is end value\n                for (var m = v | ((1 << r_1) - 1); v <= m; ++v) {\n                    // every 16 bit value starting with the code yields the same result\n                    co[rev[v] >>> rvb] = sv;\n                }\n            }\n        }\n    }\n    else {\n        co = new u16(s);\n        for (i = 0; i < s; ++i) {\n            if (cd[i]) {\n                co[i] = rev[le[cd[i] - 1]++] >>> (15 - cd[i]);\n            }\n        }\n    }\n    return co;\n});\n// fixed length tree\nvar flt = new u8(288);\nfor (var i = 0; i < 144; ++i)\n    flt[i] = 8;\nfor (var i = 144; i < 256; ++i)\n    flt[i] = 9;\nfor (var i = 256; i < 280; ++i)\n    flt[i] = 7;\nfor (var i = 280; i < 288; ++i)\n    flt[i] = 8;\n// fixed distance tree\nvar fdt = new u8(32);\nfor (var i = 0; i < 32; ++i)\n    fdt[i] = 5;\n// fixed length map\nvar flm = /*#__PURE__*/ hMap(flt, 9, 0), flrm = /*#__PURE__*/ hMap(flt, 9, 1);\n// fixed distance map\nvar fdm = /*#__PURE__*/ hMap(fdt, 5, 0), fdrm = /*#__PURE__*/ hMap(fdt, 5, 1);\n// find max of array\nvar max = function (a) {\n    var m = a[0];\n    for (var i = 1; i < a.length; ++i) {\n        if (a[i] > m)\n            m = a[i];\n    }\n    return m;\n};\n// read d, starting at bit p and mask with m\nvar bits = function (d, p, m) {\n    var o = (p / 8) | 0;\n    return ((d[o] | (d[o + 1] << 8)) >> (p & 7)) & m;\n};\n// read d, starting at bit p continuing for at least 16 bits\nvar bits16 = function (d, p) {\n    var o = (p / 8) | 0;\n    return ((d[o] | (d[o + 1] << 8) | (d[o + 2] << 16)) >> (p & 7));\n};\n// get end of byte\nvar shft = function (p) { return ((p + 7) / 8) | 0; };\n// typed array slice - allows garbage collector to free original reference,\n// while being more compatible than .slice\nvar slc = function (v, s, e) {\n    if (s == null || s < 0)\n        s = 0;\n    if (e == null || e > v.length)\n        e = v.length;\n    // can't use .constructor in case user-supplied\n    var n = new (v.BYTES_PER_ELEMENT == 2 ? u16 : v.BYTES_PER_ELEMENT == 4 ? u32 : u8)(e - s);\n    n.set(v.subarray(s, e));\n    return n;\n};\n/**\n * Codes for errors generated within this library\n */\nexport var FlateErrorCode = {\n    UnexpectedEOF: 0,\n    InvalidBlockType: 1,\n    InvalidLengthLiteral: 2,\n    InvalidDistance: 3,\n    StreamFinished: 4,\n    NoStreamHandler: 5,\n    InvalidHeader: 6,\n    NoCallback: 7,\n    InvalidUTF8: 8,\n    ExtraFieldTooLong: 9,\n    InvalidDate: 10,\n    FilenameTooLong: 11,\n    StreamFinishing: 12,\n    InvalidZipData: 13,\n    UnknownCompressionMethod: 14\n};\n// error codes\nvar ec = [\n    'unexpected EOF',\n    'invalid block type',\n    'invalid length/literal',\n    'invalid distance',\n    'stream finished',\n    'no stream handler',\n    ,\n    'no callback',\n    'invalid UTF-8 data',\n    'extra field too long',\n    'date not in range 1980-2099',\n    'filename too long',\n    'stream finishing',\n    'invalid zip data'\n    // determined by unknown compression method\n];\n;\nvar err = function (ind, msg, nt) {\n    var e = new Error(msg || ec[ind]);\n    e.code = ind;\n    if (Error.captureStackTrace)\n        Error.captureStackTrace(e, err);\n    if (!nt)\n        throw e;\n    return e;\n};\n// expands raw DEFLATE data\nvar inflt = function (dat, buf, st) {\n    // source length\n    var sl = dat.length;\n    if (!sl || (st && st.f && !st.l))\n        return buf || new u8(0);\n    // have to estimate size\n    var noBuf = !buf || st;\n    // no state\n    var noSt = !st || st.i;\n    if (!st)\n        st = {};\n    // Assumes roughly 33% compression ratio average\n    if (!buf)\n        buf = new u8(sl * 3);\n    // ensure buffer can fit at least l elements\n    var cbuf = function (l) {\n        var bl = buf.length;\n        // need to increase size to fit\n        if (l > bl) {\n            // Double or set to necessary, whichever is greater\n            var nbuf = new u8(Math.max(bl * 2, l));\n            nbuf.set(buf);\n            buf = nbuf;\n        }\n    };\n    //  last chunk         bitpos           bytes\n    var final = st.f || 0, pos = st.p || 0, bt = st.b || 0, lm = st.l, dm = st.d, lbt = st.m, dbt = st.n;\n    // total bits\n    var tbts = sl * 8;\n    do {\n        if (!lm) {\n            // BFINAL - this is only 1 when last chunk is next\n            final = bits(dat, pos, 1);\n            // type: 0 = no compression, 1 = fixed huffman, 2 = dynamic huffman\n            var type = bits(dat, pos + 1, 3);\n            pos += 3;\n            if (!type) {\n                // go to end of byte boundary\n                var s = shft(pos) + 4, l = dat[s - 4] | (dat[s - 3] << 8), t = s + l;\n                if (t > sl) {\n                    if (noSt)\n                        err(0);\n                    break;\n                }\n                // ensure size\n                if (noBuf)\n                    cbuf(bt + l);\n                // Copy over uncompressed data\n                buf.set(dat.subarray(s, t), bt);\n                // Get new bitpos, update byte count\n                st.b = bt += l, st.p = pos = t * 8, st.f = final;\n                continue;\n            }\n            else if (type == 1)\n                lm = flrm, dm = fdrm, lbt = 9, dbt = 5;\n            else if (type == 2) {\n                //  literal                            lengths\n                var hLit = bits(dat, pos, 31) + 257, hcLen = bits(dat, pos + 10, 15) + 4;\n                var tl = hLit + bits(dat, pos + 5, 31) + 1;\n                pos += 14;\n                // length+distance tree\n                var ldt = new u8(tl);\n                // code length tree\n                var clt = new u8(19);\n                for (var i = 0; i < hcLen; ++i) {\n                    // use index map to get real code\n                    clt[clim[i]] = bits(dat, pos + i * 3, 7);\n                }\n                pos += hcLen * 3;\n                // code lengths bits\n                var clb = max(clt), clbmsk = (1 << clb) - 1;\n                // code lengths map\n                var clm = hMap(clt, clb, 1);\n                for (var i = 0; i < tl;) {\n                    var r = clm[bits(dat, pos, clbmsk)];\n                    // bits read\n                    pos += r & 15;\n                    // symbol\n                    var s = r >>> 4;\n                    // code length to copy\n                    if (s < 16) {\n                        ldt[i++] = s;\n                    }\n                    else {\n                        //  copy   count\n                        var c = 0, n = 0;\n                        if (s == 16)\n                            n = 3 + bits(dat, pos, 3), pos += 2, c = ldt[i - 1];\n                        else if (s == 17)\n                            n = 3 + bits(dat, pos, 7), pos += 3;\n                        else if (s == 18)\n                            n = 11 + bits(dat, pos, 127), pos += 7;\n                        while (n--)\n                            ldt[i++] = c;\n                    }\n                }\n                //    length tree                 distance tree\n                var lt = ldt.subarray(0, hLit), dt = ldt.subarray(hLit);\n                // max length bits\n                lbt = max(lt);\n                // max dist bits\n                dbt = max(dt);\n                lm = hMap(lt, lbt, 1);\n                dm = hMap(dt, dbt, 1);\n            }\n            else\n                err(1);\n            if (pos > tbts) {\n                if (noSt)\n                    err(0);\n                break;\n            }\n        }\n        // Make sure the buffer can hold this + the largest possible addition\n        // Maximum chunk size (practically, theoretically infinite) is 2^17;\n        if (noBuf)\n            cbuf(bt + 131072);\n        var lms = (1 << lbt) - 1, dms = (1 << dbt) - 1;\n        var lpos = pos;\n        for (;; lpos = pos) {\n            // bits read, code\n            var c = lm[bits16(dat, pos) & lms], sym = c >>> 4;\n            pos += c & 15;\n            if (pos > tbts) {\n                if (noSt)\n                    err(0);\n                break;\n            }\n            if (!c)\n                err(2);\n            if (sym < 256)\n                buf[bt++] = sym;\n            else if (sym == 256) {\n                lpos = pos, lm = null;\n                break;\n            }\n            else {\n                var add = sym - 254;\n                // no extra bits needed if less\n                if (sym > 264) {\n                    // index\n                    var i = sym - 257, b = fleb[i];\n                    add = bits(dat, pos, (1 << b) - 1) + fl[i];\n                    pos += b;\n                }\n                // dist\n                var d = dm[bits16(dat, pos) & dms], dsym = d >>> 4;\n                if (!d)\n                    err(3);\n                pos += d & 15;\n                var dt = fd[dsym];\n                if (dsym > 3) {\n                    var b = fdeb[dsym];\n                    dt += bits16(dat, pos) & ((1 << b) - 1), pos += b;\n                }\n                if (pos > tbts) {\n                    if (noSt)\n                        err(0);\n                    break;\n                }\n                if (noBuf)\n                    cbuf(bt + 131072);\n                var end = bt + add;\n                for (; bt < end; bt += 4) {\n                    buf[bt] = buf[bt - dt];\n                    buf[bt + 1] = buf[bt + 1 - dt];\n                    buf[bt + 2] = buf[bt + 2 - dt];\n                    buf[bt + 3] = buf[bt + 3 - dt];\n                }\n                bt = end;\n            }\n        }\n        st.l = lm, st.p = lpos, st.b = bt, st.f = final;\n        if (lm)\n            final = 1, st.m = lbt, st.d = dm, st.n = dbt;\n    } while (!final);\n    return bt == buf.length ? buf : slc(buf, 0, bt);\n};\n// starting at p, write the minimum number of bits that can hold v to d\nvar wbits = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) | 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n};\n// starting at p, write the minimum number of bits (>8) that can hold v to d\nvar wbits16 = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) | 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n    d[o + 2] |= v >>> 16;\n};\n// creates code lengths from a frequency table\nvar hTree = function (d, mb) {\n    // Need extra info to make a tree\n    var t = [];\n    for (var i = 0; i < d.length; ++i) {\n        if (d[i])\n            t.push({ s: i, f: d[i] });\n    }\n    var s = t.length;\n    var t2 = t.slice();\n    if (!s)\n        return [et, 0];\n    if (s == 1) {\n        var v = new u8(t[0].s + 1);\n        v[t[0].s] = 1;\n        return [v, 1];\n    }\n    t.sort(function (a, b) { return a.f - b.f; });\n    // after i2 reaches last ind, will be stopped\n    // freq must be greater than largest possible number of symbols\n    t.push({ s: -1, f: 25001 });\n    var l = t[0], r = t[1], i0 = 0, i1 = 1, i2 = 2;\n    t[0] = { s: -1, f: l.f + r.f, l: l, r: r };\n    // efficient algorithm from UZIP.js\n    // i0 is lookbehind, i2 is lookahead - after processing two low-freq\n    // symbols that combined have high freq, will start processing i2 (high-freq,\n    // non-composite) symbols instead\n    // see https://reddit.com/r/photopea/comments/ikekht/uzipjs_questions/\n    while (i1 != s - 1) {\n        l = t[t[i0].f < t[i2].f ? i0++ : i2++];\n        r = t[i0 != i1 && t[i0].f < t[i2].f ? i0++ : i2++];\n        t[i1++] = { s: -1, f: l.f + r.f, l: l, r: r };\n    }\n    var maxSym = t2[0].s;\n    for (var i = 1; i < s; ++i) {\n        if (t2[i].s > maxSym)\n            maxSym = t2[i].s;\n    }\n    // code lengths\n    var tr = new u16(maxSym + 1);\n    // max bits in tree\n    var mbt = ln(t[i1 - 1], tr, 0);\n    if (mbt > mb) {\n        // more algorithms from UZIP.js\n        // TODO: find out how this code works (debt)\n        //  ind    debt\n        var i = 0, dt = 0;\n        //    left            cost\n        var lft = mbt - mb, cst = 1 << lft;\n        t2.sort(function (a, b) { return tr[b.s] - tr[a.s] || a.f - b.f; });\n        for (; i < s; ++i) {\n            var i2_1 = t2[i].s;\n            if (tr[i2_1] > mb) {\n                dt += cst - (1 << (mbt - tr[i2_1]));\n                tr[i2_1] = mb;\n            }\n            else\n                break;\n        }\n        dt >>>= lft;\n        while (dt > 0) {\n            var i2_2 = t2[i].s;\n            if (tr[i2_2] < mb)\n                dt -= 1 << (mb - tr[i2_2]++ - 1);\n            else\n                ++i;\n        }\n        for (; i >= 0 && dt; --i) {\n            var i2_3 = t2[i].s;\n            if (tr[i2_3] == mb) {\n                --tr[i2_3];\n                ++dt;\n            }\n        }\n        mbt = mb;\n    }\n    return [new u8(tr), mbt];\n};\n// get the max length and assign length codes\nvar ln = function (n, l, d) {\n    return n.s == -1\n        ? Math.max(ln(n.l, l, d + 1), ln(n.r, l, d + 1))\n        : (l[n.s] = d);\n};\n// length codes generation\nvar lc = function (c) {\n    var s = c.length;\n    // Note that the semicolon was intentional\n    while (s && !c[--s])\n        ;\n    var cl = new u16(++s);\n    //  ind      num         streak\n    var cli = 0, cln = c[0], cls = 1;\n    var w = function (v) { cl[cli++] = v; };\n    for (var i = 1; i <= s; ++i) {\n        if (c[i] == cln && i != s)\n            ++cls;\n        else {\n            if (!cln && cls > 2) {\n                for (; cls > 138; cls -= 138)\n                    w(32754);\n                if (cls > 2) {\n                    w(cls > 10 ? ((cls - 11) << 5) | 28690 : ((cls - 3) << 5) | 12305);\n                    cls = 0;\n                }\n            }\n            else if (cls > 3) {\n                w(cln), --cls;\n                for (; cls > 6; cls -= 6)\n                    w(8304);\n                if (cls > 2)\n                    w(((cls - 3) << 5) | 8208), cls = 0;\n            }\n            while (cls--)\n                w(cln);\n            cls = 1;\n            cln = c[i];\n        }\n    }\n    return [cl.subarray(0, cli), s];\n};\n// calculate the length of output from tree, code lengths\nvar clen = function (cf, cl) {\n    var l = 0;\n    for (var i = 0; i < cl.length; ++i)\n        l += cf[i] * cl[i];\n    return l;\n};\n// writes a fixed block\n// returns the new bit pos\nvar wfblk = function (out, pos, dat) {\n    // no need to write 00 as type: TypedArray defaults to 0\n    var s = dat.length;\n    var o = shft(pos + 2);\n    out[o] = s & 255;\n    out[o + 1] = s >>> 8;\n    out[o + 2] = out[o] ^ 255;\n    out[o + 3] = out[o + 1] ^ 255;\n    for (var i = 0; i < s; ++i)\n        out[o + i + 4] = dat[i];\n    return (o + 4 + s) * 8;\n};\n// writes a block\nvar wblk = function (dat, out, final, syms, lf, df, eb, li, bs, bl, p) {\n    wbits(out, p++, final);\n    ++lf[256];\n    var _a = hTree(lf, 15), dlt = _a[0], mlb = _a[1];\n    var _b = hTree(df, 15), ddt = _b[0], mdb = _b[1];\n    var _c = lc(dlt), lclt = _c[0], nlc = _c[1];\n    var _d = lc(ddt), lcdt = _d[0], ndc = _d[1];\n    var lcfreq = new u16(19);\n    for (var i = 0; i < lclt.length; ++i)\n        lcfreq[lclt[i] & 31]++;\n    for (var i = 0; i < lcdt.length; ++i)\n        lcfreq[lcdt[i] & 31]++;\n    var _e = hTree(lcfreq, 7), lct = _e[0], mlcb = _e[1];\n    var nlcc = 19;\n    for (; nlcc > 4 && !lct[clim[nlcc - 1]]; --nlcc)\n        ;\n    var flen = (bl + 5) << 3;\n    var ftlen = clen(lf, flt) + clen(df, fdt) + eb;\n    var dtlen = clen(lf, dlt) + clen(df, ddt) + eb + 14 + 3 * nlcc + clen(lcfreq, lct) + (2 * lcfreq[16] + 3 * lcfreq[17] + 7 * lcfreq[18]);\n    if (flen <= ftlen && flen <= dtlen)\n        return wfblk(out, p, dat.subarray(bs, bs + bl));\n    var lm, ll, dm, dl;\n    wbits(out, p, 1 + (dtlen < ftlen)), p += 2;\n    if (dtlen < ftlen) {\n        lm = hMap(dlt, mlb, 0), ll = dlt, dm = hMap(ddt, mdb, 0), dl = ddt;\n        var llm = hMap(lct, mlcb, 0);\n        wbits(out, p, nlc - 257);\n        wbits(out, p + 5, ndc - 1);\n        wbits(out, p + 10, nlcc - 4);\n        p += 14;\n        for (var i = 0; i < nlcc; ++i)\n            wbits(out, p + 3 * i, lct[clim[i]]);\n        p += 3 * nlcc;\n        var lcts = [lclt, lcdt];\n        for (var it = 0; it < 2; ++it) {\n            var clct = lcts[it];\n            for (var i = 0; i < clct.length; ++i) {\n                var len = clct[i] & 31;\n                wbits(out, p, llm[len]), p += lct[len];\n                if (len > 15)\n                    wbits(out, p, (clct[i] >>> 5) & 127), p += clct[i] >>> 12;\n            }\n        }\n    }\n    else {\n        lm = flm, ll = flt, dm = fdm, dl = fdt;\n    }\n    for (var i = 0; i < li; ++i) {\n        if (syms[i] > 255) {\n            var len = (syms[i] >>> 18) & 31;\n            wbits16(out, p, lm[len + 257]), p += ll[len + 257];\n            if (len > 7)\n                wbits(out, p, (syms[i] >>> 23) & 31), p += fleb[len];\n            var dst = syms[i] & 31;\n            wbits16(out, p, dm[dst]), p += dl[dst];\n            if (dst > 3)\n                wbits16(out, p, (syms[i] >>> 5) & 8191), p += fdeb[dst];\n        }\n        else {\n            wbits16(out, p, lm[syms[i]]), p += ll[syms[i]];\n        }\n    }\n    wbits16(out, p, lm[256]);\n    return p + ll[256];\n};\n// deflate options (nice << 13) | chain\nvar deo = /*#__PURE__*/ new u32([65540, 131080, 131088, 131104, 262176, 1048704, 1048832, 2114560, 2117632]);\n// empty\nvar et = /*#__PURE__*/ new u8(0);\n// compresses data into a raw DEFLATE buffer\nvar dflt = function (dat, lvl, plvl, pre, post, lst) {\n    var s = dat.length;\n    var o = new u8(pre + s + 5 * (1 + Math.ceil(s / 7000)) + post);\n    // writing to this writes to the output buffer\n    var w = o.subarray(pre, o.length - post);\n    var pos = 0;\n    if (!lvl || s < 8) {\n        for (var i = 0; i <= s; i += 65535) {\n            // end\n            var e = i + 65535;\n            if (e >= s) {\n                // write final block\n                w[pos >> 3] = lst;\n            }\n            pos = wfblk(w, pos + 1, dat.subarray(i, e));\n        }\n    }\n    else {\n        var opt = deo[lvl - 1];\n        var n = opt >>> 13, c = opt & 8191;\n        var msk_1 = (1 << plvl) - 1;\n        //    prev 2-byte val map    curr 2-byte val map\n        var prev = new u16(32768), head = new u16(msk_1 + 1);\n        var bs1_1 = Math.ceil(plvl / 3), bs2_1 = 2 * bs1_1;\n        var hsh = function (i) { return (dat[i] ^ (dat[i + 1] << bs1_1) ^ (dat[i + 2] << bs2_1)) & msk_1; };\n        // 24576 is an arbitrary number of maximum symbols per block\n        // 424 buffer for last block\n        var syms = new u32(25000);\n        // length/literal freq   distance freq\n        var lf = new u16(288), df = new u16(32);\n        //  l/lcnt  exbits  index  l/lind  waitdx  bitpos\n        var lc_1 = 0, eb = 0, i = 0, li = 0, wi = 0, bs = 0;\n        for (; i < s; ++i) {\n            // hash value\n            // deopt when i > s - 3 - at end, deopt acceptable\n            var hv = hsh(i);\n            // index mod 32768    previous index mod\n            var imod = i & 32767, pimod = head[hv];\n            prev[imod] = pimod;\n            head[hv] = imod;\n            // We always should modify head and prev, but only add symbols if\n            // this data is not yet processed (\"wait\" for wait index)\n            if (wi <= i) {\n                // bytes remaining\n                var rem = s - i;\n                if ((lc_1 > 7000 || li > 24576) && rem > 423) {\n                    pos = wblk(dat, w, 0, syms, lf, df, eb, li, bs, i - bs, pos);\n                    li = lc_1 = eb = 0, bs = i;\n                    for (var j = 0; j < 286; ++j)\n                        lf[j] = 0;\n                    for (var j = 0; j < 30; ++j)\n                        df[j] = 0;\n                }\n                //  len    dist   chain\n                var l = 2, d = 0, ch_1 = c, dif = (imod - pimod) & 32767;\n                if (rem > 2 && hv == hsh(i - dif)) {\n                    var maxn = Math.min(n, rem) - 1;\n                    var maxd = Math.min(32767, i);\n                    // max possible length\n                    // not capped at dif because decompressors implement \"rolling\" index population\n                    var ml = Math.min(258, rem);\n                    while (dif <= maxd && --ch_1 && imod != pimod) {\n                        if (dat[i + l] == dat[i + l - dif]) {\n                            var nl = 0;\n                            for (; nl < ml && dat[i + nl] == dat[i + nl - dif]; ++nl)\n                                ;\n                            if (nl > l) {\n                                l = nl, d = dif;\n                                // break out early when we reach \"nice\" (we are satisfied enough)\n                                if (nl > maxn)\n                                    break;\n                                // now, find the rarest 2-byte sequence within this\n                                // length of literals and search for that instead.\n                                // Much faster than just using the start\n                                var mmd = Math.min(dif, nl - 2);\n                                var md = 0;\n                                for (var j = 0; j < mmd; ++j) {\n                                    var ti = (i - dif + j + 32768) & 32767;\n                                    var pti = prev[ti];\n                                    var cd = (ti - pti + 32768) & 32767;\n                                    if (cd > md)\n                                        md = cd, pimod = ti;\n                                }\n                            }\n                        }\n                        // check the previous match\n                        imod = pimod, pimod = prev[imod];\n                        dif += (imod - pimod + 32768) & 32767;\n                    }\n                }\n                // d will be nonzero only when a match was found\n                if (d) {\n                    // store both dist and len data in one Uint32\n                    // Make sure this is recognized as a len/dist with 28th bit (2^28)\n                    syms[li++] = 268435456 | (revfl[l] << 18) | revfd[d];\n                    var lin = revfl[l] & 31, din = revfd[d] & 31;\n                    eb += fleb[lin] + fdeb[din];\n                    ++lf[257 + lin];\n                    ++df[din];\n                    wi = i + l;\n                    ++lc_1;\n                }\n                else {\n                    syms[li++] = dat[i];\n                    ++lf[dat[i]];\n                }\n            }\n        }\n        pos = wblk(dat, w, lst, syms, lf, df, eb, li, bs, i - bs, pos);\n        // this is the easiest way to avoid needing to maintain state\n        if (!lst && pos & 7)\n            pos = wfblk(w, pos + 1, et);\n    }\n    return slc(o, 0, pre + shft(pos) + post);\n};\n// CRC32 table\nvar crct = /*#__PURE__*/ (function () {\n    var t = new Int32Array(256);\n    for (var i = 0; i < 256; ++i) {\n        var c = i, k = 9;\n        while (--k)\n            c = ((c & 1) && -306674912) ^ (c >>> 1);\n        t[i] = c;\n    }\n    return t;\n})();\n// CRC32\nvar crc = function () {\n    var c = -1;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var cr = c;\n            for (var i = 0; i < d.length; ++i)\n                cr = crct[(cr & 255) ^ d[i]] ^ (cr >>> 8);\n            c = cr;\n        },\n        d: function () { return ~c; }\n    };\n};\n// Alder32\nvar adler = function () {\n    var a = 1, b = 0;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var n = a, m = b;\n            var l = d.length | 0;\n            for (var i = 0; i != l;) {\n                var e = Math.min(i + 2655, l);\n                for (; i < e; ++i)\n                    m += n += d[i];\n                n = (n & 65535) + 15 * (n >> 16), m = (m & 65535) + 15 * (m >> 16);\n            }\n            a = n, b = m;\n        },\n        d: function () {\n            a %= 65521, b %= 65521;\n            return (a & 255) << 24 | (a >>> 8) << 16 | (b & 255) << 8 | (b >>> 8);\n        }\n    };\n};\n;\n// deflate with opts\nvar dopt = function (dat, opt, pre, post, st) {\n    return dflt(dat, opt.level == null ? 6 : opt.level, opt.mem == null ? Math.ceil(Math.max(8, Math.min(13, Math.log(dat.length))) * 1.5) : (12 + opt.mem), pre, post, !st);\n};\n// Walmart object spread\nvar mrg = function (a, b) {\n    var o = {};\n    for (var k in a)\n        o[k] = a[k];\n    for (var k in b)\n        o[k] = b[k];\n    return o;\n};\n// worker clone\n// This is possibly the craziest part of the entire codebase, despite how simple it may seem.\n// The only parameter to this function is a closure that returns an array of variables outside of the function scope.\n// We're going to try to figure out the variable names used in the closure as strings because that is crucial for workerization.\n// We will return an object mapping of true variable name to value (basically, the current scope as a JS object).\n// The reason we can't just use the original variable names is minifiers mangling the toplevel scope.\n// This took me three weeks to figure out how to do.\nvar wcln = function (fn, fnStr, td) {\n    var dt = fn();\n    var st = fn.toString();\n    var ks = st.slice(st.indexOf('[') + 1, st.lastIndexOf(']')).replace(/\\s+/g, '').split(',');\n    for (var i = 0; i < dt.length; ++i) {\n        var v = dt[i], k = ks[i];\n        if (typeof v == 'function') {\n            fnStr += ';' + k + '=';\n            var st_1 = v.toString();\n            if (v.prototype) {\n                // for global objects\n                if (st_1.indexOf('[native code]') != -1) {\n                    var spInd = st_1.indexOf(' ', 8) + 1;\n                    fnStr += st_1.slice(spInd, st_1.indexOf('(', spInd));\n                }\n                else {\n                    fnStr += st_1;\n                    for (var t in v.prototype)\n                        fnStr += ';' + k + '.prototype.' + t + '=' + v.prototype[t].toString();\n                }\n            }\n            else\n                fnStr += st_1;\n        }\n        else\n            td[k] = v;\n    }\n    return [fnStr, td];\n};\nvar ch = [];\n// clone bufs\nvar cbfs = function (v) {\n    var tl = [];\n    for (var k in v) {\n        if (v[k].buffer) {\n            tl.push((v[k] = new v[k].constructor(v[k])).buffer);\n        }\n    }\n    return tl;\n};\n// use a worker to execute code\nvar wrkr = function (fns, init, id, cb) {\n    var _a;\n    if (!ch[id]) {\n        var fnStr = '', td_1 = {}, m = fns.length - 1;\n        for (var i = 0; i < m; ++i)\n            _a = wcln(fns[i], fnStr, td_1), fnStr = _a[0], td_1 = _a[1];\n        ch[id] = wcln(fns[m], fnStr, td_1);\n    }\n    var td = mrg({}, ch[id][1]);\n    return wk(ch[id][0] + ';onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage=' + init.toString() + '}', id, td, cbfs(td), cb);\n};\n// base async inflate fn\nvar bInflt = function () { return [u8, u16, u32, fleb, fdeb, clim, fl, fd, flrm, fdrm, rev, ec, hMap, max, bits, bits16, shft, slc, err, inflt, inflateSync, pbf, gu8]; };\nvar bDflt = function () { return [u8, u16, u32, fleb, fdeb, clim, revfl, revfd, flm, flt, fdm, fdt, rev, deo, et, hMap, wbits, wbits16, hTree, ln, lc, clen, wfblk, wblk, shft, slc, dflt, dopt, deflateSync, pbf]; };\n// gzip extra\nvar gze = function () { return [gzh, gzhl, wbytes, crc, crct]; };\n// gunzip extra\nvar guze = function () { return [gzs, gzl]; };\n// zlib extra\nvar zle = function () { return [zlh, wbytes, adler]; };\n// unzlib extra\nvar zule = function () { return [zlv]; };\n// post buf\nvar pbf = function (msg) { return postMessage(msg, [msg.buffer]); };\n// get u8\nvar gu8 = function (o) { return o && o.size && new u8(o.size); };\n// async helper\nvar cbify = function (dat, opts, fns, init, id, cb) {\n    var w = wrkr(fns, init, id, function (err, dat) {\n        w.terminate();\n        cb(err, dat);\n    });\n    w.postMessage([dat, opts], opts.consume ? [dat.buffer] : []);\n    return function () { w.terminate(); };\n};\n// auto stream\nvar astrm = function (strm) {\n    strm.ondata = function (dat, final) { return postMessage([dat, final], [dat.buffer]); };\n    return function (ev) { return strm.push(ev.data[0], ev.data[1]); };\n};\n// async stream attach\nvar astrmify = function (fns, strm, opts, init, id) {\n    var t;\n    var w = wrkr(fns, init, id, function (err, dat) {\n        if (err)\n            w.terminate(), strm.ondata.call(strm, err);\n        else {\n            if (dat[1])\n                w.terminate();\n            strm.ondata.call(strm, err, dat[0], dat[1]);\n        }\n    });\n    w.postMessage(opts);\n    strm.push = function (d, f) {\n        if (!strm.ondata)\n            err(5);\n        if (t)\n            strm.ondata(err(4, 0, 1), null, !!f);\n        w.postMessage([d, t = f], [d.buffer]);\n    };\n    strm.terminate = function () { w.terminate(); };\n};\n// read 2 bytes\nvar b2 = function (d, b) { return d[b] | (d[b + 1] << 8); };\n// read 4 bytes\nvar b4 = function (d, b) { return (d[b] | (d[b + 1] << 8) | (d[b + 2] << 16) | (d[b + 3] << 24)) >>> 0; };\nvar b8 = function (d, b) { return b4(d, b) + (b4(d, b + 4) * 4294967296); };\n// write bytes\nvar wbytes = function (d, b, v) {\n    for (; v; ++b)\n        d[b] = v, v >>>= 8;\n};\n// gzip header\nvar gzh = function (c, o) {\n    var fn = o.filename;\n    c[0] = 31, c[1] = 139, c[2] = 8, c[8] = o.level < 2 ? 4 : o.level == 9 ? 2 : 0, c[9] = 3; // assume Unix\n    if (o.mtime != 0)\n        wbytes(c, 4, Math.floor(new Date(o.mtime || Date.now()) / 1000));\n    if (fn) {\n        c[3] = 8;\n        for (var i = 0; i <= fn.length; ++i)\n            c[i + 10] = fn.charCodeAt(i);\n    }\n};\n// gzip footer: -8 to -4 = CRC, -4 to -0 is length\n// gzip start\nvar gzs = function (d) {\n    if (d[0] != 31 || d[1] != 139 || d[2] != 8)\n        err(6, 'invalid gzip data');\n    var flg = d[3];\n    var st = 10;\n    if (flg & 4)\n        st += d[10] | (d[11] << 8) + 2;\n    for (var zs = (flg >> 3 & 1) + (flg >> 4 & 1); zs > 0; zs -= !d[st++])\n        ;\n    return st + (flg & 2);\n};\n// gzip length\nvar gzl = function (d) {\n    var l = d.length;\n    return ((d[l - 4] | d[l - 3] << 8 | d[l - 2] << 16) | (d[l - 1] << 24)) >>> 0;\n};\n// gzip header length\nvar gzhl = function (o) { return 10 + ((o.filename && (o.filename.length + 1)) || 0); };\n// zlib header\nvar zlh = function (c, o) {\n    var lv = o.level, fl = lv == 0 ? 0 : lv < 6 ? 1 : lv == 9 ? 3 : 2;\n    c[0] = 120, c[1] = (fl << 6) | (fl ? (32 - 2 * fl) : 1);\n};\n// zlib valid\nvar zlv = function (d) {\n    if ((d[0] & 15) != 8 || (d[0] >>> 4) > 7 || ((d[0] << 8 | d[1]) % 31))\n        err(6, 'invalid zlib data');\n    if (d[1] & 32)\n        err(6, 'invalid zlib data: preset dictionaries not supported');\n};\nfunction AsyncCmpStrm(opts, cb) {\n    if (!cb && typeof opts == 'function')\n        cb = opts, opts = {};\n    this.ondata = cb;\n    return opts;\n}\n// zlib footer: -4 to -0 is Adler32\n/**\n * Streaming DEFLATE compression\n */\nvar Deflate = /*#__PURE__*/ (function () {\n    function Deflate(opts, cb) {\n        if (!cb && typeof opts == 'function')\n            cb = opts, opts = {};\n        this.ondata = cb;\n        this.o = opts || {};\n    }\n    Deflate.prototype.p = function (c, f) {\n        this.ondata(dopt(c, this.o, 0, 0, !f), f);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Deflate.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (this.d)\n            err(4);\n        this.d = final;\n        this.p(chunk, final || false);\n    };\n    return Deflate;\n}());\nexport { Deflate };\n/**\n * Asynchronous streaming DEFLATE compression\n */\nvar AsyncDeflate = /*#__PURE__*/ (function () {\n    function AsyncDeflate(opts, cb) {\n        astrmify([\n            bDflt,\n            function () { return [astrm, Deflate]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Deflate(ev.data);\n            onmessage = astrm(strm);\n        }, 6);\n    }\n    return AsyncDeflate;\n}());\nexport { AsyncDeflate };\nexport function deflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n    ], function (ev) { return pbf(deflateSync(ev.data[0], ev.data[1])); }, 0, cb);\n}\n/**\n * Compresses data with DEFLATE without any wrapper\n * @param data The data to compress\n * @param opts The compression options\n * @returns The deflated version of the data\n */\nexport function deflateSync(data, opts) {\n    return dopt(data, opts || {}, 0, 0);\n}\n/**\n * Streaming DEFLATE decompression\n */\nvar Inflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an inflation stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Inflate(cb) {\n        this.s = {};\n        this.p = new u8(0);\n        this.ondata = cb;\n    }\n    Inflate.prototype.e = function (c) {\n        if (!this.ondata)\n            err(5);\n        if (this.d)\n            err(4);\n        var l = this.p.length;\n        var n = new u8(l + c.length);\n        n.set(this.p), n.set(c, l), this.p = n;\n    };\n    Inflate.prototype.c = function (final) {\n        this.d = this.s.i = final || false;\n        var bts = this.s.b;\n        var dt = inflt(this.p, this.o, this.s);\n        this.ondata(slc(dt, bts, this.s.b), this.d);\n        this.o = slc(dt, this.s.b - 32768), this.s.b = this.o.length;\n        this.p = slc(this.p, (this.s.p / 8) | 0), this.s.p &= 7;\n    };\n    /**\n     * Pushes a chunk to be inflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the final chunk\n     */\n    Inflate.prototype.push = function (chunk, final) {\n        this.e(chunk), this.c(final);\n    };\n    return Inflate;\n}());\nexport { Inflate };\n/**\n * Asynchronous streaming DEFLATE decompression\n */\nvar AsyncInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous inflation stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncInflate(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            function () { return [astrm, Inflate]; }\n        ], this, 0, function () {\n            var strm = new Inflate();\n            onmessage = astrm(strm);\n        }, 7);\n    }\n    return AsyncInflate;\n}());\nexport { AsyncInflate };\nexport function inflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt\n    ], function (ev) { return pbf(inflateSync(ev.data[0], gu8(ev.data[1]))); }, 1, cb);\n}\n/**\n * Expands DEFLATE data with no wrapper\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function inflateSync(data, out) {\n    return inflt(data, out);\n}\n// before you yell at me for not just using extends, my reason is that TS inheritance is hard to workerize.\n/**\n * Streaming GZIP compression\n */\nvar Gzip = /*#__PURE__*/ (function () {\n    function Gzip(opts, cb) {\n        this.c = crc();\n        this.l = 0;\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be GZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gzip.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Gzip.prototype.p = function (c, f) {\n        this.c.p(c);\n        this.l += c.length;\n        var raw = dopt(c, this.o, this.v && gzhl(this.o), f && 8, !f);\n        if (this.v)\n            gzh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 8, this.c.d()), wbytes(raw, raw.length - 4, this.l);\n        this.ondata(raw, f);\n    };\n    return Gzip;\n}());\nexport { Gzip };\n/**\n * Asynchronous streaming GZIP compression\n */\nvar AsyncGzip = /*#__PURE__*/ (function () {\n    function AsyncGzip(opts, cb) {\n        astrmify([\n            bDflt,\n            gze,\n            function () { return [astrm, Deflate, Gzip]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Gzip(ev.data);\n            onmessage = astrm(strm);\n        }, 8);\n    }\n    return AsyncGzip;\n}());\nexport { AsyncGzip };\nexport function gzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n        gze,\n        function () { return [gzipSync]; }\n    ], function (ev) { return pbf(gzipSync(ev.data[0], ev.data[1])); }, 2, cb);\n}\n/**\n * Compresses data with GZIP\n * @param data The data to compress\n * @param opts The compression options\n * @returns The gzipped version of the data\n */\nexport function gzipSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var c = crc(), l = data.length;\n    c.p(data);\n    var d = dopt(data, opts, gzhl(opts), 8), s = d.length;\n    return gzh(d, opts), wbytes(d, s - 8, c.d()), wbytes(d, s - 4, l), d;\n}\n/**\n * Streaming GZIP decompression\n */\nvar Gunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a GUNZIP stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Gunzip(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be GUNZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gunzip.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            var s = this.p.length > 3 ? gzs(this.p) : 4;\n            if (s >= this.p.length && !final)\n                return;\n            this.p = this.p.subarray(s), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 8)\n                err(6, 'invalid gzip data');\n            this.p = this.p.subarray(0, -8);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Gunzip;\n}());\nexport { Gunzip };\n/**\n * Asynchronous streaming GZIP decompression\n */\nvar AsyncGunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous GUNZIP stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncGunzip(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            guze,\n            function () { return [astrm, Inflate, Gunzip]; }\n        ], this, 0, function () {\n            var strm = new Gunzip();\n            onmessage = astrm(strm);\n        }, 9);\n    }\n    return AsyncGunzip;\n}());\nexport { AsyncGunzip };\nexport function gunzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt,\n        guze,\n        function () { return [gunzipSync]; }\n    ], function (ev) { return pbf(gunzipSync(ev.data[0])); }, 3, cb);\n}\n/**\n * Expands GZIP data\n * @param data The data to decompress\n * @param out Where to write the data. GZIP already encodes the output size, so providing this doesn't save memory.\n * @returns The decompressed version of the data\n */\nexport function gunzipSync(data, out) {\n    return inflt(data.subarray(gzs(data), -8), out || new u8(gzl(data)));\n}\n/**\n * Streaming Zlib compression\n */\nvar Zlib = /*#__PURE__*/ (function () {\n    function Zlib(opts, cb) {\n        this.c = adler();\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be zlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Zlib.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Zlib.prototype.p = function (c, f) {\n        this.c.p(c);\n        var raw = dopt(c, this.o, this.v && 2, f && 4, !f);\n        if (this.v)\n            zlh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 4, this.c.d());\n        this.ondata(raw, f);\n    };\n    return Zlib;\n}());\nexport { Zlib };\n/**\n * Asynchronous streaming Zlib compression\n */\nvar AsyncZlib = /*#__PURE__*/ (function () {\n    function AsyncZlib(opts, cb) {\n        astrmify([\n            bDflt,\n            zle,\n            function () { return [astrm, Deflate, Zlib]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Zlib(ev.data);\n            onmessage = astrm(strm);\n        }, 10);\n    }\n    return AsyncZlib;\n}());\nexport { AsyncZlib };\nexport function zlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n        zle,\n        function () { return [zlibSync]; }\n    ], function (ev) { return pbf(zlibSync(ev.data[0], ev.data[1])); }, 4, cb);\n}\n/**\n * Compress data with Zlib\n * @param data The data to compress\n * @param opts The compression options\n * @returns The zlib-compressed version of the data\n */\nexport function zlibSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var a = adler();\n    a.p(data);\n    var d = dopt(data, opts, 2, 4);\n    return zlh(d, opts), wbytes(d, d.length - 4, a.d()), d;\n}\n/**\n * Streaming Zlib decompression\n */\nvar Unzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates a Zlib decompression stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Unzlib(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be unzlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzlib.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            if (this.p.length < 2 && !final)\n                return;\n            this.p = this.p.subarray(2), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 4)\n                err(6, 'invalid zlib data');\n            this.p = this.p.subarray(0, -4);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Unzlib;\n}());\nexport { Unzlib };\n/**\n * Asynchronous streaming Zlib decompression\n */\nvar AsyncUnzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous Zlib decompression stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncUnzlib(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            zule,\n            function () { return [astrm, Inflate, Unzlib]; }\n        ], this, 0, function () {\n            var strm = new Unzlib();\n            onmessage = astrm(strm);\n        }, 11);\n    }\n    return AsyncUnzlib;\n}());\nexport { AsyncUnzlib };\nexport function unzlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt,\n        zule,\n        function () { return [unzlibSync]; }\n    ], function (ev) { return pbf(unzlibSync(ev.data[0], gu8(ev.data[1]))); }, 5, cb);\n}\n/**\n * Expands Zlib data\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function unzlibSync(data, out) {\n    return inflt((zlv(data), data.subarray(2, -4)), out);\n}\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzip as compress, AsyncGzip as AsyncCompress };\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzipSync as compressSync, Gzip as Compress };\n/**\n * Streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar Decompress = /*#__PURE__*/ (function () {\n    /**\n     * Creates a decompression stream\n     * @param cb The callback to call whenever data is decompressed\n     */\n    function Decompress(cb) {\n        this.G = Gunzip;\n        this.I = Inflate;\n        this.Z = Unzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Decompress.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (!this.s) {\n            if (this.p && this.p.length) {\n                var n = new u8(this.p.length + chunk.length);\n                n.set(this.p), n.set(chunk, this.p.length);\n            }\n            else\n                this.p = chunk;\n            if (this.p.length > 2) {\n                var _this_1 = this;\n                var cb = function () { _this_1.ondata.apply(_this_1, arguments); };\n                this.s = (this.p[0] == 31 && this.p[1] == 139 && this.p[2] == 8)\n                    ? new this.G(cb)\n                    : ((this.p[0] & 15) != 8 || (this.p[0] >> 4) > 7 || ((this.p[0] << 8 | this.p[1]) % 31))\n                        ? new this.I(cb)\n                        : new this.Z(cb);\n                this.s.push(this.p, final);\n                this.p = null;\n            }\n        }\n        else\n            this.s.push(chunk, final);\n    };\n    return Decompress;\n}());\nexport { Decompress };\n/**\n * Asynchronous streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar AsyncDecompress = /*#__PURE__*/ (function () {\n    /**\n   * Creates an asynchronous decompression stream\n   * @param cb The callback to call whenever data is decompressed\n   */\n    function AsyncDecompress(cb) {\n        this.G = AsyncGunzip;\n        this.I = AsyncInflate;\n        this.Z = AsyncUnzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncDecompress.prototype.push = function (chunk, final) {\n        Decompress.prototype.push.call(this, chunk, final);\n    };\n    return AsyncDecompress;\n}());\nexport { AsyncDecompress };\nexport function decompress(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzip(data, opts, cb)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflate(data, opts, cb)\n            : unzlib(data, opts, cb);\n}\n/**\n * Expands compressed GZIP, Zlib, or raw DEFLATE data, automatically detecting the format\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function decompressSync(data, out) {\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzipSync(data, out)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflateSync(data, out)\n            : unzlibSync(data, out);\n}\n// flatten a directory structure\nvar fltn = function (d, p, t, o) {\n    for (var k in d) {\n        var val = d[k], n = p + k, op = o;\n        if (Array.isArray(val))\n            op = mrg(o, val[1]), val = val[0];\n        if (val instanceof u8)\n            t[n] = [val, op];\n        else {\n            t[n += '/'] = [new u8(0), op];\n            fltn(val, n, t, o);\n        }\n    }\n};\n// text encoder\nvar te = typeof TextEncoder != 'undefined' && /*#__PURE__*/ new TextEncoder();\n// text decoder\nvar td = typeof TextDecoder != 'undefined' && /*#__PURE__*/ new TextDecoder();\n// text decoder stream\nvar tds = 0;\ntry {\n    td.decode(et, { stream: true });\n    tds = 1;\n}\ncatch (e) { }\n// decode UTF8\nvar dutf8 = function (d) {\n    for (var r = '', i = 0;;) {\n        var c = d[i++];\n        var eb = (c > 127) + (c > 223) + (c > 239);\n        if (i + eb > d.length)\n            return [r, slc(d, i - 1)];\n        if (!eb)\n            r += String.fromCharCode(c);\n        else if (eb == 3) {\n            c = ((c & 15) << 18 | (d[i++] & 63) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63)) - 65536,\n                r += String.fromCharCode(55296 | (c >> 10), 56320 | (c & 1023));\n        }\n        else if (eb & 1)\n            r += String.fromCharCode((c & 31) << 6 | (d[i++] & 63));\n        else\n            r += String.fromCharCode((c & 15) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63));\n    }\n};\n/**\n * Streaming UTF-8 decoding\n */\nvar DecodeUTF8 = /*#__PURE__*/ (function () {\n    /**\n     * Creates a UTF-8 decoding stream\n     * @param cb The callback to call whenever data is decoded\n     */\n    function DecodeUTF8(cb) {\n        this.ondata = cb;\n        if (tds)\n            this.t = new TextDecoder();\n        else\n            this.p = et;\n    }\n    /**\n     * Pushes a chunk to be decoded from UTF-8 binary\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    DecodeUTF8.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        final = !!final;\n        if (this.t) {\n            this.ondata(this.t.decode(chunk, { stream: true }), final);\n            if (final) {\n                if (this.t.decode().length)\n                    err(8);\n                this.t = null;\n            }\n            return;\n        }\n        if (!this.p)\n            err(4);\n        var dat = new u8(this.p.length + chunk.length);\n        dat.set(this.p);\n        dat.set(chunk, this.p.length);\n        var _a = dutf8(dat), ch = _a[0], np = _a[1];\n        if (final) {\n            if (np.length)\n                err(8);\n            this.p = null;\n        }\n        else\n            this.p = np;\n        this.ondata(ch, final);\n    };\n    return DecodeUTF8;\n}());\nexport { DecodeUTF8 };\n/**\n * Streaming UTF-8 encoding\n */\nvar EncodeUTF8 = /*#__PURE__*/ (function () {\n    /**\n     * Creates a UTF-8 decoding stream\n     * @param cb The callback to call whenever data is encoded\n     */\n    function EncodeUTF8(cb) {\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be encoded to UTF-8\n     * @param chunk The string data to push\n     * @param final Whether this is the last chunk\n     */\n    EncodeUTF8.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (this.d)\n            err(4);\n        this.ondata(strToU8(chunk), this.d = final || false);\n    };\n    return EncodeUTF8;\n}());\nexport { EncodeUTF8 };\n/**\n * Converts a string into a Uint8Array for use with compression/decompression methods\n * @param str The string to encode\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless decoding a binary string.\n * @returns The string encoded in UTF-8/Latin-1 binary\n */\nexport function strToU8(str, latin1) {\n    if (latin1) {\n        var ar_1 = new u8(str.length);\n        for (var i = 0; i < str.length; ++i)\n            ar_1[i] = str.charCodeAt(i);\n        return ar_1;\n    }\n    if (te)\n        return te.encode(str);\n    var l = str.length;\n    var ar = new u8(str.length + (str.length >> 1));\n    var ai = 0;\n    var w = function (v) { ar[ai++] = v; };\n    for (var i = 0; i < l; ++i) {\n        if (ai + 5 > ar.length) {\n            var n = new u8(ai + 8 + ((l - i) << 1));\n            n.set(ar);\n            ar = n;\n        }\n        var c = str.charCodeAt(i);\n        if (c < 128 || latin1)\n            w(c);\n        else if (c < 2048)\n            w(192 | (c >> 6)), w(128 | (c & 63));\n        else if (c > 55295 && c < 57344)\n            c = 65536 + (c & 1023 << 10) | (str.charCodeAt(++i) & 1023),\n                w(240 | (c >> 18)), w(128 | ((c >> 12) & 63)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\n        else\n            w(224 | (c >> 12)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\n    }\n    return slc(ar, 0, ai);\n}\n/**\n * Converts a Uint8Array to a string\n * @param dat The data to decode to string\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless encoding to binary string.\n * @returns The original UTF-8/Latin-1 string\n */\nexport function strFromU8(dat, latin1) {\n    if (latin1) {\n        var r = '';\n        for (var i = 0; i < dat.length; i += 16384)\n            r += String.fromCharCode.apply(null, dat.subarray(i, i + 16384));\n        return r;\n    }\n    else if (td)\n        return td.decode(dat);\n    else {\n        var _a = dutf8(dat), out = _a[0], ext = _a[1];\n        if (ext.length)\n            err(8);\n        return out;\n    }\n}\n;\n// deflate bit flag\nvar dbf = function (l) { return l == 1 ? 3 : l < 6 ? 2 : l == 9 ? 1 : 0; };\n// skip local zip header\nvar slzh = function (d, b) { return b + 30 + b2(d, b + 26) + b2(d, b + 28); };\n// read zip header\nvar zh = function (d, b, z) {\n    var fnl = b2(d, b + 28), fn = strFromU8(d.subarray(b + 46, b + 46 + fnl), !(b2(d, b + 8) & 2048)), es = b + 46 + fnl, bs = b4(d, b + 20);\n    var _a = z && bs == 4294967295 ? z64e(d, es) : [bs, b4(d, b + 24), b4(d, b + 42)], sc = _a[0], su = _a[1], off = _a[2];\n    return [b2(d, b + 10), sc, su, fn, es + b2(d, b + 30) + b2(d, b + 32), off];\n};\n// read zip64 extra field\nvar z64e = function (d, b) {\n    for (; b2(d, b) != 1; b += 4 + b2(d, b + 2))\n        ;\n    return [b8(d, b + 12), b8(d, b + 4), b8(d, b + 20)];\n};\n// extra field length\nvar exfl = function (ex) {\n    var le = 0;\n    if (ex) {\n        for (var k in ex) {\n            var l = ex[k].length;\n            if (l > 65535)\n                err(9);\n            le += l + 4;\n        }\n    }\n    return le;\n};\n// write zip header\nvar wzh = function (d, b, f, fn, u, c, ce, co) {\n    var fl = fn.length, ex = f.extra, col = co && co.length;\n    var exl = exfl(ex);\n    wbytes(d, b, ce != null ? 0x2014B50 : 0x4034B50), b += 4;\n    if (ce != null)\n        d[b++] = 20, d[b++] = f.os;\n    d[b] = 20, b += 2; // spec compliance? what's that?\n    d[b++] = (f.flag << 1) | (c < 0 && 8), d[b++] = u && 8;\n    d[b++] = f.compression & 255, d[b++] = f.compression >> 8;\n    var dt = new Date(f.mtime == null ? Date.now() : f.mtime), y = dt.getFullYear() - 1980;\n    if (y < 0 || y > 119)\n        err(10);\n    wbytes(d, b, (y << 25) | ((dt.getMonth() + 1) << 21) | (dt.getDate() << 16) | (dt.getHours() << 11) | (dt.getMinutes() << 5) | (dt.getSeconds() >>> 1)), b += 4;\n    if (c != -1) {\n        wbytes(d, b, f.crc);\n        wbytes(d, b + 4, c < 0 ? -c - 2 : c);\n        wbytes(d, b + 8, f.size);\n    }\n    wbytes(d, b + 12, fl);\n    wbytes(d, b + 14, exl), b += 16;\n    if (ce != null) {\n        wbytes(d, b, col);\n        wbytes(d, b + 6, f.attrs);\n        wbytes(d, b + 10, ce), b += 14;\n    }\n    d.set(fn, b);\n    b += fl;\n    if (exl) {\n        for (var k in ex) {\n            var exf = ex[k], l = exf.length;\n            wbytes(d, b, +k);\n            wbytes(d, b + 2, l);\n            d.set(exf, b + 4), b += 4 + l;\n        }\n    }\n    if (col)\n        d.set(co, b), b += col;\n    return b;\n};\n// write zip footer (end of central directory)\nvar wzf = function (o, b, c, d, e) {\n    wbytes(o, b, 0x6054B50); // skip disk\n    wbytes(o, b + 8, c);\n    wbytes(o, b + 10, c);\n    wbytes(o, b + 12, d);\n    wbytes(o, b + 16, e);\n};\n/**\n * A pass-through stream to keep data uncompressed in a ZIP archive.\n */\nvar ZipPassThrough = /*#__PURE__*/ (function () {\n    /**\n     * Creates a pass-through stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     */\n    function ZipPassThrough(filename) {\n        this.filename = filename;\n        this.c = crc();\n        this.size = 0;\n        this.compression = 0;\n    }\n    /**\n     * Processes a chunk and pushes to the output stream. You can override this\n     * method in a subclass for custom behavior, but by default this passes\n     * the data through. You must call this.ondata(err, chunk, final) at some\n     * point in this method.\n     * @param chunk The chunk to process\n     * @param final Whether this is the last chunk\n     */\n    ZipPassThrough.prototype.process = function (chunk, final) {\n        this.ondata(null, chunk, final);\n    };\n    /**\n     * Pushes a chunk to be added. If you are subclassing this with a custom\n     * compression algorithm, note that you must push data from the source\n     * file only, pre-compression.\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    ZipPassThrough.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        this.c.p(chunk);\n        this.size += chunk.length;\n        if (final)\n            this.crc = this.c.d();\n        this.process(chunk, final || false);\n    };\n    return ZipPassThrough;\n}());\nexport { ZipPassThrough };\n// I don't extend because TypeScript extension adds 1kB of runtime bloat\n/**\n * Streaming DEFLATE compression for ZIP archives. Prefer using AsyncZipDeflate\n * for better performance\n */\nvar ZipDeflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     * @param opts The compression options\n     */\n    function ZipDeflate(filename, opts) {\n        var _this_1 = this;\n        if (!opts)\n            opts = {};\n        ZipPassThrough.call(this, filename);\n        this.d = new Deflate(opts, function (dat, final) {\n            _this_1.ondata(null, dat, final);\n        });\n        this.compression = 8;\n        this.flag = dbf(opts.level);\n    }\n    ZipDeflate.prototype.process = function (chunk, final) {\n        try {\n            this.d.push(chunk, final);\n        }\n        catch (e) {\n            this.ondata(e, null, final);\n        }\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    ZipDeflate.prototype.push = function (chunk, final) {\n        ZipPassThrough.prototype.push.call(this, chunk, final);\n    };\n    return ZipDeflate;\n}());\nexport { ZipDeflate };\n/**\n * Asynchronous streaming DEFLATE compression for ZIP archives\n */\nvar AsyncZipDeflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     * @param opts The compression options\n     */\n    function AsyncZipDeflate(filename, opts) {\n        var _this_1 = this;\n        if (!opts)\n            opts = {};\n        ZipPassThrough.call(this, filename);\n        this.d = new AsyncDeflate(opts, function (err, dat, final) {\n            _this_1.ondata(err, dat, final);\n        });\n        this.compression = 8;\n        this.flag = dbf(opts.level);\n        this.terminate = this.d.terminate;\n    }\n    AsyncZipDeflate.prototype.process = function (chunk, final) {\n        this.d.push(chunk, final);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncZipDeflate.prototype.push = function (chunk, final) {\n        ZipPassThrough.prototype.push.call(this, chunk, final);\n    };\n    return AsyncZipDeflate;\n}());\nexport { AsyncZipDeflate };\n// TODO: Better tree shaking\n/**\n * A zippable archive to which files can incrementally be added\n */\nvar Zip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an empty ZIP archive to which files can be added\n     * @param cb The callback to call whenever data for the generated ZIP archive\n     *           is available\n     */\n    function Zip(cb) {\n        this.ondata = cb;\n        this.u = [];\n        this.d = 1;\n    }\n    /**\n     * Adds a file to the ZIP archive\n     * @param file The file stream to add\n     */\n    Zip.prototype.add = function (file) {\n        var _this_1 = this;\n        if (!this.ondata)\n            err(5);\n        // finishing or finished\n        if (this.d & 2)\n            this.ondata(err(4 + (this.d & 1) * 8, 0, 1), null, false);\n        else {\n            var f = strToU8(file.filename), fl_1 = f.length;\n            var com = file.comment, o = com && strToU8(com);\n            var u = fl_1 != file.filename.length || (o && (com.length != o.length));\n            var hl_1 = fl_1 + exfl(file.extra) + 30;\n            if (fl_1 > 65535)\n                this.ondata(err(11, 0, 1), null, false);\n            var header = new u8(hl_1);\n            wzh(header, 0, file, f, u, -1);\n            var chks_1 = [header];\n            var pAll_1 = function () {\n                for (var _i = 0, chks_2 = chks_1; _i < chks_2.length; _i++) {\n                    var chk = chks_2[_i];\n                    _this_1.ondata(null, chk, false);\n                }\n                chks_1 = [];\n            };\n            var tr_1 = this.d;\n            this.d = 0;\n            var ind_1 = this.u.length;\n            var uf_1 = mrg(file, {\n                f: f,\n                u: u,\n                o: o,\n                t: function () {\n                    if (file.terminate)\n                        file.terminate();\n                },\n                r: function () {\n                    pAll_1();\n                    if (tr_1) {\n                        var nxt = _this_1.u[ind_1 + 1];\n                        if (nxt)\n                            nxt.r();\n                        else\n                            _this_1.d = 1;\n                    }\n                    tr_1 = 1;\n                }\n            });\n            var cl_1 = 0;\n            file.ondata = function (err, dat, final) {\n                if (err) {\n                    _this_1.ondata(err, dat, final);\n                    _this_1.terminate();\n                }\n                else {\n                    cl_1 += dat.length;\n                    chks_1.push(dat);\n                    if (final) {\n                        var dd = new u8(16);\n                        wbytes(dd, 0, 0x8074B50);\n                        wbytes(dd, 4, file.crc);\n                        wbytes(dd, 8, cl_1);\n                        wbytes(dd, 12, file.size);\n                        chks_1.push(dd);\n                        uf_1.c = cl_1, uf_1.b = hl_1 + cl_1 + 16, uf_1.crc = file.crc, uf_1.size = file.size;\n                        if (tr_1)\n                            uf_1.r();\n                        tr_1 = 1;\n                    }\n                    else if (tr_1)\n                        pAll_1();\n                }\n            };\n            this.u.push(uf_1);\n        }\n    };\n    /**\n     * Ends the process of adding files and prepares to emit the final chunks.\n     * This *must* be called after adding all desired files for the resulting\n     * ZIP file to work properly.\n     */\n    Zip.prototype.end = function () {\n        var _this_1 = this;\n        if (this.d & 2) {\n            this.ondata(err(4 + (this.d & 1) * 8, 0, 1), null, true);\n            return;\n        }\n        if (this.d)\n            this.e();\n        else\n            this.u.push({\n                r: function () {\n                    if (!(_this_1.d & 1))\n                        return;\n                    _this_1.u.splice(-1, 1);\n                    _this_1.e();\n                },\n                t: function () { }\n            });\n        this.d = 3;\n    };\n    Zip.prototype.e = function () {\n        var bt = 0, l = 0, tl = 0;\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\n            var f = _a[_i];\n            tl += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0);\n        }\n        var out = new u8(tl + 22);\n        for (var _b = 0, _c = this.u; _b < _c.length; _b++) {\n            var f = _c[_b];\n            wzh(out, bt, f, f.f, f.u, -f.c - 2, l, f.o);\n            bt += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0), l += f.b;\n        }\n        wzf(out, bt, this.u.length, tl, l);\n        this.ondata(null, out, true);\n        this.d = 2;\n    };\n    /**\n     * A method to terminate any internal workers used by the stream. Subsequent\n     * calls to add() will fail.\n     */\n    Zip.prototype.terminate = function () {\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\n            var f = _a[_i];\n            f.t();\n        }\n        this.d = 2;\n    };\n    return Zip;\n}());\nexport { Zip };\nexport function zip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    var r = {};\n    fltn(data, '', r, opts);\n    var k = Object.keys(r);\n    var lft = k.length, o = 0, tot = 0;\n    var slft = lft, files = new Array(lft);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var cbd = function (a, b) {\n        mt(function () { cb(a, b); });\n    };\n    mt(function () { cbd = cb; });\n    var cbf = function () {\n        var out = new u8(tot + 22), oe = o, cdl = tot - o;\n        tot = 0;\n        for (var i = 0; i < slft; ++i) {\n            var f = files[i];\n            try {\n                var l = f.c.length;\n                wzh(out, tot, f, f.f, f.u, l);\n                var badd = 30 + f.f.length + exfl(f.extra);\n                var loc = tot + badd;\n                out.set(f.c, loc);\n                wzh(out, o, f, f.f, f.u, l, tot, f.m), o += 16 + badd + (f.m ? f.m.length : 0), tot = loc + l;\n            }\n            catch (e) {\n                return cbd(e, null);\n            }\n        }\n        wzf(out, o, files.length, cdl, oe);\n        cbd(null, out);\n    };\n    if (!lft)\n        cbf();\n    var _loop_1 = function (i) {\n        var fn = k[i];\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var c = crc(), size = file.length;\n        c.p(file);\n        var f = strToU8(fn), s = f.length;\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\n        var exl = exfl(p.extra);\n        var compression = p.level == 0 ? 0 : 8;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cbd(e, null);\n            }\n            else {\n                var l = d.length;\n                files[i] = mrg(p, {\n                    size: size,\n                    crc: c.d(),\n                    c: d,\n                    f: f,\n                    m: m,\n                    u: s != fn.length || (m && (com.length != ms)),\n                    compression: compression\n                });\n                o += 30 + s + exl + l;\n                tot += 76 + 2 * (s + exl) + (ms || 0) + l;\n                if (!--lft)\n                    cbf();\n            }\n        };\n        if (s > 65535)\n            cbl(err(11, 0, 1), null);\n        if (!compression)\n            cbl(null, file);\n        else if (size < 160000) {\n            try {\n                cbl(null, deflateSync(file, p));\n            }\n            catch (e) {\n                cbl(e, null);\n            }\n        }\n        else\n            term.push(deflate(file, p, cbl));\n    };\n    // Cannot use lft because it can decrease\n    for (var i = 0; i < slft; ++i) {\n        _loop_1(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously creates a ZIP file. Prefer using `zip` for better performance\n * with more than one file.\n * @param data The directory structure for the ZIP archive\n * @param opts The main options, merged with per-file options\n * @returns The generated ZIP archive\n */\nexport function zipSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var r = {};\n    var files = [];\n    fltn(data, '', r, opts);\n    var o = 0;\n    var tot = 0;\n    for (var fn in r) {\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var compression = p.level == 0 ? 0 : 8;\n        var f = strToU8(fn), s = f.length;\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\n        var exl = exfl(p.extra);\n        if (s > 65535)\n            err(11);\n        var d = compression ? deflateSync(file, p) : file, l = d.length;\n        var c = crc();\n        c.p(file);\n        files.push(mrg(p, {\n            size: file.length,\n            crc: c.d(),\n            c: d,\n            f: f,\n            m: m,\n            u: s != fn.length || (m && (com.length != ms)),\n            o: o,\n            compression: compression\n        }));\n        o += 30 + s + exl + l;\n        tot += 76 + 2 * (s + exl) + (ms || 0) + l;\n    }\n    var out = new u8(tot + 22), oe = o, cdl = tot - o;\n    for (var i = 0; i < files.length; ++i) {\n        var f = files[i];\n        wzh(out, f.o, f, f.f, f.u, f.c.length);\n        var badd = 30 + f.f.length + exfl(f.extra);\n        out.set(f.c, f.o + badd);\n        wzh(out, o, f, f.f, f.u, f.c.length, f.o, f.m), o += 16 + badd + (f.m ? f.m.length : 0);\n    }\n    wzf(out, o, files.length, cdl, oe);\n    return out;\n}\n/**\n * Streaming pass-through decompression for ZIP archives\n */\nvar UnzipPassThrough = /*#__PURE__*/ (function () {\n    function UnzipPassThrough() {\n    }\n    UnzipPassThrough.prototype.push = function (data, final) {\n        this.ondata(null, data, final);\n    };\n    UnzipPassThrough.compression = 0;\n    return UnzipPassThrough;\n}());\nexport { UnzipPassThrough };\n/**\n * Streaming DEFLATE decompression for ZIP archives. Prefer AsyncZipInflate for\n * better performance.\n */\nvar UnzipInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE decompression that can be used in ZIP archives\n     */\n    function UnzipInflate() {\n        var _this_1 = this;\n        this.i = new Inflate(function (dat, final) {\n            _this_1.ondata(null, dat, final);\n        });\n    }\n    UnzipInflate.prototype.push = function (data, final) {\n        try {\n            this.i.push(data, final);\n        }\n        catch (e) {\n            this.ondata(e, null, final);\n        }\n    };\n    UnzipInflate.compression = 8;\n    return UnzipInflate;\n}());\nexport { UnzipInflate };\n/**\n * Asynchronous streaming DEFLATE decompression for ZIP archives\n */\nvar AsyncUnzipInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE decompression that can be used in ZIP archives\n     */\n    function AsyncUnzipInflate(_, sz) {\n        var _this_1 = this;\n        if (sz < 320000) {\n            this.i = new Inflate(function (dat, final) {\n                _this_1.ondata(null, dat, final);\n            });\n        }\n        else {\n            this.i = new AsyncInflate(function (err, dat, final) {\n                _this_1.ondata(err, dat, final);\n            });\n            this.terminate = this.i.terminate;\n        }\n    }\n    AsyncUnzipInflate.prototype.push = function (data, final) {\n        if (this.i.terminate)\n            data = slc(data, 0);\n        this.i.push(data, final);\n    };\n    AsyncUnzipInflate.compression = 8;\n    return AsyncUnzipInflate;\n}());\nexport { AsyncUnzipInflate };\n/**\n * A ZIP archive decompression stream that emits files as they are discovered\n */\nvar Unzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a ZIP decompression stream\n     * @param cb The callback to call whenever a file in the ZIP archive is found\n     */\n    function Unzip(cb) {\n        this.onfile = cb;\n        this.k = [];\n        this.o = {\n            0: UnzipPassThrough\n        };\n        this.p = et;\n    }\n    /**\n     * Pushes a chunk to be unzipped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzip.prototype.push = function (chunk, final) {\n        var _this_1 = this;\n        if (!this.onfile)\n            err(5);\n        if (!this.p)\n            err(4);\n        if (this.c > 0) {\n            var len = Math.min(this.c, chunk.length);\n            var toAdd = chunk.subarray(0, len);\n            this.c -= len;\n            if (this.d)\n                this.d.push(toAdd, !this.c);\n            else\n                this.k[0].push(toAdd);\n            chunk = chunk.subarray(len);\n            if (chunk.length)\n                return this.push(chunk, final);\n        }\n        else {\n            var f = 0, i = 0, is = void 0, buf = void 0;\n            if (!this.p.length)\n                buf = chunk;\n            else if (!chunk.length)\n                buf = this.p;\n            else {\n                buf = new u8(this.p.length + chunk.length);\n                buf.set(this.p), buf.set(chunk, this.p.length);\n            }\n            var l = buf.length, oc = this.c, add = oc && this.d;\n            var _loop_2 = function () {\n                var _a;\n                var sig = b4(buf, i);\n                if (sig == 0x4034B50) {\n                    f = 1, is = i;\n                    this_1.d = null;\n                    this_1.c = 0;\n                    var bf = b2(buf, i + 6), cmp_1 = b2(buf, i + 8), u = bf & 2048, dd = bf & 8, fnl = b2(buf, i + 26), es = b2(buf, i + 28);\n                    if (l > i + 30 + fnl + es) {\n                        var chks_3 = [];\n                        this_1.k.unshift(chks_3);\n                        f = 2;\n                        var sc_1 = b4(buf, i + 18), su_1 = b4(buf, i + 22);\n                        var fn_1 = strFromU8(buf.subarray(i + 30, i += 30 + fnl), !u);\n                        if (sc_1 == 4294967295) {\n                            _a = dd ? [-2] : z64e(buf, i), sc_1 = _a[0], su_1 = _a[1];\n                        }\n                        else if (dd)\n                            sc_1 = -1;\n                        i += es;\n                        this_1.c = sc_1;\n                        var d_1;\n                        var file_1 = {\n                            name: fn_1,\n                            compression: cmp_1,\n                            start: function () {\n                                if (!file_1.ondata)\n                                    err(5);\n                                if (!sc_1)\n                                    file_1.ondata(null, et, true);\n                                else {\n                                    var ctr = _this_1.o[cmp_1];\n                                    if (!ctr)\n                                        file_1.ondata(err(14, 'unknown compression type ' + cmp_1, 1), null, false);\n                                    d_1 = sc_1 < 0 ? new ctr(fn_1) : new ctr(fn_1, sc_1, su_1);\n                                    d_1.ondata = function (err, dat, final) { file_1.ondata(err, dat, final); };\n                                    for (var _i = 0, chks_4 = chks_3; _i < chks_4.length; _i++) {\n                                        var dat = chks_4[_i];\n                                        d_1.push(dat, false);\n                                    }\n                                    if (_this_1.k[0] == chks_3 && _this_1.c)\n                                        _this_1.d = d_1;\n                                    else\n                                        d_1.push(et, true);\n                                }\n                            },\n                            terminate: function () {\n                                if (d_1 && d_1.terminate)\n                                    d_1.terminate();\n                            }\n                        };\n                        if (sc_1 >= 0)\n                            file_1.size = sc_1, file_1.originalSize = su_1;\n                        this_1.onfile(file_1);\n                    }\n                    return \"break\";\n                }\n                else if (oc) {\n                    if (sig == 0x8074B50) {\n                        is = i += 12 + (oc == -2 && 8), f = 3, this_1.c = 0;\n                        return \"break\";\n                    }\n                    else if (sig == 0x2014B50) {\n                        is = i -= 4, f = 3, this_1.c = 0;\n                        return \"break\";\n                    }\n                }\n            };\n            var this_1 = this;\n            for (; i < l - 4; ++i) {\n                var state_1 = _loop_2();\n                if (state_1 === \"break\")\n                    break;\n            }\n            this.p = et;\n            if (oc < 0) {\n                var dat = f ? buf.subarray(0, is - 12 - (oc == -2 && 8) - (b4(buf, is - 16) == 0x8074B50 && 4)) : buf.subarray(0, i);\n                if (add)\n                    add.push(dat, !!f);\n                else\n                    this.k[+(f == 2)].push(dat);\n            }\n            if (f & 2)\n                return this.push(buf.subarray(i), final);\n            this.p = buf.subarray(i);\n        }\n        if (final) {\n            if (this.c)\n                err(13);\n            this.p = null;\n        }\n    };\n    /**\n     * Registers a decoder with the stream, allowing for files compressed with\n     * the compression type provided to be expanded correctly\n     * @param decoder The decoder constructor\n     */\n    Unzip.prototype.register = function (decoder) {\n        this.o[decoder.compression] = decoder;\n    };\n    return Unzip;\n}());\nexport { Unzip };\nvar mt = typeof queueMicrotask == 'function' ? queueMicrotask : typeof setTimeout == 'function' ? setTimeout : function (fn) { fn(); };\nexport function unzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var files = {};\n    var cbd = function (a, b) {\n        mt(function () { cb(a, b); });\n    };\n    mt(function () { cbd = cb; });\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558) {\n            cbd(err(13, 0, 1), null);\n            return tAll;\n        }\n    }\n    ;\n    var lft = b2(data, e + 8);\n    if (lft) {\n        var c = lft;\n        var o = b4(data, e + 16);\n        var z = o == 4294967295 || c == 65535;\n        if (z) {\n            var ze = b4(data, e - 12);\n            z = b4(data, ze) == 0x6064B50;\n            if (z) {\n                c = lft = b4(data, ze + 32);\n                o = b4(data, ze + 48);\n            }\n        }\n        var fltr = opts && opts.filter;\n        var _loop_3 = function (i) {\n            var _a = zh(data, o, z), c_1 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n            o = no;\n            var cbl = function (e, d) {\n                if (e) {\n                    tAll();\n                    cbd(e, null);\n                }\n                else {\n                    if (d)\n                        files[fn] = d;\n                    if (!--lft)\n                        cbd(null, files);\n                }\n            };\n            if (!fltr || fltr({\n                name: fn,\n                size: sc,\n                originalSize: su,\n                compression: c_1\n            })) {\n                if (!c_1)\n                    cbl(null, slc(data, b, b + sc));\n                else if (c_1 == 8) {\n                    var infl = data.subarray(b, b + sc);\n                    if (sc < 320000) {\n                        try {\n                            cbl(null, inflateSync(infl, new u8(su)));\n                        }\n                        catch (e) {\n                            cbl(e, null);\n                        }\n                    }\n                    else\n                        term.push(inflate(infl, { size: su }, cbl));\n                }\n                else\n                    cbl(err(14, 'unknown compression type ' + c_1, 1), null);\n            }\n            else\n                cbl(null, null);\n        };\n        for (var i = 0; i < c; ++i) {\n            _loop_3(i);\n        }\n    }\n    else\n        cbd(null, {});\n    return tAll;\n}\n/**\n * Synchronously decompresses a ZIP archive. Prefer using `unzip` for better\n * performance with more than one file.\n * @param data The raw compressed ZIP file\n * @param opts The ZIP extraction options\n * @returns The decompressed files\n */\nexport function unzipSync(data, opts) {\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558)\n            err(13);\n    }\n    ;\n    var c = b2(data, e + 8);\n    if (!c)\n        return {};\n    var o = b4(data, e + 16);\n    var z = o == 4294967295 || c == 65535;\n    if (z) {\n        var ze = b4(data, e - 12);\n        z = b4(data, ze) == 0x6064B50;\n        if (z) {\n            c = b4(data, ze + 32);\n            o = b4(data, ze + 48);\n        }\n    }\n    var fltr = opts && opts.filter;\n    for (var i = 0; i < c; ++i) {\n        var _a = zh(data, o, z), c_2 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        if (!fltr || fltr({\n            name: fn,\n            size: sc,\n            originalSize: su,\n            compression: c_2\n        })) {\n            if (!c_2)\n                files[fn] = slc(data, b, b + sc);\n            else if (c_2 == 8)\n                files[fn] = inflateSync(data.subarray(b, b + sc), new u8(su));\n            else\n                err(14, 'unknown compression type ' + c_2);\n        }\n    }\n    return files;\n}\n", "import booleanPointOnLine from '@turf/boolean-point-on-line';\nimport center from '@turf/center';\nimport length from '@turf/length';\nimport lineSlice from '@turf/line-slice';\nimport nearestPointOnLine from '@turf/nearest-point-on-line';\nimport type { EntranceFeature, ObstructionWallFeature } from './mvf-types';\n\nconst TURF_EPSILON = 0.0000001;\n\nfunction point(coords: number[]): GeoJSON.Point {\n\treturn {\n\t\ttype: 'Point',\n\t\tcoordinates: coords,\n\t};\n}\n\nfunction splitObstructionByEntrance(wall: ObstructionWallFeature, entrance: EntranceFeature): ObstructionWallFeature[] {\n\tconst { coordinates: entranceCoords } = entrance.geometry;\n\tconst { coordinates: wallCoords } = wall.geometry;\n\tconst entrancePoints = entranceCoords.map(c => nearestPointOnLine(wall, point(c)));\n\n\treturn wallCoords.reduce((acc, wallCoord) => {\n\t\tconst line1 = lineSlice(point(wallCoord), entrancePoints[0], wall);\n\t\tconst line2 = lineSlice(point(wallCoord), entrancePoints[1], wall);\n\t\tconst newWall = length(line1) < length(line2) ? line1 : line2;\n\n\t\tnewWall.properties = {\n\t\t\t...wall.properties,\n\t\t\tentrances: [],\n\t\t};\n\n\t\treturn acc.concat([newWall as ObstructionWallFeature]);\n\t}, [] as ObstructionWallFeature[]);\n}\n\nexport function findAndSplitObstructionByAllEntrances(\n\twall: ObstructionWallFeature,\n\tentrances: EntranceFeature[],\n): { entrances: EntranceFeature[]; obstructions: ObstructionWallFeature[] } {\n\treturn entrances.reduce<{ entrances: EntranceFeature[]; obstructions: ObstructionWallFeature[] }>(\n\t\t(result, entrance) => {\n\t\t\tconst options = { epsilon: TURF_EPSILON };\n\n\t\t\tconst wallWithEntranceIndex = result.obstructions.findIndex(wall =>\n\t\t\t\tbooleanPointOnLine(center(entrance), wall, options),\n\t\t\t);\n\t\t\tconst wallWithEntrance = result.obstructions[wallWithEntranceIndex];\n\n\t\t\tif (wallWithEntrance) {\n\t\t\t\tconst [firstWall, secondWall] = splitObstructionByEntrance(wallWithEntrance, entrance);\n\t\t\t\tresult.entrances.push(entrance);\n\t\t\t\tresult.obstructions.splice(wallWithEntranceIndex, 1, firstWall, secondWall);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\t{ obstructions: [wall], entrances: [] },\n\t);\n}\n", "import { getCoord, getCoords } from \"@turf/invariant\";\n/**\n * Returns true if a point is on a line. Accepts a optional parameter to ignore the\n * start and end vertices of the linestring.\n *\n * @name booleanPointOnLine\n * @param {Coord} pt GeoJSON Point\n * @param {Feature<LineString>} line GeoJSON LineString\n * @param {Object} [options={}] Optional parameters\n * @param {boolean} [options.ignoreEndVertices=false] whether to ignore the start and end vertices.\n * @param {number} [options.epsilon] Fractional number to compare with the cross product result. Useful for dealing with floating points such as lng/lat points\n * @returns {boolean} true/false\n * @example\n * var pt = turf.point([0, 0]);\n * var line = turf.lineString([[-1, -1],[1, 1],[1.5, 2.2]]);\n * var isPointOnLine = turf.booleanPointOnLine(pt, line);\n * //=true\n */\nfunction booleanPointOnLine(pt, line, options) {\n    if (options === void 0) { options = {}; }\n    // Normalize inputs\n    var ptCoords = getCoord(pt);\n    var lineCoords = getCoords(line);\n    // Main\n    for (var i = 0; i < lineCoords.length - 1; i++) {\n        var ignoreBoundary = false;\n        if (options.ignoreEndVertices) {\n            if (i === 0) {\n                ignoreBoundary = \"start\";\n            }\n            if (i === lineCoords.length - 2) {\n                ignoreBoundary = \"end\";\n            }\n            if (i === 0 && i + 1 === lineCoords.length - 1) {\n                ignoreBoundary = \"both\";\n            }\n        }\n        if (isPointOnLineSegment(lineCoords[i], lineCoords[i + 1], ptCoords, ignoreBoundary, typeof options.epsilon === \"undefined\" ? null : options.epsilon)) {\n            return true;\n        }\n    }\n    return false;\n}\n// See http://stackoverflow.com/a/4833823/1979085\n// See https://stackoverflow.com/a/328122/1048847\n/**\n * @private\n * @param {Position} lineSegmentStart coord pair of start of line\n * @param {Position} lineSegmentEnd coord pair of end of line\n * @param {Position} pt coord pair of point to check\n * @param {boolean|string} excludeBoundary whether the point is allowed to fall on the line ends.\n * @param {number} epsilon Fractional number to compare with the cross product result. Useful for dealing with floating points such as lng/lat points\n * If true which end to ignore.\n * @returns {boolean} true/false\n */\nfunction isPointOnLineSegment(lineSegmentStart, lineSegmentEnd, pt, excludeBoundary, epsilon) {\n    var x = pt[0];\n    var y = pt[1];\n    var x1 = lineSegmentStart[0];\n    var y1 = lineSegmentStart[1];\n    var x2 = lineSegmentEnd[0];\n    var y2 = lineSegmentEnd[1];\n    var dxc = pt[0] - x1;\n    var dyc = pt[1] - y1;\n    var dxl = x2 - x1;\n    var dyl = y2 - y1;\n    var cross = dxc * dyl - dyc * dxl;\n    if (epsilon !== null) {\n        if (Math.abs(cross) > epsilon) {\n            return false;\n        }\n    }\n    else if (cross !== 0) {\n        return false;\n    }\n    if (!excludeBoundary) {\n        if (Math.abs(dxl) >= Math.abs(dyl)) {\n            return dxl > 0 ? x1 <= x && x <= x2 : x2 <= x && x <= x1;\n        }\n        return dyl > 0 ? y1 <= y && y <= y2 : y2 <= y && y <= y1;\n    }\n    else if (excludeBoundary === \"start\") {\n        if (Math.abs(dxl) >= Math.abs(dyl)) {\n            return dxl > 0 ? x1 < x && x <= x2 : x2 <= x && x < x1;\n        }\n        return dyl > 0 ? y1 < y && y <= y2 : y2 <= y && y < y1;\n    }\n    else if (excludeBoundary === \"end\") {\n        if (Math.abs(dxl) >= Math.abs(dyl)) {\n            return dxl > 0 ? x1 <= x && x < x2 : x2 < x && x <= x1;\n        }\n        return dyl > 0 ? y1 <= y && y < y2 : y2 < y && y <= y1;\n    }\n    else if (excludeBoundary === \"both\") {\n        if (Math.abs(dxl) >= Math.abs(dyl)) {\n            return dxl > 0 ? x1 < x && x < x2 : x2 < x && x < x1;\n        }\n        return dyl > 0 ? y1 < y && y < y2 : y2 < y && y < y1;\n    }\n    return false;\n}\nexport default booleanPointOnLine;\n", "import { isNumber, } from \"@turf/helpers\";\n/**\n * Unwrap a coordinate from a Point Feature, Geometry or a single coordinate.\n *\n * @name getCoord\n * @param {Array<number>|Geometry<Point>|Feature<Point>} coord GeoJSON Point or an Array of numbers\n * @returns {Array<number>} coordinates\n * @example\n * var pt = turf.point([10, 10]);\n *\n * var coord = turf.getCoord(pt);\n * //= [10, 10]\n */\nexport function getCoord(coord) {\n    if (!coord) {\n        throw new Error(\"coord is required\");\n    }\n    if (!Array.isArray(coord)) {\n        if (coord.type === \"Feature\" &&\n            coord.geometry !== null &&\n            coord.geometry.type === \"Point\") {\n            return coord.geometry.coordinates;\n        }\n        if (coord.type === \"Point\") {\n            return coord.coordinates;\n        }\n    }\n    if (Array.isArray(coord) &&\n        coord.length >= 2 &&\n        !Array.isArray(coord[0]) &&\n        !Array.isArray(coord[1])) {\n        return coord;\n    }\n    throw new Error(\"coord must be GeoJSON Point or an Array of numbers\");\n}\n/**\n * Unwrap coordinates from a Feature, Geometry Object or an Array\n *\n * @name getCoords\n * @param {Array<any>|Geometry|Feature} coords Feature, Geometry Object or an Array\n * @returns {Array<any>} coordinates\n * @example\n * var poly = turf.polygon([[[119.32, -8.7], [119.55, -8.69], [119.51, -8.54], [119.32, -8.7]]]);\n *\n * var coords = turf.getCoords(poly);\n * //= [[[119.32, -8.7], [119.55, -8.69], [119.51, -8.54], [119.32, -8.7]]]\n */\nexport function getCoords(coords) {\n    if (Array.isArray(coords)) {\n        return coords;\n    }\n    // Feature\n    if (coords.type === \"Feature\") {\n        if (coords.geometry !== null) {\n            return coords.geometry.coordinates;\n        }\n    }\n    else {\n        // Geometry\n        if (coords.coordinates) {\n            return coords.coordinates;\n        }\n    }\n    throw new Error(\"coords must be GeoJSON Feature, Geometry Object or an Array\");\n}\n/**\n * Checks if coordinates contains a number\n *\n * @name containsNumber\n * @param {Array<any>} coordinates GeoJSON Coordinates\n * @returns {boolean} true if Array contains a number\n */\nexport function containsNumber(coordinates) {\n    if (coordinates.length > 1 &&\n        isNumber(coordinates[0]) &&\n        isNumber(coordinates[1])) {\n        return true;\n    }\n    if (Array.isArray(coordinates[0]) && coordinates[0].length) {\n        return containsNumber(coordinates[0]);\n    }\n    throw new Error(\"coordinates must only contain numbers\");\n}\n/**\n * Enforce expectations about types of GeoJSON objects for Turf.\n *\n * @name geojsonType\n * @param {GeoJSON} value any GeoJSON object\n * @param {string} type expected GeoJSON type\n * @param {string} name name of calling function\n * @throws {Error} if value is not the expected type.\n */\nexport function geojsonType(value, type, name) {\n    if (!type || !name) {\n        throw new Error(\"type and name required\");\n    }\n    if (!value || value.type !== type) {\n        throw new Error(\"Invalid input to \" +\n            name +\n            \": must be a \" +\n            type +\n            \", given \" +\n            value.type);\n    }\n}\n/**\n * Enforce expectations about types of {@link Feature} inputs for Turf.\n * Internally this uses {@link geojsonType} to judge geometry types.\n *\n * @name featureOf\n * @param {Feature} feature a feature with an expected geometry type\n * @param {string} type expected GeoJSON type\n * @param {string} name name of calling function\n * @throws {Error} error if value is not the expected type.\n */\nexport function featureOf(feature, type, name) {\n    if (!feature) {\n        throw new Error(\"No feature passed\");\n    }\n    if (!name) {\n        throw new Error(\".featureOf() requires a name\");\n    }\n    if (!feature || feature.type !== \"Feature\" || !feature.geometry) {\n        throw new Error(\"Invalid input to \" + name + \", Feature with geometry required\");\n    }\n    if (!feature.geometry || feature.geometry.type !== type) {\n        throw new Error(\"Invalid input to \" +\n            name +\n            \": must be a \" +\n            type +\n            \", given \" +\n            feature.geometry.type);\n    }\n}\n/**\n * Enforce expectations about types of {@link FeatureCollection} inputs for Turf.\n * Internally this uses {@link geojsonType} to judge geometry types.\n *\n * @name collectionOf\n * @param {FeatureCollection} featureCollection a FeatureCollection for which features will be judged\n * @param {string} type expected GeoJSON type\n * @param {string} name name of calling function\n * @throws {Error} if value is not the expected type.\n */\nexport function collectionOf(featureCollection, type, name) {\n    if (!featureCollection) {\n        throw new Error(\"No featureCollection passed\");\n    }\n    if (!name) {\n        throw new Error(\".collectionOf() requires a name\");\n    }\n    if (!featureCollection || featureCollection.type !== \"FeatureCollection\") {\n        throw new Error(\"Invalid input to \" + name + \", FeatureCollection required\");\n    }\n    for (var _i = 0, _a = featureCollection.features; _i < _a.length; _i++) {\n        var feature = _a[_i];\n        if (!feature || feature.type !== \"Feature\" || !feature.geometry) {\n            throw new Error(\"Invalid input to \" + name + \", Feature with geometry required\");\n        }\n        if (!feature.geometry || feature.geometry.type !== type) {\n            throw new Error(\"Invalid input to \" +\n                name +\n                \": must be a \" +\n                type +\n                \", given \" +\n                feature.geometry.type);\n        }\n    }\n}\n/**\n * Get Geometry from Feature or Geometry Object\n *\n * @param {Feature|Geometry} geojson GeoJSON Feature or Geometry Object\n * @returns {Geometry|null} GeoJSON Geometry Object\n * @throws {Error} if geojson is not a Feature or Geometry Object\n * @example\n * var point = {\n *   \"type\": \"Feature\",\n *   \"properties\": {},\n *   \"geometry\": {\n *     \"type\": \"Point\",\n *     \"coordinates\": [110, 40]\n *   }\n * }\n * var geom = turf.getGeom(point)\n * //={\"type\": \"Point\", \"coordinates\": [110, 40]}\n */\nexport function getGeom(geojson) {\n    if (geojson.type === \"Feature\") {\n        return geojson.geometry;\n    }\n    return geojson;\n}\n/**\n * Get GeoJSON object's type, Geometry type is prioritize.\n *\n * @param {GeoJSON} geojson GeoJSON object\n * @param {string} [name=\"geojson\"] name of the variable to display in error message (unused)\n * @returns {string} GeoJSON type\n * @example\n * var point = {\n *   \"type\": \"Feature\",\n *   \"properties\": {},\n *   \"geometry\": {\n *     \"type\": \"Point\",\n *     \"coordinates\": [110, 40]\n *   }\n * }\n * var geom = turf.getType(point)\n * //=\"Point\"\n */\nexport function getType(geojson, _name) {\n    if (geojson.type === \"FeatureCollection\") {\n        return \"FeatureCollection\";\n    }\n    if (geojson.type === \"GeometryCollection\") {\n        return \"GeometryCollection\";\n    }\n    if (geojson.type === \"Feature\" && geojson.geometry !== null) {\n        return geojson.geometry.type;\n    }\n    return geojson.type;\n}\n", "import bbox from \"@turf/bbox\";\nimport { point, } from \"@turf/helpers\";\n/**\n * Takes a {@link Feature} or {@link FeatureCollection} and returns the absolute center point of all features.\n *\n * @name center\n * @param {GeoJSON} geojson GeoJSON to be centered\n * @param {Object} [options={}] Optional parameters\n * @param {Object} [options.properties={}] Translate GeoJSON Properties to Point\n * @param {Object} [options.bbox={}] Translate GeoJSON BBox to Point\n * @param {Object} [options.id={}] Translate GeoJSON Id to Point\n * @returns {Feature<Point>} a Point feature at the absolute center point of all input features\n * @example\n * var features = turf.points([\n *   [-97.522259, 35.4691],\n *   [-97.502754, 35.463455],\n *   [-97.508269, 35.463245]\n * ]);\n *\n * var center = turf.center(features);\n *\n * //addToMap\n * var addToMap = [features, center]\n * center.properties['marker-size'] = 'large';\n * center.properties['marker-color'] = '#000';\n */\nfunction center(geojson, options) {\n    if (options === void 0) { options = {}; }\n    var ext = bbox(geojson);\n    var x = (ext[0] + ext[2]) / 2;\n    var y = (ext[1] + ext[3]) / 2;\n    return point([x, y], options.properties, options);\n}\nexport default center;\n", "import distance from \"@turf/distance\";\nimport { segmentReduce } from \"@turf/meta\";\n/**\n * Takes a {@link GeoJSON} and measures its length in the specified units, {@link (Multi)Point}'s distance are ignored.\n *\n * @name length\n * @param {Feature<LineString|MultiLineString>} geojson GeoJSON to measure\n * @param {Object} [options={}] Optional parameters\n * @param {string} [options.units=kilometers] can be degrees, radians, miles, or kilometers\n * @returns {number} length of GeoJSON\n * @example\n * var line = turf.lineString([[115, -32], [131, -22], [143, -25], [150, -34]]);\n * var length = turf.length(line, {units: 'miles'});\n *\n * //addToMap\n * var addToMap = [line];\n * line.properties.distance = length;\n */\nexport default function length(geojson, options) {\n    if (options === void 0) { options = {}; }\n    // Calculate distance from 2-vertex line segments\n    return segmentReduce(geojson, function (previousValue, segment) {\n        var coords = segment.geometry.coordinates;\n        return previousValue + distance(coords[0], coords[1], options);\n    }, 0);\n}\n", "import { getCoord } from \"@turf/invariant\";\nimport { radiansToLength, degreesToRadians, } from \"@turf/helpers\";\n//http://en.wikipedia.org/wiki/Haversine_formula\n//http://www.movable-type.co.uk/scripts/latlong.html\n/**\n * Calculates the distance between two {@link Point|points} in degrees, radians, miles, or kilometers.\n * This uses the [Haversine formula](http://en.wikipedia.org/wiki/Haversine_formula) to account for global curvature.\n *\n * @name distance\n * @param {Coord | Point} from origin point or coordinate\n * @param {Coord | Point} to destination point or coordinate\n * @param {Object} [options={}] Optional parameters\n * @param {string} [options.units='kilometers'] can be degrees, radians, miles, or kilometers\n * @returns {number} distance between the two points\n * @example\n * var from = turf.point([-75.343, 39.984]);\n * var to = turf.point([-75.534, 39.123]);\n * var options = {units: 'miles'};\n *\n * var distance = turf.distance(from, to, options);\n *\n * //addToMap\n * var addToMap = [from, to];\n * from.properties.distance = distance;\n * to.properties.distance = distance;\n */\nfunction distance(from, to, options) {\n    if (options === void 0) { options = {}; }\n    var coordinates1 = getCoord(from);\n    var coordinates2 = getCoord(to);\n    var dLat = degreesToRadians(coordinates2[1] - coordinates1[1]);\n    var dLon = degreesToRadians(coordinates2[0] - coordinates1[0]);\n    var lat1 = degreesToRadians(coordinates1[1]);\n    var lat2 = degreesToRadians(coordinates2[1]);\n    var a = Math.pow(Math.sin(dLat / 2), 2) +\n        Math.pow(Math.sin(dLon / 2), 2) * Math.cos(lat1) * Math.cos(lat2);\n    return radiansToLength(2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)), options.units);\n}\nexport default distance;\n", "import { getCoords, getType } from '@turf/invariant';\nimport { lineString } from '@turf/helpers';\nimport nearestPointOnLine from '@turf/nearest-point-on-line';\n\n/**\n * Takes a {@link LineString|line}, a start {@link Point}, and a stop point\n * and returns a subsection of the line in-between those points.\n * The start & stop points don't need to fall exactly on the line.\n *\n * This can be useful for extracting only the part of a route between waypoints.\n *\n * @name lineSlice\n * @param {Coord} startPt starting point\n * @param {Coord} stopPt stopping point\n * @param {Feature<LineString>|LineString} line line to slice\n * @returns {Feature<LineString>} sliced line\n * @example\n * var line = turf.lineString([\n *     [-77.031669, 38.878605],\n *     [-77.029609, 38.881946],\n *     [-77.020339, 38.884084],\n *     [-77.025661, 38.885821],\n *     [-77.021884, 38.889563],\n *     [-77.019824, 38.892368]\n * ]);\n * var start = turf.point([-77.029609, 38.881946]);\n * var stop = turf.point([-77.021884, 38.889563]);\n *\n * var sliced = turf.lineSlice(start, stop, line);\n *\n * //addToMap\n * var addToMap = [start, stop, line]\n */\nfunction lineSlice(startPt, stopPt, line) {\n  // Validation\n  var coords = getCoords(line);\n  if (getType(line) !== \"LineString\")\n    throw new Error(\"line must be a LineString\");\n\n  var startVertex = nearestPointOnLine(line, startPt);\n  var stopVertex = nearestPointOnLine(line, stopPt);\n  var ends;\n  if (startVertex.properties.index <= stopVertex.properties.index) {\n    ends = [startVertex, stopVertex];\n  } else {\n    ends = [stopVertex, startVertex];\n  }\n  var clipCoords = [ends[0].geometry.coordinates];\n  for (\n    var i = ends[0].properties.index + 1;\n    i < ends[1].properties.index + 1;\n    i++\n  ) {\n    clipCoords.push(coords[i]);\n  }\n  clipCoords.push(ends[1].geometry.coordinates);\n  return lineString(clipCoords, line.properties);\n}\n\nexport default lineSlice;\n", "import bearing from \"@turf/bearing\";\nimport distance from \"@turf/distance\";\nimport destination from \"@turf/destination\";\nimport lineIntersects from \"@turf/line-intersect\";\nimport { flattenEach } from \"@turf/meta\";\nimport { point, lineString, } from \"@turf/helpers\";\nimport { getCoords } from \"@turf/invariant\";\n/**\n * Takes a {@link Point} and a {@link LineString} and calculates the closest Point on the (Multi)LineString.\n *\n * @name nearestPointOnLine\n * @param {Geometry|Feature<LineString|MultiLineString>} lines lines to snap to\n * @param {Geometry|Feature<Point>|number[]} pt point to snap from\n * @param {Object} [options={}] Optional parameters\n * @param {string} [options.units='kilometers'] can be degrees, radians, miles, or kilometers\n * @returns {Feature<Point>} closest point on the `line` to `point`. The properties object will contain three values: `index`: closest point was found on nth line part, `dist`: distance between pt and the closest point, `location`: distance along the line between start and the closest point.\n * @example\n * var line = turf.lineString([\n *     [-77.031669, 38.878605],\n *     [-77.029609, 38.881946],\n *     [-77.020339, 38.884084],\n *     [-77.025661, 38.885821],\n *     [-77.021884, 38.889563],\n *     [-77.019824, 38.892368]\n * ]);\n * var pt = turf.point([-77.037076, 38.884017]);\n *\n * var snapped = turf.nearestPointOnLine(line, pt, {units: 'miles'});\n *\n * //addToMap\n * var addToMap = [line, pt, snapped];\n * snapped.properties['marker-color'] = '#00f';\n */\nfunction nearestPointOnLine(lines, pt, options) {\n    if (options === void 0) { options = {}; }\n    var closestPt = point([Infinity, Infinity], {\n        dist: Infinity,\n    });\n    var length = 0.0;\n    flattenEach(lines, function (line) {\n        var coords = getCoords(line);\n        for (var i = 0; i < coords.length - 1; i++) {\n            //start\n            var start = point(coords[i]);\n            start.properties.dist = distance(pt, start, options);\n            //stop\n            var stop_1 = point(coords[i + 1]);\n            stop_1.properties.dist = distance(pt, stop_1, options);\n            // sectionLength\n            var sectionLength = distance(start, stop_1, options);\n            //perpendicular\n            var heightDistance = Math.max(start.properties.dist, stop_1.properties.dist);\n            var direction = bearing(start, stop_1);\n            var perpendicularPt1 = destination(pt, heightDistance, direction + 90, options);\n            var perpendicularPt2 = destination(pt, heightDistance, direction - 90, options);\n            var intersect = lineIntersects(lineString([\n                perpendicularPt1.geometry.coordinates,\n                perpendicularPt2.geometry.coordinates,\n            ]), lineString([start.geometry.coordinates, stop_1.geometry.coordinates]));\n            var intersectPt = null;\n            if (intersect.features.length > 0) {\n                intersectPt = intersect.features[0];\n                intersectPt.properties.dist = distance(pt, intersectPt, options);\n                intersectPt.properties.location =\n                    length + distance(start, intersectPt, options);\n            }\n            if (start.properties.dist < closestPt.properties.dist) {\n                closestPt = start;\n                closestPt.properties.index = i;\n                closestPt.properties.location = length;\n            }\n            if (stop_1.properties.dist < closestPt.properties.dist) {\n                closestPt = stop_1;\n                closestPt.properties.index = i + 1;\n                closestPt.properties.location = length + sectionLength;\n            }\n            if (intersectPt &&\n                intersectPt.properties.dist < closestPt.properties.dist) {\n                closestPt = intersectPt;\n                closestPt.properties.index = i;\n            }\n            // update length\n            length += sectionLength;\n        }\n    });\n    return closestPt;\n}\nexport default nearestPointOnLine;\n", "import { degreesToRadians, radiansToDegrees } from \"@turf/helpers\";\nimport { getCoord } from \"@turf/invariant\";\n// http://en.wikipedia.org/wiki/Haversine_formula\n// http://www.movable-type.co.uk/scripts/latlong.html\n/**\n * Takes two {@link Point|points} and finds the geographic bearing between them,\n * i.e. the angle measured in degrees from the north line (0 degrees)\n *\n * @name bearing\n * @param {Coord} start starting Point\n * @param {Coord} end ending Point\n * @param {Object} [options={}] Optional parameters\n * @param {boolean} [options.final=false] calculates the final bearing if true\n * @returns {number} bearing in decimal degrees, between -180 and 180 degrees (positive clockwise)\n * @example\n * var point1 = turf.point([-75.343, 39.984]);\n * var point2 = turf.point([-75.534, 39.123]);\n *\n * var bearing = turf.bearing(point1, point2);\n *\n * //addToMap\n * var addToMap = [point1, point2]\n * point1.properties['marker-color'] = '#f00'\n * point2.properties['marker-color'] = '#0f0'\n * point1.properties.bearing = bearing\n */\nexport default function bearing(start, end, options) {\n    if (options === void 0) { options = {}; }\n    // Reverse calculation\n    if (options.final === true) {\n        return calculateFinalBearing(start, end);\n    }\n    var coordinates1 = getCoord(start);\n    var coordinates2 = getCoord(end);\n    var lon1 = degreesToRadians(coordinates1[0]);\n    var lon2 = degreesToRadians(coordinates2[0]);\n    var lat1 = degreesToRadians(coordinates1[1]);\n    var lat2 = degreesToRadians(coordinates2[1]);\n    var a = Math.sin(lon2 - lon1) * Math.cos(lat2);\n    var b = Math.cos(lat1) * Math.sin(lat2) -\n        Math.sin(lat1) * Math.cos(lat2) * Math.cos(lon2 - lon1);\n    return radiansToDegrees(Math.atan2(a, b));\n}\n/**\n * Calculates Final Bearing\n *\n * @private\n * @param {Coord} start starting Point\n * @param {Coord} end ending Point\n * @returns {number} bearing\n */\nfunction calculateFinalBearing(start, end) {\n    // Swap start & end\n    var bear = bearing(end, start);\n    bear = (bear + 180) % 360;\n    return bear;\n}\n", "// http://en.wikipedia.org/wiki/Haversine_formula\n// http://www.movable-type.co.uk/scripts/latlong.html\nimport { degreesToRadians, lengthToRadians, point, radiansToDegrees, } from \"@turf/helpers\";\nimport { getCoord } from \"@turf/invariant\";\n/**\n * Takes a {@link Point} and calculates the location of a destination point given a distance in\n * degrees, radians, miles, or kilometers; and bearing in degrees.\n * This uses the [Haversine formula](http://en.wikipedia.org/wiki/Haversine_formula) to account for global curvature.\n *\n * @name destination\n * @param {Coord} origin starting point\n * @param {number} distance distance from the origin point\n * @param {number} bearing ranging from -180 to 180\n * @param {Object} [options={}] Optional parameters\n * @param {string} [options.units='kilometers'] miles, kilometers, degrees, or radians\n * @param {Object} [options.properties={}] Translate properties to Point\n * @returns {Feature<Point>} destination point\n * @example\n * var point = turf.point([-75.343, 39.984]);\n * var distance = 50;\n * var bearing = 90;\n * var options = {units: 'miles'};\n *\n * var destination = turf.destination(point, distance, bearing, options);\n *\n * //addToMap\n * var addToMap = [point, destination]\n * destination.properties['marker-color'] = '#f00';\n * point.properties['marker-color'] = '#0f0';\n */\nexport default function destination(origin, distance, bearing, options) {\n    if (options === void 0) { options = {}; }\n    // Handle input\n    var coordinates1 = getCoord(origin);\n    var longitude1 = degreesToRadians(coordinates1[0]);\n    var latitude1 = degreesToRadians(coordinates1[1]);\n    var bearingRad = degreesToRadians(bearing);\n    var radians = lengthToRadians(distance, options.units);\n    // Main\n    var latitude2 = Math.asin(Math.sin(latitude1) * Math.cos(radians) +\n        Math.cos(latitude1) * Math.sin(radians) * Math.cos(bearingRad));\n    var longitude2 = longitude1 +\n        Math.atan2(Math.sin(bearingRad) * Math.sin(radians) * Math.cos(latitude1), Math.cos(radians) - Math.sin(latitude1) * Math.sin(latitude2));\n    var lng = radiansToDegrees(longitude2);\n    var lat = radiansToDegrees(latitude2);\n    return point([lng, lat], options.properties);\n}\n", "import { feature, featureCollection, point, } from \"@turf/helpers\";\nimport { getCoords } from \"@turf/invariant\";\nimport lineSegment from \"@turf/line-segment\";\nimport { featureEach } from \"@turf/meta\";\nimport rbush from \"geojson-rbush\";\n/**\n * Takes any LineString or Polygon GeoJSON and returns the intersecting point(s).\n *\n * @name lineIntersect\n * @param {GeoJSON} line1 any LineString or Polygon\n * @param {GeoJSON} line2 any LineString or Polygon\n * @returns {FeatureCollection<Point>} point(s) that intersect both\n * @example\n * var line1 = turf.lineString([[126, -11], [129, -21]]);\n * var line2 = turf.lineString([[123, -18], [131, -14]]);\n * var intersects = turf.lineIntersect(line1, line2);\n *\n * //addToMap\n * var addToMap = [line1, line2, intersects]\n */\nfunction lineIntersect(line1, line2) {\n    var unique = {};\n    var results = [];\n    // First, normalize geometries to features\n    // Then, handle simple 2-vertex segments\n    if (line1.type === \"LineString\") {\n        line1 = feature(line1);\n    }\n    if (line2.type === \"LineString\") {\n        line2 = feature(line2);\n    }\n    if (line1.type === \"Feature\" &&\n        line2.type === \"Feature\" &&\n        line1.geometry !== null &&\n        line2.geometry !== null &&\n        line1.geometry.type === \"LineString\" &&\n        line2.geometry.type === \"LineString\" &&\n        line1.geometry.coordinates.length === 2 &&\n        line2.geometry.coordinates.length === 2) {\n        var intersect = intersects(line1, line2);\n        if (intersect) {\n            results.push(intersect);\n        }\n        return featureCollection(results);\n    }\n    // Handles complex GeoJSON Geometries\n    var tree = rbush();\n    tree.load(lineSegment(line2));\n    featureEach(lineSegment(line1), function (segment) {\n        featureEach(tree.search(segment), function (match) {\n            var intersect = intersects(segment, match);\n            if (intersect) {\n                // prevent duplicate points https://github.com/Turfjs/turf/issues/688\n                var key = getCoords(intersect).join(\",\");\n                if (!unique[key]) {\n                    unique[key] = true;\n                    results.push(intersect);\n                }\n            }\n        });\n    });\n    return featureCollection(results);\n}\n/**\n * Find a point that intersects LineStrings with two coordinates each\n *\n * @private\n * @param {Feature<LineString>} line1 GeoJSON LineString (Must only contain 2 coordinates)\n * @param {Feature<LineString>} line2 GeoJSON LineString (Must only contain 2 coordinates)\n * @returns {Feature<Point>} intersecting GeoJSON Point\n */\nfunction intersects(line1, line2) {\n    var coords1 = getCoords(line1);\n    var coords2 = getCoords(line2);\n    if (coords1.length !== 2) {\n        throw new Error(\"<intersects> line1 must only contain 2 coordinates\");\n    }\n    if (coords2.length !== 2) {\n        throw new Error(\"<intersects> line2 must only contain 2 coordinates\");\n    }\n    var x1 = coords1[0][0];\n    var y1 = coords1[0][1];\n    var x2 = coords1[1][0];\n    var y2 = coords1[1][1];\n    var x3 = coords2[0][0];\n    var y3 = coords2[0][1];\n    var x4 = coords2[1][0];\n    var y4 = coords2[1][1];\n    var denom = (y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1);\n    var numeA = (x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3);\n    var numeB = (x2 - x1) * (y1 - y3) - (y2 - y1) * (x1 - x3);\n    if (denom === 0) {\n        if (numeA === 0 && numeB === 0) {\n            return null;\n        }\n        return null;\n    }\n    var uA = numeA / denom;\n    var uB = numeB / denom;\n    if (uA >= 0 && uA <= 1 && uB >= 0 && uB <= 1) {\n        var x = x1 + uA * (x2 - x1);\n        var y = y1 + uA * (y2 - y1);\n        return point([x, y]);\n    }\n    return null;\n}\nexport default lineIntersect;\n", "import { featureCollection, lineString, } from \"@turf/helpers\";\nimport { getCoords } from \"@turf/invariant\";\nimport { flattenEach } from \"@turf/meta\";\n/**\n * Creates a {@link FeatureCollection} of 2-vertex {@link LineString} segments from a\n * {@link LineString|(Multi)LineString} or {@link Polygon|(Multi)Polygon}.\n *\n * @name lineSegment\n * @param {GeoJSON} geojson GeoJSON Polygon or LineString\n * @returns {FeatureCollection<LineString>} 2-vertex line segments\n * @example\n * var polygon = turf.polygon([[[-50, 5], [-40, -10], [-50, -10], [-40, 5], [-50, 5]]]);\n * var segments = turf.lineSegment(polygon);\n *\n * //addToMap\n * var addToMap = [polygon, segments]\n */\nfunction lineSegment(geojson) {\n    if (!geojson) {\n        throw new Error(\"geojson is required\");\n    }\n    var results = [];\n    flattenEach(geojson, function (feature) {\n        lineSegmentFeature(feature, results);\n    });\n    return featureCollection(results);\n}\n/**\n * Line Segment\n *\n * @private\n * @param {Feature<LineString|Polygon>} geojson Line or polygon feature\n * @param {Array} results push to results\n * @returns {void}\n */\nfunction lineSegmentFeature(geojson, results) {\n    var coords = [];\n    var geometry = geojson.geometry;\n    if (geometry !== null) {\n        switch (geometry.type) {\n            case \"Polygon\":\n                coords = getCoords(geometry);\n                break;\n            case \"LineString\":\n                coords = [getCoords(geometry)];\n        }\n        coords.forEach(function (coord) {\n            var segments = createSegments(coord, geojson.properties);\n            segments.forEach(function (segment) {\n                segment.id = results.length;\n                results.push(segment);\n            });\n        });\n    }\n}\n/**\n * Create Segments from LineString coordinates\n *\n * @private\n * @param {Array<Array<number>>} coords LineString coordinates\n * @param {*} properties GeoJSON properties\n * @returns {Array<Feature<LineString>>} line segments\n */\nfunction createSegments(coords, properties) {\n    var segments = [];\n    coords.reduce(function (previousCoords, currentCoords) {\n        var segment = lineString([previousCoords, currentCoords], properties);\n        segment.bbox = bbox(previousCoords, currentCoords);\n        segments.push(segment);\n        return currentCoords;\n    });\n    return segments;\n}\n/**\n * Create BBox between two coordinates (faster than @turf/bbox)\n *\n * @private\n * @param {Array<number>} coords1 Point coordinate\n * @param {Array<number>} coords2 Point coordinate\n * @returns {BBox} [west, south, east, north]\n */\nfunction bbox(coords1, coords2) {\n    var x1 = coords1[0];\n    var y1 = coords1[1];\n    var x2 = coords2[0];\n    var y2 = coords2[1];\n    var west = x1 < x2 ? x1 : x2;\n    var south = y1 < y2 ? y1 : y2;\n    var east = x1 > x2 ? x1 : x2;\n    var north = y1 > y2 ? y1 : y2;\n    return [west, south, east, north];\n}\nexport default lineSegment;\n", "import Node from './node';\n\nimport Area from './area';\nimport Door from './door';\nimport Space from './space';\nimport Floor from './floor';\nimport Connection from './connection';\nimport MapObject from './object';\nimport Coordinate from './coordinate';\nimport PointOfInterest from './poi';\nimport Annotation from './annotation';\nimport Hyperlink from './hyperlink';\nimport ImageMetaData from './image';\nimport FloorStack from './floor-stack';\nimport Facade from './facade';\nimport type { MapDataRecords, EnterpriseMapDataRecords } from '../utils/data-creation';\nimport { createDataFromMVF, createEnterpriseDataFromMVF } from '../utils/data-creation';\nimport type {\n\tAnnotationCollection,\n\tParsedMVF,\n\tConnection as MVFConnection,\n\tEntranceCollection,\n\tNodeCollection,\n\tObstructionCollection,\n\tSpaceCollection,\n\tFloorProperties as MVFFloor,\n\tFloorStack as MVFFloorStack,\n\tLanguage,\n\tParsedMVFLocalePack,\n\tAreaCollection,\n\tTilesetStyle,\n\tNavigationFlagDeclarations,\n} from '@mappedin/mvf-v2';\nimport { AnalyticsInternal } from '../analytics';\nimport EnterpriseLocation from './location';\nimport EnterpriseCategory from './category';\nimport EnterpriseVenue from './venue';\nimport { cyrb53, Logger, PubSub } from '@packages/internal/common';\nimport type {\n\tCategoryWithLocale,\n\tFloorStackWithLocale,\n\tFloorWithLocale,\n\tLanguagePack,\n\tLanguagePackRecords,\n\tPlaces,\n\tTMapDataInternalOptions,\n} from './types';\nimport { type LocalePackUrls } from '@packages/internal/mvf-utils';\nimport { deepMergeOn } from '@mappedin/mvf-core/locale';\nimport type { EnvControl, TGetMapDataOptions } from '@packages/internal/mvf-utils/mvf-utils';\nimport {\n\tcreateEnvControl,\n\tdownloadLanguagePack,\n\tgetLanguagePackUnitArray,\n\tparseLanguagePack,\n} from '@packages/internal/mvf-utils/mvf-utils';\nimport { hasSasToken, isMappedinCdnUrl, parseLocalePackToLanguagePack } from './utils';\nimport type { TMapDataObjectTypes, TGetDirectionsOptions, TNavigationTarget, MapDataElements } from '../types';\nimport { type Directions, DirectionsInternal } from '../api-geojson/directions';\nimport { equirectangularDistance } from '@packages/internal/common/utils';\nimport { getCoordinateFromStuffs, parseCdnAssetUrl, serializeCoords } from '../utils';\nimport { findPreferredLanguageInVenue, shouldForceEnterpriseLocations, type THydrateMapDataBundle } from '..';\nimport { Query } from '../query';\nimport LocationProfile from './location-profile';\nimport LocationCategory from './location-category';\nimport type { TokenManager } from '@packages/internal/mvf-utils/tokens/token-manager';\nimport type { TFindPreferredLanguageInVenueOptions } from '../api-geojson/language';\nimport type { Writable } from 'type-fest';\n\n/**\n * Internal class representing detailed map data.\n *\n * @internal\n */\nclass MapDataInternal extends PubSub<{\n\t'language-change': { code: string; name: string };\n}> {\n\tAnalytics: AnalyticsInternal;\n\t#cache: Partial<Writable<MapDataInternal>> = {};\n\n\tQuery: Query;\n\t/**\n\t * Represents the parsed Mappedin Venue Format (MVF) data.\n\t */\n\treadonly mvf: ParsedMVF;\n\n\t/**\n\t * The token is used to fetch outdoor tiles, which will then be rendered.\n\t */\n\treadonly outdoorViewToken?: string;\n\n\t/**\n\t * Represents a map of obstruction IDs to entrance node IDs.\n\t */\n\treadonly objectEntranceNodeIdsByObstructionId: Record<string, string[]>;\n\n\t/**\n\t * Represents a map of entrance IDs to obstruction IDs.\n\t */\n\treadonly obstructionIdByEntranceId: Record<string, string>;\n\n\treadonly venue?: EnterpriseVenue;\n\n\treadonly tokenManager?: TokenManager;\n\n\tdirections: DirectionsInternal;\n\n\tenterpriseMode = false;\n\n\tnodesById: MapDataRecords['nodesById'];\n\tspacesById: MapDataRecords['spacesById'];\n\tfloorsById: MapDataRecords['floorsById'];\n\tfloorStacksById: MapDataRecords['floorStacksById'];\n\tfacadesById: MapDataRecords['facadesById'];\n\tfacadesBySpaceId: MapDataRecords['facadesBySpaceId'];\n\tconnectionsById: MapDataRecords['connectionsById'];\n\tobjectsById: MapDataRecords['objectsById'];\n\tdoorsById: MapDataRecords['doorsById'];\n\tpointsOfInterestById: MapDataRecords['poisById'];\n\tannotationsById: MapDataRecords['annotationsById'];\n\tareasById: MapDataRecords['areasById'];\n\tlocationProfilesById: MapDataRecords['locationProfilesById'];\n\tlocationCategoriesById: MapDataRecords['locationCategoriesById'];\n\tlocationProfilesByExternalId: MapDataRecords['locationProfilesByExternalId'];\n\tlocationProfilesByCategoryId: MapDataRecords['locationProfilesByCategoryId'];\n\tlocationCategoriesByParentId: MapDataRecords['locationCategoriesByParentId'];\n\tdoorsByNodeId: MapDataRecords['doorsByNodeId'];\n\tmvfAnnotationsById: MapDataRecords['mvfAnnotationsById'];\n\tmvfConnectionsById: MapDataRecords['mvfConnectionsById'];\n\tmvfConnectionsByNodeId: MapDataRecords['mvfConnectionsByNodeId'];\n\tmvfConnectionIdsByLatLon: MapDataRecords['mvfConnectionIdsByLatLon'];\n\tmvfEntrancesById: MapDataRecords['mvfEntrancesById'];\n\tmvfNodesById: MapDataRecords['mvfNodesById'];\n\tmvfObstructionById: MapDataRecords['mvfObstructionById'];\n\tmvfSpacesById: MapDataRecords['mvfSpacesById'];\n\tmvfFloorsById: MapDataRecords['mvfFloorsById'];\n\tmvfFloorStacksById: MapDataRecords['mvfFloorStacksById'];\n\tmvfAreasById: MapDataRecords['mvfAreasById'];\n\n\tspacesByExternalId: MapDataRecords['spacesByExternalId'];\n\tnodesByExternalId: MapDataRecords['nodesByExternalId'];\n\tobjectsByExternalId: MapDataRecords['objectsByExternalId'];\n\tpoisByExternalId: MapDataRecords['poisByExternalId'];\n\tfloorsByExternalId: MapDataRecords['floorsByExternalId'];\n\tfloorStacksByExternalId: MapDataRecords['floorStacksByExternalId'];\n\tdoorsByExternalId: MapDataRecords['doorsByExternalId'];\n\tareasByExternalId: MapDataRecords['areasByExternalId'];\n\tconnectionSpaceIdsByLatLon: MapDataRecords['connectionIdsByLatLon'] = {};\n\tlocationProfilesByAttachedFeatureId: MapDataRecords['locationProfilesByAttachedFeatureId'] = {};\n\tentranceNodeIdsBySpaceId?: MapDataRecords['entranceNodeIdsBySpaceId'] = {};\n\n\t// Enterprise collections are optional, so initialize them to empty objects\n\tlocationsById: EnterpriseMapDataRecords['locationsById'] = {};\n\tcategoriesById: EnterpriseMapDataRecords['categoriesById'] = {};\n\tmvfLocationsByGeometryId: EnterpriseMapDataRecords['mvfLocationsByGeometryId'] = {};\n\tlocationIdsByNodeId: EnterpriseMapDataRecords['locationIdsByNodeId'] = {};\n\tspaceIdsByNodeId: MapDataRecords['spaceIdsByNodeId'] = {};\n\tobjectIdsByNodeId: MapDataRecords['objectIdsByNodeId'] = {};\n\tconnectionsByExternalId: EnterpriseMapDataRecords['connectionsByExternalId'] = {};\n\tlocationsByExternalId: EnterpriseMapDataRecords['locationsByExternalId'] = {};\n\tcategoriesByExternalId: EnterpriseMapDataRecords['categoriesByExternalId'] = {};\n\tdestinationNodesIdsBySpaceId: MapDataRecords['destinationNodesIdsBySpaceId'] = {};\n\n\tmvfNodesByFloorId: MapDataRecords['mvfNodesByFloorId'];\n\tmvfSpacesByFloorId: MapDataRecords['mvfSpacesByFloorId'];\n\tmvfPoisByFloorId: MapDataRecords['mvfPoisByFloorId'];\n\tmvfEntrancesByFloorId: MapDataRecords['mvfEntrancesByFloorId'];\n\tmvfAnnotationsByFloorId: MapDataRecords['mvfAnnotationsByFloorId'];\n\n\tlocalePacksUrls: LocalePackUrls;\n\tcurrentLanguage?: Language;\n\t/**\n\t * These represent maps of diffed objects that are used to store the translated values\n\t */\n\tlanguagePacks: {\n\t\t[languageCode: string]: LanguagePack;\n\t} = {};\n\n\ttilesets: {\n\t\t[tilesetId: string]: TilesetStyle;\n\t} = {};\n\n\tnavigationFlags: NavigationFlagDeclarations;\n\n\tbinaryBundle?: Uint8Array;\n\n\tenvControl: EnvControl;\n\n\tgetMapDataOptions?: TGetMapDataOptions;\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(mvf: ParsedMVF, options: TMapDataInternalOptions) {\n\t\tsuper();\n\t\tconst env = options?.env ?? createEnvControl();\n\t\tthis.envControl = env;\n\t\tthis.binaryBundle = options?.binaryBundle;\n\t\tthis.Analytics = new AnalyticsInternal();\n\t\tthis.localePacksUrls = options?.localePacksUrls ?? {};\n\t\tthis.mvf = mvf;\n\t\tthis.outdoorViewToken = options?.outdoorViewToken;\n\t\tthis.getMapDataOptions = options?.getMapDataOptions;\n\n\t\t// load tilesets from the mvf\n\t\tif (mvf['tileset.json']?.default != null) {\n\t\t\tthis.tilesets[mvf['tileset.json'].default.key] = mvf['tileset.json'].default;\n\t\t\tenv.updateTileServerBaseUrl(mvf['tileset.json'].default.url);\n\t\t\tif (mvf['tileset.json'].others != null) {\n\t\t\t\tfor (const tileset of mvf['tileset.json'].others) {\n\t\t\t\t\tthis.tilesets[tileset.key] = tileset;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.navigationFlags = mvf['navigationFlags.json'] ?? {};\n\n\t\tthis.enterpriseMode = options?.enterprise ?? false;\n\t\tthis.tokenManager = options?.tokenManager;\n\t\tconst data = createDataFromMVF(mvf, this);\n\n\t\tthis.nodesById = data.nodesById;\n\t\tthis.spacesById = data.spacesById;\n\t\tthis.floorsById = data.floorsById;\n\t\tthis.floorStacksById = data.floorStacksById;\n\t\tthis.facadesById = data.facadesById;\n\t\tthis.facadesBySpaceId = data.facadesBySpaceId;\n\t\tthis.connectionsById = data.connectionsById;\n\t\tthis.objectsById = data.objectsById;\n\t\tthis.doorsById = data.doorsById;\n\t\tthis.pointsOfInterestById = data.poisById;\n\t\tthis.annotationsById = data.annotationsById;\n\t\tthis.areasById = data.areasById;\n\t\tthis.locationProfilesById = data.locationProfilesById;\n\t\tthis.locationCategoriesById = data.locationCategoriesById;\n\t\tthis.locationProfilesByCategoryId = data.locationProfilesByCategoryId;\n\t\tthis.locationCategoriesByParentId = data.locationCategoriesByParentId;\n\n\t\tthis.spacesByExternalId = data.spacesByExternalId;\n\t\tthis.nodesByExternalId = data.nodesByExternalId;\n\t\tthis.objectsByExternalId = data.objectsByExternalId;\n\t\tthis.floorsByExternalId = data.floorsByExternalId;\n\t\tthis.locationProfilesByExternalId = data.locationProfilesByExternalId;\n\t\tthis.floorStacksByExternalId = data.floorStacksByExternalId;\n\t\tthis.poisByExternalId = data.poisByExternalId;\n\t\tthis.doorsByExternalId = data.doorsByExternalId;\n\t\tthis.areasByExternalId = data.areasByExternalId;\n\n\t\tthis.mvfAnnotationsById = data.mvfAnnotationsById;\n\t\tthis.mvfConnectionsById = data.mvfConnectionsById;\n\t\tthis.mvfConnectionsByNodeId = data.mvfConnectionsByNodeId;\n\t\tthis.mvfConnectionIdsByLatLon = data.mvfConnectionIdsByLatLon;\n\t\tthis.mvfEntrancesById = data.mvfEntrancesById;\n\t\tthis.mvfNodesById = data.mvfNodesById;\n\t\tthis.mvfObstructionById = data.mvfObstructionById;\n\t\tthis.mvfSpacesById = data.mvfSpacesById;\n\t\tthis.mvfFloorsById = data.mvfFloorsById;\n\t\tthis.mvfFloorStacksById = data.mvfFloorStacksById;\n\t\tthis.mvfNodesByFloorId = data.mvfNodesByFloorId;\n\t\tthis.mvfSpacesByFloorId = data.mvfSpacesByFloorId;\n\t\tthis.mvfPoisByFloorId = data.mvfPoisByFloorId;\n\t\tthis.mvfEntrancesByFloorId = data.mvfEntrancesByFloorId;\n\t\tthis.mvfAnnotationsByFloorId = data.mvfAnnotationsByFloorId;\n\t\tthis.mvfAreasById = data.mvfAreasById;\n\t\tthis.doorsByNodeId = data.doorsByNodeId;\n\t\tthis.objectEntranceNodeIdsByObstructionId = data.objectEntranceNodeIdsByObstructionId;\n\t\tthis.obstructionIdByEntranceId = data.obstructionIdByEntranceId;\n\t\tthis.connectionSpaceIdsByLatLon = data.connectionIdsByLatLon;\n\t\tthis.locationProfilesByAttachedFeatureId = data.locationProfilesByAttachedFeatureId;\n\t\tthis.entranceNodeIdsBySpaceId = data.entranceNodeIdsBySpaceId;\n\t\tthis.spaceIdsByNodeId = data.spaceIdsByNodeId;\n\t\tthis.objectIdsByNodeId = data.objectIdsByNodeId;\n\t\tthis.destinationNodesIdsBySpaceId = data.destinationNodesIdsBySpaceId;\n\n\t\tif (this.enterpriseMode || shouldForceEnterpriseLocations()) {\n\t\t\tconst enterpriseData = createEnterpriseDataFromMVF(mvf, this);\n\t\t\tthis.locationsById = enterpriseData.locationsById;\n\t\t\tthis.categoriesById = enterpriseData.categoriesById;\n\t\t\tthis.mvfLocationsByGeometryId = enterpriseData.mvfLocationsByGeometryId;\n\t\t\tthis.locationIdsByNodeId = enterpriseData.locationIdsByNodeId;\n\t\t\tthis.connectionsByExternalId = enterpriseData.connectionsByExternalId;\n\t\t\tthis.locationsByExternalId = enterpriseData.locationsByExternalId;\n\t\t\tthis.categoriesByExternalId = enterpriseData.categoriesByExternalId;\n\n\t\t\tif (enterpriseData.venue.name != null) {\n\t\t\t\tthis.venue = new EnterpriseVenue(this, { mvfData: enterpriseData.venue });\n\t\t\t\t// combine locations and location instances into one object for the language pack\n\t\t\t\tconst allLocationsById = {};\n\t\t\t\t// loops should be faster than the spread operator\n\t\t\t\tfor (const locationId in enterpriseData.mvfLocationsById) {\n\t\t\t\t\tallLocationsById[locationId] = enterpriseData.mvfLocationsById[locationId];\n\t\t\t\t}\n\t\t\t\tfor (const locationId in enterpriseData.locationInstancesById) {\n\t\t\t\t\tallLocationsById[locationId] = enterpriseData.locationInstancesById[locationId];\n\t\t\t\t}\n\n\t\t\t\tthis.languagePacks[this.venue.defaultLanguage.code] = {\n\t\t\t\t\ttype: 'initial',\n\t\t\t\t\toptimized: {\n\t\t\t\t\t\t'enterprise-location': allLocationsById,\n\t\t\t\t\t\t'enterprise-category': enterpriseData.mvfCategoriesById as Record<string, CategoryWithLocale>,\n\t\t\t\t\t\t'floor-stack': data.mvfFloorStacksById as Record<string, FloorStackWithLocale>,\n\t\t\t\t\t\tfloor: data.mvfFloorsById as Record<string, FloorWithLocale>,\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\toptions?.languagePacks?.forEach(({ language, localePack }) => {\n\t\t\t\t\tthis.languagePacks[language.code] = parseLocalePackToLanguagePack(localePack);\n\t\t\t\t});\n\n\t\t\t\tthis.currentLanguage = this.venue.defaultLanguage;\n\t\t\t}\n\t\t}\n\n\t\tthis.directions = new DirectionsInternal({\n\t\t\tnodes: mvf['node.geojson'],\n\t\t\t// CMS has only spaces that block paths, but platform has them as obstructions\n\t\t\tgeojsonCollection: this.enterpriseMode && mvf['enterprise'] ? mvf['space'] : mvf['obstruction'],\n\t\t\tconnections: mvf['connection.json'],\n\t\t\tgroupBy: 'map',\n\t\t\tmultiplicativeDistanceWeightScaling: !this.enterpriseMode,\n\t\t\tflagDeclarations: mvf['navigationFlags.json'],\n\t\t});\n\t\tthis.Query = new Query(this);\n\t}\n\n\t#getConnectionFromMVFConnection(mvfConnection: MVFConnection): Connection | undefined {\n\t\tconst nodeId = mvfConnection?.nodes?.[0];\n\t\tconst node = this.getById('node', nodeId);\n\t\tif (node == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst latLon = serializeCoords([node.coordinate.longitude, node.coordinate.latitude]);\n\t\tconst connectionIds = this.connectionSpaceIdsByLatLon[latLon];\n\n\t\treturn connectionIds?.map(id => this.connectionsById[id]).find(c => c != null);\n\t}\n\n\tgetEnv() {\n\t\t// eslint-disable-next-line @typescript-eslint/no-this-alias\n\t\tconst scope = this;\n\n\t\treturn {\n\t\t\tget baseUri() {\n\t\t\t\treturn scope.envControl.getBaseUri();\n\t\t\t},\n\t\t\tget baseAuthUri() {\n\t\t\t\treturn scope.envControl.getBaseAuthUri();\n\t\t\t},\n\t\t\tget analyticsBaseUri() {\n\t\t\t\treturn scope.envControl.getAnalyticsBaseUri();\n\t\t\t},\n\t\t\tget tileServerUri() {\n\t\t\t\treturn scope.envControl.getTileServerUri();\n\t\t\t},\n\t\t};\n\t}\n\n\t/**\n\t * Retrieves the map name.\n\t *\n\t * @returns {string} The name of the map.\n\t */\n\tget mapName(): string {\n\t\treturn this.mvf['manifest.geojson'].features[0].properties.name;\n\t}\n\n\tget organizationId(): string {\n\t\treturn this.mvf['manifest.geojson'].features[0].properties.org_id ?? '';\n\t}\n\n\t#mapCenter: Coordinate = new Coordinate(0, 0, 'initializing');\n\n\tget mapCenter(): Coordinate {\n\t\tif (this.#mapCenter.floorId === 'initializing') {\n\t\t\tthis.#mapCenter = new Coordinate(\n\t\t\t\tthis.mvf['manifest.geojson'].features[0].geometry.coordinates[1],\n\t\t\t\tthis.mvf['manifest.geojson'].features[0].geometry.coordinates[0],\n\t\t\t);\n\t\t}\n\n\t\treturn this.#mapCenter;\n\t}\n\n\tget naturalBearing(): number {\n\t\treturn this.mvf['manifest.geojson'].features[0].properties.naturalBearing ?? 0;\n\t}\n\n\t/**\n\t * Retrieves all spaces in the map.\n\t *\n\t * @returns {Space[]} An array of Space objects.\n\t */\n\tget spaces(): Space[] {\n\t\tif (this.#cache.spaces == null) {\n\t\t\tthis.#cache.spaces = globalThis.Object.values(this.spacesById);\n\t\t}\n\n\t\treturn this.#cache.spaces;\n\t}\n\n\t/**\n\t * Retrieves all objects in the map.\n\t *\n\t * @returns {MapObject[]} An array of MapObject objects.\n\t */\n\tget objects(): MapObject[] {\n\t\tif (this.#cache.objects == null) {\n\t\t\tthis.#cache.objects = globalThis.Object.values(this.objectsById);\n\t\t}\n\n\t\treturn this.#cache.objects;\n\t}\n\n\t/**\n\t * Retrieves all connections in the map.\n\t *\n\t * @returns {Connection[]} An array of Connection objects.\n\t */\n\tget connections(): Connection[] {\n\t\tif (this.#cache.connections == null) {\n\t\t\tthis.#cache.connections = globalThis.Object.values(this.connectionsById);\n\t\t}\n\n\t\treturn this.#cache.connections;\n\t}\n\n\t/**\n\t * Retrieves all floors in the map.\n\t *\n\t * @returns {Floor[]} An array of Floor objects.\n\t */\n\tget floors(): Floor[] {\n\t\tif (this.#cache.floors == null) {\n\t\t\tthis.#cache.floors = globalThis.Object.values(this.floorsById);\n\t\t}\n\n\t\treturn this.#cache.floors;\n\t}\n\n\tget floorStacks(): FloorStack[] {\n\t\tif (this.#cache.floorStacks == null) {\n\t\t\tthis.#cache.floorStacks = globalThis.Object.values(this.floorStacksById);\n\t\t}\n\n\t\treturn this.#cache.floorStacks;\n\t}\n\n\tget facades(): Facade[] {\n\t\tif (this.#cache.facades == null) {\n\t\t\tthis.#cache.facades = globalThis.Object.values(this.facadesById);\n\t\t}\n\n\t\treturn this.#cache.facades;\n\t}\n\n\t/**\n\t * Retrieves all doors in the map.\n\t *\n\t * @internal\n\t * @hidden\n\t * @returns {Door[]} An array of Door objects.\n\t */\n\tget doors(): Door[] {\n\t\tif (this.#cache.doors == null) {\n\t\t\tthis.#cache.doors = globalThis.Object.values(this.doorsById);\n\t\t}\n\n\t\treturn this.#cache.doors;\n\t}\n\n\t/**\n\t * Retrieves all points of interest in the map.\n\t *\n\t * @returns {PointOfInterest[]} An array of PointOfInterest objects.\n\t */\n\tget pointsOfInterest(): PointOfInterest[] {\n\t\tif (this.#cache.pointsOfInterest == null) {\n\t\t\tthis.#cache.pointsOfInterest = globalThis.Object.values(this.pointsOfInterestById);\n\t\t}\n\n\t\treturn this.#cache.pointsOfInterest;\n\t}\n\n\t/**\n\t * Retrieves all annotations in the map.\n\t *\n\t * @returns {Annotation[]} An array of Annotation objects.\n\t */\n\tget annotations(): Annotation[] {\n\t\tif (this.#cache.annotations == null) {\n\t\t\tthis.#cache.annotations = globalThis.Object.values(this.annotationsById);\n\t\t}\n\n\t\treturn this.#cache.annotations;\n\t}\n\n\tget areas(): Area[] {\n\t\tif (this.#cache.areas == null) {\n\t\t\tthis.#cache.areas = globalThis.Object.values(this.areasById);\n\t\t}\n\n\t\treturn this.#cache.areas;\n\t}\n\n\t/**\n\t * Retrieves all nodes in the map.\n\t *\n\t * @returns {Annotation[]} An array of Annotation objects.\n\t */\n\tget nodes(): Node[] {\n\t\tif (this.#cache.nodes == null) {\n\t\t\tthis.#cache.nodes = globalThis.Object.values(this.nodesById);\n\t\t}\n\n\t\treturn this.#cache.nodes;\n\t}\n\tget locations(): EnterpriseLocation[] {\n\t\tif (this.#cache.locations == null) {\n\t\t\tthis.#cache.locations = globalThis.Object.values(this.locationsById);\n\t\t}\n\n\t\treturn globalThis.Object.values(this.locationsById);\n\t}\n\n\tget categories(): EnterpriseCategory[] {\n\t\tif (this.#cache.categories == null) {\n\t\t\tthis.#cache.categories = globalThis.Object.values(this.categoriesById);\n\t\t}\n\n\t\treturn globalThis.Object.values(this.categoriesById);\n\t}\n\n\tget locationProfiles(): LocationProfile[] {\n\t\tif (this.#cache.locationProfiles == null) {\n\t\t\tthis.#cache.locationProfiles = globalThis.Object.values(this.locationProfilesById);\n\t\t}\n\n\t\treturn this.#cache.locationProfiles;\n\t}\n\n\tget locationCategories(): LocationCategory[] {\n\t\tif (this.#cache.locationCategories == null) {\n\t\t\tthis.#cache.locationCategories = globalThis.Object.values(this.locationCategoriesById);\n\t\t}\n\n\t\treturn this.#cache.locationCategories;\n\t}\n\n\tget mvfFloors(): MVFFloor[] {\n\t\tif (this.#cache.mvfFloors == null) {\n\t\t\tthis.#cache.mvfFloors = globalThis.Object.values(this.mvfFloorsById);\n\t\t}\n\n\t\treturn this.#cache.mvfFloors;\n\t}\n\n\tget mvfFloorStacks(): MVFFloorStack[] {\n\t\tif (this.#cache.mvfFloorStacks == null) {\n\t\t\tthis.#cache.mvfFloorStacks = globalThis.Object.values(this.mvfFloorStacksById);\n\t\t}\n\n\t\treturn this.#cache.mvfFloorStacks;\n\t}\n\n\tgetByType(type: string): object[];\n\tgetByType(type: 'location-profile'): LocationProfile[];\n\tgetByType(type: 'location-category'): LocationCategory[];\n\tgetByType(type: 'space'): Space[];\n\tgetByType(type: 'area'): Area[];\n\tgetByType(type: 'door'): Door[];\n\tgetByType(type: 'floor'): Floor[];\n\tgetByType(type: 'floor-stack'): FloorStack[];\n\tgetByType(type: 'connection'): Connection[];\n\tgetByType(type: 'object'): MapObject[];\n\tgetByType(type: 'point-of-interest'): PointOfInterest[];\n\tgetByType(type: 'annotation'): Annotation[];\n\tgetByType(type: 'node'): Node[];\n\tgetByType(type: 'enterprise-location'): EnterpriseLocation[];\n\tgetByType(type: 'enterprise-category'): EnterpriseCategory[];\n\tgetByType(type: 'enterprise-venue'): EnterpriseVenue | undefined;\n\tgetByType(type: 'facade'): Facade[];\n\tgetByType(type: string): object[] | object | undefined {\n\t\tswitch (type) {\n\t\t\tcase 'location-profile':\n\t\t\t\treturn this.locationProfiles;\n\t\t\tcase 'location-category':\n\t\t\t\treturn this.locationCategories;\n\t\t\tcase 'area':\n\t\t\t\treturn this.areas;\n\t\t\tcase 'node':\n\t\t\t\treturn this.nodes;\n\t\t\tcase 'space':\n\t\t\t\treturn this.spaces;\n\t\t\tcase 'door':\n\t\t\t\treturn this.doors;\n\t\t\tcase 'floor':\n\t\t\t\treturn this.floors;\n\t\t\tcase 'floor-stack':\n\t\t\t\treturn this.floorStacks;\n\t\t\tcase 'connection':\n\t\t\t\treturn this.connections;\n\t\t\tcase 'object':\n\t\t\t\treturn this.objects;\n\t\t\tcase 'point-of-interest':\n\t\t\t\treturn this.pointsOfInterest;\n\t\t\tcase 'annotation':\n\t\t\t\treturn this.annotations;\n\t\t\tcase 'enterprise-location':\n\t\t\t\treturn this.locations;\n\t\t\tcase 'enterprise-category':\n\t\t\t\treturn this.categories;\n\t\t\tcase 'enterprise-venue':\n\t\t\t\treturn this.venue;\n\t\t\tcase 'facade':\n\t\t\t\treturn this.facades;\n\t\t\tdefault:\n\t\t\t\treturn [];\n\t\t}\n\t}\n\n\t/**\n\t * Retrieves an object by its type and ID.\n\t *\n\t * @param type The type of the object (e.g., 'space', 'door').\n\t * @param id The ID of the object.\n\t * @returns The requested object, or undefined if not found.\n\t */\n\tgetById<T extends keyof Omit<TMapDataObjectTypes, 'enterprise-venue'> | 'unknown'>(\n\t\ttype: T,\n\t\tid: string,\n\t):\n\t\t| (T extends keyof TMapDataObjectTypes ? TMapDataObjectTypes[T] : TMapDataObjectTypes[keyof TMapDataObjectTypes])\n\t\t| undefined;\n\tgetById<T extends keyof Omit<TMapDataObjectTypes, 'enterprise-venue'>>(\n\t\ttype: T,\n\t\tid: string,\n\t): TMapDataObjectTypes[T] | undefined;\n\tgetById<T extends keyof Omit<TMapDataObjectTypes, 'enterprise-venue'> | 'unknown'>(\n\t\ttype: 'unknown',\n\t\tid: string,\n\t):\n\t\t| (T extends keyof TMapDataObjectTypes ? TMapDataObjectTypes[T] : TMapDataObjectTypes[keyof TMapDataObjectTypes])\n\t\t| undefined;\n\tgetById<T extends keyof Omit<TMapDataObjectTypes, 'enterprise-venue'> | 'unknown'>(\n\t\ttype: T,\n\t\tid: string,\n\t):\n\t\t| (T extends keyof TMapDataObjectTypes ? TMapDataObjectTypes[T] : TMapDataObjectTypes[keyof TMapDataObjectTypes])\n\t\t| undefined {\n\t\tconst collections = {\n\t\t\t'location-profile': this.locationProfilesById,\n\t\t\t'location-category': this.locationCategoriesById,\n\t\t\tspace: this.spacesById,\n\t\t\tfloor: this.floorsById,\n\t\t\t'floor-stack': this.floorStacksById,\n\t\t\tfacade: this.facadesById,\n\t\t\tnode: this.nodesById,\n\t\t\tdoor: this.doorsById,\n\t\t\tconnection: this.connectionsById,\n\t\t\t'mvf-connection': (id: string) => this.#getConnectionFromMVFConnection(this.mvfConnectionsById[id]),\n\t\t\tobject: this.objectsById,\n\t\t\t'point-of-interest': this.pointsOfInterestById,\n\t\t\tannotation: this.annotationsById,\n\t\t\tarea: this.areasById,\n\t\t\t'enterprise-location': this.locationsById,\n\t\t\t'enterprise-category': this.categoriesById,\n\t\t};\n\n\t\tconst getItemFromCollection = (\n\t\t\ttype: keyof typeof collections,\n\t\t): TMapDataObjectTypes[keyof TMapDataObjectTypes] | undefined => {\n\t\t\tconst collection = collections[type];\n\t\t\tif (collection == null) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tif (typeof collection === 'function') {\n\t\t\t\treturn collection(id);\n\t\t\t}\n\t\t\treturn collection[id];\n\t\t};\n\n\t\tconst getItemFromAllCollections = (): ReturnType<typeof getItemFromCollection> | undefined => {\n\t\t\tfor (const collection of Object.keys(collections) as (keyof typeof collections)[]) {\n\t\t\t\tconst item = getItemFromCollection(collection);\n\t\t\t\tif (item != null) {\n\t\t\t\t\treturn item;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (type === 'unknown') {\n\t\t\treturn getItemFromAllCollections() as T extends keyof TMapDataObjectTypes\n\t\t\t\t? TMapDataObjectTypes[T]\n\t\t\t\t: TMapDataObjectTypes[keyof TMapDataObjectTypes];\n\t\t}\n\n\t\treturn getItemFromCollection(type) as T extends keyof TMapDataObjectTypes\n\t\t\t? TMapDataObjectTypes[T]\n\t\t\t: TMapDataObjectTypes[keyof TMapDataObjectTypes];\n\t}\n\n\tgetByExternalId<T extends keyof Omit<TMapDataObjectTypes, 'annotation' | 'facade'>>(\n\t\ttype: T,\n\t\texternalId: string,\n\t): TMapDataObjectTypes[T][];\n\tgetByExternalId(\n\t\ttype: keyof TMapDataObjectTypes,\n\t\texternalId: string,\n\t): TMapDataObjectTypes[keyof TMapDataObjectTypes][] {\n\t\tswitch (type) {\n\t\t\tcase 'location-profile':\n\t\t\t\treturn this.locationProfilesByExternalId[externalId] ?? [];\n\t\t\tcase 'location-category':\n\t\t\t\treturn [];\n\t\t\tcase 'space':\n\t\t\t\treturn this.spacesByExternalId[externalId] ?? [];\n\t\t\tcase 'floor':\n\t\t\t\treturn this.floorsByExternalId[externalId] ?? [];\n\t\t\tcase 'floor-stack':\n\t\t\t\treturn this.floorStacksByExternalId[externalId] ?? [];\n\t\t\tcase 'node':\n\t\t\t\treturn this.nodesByExternalId[externalId] ?? [];\n\t\t\tcase 'door':\n\t\t\t\treturn this.doorsByExternalId[externalId] ?? [];\n\t\t\tcase 'connection':\n\t\t\t\treturn this.connectionsByExternalId[externalId] ?? [];\n\t\t\tcase 'object':\n\t\t\t\treturn this.objectsByExternalId[externalId] ?? [];\n\t\t\tcase 'point-of-interest':\n\t\t\t\treturn this.poisByExternalId[externalId] ?? [];\n\t\t\tcase 'area':\n\t\t\t\treturn this.areasByExternalId[externalId] ?? [];\n\t\t\tcase 'enterprise-location':\n\t\t\t\treturn this.locationsByExternalId[externalId] ?? [];\n\t\t\tcase 'enterprise-category':\n\t\t\t\treturn this.categoriesByExternalId[externalId] ?? [];\n\t\t\tdefault:\n\t\t\t\treturn [];\n\t\t}\n\t}\n\n\tgetMapDataById(id: string): MapDataElements | undefined {\n\t\treturn (\n\t\t\tthis.spacesById[id] ??\n\t\t\tthis.floorsById[id] ??\n\t\t\tthis.floorStacksById[id] ??\n\t\t\tthis.facadesById[id] ??\n\t\t\tthis.nodesById[id] ??\n\t\t\tthis.doorsById[id] ??\n\t\t\tthis.connectionsById[id] ??\n\t\t\tthis.objectsById[id] ??\n\t\t\tthis.pointsOfInterestById[id] ??\n\t\t\tthis.annotationsById[id] ??\n\t\t\tthis.areasById[id]\n\t\t);\n\t}\n\n\t/**\n\t * Retrieves a feature by its type and ID from the Mappedin Venue Format (MVF) data.\n\t *\n\t * @param type The type of the feature (e.g., 'space', 'node').\n\t * @param id The ID of the feature.\n\t * @returns The requested MVF feature or undefined if not found.\n\t */\n\tgetMVFFeatureById(type: 'space', id: string): SpaceCollection['features'][number] | undefined;\n\tgetMVFFeatureById(type: 'node', id: string): NodeCollection['features'][number] | undefined;\n\tgetMVFFeatureById(type: 'obstruction', id: string): ObstructionCollection['features'][number] | undefined;\n\tgetMVFFeatureById(type: 'floor', id: string): MVFFloor | undefined;\n\tgetMVFFeatureById(type: 'floor-stack', id: string): MVFFloorStack | undefined;\n\tgetMVFFeatureById(type: 'connection', id: string): MVFConnection | undefined;\n\tgetMVFFeatureById(type: 'entrance', id: string): EntranceCollection['features'][number] | undefined;\n\tgetMVFFeatureById(type: 'annotation', id: string): AnnotationCollection['features'][number] | undefined;\n\tgetMVFFeatureById(type: 'area', id: string): AreaCollection['features'][number] | undefined;\n\tgetMVFFeatureById(type: string, id: string): object | undefined;\n\tgetMVFFeatureById(type, id): object | undefined {\n\t\tswitch (type) {\n\t\t\tcase 'space':\n\t\t\t\treturn this.mvfSpacesById[id];\n\t\t\tcase 'node':\n\t\t\t\treturn this.mvfNodesById[id];\n\t\t\tcase 'obstruction':\n\t\t\t\treturn this.mvfObstructionById[id];\n\t\t\tcase 'floor':\n\t\t\t\treturn this.mvfFloorsById[id];\n\t\t\tcase 'floor-stack':\n\t\t\t\treturn this.mvfFloorStacksById[id];\n\t\t\tcase 'connection':\n\t\t\t\treturn this.mvfConnectionsById[id];\n\t\t\tcase 'entrance':\n\t\t\t\treturn this.mvfEntrancesById[id];\n\t\t\tcase 'annotation':\n\t\t\t\treturn this.mvfAnnotationsById[id];\n\t\t\tcase 'area':\n\t\t\t\treturn this.mvfAreasById[id];\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unknown MVF feature type: ${type}`);\n\t\t}\n\t}\n\n\tgetMVFFeatureByNodeId(type: 'connection', id: string): MVFConnection | undefined;\n\tgetMVFFeatureByNodeId(type, id): object | undefined {\n\t\tswitch (type) {\n\t\t\tcase 'connection':\n\t\t\t\treturn this.mvfConnectionsByNodeId[id];\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unsupported MVF feature type: ${type}`);\n\t\t}\n\t}\n\n\t/**\n\t * Retrieves all MVF features of a given type. Safer than referencing the mvf's deprecated collections directly.\n\t */\n\tgetMVFFeatureByType(type: 'floor-stack'): MVFFloorStack[];\n\tgetMVFFeatureByType(type: 'floor'): MVFFloor[];\n\tgetMVFFeatureByType(type: string): object[] {\n\t\tswitch (type) {\n\t\t\tcase 'floor-stack':\n\t\t\t\treturn this.mvfFloorStacks;\n\t\t\tcase 'floor':\n\t\t\t\treturn this.mvfFloors;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unsupported MVF feature type: ${type}`);\n\t\t}\n\t}\n\n\tpropTranslationCache: Map<number, Record<string, unknown>> = new Map();\n\n\tgetPropTranslation<\n\t\tT extends keyof LanguagePackRecords,\n\t\tP extends keyof NonNullable<NonNullable<LanguagePackRecords[T]>[string]>,\n\t>(type: T, prop: P, id: string, fallback: NonNullable<NonNullable<LanguagePackRecords[T]>[string]>[P]) {\n\t\tif (!this.currentLanguage) {\n\t\t\treturn fallback;\n\t\t}\n\n\t\tconst { code } = this.currentLanguage;\n\n\t\tconst collection = this.languagePacks[code]?.optimized?.[type];\n\t\tif (collection) {\n\t\t\tconst item = collection[id];\n\t\t\t// only if the value is undefined do we want to fallback\n\t\t\t// as null can be a valid translated value\n\t\t\tif (item != null && item[prop as keyof typeof item] !== undefined) {\n\t\t\t\tconst translated = item[prop as keyof typeof item] as unknown;\n\t\t\t\tif (translated != null && typeof translated === 'object') {\n\t\t\t\t\tif (typeof fallback === 'object' && typeof translated === 'object' && !Array.isArray(translated)) {\n\t\t\t\t\t\tconst cacheKey = cyrb53(code + type + id + prop.toString());\n\t\t\t\t\t\t// only in this case do we want to cache the result, so that if developers are looping through the getter\n\t\t\t\t\t\t// we're not creating and spreading objects and slamming the GC\n\t\t\t\t\t\t// these will be released once mapData is released, so a map should suffice\n\t\t\t\t\t\tif (this.propTranslationCache.has(cacheKey)) {\n\t\t\t\t\t\t\treturn this.propTranslationCache.get(cacheKey);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// deep merge any objects\n\t\t\t\t\t\tconst result = deepMergeOn(fallback as object, translated as object, ['id']);\n\t\t\t\t\t\tthis.propTranslationCache.set(cacheKey, result as Record<string, unknown>);\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn translated;\n\t\t\t\t}\n\t\t\t\treturn translated;\n\t\t\t}\n\t\t}\n\n\t\treturn fallback;\n\t}\n\n\tfindPreferredLanguage(options?: TFindPreferredLanguageInVenueOptions) {\n\t\tif (!this.venue) return;\n\n\t\tconst preferredLanguage = findPreferredLanguageInVenue(this.venue, options);\n\n\t\tif (options?.languageCode != null && options.languageCode.toLowerCase() !== preferredLanguage.code.toLowerCase()) {\n\t\t\tLogger.warn(\n\t\t\t\t`Language code \"${options.languageCode}\" could not be found in the venue. Using \"${preferredLanguage.code}\" instead.`,\n\t\t\t);\n\t\t}\n\n\t\treturn preferredLanguage;\n\t}\n\n\t#abortChangeLanguageControl?: AbortController;\n\n\t/**\n\t * Changes the language of the map data.\n\t *\n\t * @param languageCode The language code to change to.\n\t * @param preferred Whether to fallback to the preferred language in the venue.\n\t */\n\tasync changeLanguage(languageCode: string) {\n\t\tconst update = languageCode.toLowerCase();\n\t\tif (!update) {\n\t\t\tLogger.error('Language code must be defined.');\n\n\t\t\treturn;\n\t\t}\n\t\tif (!this.currentLanguage || !this.venue) {\n\t\t\tLogger.error('Changing the language is not supported for this map.');\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentLanguageCode = this.currentLanguage.code;\n\t\tconst targetlanguage = this.venue?.languages.find(({ code }) => code.toLowerCase() === update.toLowerCase());\n\n\t\tif (!targetlanguage) {\n\t\t\tLogger.warn(`Language code \"${update}\" could not be found in the venue.`);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (currentLanguageCode === targetlanguage.code) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet languagePack = this.languagePacks[targetlanguage.code];\n\t\tif (!languagePack) {\n\t\t\tconst localePackUrl = this.localePacksUrls[targetlanguage.code];\n\n\t\t\tif (!localePackUrl) {\n\t\t\t\tLogger.error(`Locale pack URL not found for language code \"${targetlanguage.code}\".`);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.#abortChangeLanguageControl) {\n\t\t\t\tthis.#abortChangeLanguageControl.abort();\n\t\t\t}\n\t\t\tconst controller = new AbortController();\n\t\t\tthis.#abortChangeLanguageControl = controller;\n\t\t\tlet downloaded: ParsedMVFLocalePack | undefined;\n\t\t\ttry {\n\t\t\t\tdownloaded = await downloadLanguagePack(localePackUrl, { signal: controller.signal });\n\t\t\t} catch (e) {\n\t\t\t\tLogger.error(`Failed to download language pack for language code \"${targetlanguage.code}\".`, e);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!downloaded || controller.signal.aborted) return;\n\n\t\t\tlanguagePack = parseLocalePackToLanguagePack(downloaded);\n\n\t\t\tthis.languagePacks[targetlanguage.code] = languagePack;\n\t\t}\n\n\t\tthis.Analytics.sendChangeLanguageEvent({ fromLanguage: this.currentLanguage.code });\n\t\tthis.currentLanguage = targetlanguage;\n\t\tthis.publish('language-change', this.currentLanguage);\n\t}\n\n\t/**\n\t * @deprecated Use the async version instead. This method will be made truly async in the upcoming future.\n\t * @internal\n\t */\n\t__LEGACY_GET_DIRECTIONS_MULTI_DESTINATION_SYNC = (\n\t\tfrom: TNavigationTarget | TNavigationTarget[],\n\t\tto: TNavigationTarget | (TNavigationTarget | TNavigationTarget[])[],\n\t\topt?: TGetDirectionsOptions,\n\t): Directions | Directions[] | undefined => {\n\t\treturn this.__LEGACY_GET_DIRECTIONS_SYNC(from, to, { ...opt, multiDestination: true });\n\t};\n\n\t/**\n\t * @internal\n\t */\n\t__LEGACY_GET_DIRECTIONS_SYNC = (\n\t\tfrom: TNavigationTarget | TNavigationTarget[],\n\t\tto: TNavigationTarget | (TNavigationTarget | TNavigationTarget[])[],\n\t\topt?: TGetDirectionsOptions & { multiDestination?: boolean },\n\t): Directions | Directions[] | undefined => {\n\t\tconst { accessible = false, multiDestination = false } = opt || {};\n\n\t\tconst smoothingConfig = getSmoothingConfig(this.enterpriseMode, opt);\n\t\tconst zones = opt?.zones || [];\n\t\tconst options = {\n\t\t\taccessible,\n\t\t\tzones,\n\t\t\tsmoothing: smoothingConfig,\n\t\t\texcludedConnections: opt?.excludedConnections || [],\n\t\t\tconnectionIdWeightMap: opt?.connectionIdWeightMap || {},\n\t\t};\n\n\t\tif (multiDestination && Array.isArray(to)) {\n\t\t\tlet fromArray = Array.isArray(from) ? from : [from];\n\t\t\tconst result: Directions[] = [];\n\n\t\t\tfor (const destination of to) {\n\t\t\t\tconst toArray = Array.isArray(destination) ? destination : [destination];\n\t\t\t\tconst directions = this.directions.getDirectionsSync(fromArray, toArray, options, this);\n\n\t\t\t\tif (!directions) {\n\t\t\t\t\tLogger.error('getDirections failed due to missing directions for one of the segments');\n\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tfromArray = toArray;\n\t\t\t\tresult.push(directions);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t} else {\n\t\t\tconst fromArray = Array.isArray(from) ? from : [from];\n\t\t\tlet toArray = Array.isArray(to) ? to : [to];\n\n\t\t\tif (Array.isArray(toArray[0])) {\n\t\t\t\tLogger.error('getDirections does not support multi-destination without multisegment option');\n\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tif (fromArray[0].id && toArray[0].id) {\n\t\t\t\tthis.Analytics.sendGetDirectionsEvent(fromArray[0].id, toArray[0].id, accessible);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\treturn this.directions.getDirectionsSync(fromArray, toArray as TNavigationTarget[], options, this);\n\t\t\t} catch (e) {\n\t\t\t\tLogger.error('Unable to get directions', e);\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}\n\t};\n\n\tgetDirections = async (\n\t\tfrom: TNavigationTarget | TNavigationTarget[],\n\t\tto: TNavigationTarget | TNavigationTarget[],\n\t\topt?: TGetDirectionsOptions,\n\t): Promise<Directions | undefined> => {\n\t\tconst { accessible = false } = opt || {};\n\n\t\tconst smoothingConfig = getSmoothingConfig(this.enterpriseMode, opt);\n\t\tconst zones = opt?.zones || [];\n\t\tconst options = {\n\t\t\taccessible,\n\t\t\tzones,\n\t\t\tsmoothing: smoothingConfig,\n\t\t\texcludedConnections: opt?.excludedConnections || [],\n\t\t\tconnectionIdWeightMap: opt?.connectionIdWeightMap || {},\n\t\t};\n\n\t\tconst fromArray = Array.isArray(from) ? from : [from];\n\t\tlet toArray = Array.isArray(to) ? to : [to];\n\n\t\tif (Array.isArray(toArray[0])) {\n\t\t\tLogger.error('getDirections does not support multi-destination without multisegment option');\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (fromArray[0].id && toArray[0].id) {\n\t\t\tthis.Analytics.sendGetDirectionsEvent(fromArray[0].id, toArray[0].id, accessible);\n\t\t}\n\n\t\ttry {\n\t\t\treturn this.directions.getDirections(fromArray, toArray as TNavigationTarget[], options, this);\n\t\t} catch (e) {\n\t\t\tLogger.error('Unable to get directions', e);\n\t\t\treturn undefined;\n\t\t}\n\t};\n\n\tgetDirectionsMultiDestination = async (\n\t\tfrom: TNavigationTarget | TNavigationTarget[],\n\t\tto: TNavigationTarget | (TNavigationTarget | TNavigationTarget[])[],\n\t\topt?: TGetDirectionsOptions,\n\t): Promise<Directions[] | undefined> => {\n\t\treturn Promise.resolve(\n\t\t\tthis.__LEGACY_GET_DIRECTIONS_MULTI_DESTINATION_SYNC(from, to, opt) as Directions[] | undefined,\n\t\t);\n\t};\n\n\tgetDistance(\n\t\tfrom: Space | Door | Coordinate | MapObject | PointOfInterest | Annotation | Node | EnterpriseLocation | Area,\n\t\tto: Space | Door | Coordinate | MapObject | PointOfInterest | Annotation | Node | EnterpriseLocation | Area,\n\t) {\n\t\tconst fromCoord = getCoordinateFromStuffs(from)!;\n\t\tconst toCoord = getCoordinateFromStuffs(to)!;\n\n\t\treturn equirectangularDistance([fromCoord.longitude, fromCoord.latitude], [toCoord.longitude, toCoord.latitude]);\n\t}\n\n\ttransformImageRequest = async (url: string) => {\n\t\tif (this.enterpriseMode || !this.getMapDataOptions) {\n\t\t\treturn { url };\n\t\t}\n\n\t\tif (!isMappedinCdnUrl(url)) {\n\t\t\treturn { url };\n\t\t}\n\n\t\tif (hasSasToken(url)) {\n\t\t\treturn { url };\n\t\t}\n\n\t\tconst parsed = parseCdnAssetUrl(url);\n\t\tif (!parsed) {\n\t\t\treturn { url };\n\t\t}\n\n\t\ttry {\n\t\t\tconst sasTokens = await this.tokenManager?.getSasTokensAsync();\n\t\t\tconst sasToken = sasTokens?.[parsed.mapId];\n\t\t\tif (sasToken == null) {\n\t\t\t\tthrow new Error('SAS token not found');\n\t\t\t}\n\n\t\t\tconst [baseUrl] = url.split('?');\n\t\t\tconst urlWithToken = `${baseUrl}?${sasToken.token}`;\n\n\t\t\treturn {\n\t\t\t\turl: urlWithToken,\n\t\t\t};\n\t\t} catch (e) {\n\t\t\tLogger.error('Failed to append SAS token to image request. Requests for private images may fail.', e);\n\n\t\t\treturn { url };\n\t\t}\n\t};\n\n\tasync toJSONBundle({\n\t\tdownloadLanguagePacks = true,\n\t}: { downloadLanguagePacks?: boolean } = {}): Promise<THydrateMapDataBundle> {\n\t\tconst languagePacks: {\n\t\t\tlanguage: { code: string; name: string };\n\t\t\tlocalePack: ParsedMVFLocalePack;\n\t\t}[] = [];\n\n\t\tif (downloadLanguagePacks && this.enterpriseMode) {\n\t\t\tconst controller = new AbortController();\n\t\t\tfor (const language of this.venue?.languages || []) {\n\t\t\t\ttry {\n\t\t\t\t\tif (this.localePacksUrls[language.code]) {\n\t\t\t\t\t\tconst localePack = await getLanguagePackUnitArray(this.localePacksUrls[language.code], {\n\t\t\t\t\t\t\tsignal: controller.signal,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tconst parsedLocalePack = await parseLanguagePack(localePack);\n\n\t\t\t\t\t\tif (parsedLocalePack) {\n\t\t\t\t\t\t\tlanguagePacks.push({\n\t\t\t\t\t\t\t\tlanguage: { code: language.code, name: language.name },\n\t\t\t\t\t\t\t\tlocalePack: parsedLocalePack,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tLogger.warn('failed downloading language pack', e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\ttype: 'json',\n\t\t\toptions: {\n\t\t\t\tenterprise: this.enterpriseMode,\n\t\t\t},\n\t\t\tlanguagePacks,\n\t\t\tmain: this.mvf,\n\t\t};\n\t}\n\n\tasync toBinaryBundle({\n\t\tdownloadLanguagePacks = true,\n\t}: { downloadLanguagePacks?: boolean } = {}): Promise<THydrateMapDataBundle | void> {\n\t\tif (!this.binaryBundle) {\n\t\t\tLogger.error('binary bundle not found');\n\n\t\t\treturn;\n\t\t}\n\t\tconst languagePacks: {\n\t\t\tlanguage: { code: string; name: string };\n\t\t\tlocalePack: Uint8Array;\n\t\t}[] = [];\n\n\t\tif (downloadLanguagePacks && this.enterpriseMode) {\n\t\t\tconst controller = new AbortController();\n\t\t\tfor (const language of this.venue?.languages || []) {\n\t\t\t\ttry {\n\t\t\t\t\tif (this.localePacksUrls[language.code]) {\n\t\t\t\t\t\tconst localePack = await getLanguagePackUnitArray(this.localePacksUrls[language.code], {\n\t\t\t\t\t\t\tsignal: controller.signal,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (localePack) {\n\t\t\t\t\t\t\tlanguagePacks.push({\n\t\t\t\t\t\t\t\tlanguage: { code: language.code, name: language.name },\n\t\t\t\t\t\t\t\tlocalePack,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tLogger.warn('failed downloading language pack', e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\ttype: 'binary',\n\t\t\toptions: {\n\t\t\t\tenterprise: this.enterpriseMode,\n\t\t\t},\n\t\t\tlanguagePacks,\n\t\t\tmain: this.binaryBundle!,\n\t\t};\n\t}\n\n\t/**\n\t * Cleans up resources used by the instance.\n\t *\n\t * @internal\n\t */\n\tdestroy() {\n\t\tfor (const key of globalThis.Object.keys(this.#cache)) {\n\t\t\t// @ts-ignore\n\t\t\tthis.#cache[key] = null;\n\t\t}\n\t\tthis.propTranslationCache.clear();\n\t}\n}\n\nexport {\n\tNode,\n\tArea,\n\tMapDataInternal,\n\tSpace,\n\tFloor,\n\tFloorStack,\n\tFacade,\n\tConnection,\n\tMapObject,\n\tDoor,\n\tCoordinate,\n\tPointOfInterest,\n\tAnnotation,\n\tHyperlink,\n\tImageMetaData,\n\tEnterpriseLocation,\n\tEnterpriseCategory,\n\tEnterpriseVenue,\n\tLocationCategory,\n\tLocationProfile,\n};\nexport type { OpeningHours } from './opening-hours';\nexport type { TSpaceType } from './space';\nexport type { Places };\n\n/**\n * Determines smoothing configuration based on enterprise mode and user input\n * @internal\n */\nexport const getSmoothingConfig = (\n\tenterpriseMode: boolean,\n\topt?: TGetDirectionsOptions,\n): { enabled: boolean; radius: number } => {\n\t// Determine default smoothing based on enterprise mode\n\tconst defaultSmoothingEnabled = !enterpriseMode; // false for enterprise, true for non-enterprise\n\tconst smoothing = opt?.smoothing;\n\n\t// Check if user explicitly provided smoothing option\n\tconst userProvidedSmoothing = smoothing != null;\n\n\t// Use user-provided smoothing or enterprise-aware default\n\tconst smoothingEnabled = userProvidedSmoothing\n\t\t? typeof smoothing === 'object'\n\t\t\t? smoothing.enabled ?? defaultSmoothingEnabled // if smoothing is not specified in the options, we fallback to default\n\t\t\t: smoothing\n\t\t: defaultSmoothingEnabled; // if user do not provide smoothing option, we fallback to default\n\n\tconst smoothingRadius = typeof smoothing === 'object' ? smoothing.radius : undefined;\n\n\treturn {\n\t\tenabled: smoothingEnabled,\n\t\tradius: smoothingRadius ?? 0.75,\n\t};\n};\n", "import type Coordinate from './coordinate';\nimport type { EnterpriseLocation, MapDataInternal, MapObject, Space } from '.';\nimport type Floor from './floor';\nimport BaseMetaData from './base-metadata-object';\nimport type { IGeoJSONData, MVFNodeFeature } from './types';\nimport type { IAnchorable, IFocusable } from '../types';\nimport { getCenterCoordinate, hasFlag } from './utils';\nimport type { Writable } from 'type-fest';\n\n/**\n * A class representing {@link Path} node data within the map.\n *\n * Nodes are used to define points in the map's pathfinding graph.\n *\n */\nclass Node extends BaseMetaData implements IGeoJSONData, IFocusable, IAnchorable {\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'node';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = Node.__type;\n\n\t#data: MapDataInternal;\n\t#cache: Partial<Writable<Node>> = {};\n\t#floorId: string;\n\t#mvfData: MVFNodeFeature;\n\n\t/**\n\t * Checks if the provided instance is of type Node.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a Node, false otherwise.\n\t */\n\tstatic is(instance: object): instance is Node {\n\t\treturn (instance as { __type: string }).__type === Node.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(\n\t\tdata: MapDataInternal,\n\t\toptions: {\n\t\t\tfloorId: string;\n\t\t\tmvfData: MVFNodeFeature;\n\t\t},\n\t) {\n\t\tsuper(options.mvfData.properties.id);\n\t\tthis.#data = data;\n\t\tthis.#floorId = options.floorId;\n\t\tthis.#mvfData = options.mvfData;\n\t}\n\n\t/** @internal */\n\tget locations(): EnterpriseLocation[] {\n\t\tif (this.#cache.locations) {\n\t\t\treturn this.#cache.locations;\n\t\t}\n\n\t\tthis.#cache.locations = (this.#data.locationIdsByNodeId[this.id] || [])\n\t\t\t.map(id => this.#data.getById('enterprise-location', id))\n\t\t\t.filter(Boolean) as EnterpriseLocation[];\n\n\t\treturn this.#cache.locations;\n\t}\n\n\t/**\n\t * Gets the {@link Space} object associated with the node.\n\t */\n\tget space(): Space | undefined {\n\t\treturn this.#data.getById('space', this.#data.spaceIdsByNodeId[this.id]?.[0]);\n\t}\n\n\t/**\n\t * Gets the {@link MapObject} object associated with the node.\n\t */\n\tget object(): MapObject | undefined {\n\t\treturn this.#data.getById('object', this.#data.objectIdsByNodeId[this.id]?.[0]);\n\t}\n\n\t/**\n\t * Gets the {@link Floor} associated with the node.\n\t *\n\t * @returns {Floor} The floor object.\n\t * @throws Will throw an error if the floor is not found.\n\t */\n\tget floor(): Floor {\n\t\tconst _floor = this.#data.getById('floor', this.#floorId);\n\t\tif (_floor == null) {\n\t\t\tthrow new Error(`Floor ${this.#floorId} not found!`);\n\t\t}\n\n\t\treturn _floor;\n\t}\n\n\t/**\n\t * Gets the {@link Coordinate} of the node.\n\t *\n\t * @returns {Coordinate} The node's coordinate.\n\t */\n\tget coordinate(): Coordinate {\n\t\tif (this.#cache.coordinate == null) {\n\t\t\tthis.#cache.coordinate = getCenterCoordinate(this.#mvfData, this.#floorId);\n\t\t}\n\n\t\treturn this.#cache.coordinate;\n\t}\n\n\t/**\n\t * Gets the external ID of the node.\n\t *\n\t * @returns {string} The external ID of the node.\n\t */\n\tget externalId(): string {\n\t\treturn this.#mvfData.properties.externalId ?? '';\n\t}\n\n\t/**\n\t * Gets the neighboring nodes of this node.\n\t *\n\t * @returns {Node[]} An array of neighboring Node objects.\n\t */\n\tget neighbors(): Node[] {\n\t\tif (this.#cache.neighbors == null) {\n\t\t\tconst _neighbours = this.#mvfData.properties.neighbors.map(neighbor => {\n\t\t\t\tconst _node = this.#data.getById('node', neighbor.id);\n\t\t\t\tif (_node == null) {\n\t\t\t\t\tthrow new Error(`Node ${neighbor.id} not found!`);\n\t\t\t\t}\n\n\t\t\t\treturn _node;\n\t\t\t});\n\t\t\tthis.#cache.neighbors = _neighbours;\n\t\t}\n\n\t\treturn this.#cache.neighbors;\n\t}\n\n\t/**\n\t * Gets the navigation flags of the node.\n\t *\n\t * Navigation flags are string identifiers that describe properties of this node for navigation,\n\t * such as `accessible` for wheelchair accessibility or `outdoors` for outdoor routes.\n\t *\n\t * @returns {string[]} An array of navigation flags present on this node.\n\t */\n\tget navigationFlags(): readonly string[] {\n\t\tif (this.#cache.navigationFlags == null) {\n\t\t\tconst flags: string[] = [];\n\n\t\t\tconst flagsArray = this.#mvfData.properties.flags;\n\t\t\tif (flagsArray != null && flagsArray.length > 0) {\n\t\t\t\tfor (const [flagName, flagDeclaration] of Object.entries(this.#data.navigationFlags)) {\n\t\t\t\t\tif (flagsArray.length > flagDeclaration.index && flagsArray[flagDeclaration.index] != null) {\n\t\t\t\t\t\tif (hasFlag({ flags: flagsArray }, flagDeclaration)) {\n\t\t\t\t\t\t\tflags.push(flagName);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.#cache.navigationFlags = Object.freeze(flags);\n\t\t}\n\n\t\treturn this.#cache.navigationFlags;\n\t}\n\n\t/**\n\t * Gets the underlying GeoJSON Feature representation of this Node.\n\t */\n\tget geoJSON() {\n\t\treturn { ...this.#mvfData, properties: null };\n\t}\n\n\t/** @internal */\n\tget focusTarget() {\n\t\treturn this.coordinate;\n\t}\n\n\t/** @internal */\n\tget anchorTarget() {\n\t\treturn this.coordinate;\n\t}\n\n\t/**\n\t * Serializes the node data to JSON.\n\t *\n\t * @returns An object representing the node.\n\t */\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: Node.__type,\n\t\t\tid: this.id,\n\t\t\tfloor: this.floor.id,\n\t\t\tcoordinate: this.coordinate.toJSON(),\n\t\t\tneighbors: this.neighbors.map(neighbor => neighbor.id),\n\t\t};\n\t}\n\n\t/**\n\t * Cleans up resources used by the instance.\n\t *\n\t * @internal\n\t */\n\tdestroy() {\n\t\tfor (const key of Object.keys(this.#cache)) {\n\t\t\tdelete this.#cache[key];\n\t\t}\n\t}\n}\n\nexport default Node;\n", "export default abstract class BaseMetaData {\n\t// TODO: abstract __type, is()\n\t/**\n\t * The identity of the map metadata.\n\t */\n\treadonly id: string;\n\tconstructor(id: string) {\n\t\tthis.id = id;\n\t}\n}\n", "import type {\n\tFeature,\n\tFlags,\n\tNavigationFlagDeclaration,\n\tObstructionProperties,\n\tParsedMVFLocalePack,\n\tPoint,\n\tPolygon,\n\tSpaceProperties,\n} from '@mappedin/mvf-v2';\nimport type { FloorStackWithLocale, FloorWithLocale, LanguagePack, MVFFeature } from './types';\nimport Coordinate from './coordinate';\nimport turfCenter from '@turf/center';\nimport { Logger } from '@packages/internal/common';\n\nexport function parseLocalePackToLanguagePack(downloaded: ParsedMVFLocalePack): LanguagePack {\n\tconst locationsById =\n\t\tdownloaded.enterprise?.locations?.reduce((acc, cur) => {\n\t\t\tacc[cur.id] = cur;\n\n\t\t\treturn acc;\n\t\t}, {}) || {};\n\n\t// combine locations and location instances into one object for the language pack\n\tfor (const instance of downloaded.enterprise?.locationInstances || []) {\n\t\tlocationsById[instance.id] = instance;\n\t}\n\n\tconst floorStacksById: Record<string, FloorStackWithLocale> = {};\n\tfor (const floorStack of (downloaded['floorstack.json'] || []) as FloorStackWithLocale[]) {\n\t\tfloorStacksById[floorStack.id] = floorStack;\n\t}\n\n\tconst floorsById: Record<string, FloorWithLocale> = {};\n\tfor (const floor of downloaded['floor.geojson']?.features || []) {\n\t\tif (floor.properties && floor.properties.id) {\n\t\t\tfloorsById[floor.properties.id] = floor.properties;\n\t\t}\n\t}\n\n\treturn {\n\t\ttype: 'downloaded',\n\t\tdata: downloaded,\n\t\toptimized: {\n\t\t\t'enterprise-location': locationsById,\n\t\t\t'enterprise-category':\n\t\t\t\tdownloaded.enterprise?.categories?.reduce((acc, cur) => {\n\t\t\t\t\tacc[cur.id] = cur;\n\n\t\t\t\t\treturn acc;\n\t\t\t\t}, {}) || {},\n\t\t\t'floor-stack': floorStacksById,\n\t\t\tfloor: floorsById,\n\t\t},\n\t} satisfies LanguagePack;\n}\n\nexport function isMappedinCdnUrl(url: string) {\n\treturn /^https?:\\/\\/cdn\\.mappedin\\.com/.test(url);\n}\n\nexport function hasSasToken(url: string) {\n\tconst params = url.split('?')[1];\n\n\treturn Boolean(params?.includes('sv='));\n}\n\nexport function getCenterCoordinate(mvfData: MVFFeature, floorId?: Coordinate['floorId']): Coordinate {\n\tconst dataId = mvfData?.properties?.id || 'unknown';\n\n\tif (mvfData.geometry == null) {\n\t\tLogger.error(`Cannot get the center coordinate for \"${dataId}\" because it has no geometry.`);\n\n\t\treturn new Coordinate({\n\t\t\tlatitude: 0,\n\t\t\tlongitude: 0,\n\t\t\tfloorId,\n\t\t});\n\t}\n\n\ttry {\n\t\tif (mvfData.geometry.type === 'LineString') {\n\t\t\t// Since lineStrings are usually small, we can assume the earth is locally flat to find the center\n\t\t\tconst [[startLon, startLat], [endLon, endLat]] = mvfData.geometry.coordinates;\n\t\t\tconst longitude = (startLon + endLon) / 2;\n\t\t\tconst latitude = (startLat + endLat) / 2;\n\n\t\t\treturn new Coordinate({\n\t\t\t\tlatitude,\n\t\t\t\tlongitude,\n\t\t\t\tfloorId,\n\t\t\t});\n\t\t} else if (mvfData.geometry.type === 'Point') {\n\t\t\tconst [longitude, latitude] = mvfData.geometry.coordinates;\n\n\t\t\treturn new Coordinate({\n\t\t\t\tlatitude,\n\t\t\t\tlongitude,\n\t\t\t\tfloorId,\n\t\t\t});\n\t\t} else if (mvfData.geometry.type === 'Polygon') {\n\t\t\tconst polygonFeature = mvfData as Feature<Polygon, SpaceProperties | ObstructionProperties>;\n\n\t\t\tif (polygonFeature.properties.center != null) {\n\t\t\t\tconst [longitude, latitude] = polygonFeature.properties.center;\n\n\t\t\t\treturn new Coordinate({\n\t\t\t\t\tlatitude,\n\t\t\t\t\tlongitude,\n\t\t\t\t\tfloorId,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t} catch (e) {\n\t\t// do nothing, fallback to turf\n\t}\n\n\ttry {\n\t\t// Fallback: try to get the center with turf for any geometry type\n\t\tconst [longitude, latitude] = (turfCenter(mvfData) as Feature<Point, never>).geometry.coordinates;\n\n\t\treturn new Coordinate({\n\t\t\tlatitude,\n\t\t\tlongitude,\n\t\t\tfloorId,\n\t\t});\n\t} catch (e) {\n\t\tLogger.error(`Failed to get center coordinate for \"${dataId}\" ${e instanceof Error ? e.stack : ''}`);\n\n\t\treturn new Coordinate({\n\t\t\tlatitude: 0,\n\t\t\tlongitude: 0,\n\t\t\tfloorId,\n\t\t});\n\t}\n}\n\n/**\n * Checks if a flag is set in an object WithFlags.\n *\n * First find the NavigationFlagDeclaration using the key, then check\n * a flagged object with this function to see if it's present. You can\n * safely pass an undefined flag (the check will return false). This is useful when\n * trying to use a well-known flag, which may or may not be actually present in the MVF.\n *\n * @category Utils\n * @example\n * ```typescript\n * const obj: WithFlags = { flags: [1] };\n * const flag: NavigationFlagDeclaration = { index: 0, bit: 0 };\n * const hasAccessible = hasFlag(obj, flag); // true\n * ```\n *\n * @param withFlags - The WithFlags object to check\n * @param flag - The flag to check for\n * @returns true if the flag is set, false otherwise\n * @see {@link NavigationFlagDeclaration}\n * @see {@link WithFlags}\n */\nexport function hasFlag(withFlags: { flags: Flags }, flag?: NavigationFlagDeclaration) {\n\t/**\n\t * This was copied from the @mappedin/mvf-navigation-flags package.\n\t *\n\t * TODO: we should use the export from @mappedin/mvf-navigation-flags\n\t * but jest can't resolve that module and it's too much of a headache to fix right now.\n\t */\n\treturn flag && (withFlags.flags[flag.index] & (1 << flag.bit)) !== 0;\n}\n", "import { randomId } from '../../../packages/common/random-id';\nimport type { IFocusable, IAnchorable } from '../types';\n\n/**\n * Parameters for creating a Coordinate.\n */\nexport type TCoordinateParams = {\n\t/**\n\t * The latitude of the coordinate in decimal degrees.\n\t */\n\tlatitude: number;\n\t/**\n\t * The longitude of the coordinate in decimal degrees.\n\t */\n\tlongitude: number;\n\t/**\n\t * Optional ID of the floor this coordinate is on.\n\t */\n\tfloorId?: string;\n\t/**\n\t * Optional vertical offset from the floor in meters.\n\t */\n\tverticalOffset?: number;\n};\n\n/**\n * Class representing a pseudo-mercator coordinate.\n *\n * The Pseudo-Mercator projection is a type of cylindrical and conformal map projection.\n * It is identified as EPSG:3857 ({@link https://epsg.io/3857}).\n * This projection is a modified version of the traditional Mercator projection,\n * which is commonly used in marine navigation.\n */\nclass Coordinate implements IFocusable, IAnchorable {\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'coordinate';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = Coordinate.__type;\n\n\tid = randomId();\n\n\t/**\n\t * The latitude of the coordinate.\n\t * @type {number}\n\t */\n\treadonly latitude: number;\n\n\t/**\n\t * The longitude of the coordinate.\n\t * @type {number}\n\t */\n\treadonly longitude: number;\n\n\t/**\n\t * The floor ID of the coordinate.\n\t */\n\treadonly floorId?: string;\n\n\t/**\n\t * The vertical position of the coordinate, offset from the floor.\n\t */\n\treadonly verticalOffset: number;\n\n\t/**\n\t * Checks if the provided instance is of type Coordinate.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a Coordinate, false otherwise.\n\t */\n\tstatic is(instance: object): instance is Coordinate {\n\t\treturn (instance as { __type: string }).__type === Coordinate.__type;\n\t}\n\n\t/**\n\t * Creates a new Coordinate instance.\n\t *\n\t * @param latitudeOrParams Either a latitude number or a TCoordinateParams object containing coordinate details\n\t */\n\tconstructor(latitudeOrParams: TCoordinateParams);\n\t/**\n\t * @deprecated\n\t * @internal\n\t */\n\tconstructor(latitudeOrParams: number, longitude: number, floorId?: string);\n\tconstructor(latitudeOrParams: TCoordinateParams | number, longitude?: number, floorId?: string) {\n\t\tif (typeof latitudeOrParams === 'object') {\n\t\t\tthis.latitude = latitudeOrParams.latitude;\n\t\t\tthis.longitude = latitudeOrParams.longitude;\n\t\t\tthis.floorId = latitudeOrParams.floorId;\n\t\t\tthis.verticalOffset = latitudeOrParams.verticalOffset ?? 0;\n\t\t} else {\n\t\t\tif (longitude == null) {\n\t\t\t\tthrow new Error('Coordinate longitude is required.');\n\t\t\t}\n\n\t\t\tthis.latitude = latitudeOrParams;\n\t\t\tthis.longitude = longitude;\n\t\t\tthis.floorId = floorId;\n\t\t\tthis.verticalOffset = 0;\n\t\t}\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tget anchorTarget() {\n\t\treturn this;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tget focusTarget() {\n\t\treturn this;\n\t}\n\n\t/**\n\t * Checks if this coordinate is equal to another coordinate.\n\t *\n\t * @param coordinate The coordinate to compare with.\n\t * @returns {boolean} True if coordinates are equal, false otherwise.\n\t */\n\tisEqual(coordinate: Coordinate): boolean {\n\t\treturn (\n\t\t\tthis.latitude === coordinate.latitude &&\n\t\t\tthis.longitude === coordinate.longitude &&\n\t\t\tthis.floorId === coordinate.floorId\n\t\t);\n\t}\n\n\t/**\n\t * Serializes the coordinate data to JSON.\n\t *\n\t * @returns An object representing the coordinate.\n\t */\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: Coordinate.__type,\n\t\t\tlatitude: this.latitude,\n\t\t\tlongitude: this.longitude,\n\t\t\tfloorId: this.floorId,\n\t\t\tverticalOffset: this.verticalOffset,\n\t\t};\n\t}\n\n\ttoGeoJSON() {\n\t\treturn {\n\t\t\ttype: 'Point',\n\t\t\tcoordinates: [this.longitude, this.latitude, this.verticalOffset ?? 0],\n\t\t};\n\t}\n\n\t/**\n\t * Cleans up resources used by the instance.\n\t *\n\t * @internal\n\t */\n\tdestroy() {\n\t\t// No specific cleanup required in current implementation\n\t}\n}\n\nexport default Coordinate;\n", "import type { AreaCollection } from '@mappedin/mvf-v2';\nimport type Coordinate from './coordinate';\nimport type { MapDataInternal } from '.';\nimport type Floor from './floor';\nimport type { IGeoJSONData } from './types';\nimport type { IAnchorable, IFocusable } from '../types';\nimport DetailedMapData from './detailed-map-data';\nimport { getCenterCoordinate } from './utils';\n\n/**\n * An Area represents some grouping of multiple pieces of geometry, not\n * necessarily bounded by walls or any other physical feature of the map.\n *\n * Areas are currently in a preview state, and may have changes to existing\n * functionality or new features added in the future.\n */\nclass Area\n\textends DetailedMapData<AreaCollection['features'][number]>\n\timplements IGeoJSONData, IFocusable, IAnchorable\n{\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'area';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = Area.__type;\n\n\t#data: MapDataInternal;\n\t#floorId: string;\n\t#cache: Partial<{ center: Coordinate }> = {};\n\t#mvfData: AreaCollection['features'][number];\n\n\t/**\n\t * Checks if the provided instance is of type Area.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a Area, false otherwise.\n\t */\n\tstatic is(instance: object): instance is Area {\n\t\treturn (instance as { __type: string }).__type === Area.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(\n\t\tdata: MapDataInternal,\n\t\toptions: {\n\t\t\tfloorId: string;\n\t\t\tmvfData: AreaCollection['features'][number];\n\t\t},\n\t) {\n\t\tsuper(data, options.mvfData);\n\t\tthis.#data = data;\n\t\tthis.#floorId = options.floorId;\n\t\tthis.#mvfData = options.mvfData;\n\t}\n\n\t/**\n\t * Gets the center {@link Coordinate} of the area.\n\t *\n\t * @returns {Coordinate} The area's center coordinate.\n\t */\n\tget center(): Coordinate {\n\t\tif (this.#cache.center == null) {\n\t\t\tthis.#cache.center = getCenterCoordinate(this.#mvfData, this.#floorId);\n\t\t}\n\n\t\treturn this.#cache.center;\n\t}\n\n\t/**\n\t * Gets the {@link Floor} object associated with the area.\n\t *\n\t * @returns {Floor} The floor object.\n\t * @throws Will throw an error if the floor is not found.\n\t */\n\tget floor(): Floor {\n\t\tconst _floor = this.#data.getById('floor', this.#floorId);\n\t\tif (_floor == null) {\n\t\t\tthrow new Error(`Floor ${this.#floorId} not found!`);\n\t\t}\n\n\t\treturn _floor;\n\t}\n\n\t/**\n\t * Gets the underlying GeoJSON Feature representation of this Area.\n\t */\n\tget geoJSON() {\n\t\treturn { ...this.#mvfData, properties: null };\n\t}\n\n\t/** @internal */\n\tget focusTarget() {\n\t\treturn this;\n\t}\n\n\t/** @internal */\n\tget anchorTarget() {\n\t\treturn this.center;\n\t}\n\n\t/**\n\t * Serializes the space data to JSON.\n\t *\n\t * @returns An object representing the space.\n\t */\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: Area.__type,\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t\tfloor: this.floor.id,\n\t\t};\n\t}\n\n\t/**\n\t * Cleans up resources used by the instance.\n\t *\n\t * @internal\n\t */\n\tdestroy() {}\n}\n\nexport default Area;\n", "import type { Details, Feature as MVFFeature, Geometry } from '@mappedin/mvf-v2';\nimport type LocationProfile from './location-profile';\nimport Hyperlink from './hyperlink';\nimport type { MapDataInternal } from '.';\nimport ImageMetaData from './image';\nimport BaseMapData from './base-object';\n\ntype PropertiesWithDetails = {\n\tid: string;\n\texternalId?: string;\n\tdetails?: Details;\n};\n\nexport default abstract class DetailedMapData<\n\tMVFData extends MVFFeature<Geometry, PropertiesWithDetails>,\n> extends BaseMapData {\n\t#data: MapDataInternal;\n\t#mvfData: MVFData;\n\t#cache: Partial<{ images: ImageMetaData[]; links: Hyperlink[] }> = {};\n\n\tconstructor(data: MapDataInternal, mvfData: MVFData) {\n\t\tsuper(mvfData.properties.id, data);\n\t\tthis.#data = data;\n\t\tthis.#mvfData = mvfData;\n\t}\n\n\t/**\n\t * Gets the external identifier of the map feature.\n\t *\n\t * @returns {string} The external ID of the map feature, or an empty string if no external ID exists.\n\t */\n\tget externalId(): string {\n\t\treturn this.#mvfData.properties.externalId ?? '';\n\t}\n\n\t/**\n\t * Gets the name of the map feature.\n\t *\n\t * @returns {string} The name of the map feature.\n\t */\n\tget name(): string {\n\t\t// compatibility for outdated mvf data\n\t\tlet name = this.#mvfData.properties.details?.name ?? '';\n\n\t\tif (name === '') {\n\t\t\tname = this.locationProfiles.find(profile => profile.name && profile.name.length > 0)?.name ?? '';\n\t\t}\n\n\t\treturn name;\n\t}\n\n\t/**\n\t * Gets the description of the map feature.\n\t *\n\t * @returns {string} The description of the map feature, or an empty string if no description exists.\n\t */\n\tget description(): string {\n\t\tlet description = this.#mvfData.properties.details?.description ?? '';\n\t\tif (description === '') {\n\t\t\tdescription =\n\t\t\t\tthis.locationProfiles.find(profile => profile.description && profile.description.length > 0)?.description ?? '';\n\t\t}\n\n\t\treturn description;\n\t}\n\n\t/**\n\t * Gets the array of {@link ImageMetaData}s associated with this map feature.\n\t *\n\t * @returns {ImageMetaData[]} An array of Image objects, or an empty array if no images exist.\n\t */\n\tget images(): ImageMetaData[] {\n\t\tif (this.#cache.images != null) {\n\t\t\treturn this.#cache.images;\n\t\t}\n\n\t\tlet images =\n\t\t\tthis.#mvfData.properties.details?.images?.map(\n\t\t\t\timage =>\n\t\t\t\t\tnew ImageMetaData({\n\t\t\t\t\t\tmvfData: image,\n\t\t\t\t\t\tmapData: this.#data,\n\t\t\t\t\t}),\n\t\t\t) ?? [];\n\t\tif (images == null || images.length === 0) {\n\t\t\timages = this.locationProfiles.find(profile => profile.images.length > 0)?.images ?? [];\n\t\t}\n\n\t\tthis.#cache.images = images;\n\n\t\treturn images;\n\t}\n\n\t/**\n\t * Gets the array of {@link Hyperlink}s associated with this map feature.\n\t *\n\t * @returns {Hyperlink[]} An array of Hyperlink objects, or an empty array if no links exist.\n\t */\n\tget links(): Hyperlink[] {\n\t\tif (this.#cache.links != null) {\n\t\t\treturn this.#cache.links;\n\t\t}\n\n\t\tlet links = this.#mvfData.properties.details?.links?.map(link => new Hyperlink({ mvfData: link })) ?? [];\n\t\tif (links == null || links.length === 0) {\n\t\t\tlinks = this.locationProfiles.find(profile => profile.links.length > 0)?.links ?? [];\n\t\t}\n\n\t\tthis.#cache.links = links;\n\n\t\treturn links;\n\t}\n\n\t/**\n\t * Gets the {@link LocationProfile}s attached to this feature.\n\t *\n\t * @returns {LocationProfile[]} An array of location profiles.\n\t */\n\tget locationProfiles(): LocationProfile[] {\n\t\treturn this.#data.locationProfilesByAttachedFeatureId[this.id] ?? [];\n\t}\n}\n", "/* eslint-disable @typescript-eslint/ban-ts-comment */\nimport type { LocationLink, Hyperlink as MVFHyperlink } from '@mappedin/mvf-v2';\nimport { randomId } from '../utils/randomId';\nimport BaseMetaData from './base-metadata-object';\n\n/**\n * A class representing hyperlink link data within the map.\n */\nclass Hyperlink extends BaseMetaData {\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'hyperlink';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = Hyperlink.__type;\n\n\t#cache: Partial<object> = {};\n\t#mvfData: MVFHyperlink | LocationLink;\n\n\t/**\n\t * Checks if the provided instance is of type Hyperlink.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a Hyperlink, false otherwise.\n\t */\n\tstatic is(instance: object): instance is Hyperlink {\n\t\treturn (instance as { __type: string }).__type === Hyperlink.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(options: { mvfData: MVFHyperlink | LocationLink }) {\n\t\tsuper(String(randomId()));\n\t\tthis.#mvfData = options.mvfData;\n\t}\n\n\t/**\n\t * Gets the url of the hyperlink.\n\t *\n\t * @returns {string} The url of the hyperlink.\n\t */\n\tget url(): string {\n\t\treturn this.#mvfData.url;\n\t}\n\n\t/**\n\t * Gets the name of the hyperlink.\n\t *\n\t * @returns {string | undefined } The name of the hyperlink.\n\t */\n\tget name(): string | undefined {\n\t\tif ('displayName' in this.#mvfData) {\n\t\t\treturn this.#mvfData.displayName;\n\t\t}\n\n\t\tif ('label' in this.#mvfData) {\n\t\t\treturn this.#mvfData.label;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\t/**\n\t * Serializes the hyperlink data to JSON.\n\t *\n\t * @returns An object representing the hyperlink.\n\t */\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: Hyperlink.__type,\n\t\t\tid: this.id,\n\t\t\turl: this.url,\n\t\t\tname: this.name,\n\t\t};\n\t}\n\n\t/**\n\t * Cleans up resources used by the instance.\n\t *\n\t * @internal\n\t */\n\tdestroy() {\n\t\tfor (const key of globalThis.Object.keys(this.#cache)) {\n\t\t\tdelete this.#cache[key];\n\t\t}\n\t}\n}\n\nexport default Hyperlink;\n", "export { randomId } from '../../../packages/common/random-id';\n", "/* eslint-disable @typescript-eslint/ban-ts-comment */\nimport type { Image as MVFImage } from '@mappedin/mvf-v2';\nimport { randomId } from '../utils/randomId';\nimport BaseMetaData from './base-metadata-object';\nimport type { MapDataInternal } from '.';\nimport { parseCdnAssetUrl } from '../utils/misc';\nimport { Logger } from '@packages/internal/common';\n\n/**\n * A class representing image link data within the map.\n */\nclass ImageMetaData extends BaseMetaData {\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'image';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = ImageMetaData.__type;\n\n\t#cache: Partial<object> = {};\n\t#mvfData: MVFImage;\n\t#data: MapDataInternal;\n\n\t/**\n\t * Checks if the provided instance is of type Image.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a Image, false otherwise.\n\t */\n\tstatic is(instance: object): instance is ImageMetaData {\n\t\treturn (instance as { __type: string }).__type === ImageMetaData.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(options: { mvfData: MVFImage; mapData: MapDataInternal }) {\n\t\tsuper(String(randomId()));\n\t\tthis.#mvfData = options.mvfData;\n\t\tthis.#data = options.mapData;\n\t}\n\n\t/**\n\t * Gets the url of the image.\n\t *\n\t * @returns {string | undefined} The url of the image.\n\t */\n\tget url(): string | undefined {\n\t\t/**\n\t\t * We don't want to cache any of this because we want this getter to return new values when the token manager\n\t\t * refreshes the SAS tokens.\n\t\t */\n\t\tconst url = this.#mvfData.url;\n\t\tif (this.#data.tokenManager == null) {\n\t\t\treturn url;\n\t\t}\n\n\t\tconst parsed = parseCdnAssetUrl(this.#mvfData.url);\n\t\tif (parsed == null) {\n\t\t\t// Don't need a SAS token for a non-cdn image\n\t\t\treturn url;\n\t\t}\n\n\t\tconst mapId = parsed.mapId;\n\t\ttry {\n\t\t\tif (this.#data.tokenManager.isEnterpriseMode()) {\n\t\t\t\treturn url;\n\t\t\t}\n\n\t\t\tconst sasToken = this.#data.tokenManager.getSasToken(mapId).token;\n\n\t\t\tif (sasToken == null || sasToken === '') {\n\t\t\t\tthrow new Error('SAS token empty!');\n\t\t\t}\n\n\t\t\treturn `${url}?${sasToken}`;\n\t\t} catch (error) {\n\t\t\t// We have some public SVGs that don't need SAS tokens, but it's difficult to distinguish them from private SVGs.\n\t\t\tif (parsed.fileType !== 'svg') {\n\t\t\t\tLogger.error('Error getting SAS token for image', { error, url });\n\t\t\t}\n\n\t\t\treturn url;\n\t\t}\n\t}\n\n\t/**\n\t * Gets the alt text of the image.\n\t *\n\t * @returns {string | undefined } The alt text of the image.\n\t * @deprecated Use {@link altText} instead.\n\t */\n\tget name(): string | undefined {\n\t\treturn this.#mvfData.altText;\n\t}\n\n\t/**\n\t * Gets the alt text of the image.\n\t *\n\t * @returns {string | undefined } The alt text of the image.\n\t */\n\tget altText(): string | undefined {\n\t\treturn this.#mvfData.altText;\n\t}\n\n\t/**\n\t * Serializes the image data to JSON.\n\t *\n\t * @returns An object representing the image.\n\t */\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: ImageMetaData.__type,\n\t\t\tid: this.id,\n\t\t\turl: this.url,\n\t\t\tname: this.name,\n\t\t};\n\t}\n\n\t/**\n\t * Cleans up resources used by the instance.\n\t *\n\t * @internal\n\t */\n\tdestroy() {\n\t\tfor (const key of globalThis.Object.keys(this.#cache)) {\n\t\t\tdelete this.#cache[key];\n\t\t}\n\t}\n}\n\nexport default ImageMetaData;\n", "import type { Position } from '@mappedin/core-sdk';\nimport type { Coordinate } from '../map-data-objects';\nimport { equirectangularDistance } from '@packages/internal/common/utils';\n\n/**\n * Place to put random utility functions\n */\nexport function getId<T extends { id: string }>(item: string | T): string {\n\treturn typeof item === 'string' ? item : item.id;\n}\n\nexport function getMidpoint(lonLat1: [number, number], lonLat2: [number, number]): [number, number] {\n\tconst [lon1, lat1] = lonLat1;\n\tconst [lon2, lat2] = lonLat2;\n\n\tconst midLon = (lon1 + lon2) / 2;\n\tconst midLat = (lat1 + lat2) / 2;\n\n\treturn [midLon, midLat];\n}\n\nexport function isPosition(thing: unknown): thing is Position {\n\treturn Array.isArray(thing) && Number.isFinite(thing[0]) && Number.isFinite(thing[1]);\n}\n\nconst PRECISION = 8; // This is on the scale of a 1mm, and lets us account for floating point precision issues\n\nexport const serializeCoords = (coordinates: number | Position | Position[] | Position[][]): string => {\n\tif (typeof coordinates === 'number') {\n\t\treturn coordinates.toFixed(PRECISION);\n\t}\n\n\tif (isPosition(coordinates)) {\n\t\treturn coordinates[1].toFixed(PRECISION) + '-' + coordinates[0].toFixed(PRECISION);\n\t}\n\n\treturn coordinates.map(coord => serializeCoords(coord)).join('-');\n};\n\nconst PROD_PUBLIC_CDN_REGEX = /^https:\\/\\/cdn\\.mappedin\\.com\\/category-symbols\\/.+$/;\nconst STAGING_PUBLIC_CDN_REGEX = /^https:\\/\\/cdn-staging\\.mappedin\\.net\\/category-symbols\\/.+$/;\nexport const isPublicCdnAsset = (url: string): boolean => {\n\treturn PROD_PUBLIC_CDN_REGEX.test(url) || STAGING_PUBLIC_CDN_REGEX.test(url);\n};\n\nconst PROD_PRIV_CDN_REGEX = /^https:\\/\\/cdn\\.mappedin\\.com\\/[^/]+\\/[^/]+\\.[a-zA-Z0-9]+$/;\nconst STAGING_PRIV_CDN_REGEX = /^https:\\/\\/cdn-staging\\.mappedin\\.net\\/[^/]+\\/[^/]+\\.[a-zA-Z0-9]+$/;\nexport const isPrivateCdnAsset = (url: string): boolean => {\n\tif (isPublicCdnAsset(url)) {\n\t\treturn false;\n\t}\n\n\treturn PROD_PRIV_CDN_REGEX.test(url) || STAGING_PRIV_CDN_REGEX.test(url);\n};\n\nexport const parseCdnAssetUrl = (\n\turl: string,\n): {\n\torigin: string;\n\tmapId: string;\n\tfileName: string;\n\tfileType: string;\n} | null => {\n\tif (!isPrivateCdnAsset(url)) {\n\t\treturn null;\n\t}\n\n\tlet protocol = '';\n\tif (url.startsWith('https://')) {\n\t\tprotocol = 'https://';\n\t\turl = url.slice(8);\n\t} else if (url.startsWith('http://')) {\n\t\tprotocol = 'http://';\n\t\turl = url.slice(7);\n\t}\n\n\tconst [origin, mapId, fileName] = url.split('/');\n\tconst fileType = fileName.split('.').pop() ?? '';\n\n\treturn { origin: protocol + origin, mapId, fileName, fileType };\n};\n\n/**\n * Computes the total distance between a list of coordinates using the equirectangular distance formula.\n * This is a fast approximation of the distance, but it is not as accurate as the haversine distance formula.\n */\nexport function computeTotalDistanceBetweenCoordinates(coordinates: Coordinate[]) {\n\treturn coordinates.reduce((acc, c, index) => {\n\t\tif (index === 0) {\n\t\t\treturn acc;\n\t\t}\n\t\treturn acc + equirectangularDistance(coordinates[index - 1].toGeoJSON().coordinates, c.toGeoJSON().coordinates);\n\t}, 0);\n}\n", "import type { BBox, Feature, LineString, MultiPolygon, Point, Polygon } from 'geojson';\nimport turfBbox from '@turf/bbox';\nimport type { MapDataInternal } from '.';\n\nexport default abstract class BaseMapData {\n\t// TODO: abstract __type, is()\n\t/**\n\t * The identity of the map data.\n\t */\n\treadonly id: string;\n\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tconstructor(id: string, _data: MapDataInternal) {\n\t\tthis.id = id;\n\t}\n\n\t#geoJSONBoundingBox?: BBox = undefined;\n\n\t/**\n\t * Gets the bounding box of the geoJSON geometry.\n\t *\n\t * @returns {BBox} The bounding box of the geoJSON geometry\n\t */\n\tget geoJSONBoundingBox() {\n\t\tif (this.#geoJSONBoundingBox) {\n\t\t\treturn this.#geoJSONBoundingBox;\n\t\t}\n\n\t\tif ('bbox' in this.geoJSON.geometry && this.geoJSON.geometry.bbox) {\n\t\t\treturn this.geoJSON.geometry.bbox;\n\t\t}\n\n\t\tthis.#geoJSONBoundingBox = turfBbox(this.geoJSON as Feature<Polygon | MultiPolygon>);\n\n\t\treturn this.#geoJSONBoundingBox;\n\t}\n\n\tget geoJSON(): Feature<Polygon | MultiPolygon | LineString | Point, null> {\n\t\treturn { properties: null, type: 'Feature', geometry: { type: 'Polygon', coordinates: [[]] } };\n\t}\n}\n", "import type { EntranceFeature } from '@mappedin/mvf-v2';\nimport type Coordinate from './coordinate';\nimport type Floor from './floor';\nimport type { MapDataInternal } from '.';\nimport type { IGeoJSONData } from './types';\nimport type { IAnchorable, IFocusable } from '../types';\nimport DetailedMapData from './detailed-map-data';\nimport { getCenterCoordinate } from './utils';\n\n/**\n * A class representing door data within the map.\n *\n * Doors are hidden by default. Doors can be made visible by setting their `visible` property to `true`.\n *\n * ```typescript\n * //Make interior doors visible and brown.\n * mapView.updateState(DOORS.Interior, {\n * \tvisible: true,\n * \tcolor: '#5C4033',\n * \topacity: 0.6,\n * });\n\n * //Make exterior doors visible and black.\n * mapView.updateState(DOORS.Exterior, {\n * \tvisible: true,\n * \tcolor: 'black',\n * \topacity: 0.6,\n * });\n * ```\n * Doors can also be made visible on an individual basis by passing in a {@link Door} object to {@link MapView.updateState}.\n *\n * Refer to the [Door Guide](https://developer.mappedin.com/web-sdk/spaces#doors) for more information and interactive examples.\n *\n * Door appearance can be customized by changing the color or adding a texture to the top or sides of a door.\n * Refer to the [Textures & Colors Guide](https://developer.mappedin.com/web-sdk/images-textures#textures--colors) for more information and interactive examples.\n *\n */\nclass Door extends DetailedMapData<EntranceFeature> implements IGeoJSONData, IFocusable, IAnchorable {\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'door';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = Door.__type;\n\n\t#data: MapDataInternal;\n\t#cache: Partial<{ center: Coordinate }>;\n\t#floorId: string;\n\t#mvfData: EntranceFeature;\n\n\t/**\n\t * Checks if the provided instance is of type Door.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a Door, false otherwise.\n\t */\n\tstatic is(instance: object): instance is Door {\n\t\treturn (instance as { __type: string }).__type === Door.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(\n\t\tdata: MapDataInternal,\n\t\toptions: {\n\t\t\tfloorId: string;\n\t\t\tmvfData: EntranceFeature;\n\t\t},\n\t) {\n\t\tsuper(data, options.mvfData);\n\t\tthis.#cache = {};\n\t\tthis.#mvfData = options.mvfData;\n\t\tthis.#data = data;\n\t\tthis.#floorId = options.floorId;\n\t}\n\n\t/**\n\t * Gets the {@link Floor} object associated with the door.\n\t *\n\t * @returns {Floor} The floor object.\n\t * @throws Will throw an error if the floor is not found.\n\t */\n\tget floor(): Floor {\n\t\tconst _floor = this.#data.getById('floor', this.#floorId);\n\t\tif (_floor == null) {\n\t\t\tthrow new Error(`Floor ${this.#floorId} not found!`);\n\t\t}\n\n\t\treturn _floor;\n\t}\n\n\t/**\n\t * Calculates and gets the center {@link Coordinate} of the door.\n\t *\n\t * @returns {Coordinate} The center coordinate.\n\t */\n\tget center(): Coordinate {\n\t\tif (this.#cache.center == null) {\n\t\t\tthis.#cache.center = getCenterCoordinate(this.#mvfData, this.#floorId);\n\t\t}\n\n\t\treturn this.#cache.center;\n\t}\n\n\t/**\n\t * Gets whether this door is an exterior door.\n\t */\n\tget isExterior(): boolean {\n\t\tif (this.#mvfData.properties.isExterior) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst obstructionId = this.#data.obstructionIdByEntranceId[this.id];\n\t\tconst obstruction = this.#data.getMVFFeatureById('obstruction', obstructionId);\n\n\t\treturn obstruction?.properties.footprintComponent ?? false;\n\t}\n\n\t/**\n\t * Gets the underlying GeoJSON Feature representation of this Door.\n\t */\n\tget geoJSON() {\n\t\treturn { ...this.#mvfData, properties: null };\n\t}\n\n\t/** @internal */\n\tget focusTarget() {\n\t\treturn this.center;\n\t}\n\n\t/** @internal */\n\tget anchorTarget() {\n\t\treturn this.center;\n\t}\n\n\t/**\n\t * Converts the door information to a JSON object.\n\t *\n\t * @returns An object representing the door.\n\t */\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: Door.__type,\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t\tfloor: this.floor.id,\n\t\t\tcenter: this.center.toJSON(),\n\t\t\t/* TODO: Uncomment this code when the adjacentSpaces getter is fixed */\n\t\t\t// adjacentSpaces: this.adjacentSpaces.map(space => space.id),\n\t\t};\n\t}\n\n\t/**\n\t * Cleans up resources used by the instance.\n\t *\n\t * @internal\n\t */\n\tdestroy() {\n\t\tfor (const key of Object.keys(this.#cache)) {\n\t\t\tdelete this.#cache[key];\n\t\t}\n\t}\n}\n\nexport default Door;\n", "import type { SpaceFeature } from '@mappedin/mvf-v2';\nimport type Coordinate from './coordinate';\nimport type { EnterpriseLocation, MapDataInternal } from '.';\nimport type Floor from './floor';\nimport type { IGeoJSONData } from './types';\nimport type Door from './door';\nimport type { IAnchorable, IFocusable } from '../types';\nimport DetailedMapData from './detailed-map-data';\nimport { getCenterCoordinate } from './utils';\nimport type { Writable } from 'type-fest';\n\n/**\n * Represents the various types of spaces that can be defined within a map.\n * - 'room': A standard room or enclosed area.\n * - 'hallway': A passageway connecting rooms.\n * - 'exterior': An outdoor area.\n * - 'void': An undefined or non-specific space.\n */\nexport type TSpaceType = 'room' | 'hallway' | 'exterior' | 'void' | 'gate';\n\n/**\n * A Space represents an area enclosed by walls, such as a hall or room. Spaces can be Interactive and have Labels and Markers added to them.\n * Spaces can also be customized with a color, texture and hover color.\n *\n * Refer to the [Spaces Guide](https://developer.mappedin.com/web-sdk/spaces) for more information and interactive examples.\n */\nclass Space extends DetailedMapData<SpaceFeature> implements IGeoJSONData, IFocusable, IAnchorable {\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'space';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = Space.__type;\n\n\t#data: MapDataInternal;\n\t#floorId: string;\n\t#cache: Partial<Writable<Space>> = {};\n\t#mvfData: SpaceFeature;\n\n\t/**\n\t * Checks if the provided instance is of type Space.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a Space, false otherwise.\n\t */\n\tstatic is(instance: object): instance is Space {\n\t\treturn (instance as { __type: string }).__type === Space.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(\n\t\tdata: MapDataInternal,\n\t\toptions: {\n\t\t\tfloorId: string;\n\t\t\tmvfData: SpaceFeature;\n\t\t},\n\t) {\n\t\tsuper(data, options.mvfData);\n\t\tthis.#data = data;\n\t\tthis.#floorId = options.floorId;\n\t\tthis.#mvfData = options.mvfData;\n\t}\n\n\t/**\n\t * Gets the type/kind of the space.\n\t *\n\t * @returns {TSpaceType} The type of the space.\n\t */\n\tget type(): TSpaceType {\n\t\treturn validateSpaceType(this.#mvfData.properties.kind);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tget locations(): EnterpriseLocation[] {\n\t\tif (this.#cache.locations) {\n\t\t\treturn this.#cache.locations;\n\t\t}\n\n\t\tthis.#cache.locations = [];\n\t\tconst enterpriseLocations = this.#data.mvfLocationsByGeometryId[this.#mvfData.properties.id];\n\t\tif (enterpriseLocations?.length > 0) {\n\t\t\tfor (const enterpriseLocation of enterpriseLocations) {\n\t\t\t\tconst location = this.#data.getById('enterprise-location', enterpriseLocation.id);\n\t\t\t\tif (location) {\n\t\t\t\t\tthis.#cache.locations.push(location);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.#cache.locations;\n\t}\n\n\t/**\n\t * Gets the {@link Floor} object associated with the space.\n\t *\n\t * @returns {Floor} The floor object.\n\t * @throws Will throw an error if the floor is not found.\n\t */\n\tget floor(): Floor {\n\t\tconst _floor = this.#data.getById('floor', this.#floorId);\n\t\tif (_floor == null) {\n\t\t\tthrow new Error(`Floor ${this.#floorId} not found!`);\n\t\t}\n\n\t\treturn _floor;\n\t}\n\n\t/**\n\t * Gets the array of {@link Door}s associated with the space.\n\t *\n\t * @returns {Door[]} The doors array.\n\t */\n\tget doors(): Door[] {\n\t\tif (this.#cache.doors) {\n\t\t\treturn this.#cache.doors;\n\t\t}\n\n\t\tthis.#cache.doors = [];\n\t\tconst entranceNodeIds = this.#data.entranceNodeIdsBySpaceId?.[this.id] ?? [];\n\t\tfor (const nodeId of entranceNodeIds) {\n\t\t\tconst door = this.#data.doorsByNodeId[nodeId];\n\t\t\tif (door) this.#cache.doors.push(door);\n\t\t}\n\n\t\treturn this.#cache.doors;\n\t}\n\n\t/**\n\t * Gets the center {@link Coordinate} of the space.\n\t *\n\t * @returns {Coordinate} The space's center coordinate.\n\t */\n\tget center(): Coordinate {\n\t\tif (this.#cache.center == null) {\n\t\t\tthis.#cache.center = getCenterCoordinate(this.#mvfData, this.#floorId);\n\t\t}\n\n\t\treturn this.#cache.center;\n\t}\n\n\t/**\n\t * Gets the underlying GeoJSON Feature representation of this Space.\n\t */\n\tget geoJSON() {\n\t\treturn { ...this.#mvfData, properties: null };\n\t}\n\n\t/** @internal */\n\tget focusTarget() {\n\t\treturn this.geoJSON.geometry.type === 'Polygon' ? this : this.center;\n\t}\n\n\t/** @internal */\n\tget anchorTarget() {\n\t\treturn this.center;\n\t}\n\n\t/**\n\t * Serializes the space data to JSON.\n\t *\n\t * @returns An object representing the space.\n\t */\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: Space.__type,\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t\ttype: this.type,\n\t\t\tfloor: this.floor.id,\n\t\t\tcenter: this.center.toJSON(),\n\t\t};\n\t}\n\n\t/**\n\t * Cleans up resources used by the instance.\n\t *\n\t * @internal\n\t */\n\tdestroy() {\n\t\tfor (const key of Object.keys(this.#cache)) {\n\t\t\tdelete this.#cache[key];\n\t\t}\n\t}\n}\n\nexport const VALID_SPACE_TYPES: TSpaceType[] = ['room', 'hallway', 'exterior', 'void', 'gate'];\n/**\n * validates space type and fallback to room\n */\nexport function validateSpaceType(input: string | null | undefined): TSpaceType {\n\tif (input == null || input === 'default') {\n\t\treturn 'room';\n\t}\n\tconst inputLowerCase = input.toLowerCase();\n\tif (VALID_SPACE_TYPES.includes(inputLowerCase as TSpaceType)) {\n\t\t// If the input is valid, return it as a TSpaceType\n\t\treturn inputLowerCase as TSpaceType;\n\t} else {\n\t\t// fallback\n\t\treturn 'room';\n\t}\n}\n\nexport default Space;\n", "import type { Feature, MultiPolygon, FloorProperties as MVFFloor, Polygon } from '@mappedin/mvf-v2';\nimport type { Annotation, Connection, Door, MapDataInternal, PointOfInterest, Space, MapObject, FloorStack } from '.';\nimport type Coordinate from './coordinate';\nimport type { FloorWithLocale, MVFFloorFeature } from './types';\nimport BaseMapData from './base-object';\nimport type { IFocusable } from '../types';\nimport { getCenterCoordinate } from './utils';\n\n/**\n * A class representing floor data within the map.\n *\n * Floors are used to represent different levels within a map, each containing various map elements.\n */\nclass Floor extends BaseMapData implements IFocusable {\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'floor';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = Floor.__type;\n\n\t#data: MapDataInternal;\n\t#cache: Partial<{\n\t\tspaces: Space[];\n\t\tobjects: MapObject[];\n\t\tconnections: Connection[];\n\t\tdoors: Door[];\n\t\tannotations: Annotation[];\n\t\tpois: PointOfInterest[];\n\t\tfloorStack: FloorStack;\n\t\tcenter: Coordinate;\n\t}> = {};\n\t#mvfData: MVFFloorFeature;\n\n\t/**\n\t * Checks if the provided instance is of type Floor.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a Floor, false otherwise.\n\t */\n\tstatic is(instance: object): instance is Floor {\n\t\treturn (instance as { __type: string }).__type === Floor.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(data: MapDataInternal, options: { mvfData: MVFFloorFeature }) {\n\t\tsuper(options.mvfData.properties.id, data);\n\t\tthis.#data = data;\n\t\tthis.#mvfData = options.mvfData;\n\t}\n\n\t#translate<T extends keyof MVFFloor>(prop: T) {\n\t\tconst value = this.#mvfData.properties[prop];\n\n\t\treturn this.#data.getPropTranslation(this.__type, prop, this.id, value as NonNullable<FloorWithLocale>[T]);\n\t}\n\n\t/** @internal */\n\tget focusTarget() {\n\t\treturn this;\n\t}\n\n\t/**\n\t * Gets the name of the floor.\n\t *\n\t * @returns {string} The name of the floor.\n\t */\n\tget name(): string {\n\t\t// compatibility for outdated mvf data\n\t\tif (!('name' in this.#mvfData.properties)) {\n\t\t\treturn this.#mvfData.properties.externalId ?? '';\n\t\t}\n\n\t\tconst name = this.#translate('name');\n\t\treturn typeof name === 'string' ? name : '';\n\t}\n\t/**\n\t * Gets the short name of the floor (i.e. \"F1\", \"L, \"2\", etc.).\n\t * Used in space constrained lists and Often aligns with what is displayed on an elevator.\n\t *\n\t * @returns {string} The short name of the floor.\n\t */\n\tget shortName(): string {\n\t\t// compatibility for outdated mvf data\n\t\tif (!('shortName' in this.#mvfData.properties)) {\n\t\t\treturn this.#mvfData.properties.externalId ?? '';\n\t\t}\n\n\t\tconst shortName = this.#translate('shortName');\n\t\treturn typeof shortName === 'string' ? shortName : '';\n\t}\n\n\t/**\n\t * Gets the subtitle of the floor.\n\t *\n\t * @returns {string} The subtitle of the floor.\n\t */\n\tget subtitle(): string {\n\t\tconst subtitle = this.#translate('subtitle');\n\t\treturn typeof subtitle === 'string' ? subtitle : '';\n\t}\n\n\t/**\n\t * Gets the external ID of the floor.\n\t *\n\t * @returns {string} The external ID of the floor.\n\t */\n\tget externalId(): string {\n\t\treturn this.#mvfData.properties.externalId ?? '';\n\t}\n\n\t/**\n\t * Gets the elevation of the floor.\n\t *\n\t * @returns {number} The elevation of the floor.\n\t */\n\tget elevation(): number {\n\t\treturn this.#mvfData.properties.elevation;\n\t}\n\n\t/**\n\t * Gets the max height of the floor if there is one.\n\t *\n\t * @returns {number | undefined} The max height of the floor.\n\t */\n\tget maxHeight(): number | undefined {\n\t\treturn this.#mvfData.properties.maxHeight;\n\t}\n\n\t/**\n\t * Gets the spaces ({@link Space}) located on this floor.\n\t *\n\t * @returns {Space[]} An array of Space objects on this floor.\n\t */\n\tget spaces(): Space[] {\n\t\tif (this.#cache.spaces == null) {\n\t\t\tconst spacesOnThisFloor = this.#data.spaces.filter(space => space.floor.id === this.id);\n\n\t\t\tthis.#cache.spaces = spacesOnThisFloor;\n\t\t}\n\n\t\treturn this.#cache.spaces;\n\t}\n\n\t/**\n\t * Gets the underlying GeoJSON Feature representation of this Space.\n\t */\n\tget geoJSON(): Feature<Polygon | MultiPolygon, null> {\n\t\treturn {\n\t\t\ttype: 'Feature',\n\t\t\tproperties: null,\n\t\t\tgeometry: this.#mvfData.geometry ?? { type: 'Polygon', coordinates: [] },\n\t\t};\n\t}\n\n\t/**\n\t * Gets the objects ({@link MapObject}) located on this floor.\n\t *\n\t * @returns {MapObject[]} An array of MapObject objects on this floor.\n\t */\n\tget objects(): MapObject[] {\n\t\tif (this.#cache.objects == null) {\n\t\t\tconst objectsOnThisFloor = this.#data.objects.filter(obstruction => obstruction.floor.id === this.id);\n\n\t\t\tthis.#cache.objects = objectsOnThisFloor;\n\t\t}\n\n\t\treturn this.#cache.objects;\n\t}\n\n\t/**\n\t * Gets the connections ({@link Connection}) associated with this floor.\n\t *\n\t * @returns {Connection[]} An array of Connection objects linked to this floor.\n\t */\n\tget connections(): Connection[] {\n\t\tif (this.#cache.connections == null) {\n\t\t\tconst connectionsOnFloor = this.#data.connections.filter(connection => connection.floors.includes(this));\n\t\t\tthis.#cache.connections = connectionsOnFloor;\n\t\t}\n\n\t\treturn this.#cache.connections;\n\t}\n\n\t/**\n\t * Gets the doors ({@link Door}) located on this floor.\n\t *\n\t * @returns {Door[]} An array of Door objects on this floor.\n\t */\n\tget doors(): Door[] {\n\t\tif (this.#cache.doors == null) {\n\t\t\tconst doorsOnFloor = this.#data.doors.filter(door => door.floor.id === this.id);\n\t\t\tthis.#cache.doors = doorsOnFloor;\n\t\t}\n\n\t\treturn this.#cache.doors;\n\t}\n\n\t/**\n\t * Gets the annotations ({@link Annotation}) associated with this floor.\n\t *\n\t * @returns {Annotation[]} An array of Annotation objects linked to this floor.\n\t */\n\tget annotations(): Annotation[] {\n\t\tif (this.#cache.annotations == null) {\n\t\t\tconst annotationsOnFloor = this.#data.annotations.filter(annotation => annotation.floor.id === this.id);\n\t\t\tthis.#cache.annotations = annotationsOnFloor;\n\t\t}\n\n\t\treturn this.#cache.annotations;\n\t}\n\n\t/**\n\t * Gets the points of interest ({@link PointOfInterest}) located on this floor.\n\t *\n\t * @returns {PointOfInterest[]} An array of PointOfInterest objects on this floor.\n\t */\n\tget pois(): PointOfInterest[] {\n\t\tif (this.#cache.pois == null) {\n\t\t\tconst poisOnFloor = this.#data.pointsOfInterest.filter(poi => poi.floor.id === this.id);\n\t\t\tthis.#cache.pois = poisOnFloor;\n\t\t}\n\n\t\treturn this.#cache.pois;\n\t}\n\n\t/**\n\t * Gets the FloorStack ({@link FloorStack}) that this floor belongs to.\n\t *\n\t * @returns {FloorStack} The FloorStack that this floor belongs to.\n\t */\n\tget floorStack(): FloorStack {\n\t\tif (this.#cache.floorStack == null) {\n\t\t\tconst floorStackForFloor = this.#data.floorStacks.find(floorStack => floorStack.floors.includes(this));\n\t\t\tthis.#cache.floorStack = floorStackForFloor;\n\t\t}\n\n\t\treturn this.#cache.floorStack!;\n\t}\n\n\tget center(): Coordinate {\n\t\tif (this.#cache.center == null) {\n\t\t\tthis.#cache.center = getCenterCoordinate(this.#mvfData, this.id);\n\t\t}\n\n\t\treturn this.#cache.center;\n\t}\n\n\t/**\n\t * Serializes the floor data to JSON.\n\t *\n\t * @returns An object representing the floor.\n\t */\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: Floor.__type,\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t\tshortName: this.shortName,\n\t\t\tsubtitle: this.subtitle,\n\t\t\televation: this.elevation,\n\t\t\tmaxHeight: this.maxHeight,\n\t\t\tspaces: this.spaces.map(space => space.id),\n\t\t\tobjects: this.objects.map(object => object.id),\n\t\t\tconnections: this.connections.map(connection => connection.id),\n\t\t\tdoors: this.doors.map(door => door.id),\n\t\t\tannotations: this.annotations.map(annotation => annotation.id),\n\t\t\tpois: this.pois.map(poi => poi.id),\n\t\t};\n\t}\n\n\t/**\n\t * Cleans up resources used by the instance.\n\t *\n\t * @internal\n\t */\n\tdestroy() {\n\t\tfor (const key of globalThis.Object.keys(this.#cache)) {\n\t\t\tdelete this.#cache[key];\n\t\t}\n\t}\n}\n\nexport default Floor;\n", "import type {\n\tFeature,\n\tFeatureCollection,\n\tPoint,\n\tSpaceProperties,\n\tConnection as MVFConnection,\n\tPosition,\n} from '@mappedin/mvf-v2';\nimport type Coordinate from './coordinate';\nimport type Node from './node';\nimport type { Floor, LocationProfile, MapDataInternal } from '.';\nimport { notNull, serializeCoords } from '../utils';\nimport type { IFocusable, TConnectionType } from '../types';\nimport DetailedMapData from './detailed-map-data';\nimport { getCenterCoordinate } from './utils';\n\n/**\n * A class representing connection data within the map.\n *\n * Connections are used to represent pathways between different map nodes.\n */\nclass Connection\n\textends DetailedMapData<Feature<Point, SpaceProperties> | Feature<Point, MVFConnection>>\n\timplements IFocusable\n{\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'connection';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = Connection.__type;\n\n\t#data: MapDataInternal;\n\t#cache: Partial<{ coordinates: Coordinate[]; locationProfiles: LocationProfile[] }>;\n\t// Connections are spaces in the MVF\n\t#mvfDataByFloorId:\n\t\t| Record<string, FeatureCollection<Point, SpaceProperties>['features'][number]>\n\t\t| Record<string, Feature<Point, MVFConnection>>;\n\n\t/**\n\t * Checks if the provided instance is of type Connection.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a Connection, false otherwise.\n\t */\n\tstatic is(instance: object): instance is Connection {\n\t\treturn (instance as { __type: string }).__type === Connection.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(\n\t\tdata: MapDataInternal,\n\t\toptions: {\n\t\t\tmvfDataByFloorId:\n\t\t\t\t| Record<string, FeatureCollection<Point, SpaceProperties>['features'][number]>\n\t\t\t\t| Record<string, Feature<Point, MVFConnection>>;\n\t\t\taccessible?: boolean;\n\t\t},\n\t) {\n\t\tconst singularData = Object.values(options.mvfDataByFloorId)[0] as\n\t\t\t| FeatureCollection<Point, SpaceProperties>['features'][number]\n\t\t\t| Feature<Point, MVFConnection>;\n\t\t// TODO: Derive a more stable ID from all the MVF data.\n\t\tsuper(data, singularData);\n\t\tthis.#cache = {};\n\t\tthis.#data = data;\n\t\tthis.#mvfDataByFloorId = options.mvfDataByFloorId;\n\t}\n\n\t/**\n\t * Whether the connection is accessible. For example elevators are accessible while stairs are not.\n\t *\n\t * @returns {boolean} Whether the connection is accessible.\n\t */\n\tget accessible(): boolean {\n\t\treturn Object.values(this.#mvfDataByFloorId)[0].properties.accessible ?? false;\n\t}\n\n\t/**\n\t * Gets the type of the connection.\n\t *\n\t * @returns {TConnectionType} The type of the connection.\n\t */\n\tget type(): TConnectionType {\n\t\t// All the MVF connection spaces should share a kind, so we can just grab the first one.\n\t\treturn Object.values(this.#mvfDataByFloorId)[0].properties.kind?.split('.')[1] ?? 'unknown';\n\t}\n\n\t/**\n\t * Extra properties of the connection.\n\t *\n\t * @returns {Record<string, unknown> | undefined} Extra properties of the connection.\n\t */\n\tget extra(): Record<string, unknown> | undefined {\n\t\treturn Object.values(this.#mvfDataByFloorId)[0].properties.extra;\n\t}\n\n\t/**\n\t * Gets the coordinates ({@link Coordinate}) of the connection.\n\t *\n\t * @returns {Coordinate[]} An array of coordinates for the connection.\n\t */\n\tget coordinates() {\n\t\tif (this.#cache.coordinates == null) {\n\t\t\tthis.#cache.coordinates = Object.entries(this.#mvfDataByFloorId).map(([floorId, mvfData]) =>\n\t\t\t\tgetCenterCoordinate(mvfData, floorId),\n\t\t\t);\n\t\t}\n\n\t\treturn this.#cache.coordinates;\n\t}\n\n\t/**\n\t * Gets the nodes ({@link Node}) associated with the connection.\n\t */\n\tget nodes(): Node[] {\n\t\treturn Object.values(this.#mvfDataByFloorId)[0].properties.nodes.map(nodeId => this.#data.getById('node', nodeId));\n\t}\n\n\t/**\n\t * Gets the floors ({@link Floor}) associated with the connection.\n\t *\n\t * @returns {Floor[]} An array of floors for the connection.\n\t */\n\tget floors(): Floor[] {\n\t\treturn this.coordinates\n\t\t\t.map(coordinate => (coordinate.floorId ? this.#data.getById('floor', coordinate.floorId) : undefined))\n\t\t\t.filter(notNull);\n\t}\n\n\t/**\n\t * Gets the location profiles ({@link LocationProfile}) associated with the connection.\n\t */\n\tget locationProfiles() {\n\t\tif (this.#cache.locationProfiles != null) {\n\t\t\treturn this.#cache.locationProfiles;\n\t\t}\n\n\t\t/**\n\t\t * Location profiles are attached to the connection in the connections.json, not the connection space\n\t\t * in the space collections. We need to jump through some hoops to find them.\n\t\t *\n\t\t * TODO: Fix this for MVFv3\n\t\t */\n\t\tlet profiles = super.locationProfiles;\n\t\tif (profiles == null || profiles.length === 0) {\n\t\t\tconst position: Position = [this.coordinates[0]?.longitude ?? 0, this.coordinates[0]?.latitude ?? 0];\n\t\t\tconst latLonString = serializeCoords(position);\n\t\t\tconst mvfConnectionIds = this.#data.mvfConnectionIdsByLatLon[latLonString] ?? [];\n\t\t\tfor (const connectionId of mvfConnectionIds) {\n\t\t\t\tconst maybeProfiles = this.#data.locationProfilesByAttachedFeatureId[connectionId];\n\t\t\t\tif (maybeProfiles != null) {\n\t\t\t\t\tprofiles = maybeProfiles;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.#cache.locationProfiles = profiles ?? [];\n\n\t\treturn profiles;\n\t}\n\n\t/** @internal */\n\tget focusTarget() {\n\t\treturn this.coordinates;\n\t}\n\n\t/**\n\t * Serializes the connection data to JSON.\n\t *\n\t * @returns An object representing the connection.\n\t */\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: Connection.__type,\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t\ttype: this.type,\n\t\t\texternalId: this.externalId,\n\t\t\tcoordinates: this.coordinates.map(coordinate => coordinate.toJSON()),\n\t\t\tfloors: this.floors.map(floor => floor.id),\n\t\t\textra: this.extra,\n\t\t};\n\t}\n\n\t/**\n\t * Cleans up resources used by the instance.\n\t *\n\t * @internal\n\t */\n\tdestroy() {\n\t\tfor (const key of Object.keys(this.#cache)) {\n\t\t\tdelete this.#cache[key];\n\t\t}\n\t}\n}\n\nexport default Connection;\n", "export { notNull } from './not-null';\nexport { randomId } from './randomId';\nexport * from './misc';\nexport * from './api';\nexport { validateOptions, handleShow3DMapOptionDefault } from './options';\n", "import {\n\tAnnotation,\n\tCoordinate,\n\tDoor,\n\tMapObject,\n\tPointOfInterest,\n\tSpace,\n\tNode,\n\tEnterpriseLocation,\n\tArea,\n\tFacade,\n} from '../map-data-objects';\n\nexport function getCoordinateFromStuffs(\n\tthing:\n\t\t| Space\n\t\t| Door\n\t\t| Coordinate\n\t\t| MapObject\n\t\t| PointOfInterest\n\t\t| Annotation\n\t\t| Node\n\t\t| EnterpriseLocation\n\t\t| Area\n\t\t| Facade,\n) {\n\tlet coordinate: Coordinate;\n\tif (Space.is(thing) || Door.is(thing) || MapObject.is(thing) || Area.is(thing) || Facade.is(thing)) {\n\t\tcoordinate = thing.center;\n\t} else if (PointOfInterest.is(thing) || Annotation.is(thing)) {\n\t\tcoordinate = thing.coordinate;\n\t} else if (Coordinate.is(thing)) {\n\t\tcoordinate = thing;\n\t} else if (Node.is(thing)) {\n\t\tcoordinate = thing.coordinate;\n\t} else if (EnterpriseLocation.is(thing)) {\n\t\tcoordinate = thing.coordinates[0];\n\t} else {\n\t\treturn undefined;\n\t}\n\n\treturn coordinate;\n}\n", "import { decodeAccessToken, Logger } from '@packages/internal/common';\nimport type { MapData, TShow3DMapOptions } from '../';\nimport { DEFAULT_MAP_OPTIONS } from '../constants';\n\n/**\n * Options that are public and should be returned by the `mapView.options` getter.\n */\nexport const PUBLIC_MAPVIEW_OPTIONS_SET = new Set([\n\t'outdoorView',\n\t'bearing',\n\t'pitch',\n\t'zoomLevel',\n\t'screenOffsets',\n\t'debug',\n\t'initialFloor',\n\t'shadingAndOutlines',\n\t'wallTopColor',\n\t'style',\n\t'multiFloorView',\n\t'occlusion',\n\t'imagePlacementOptions',\n\t'flipImagesToFaceCamera',\n\t'injectStyles',\n\t'useStandaloneCamera',\n\t'preloadFloors',\n]);\n\n/**\n * Options that are public and should be returned by the `mapView.options` getter.\n */\nexport const PUBLIC_OUTDOOR_VIEW_OPTIONS_SET = new Set(['style', 'enabled', 'layersHiddenByGeometry', 'lowDpi']);\n\nexport function validateOptions(options: TShow3DMapOptions) {\n\tif (options.outdoorView?.enabled && !options.outdoorView?.token) {\n\t\tLogger.error('Enable outdoor view requires a token. Provide token in `options.outdoorView.token`');\n\t}\n}\n\nexport function handleShow3DMapOptionDefault(options: TShow3DMapOptions | undefined, mapData: MapData) {\n\tconst token = options?.outdoorView?.token || mapData.outdoorViewToken;\n\n\tconst stateWithDefault: TShow3DMapOptions = {\n\t\t...DEFAULT_MAP_OPTIONS,\n\t\t...options,\n\t\toutdoorView: {\n\t\t\tenabled: options?.outdoorView?.enabled === undefined ? !!token : options?.outdoorView?.enabled,\n\t\t\tlayersHiddenByGeometry: DEFAULT_MAP_OPTIONS.outdoorView?.layersHiddenByGeometry,\n\t\t\t...options?.outdoorView,\n\t\t},\n\t\tbearing: options?.bearing ?? mapData.naturalBearing ?? 0,\n\t\timagePlacementOptions: {\n\t\t\t...DEFAULT_MAP_OPTIONS.imagePlacementOptions,\n\t\t\t...options?.imagePlacementOptions,\n\t\t},\n\t\tmultiFloorView: {\n\t\t\t...DEFAULT_MAP_OPTIONS.multiFloorView,\n\t\t\t...options?.multiFloorView,\n\t\t},\n\t};\n\n\tif (token && stateWithDefault.outdoorView) {\n\t\tstateWithDefault.outdoorView.token = token;\n\t}\n\n\treturn stateWithDefault;\n}\n\nexport function handleTokenCapabilities(token: string) {\n\tconst capabilities = { remove_watermark: false };\n\n\tif (token) {\n\t\ttry {\n\t\t\tconst decoded = decodeAccessToken(token);\n\t\t\tObject.assign(capabilities, decoded.capabilities);\n\t\t} catch (e) {\n\t\t\tLogger.error('Error decoding capabilities from token', e);\n\t\t}\n\t}\n\n\treturn capabilities;\n}\n\nexport function getPublicOptions(options: TShow3DMapOptions): TShow3DMapOptions {\n\tconst publicOptions = Object.fromEntries(\n\t\tObject.entries(options).filter(([key]) => PUBLIC_MAPVIEW_OPTIONS_SET.has(key)),\n\t) as TShow3DMapOptions;\n\n\tif (publicOptions.outdoorView) {\n\t\tpublicOptions.outdoorView = Object.fromEntries(\n\t\t\tObject.entries(publicOptions.outdoorView).filter(([key]) => PUBLIC_OUTDOOR_VIEW_OPTIONS_SET.has(key)),\n\t\t) as TShow3DMapOptions['outdoorView'];\n\t}\n\n\treturn publicOptions;\n}\n", "import type { TShow3DMapOptions } from '.';\nexport const DEFAULT_FLOOR_HEIGHT = 10;\n\n// This multiplier is based off the average height of a floor in North America (3m)\n// so that the height of the gap is approximately 10 meters (3m * 3.333 = 10m)\nexport const FLOOR_GAP_MULTIPLIER = 3.333333333;\n\n/**\n * Default map options used if no custom options are provided.\n *\n * @internal\n */\nexport const DEFAULT_MAP_OPTIONS = {\n\tdebug: false,\n\tpitch: 45,\n\tbearing: 0,\n\tantialiasing: {\n\t\tenabled: true,\n\t},\n\tshadingAndOutlines: true,\n\toutdoorView: {\n\t\tlayersHiddenByGeometry: ['building', 'building-top'],\n\t},\n\timagePlacementOptions: {\n\t\tmode: 'default',\n\t},\n\tflipImagesToFaceCamera: true,\n\tmultiFloorView: {\n\t\tenabled: true,\n\t\tfloorGap: 'auto',\n\t},\n} satisfies TShow3DMapOptions;\n\nexport const EXTERIOR_WALLS_ID = 'ExteriorWalls';\nexport const WALLS_ID = 'Walls';\nexport const ADD_MAP_FOCUS_ON_DURATION = 0;\nexport const INTERIOR_DOORS_ID = 'InteriorDoors';\nexport const EXTERIOR_DOORS_ID = 'ExteriorDoors';\nexport const GEOMETRY_LAYER = 'GeometryLayer';\nexport const LABELS_LAYER = 'LabelsLayer';\nexport const MARKERS_LAYER = 'MarkersLayer';\nexport const FOOTPRINT_LAYER = 'FootprintLayer';\nexport const OCCLUSION_LAYER = 'OcclusionLayer';\nexport const AREAS_LAYER = 'AreasLayer';\nexport const IMAGES_LAYER = 'ImagesLayer';\nexport const FACADES_LAYER = 'FacadesLayer';\nexport const PATHS_LAYER = 'PathsLayer';\nexport const SELF_SERVE_API_AUDIENCE = [\n\t'https://mappedin-self-serve.us.auth0.com/userinfo',\n\t'https://mappedin-ct.us.auth0.com/userinfo',\n];\nexport const ENTERPRISE_API_AUDIENCE = [\n\t'https://mappedin.auth0.com',\n\t'https://mappedin-staging.auth0.com',\n\t'https://staging.mappedin.com',\n\t'https://mappedin-staging.auth0.com/userinfo',\n\t'https://mappedin.com',\n\t'https://mappedin.auth0.com/userinfo',\n];\n\nexport const MAPPEDIN_COLORS = {\n\torange: '#F26336',\n\tteal: '#057685',\n\tlightTeal: '#5DC7D0',\n};\n", "import type { ObstructionFeature } from '@mappedin/mvf-v2';\nimport type Coordinate from './coordinate';\nimport type { EnterpriseLocation, MapDataInternal } from '.';\nimport type Floor from './floor';\nimport type { IGeoJSONData } from './types';\nimport type { IAnchorable, IFocusable } from '../types';\nimport DetailedMapData from './detailed-map-data';\nimport { getCenterCoordinate } from './utils';\n\n/**\n * A class representing generic map object data within the map.\n *\n * It could represent various objects on the map, such as desks, chairs, etc.\n *\n * MapObject appearance can be customized by changing the color or adding a texture to its top or sides.\n * Refer to the [Textures & Colors Guide](https://developer.mappedin.com/web-sdk/images-textures#textures--colors) for more information and interactive examples.\n */\nexport class MapObject extends DetailedMapData<ObstructionFeature> implements IGeoJSONData, IFocusable, IAnchorable {\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'object';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = MapObject.__type;\n\n\t#data: MapDataInternal;\n\t#floorId: string;\n\t#cache: Partial<{ center: Coordinate; locations: EnterpriseLocation[] }> = {};\n\t#mvfData: ObstructionFeature;\n\n\t/**\n\t * Checks if the provided instance is of type MapObject.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a MapObject, false otherwise.\n\t */\n\tstatic is(instance: object): instance is MapObject {\n\t\treturn (instance as { __type: string }).__type === MapObject.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(\n\t\tdata: MapDataInternal,\n\t\toptions: {\n\t\t\tfloorId: string;\n\t\t\tmvfData: ObstructionFeature;\n\t\t},\n\t) {\n\t\tsuper(data, options.mvfData);\n\t\tthis.#data = data;\n\t\tthis.#floorId = options.floorId;\n\t\tthis.#mvfData = options.mvfData;\n\t}\n\n\t/**\n\t * Gets the type of the MapObject.\n\t *\n\t * @returns {string} The kind of the object.\n\t */\n\tget type(): string {\n\t\tlet objectKind = this.#mvfData.properties.kind;\n\t\tif (objectKind == null) {\n\t\t\tobjectKind = 'object';\n\t\t}\n\t\t// For some reason MVF does not use the same casing for desks, we should normalize it\n\t\tif (objectKind === 'Desks') {\n\t\t\tobjectKind = 'desk';\n\t\t}\n\n\t\treturn objectKind.toLowerCase();\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tget locations(): EnterpriseLocation[] {\n\t\tif (this.#cache.locations) {\n\t\t\treturn this.#cache.locations;\n\t\t}\n\n\t\tthis.#cache.locations = [];\n\t\tconst enterpriseLocations = this.#data.mvfLocationsByGeometryId[this.#mvfData.properties.id];\n\t\tif (enterpriseLocations?.length > 0) {\n\t\t\tfor (const enterpriseLocation of enterpriseLocations) {\n\t\t\t\tconst location = this.#data.getById('enterprise-location', enterpriseLocation.id);\n\t\t\t\tif (location) {\n\t\t\t\t\tthis.#cache.locations.push(location);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.#cache.locations;\n\t}\n\n\t/**\n\t * Gets the {@link Floor} associated with the MapObject.\n\t *\n\t * @returns {Floor} The floor object.\n\t * @throws Will throw an error if the floor is not found.\n\t */\n\tget floor(): Floor {\n\t\tconst _floor = this.#data.getById('floor', this.#floorId);\n\t\tif (_floor == null) {\n\t\t\tthrow new Error(`Floor ${this.#floorId} not found!`);\n\t\t}\n\n\t\treturn _floor;\n\t}\n\n\t/**\n\t * Gets the center {@link Coordinate} of the MapObject.\n\t *\n\t * @returns {Coordinate} The object's center coordinate.\n\t */\n\tget center(): Coordinate {\n\t\tif (this.#cache.center == null) {\n\t\t\tthis.#cache.center = getCenterCoordinate(this.#mvfData, this.#floorId);\n\t\t}\n\n\t\treturn this.#cache.center;\n\t}\n\n\t/**\n\t * Gets the underlying GeoJSON Feature representation of this Object.\n\t */\n\tget geoJSON() {\n\t\treturn { ...this.#mvfData, properties: null };\n\t}\n\n\t/** @internal */\n\tget anchorTarget() {\n\t\treturn this.center;\n\t}\n\n\t/** @internal */\n\tget focusTarget() {\n\t\treturn this.geoJSON.geometry.type === 'Polygon' ? this : this.center;\n\t}\n\n\t/**\n\t * Serializes the MapObject data to JSON.\n\t *\n\t * @returns An object representing the MapObject.\n\t */\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: MapObject.__type,\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t\ttype: this.type,\n\t\t\tfloor: this.floor.id,\n\t\t\tcenter: this.center.toJSON(),\n\t\t};\n\t}\n\n\t/**\n\t * Cleans up resources used by the instance.\n\t *\n\t * @internal\n\t */\n\tdestroy() {\n\t\tfor (const key of globalThis.Object.keys(this.#cache)) {\n\t\t\tthis.#cache[key] = null;\n\t\t}\n\t}\n}\n\nexport default MapObject;\n", "import type { FeatureCollection, Point, SpaceProperties } from '@mappedin/mvf-v2';\nimport type { Floor, MapDataInternal } from '.';\nimport type Coordinate from './coordinate';\nimport type { IGeoJSONData } from './types';\nimport type Hyperlink from './hyperlink';\nimport type ImageMetaData from './image';\nimport type { IAnchorable, IFocusable } from '../types';\nimport DetailedMapData from './detailed-map-data';\nimport { getCenterCoordinate } from './utils';\n\n/**\n * A class representing point of interest data within the map.\n *\n * Points of interest are used to represent specific points\n * on the map with additional information(e.g. ATMs, Water Fountains).\n */\nclass PointOfInterest\n\textends DetailedMapData<FeatureCollection<Point, SpaceProperties>['features'][number]>\n\timplements IGeoJSONData, IFocusable, IAnchorable\n{\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'point-of-interest';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = PointOfInterest.__type;\n\n\t#data: MapDataInternal;\n\t#floorId: string;\n\t#cache: Partial<{ coordinate: Coordinate; links: Hyperlink[]; images: ImageMetaData[] }> = {};\n\t#mvfData: FeatureCollection<Point, SpaceProperties>['features'][number];\n\n\t/**\n\t * Checks if the provided instance is of type PointOfInterest.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a PointOfInterest, false otherwise.\n\t */\n\tstatic is(instance: object): instance is PointOfInterest {\n\t\treturn (instance as { __type: string }).__type === PointOfInterest.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(\n\t\tdata: MapDataInternal,\n\t\toptions: {\n\t\t\tfloorId: string;\n\t\t\tmvfData: FeatureCollection<Point, SpaceProperties>['features'][number];\n\t\t},\n\t) {\n\t\tsuper(data, options.mvfData);\n\t\tthis.#data = data;\n\t\tthis.#mvfData = options.mvfData;\n\t\tthis.#floorId = options.floorId;\n\t}\n\n\t/**\n\t * Gets the {@link Floor} object associated with the POI.\n\t *\n\t * @returns {Floor} The floor object.\n\t * @throws Will throw an error if the floor is not found.\n\t */\n\tget floor(): Floor {\n\t\tconst _floor = this.#data.getById('floor', this.#floorId);\n\t\tif (_floor == null) {\n\t\t\tthrow new Error(`Floor ${this.#floorId} not found!`);\n\t\t}\n\n\t\treturn _floor;\n\t}\n\n\t/**\n\t * Gets the {@link Coordinate} of the POI.\n\t *\n\t * @returns {Coordinate} The POI's coordinate.\n\t */\n\tget coordinate(): Coordinate {\n\t\tif (this.#cache.coordinate == null) {\n\t\t\tthis.#cache.coordinate = getCenterCoordinate(this.#mvfData, this.#floorId);\n\t\t}\n\n\t\treturn this.#cache.coordinate;\n\t}\n\n\t/**\n\t * Gets the underlying GeoJSON Feature representation of this PointOfInterest.\n\t */\n\tget geoJSON() {\n\t\treturn { ...this.#mvfData, properties: null };\n\t}\n\n\t/** @internal */\n\tget focusTarget() {\n\t\treturn this.coordinate;\n\t}\n\n\t/** @internal */\n\tget anchorTarget() {\n\t\treturn this.coordinate;\n\t}\n\n\t/**\n\t * Serializes the POI data to JSON.\n\t *\n\t * @returns An object representing the POI.\n\t */\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: PointOfInterest.__type,\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t\tfloor: this.floor.id,\n\t\t\tcoordinate: this.coordinate.toJSON(),\n\t\t};\n\t}\n\n\t/**\n\t * Cleans up resources used by the instance.\n\t *\n\t * @internal\n\t */\n\tdestroy() {\n\t\tfor (const key in this.#cache) {\n\t\t\tthis.#cache[key] = null;\n\t\t}\n\t}\n}\n\nexport default PointOfInterest;\n", "import type { AnnotationCollection } from '@mappedin/mvf-v2';\nimport type { Floor, MapDataInternal } from '.';\nimport type Coordinate from './coordinate';\nimport type { IGeoJSONData } from './types';\nimport type { IAnchorable, IFocusable } from '../types';\nimport DetailedMapData from './detailed-map-data';\nimport { getCenterCoordinate } from './utils';\n\n/**\n * A class representing annotation data within the map.\n *\n * Annotations are used to mark specific points or areas on the map with additional information.\n * It includes some details on a map that may be relevant to safety or accessibility (e.g. Fire Extinguishers).\n * Refer to the [Annotation Guide](https://developer.mappedin.com/web-sdk/annotations) for more information.\n */\nclass Annotation\n\textends DetailedMapData<AnnotationCollection['features'][number]>\n\timplements IGeoJSONData, IFocusable, IAnchorable\n{\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'annotation';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = Annotation.__type;\n\n\t#data: MapDataInternal;\n\t#floorId: string;\n\t#cache: Partial<{ coordinate: Coordinate }> = {};\n\t#mvfData: AnnotationCollection['features'][number];\n\n\t/**\n\t * Checks if the provided instance is of type Annotation.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is an Annotation, false otherwise.\n\t */\n\tstatic is(instance: object): instance is Annotation {\n\t\treturn (instance as { __type: string }).__type === Annotation.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(\n\t\tdata: MapDataInternal,\n\t\toptions: {\n\t\t\tfloorId: string;\n\t\t\tmvfData: AnnotationCollection['features'][number];\n\t\t},\n\t) {\n\t\tsuper(data, options.mvfData);\n\t\tthis.#data = data;\n\t\tthis.#floorId = options.floorId;\n\t\tthis.#mvfData = options.mvfData;\n\t}\n\n\t/**\n\t * Gets the group and type of the annotation.\n\t *\n\t * @returns {object} An object containing group and type.\n\t */\n\t#getGroupAndTypeFromSymbolId() {\n\t\tconst [group, type] = this.#mvfData.properties.symbolId.split('--');\n\n\t\treturn { group, type };\n\t}\n\n\t/**\n\t * Gets the group of the annotation.\n\t *\n\t * @returns {string} The annotation group.\n\t */\n\tget group() {\n\t\treturn this.#getGroupAndTypeFromSymbolId().group;\n\t}\n\n\t/**\n\t * Gets the type of the annotation.\n\t *\n\t * @returns {string} The annotation type.\n\t */\n\tget type(): string {\n\t\treturn this.#getGroupAndTypeFromSymbolId().type;\n\t}\n\n\t/**\n\t * Gets the center {@link Coordinate} of the annotation.\n\t *\n\t * @returns {Coordinate} The annotation's coordinate.\n\t */\n\tget coordinate(): Coordinate {\n\t\tif (this.#cache.coordinate == null) {\n\t\t\tthis.#cache.coordinate = getCenterCoordinate(this.#mvfData, this.#floorId);\n\t\t}\n\n\t\treturn this.#cache.coordinate;\n\t}\n\n\t/**\n\t * Gets the {@link Floor} object associated with the annotation.\n\t *\n\t * @returns {Floor} The floor object.\n\t * @throws Will throw an error if the floor is not found.\n\t */\n\tget floor(): Floor {\n\t\tconst _floor = this.#data.getById('floor', this.#floorId);\n\t\tif (_floor == null) {\n\t\t\tthrow new Error(`Floor ${this.#floorId} not found!`);\n\t\t}\n\n\t\treturn _floor;\n\t}\n\n\t// TODO: Implement this\n\t// get icon() {\n\t//      return ''\n\t// }\n\n\t/**\n\t * Gets the underlying GeoJSON Feature representation of this Annotation.\n\t */\n\tget geoJSON() {\n\t\treturn { ...this.#mvfData, properties: null };\n\t}\n\n\t/** @internal */\n\tget focusTarget() {\n\t\treturn this.coordinate;\n\t}\n\n\t/** @internal */\n\tget anchorTarget() {\n\t\treturn this.coordinate;\n\t}\n\n\t/**\n\t * Converts the annotation information to a JSON object.\n\t *\n\t * @returns An object representing the annotation.\n\t */\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: Annotation.__type,\n\t\t\tid: this.id,\n\t\t\tgroup: this.group,\n\t\t\ttype: this.type,\n\t\t\tcoordinate: this.coordinate.toJSON(),\n\t\t};\n\t}\n\n\t/**\n\t * Cleans up resources used by the instance.\n\t *\n\t * @internal\n\t */\n\tdestroy() {\n\t\tfor (const key of Object.keys(this.#cache)) {\n\t\t\tdelete this.#cache[key];\n\t\t}\n\t}\n}\n\nexport default Annotation;\n", "import type { FloorStack as MVFFloorStack } from '@mappedin/mvf-v2';\nimport type { MapDataInternal, Floor, Facade } from '.';\nimport BaseMapData from './base-object';\nimport { Logger } from '@packages/internal/common';\n\n/**\n * A class representing floor stack data within the map.\n *\n * FloorStacks are used to represent a group of floors that are part of a single entity.\n */\nclass FloorStack extends BaseMapData {\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'floor-stack';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = FloorStack.__type;\n\n\t#data: MapDataInternal;\n\t#cache: Partial<{\n\t\tfloors: [Floor, ...Floor[]];\n\t\tdefaultFloor: Floor;\n\t}> = {};\n\t#mvfData: MVFFloorStack;\n\t#facadeId?: string;\n\t/**\n\t * Checks if the provided instance is of type FloorStack.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a FloorStack, false otherwise.\n\t */\n\tstatic is(instance: object): instance is FloorStack {\n\t\treturn (instance as { __type: string }).__type === FloorStack.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(data: MapDataInternal, options: { mvfData: MVFFloorStack; facadeId?: string }) {\n\t\tsuper(options.mvfData.id, data);\n\t\tthis.#data = data;\n\t\tthis.#mvfData = options.mvfData;\n\t\tthis.#facadeId = options.facadeId;\n\t}\n\n\t#translate<T extends keyof MVFFloorStack>(prop: T) {\n\t\treturn this.#data.getPropTranslation(this.__type, prop, this.id, this.#mvfData[prop as string]);\n\t}\n\n\t/**\n\t * Gets the type of FloorStack.\n\t */\n\tget type(): MVFFloorStack['type'] {\n\t\treturn this.#mvfData.type;\n\t}\n\n\t/**\n\t * Gets the name of the FloorStack.\n\t *\n\t * @returns {string} The name of the FloorStack.\n\t */\n\tget name(): string {\n\t\tconst name = this.#translate('name');\n\t\treturn typeof name === 'string' ? name : '';\n\t}\n\n\t/**\n\t * Gets the short name of the FloorStack.\n\t *\n\t * @returns {string} The short name of the FloorStack.\n\t */\n\tget shortName(): string {\n\t\tconst shortName = this.#translate('shortName');\n\t\treturn typeof shortName === 'string' ? shortName : '';\n\t}\n\n\t/**\n\t * Gets the externalId of FloorStack\n\t */\n\tget externalId(): string {\n\t\treturn this.#mvfData.externalId ?? '';\n\t}\n\n\t/**\n\t * Gets the floors ({@link Floor}) included in this FloorStack.\n\t *\n\t * @returns {Floor[]} An array of Floor objects in this FloorStack.\n\t */\n\tget floors(): [Floor, ...Floor[]] {\n\t\tif (this.#cache.floors == null) {\n\t\t\tconst floorsInStack = (this.#mvfData.floors ?? this.#mvfData.maps ?? []).reduce((acc, floorId) => {\n\t\t\t\tconst floor = this.#data.floorsById[floorId];\n\n\t\t\t\tif (floor) acc.push(floor);\n\n\t\t\t\treturn acc;\n\t\t\t}, [] as Floor[]);\n\n\t\t\tif (floorsInStack.length === 0) {\n\t\t\t\tLogger.error(`Floor stack ${this.id} has no floors`);\n\t\t\t}\n\n\t\t\t// Sort floors by elevation\n\t\t\tthis.#cache.floors = floorsInStack.sort((a, b) => a.elevation - b.elevation) as [Floor, ...Floor[]];\n\t\t}\n\n\t\treturn this.#cache.floors;\n\t}\n\n\t/**\n\t * Get the default floor for this floor stack\n\t */\n\tget defaultFloor(): Floor {\n\t\tif (this.#cache.defaultFloor != null) {\n\t\t\treturn this.#cache.defaultFloor;\n\t\t}\n\n\t\tconst defaultFloor = this.#mvfData.defaultFloor\n\t\t\t? this.#data.getById('floor', this.#mvfData.defaultFloor)\n\t\t\t: undefined;\n\n\t\tthis.#cache.defaultFloor =\n\t\t\tdefaultFloor ||\n\t\t\tthis.floors.reduce((prev, curr) => {\n\t\t\t\treturn Math.abs(curr.elevation) < Math.abs(prev.elevation) ? curr : prev;\n\t\t\t});\n\n\t\treturn this.#cache.defaultFloor;\n\t}\n\n\t/**\n\t * Gets the facade ({@link Facade}) representing this floor stack, if it exists.\n\t */\n\tget facade(): Facade | undefined {\n\t\treturn this.#facadeId ? this.#data.facadesById[this.#facadeId] : undefined;\n\t}\n\n\t/**\n\t * Serializes the FloorStack data to JSON.\n\t *\n\t * @returns An object representing the FloorStack.\n\t */\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: FloorStack.__type,\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t\tshortName: this.shortName,\n\t\t\ttype: this.type,\n\t\t\tfloors: this.floors.map(floor => floor.id),\n\t\t};\n\t}\n\n\t/**\n\t * Cleans up resources used by the instance.\n\t *\n\t * @internal\n\t */\n\tdestroy() {\n\t\tfor (const key of globalThis.Object.keys(this.#cache)) {\n\t\t\tdelete this.#cache[key];\n\t\t}\n\t}\n}\n\nexport default FloorStack;\n", "import type { Space, MapDataInternal, FloorStack } from '.';\nimport { Coordinate } from '.';\nimport BaseMapData from './base-object';\nimport type { Facade as MVFFacade, SpaceCollection } from '@mappedin/mvf-v2';\nimport center from '@turf/center';\nimport type { IAnchorable, IFocusable } from '../types';\nimport { MappedinError } from '@packages/internal/common/errors';\n\n/**\n * A Facade is a collection of spaces that make up the exterior representation of a Floor Stack ({@link FloorStack}).\n */\nclass Facade extends BaseMapData implements IFocusable, IAnchorable {\n\tstatic readonly __type = 'facade';\n\treadonly __type = Facade.__type;\n\n\t/**\n\t * Checks if the provided instance is of type Floor.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a Floor, false otherwise.\n\t */\n\tstatic is(instance: object): instance is Facade {\n\t\treturn (instance as { __type: string }).__type === Facade.__type;\n\t}\n\n\t#mvfData: MVFFacade;\n\t#data: MapDataInternal;\n\t#floorStackId: string;\n\t#cache: { spaces?: Space[]; center?: Coordinate } = {};\n\n\t/** @internal */\n\tconstructor(data: MapDataInternal, options: { mvfData: MVFFacade; floorStackId: string }) {\n\t\tsuper(options.mvfData.id, data);\n\t\tthis.#mvfData = options.mvfData;\n\t\tthis.#data = data;\n\t\tthis.#floorStackId = options.floorStackId;\n\t}\n\n\t/**\n\t * Gets the floor stack that this Facade represents.\n\t */\n\tget floorStack(): FloorStack {\n\t\treturn this.#data.getById('floor-stack', this.#floorStackId)!;\n\t}\n\n\t/**\n\t * Gets the collection of spaces that make up this Facade.\n\t */\n\tget spaces(): Space[] {\n\t\tif (!this.#cache.spaces) {\n\t\t\tthis.#cache.spaces = [];\n\t\t\tfor (const facadeSpace of this.#mvfData.spaces) {\n\t\t\t\tconst space = this.#data.getById('space', facadeSpace.spaceId);\n\t\t\t\tif (space) {\n\t\t\t\t\tthis.#cache.spaces.push(space);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.#cache.spaces;\n\t}\n\n\t/**\n\t * Gets the center {@link Coordinate} of the Facade.\n\t */\n\tget center(): Coordinate {\n\t\tif (!this.#cache.center) {\n\t\t\tconst featureCollection: SpaceCollection = {\n\t\t\t\ttype: 'FeatureCollection',\n\t\t\t\tfeatures: [],\n\t\t\t};\n\t\t\tfor (const space of this.spaces) {\n\t\t\t\tconst mvfSpace = this.#data.mvfSpacesById[space.id];\n\t\t\t\tif (mvfSpace) {\n\t\t\t\t\tfeatureCollection.features.push(mvfSpace);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (featureCollection.features.length === 0) {\n\t\t\t\tthrow new MappedinError('No geometry found for facade!');\n\t\t\t}\n\n\t\t\tconst centerResult = center(featureCollection);\n\t\t\tthis.#cache.center = new Coordinate({\n\t\t\t\tlatitude: centerResult.geometry.coordinates[1],\n\t\t\t\tlongitude: centerResult.geometry.coordinates[0],\n\t\t\t\tfloorId: this.#mvfData.spaces[0].floorId,\n\t\t\t});\n\t\t}\n\n\t\treturn this.#cache.center;\n\t}\n\n\t/** @internal */\n\tget focusTarget() {\n\t\treturn this.spaces;\n\t}\n\n\t/** @internal */\n\tget anchorTarget() {\n\t\treturn this.center;\n\t}\n\n\ttoJSON() {\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\t__type: Facade.__type,\n\t\t\tfloorStackId: this.#floorStackId,\n\t\t\tfloorStack: this.floorStack,\n\t\t\tspaces: this.spaces,\n\t\t};\n\t}\n}\n\nexport default Facade;\n", "import type {\n\tAnnotationCollection,\n\tEntranceCollection,\n\tFeature,\n\tFeatureCollection,\n\tConnection as MVFConnection,\n\tEnterpriseCategory as MVFEnterpriseCategory,\n\tEnterpriseCategoryId as MVFEnterpriseCategoryId,\n\tEnterpriseLocation as MVFEnterpriseLocation,\n\tEnterpriseLocationId as MVFEnterpriseLocationId,\n\tEnterpriseVenue as MVFEnterpriseVenue,\n\tFloorProperties as MVFFloor,\n\tFloorStack as MVFFloorStack,\n\tNodeCollection,\n\tObstructionCollection,\n\tParsedMVF,\n\tPoint,\n\tSpaceCollection,\n\tSpaceProperties,\n\tAreaCollection,\n\tAreaId,\n\tNodeId,\n\tEnterpriseLocationInstance,\n\tSpaceId,\n\tObstructionId,\n} from '@mappedin/mvf-v2';\nimport type { WithEntepriseStyle, WithPolygonImage, WithTextArea, WithTextures } from '@packages/internal/mvf-utils';\nimport {\n\tAnnotation,\n\tArea,\n\tConnection,\n\tDoor,\n\tEnterpriseCategory,\n\tEnterpriseLocation,\n\tFacade,\n\tFloor,\n\tFloorStack,\n\tMapObject,\n\tNode,\n\tPointOfInterest,\n\tSpace,\n\tLocationCategory,\n\tLocationProfile,\n\ttype MapDataInternal,\n} from '../map-data-objects';\nimport { serializeCoords } from './misc';\nimport { Logger } from '../../../packages/common';\n\nexport const OBSTRUCTION_KINDS_TO_SKIP = new Set(['wall', 'area']);\nexport const SPACE_KINDS_TO_SKIP = new Set(['void', 'desk-entrance']);\n\nexport type MapDataRecords = {\n\t// Primary ID Lookups\n\tspacesById: Record<string, Space>;\n\tnodesById: Record<string, Node>;\n\tobjectsById: Record<string, MapObject>;\n\tfloorsById: Record<string, Floor>;\n\tfloorStacksById: Record<string, FloorStack>;\n\tfacadesById: Record<string, Facade>;\n\tfacadesBySpaceId: Record<string, Facade>;\n\tconnectionsById: Record<string, Connection>;\n\tdoorsById: Record<string, Door>;\n\tdoorsByNodeId: Record<string, Door>;\n\tpoisById: Record<string, PointOfInterest>;\n\tannotationsById: Record<string, Annotation>;\n\tareasById: Record<AreaId, Area>;\n\tspaceIdsByNodeId: Record<string, SpaceId[]>;\n\tobjectIdsByNodeId: Record<string, ObstructionId[]>;\n\tdestinationNodesIdsBySpaceId: Record<SpaceId, NodeId[]>;\n\t/**\n\t * Map of space id to door-linked node ids for fast routing.\n\t */\n\tentranceNodeIdsBySpaceId?: Record<string, string[]>;\n\tlocationProfilesById: Record<string, LocationProfile>;\n\tlocationCategoriesById: Record<string, LocationCategory>;\n\tlocationProfilesByCategoryId: Record<string, LocationProfile[]>;\n\tlocationCategoriesByParentId: Record<string, LocationCategory[]>;\n\n\t// External ID Lookups\n\tspacesByExternalId: Record<string, Space[]>;\n\tnodesByExternalId: Record<string, Node[]>;\n\tpoisByExternalId: Record<string, PointOfInterest[]>;\n\tdoorsByExternalId: Record<string, Door[]>;\n\tfloorStacksByExternalId: Record<string, FloorStack[]>;\n\tfloorsByExternalId: Record<string, Floor[]>;\n\tobjectsByExternalId: Record<string, MapObject[]>;\n\tareasByExternalId: Record<string, Area[]>;\n\tlocationProfilesByExternalId: Record<string, LocationProfile[]>;\n\n\t// Special records\n\tobjectEntranceNodeIdsByObstructionId: Record<string, string[]>;\n\tobstructionIdByEntranceId: Record<string, string>;\n\tconnectionIdsByLatLon: Record<string, string[]>;\n\tmvfConnectionIdsByLatLon: Record<string, string[]>;\n\tlocationProfilesByAttachedFeatureId: Record<string, LocationProfile[]>;\n\n\t// MVF data types\n\tmvfSpacesById: Record<string, SpaceCollection['features'][number]>;\n\tmvfNodesById: Record<string, NodeCollection['features'][number]>;\n\tmvfObstructionById: Record<string, ObstructionCollection['features'][number]>;\n\tmvfFloorsById: Record<string, MVFFloor>;\n\tmvfFloorStacksById: Record<string, MVFFloorStack>;\n\tmvfConnectionsById: Record<string, MVFConnection>;\n\tmvfConnectionsByNodeId: Record<string, MVFConnection>;\n\tmvfEntrancesById: Record<string, EntranceCollection['features'][number]>;\n\tmvfAnnotationsById: Record<string, AnnotationCollection['features'][number]>;\n\tmvfNodesByFloorId: { [floorId: string]: NodeCollection['features'][number][] };\n\tmvfSpacesByFloorId: { [floorId: string]: SpaceCollection['features'][number][] };\n\tmvfPoisByFloorId: { [floorId: string]: FeatureCollection<Point, SpaceProperties>['features'][number][] };\n\tmvfEntrancesByFloorId: { [floorId: string]: EntranceCollection['features'][number][] };\n\tmvfAnnotationsByFloorId: { [floorId: string]: AnnotationCollection['features'][number][] };\n\tmvfAreasById: Record<AreaId, AreaCollection['features'][number]>;\n};\n\nexport type EnterpriseMapDataRecords = {\n\tconnectionsByExternalId: Record<string, Connection[]>;\n\tlocationsByExternalId: Record<string, EnterpriseLocation[]>;\n\tcategoriesByExternalId: Record<string, EnterpriseCategory[]>;\n\tlocationsById: Record<MVFEnterpriseLocationId, EnterpriseLocation>;\n\tcategoriesById: Record<MVFEnterpriseCategoryId, EnterpriseCategory>;\n\tlocationIdsByNodeId: Record<string, MVFEnterpriseLocationId[]>;\n\tlocationInstancesById: Record<string, EnterpriseLocationInstance>;\n\tvenue: MVFEnterpriseVenue;\n\n\tmvfCategoriesById: Record<string, MVFEnterpriseCategory>;\n\tmvfLocationsById: Record<string, MVFEnterpriseLocation>;\n\tmvfLocationsByGeometryId: Record<string, MVFEnterpriseLocation[]>;\n};\n\nexport const processMVFLocationProfilesAndCategories = (mvf: ParsedMVF, data: MapDataInternal) => {\n\tconst locationProfilesById: MapDataRecords['locationProfilesById'] = {};\n\tconst locationCategoriesById: MapDataRecords['locationCategoriesById'] = {};\n\tconst locationCategoriesByParentId: MapDataRecords['locationCategoriesByParentId'] = {};\n\tconst locationProfilesByExternalId: MapDataRecords['locationProfilesByExternalId'] = {};\n\tconst locationProfilesByCategoryId: MapDataRecords['locationProfilesByCategoryId'] = {};\n\tconst locationProfilesByAttachedFeatureId: MapDataRecords['locationProfilesByAttachedFeatureId'] = {};\n\n\tfor (const locationProfile of mvf['location.json'] || []) {\n\t\tconst newLocationProfile = new LocationProfile(data, {\n\t\t\tmvfData: locationProfile,\n\t\t});\n\t\tlocationProfilesById[locationProfile.id] = newLocationProfile;\n\t\tif (locationProfile.externalId) {\n\t\t\tif (locationProfilesByExternalId[locationProfile.externalId] == null) {\n\t\t\t\tlocationProfilesByExternalId[locationProfile.externalId] = [];\n\t\t\t}\n\t\t\tlocationProfilesByExternalId[locationProfile.externalId].push(newLocationProfile);\n\t\t}\n\n\t\tif (locationProfile.categories) {\n\t\t\tfor (const categoryId of locationProfile.categories) {\n\t\t\t\tif (locationProfilesByCategoryId[categoryId] == null) {\n\t\t\t\t\tlocationProfilesByCategoryId[categoryId] = [];\n\t\t\t\t}\n\t\t\t\tlocationProfilesByCategoryId[categoryId].push(newLocationProfile);\n\t\t\t}\n\t\t}\n\n\t\t// Make these all optional to handle old MVFs\n\t\tconst attachedFeatures = [\n\t\t\t...(locationProfile.obstructions?.map(obstruction => obstruction.id) ?? []),\n\t\t\t...(locationProfile.spaces?.map(space => space.id) ?? []),\n\t\t\t...(locationProfile.annotations?.map(annotation => annotation.id) ?? []),\n\t\t\t...(locationProfile.connections ?? []),\n\t\t\t...(locationProfile.entrances?.map(entrance => entrance.id) ?? []),\n\t\t\t...(locationProfile.areas?.map(area => area.id) ?? []),\n\t\t];\n\n\t\tfor (const featureId of attachedFeatures) {\n\t\t\tif (featureId) {\n\t\t\t\tif (locationProfilesByAttachedFeatureId[featureId] == null) {\n\t\t\t\t\tlocationProfilesByAttachedFeatureId[featureId] = [];\n\t\t\t\t}\n\t\t\t\tlocationProfilesByAttachedFeatureId[featureId].push(newLocationProfile);\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (const locationCategory of mvf['category.json'] || []) {\n\t\tconst newLocationCategory = new LocationCategory(data, {\n\t\t\tmvfData: locationCategory,\n\t\t});\n\t\tlocationCategoriesById[locationCategory.id] = newLocationCategory;\n\t\tif (locationCategory.parent) {\n\t\t\tif (locationCategoriesByParentId[locationCategory.parent] == null) {\n\t\t\t\tlocationCategoriesByParentId[locationCategory.parent] = [];\n\t\t\t}\n\t\t\tlocationCategoriesByParentId[locationCategory.parent].push(newLocationCategory);\n\t\t}\n\t}\n\n\treturn {\n\t\tlocationCategoriesByParentId,\n\t\tlocationProfilesById,\n\t\tlocationCategoriesById,\n\t\tlocationProfilesByExternalId,\n\t\tlocationProfilesByCategoryId,\n\t\tlocationProfilesByAttachedFeatureId,\n\t};\n};\n\nexport const processMVFSpaces = (\n\tmvf: ParsedMVF,\n\tmvfConnectionsByNodeId: MapDataRecords['mvfConnectionsByNodeId'],\n\tdata: MapDataInternal,\n): Pick<\n\tMapDataRecords,\n\t| 'spacesById'\n\t| 'spacesByExternalId'\n\t| 'poisById'\n\t| 'poisByExternalId'\n\t| 'mvfSpacesById'\n\t| 'objectEntranceNodeIdsByObstructionId'\n\t| 'connectionsById'\n\t| 'connectionIdsByLatLon'\n\t| 'mvfSpacesByFloorId'\n\t| 'mvfPoisByFloorId'\n> => {\n\tconst spacesById: MapDataRecords['spacesById'] = {};\n\tconst spacesByExternalId: MapDataRecords['spacesByExternalId'] = {};\n\tconst poisById: MapDataRecords['poisById'] = {};\n\tconst poisByExternalId: MapDataRecords['poisByExternalId'] = {};\n\tconst objectEntranceNodeIdsByObstructionId: MapDataRecords['objectEntranceNodeIdsByObstructionId'] = {};\n\tconst mvfSpacesById: MapDataRecords['mvfSpacesById'] = {};\n\tconst mvfSpacesByFloorId: MapDataRecords['mvfSpacesByFloorId'] = {};\n\tconst mvfPoisByFloorId: MapDataRecords['mvfPoisByFloorId'] = {};\n\tconst connectionIdsByLatLon: MapDataRecords['connectionIdsByLatLon'] = {};\n\tconst connectionsById: MapDataRecords['connectionsById'] = {};\n\n\t// This is not returned, just used to populate the above records correctly\n\tconst floorIdBySpaceId: Record<string, string> = {};\n\n\tconst floorIdsWithSpaces = globalThis.Object.keys(mvf.space);\n\tfor (const floorId of floorIdsWithSpaces) {\n\t\tconst mvfSpaces = mvf.space[floorId];\n\n\t\tif (mvfSpaces == null) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tfor (const space of mvfSpaces.features) {\n\t\t\t/**\n\t\t\t * We always want to do some data processing on the MVF data\n\t\t\t */\n\t\t\tfloorIdBySpaceId[space.properties.id] = floorId;\n\t\t\tmvfSpacesById[space.properties.id] = space;\n\t\t\tif (space.properties.kind === 'desk-entrance') {\n\t\t\t\t// The external ID of a desk-entrance should be the object ID of the desk\n\t\t\t\tif (objectEntranceNodeIdsByObstructionId[space.properties.externalId] == null) {\n\t\t\t\t\tobjectEntranceNodeIdsByObstructionId[space.properties.externalId] = [];\n\t\t\t\t}\n\t\t\t\tobjectEntranceNodeIdsByObstructionId[space.properties.externalId].push(...space.properties.destinationNodes);\n\t\t\t}\n\n\t\t\t// Some space types need to be skipped when creating SDK data\n\t\t\tif (shouldSkipSpace(space)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Connections are multiple spaces in MVF, but we want to consolidate them in the SDK\n\t\t\tif (space.properties.kind?.includes('connection')) {\n\t\t\t\tconst latLonString = serializeCoords(space.geometry.coordinates);\n\t\t\t\tif (connectionIdsByLatLon[latLonString] == null) {\n\t\t\t\t\tconnectionIdsByLatLon[latLonString] = [];\n\t\t\t\t}\n\t\t\t\tconnectionIdsByLatLon[latLonString].push(space.properties.id);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// POIs are spaces in MVF v2, but not in the Platform tooling, so we keep them as separate APIs\n\t\t\tif (\n\t\t\t\tspace.properties.kind === 'poi' ||\n\t\t\t\t/**\n\t\t\t\t * We don't expect point spaces to not have a kind, but in case we encounter one, it's reasonably safe to assume\n\t\t\t\t * it should be a POI.\n\t\t\t\t */\n\t\t\t\t(space.geometry.type === 'Point' && space.properties.kind == null)\n\t\t\t) {\n\t\t\t\tconst newPOI = new PointOfInterest(data, {\n\t\t\t\t\tfloorId,\n\t\t\t\t\tmvfData: space as Feature<Point, SpaceProperties>,\n\t\t\t\t});\n\t\t\t\tpoisById[space.properties.id] = newPOI;\n\t\t\t\tif (!mvfPoisByFloorId[floorId]) {\n\t\t\t\t\tmvfPoisByFloorId[floorId] = [];\n\t\t\t\t}\n\t\t\t\tmvfPoisByFloorId[floorId].push(space as Feature<Point, SpaceProperties>);\n\t\t\t\tif (space.properties.externalId) {\n\t\t\t\t\tif (poisByExternalId[space.properties.externalId] == null) {\n\t\t\t\t\t\tpoisByExternalId[space.properties.externalId] = [];\n\t\t\t\t\t}\n\t\t\t\t\tpoisByExternalId[space.properties.externalId].push(newPOI);\n\t\t\t\t}\n\t\t\t} else if (space.geometry.type === 'Point') {\n\t\t\t\t/**\n\t\t\t\t * If the kind is intentionally not null, but we don't recognize it, it's either a data issue or a new type of feature this\n\t\t\t\t * version of the SDK doesn't support. In both these cases, it's safer to skip it. We definitely don't want point geometries\n\t\t\t\t * to become spaces.\n\t\t\t\t */\n\t\t\t\tLogger.warn('Encountered a point space with an unknown kind!', space.properties.kind);\n\t\t\t} else {\n\t\t\t\t// For now this is only \"default\" or \"hallway\", but more support may be added in the future\n\t\t\t\tconst newSpace = new Space(data, {\n\t\t\t\t\tfloorId,\n\t\t\t\t\tmvfData: space,\n\t\t\t\t});\n\t\t\t\tspacesById[space.properties.id] = newSpace;\n\t\t\t\tif (space.properties.externalId) {\n\t\t\t\t\tif (spacesByExternalId[space.properties.externalId] == null) {\n\t\t\t\t\t\tspacesByExternalId[space.properties.externalId] = [];\n\t\t\t\t\t}\n\t\t\t\t\tspacesByExternalId[space.properties.externalId].push(newSpace);\n\t\t\t\t}\n\t\t\t\tif (!mvfSpacesByFloorId[floorId]) {\n\t\t\t\t\tmvfSpacesByFloorId[floorId] = [];\n\t\t\t\t}\n\t\t\t\tmvfSpacesByFloorId[floorId].push(space);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Now generate a single connection for each connection space that shares a coordinate\n\tfor (const latLonString in connectionIdsByLatLon) {\n\t\tconst connectionIds = connectionIdsByLatLon[latLonString];\n\t\tconst mvfDataByFloorId: Record<string, FeatureCollection<Point, SpaceProperties>['features'][number]> = {};\n\t\tfor (const connectionId of connectionIds) {\n\t\t\tconst floorId = floorIdBySpaceId[connectionId];\n\t\t\tconst mvfConnectionPointSpaceData = mvfSpacesById[connectionId];\n\n\t\t\t// the connection node id minus the 'n_' prefix is the same as the point space id\n\t\t\t// so we can infer the connection data from the point space data\n\t\t\t// and expose the accessible property\n\t\t\tconst mvfConnectionData =\n\t\t\t\tmvfConnectionsByNodeId?.['n_' + mvfConnectionPointSpaceData.properties.id.split('s_')[1]];\n\n\t\t\tmvfDataByFloorId[floorId] = {\n\t\t\t\t...mvfConnectionPointSpaceData,\n\t\t\t\tproperties: {\n\t\t\t\t\t...mvfConnectionPointSpaceData.properties,\n\t\t\t\t\taccessible: mvfConnectionData?.accessible === true,\n\t\t\t\t},\n\t\t\t} as FeatureCollection<Point, SpaceProperties>['features'][number];\n\t\t}\n\n\t\tconst newConnection = new Connection(data, {\n\t\t\tmvfDataByFloorId,\n\t\t});\n\t\tconnectionsById[newConnection.id] = newConnection;\n\t}\n\n\treturn {\n\t\tspacesById,\n\t\tspacesByExternalId,\n\t\tpoisById,\n\t\tpoisByExternalId,\n\t\tconnectionsById,\n\t\tobjectEntranceNodeIdsByObstructionId: objectEntranceNodeIdsByObstructionId,\n\t\tmvfSpacesById,\n\t\tconnectionIdsByLatLon,\n\t\tmvfSpacesByFloorId,\n\t\tmvfPoisByFloorId,\n\t};\n};\n\nexport const processMVFNodes = (\n\tmvf: ParsedMVF,\n\tdata: MapDataInternal,\n): Pick<MapDataRecords, 'nodesById' | 'nodesByExternalId' | 'mvfNodesById' | 'mvfNodesByFloorId'> => {\n\tconst nodesById: MapDataRecords['nodesById'] = {};\n\tconst nodesByExternalId: MapDataRecords['nodesByExternalId'] = {};\n\tconst mvfNodesById: MapDataRecords['mvfNodesById'] = {};\n\tconst mvfNodesByFloorId: MapDataRecords['mvfNodesByFloorId'] = {};\n\n\tfor (const node of mvf['node.geojson'].features) {\n\t\tmvfNodesById[node.properties.id] = node;\n\t\tconst newNode = new Node(data, {\n\t\t\tmvfData: node,\n\t\t\tfloorId: node.properties.floor ?? node.properties.map,\n\t\t});\n\t\tnodesById[node.properties.id] = newNode;\n\t\tif (node.properties.externalId) {\n\t\t\tif (nodesByExternalId[node.properties.externalId] == null) {\n\t\t\t\tnodesByExternalId[node.properties.externalId] = [];\n\t\t\t}\n\t\t\tnodesByExternalId[node.properties.externalId].push(newNode);\n\t\t}\n\t\tconst floorId = node.properties.floor ?? node.properties.map;\n\t\tif (!mvfNodesByFloorId[floorId]) {\n\t\t\tmvfNodesByFloorId[floorId] = [];\n\t\t}\n\t\tmvfNodesByFloorId[floorId].push(node);\n\t}\n\n\treturn {\n\t\tnodesById,\n\t\tnodesByExternalId,\n\t\tmvfNodesById,\n\t\tmvfNodesByFloorId,\n\t};\n};\n\nexport const processMVFObstructions = (\n\tmvf: ParsedMVF,\n\tdata: MapDataInternal,\n): Pick<MapDataRecords, 'objectsById' | 'objectsByExternalId' | 'mvfObstructionById' | 'obstructionIdByEntranceId'> => {\n\tconst objectsById: MapDataRecords['objectsById'] = {};\n\tconst objectsByExternalId: MapDataRecords['objectsByExternalId'] = {};\n\tconst mvfObstructionById: MapDataRecords['mvfObstructionById'] = {};\n\tconst obstructionIdByEntranceId: MapDataRecords['obstructionIdByEntranceId'] = {};\n\n\tconst floorIdsWithObstructions = globalThis.Object.keys(mvf.obstruction);\n\tfor (const floorId of floorIdsWithObstructions) {\n\t\tconst mvfObstructions = mvf.obstruction[floorId];\n\n\t\tif (mvfObstructions == null) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tfor (const obstruction of mvfObstructions.features) {\n\t\t\tmvfObstructionById[obstruction.properties.id] = obstruction;\n\n\t\t\t// Save all the entrances for each obstruction so we can query them later\n\t\t\tfor (const entrance of obstruction.properties.entrances) {\n\t\t\t\tobstructionIdByEntranceId[entrance] = obstruction.properties.id;\n\t\t\t}\n\n\t\t\t// We'll skip creating classes for walls for now since you can't do anything with them\n\t\t\t// We'll also skip areas since they are processed separately and have no style\n\t\t\tif (OBSTRUCTION_KINDS_TO_SKIP.has(obstruction.properties.kind?.toLowerCase() ?? '')) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst newObject = new MapObject(data, {\n\t\t\t\tfloorId,\n\t\t\t\tmvfData: obstruction,\n\t\t\t});\n\t\t\tobjectsById[obstruction.properties.id] = newObject;\n\t\t\tif (obstruction.properties.externalId) {\n\t\t\t\tif (objectsByExternalId[obstruction.properties.externalId] == null) {\n\t\t\t\t\tobjectsByExternalId[obstruction.properties.externalId] = [];\n\t\t\t\t}\n\t\t\t\tobjectsByExternalId[obstruction.properties.externalId].push(newObject);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn {\n\t\tobjectsById,\n\t\tobjectsByExternalId,\n\t\tmvfObstructionById,\n\t\tobstructionIdByEntranceId,\n\t};\n};\n\nexport const processMVFFloors = (\n\tmvf: ParsedMVF,\n\tdata: MapDataInternal,\n): Pick<MapDataRecords, 'floorsById' | 'floorsByExternalId' | 'mvfFloorsById'> => {\n\tconst floorsById: MapDataRecords['floorsById'] = {};\n\tconst floorsByExternalId: MapDataRecords['floorsByExternalId'] = {};\n\tconst mvfFloorsById: MapDataRecords['mvfFloorsById'] = {};\n\n\tif ('floor.geojson' in mvf && mvf['floor.geojson'] != null) {\n\t\tfor (const floor of mvf['floor.geojson'].features) {\n\t\t\tmvfFloorsById[floor.properties.id] = floor.properties;\n\t\t\tconst newFloor = new Floor(data, {\n\t\t\t\tmvfData: floor,\n\t\t\t});\n\t\t\tfloorsById[floor.properties.id] = newFloor;\n\t\t\tif (floor.properties.externalId) {\n\t\t\t\tif (floorsByExternalId[floor.properties.externalId] == null) {\n\t\t\t\t\tfloorsByExternalId[floor.properties.externalId] = [];\n\t\t\t\t}\n\t\t\t\tfloorsByExternalId[floor.properties.externalId].push(newFloor);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfor (const map of mvf['map.geojson']) {\n\t\t\tmvfFloorsById[map.id] = map;\n\t\t\tconst newFloor = new Floor(data, {\n\t\t\t\tmvfData: { properties: map } as any,\n\t\t\t});\n\t\t\tfloorsById[map.id] = newFloor;\n\t\t}\n\t}\n\n\treturn {\n\t\tfloorsById,\n\t\tfloorsByExternalId,\n\t\tmvfFloorsById,\n\t};\n};\n\nexport const processMVFFloorStacks = (\n\tmvf: ParsedMVF,\n\tdata: MapDataInternal,\n): Pick<\n\tMapDataRecords,\n\t'floorStacksById' | 'floorStacksByExternalId' | 'mvfFloorStacksById' | 'facadesById' | 'facadesBySpaceId'\n> => {\n\tconst floorStacksById: MapDataRecords['floorStacksById'] = {};\n\tconst floorStacksByExternalId: MapDataRecords['floorStacksByExternalId'] = {};\n\tconst mvfFloorStacksById: MapDataRecords['mvfFloorStacksById'] = {};\n\tconst facadesById: MapDataRecords['facadesById'] = {};\n\tconst facadesBySpaceId: MapDataRecords['facadesBySpaceId'] = {};\n\n\tconst floorStacks = mvf['floorstack.json'] || mvf['mapstack.json'] || mvf['mapstack.geojson'];\n\tif (floorStacks != null) {\n\t\tfor (const floorStack of floorStacks) {\n\t\t\tconst facade = mvf.facade?.[floorStack.id];\n\n\t\t\tconst newFloorStack = new FloorStack(data, {\n\t\t\t\tmvfData: floorStack,\n\t\t\t\tfacadeId: facade?.id,\n\t\t\t});\n\n\t\t\tfloorStacksById[floorStack.id] = newFloorStack;\n\t\t\tif (floorStack.externalId) {\n\t\t\t\tif (floorStacksByExternalId[floorStack.externalId] == null) {\n\t\t\t\t\tfloorStacksByExternalId[floorStack.externalId] = [];\n\t\t\t\t}\n\t\t\t\tfloorStacksByExternalId[floorStack.externalId].push(newFloorStack);\n\t\t\t}\n\t\t\tmvfFloorStacksById[floorStack.id] = floorStack;\n\n\t\t\tif (facade) {\n\t\t\t\tconst newFacade = new Facade(data, {\n\t\t\t\t\tmvfData: facade,\n\t\t\t\t\tfloorStackId: floorStack.id,\n\t\t\t\t});\n\t\t\t\tfacadesById[facade.id] = newFacade;\n\t\t\t\tfor (const space of facade.spaces) {\n\t\t\t\t\tfacadesBySpaceId[space.spaceId] = newFacade;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn {\n\t\tfloorStacksById,\n\t\tfloorStacksByExternalId,\n\t\tmvfFloorStacksById,\n\t\tfacadesById,\n\t\tfacadesBySpaceId,\n\t};\n};\n\nexport const processMVFConnections = (\n\tmvf: ParsedMVF,\n\tmvfNodesById?: MapDataRecords['mvfNodesById'],\n): Pick<MapDataRecords, 'mvfConnectionsById' | 'mvfConnectionsByNodeId' | 'mvfConnectionIdsByLatLon'> => {\n\tconst mvfConnectionsById: MapDataRecords['mvfConnectionsById'] = {};\n\tconst mvfConnectionIdsByLatLon: MapDataRecords['mvfConnectionIdsByLatLon'] = {};\n\tconst mvfConnectionsByNodeId = mvf['connection.json'].reduce((acc, connection) => {\n\t\tconnection.nodes.forEach(nodeId => (acc[nodeId] = connection));\n\t\tmvfConnectionsById[connection.id] = connection;\n\t\tconst firstNode = mvfNodesById?.[connection.nodes[0]];\n\t\tif (firstNode != null) {\n\t\t\tconst latLonString = serializeCoords(firstNode.geometry.coordinates);\n\t\t\tif (mvfConnectionIdsByLatLon[latLonString] == null) {\n\t\t\t\tmvfConnectionIdsByLatLon[latLonString] = [];\n\t\t\t}\n\t\t\tmvfConnectionIdsByLatLon[latLonString].push(connection.id);\n\t\t}\n\n\t\treturn acc;\n\t}, {} as MapDataRecords['mvfConnectionsByNodeId']);\n\n\treturn {\n\t\tmvfConnectionsById,\n\t\tmvfConnectionsByNodeId,\n\t\tmvfConnectionIdsByLatLon,\n\t};\n};\n\nexport const processMVFEntrances = (\n\tmvf: ParsedMVF,\n\tdata: MapDataInternal,\n): Pick<\n\tMapDataRecords,\n\t'doorsById' | 'doorsByExternalId' | 'doorsByNodeId' | 'mvfEntrancesById' | 'mvfEntrancesByFloorId'\n> => {\n\tconst doorsById: MapDataRecords['doorsById'] = {};\n\tconst doorsByExternalId: MapDataRecords['doorsByExternalId'] = {};\n\tconst doorsByNodeId: MapDataRecords['doorsByNodeId'] = {};\n\tconst mvfEntrancesById: MapDataRecords['mvfEntrancesById'] = {};\n\tconst mvfEntrancesByFloorId: MapDataRecords['mvfEntrancesByFloorId'] = {};\n\tconst floorIdsWithEntrances = globalThis.Object.keys(mvf.entrance);\n\tfor (const floorId of floorIdsWithEntrances) {\n\t\tconst mvfEntrances = mvf.entrance[floorId];\n\n\t\tif (mvfEntrances == null) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tfor (const entrance of mvfEntrances.features) {\n\t\t\tmvfEntrancesById[entrance.properties.id] = entrance;\n\t\t\tconst newDoor = new Door(data, {\n\t\t\t\tfloorId,\n\t\t\t\tmvfData: entrance,\n\t\t\t});\n\n\t\t\tif (entrance.properties.node) doorsByNodeId[entrance.properties.node] = newDoor;\n\n\t\t\tdoorsById[entrance.properties.id] = newDoor;\n\t\t\tif (entrance.properties.externalId) {\n\t\t\t\tif (doorsByExternalId[entrance.properties.externalId] == null) {\n\t\t\t\t\tdoorsByExternalId[entrance.properties.externalId] = [];\n\t\t\t\t}\n\t\t\t\tdoorsByExternalId[entrance.properties.externalId].push(newDoor);\n\t\t\t}\n\t\t\tif (!mvfEntrancesByFloorId[floorId]) {\n\t\t\t\tmvfEntrancesByFloorId[floorId] = [];\n\t\t\t}\n\t\t\tmvfEntrancesByFloorId[floorId].push(entrance);\n\t\t}\n\t}\n\n\treturn {\n\t\tdoorsById,\n\t\tdoorsByExternalId,\n\t\tdoorsByNodeId,\n\t\tmvfEntrancesById,\n\t\tmvfEntrancesByFloorId,\n\t};\n};\n\nconst processMVFTextAreas = (\n\tmvf: ParsedMVF,\n\tspacesById: MapDataRecords['mvfSpacesById'],\n\tobstructionsById: MapDataRecords['mvfObstructionById'],\n): void => {\n\tif (mvf.textAreas == null) {\n\t\treturn;\n\t}\n\n\tfor (const floorId in mvf.textAreas) {\n\t\tconst mvfTextAreas = mvf.textAreas[floorId]?.features;\n\n\t\tif (mvfTextAreas == null) {\n\t\t\tcontinue;\n\t\t}\n\n\t\t// iterate through all images on a floor and assign them to the correct space or obstruction\n\t\tfor (const feature of mvfTextAreas) {\n\t\t\tif ('anchorId' in feature.properties) {\n\t\t\t\tconst anchoredTextArea = feature?.properties;\n\t\t\t\tconst polygonOrObstruction =\n\t\t\t\t\tspacesById[anchoredTextArea.anchorId] || obstructionsById[anchoredTextArea.anchorId];\n\t\t\t\tif (polygonOrObstruction != null && anchoredTextArea != null) {\n\t\t\t\t\tconst properties = polygonOrObstruction.properties as WithTextArea<WithPolygonImage<SpaceProperties>>;\n\t\t\t\t\tproperties.textArea = anchoredTextArea;\n\t\t\t\t\tif (properties.textArea) {\n\t\t\t\t\t\t// @TODO: figure out how to type this better. The SDK expects a position, but the MVF doesn't have it\n\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\tproperties.textArea.position = feature.geometry.coordinates;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\n\nexport const processMVFPolygonImages = (\n\tmvf: ParsedMVF,\n\tspacesById: MapDataRecords['mvfSpacesById'],\n\tobstructionsById: MapDataRecords['mvfObstructionById'],\n): void => {\n\tif (mvf.floorImages == null) {\n\t\treturn;\n\t}\n\n\tfor (const floorId in mvf.floorImages) {\n\t\tconst mvfMapImages = mvf.floorImages[floorId]?.features;\n\n\t\tif (mvfMapImages == null) {\n\t\t\tcontinue;\n\t\t}\n\n\t\t// iterate through all images on a floor and assign them to the correct space or obstruction\n\t\tfor (const feature of mvfMapImages) {\n\t\t\tif ('anchorId' in feature.properties) {\n\t\t\t\tconst anchoredImage = feature?.properties;\n\t\t\t\tconst polygonOrObstruction = spacesById[anchoredImage.anchorId] || obstructionsById[anchoredImage.anchorId];\n\t\t\t\tif (polygonOrObstruction != null && anchoredImage != null) {\n\t\t\t\t\tconst properties = polygonOrObstruction.properties as WithPolygonImage<SpaceProperties>;\n\t\t\t\t\tproperties.image = anchoredImage;\n\t\t\t\t\tif (properties.image) {\n\t\t\t\t\t\t// @TODO: figure out how to type this better. The SDK expects a position, but the MVF doesn't have it\n\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\tproperties.image.position = feature.geometry.coordinates;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\n\nconst processMVFEnterprisePolygonStyles = (mvf: ParsedMVF, spacesById: MapDataRecords['mvfSpacesById']): void => {\n\tif (mvf.enterprise?.enterpriseStyles == null) {\n\t\treturn;\n\t}\n\n\tconst styleMap = mvf.enterprise?.enterpriseStyles;\n\n\tfor (const styleId in styleMap) {\n\t\tconst style = styleMap[styleId];\n\t\tstyle.geometryAnchors.forEach(anchor => {\n\t\t\tconst polygon = spacesById[anchor.geometryId];\n\t\t\tif (polygon != null) {\n\t\t\t\tconst properties = polygon.properties as WithEntepriseStyle<SpaceProperties>;\n\t\t\t\tproperties.style = { styleId, edgeOffset: style.edgeOffset };\n\t\t\t}\n\t\t});\n\t}\n};\n\nexport const processMVFEnterpriseTextures = (\n\tmvf: ParsedMVF,\n\tspacesById: MapDataRecords['mvfSpacesById'],\n\tobstructionsById: MapDataRecords['mvfObstructionById'],\n): void => {\n\tif (mvf.enterprise == null || mvf.enterprise['textures'] == null) {\n\t\treturn;\n\t}\n\n\tfor (const texture of mvf.enterprise['textures']) {\n\t\tfor (const anchor of texture.geometryAnchors) {\n\t\t\tconst polygonOrObstruction = spacesById[anchor.geometryId] || obstructionsById[anchor.geometryId];\n\t\t\tif (polygonOrObstruction != null) {\n\t\t\t\tconst properties = polygonOrObstruction.properties as WithTextures<SpaceProperties>;\n\t\t\t\tif (properties.textures == null) {\n\t\t\t\t\tproperties.textures = [];\n\t\t\t\t}\n\t\t\t\tproperties.textures.push(texture);\n\t\t\t}\n\t\t}\n\t}\n};\n\nexport const processMVFAnnotations = (\n\tmvf: ParsedMVF,\n\tdata: MapDataInternal,\n): Pick<MapDataRecords, 'annotationsById' | 'mvfAnnotationsById' | 'mvfAnnotationsByFloorId'> => {\n\tconst annotationsById: MapDataRecords['annotationsById'] = {};\n\tconst mvfAnnotationsById: MapDataRecords['mvfAnnotationsById'] = {};\n\tconst mvfAnnotationsByFloorId: MapDataRecords['mvfAnnotationsByFloorId'] = {};\n\t// const nodeIdsByAnnotationId: MapDataRecords['nodeIdsByAnnotationId'] = {};\n\n\tif (mvf.annotation == null) {\n\t\treturn {\n\t\t\tannotationsById,\n\t\t\tmvfAnnotationsById,\n\t\t\tmvfAnnotationsByFloorId,\n\t\t};\n\t}\n\n\tconst floorIdsWithAnnotations = globalThis.Object.keys(mvf.annotation);\n\tfor (const floorId of floorIdsWithAnnotations) {\n\t\tconst mvfAnnotations = mvf.annotation[floorId];\n\n\t\tif (mvfAnnotations == null) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tfor (const annotation of mvfAnnotations.features) {\n\t\t\tmvfAnnotationsById[annotation.properties.id] = annotation;\n\t\t\tconst newAnnotation = new Annotation(data, {\n\t\t\t\tfloorId,\n\t\t\t\tmvfData: annotation,\n\t\t\t});\n\t\t\tannotationsById[annotation.properties.id] = newAnnotation;\n\t\t\tif (!mvfAnnotationsByFloorId[floorId]) {\n\t\t\t\tmvfAnnotationsByFloorId[floorId] = [];\n\t\t\t}\n\t\t\tmvfAnnotationsByFloorId[floorId].push(annotation);\n\t\t}\n\t}\n\n\treturn {\n\t\tannotationsById,\n\t\tmvfAnnotationsById,\n\t\tmvfAnnotationsByFloorId,\n\t};\n};\n\nexport const processMVFAreas = (\n\tmvf: ParsedMVF,\n\tdata: MapDataInternal,\n): Pick<MapDataRecords, 'areasById' | 'areasByExternalId' | 'mvfAreasById'> => {\n\tconst areasById: MapDataRecords['areasById'] = {};\n\tconst areasByExternalId: MapDataRecords['areasByExternalId'] = {};\n\tconst mvfAreasById: MapDataRecords['mvfAreasById'] = {};\n\n\tif (mvf.area == null) {\n\t\treturn {\n\t\t\tareasById,\n\t\t\tareasByExternalId,\n\t\t\tmvfAreasById,\n\t\t};\n\t}\n\n\tconst floorIdsWithAreas = globalThis.Object.keys(mvf.area);\n\tfor (const floorId of floorIdsWithAreas) {\n\t\tconst mvfAreas = mvf.area[floorId];\n\n\t\tif (mvfAreas == null) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tfor (const area of mvfAreas.features) {\n\t\t\tmvfAreasById[area.properties.id] = area;\n\t\t\tconst newArea = new Area(data, {\n\t\t\t\tfloorId,\n\t\t\t\tmvfData: area,\n\t\t\t});\n\t\t\tareasById[area.properties.id] = newArea;\n\t\t\tif (area.properties.externalId) {\n\t\t\t\tif (areasByExternalId[area.properties.externalId] == null) {\n\t\t\t\t\tareasByExternalId[area.properties.externalId] = [];\n\t\t\t\t}\n\t\t\t\tareasByExternalId[area.properties.externalId].push(newArea);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn {\n\t\tareasById,\n\t\tareasByExternalId,\n\t\tmvfAreasById,\n\t};\n};\n\nexport const processDestinationNodes = (\n\tmvfSpacesById: MapDataRecords['mvfSpacesById'],\n\tdoorsByNodeId: MapDataRecords['doorsByNodeId'],\n): Pick<\n\tMapDataRecords,\n\t'entranceNodeIdsBySpaceId' | 'spaceIdsByNodeId' | 'objectIdsByNodeId' | 'destinationNodesIdsBySpaceId'\n> => {\n\tconst entranceNodeIdsBySpaceId: MapDataRecords['entranceNodeIdsBySpaceId'] = {};\n\tconst spaceIdsByNodeId: MapDataRecords['spaceIdsByNodeId'] = {};\n\tconst objectIdsByNodeId: MapDataRecords['objectIdsByNodeId'] = {};\n\tconst destinationNodesIdsBySpaceId: MapDataRecords['destinationNodesIdsBySpaceId'] = {};\n\n\t/**\n\t * Precompute the destinationNodes for each space which are doors.\n\t * This is necessary to reduce the A* search from thousands of nodes.\n\t */\n\tfor (const spaceId in mvfSpacesById) {\n\t\tconst mvfSpace = mvfSpacesById[spaceId];\n\t\tif (mvfSpace == null) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst destinationNodes = mvfSpace.properties.destinationNodes ?? [];\n\t\tif (destinationNodes.length < 1) continue;\n\t\tconst entranceNodes: string[] = [];\n\t\tfor (const nodeId of destinationNodes) {\n\t\t\tif (doorsByNodeId[nodeId] != null) {\n\t\t\t\tentranceNodes.push(nodeId);\n\t\t\t}\n\n\t\t\tif (spaceIdsByNodeId[nodeId] == null) {\n\t\t\t\tspaceIdsByNodeId[nodeId] = [];\n\t\t\t}\n\t\t\tspaceIdsByNodeId[nodeId].push(mvfSpace.properties.id);\n\n\t\t\tif (mvfSpace.properties.kind === 'desk-entrance') {\n\t\t\t\t/**\n\t\t\t\t * Objects are related to nodes through spaces (usually point or line geometries) with kind \"desk-entrance\".\n\t\t\t\t * These spaces have the object's nodes as destination nodes and the object's id as the externalId.\n\t\t\t\t */\n\t\t\t\tif (objectIdsByNodeId[nodeId] == null) {\n\t\t\t\t\tobjectIdsByNodeId[nodeId] = [];\n\t\t\t\t}\n\t\t\t\tobjectIdsByNodeId[nodeId].push(mvfSpace.properties.externalId);\n\t\t\t}\n\t\t}\n\t\tif (entranceNodes.length > 0) {\n\t\t\tentranceNodeIdsBySpaceId[spaceId] = entranceNodes;\n\t\t}\n\t\tdestinationNodesIdsBySpaceId[spaceId] = destinationNodes;\n\t}\n\n\treturn {\n\t\tentranceNodeIdsBySpaceId,\n\t\tspaceIdsByNodeId,\n\t\tobjectIdsByNodeId,\n\t\tdestinationNodesIdsBySpaceId,\n\t};\n};\n\n/**\n * @internal\n */\nexport const createEnterpriseDataFromMVF = (mvf: ParsedMVF, data: MapDataInternal): EnterpriseMapDataRecords => {\n\tconst connectionsById: MapDataRecords['connectionsById'] = {};\n\tconst connectionsByExternalId: EnterpriseMapDataRecords['connectionsByExternalId'] = {};\n\tconst locationsById: EnterpriseMapDataRecords['locationsById'] = {};\n\tconst locationsByExternalId: EnterpriseMapDataRecords['locationsByExternalId'] = {};\n\tconst mvfLocationsById: EnterpriseMapDataRecords['mvfLocationsById'] = (mvf.enterprise?.locations ?? []).reduce(\n\t\t(acc, location) => {\n\t\t\tacc[location.id] = location;\n\n\t\t\treturn acc;\n\t\t},\n\t\t{} as EnterpriseMapDataRecords['mvfLocationsById'],\n\t);\n\tconst categoriesById: EnterpriseMapDataRecords['categoriesById'] = {};\n\tconst categoriesByExternalId: EnterpriseMapDataRecords['categoriesByExternalId'] = {};\n\tconst mvfCategoriesById: EnterpriseMapDataRecords['mvfCategoriesById'] = {};\n\tconst mvfLocationsByGeometryId: EnterpriseMapDataRecords['mvfLocationsByGeometryId'] = {};\n\tconst categoryIdsByLocationId: Record<string, MVFEnterpriseCategory['id'][]> = {};\n\tconst locationIdsByNodeId: EnterpriseMapDataRecords['locationIdsByNodeId'] = {};\n\tconst venue: EnterpriseMapDataRecords['venue'] = mvf.enterprise?.venue || ({} as MVFEnterpriseVenue);\n\tconst locationInstancesById: EnterpriseMapDataRecords['locationInstancesById'] = {};\n\n\tfor (const category of mvf.enterprise?.categories ?? []) {\n\t\tconst newCategory = new EnterpriseCategory(data, { mvfData: category });\n\t\tcategoriesById[category.id] = newCategory;\n\t\tif (category.externalId) {\n\t\t\tif (categoriesByExternalId[category.externalId] == null) {\n\t\t\t\tcategoriesByExternalId[category.externalId] = [];\n\t\t\t}\n\t\t\tcategoriesByExternalId[category.externalId].push(newCategory);\n\t\t}\n\t\tmvfCategoriesById[category.id] = category;\n\n\t\tcategory.locations.forEach(locationId => {\n\t\t\tif (categoryIdsByLocationId[locationId] == null) {\n\t\t\t\tcategoryIdsByLocationId[locationId] = [];\n\t\t\t}\n\t\t\tcategoryIdsByLocationId[locationId].push(category.id);\n\t\t});\n\t}\n\n\tconst locationInstancesByParentId: Record<string, EnterpriseLocation[]> = {};\n\tfor (const locationInstance of mvf.enterprise?.locationInstances ?? []) {\n\t\tconst mvfLocation = mvfLocationsById[locationInstance.parent];\n\n\t\t// extract all keys from the parent location\n\t\t// so they can be used in getters, without copying the entire parent location\n\t\tconst parentKeys = Object.keys(mvfLocation);\n\t\tconst keysObject = {};\n\t\tfor (const key of parentKeys) {\n\t\t\tkeysObject[key] = undefined;\n\t\t}\n\n\t\t// create a new location object with the parent's keys, but undefined values\n\t\t// this is so that when we get the properties, we can check if the instance has a value for it\n\t\t// if not, we can fallback to the parent's value\n\t\tconst location = {\n\t\t\t...keysObject,\n\t\t\tpolygons: [], // A location instance should have nodes and polygons set to what it's attached to, but it's not actually enforced by the spec.\n\t\t\tnodes: [], // So the SDK will set them to empty arrays before applying the location instance's optional properties.\n\t\t\t...locationInstance,\n\t\t};\n\n\t\tif (locationInstancesByParentId[location.parent] == null) {\n\t\t\tlocationInstancesByParentId[location.parent] = [];\n\t\t}\n\t\tlocationInstancesByParentId[location.parent].push(\n\t\t\tnew EnterpriseLocation(data, {\n\t\t\t\tmvfData: location as MVFEnterpriseLocation,\n\t\t\t\tcategoryIds: mvf.enterprise?.categoryPriorities?.[location.id] || categoryIdsByLocationId[location.id],\n\t\t\t\tparentId: locationInstance.parent,\n\t\t\t}),\n\t\t);\n\t\tlocationInstancesById[location.id] = locationInstance;\n\t}\n\n\tfor (const location of mvf.enterprise?.locations ?? []) {\n\t\tconst newLocation = new EnterpriseLocation(data, {\n\t\t\tmvfData: location,\n\t\t\tcategoryIds: mvf.enterprise?.categoryPriorities?.[location.id] || categoryIdsByLocationId[location.id],\n\t\t\tlocationInstances: locationInstancesByParentId[location.id],\n\t\t});\n\t\tlocationsById[location.id] = newLocation;\n\t\tif (location.externalId) {\n\t\t\tif (locationsByExternalId[location.externalId] == null) {\n\t\t\t\tlocationsByExternalId[location.externalId] = [];\n\t\t\t}\n\t\t\tlocationsByExternalId[location.externalId].push(newLocation);\n\t\t}\n\n\t\tlocation.nodes.forEach(node => {\n\t\t\tif (locationIdsByNodeId[node.id] == null) {\n\t\t\t\tlocationIdsByNodeId[node.id] = [];\n\t\t\t}\n\t\t\tlocationIdsByNodeId[node.id].push(location.id);\n\t\t});\n\n\t\tfor (const polygon of location.polygons) {\n\t\t\tif (mvfLocationsByGeometryId[polygon.id] == null) {\n\t\t\t\tmvfLocationsByGeometryId[polygon.id] = [];\n\t\t\t}\n\t\t\tmvfLocationsByGeometryId[polygon.id].push(location);\n\t\t}\n\t}\n\n\tif (data.enterpriseMode === true) {\n\t\tfor (const connectionId in data.mvfConnectionsById) {\n\t\t\tconst mvfData: Record<\n\t\t\t\tstring,\n\t\t\t\tFeature<Point, MVFConnection & { kind: string; destinationNodes: string[]; flags: '' }>\n\t\t\t> = {};\n\t\t\tconst mvfConnection = data.mvfConnectionsById[connectionId];\n\t\t\tfor (const nodeId of data.mvfConnectionsById[connectionId].nodes) {\n\t\t\t\tconst connectionNode = data.nodesById[nodeId];\n\t\t\t\tif (connectionNode != null) {\n\t\t\t\t\tmvfData[connectionNode.floor.id] = {\n\t\t\t\t\t\ttype: 'Feature',\n\t\t\t\t\t\tgeometry: {\n\t\t\t\t\t\t\ttype: 'Point',\n\t\t\t\t\t\t\tcoordinates: [connectionNode.coordinate.longitude, connectionNode.coordinate.latitude],\n\t\t\t\t\t\t},\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tid: connectionId,\n\t\t\t\t\t\t\texternalId: mvfConnection.externalId,\n\t\t\t\t\t\t\tkind: 'enterprise.' + mvfConnection.type,\n\t\t\t\t\t\t\tdestinationNodes: [],\n\t\t\t\t\t\t\tflags: '',\n\t\t\t\t\t\t\ttype: mvfConnection.type,\n\t\t\t\t\t\t\tnodes: mvfConnection.nodes,\n\t\t\t\t\t\t\taccessible: mvfConnection.accessible,\n\t\t\t\t\t\t\textra: mvfConnection.extra,\n\t\t\t\t\t\t\tdetails: mvfConnection.details,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (Object.keys(mvfData).length > 0) {\n\t\t\t\tconnectionsById[connectionId] = new Connection(data, {\n\t\t\t\t\tmvfDataByFloorId: mvfData,\n\t\t\t\t});\n\t\t\t\tif (mvfConnection.externalId) {\n\t\t\t\t\tif (connectionsByExternalId[mvfConnection.externalId] == null) {\n\t\t\t\t\t\tconnectionsByExternalId[mvfConnection.externalId] = [];\n\t\t\t\t\t}\n\t\t\t\t\tconnectionsByExternalId[mvfConnection.externalId].push(connectionsById[connectionId]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tdata.connectionsById = connectionsById;\n\t}\n\n\treturn {\n\t\tconnectionsByExternalId,\n\t\tlocationIdsByNodeId,\n\t\tmvfLocationsByGeometryId,\n\t\tmvfLocationsById,\n\t\tmvfCategoriesById,\n\t\tlocationsById,\n\t\tlocationsByExternalId,\n\t\tlocationInstancesById,\n\t\tcategoriesById,\n\t\tcategoriesByExternalId,\n\t\tvenue,\n\t};\n};\n\n/**\n * @internal\n */\nexport const createDataFromMVF = (mvf: ParsedMVF, data: MapDataInternal): MapDataRecords => {\n\tconst { nodesById, nodesByExternalId, mvfNodesById, mvfNodesByFloorId } = processMVFNodes(mvf, data);\n\tconst { mvfConnectionsById, mvfConnectionsByNodeId, mvfConnectionIdsByLatLon } = processMVFConnections(\n\t\tmvf,\n\t\tmvfNodesById,\n\t);\n\n\tconst {\n\t\tspacesById,\n\t\tspacesByExternalId,\n\t\tpoisById,\n\t\tpoisByExternalId,\n\t\tmvfSpacesById,\n\t\tobjectEntranceNodeIdsByObstructionId,\n\t\tconnectionsById,\n\t\tconnectionIdsByLatLon,\n\t\tmvfSpacesByFloorId,\n\t\tmvfPoisByFloorId,\n\t} = processMVFSpaces(mvf, mvfConnectionsByNodeId, data);\n\n\tconst { objectsById, objectsByExternalId, mvfObstructionById, obstructionIdByEntranceId } = processMVFObstructions(\n\t\tmvf,\n\t\tdata,\n\t);\n\tconst { floorsById, floorsByExternalId, mvfFloorsById } = processMVFFloors(mvf, data);\n\tconst { floorStacksById, floorStacksByExternalId, mvfFloorStacksById, facadesById, facadesBySpaceId } =\n\t\tprocessMVFFloorStacks(mvf, data);\n\n\tconst { doorsById, doorsByExternalId, doorsByNodeId, mvfEntrancesById, mvfEntrancesByFloorId } = processMVFEntrances(\n\t\tmvf,\n\t\tdata,\n\t);\n\tconst { annotationsById, mvfAnnotationsById, mvfAnnotationsByFloorId } = processMVFAnnotations(mvf, data);\n\tconst { areasById, areasByExternalId, mvfAreasById } = processMVFAreas(mvf, data);\n\tprocessMVFPolygonImages(mvf, mvfSpacesById, mvfObstructionById);\n\tprocessMVFTextAreas(mvf, mvfSpacesById, mvfObstructionById);\n\tprocessMVFEnterprisePolygonStyles(mvf, mvfSpacesById);\n\tprocessMVFEnterpriseTextures(mvf, mvfSpacesById, mvfObstructionById);\n\n\tconst {\n\t\tlocationCategoriesByParentId,\n\t\tlocationProfilesById,\n\t\tlocationCategoriesById,\n\t\tlocationProfilesByExternalId,\n\t\tlocationProfilesByCategoryId,\n\t\tlocationProfilesByAttachedFeatureId,\n\t} = processMVFLocationProfilesAndCategories(mvf, data);\n\n\tconst { entranceNodeIdsBySpaceId, spaceIdsByNodeId, objectIdsByNodeId, destinationNodesIdsBySpaceId } =\n\t\tprocessDestinationNodes(mvfSpacesById, doorsByNodeId);\n\n\treturn {\n\t\tspacesById,\n\t\tspacesByExternalId,\n\t\tnodesById,\n\t\tnodesByExternalId,\n\t\tobjectsById,\n\t\tobjectsByExternalId,\n\t\tfloorsById,\n\t\tfloorsByExternalId,\n\t\tfloorStacksById,\n\t\tfloorStacksByExternalId,\n\t\tfacadesById,\n\t\tfacadesBySpaceId,\n\t\tconnectionsById,\n\t\tdoorsById,\n\t\tdoorsByExternalId,\n\t\tdoorsByNodeId,\n\t\tpoisById,\n\t\tpoisByExternalId,\n\t\tannotationsById,\n\t\tareasById,\n\t\tareasByExternalId,\n\t\tobjectEntranceNodeIdsByObstructionId,\n\t\tobstructionIdByEntranceId,\n\t\tconnectionIdsByLatLon,\n\t\tlocationProfilesById,\n\t\tlocationCategoriesById,\n\t\tlocationProfilesByExternalId,\n\t\tlocationProfilesByCategoryId,\n\t\tlocationCategoriesByParentId,\n\t\tmvfSpacesById,\n\t\tmvfNodesById,\n\t\tmvfObstructionById,\n\t\tmvfFloorsById,\n\t\tmvfFloorStacksById,\n\t\tmvfConnectionsById,\n\t\tmvfConnectionsByNodeId,\n\t\tmvfEntrancesById,\n\t\tmvfAnnotationsById,\n\t\tmvfNodesByFloorId,\n\t\tmvfSpacesByFloorId,\n\t\tmvfPoisByFloorId,\n\t\tmvfAreasById,\n\t\tmvfEntrancesByFloorId,\n\t\tmvfAnnotationsByFloorId,\n\t\tlocationProfilesByAttachedFeatureId,\n\t\tmvfConnectionIdsByLatLon,\n\t\tentranceNodeIdsBySpaceId,\n\t\tspaceIdsByNodeId,\n\t\tobjectIdsByNodeId,\n\t\tdestinationNodesIdsBySpaceId,\n\t};\n};\n\nfunction shouldSkipSpace(space: SpaceCollection['features'][number]) {\n\treturn (\n\t\t/**\n\t\t * Ben Liu, 2025-09-18\n\t\t *\n\t\t * Polygonal spaces we can always create, because they must get rendered. However point and line geometries\n\t\t * should generally not be created as spaces. We should create them as POIs or Connections or whatnot depending\n\t\t * on their kind. If they have an undefined kind, then we don't know what to do with them, so we skip them.\n\t\t * However, if the kind key is not present, that is indicative of an old MVF and we should load it as a space;\n\t\t * this is mostly relevant for tests.\n\t\t */\n\t\t(!['Polygon', 'MultiPolygon'].includes(space.geometry.type) &&\n\t\t\t'kind' in space.properties &&\n\t\t\tspace.properties.kind == null) ||\n\t\tSPACE_KINDS_TO_SKIP.has(space.properties.kind ?? '')\n\t);\n}\n", "/* eslint-disable @typescript-eslint/ban-ts-comment */\nimport type {\n\tEnterpriseLocation as MVFEnterpriseLocation,\n\tLocationState,\n\tOperationHours,\n\tSiblingGroup,\n} from '@mappedin/mvf-v2';\nimport type { Coordinate, EnterpriseCategory, MapDataInternal, MapObject, PointOfInterest, Space } from '.';\nimport type Node from './node';\nimport BaseMetaData from './base-metadata-object';\nimport type { IFocusable } from '../types';\nimport type { Writable } from 'type-fest';\n\nconst skipProps = new Set(['polygons']);\n\n/**\n * An EnterpriseLocation contains metadata about a location, such as its name, description, logo, phone number, social medial links, hours of operation and more.\n * They can be accessed using the {@link MapData.getByType} method as shown below.\n *\n * ```typescript\n * const allLocations = mapData.getByType('enterprise-location');\n * ```\n *\n * Refer to the [EnterpriseLocation Guide](https://developer.mappedin.com/web-sdk/enterprise-data#enterprise-locations) for more information and interactive examples.\n */\nclass EnterpriseLocation\n\textends BaseMetaData\n\timplements Omit<MVFEnterpriseLocation, 'polygons' | 'nodes' | 'links' | 'spaces' | 'categories'>, IFocusable\n{\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'enterprise-location';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = EnterpriseLocation.__type;\n\n\t/**\n\t * The description of the location.\n\t */\n\tdescription?: string | undefined;\n\t/**\n\t * The name of the location.\n\t */\n\tname = '';\n\t/**\n\t * The amenity of the location.\n\t */\n\tamenity?: string | undefined;\n\t/**\n\t * The external ID of the location.\n\t */\n\texternalId = '';\n\t/**\n\t * Extra properties of the location.\n\t */\n\textra?: Record<string, unknown> | undefined;\n\t/**\n\t * The gallery of the location.\n\t */\n\tgallery?: { caption?: string | null; image: string; embeddedUrl?: string | null }[] | undefined;\n\n\t/**\n\t * Specific instances of this location with different properties.\n\t * Typically, there will be at least one node or polygon defined,\n\t * plus one or more other properties that are different from the parent.\n\t * The remaining properties will be the same as the parent.\n\n\t * For example, suppose there is a location like this:\n\t *\n\t * ```json\n\t * {\n\t *   \"id\": \"location-id-1\",\n\t *   \"name\": \"Location 1\",\n\t *   \"nodes\": [\"node-1\", \"node-2\"],\n\t *   \"polygons\": [\"polygon-1\", \"polygon-2\"],\n\t *   \"externalId\": \"externalId-1\",\n\t *   \"description\": \"Description 1\",\n\t * }\n\t * ```\n\t *\n\t * (Note that for clarity, this example puts strings in for nodes and polygons, but in practice they would be objects.)\n\t *\n\t * Then suppose it had an `instances` array that contained an object that looked like this:\n\t *\n\t * ```json\n\t * {\n\t *   \"id\": \"instance-id-1\",\n\t *   \"name\": \"Location 1 - A\",\n\t *   \"nodes\": [\"node-1\"],\n\t *   \"polygons\": [\"polygon-1\"],\n\t *   \"externalId\": \"externalId-1-A\",\n\t *   \"description\": \"Description 1\",\n\t * }\n\t * ```\n\t * This says \"Location 1\" is the parent location, and \"Location 1 - A\" is an instance of it. The instance has a different name, and a different external ID, and it only applies to node `node-1` and polygon `polygon-1`.\n\t * The ID will always be different, but other properties (like the description) are the same as the parent.\n\t *\n\t * Example use cases:\n\t * - A Mall may have a location with two nodes and one polygon. It may then have an instance with one of the nodes, and operating hours\n\t * that are different from the parent. This indicates that this instance is an entrance for the location that is accessible at different times, perhaps for an interior mall entrance, when the main location (and other, exterior entrance) is open later than the rest of the mall.\n\t * - An airport may have a location with several polygons and nodes, and an instance for each node (and corresponding polygon, if any) with a different siblingGroup. The location in the sibling group may be the airport terminal, or airside vs landside.\n\t * This would allow an application to show the location once in a search result, but offer UX to select the instance that is in the right terminal.\n\t *\n\t * Note: Instances are actual EnterpriseLocations. This means they have all the properties of a normal EnterpriseLocation, including an `instances` property, that will always be undefined. They also do NOT have a parent property, or any other explicit reference to the parent location. These instances are\n\t * only referenced from their parent location, and will not show up in other places in the map data. However, they should otherwise behave like normal EnterpriseLocations, being targetable for things like navigation and focus.\n\t */\n\tinstances?: EnterpriseLocation[] | undefined;\n\t/**\n\t * A URL to the logo of the location.\n\t */\n\tlogo?: string | undefined;\n\t/**\n\t * The operation hours of the location.\n\t */\n\toperationHours?: OperationHours[] | undefined;\n\t/**\n\t * The phone number of the location.\n\t */\n\tphone?: { number: string; extension?: string } | undefined;\n\t/**\n\t * A URL to the picture of the location.\n\t */\n\tpicture?: string | undefined;\n\t/**\n\t * The short name of the location.\n\t */\n\tshortName?: string | undefined;\n\t/**\n\t * Whether to show the floating label when an image is present.\n\t */\n\tshowFloatingLabelWhenImagePresent?: boolean | undefined;\n\t/**\n\t * Whether to show the logo.\n\t */\n\tshowLogo?: boolean | undefined;\n\t/**\n\t * The sibling groups of the location.\n\t */\n\tsiblingGroups?: SiblingGroup[] | undefined;\n\t/**\n\t * The social media links of the location.\n\t */\n\tsocial?: { facebook?: string; instagram?: string; twitter?: string; website?: string } | undefined;\n\t/**\n\t * The sort order of the location.\n\t */\n\tsortOrder = -1;\n\t/**\n\t * The {@link LocationState}s of the location.\n\t */\n\tstates?: LocationState[] | undefined;\n\t/**\n\t * The tags of the location.\n\t */\n\ttags?: string[] | undefined;\n\t/**\n\t * The type of the location.\n\t */\n\ttype = '';\n\t/**\n\t * Whether the location has been marked as hidden.\n\t */\n\thidden = false;\n\n\tprimaryCategory?: string | undefined;\n\n\t#data: MapDataInternal;\n\t#cache: Partial<Writable<EnterpriseLocation>> = {};\n\t#mvfData: MVFEnterpriseLocation;\n\t#categoryIds: string[];\n\n\t/**\n\t * Checks if the provided instance is of type EnterpriseLocation.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a EnterpriseLocation, false otherwise.\n\t */\n\tstatic is(instance: object): instance is EnterpriseLocation {\n\t\treturn (instance as { __type: string }).__type === EnterpriseLocation.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(\n\t\tdata: MapDataInternal,\n\t\toptions: {\n\t\t\tmvfData: MVFEnterpriseLocation;\n\t\t\tcategoryIds: string[];\n\t\t\tlocationInstances?: EnterpriseLocation[];\n\t\t\tparentId?: string;\n\t\t},\n\t) {\n\t\tsuper(options.mvfData.externalId);\n\t\tthis.#data = data;\n\t\tthis.#mvfData = options.mvfData;\n\t\tthis.#categoryIds = options.categoryIds || [];\n\t\tthis.instances = options.locationInstances || [];\n\t\tfor (const prop in options.mvfData) {\n\t\t\tif (!skipProps.has(prop) && !Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this), prop)) {\n\t\t\t\t// automatically generate getters to get the value from the current language pack\n\t\t\t\tObject.defineProperty(this, prop, {\n\t\t\t\t\tenumerable: true,\n\t\t\t\t\tget() {\n\t\t\t\t\t\t// this is an instance\n\t\t\t\t\t\tif (options.parentId) {\n\t\t\t\t\t\t\tconst parentLocation = this.#data.locationsById[options.parentId];\n\n\t\t\t\t\t\t\t// is this prop defined in the instance?\n\t\t\t\t\t\t\tif (this.#mvfData[prop] != null) {\n\t\t\t\t\t\t\t\t// then follow normal path with translations, and fallbacks\n\t\t\t\t\t\t\t\treturn this.#data.getPropTranslation(this.__type, prop, this.#mvfData.id, this.#mvfData[prop]);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// look up instance's prop's translation, otherwise fallback to parent\n\t\t\t\t\t\t\t\treturn this.#data.getPropTranslation(this.__type, prop, this.#mvfData.id, parentLocation[prop]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn this.#data.getPropTranslation(this.__type, prop, this.#mvfData.id, this.#mvfData[prop]);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/** @internal */\n\tget focusTarget() {\n\t\treturn this.spaces;\n\t}\n\n\tget categories(): EnterpriseCategory[] {\n\t\tif (this.#cache.categories) {\n\t\t\treturn this.#cache.categories;\n\t\t}\n\n\t\tthis.#cache.categories = (this.#categoryIds.map(id => this.#data.getById('enterprise-category', id)) || []).filter(\n\t\t\tBoolean,\n\t\t) as EnterpriseCategory[];\n\n\t\treturn this.#cache.categories;\n\t}\n\n\tget coordinates(): Coordinate[] {\n\t\tif (this.#cache.coordinates) {\n\t\t\treturn this.#cache.coordinates;\n\t\t}\n\n\t\tthis.#cache.coordinates = [];\n\t\tfor (let i = 0; i < this.nodes.length; i++) {\n\t\t\tthis.#cache.coordinates.push(this.nodes[i].coordinate);\n\t\t}\n\n\t\treturn this.#cache.coordinates;\n\t}\n\n\tget nodes(): Node[] {\n\t\tif (this.#cache.nodes) {\n\t\t\treturn this.#cache.nodes;\n\t\t}\n\n\t\tthis.#cache.nodes = [];\n\n\t\tfor (let i = 0; i < this.#mvfData.nodes.length; i++) {\n\t\t\tconst space = this.#data.getById('node', this.#mvfData.nodes[i].id);\n\t\t\tif (space) {\n\t\t\t\tthis.#cache.nodes.push(space);\n\t\t\t}\n\t\t}\n\n\t\treturn this.#cache.nodes;\n\t}\n\n\tget points(): PointOfInterest[] {\n\t\tif (this.#cache.points) {\n\t\t\treturn this.#cache.points;\n\t\t}\n\n\t\tthis.#cache.points = [];\n\n\t\tfor (let i = 0; i < this.#mvfData.spaces.length; i++) {\n\t\t\tconst point = this.#data.getById('point-of-interest', this.#mvfData.spaces[i].id);\n\t\t\tif (point) {\n\t\t\t\tthis.#cache.points.push(point);\n\t\t\t}\n\t\t}\n\n\t\treturn this.#cache.points;\n\t}\n\n\tget spaces(): Space[] {\n\t\tif (this.#cache.spaces) {\n\t\t\treturn this.#cache.spaces;\n\t\t}\n\n\t\tthis.#cache.spaces = [];\n\t\t// Fallback to polygons if spaces are not available for legacy support\n\t\tconst spaces = Array.isArray(this.#mvfData.spaces) ? this.#mvfData.spaces : this.#mvfData.polygons;\n\t\tfor (let i = 0; i < spaces.length; i++) {\n\t\t\tconst space = this.#data.getById('space', spaces[i].id);\n\t\t\tif (space) {\n\t\t\t\tthis.#cache.spaces.push(space);\n\t\t\t}\n\t\t}\n\n\t\treturn this.#cache.spaces;\n\t}\n\n\tget objects(): MapObject[] {\n\t\tif (this.#cache.objects) {\n\t\t\treturn this.#cache.objects;\n\t\t}\n\n\t\tthis.#cache.objects = [];\n\t\tfor (let i = 0; i < this.#mvfData.polygons.length; i++) {\n\t\t\tconst object = this.#data.getById('object', this.#mvfData.polygons[i].id);\n\t\t\tif (object) {\n\t\t\t\tthis.#cache.objects.push(object);\n\t\t\t}\n\t\t}\n\n\t\treturn this.#cache.objects;\n\t}\n\n\t/**\n\t * Serializes the EnterpriseLocation data to JSON.\n\t *\n\t * @returns An object representing the EnterpriseLocation.\n\t */\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: EnterpriseLocation.__type,\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t};\n\t}\n\n\t/**\n\t * Cleans up resources used by the instance.\n\t *\n\t * @internal\n\t */\n\tdestroy() {\n\t\tfor (const key of Object.keys(this.#cache)) {\n\t\t\tdelete this.#cache[key];\n\t\t}\n\t}\n}\n\nexport default EnterpriseLocation;\n", "/* eslint-disable @typescript-eslint/ban-ts-comment */\nimport type { EnterpriseCategory as MVFEnterpriseCategory } from '@mappedin/mvf-v2';\nimport type { MapDataInternal, EnterpriseLocation } from '.';\nimport BaseMetaData from './base-metadata-object';\n\nconst skipProps = new Set();\n\n/**\n * An EnterpriseCategory groups one or more EnterpriseLocation. These allow similar locations to be sorted in a logical fashion.\n * For example a mall may group locations into Food Court, Footwear and Women's Fashion. They can be accessed using the {@link MapData.getByType} method as shown below.\n *\n * ```typescript\n * const categories = mapData.getByType('enterprise-category');\n * ```\n *\n * Refer to the [EnterpriseCategory Guide](https://developer.mappedin.com/web-sdk/enterprise-data#enterprise-categories) for more information and interactive examples.\n */\nclass EnterpriseCategory extends BaseMetaData implements Omit<MVFEnterpriseCategory, 'children' | 'locations'> {\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'enterprise-category';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = EnterpriseCategory.__type;\n\n\t/**\n\t * The name of the category.\n\t */\n\tname = '';\n\t/**\n\t * The color of the category.\n\t */\n\tcolor?: string | undefined;\n\t/**\n\t * The external ID of the category.\n\t */\n\texternalId = '';\n\t/**\n\t * Extra properties of the category.\n\t */\n\textra?: Record<string, unknown> | undefined;\n\t/**\n\t * A URL to the icon of the category.\n\t */\n\ticon?: string | undefined;\n\t/**\n\t * The icon from the default list of icons.\n\t */\n\ticonFromDefaultList?: string | null | undefined;\n\t/**\n\t * The sort order of the category.\n\t */\n\tsortOrder = -1;\n\t/**\n\t * A URL to the picture of the category.\n\t */\n\tpicture?: string | undefined;\n\n\t#data: MapDataInternal;\n\t#cache: Partial<{ children: EnterpriseCategory[]; locations: EnterpriseLocation[] }> = {};\n\t#mvfData: MVFEnterpriseCategory;\n\n\t/**\n\t * Checks if the provided instance is of type EnterpriseCategory.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a EnterpriseCategory, false otherwise.\n\t */\n\tstatic is(instance: object): instance is EnterpriseCategory {\n\t\treturn (instance as { __type: string }).__type === EnterpriseCategory.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(\n\t\tdata: MapDataInternal,\n\t\toptions: {\n\t\t\tmvfData: MVFEnterpriseCategory;\n\t\t},\n\t) {\n\t\tsuper(options.mvfData.externalId);\n\t\tthis.#data = data;\n\t\tthis.#mvfData = options.mvfData;\n\t\tfor (const prop in options.mvfData) {\n\t\t\tif (!skipProps.has(prop) && !Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this), prop)) {\n\t\t\t\t// automatically generate getters to get the value from the current language pack\n\t\t\t\tObject.defineProperty(this, prop, {\n\t\t\t\t\tget() {\n\t\t\t\t\t\treturn this.#data.getPropTranslation(this.__type, prop, this.#mvfData.id, this.#mvfData[prop]);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * The child categories of the category.\n\t */\n\tget children(): EnterpriseCategory[] {\n\t\tif (this.#cache.children) {\n\t\t\treturn this.#cache.children;\n\t\t}\n\n\t\tthis.#cache.children = [];\n\t\tfor (let i = 0; i < this.#mvfData.children.length; i++) {\n\t\t\tconst space = this.#data.getById('enterprise-category', this.#mvfData.children[i]);\n\t\t\tif (space) {\n\t\t\t\tthis.#cache.children.push(space);\n\t\t\t}\n\t\t}\n\n\t\treturn this.#cache.children;\n\t}\n\n\t/**\n\t * The {@link EnterpriseLocation}s within this category.\n\t */\n\tget locations(): EnterpriseLocation[] {\n\t\tif (this.#cache.locations) {\n\t\t\treturn this.#cache.locations;\n\t\t}\n\n\t\tthis.#cache.locations = [];\n\t\tfor (let i = 0; i < this.#mvfData.locations.length; i++) {\n\t\t\tconst location = this.#data.getById('enterprise-location', this.#mvfData.locations[i]);\n\t\t\tif (location) {\n\t\t\t\tthis.#cache.locations.push(location);\n\t\t\t}\n\t\t}\n\n\t\treturn this.#cache.locations;\n\t}\n\n\t/**\n\t * Serializes the EnterpriseCategory data to JSON.\n\t *\n\t * @returns An object representing the EnterpriseCategory.\n\t */\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: EnterpriseCategory.__type,\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t};\n\t}\n\n\t/**\n\t * Cleans up resources used by the instance.\n\t *\n\t * @internal\n\t */\n\tdestroy() {\n\t\tfor (const key of Object.keys(this.#cache)) {\n\t\t\tdelete this.#cache[key];\n\t\t}\n\t}\n}\n\nexport default EnterpriseCategory;\n", "import type { EnterpriseVenue as MVFEnterpriseVenue, Language, OperationHours } from '@mappedin/mvf-v2';\nimport type { Hyperlink, MapDataInternal } from '.';\nimport BaseMetaData from './base-metadata-object';\n\nconst skipProps = new Set();\n\n/**\n * The EnterpriseVenue class holds metadata bout the map, which includes the map name, supported languages, default language, top locations and more.\n * It can be accessed using the {@link MapData.getByType} method as shown below.\n *\n * ```typescript\n * const venue = mapData.getByType('enterprise-venue');\n * ```\n *\n * Refer to the [EnterpriseVenue Guide](https://developer.mappedin.com/web-sdk/enterprise-data#enterprise-venue) for more information.\n */\nclass EnterpriseVenue extends BaseMetaData implements MVFEnterpriseVenue {\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'enterprise-venue';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = EnterpriseVenue.__type;\n\n\t/**\n\t * The country code of the venue.\n\t */\n\tcountrycode?: string | undefined;\n\t/**\n\t * The venue's cover image.\n\t * @format uri\n\t */\n\tcoverImage?: string | undefined;\n\t/**\n\t * The external ID of the venue.\n\t */\n\texternalId = '';\n\t/**\n\t * The default language of the venue.\n\t */\n\tdefaultLanguage: Language = {\n\t\tcode: 'en',\n\t\tname: 'English',\n\t};\n\t/**\n\t * The default floor of the venue.\n\t */\n\tdefaultFloor?: string | undefined;\n\t/**\n\t * Extra properties of the venue.\n\t */\n\textra?: Record<string, unknown> | undefined;\n\t/**\n\t * A URL to the icon of the venue.\n\t */\n\ticon?: string | undefined;\n\t/**\n\t * The languages supported by the venue.\n\t */\n\tlanguages: Language[] = [];\n\t/**\n\t * The links of the venue.\n\t */\n\tlinks: Hyperlink[] = [];\n\t/**\n\t * A URL to the logo of the venue.\n\t */\n\tlogo?: string | undefined;\n\t/**\n\t * A URL to a web page with [Mappedin Web](https://developer.mappedin.com/docs/enterprise-apps/mappedin-web-v2) for this venue.\n\t */\n\tmappedinWebUrl?: string | undefined;\n\t/**\n\t * When this venue is open.\n\t */\n\toperationHours?: OperationHours[] | undefined;\n\t/**\n\t * The slug of the venue.\n\t */\n\tslug = '';\n\t/**\n\t * The top locations of the venue.\n\t */\n\ttopLocations?: string[] | undefined;\n\t/**\n\t * The timezone ID of the venue.\n\t */\n\ttzid?: string | undefined;\n\n\t#cache = {};\n\t#mvfData: MVFEnterpriseVenue;\n\n\t/**\n\t * Checks if the provided instance is of type EnterpriseVenue.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a EnterpriseVenue, false otherwise.\n\t */\n\tstatic is(instance: object): instance is EnterpriseVenue {\n\t\treturn (instance as { __type: string }).__type === EnterpriseVenue.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(\n\t\t_data: MapDataInternal,\n\t\toptions: {\n\t\t\tmvfData: MVFEnterpriseVenue;\n\t\t},\n\t) {\n\t\tsuper(options.mvfData.externalId);\n\t\tthis.#mvfData = options.mvfData;\n\t\tfor (const prop in options.mvfData) {\n\t\t\tif (!skipProps.has(prop) && !Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this), prop)) {\n\t\t\t\tthis[prop] = options.mvfData[prop];\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Gets the name of the EnterpriseVenue.\n\t *\n\t * @returns {string} The name of the EnterpriseVenue.\n\t */\n\tget name(): string {\n\t\treturn this.#mvfData.name ?? '';\n\t}\n\n\t/**\n\t * @deprecated Use `defaultFloor` instead\n\t * The default map of the venue.\n\t */\n\tget defaultMap(): string {\n\t\treturn this.#mvfData.defaultMap ?? this.defaultFloor ?? '';\n\t}\n\n\t/**\n\t * Serializes the EnterpriseVenue data to JSON.\n\t *\n\t * @returns An object representing the EnterpriseVenue.\n\t */\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: EnterpriseVenue.__type,\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t};\n\t}\n\n\t/**\n\t * Cleans up resources used by the instance.\n\t *\n\t * @internal\n\t */\n\tdestroy() {\n\t\tfor (const key of Object.keys(this.#cache)) {\n\t\t\tdelete this.#cache[key];\n\t\t}\n\t}\n}\n\nexport default EnterpriseVenue;\n", null, null, "// Re-export classes from the directions subdirectory\nexport { Directions, DirectionsInternal, getNodesFromTarget } from './directions/index';\n", "export { Directions } from './directions';\nexport { DirectionsInternal } from './directions-internal';\nexport { getNodesFromTarget } from './utils';\n", "import type { DirectionFeature, DirectionsCollection } from '@packages/internal/geojson-navigator';\nimport type { Connection, Floor, Node, MapDataInternal } from '../../map-data-objects';\nimport { Coordinate } from '../../map-data-objects';\nimport type { TDirectionInstructionAction, TDirectionInstruction, TNavigationTarget } from '../../types';\nimport { differenceBetweenAngles, getRelativeBearing } from '../utils';\nimport { randomId } from '@packages/internal/common';\n\nconst BEARING_CHANGE_THRESHOLD = Math.PI * 0.1;\n\n/**\n * Represents a set of directions between two points.\n *\n * Directions are used to represent the path between two points on the map,\n * as well as the instructions to follow the path.\n */\nexport class Directions {\n\tid: string;\n\t#cache: {\n\t\tdistance?: number;\n\t\tcoordinates?: Coordinate[];\n\t\tinstructions?: TDirectionInstruction[];\n\t} = {};\n\t#mapData: MapDataInternal;\n\t#directions: DirectionFeature[];\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(\n\t\tdirections: DirectionsCollection,\n\t\tmapData: MapDataInternal,\n\t\tdeparture: TNavigationTarget,\n\t\tdestination: TNavigationTarget,\n\t\toptions?: { id?: string },\n\t) {\n\t\tthis.id = options?.id ?? randomId();\n\t\tthis.#mapData = mapData;\n\t\tthis.#directions = directions.features;\n\t\tthis.departure = departure;\n\t\tthis.destination = destination;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tget path(): Node[] {\n\t\treturn this.#directions\n\t\t\t.map(direction => this.#mapData.getById('node', direction.properties.id))\n\t\t\t.filter(Boolean) as Node[];\n\t}\n\n\t/**\n\t * The selected departure.\n\t */\n\tdeparture: TNavigationTarget;\n\n\t/**\n\t * The selected destination.\n\t */\n\tdestination: TNavigationTarget;\n\n\t/**\n\t * All the coordinates ({@link Coordinate}) of the directions.\n\t */\n\tget coordinates(): Coordinate[] {\n\t\tif (this.#cache.coordinates) {\n\t\t\treturn this.#cache.coordinates;\n\t\t}\n\t\tthis.#cache.coordinates = this.#directions.map(\n\t\t\tfeature =>\n\t\t\t\tnew Coordinate(feature.geometry.coordinates[1], feature.geometry.coordinates[0], feature.properties.groupBy),\n\t\t);\n\n\t\treturn this.#cache.coordinates;\n\t}\n\n\t/**\n\t * The total distance of the path in meters.\n\t */\n\tget distance(): number {\n\t\tif (this.#cache.distance) {\n\t\t\treturn this.#cache.distance;\n\t\t}\n\n\t\tthis.#cache.distance = this.#directions.reduce((acc, feature) => acc + (feature.properties.distance || 0), 0);\n\n\t\treturn this.#cache.distance;\n\t}\n\n\t/**\n\t * The array of instructions ({@link TDirectionInstruction}).\n\t */\n\tget instructions(): TDirectionInstruction[] {\n\t\tif (this.#directions.length < 2) {\n\t\t\treturn [];\n\t\t} else if (this.#cache.instructions) {\n\t\t\treturn this.#cache.instructions;\n\t\t}\n\n\t\tconst instructions: TDirectionInstruction[] = [];\n\t\tlet distance = 0;\n\n\t\tfor (let i = 0; i < this.#directions.length; i++) {\n\t\t\tconst direction: DirectionFeature = this.#directions[i];\n\t\t\tconst prevDirection: DirectionFeature | undefined = this.#directions[i - 1];\n\t\t\tconst nextDirection: DirectionFeature | undefined = this.#directions[i + 1];\n\t\t\tconst coordinate = new Coordinate(\n\t\t\t\tdirection.geometry.coordinates[1],\n\t\t\t\tdirection.geometry.coordinates[0],\n\t\t\t\tdirection.properties.groupBy,\n\t\t\t);\n\n\t\t\tconst actions = this.#getActions({\n\t\t\t\tprevDirection,\n\t\t\t\tdirection,\n\t\t\t\tnextDirection,\n\t\t\t});\n\t\t\tdistance += prevDirection?.properties.distance || 0;\n\n\t\t\tfor (const action of actions) {\n\t\t\t\tif (action) {\n\t\t\t\t\tinstructions.push({\n\t\t\t\t\t\taction,\n\t\t\t\t\t\tdistance,\n\t\t\t\t\t\tcoordinate,\n\t\t\t\t\t\tnode: this.#mapData.getById('node', direction.properties.id)!,\n\t\t\t\t\t});\n\t\t\t\t\tdistance = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.#cache.instructions = instructions;\n\n\t\treturn this.#cache.instructions;\n\t}\n\n\t#lastConnectionAction?: 'take' | 'exit'; // the instruction action type for the last connection\n\t#lastConnection?: Connection;\n\t#lastMVFConnection?: any; // Self-serve doors are not connections, so won't get saved as this.#lastConnection\n\n\t/**\n\t * Get the action for an instruction.\n\t *\n\t * @hidden\n\t * @param options\n\t */\n\t#getActions(options: {\n\t\tprevDirection: DirectionFeature | undefined;\n\t\tdirection: DirectionFeature;\n\t\tnextDirection: DirectionFeature | undefined;\n\t}): (TDirectionInstructionAction | null)[] {\n\t\tconst { prevDirection, direction, nextDirection } = options;\n\t\tconst prevFloor = prevDirection && this.#mapData.getById('floor', prevDirection.properties.groupBy!);\n\t\tconst floor = this.#mapData.getById('floor', direction.properties.groupBy!);\n\t\tconst nextFloor = nextDirection && this.#mapData.getById('floor', nextDirection.properties.groupBy!);\n\t\tconst actions: (TDirectionInstructionAction | null)[] = [];\n\n\t\tif (!prevDirection) {\n\t\t\tactions.push({ type: 'Departure' });\n\t\t}\n\n\t\tconst mvfConnection = this.#mapData.getMVFFeatureByNodeId('connection', direction.properties.id);\n\t\tconst curConnection = mvfConnection ? this.#mapData.getById('connection', mvfConnection.id) : undefined;\n\t\t// NOTE: Ignore connections that\n\t\t// - have less than 1 node: A vortex should have more than one nodes attached to it for enter and exit.\n\t\t// - direction/edge is not along the path\n\t\tconst connectionValid = mvfConnection && mvfConnection.nodes.length > 1;\n\t\t// TODO: Fix this check for self-serve. Currently, it fails to correctly identify doors, because they are not connections in self-serve.\n\t\tconst connectionUnused =\n\t\t\tthis.#mapData.enterpriseMode &&\n\t\t\t(!direction.properties.destination ||\n\t\t\t\t!mvfConnection?.nodes.includes(direction.properties.destination) ||\n\t\t\t\t!mvfConnection?.nodes.includes(direction.properties.id));\n\t\tconst ignoreConnection = !connectionValid || connectionUnused;\n\n\t\tif (mvfConnection && !ignoreConnection) {\n\t\t\t/**\n\t\t\t * If a connection is associated with the direction, we handle it as a take/exit action before processing the floor logic.\n\t\t\t * This is necessary because some connections do not involve changing floors.\n\t\t\t */\n\t\t\tif (!this.#lastConnectionAction || this.#lastConnectionAction === 'exit') {\n\t\t\t\tactions.push(this.#createConnectionAction('TakeConnection', floor, nextFloor, curConnection, mvfConnection));\n\t\t\t\tthis.#lastConnectionAction = 'take';\n\t\t\t\tthis.#lastConnection = curConnection;\n\t\t\t\tthis.#lastMVFConnection = mvfConnection;\n\t\t\t} else {\n\t\t\t\tconst prevMvfConnection = this.#mapData.getMVFFeatureByNodeId('connection', prevDirection?.properties.id ?? '');\n\t\t\t\tconst prevConnection = this.#mapData.getById('connection', prevMvfConnection?.id ?? '');\n\t\t\t\tactions.push(\n\t\t\t\t\tthis.#createConnectionAction('ExitConnection', floor, prevFloor, prevConnection, prevMvfConnection),\n\t\t\t\t);\n\t\t\t\tthis.#lastConnectionAction = 'exit';\n\t\t\t\tthis.#lastConnection = curConnection;\n\t\t\t\tthis.#lastMVFConnection = mvfConnection;\n\t\t\t}\n\t\t} else if (this.#lastConnectionAction === 'take') {\n\t\t\t/**\n\t\t\t * This handles the case where a shuttle is about to arrive at its destination; the next connection is available but the current one is not (i.e., a turn action).\n\t\t\t * Therefore, we should exit the last connection (i.e., exit shuttle).\n\t\t\t */\n\t\t\tactions.push(\n\t\t\t\tthis.#createConnectionAction('ExitConnection', floor, prevFloor, this.#lastConnection, this.#lastMVFConnection),\n\t\t\t);\n\t\t\tthis.#lastConnectionAction = 'exit';\n\t\t\tthis.#lastConnection = curConnection;\n\t\t} else if (nextFloor && floor?.id !== nextFloor.id) {\n\t\t\tactions.push(this.#createConnectionAction('TakeConnection', floor, nextFloor, curConnection));\n\t\t} else if (prevFloor && prevFloor.id !== floor?.id) {\n\t\t\tactions.push(this.#createConnectionAction('ExitConnection', floor, prevFloor, curConnection));\n\t\t} else {\n\t\t\tactions.push(this.#createTurnAction(prevDirection, direction));\n\t\t}\n\n\t\tif (!nextDirection) {\n\t\t\tactions.push({ type: 'Arrival' });\n\t\t}\n\n\t\treturn actions;\n\t}\n\n\t/**\n\t * Create a connection action.\n\t *\n\t * @hidden\n\t * @param type\n\t * @param fromFloor\n\t * @param toFloor\n\t * @param connection\n\t * @param mvfConnection\n\t */\n\t#createConnectionAction(\n\t\ttype: 'TakeConnection' | 'ExitConnection',\n\t\tfromFloor?: Floor,\n\t\ttoFloor?: Floor,\n\t\tconnection?: Connection,\n\t\tmvfConnection?: any,\n\t): TDirectionInstructionAction {\n\t\tlet direction: TDirectionInstructionAction['direction'] = 'none';\n\t\tconst fromFloorElevation = fromFloor ? fromFloor.elevation : 0;\n\n\t\tif (fromFloorElevation != null && toFloor?.elevation != null) {\n\t\t\tconst elevationDelta = fromFloorElevation - toFloor.elevation;\n\t\t\tif (elevationDelta > 0) {\n\t\t\t\tdirection = 'down';\n\t\t\t} else if (elevationDelta < 0) {\n\t\t\t\tdirection = 'up';\n\t\t\t}\n\t\t}\n\n\t\tconst _connectionType = connection?.type ?? mvfConnection?.type ?? 'stairs';\n\n\t\treturn { type, fromFloor, toFloor, direction, connection, connectionType: _connectionType };\n\t}\n\n\t/**\n\t * Create a turn action.\n\t *\n\t * @hidden\n\t * @param prevDirection\n\t * @param direction\n\t */\n\t#createTurnAction(\n\t\tprevDirection: DirectionFeature | undefined,\n\t\tdirection: DirectionFeature,\n\t): TDirectionInstructionAction | null {\n\t\tconst exits = direction.properties.edges;\n\t\tif (!exits) {\n\t\t\treturn null;\n\t\t}\n\n\t\t/**\n\t\t * Identify other possible exits at a junction to determine if there's a fork.\n\t\t * A fork exists when there are additional exits that are:\n\t\t * - Not the path we just came from (prevDirection)\n\t\t * - Not the path we're about to take (direction)\n\t\t */\n\t\tconst otherExits = exits.filter(\n\t\t\texit =>\n\t\t\t\texit.destination.properties.id !== prevDirection?.properties.id &&\n\t\t\t\texit.destination.properties.id !== direction.properties.destination,\n\t\t);\n\t\tif (otherExits.length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst relativeBearingAngle = prevDirection\n\t\t\t? -differenceBetweenAngles(prevDirection.properties.angle!, direction.properties.angle!)\n\t\t\t: 0;\n\n\t\tif (Math.abs(relativeBearingAngle) >= BEARING_CHANGE_THRESHOLD) {\n\t\t\treturn {\n\t\t\t\ttype: 'Turn',\n\t\t\t\tbearing: getRelativeBearing(relativeBearingAngle, BEARING_CHANGE_THRESHOLD),\n\t\t\t\treferencePosition: 'At',\n\t\t\t} as TDirectionInstructionAction;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Serializes the directions to JSON.\n\t * All getter properties are evaluated and included in the serialized output.\n\t *\n\t * @returns An object representing the directions with all properties evaluated.\n\t */\n\ttoJSON() {\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tdirections: this.#directions,\n\t\t\t__type: 'directions',\n\t\t\tfrom: this.departure,\n\t\t\tto: this.destination,\n\t\t};\n\t}\n}\n", "import { Coordinate, MapObject, Space } from '../map-data-objects';\nimport type {\n\tEntranceCollection,\n\tLineString,\n\tPolygon,\n\tPoint,\n\tSpaceProperties,\n\tObstructionProperties,\n\tStyleCollection,\n\tPolygonStyle,\n\tLineStringStyle,\n\tFeature,\n\tObstructionCollection,\n\tPointStyle,\n\tFloorImageFeature,\n} from '@mappedin/mvf-v2';\nimport type { EntranceFeature, PolygonFeatureProperties } from '@packages/internal/mvf-utils';\nimport type { BBox, FeatureCollection, MultiLineString } from 'geojson';\nimport type {\n\tCollisionRankingTier,\n\tLineStyle,\n\tPaintStyle,\n\tPosition,\n\tEntityId,\n\tPathState,\n\tPanBounds,\n\tRendererCore,\n} from '@mappedin/core-sdk';\nimport { WALLS, DOORS } from '..';\nimport type { Floor, CameraBounds, MapData, TShow3DMapOptions } from '..';\nimport { BEARING_TYPE, type TBearingType, type IAnchorable, type TMapElements } from '../types';\nimport type { GeoJsonApi } from './api';\nimport { findAndSplitObstructionByAllEntrances } from '@packages/internal/mvf-utils/geometry';\nimport {\n\tEXTERIOR_DOORS_ID,\n\tEXTERIOR_WALLS_ID,\n\tFLOOR_GAP_MULTIPLIER,\n\tDEFAULT_FLOOR_HEIGHT,\n\tGEOMETRY_LAYER,\n\tINTERIOR_DOORS_ID,\n\tWALLS_ID,\n} from '../constants';\nimport type { Tween } from '@tweenjs/tween.js';\nimport turfBbox from '@turf/bbox';\nimport type { FloorObject } from './floor-object';\nimport { cyrb53 } from '@packages/internal/common';\n\nexport function convertCoordinateToPosition(coord: Coordinate): Position {\n\tif (coord.verticalOffset === 0) return [coord.longitude, coord.latitude];\n\n\treturn [coord.longitude, coord.latitude, coord.verticalOffset];\n}\nexport function convertPositionToCoordinate(coord: Position): Coordinate {\n\treturn new Coordinate(coord[1], coord[0]);\n}\n\nfunction getEntranceMap(features: EntranceCollection['features']) {\n\treturn new Map<string, EntranceFeature>(\n\t\tfeatures.map(feature => {\n\t\t\tconst { properties } = feature;\n\t\t\tconst { id } = properties;\n\n\t\t\treturn [id, feature];\n\t\t}),\n\t);\n}\n\nexport const cutEntrancesFromLineStrings = (\n\tlineStrings: ObstructionCollection['features'],\n\tentranceCollection: EntranceCollection['features'],\n) => {\n\tconst entranceMap = getEntranceMap(entranceCollection);\n\n\tconst output: {\n\t\tentrances: FeatureCollection<LineString, any>;\n\t\twalls: Feature<MultiLineString, any>;\n\t} = {\n\t\tentrances: {\n\t\t\ttype: 'FeatureCollection',\n\t\t\tfeatures: [],\n\t\t},\n\t\twalls: {\n\t\t\ttype: 'Feature',\n\t\t\tproperties: {\n\t\t\t\tid: lineStrings[0].properties.id,\n\t\t\t},\n\t\t\tgeometry: {\n\t\t\t\ttype: 'MultiLineString',\n\t\t\t\tcoordinates: [],\n\t\t\t},\n\t\t},\n\t};\n\tfor (const feature of lineStrings) {\n\t\tlet result = [feature.geometry.coordinates] as Position[][];\n\n\t\tconst entrancesList = (feature.properties.entrances || []).reduce((acc, name) => {\n\t\t\tif (entranceMap.has(name)) {\n\t\t\t\tacc.push(entranceMap.get(name)!);\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, [] as EntranceFeature[]);\n\n\t\tif (entrancesList.length) {\n\t\t\t// @TODO: fix types\n\t\t\t// @ts-ignore\n\t\t\tconst { entrances, obstructions } = findAndSplitObstructionByAllEntrances(feature as any, entrancesList);\n\t\t\tresult = obstructions.map(f => f.geometry.coordinates);\n\t\t\toutput.entrances.features.push(...entrances);\n\t\t}\n\n\t\toutput.walls.geometry.coordinates.push(...result);\n\t}\n\n\treturn output;\n};\n\nexport function differenceBetweenAngles(a: number, b: number): number {\n\treturn ((((b - a + Math.PI) % (Math.PI * 2)) + Math.PI * 2) % (Math.PI * 2)) - Math.PI;\n}\n\nexport function getRelativeBearing(relativeBearingAngle: number, threshold: number): TBearingType {\n\tlet relativeBearing: TBearingType = BEARING_TYPE.Left;\n\n\tif (relativeBearingAngle <= -Math.PI / 4.0) {\n\t\trelativeBearing = BEARING_TYPE.Right;\n\t} else if (relativeBearingAngle <= -threshold) {\n\t\trelativeBearing = BEARING_TYPE.SlightRight;\n\t} else if (relativeBearingAngle <= threshold) {\n\t\trelativeBearing = BEARING_TYPE.Straight;\n\t} else if (relativeBearingAngle <= Math.PI / 4.0) {\n\t\trelativeBearing = BEARING_TYPE.SlightLeft;\n\t} else {\n\t\trelativeBearing = BEARING_TYPE.Left;\n\t}\n\n\treturn relativeBearing;\n}\n\nconst rankToNumber = ['', '', 'medium', 'high', 'always-visible'];\n\nexport function convertCollisionRankingTeirToNumber(tier: CollisionRankingTier): number {\n\treturn rankToNumber.indexOf(tier as string);\n}\nexport type StyleCollectionWithId = {\n\t[groupId: string]: WithId<PolygonStyle> | WithId<LineStringStyle> | WithId<PointStyle> | undefined;\n};\n\nexport type AggregatedStyleMap = { [id: string]: StyleCollectionWithId[keyof StyleCollectionWithId] };\nexport function extractStyleMap(styles: StyleCollection) {\n\tconst styleMap: AggregatedStyleMap = {};\n\tfor (const styleGroupId in styles) {\n\t\tconst groupStyle:\n\t\t\t| ((PolygonStyle | LineStringStyle | PointStyle) & {\n\t\t\t\t\tid?: string;\n\t\t\t  })\n\t\t\t| undefined = styles[styleGroupId];\n\t\tif (groupStyle == null) {\n\t\t\tcontinue;\n\t\t}\n\t\tgroupStyle.id = styleGroupId;\n\t\tif ('polygons' in groupStyle) {\n\t\t\tfor (const polygonId of groupStyle.polygons) {\n\t\t\t\tstyleMap[polygonId] = groupStyle;\n\t\t\t}\n\t\t} else if ('lineStrings' in groupStyle) {\n\t\t\tfor (const lineId of groupStyle.lineStrings) {\n\t\t\t\tstyleMap[lineId] = groupStyle;\n\t\t\t}\n\t\t} else if ('points' in groupStyle) {\n\t\t\tfor (const pointId of groupStyle.points) {\n\t\t\t\tstyleMap[pointId] = groupStyle;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn styleMap;\n}\n\nexport type WithId<T> = T & { id?: string };\n\nexport function groupGeometryByStyle(\n\tfeatures: Feature<LineString | Polygon | Point, PolygonFeatureProperties<SpaceProperties | ObstructionProperties>>[],\n\tstyleMap: AggregatedStyleMap,\n) {\n\treturn features.reduce((acc, feature) => {\n\t\tconst style = styleMap[feature.properties.id];\n\t\tif (style == null) {\n\t\t\treturn acc;\n\t\t}\n\t\t// If the feature has textures, we need to create a new style for it\n\t\t// otherwise, the texture will be applied to every geometry that shares the same style\n\t\tif (\n\t\t\t'textures' in feature.properties &&\n\t\t\tArray.isArray(feature.properties.textures) &&\n\t\t\tfeature.properties.textures.length > 0\n\t\t) {\n\t\t\tconst newStyle = { ...style, id: style.id + '-textures' };\n\t\t\tacc.set(newStyle, [feature]);\n\t\t} else {\n\t\t\tif (!acc.has(style)) {\n\t\t\t\tacc.set(style, []);\n\t\t\t}\n\t\t\tacc.get(style)!.push(feature);\n\t\t}\n\n\t\treturn acc;\n\t}, new Map() as Map<WithId<PolygonStyle> | WithId<LineStringStyle> | WithId<PointStyle>, Feature<LineString | Polygon | Point, PolygonFeatureProperties<SpaceProperties | ObstructionProperties>>[]>);\n}\n\nexport function translateToCoreStyle(\n\tstyle: PolygonStyle | LineStringStyle,\n\tuserOptions: TShow3DMapOptions = {},\n): PaintStyle | LineStyle {\n\tconst coreStyle: PaintStyle | LineStyle = {\n\t\t...style,\n\t\tflipImageToFaceCamera: userOptions?.flipImagesToFaceCamera ?? true,\n\t};\n\n\tconst shading = userOptions?.style?.shading ?? userOptions?.shadingAndOutlines;\n\tif (shading === true) {\n\t\t// turn on default shading\n\t\tcoreStyle.shading = {\n\t\t\tstart: 0.1,\n\t\t\tend: 0.15,\n\t\t\tintensity: 0.4,\n\t\t};\n\t} else if (typeof shading === 'object') {\n\t\tcoreStyle.shading = {\n\t\t\tstart: shading.start,\n\t\t\tend: shading.end,\n\t\t\tintensity: shading.intensity,\n\t\t};\n\t}\n\n\t// handle outlines\n\tcoreStyle.outline = userOptions?.style?.outlines ?? userOptions?.shadingAndOutlines;\n\n\t// linestring specific styles\n\tif ('lineStrings' in style) {\n\t\tconst wallTopColor = userOptions?.style?.wallTopColor ?? userOptions?.wallTopColor;\n\t\tif (wallTopColor != null) {\n\t\t\tcoreStyle.topColor = wallTopColor;\n\t\t}\n\t}\n\n\treturn coreStyle;\n}\n\nexport const getTargetID = <T extends TMapElements | string>(target: T, api: GeoJsonApi): string | undefined => {\n\tconst currentFloor = api.currentMap?.currentFloor;\n\tconst geometryLayer = currentFloor.layers.get(GEOMETRY_LAYER);\n\n\tswitch (target) {\n\t\tcase WALLS.Interior:\n\t\t\treturn geometryLayer?.layers.get(WALLS_ID);\n\t\tcase WALLS.Exterior:\n\t\t\treturn geometryLayer?.layers.get(EXTERIOR_WALLS_ID);\n\t\tcase DOORS.Interior:\n\t\t\treturn geometryLayer?.layers.get(INTERIOR_DOORS_ID);\n\t\tcase DOORS.Exterior:\n\t\t\treturn geometryLayer?.layers.get(EXTERIOR_DOORS_ID);\n\t\tdefault:\n\t\t\treturn typeof target === 'string' ? target : target?.id;\n\t}\n};\n\nexport function tweenToPromise(tween: Tween) {\n\treturn new Promise<void>(resolve => {\n\t\ttween.onComplete(resolve);\n\t\ttween.onStop(resolve);\n\t});\n}\n\nexport function getBoundingBox(geometry: GeoJSON.Feature<GeoJSON.Polygon | GeoJSON.MultiPolygon, any>): BBox {\n\tif (geometry.bbox) {\n\t\treturn geometry.bbox;\n\t}\n\tconst bbox = turfBbox(geometry);\n\n\treturn bbox;\n}\n\nexport function expandBbox(bbox: BBox, bboxToExpand: BBox) {\n\treturn [\n\t\tMath.min(bbox[0], bboxToExpand[0]),\n\t\tMath.min(bbox[1], bboxToExpand[1]),\n\t\tMath.max(bbox[2], bboxToExpand[2]),\n\t\tMath.max(bbox[3], bboxToExpand[3]),\n\t];\n}\n\nexport function unique<T>(array: T[]): T[] {\n\treturn [...new Set(array)];\n}\n\nexport function getTargetFloorObject(\n\tcoordinate: Coordinate,\n\tfloorsById: Map<string, FloorObject>,\n\tdefaultFloor: FloorObject,\n) {\n\treturn coordinate.floorId\n\t\t? floorsById.has(coordinate.floorId)\n\t\t\t? floorsById.get(coordinate.floorId)!\n\t\t\t: defaultFloor\n\t\t: defaultFloor;\n}\n\n/** Gets the ID of a geometry that 2D entities can attach to */\nexport function getAttachableGeometryId(target: IAnchorable) {\n\tif (Space.is(target) || MapObject.is(target)) {\n\t\treturn target.id;\n\t}\n\n\treturn undefined;\n}\n\nexport function shouldAnimatePathDrawing(\n\tpath: EntityId<PathState> & {\n\t\tcoordinates: Coordinate[];\n\t},\n\tmapData: MapData,\n\tapi: GeoJsonApi,\n): boolean {\n\tconst isConnectionPath = path.coordinates.length === 2 && path.coordinates[0].floorId !== path.coordinates[1].floorId;\n\n\tlet shouldAnimate = true;\n\n\tif (isConnectionPath && path.coordinates[0].floorId != null && path.coordinates[1].floorId != null) {\n\t\tconst fromFloor = mapData?.getById('floor', path.coordinates[0].floorId);\n\t\tconst toFloor = mapData?.getById('floor', path.coordinates[1].floorId);\n\t\tif (fromFloor && toFloor) {\n\t\t\tconst fromFloorState = api.getState(fromFloor);\n\t\t\tconst toFloorState = api.getState(toFloor);\n\t\t\tif (fromFloorState != null && toFloorState != null) {\n\t\t\t\t// For connections, if the floors are visible and the altitude is different, we should animate\n\t\t\t\tshouldAnimate =\n\t\t\t\t\tfromFloorState.visible && toFloorState.visible && fromFloorState.altitude !== toFloorState.altitude;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tconst floor =\n\t\t\tpath.coordinates[0].floorId != null ? mapData?.getById('floor', path.coordinates[0].floorId) : undefined;\n\n\t\tshouldAnimate = floor ? api.getState(floor)?.visible ?? true : true;\n\t}\n\n\treturn shouldAnimate;\n}\n\nexport function generateImageId(feature: FloorImageFeature, imageIdx: number) {\n\t// let's base64 decode the path\n\tconst pathSplit = feature.properties.path.split('/');\n\tconst fileName = pathSplit[pathSplit.length - 1].split('.')[0];\n\tconst decodedFileName = atob(fileName);\n\n\treturn 'img_' + cyrb53(decodedFileName).toString() + '-' + imageIdx;\n}\n\nexport function parseFloorGap(floorGap: number | 'auto' = 'auto', height?: number): number {\n\tif (floorGap === 'auto') {\n\t\treturn height ? Math.round(height * FLOOR_GAP_MULTIPLIER) : DEFAULT_FLOOR_HEIGHT;\n\t}\n\n\t// A number was provided, so return it\n\treturn floorGap;\n}\n\n/**\n * This method computes the altitude and effective height for each floor\n * If there are missing floors, the previous floor before the gap will be extended to fill the gap\n * using that floor's max height (or floor gap if no max height is provided)\n * @param floors - All the floors in a building\n * @param floorGap - The floor gap of the current floor, defaults to 'auto'\n * @returns A map of floor elevation to altitude and effective height\n */\nexport function computeFloorAltitudes(\n\tfloors: Floor[] | FloorObject[],\n\tfloorGap: number | 'auto' = 'auto',\n): Map<number, { altitude: number; effectiveHeight: number }> {\n\tif (!floors.length) {\n\t\treturn new Map();\n\t}\n\n\tconst orderedFloors = floors.sort((a, b) => a.elevation - b.elevation);\n\tlet firstAboveGroundFloorIndex = orderedFloors.findIndex(floor => floor.elevation >= 0);\n\t// If there are no above ground floors, set the index to the length of the array\n\tif (firstAboveGroundFloorIndex === -1) {\n\t\tfirstAboveGroundFloorIndex = orderedFloors.length;\n\t}\n\tlet altitude = 0;\n\tconst result = new Map<number, { altitude: number; effectiveHeight: number }>();\n\n\t// Processing above ground floors\n\tfor (let i = firstAboveGroundFloorIndex; i < orderedFloors.length; i += 1) {\n\t\tconst curFloor = orderedFloors[i];\n\t\tconst nextFloor = orderedFloors[i + 1];\n\t\tconst curElevation = curFloor.elevation;\n\t\tconst nextElevation = nextFloor ? nextFloor.elevation : undefined;\n\n\t\tconst gapsAfter = nextElevation !== undefined ? Math.max(0, nextElevation - curElevation - 1) : 0;\n\t\tconst missingToGround = i === firstAboveGroundFloorIndex ? curElevation : 0;\n\n\t\tconst effectiveHeight = parseFloorGap(floorGap, curFloor.maxHeight) * (1 + gapsAfter + missingToGround);\n\t\tconst baseAltitude = altitude;\n\n\t\tresult.set(curFloor.elevation, { altitude: baseAltitude, effectiveHeight: effectiveHeight });\n\t\taltitude += effectiveHeight;\n\t}\n\n\t// Processing below ground floors\n\tconst norm = (lvl: number) => -lvl - 1;\n\taltitude = 0;\n\tfor (let i = firstAboveGroundFloorIndex - 1; i >= 0; i -= 1) {\n\t\tconst curFloor = orderedFloors[i];\n\t\tconst nextFloor = orderedFloors[i - 1];\n\t\tconst curElevation = norm(curFloor.elevation);\n\t\tconst nextElevation = nextFloor ? norm(nextFloor.elevation) : undefined;\n\n\t\tconst gapsAfter = nextElevation !== undefined ? Math.max(0, nextElevation - curElevation - 1) : 0;\n\t\tconst missingToGround = i === firstAboveGroundFloorIndex - 1 ? curElevation : 0;\n\n\t\tconst effectiveHeight = parseFloorGap(floorGap, curFloor.maxHeight) * (1 + gapsAfter + missingToGround);\n\t\tconst baseAltitude = -(altitude + effectiveHeight);\n\n\t\tresult.set(curFloor.elevation, { altitude: baseAltitude, effectiveHeight: effectiveHeight });\n\t\taltitude += effectiveHeight;\n\t}\n\n\treturn result;\n}\n\nexport function convertPanBoundsToCameraBounds(\n\tpanBounds: PanBounds,\n\tconvert3DMapPositionToCoordinate: RendererCore['convert3DMapPositionToCoordinate'],\n): CameraBounds {\n\tconst center = convert3DMapPositionToCoordinate(panBounds.center);\n\treturn {\n\t\tcenter: new Coordinate({\n\t\t\tlatitude: center[1],\n\t\t\tlongitude: center[0],\n\t\t}),\n\t\tradius: panBounds.radius,\n\t};\n}\n", "import type { MarkerPlacement } from '@mappedin/core-sdk/src/components/marker-utils';\nimport type { Language, ParsedMVFLocalePack } from '@mappedin/mvf-v2';\nimport type { Feature, MultiPolygon, Polygon } from 'geojson';\nimport type {\n\tAddText3DOptions,\n\tEnvMapOptions,\n\tImagePlacementOptions,\n\tInitializeModelState,\n\tInsetPadding,\n\tInsetPaddingOption,\n\tInterpolation,\n\tLabelAppearance,\n\tLabelTextPlacement,\n} from '../../geojson/src';\nimport type { TFloorChangeReason } from './events';\nimport type {\n\tAnnotation,\n\tArea,\n\tConnection,\n\tCoordinate,\n\tDoor,\n\tEnterpriseCategory,\n\tEnterpriseLocation,\n\tEnterpriseVenue,\n\tFacade,\n\tFloor,\n\tFloorStack,\n\tLocationCategory,\n\tLocationProfile,\n\tMapObject,\n\tNode,\n\tPointOfInterest,\n\tSpace,\n} from './map-data-objects';\nimport type { Image3DView, Label, Marker, Model, Path, Shape, Text3DView, PathSegment } from './map-view-objects';\nimport type { PartialDeep } from 'type-fest';\nimport type { MapElementToGetState, MapElementToUpdateState } from './states';\n\nexport type TAnimateStateResult = {\n\tresult: 'completed' | 'cancelled';\n};\n\nexport type TCancellablePromise<T> = Promise<T> & {\n\tcancel: () => void;\n};\n/**\n * @hidden\n */\nexport type { GLTFExportOptions } from '@mappedin/core-sdk';\n\nexport enum ACTION_TYPE {\n\tDeparture = 'Departure',\n\tTakeConnection = 'TakeConnection',\n\tExitConnection = 'ExitConnection',\n\tTurn = 'Turn',\n\tArrival = 'Arrival',\n}\n\nexport type TActionType = keyof typeof ACTION_TYPE;\n\nexport enum BEARING_TYPE {\n\tStraight = 'Straight',\n\tRight = 'Right',\n\tSlightRight = 'SlightRight',\n\tLeft = 'Left',\n\tSlightLeft = 'SlightLeft',\n\tBack = 'Back',\n}\n\nexport type TBearingType = keyof typeof BEARING_TYPE;\n\nexport enum CONNECTION_TYPE {\n\tstairs = 'stairs',\n\televator = 'elevator',\n\tescalator = 'escalator',\n\tdoor = 'door',\n\tramp = 'ramp',\n\tslide = 'slide',\n\tportal = 'portal',\n\tsecurity = 'security',\n\tshuttle = 'shuttle',\n\tladder = 'ladder',\n}\n\nexport type TConnectionType = keyof typeof CONNECTION_TYPE;\n\n/*\n * Better input validation and error handling\n * empty keys handling\n * client id and secret for maker users so we can generate a key for outdoor view and charge them\n */\n\n/**\n * Represents an action within a direction instruction.\n */\nexport type TDirectionInstructionAction = {\n\t/**\n\t * Type of action required at this step (e.g., 'Departure', 'Arrival', 'Turn').\n\t */\n\ttype: TActionType;\n\n\t/**\n\t * Bearing direction for this action (e.g., 'Straight', 'Right', 'Left').\n\t */\n\tbearing?: TBearingType;\n\n\t/**\n\t * A reference position for the action.\n\t *\n\t * @internal\n\t */\n\treferencePosition?: string;\n\n\t/**\n\t * The {@link Floor} from which this action starts.\n\t */\n\tfromFloor?: Floor;\n\n\t/**\n\t * The target {@link Floor}  for this action.\n\t */\n\ttoFloor?: Floor;\n\n\t/**\n\t * Connection object related to the action.\n\t * This represents the specific connection (e.g., elevator, stairs) involved in the current direction step.\n\t */\n\tconnection?: Connection;\n\n\t/**\n\t * The direction of the connection (e.g., 'up', 'down').\n\t */\n\tdirection?: 'up' | 'down' | 'none';\n\n\t/**\n\t * The type of the connection (e.g., 'elevator', 'escalator').\n\t * @deprecated in favor of `connection.type`\n\t */\n\tconnectionType?: TConnectionType;\n};\n\n/**\n * Represents a single instruction in a set of directions between two points.\n */\nexport type TDirectionInstruction = {\n\t/**\n\t * The action ({@link TDirectionInstructionAction}) to be taken for this instruction.\n\t */\n\taction: TDirectionInstructionAction;\n\n\t/**\n\t * Distance in meters covered in this instruction step.\n\t */\n\tdistance: number;\n\n\t/**\n\t * The {@link Coordinate} at which this instruction applies.\n\t */\n\tcoordinate: Coordinate;\n\n\t/**\n\t * @internal\n\t */\n\tnode: Node;\n};\n\nexport enum WALLS {\n\tExterior = 'exterior-walls',\n\tInterior = 'interior-walls',\n}\n\nexport enum DOORS {\n\tInterior = 'interior-doors',\n\tExterior = 'exterior-doors',\n}\n\n/**\n * Elements created by the MapData.\n */\nexport type MapDataElements =\n\t| Space\n\t| MapObject\n\t| Door\n\t| Facade\n\t| Floor\n\t| FloorStack\n\t| Connection\n\t| Annotation\n\t| Area\n\t| PointOfInterest\n\t| EnterpriseLocation\n\t| EnterpriseCategory\n\t| LocationProfile\n\t| Node\n\t| EnterpriseVenue;\n\n/**\n * Elements created by the MapView.\n */\nexport type MapViewElements = Label | Marker | Model | Shape | Text3DView | Path | PathSegment | Image3DView;\n\n/**\n * All map elements from the MapData and MapView.\n */\nexport type TMapElements = MapDataElements | MapViewElements | DOORS | WALLS;\n\n/**\n * Options for {@link Camera} animations on the map.\n */\nexport type TCameraAnimationOptions = {\n\t/**\n\t * Duration of the animation in milliseconds.\n\t */\n\tduration?: number;\n\t/**\n\t * Easing function to use for the animation.\n\t */\n\teasing?: TEasingFunction;\n\t/**\n\t * Whether the current animation will be interrupted, or must complete before starting any new animations\n\t * @default: true\n\t */\n\tinterruptible?: boolean;\n};\n\n/**\n * Options for controlling animations on the map.\n */\nexport type TAnimationOptions = {\n\t/**\n\t * Duration of the animation in milliseconds.\n\t * @default 1000\n\t */\n\tduration?: number;\n\t/**\n\t * Easing function to use for the animation.\n\t * @default 'ease-in-out'\n\t */\n\teasing?: TEasingFunction;\n};\n\n/**\n * Types of easing for animations.\n *\n * Linear: This function implies a constant rate of change. It means the animation proceeds at the same speed from start to end. There's no acceleration or deceleration, giving a very mechanical feel.\n *\n * Ease-in: This function causes the animation to start slowly and then speed up as it progresses. Initially, there's gradual acceleration, and as the function moves forward, the rate of change increases.\n *\n * Ease-out: Contrary to ease-in, ease-out makes the animation start quickly and then slow down towards the end. It begins with a faster rate of change and gradually decelerates.\n *\n * Ease-in-out: This function combines both ease-in and ease-out. The animation starts slowly, speeds up in the middle, and then slows down again towards the end. It offers a balance of acceleration and deceleration.\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/CSS/animation-timing-function\n */\nexport type TEasingFunction = 'linear' | 'ease-in' | 'ease-out' | 'ease-in-out';\n\n/**\n * Options for focusing the {@link Camera} on a target.\n */\nexport type TFocusOnOptions = TCameraAnimationOptions & {\n\t/**\n\t * Minimum zoom level when focusing on a target in mercator zoom levels.\n\t *\n\t * @see https://wiki.openstreetmap.org/wiki/Zoom_levels\n\t */\n\tminZoomLevel?: number;\n\n\t/**\n\t * Maximum zoom level when focusing on a target in mercator zoom levels.\n\t *\n\t * @see https://wiki.openstreetmap.org/wiki/Zoom_levels\n\t */\n\tmaxZoomLevel?: number;\n\n\t/**\n\t * Camera bearing when focusing on a target in degrees clockwise from North. 0 degrees is North, 90 degrees is East, 180 degrees is South, and 270 degrees is West.\n\t */\n\tbearing?: number;\n\n\t/**\n\t * Camera pitch when focusing on a target, in degrees.\n\t */\n\tpitch?: number;\n\n\t/**\n\t * Axis aligned padding to add to the bounding box in meters.\n\t */\n\taxisAlignedPadding?: {\n\t\t/**\n\t\t * Vertical padding to add to the bounding box in meters along the elevation axis.\n\t\t */\n\t\tvertical?: number;\n\t};\n\n\tscreenOffsets?: InsetPaddingOption;\n\n\t/**\n\t * Whether the current animation will be interrupted, or must complete before starting any new animations\n\t * @default: true\n\t */\n\tinterruptible?: boolean;\n};\n\n/**\n * Defines the target for camera operations.\n */\nexport type TCameraTarget = {\n\t/**\n\t * Center {@link Coordinate} for the camera target.\n\t */\n\tcenter?: Coordinate;\n\n\t/**\n\t * Zoom level for the camera target in mercator zoom levels.\n\t *\n\t * @see https://wiki.openstreetmap.org/wiki/Zoom_levels\n\t */\n\tzoomLevel?: number;\n\n\t/**\n\t * Bearing for the camera target in degrees clockwise from North. 0 degrees is North, 90 degrees is East, 180 degrees is South, and 270 degrees is West.\n\t */\n\tbearing?: number;\n\n\t/**\n\t * Pitch for the camera target in degrees.\n\t */\n\tpitch?: number;\n};\n\n/**\n * Defines the target for navigation operations.\n */\nexport type TNavigationTarget =\n\t| LocationProfile\n\t| Annotation\n\t| Space\n\t| MapObject\n\t| Coordinate\n\t| Door\n\t| PointOfInterest\n\t| Connection\n\t| EnterpriseLocation\n\t| Node\n\t| Area\n\t| Facade;\n\n/**\n * Defines the special zone for navigation operations.\n */\nexport type TDirectionZone = {\n\t/**\n\t * The zone geometry.\n\t */\n\tgeometry: Feature<MultiPolygon | Polygon>;\n\t/**\n\t * The additional cost for navigation through the zone, from 0 to Infinity.\n\t * The final cost is calculated as the sum of basic cost that comes from the {@link MapData}\n\t * and the additional zone cost.\n\t * A additional zone cost of 0 will make the zone free to navigate through\n\t * A additional zone cost of Infinity will make the zone impossible to navigate through\n\t */\n\tcost: number;\n\t/**\n\t * The zone's floor, defaults to the all floors if not provided.\n\t */\n\tfloor?: Floor;\n};\n/**\n * Options for controlling the behavior of a {@link Path}.\n */\nexport type TAddPathOptions = {\n\t/**\n\t * Path Colour. Color can be set using CSS colors names `DarkGoldenRod`, as Hex strings `#0000FF` or the rgb values `rgb(255,0,0)`.\n\t *\n\t * @defaultValue #4b90e2\n\t */\n\tcolor?: string;\n\t/**\n\t * Accent color that is applied to the path pulse and path arrows\n\t *\n\t * @defaultValue '#ffffff'\n\t */\n\taccentColor?: string;\n\t/**\n\t * Number of iterations to pulse to indicate direction.\n\t *\n\t * @defaultValue 1\n\t */\n\tpulseIterations?: number;\n\t/**\n\t * How many milliseconds to wait before starting the next pulse after the current pulse travels the entirety of the path.\n\t *\n\t * @defaultValue 750\n\t */\n\tpulsePauseDuration?: number;\n\t/**\n\t * The width of the path in meters. Can be a number or an {@link Interpolation}.\n\t *\n\t * @defaultValue Interpolation { on: 'zoom-level', input: [17, 22], output: [0.8, 0.4] }\n\t */\n\twidth?: number | Interpolation<'zoom-level', number[]>;\n\t/**\n\t * Duration of path drawing in milliseconds.\n\t *\n\t * @defaultValue 1500\n\t */\n\tdrawDuration?: number;\n\t/**\n\t * Show arrows on path.\n\t *\n\t * @defaultValue false\n\t */\n\tdisplayArrowsOnPath?: boolean;\n\t/**\n\t * Animate arrows on path.\n\t *\n\t * @defaultValue true\n\t */\n\tanimateArrowsOnPath?: boolean;\n\t/**\n\t * Flatten the path to a 2D line.\n\t *\n\t * @defaultValue false\n\t */\n\tflattenPath?: boolean;\n\t/**\n\t * Show an animated pulse indicating the direction of travel.\n\t *\n\t * @defaultValue true\n\t */\n\tshowPulse?: boolean;\n\t/**\n\t * Animate the drawing of the path in the direction of travel.\n\t *\n\t * @defaultValue true\n\t */\n\tanimateDrawing?: boolean;\n\t/**\n\t * Whether the path should be clickable.\n\t *\n\t * @defaultValue false\n\t */\n\tinteractive?: boolean;\n\t/**\n\t * How much the path hovers above the floor plane in meters.\n\t *\n\t * @defaultValue 0.1\n\t */\n\tverticalOffset?: number;\n\t/**\n\t * Whether the path should be dashed.\n\t *\n\t * @defaultValue false\n\t */\n\tdashed?: boolean;\n\t/**\n\t * Whether the path should be visible.\n\t *\n\t * @defaultValue true\n\t */\n\tvisible?: boolean;\n\t/**\n\t * @internal\n\t *\n\t * Whether the path should be visible through geometry. Can be used to create paths that are visible through walls and floors.\n\t *\n\t * @defaultValue false\n\t */\n\tvisibleThroughGeometry?: boolean;\n};\n\n/**\n * Defines the priority levels for collider collision handling, allowing customization of collider visibility in congested areas.\n *\n * | Value  | Description                                                                                                                             |\n * |--------|-----------------------------------------------------------------------------------------------------------------------------------------|\n * | low    | Colliders with this ranking have a low visibility priority and will be hidden in favor of higher-ranked colliders in crowded areas.     |\n * | medium | Colliders with this ranking have a standard visibility priority and may be hidden in favor of higher-ranked colliders in crowded areas. |\n * | high   | These colliders are given higher visibility priority than 'medium' priority.                                                            |\n * | always-visible | Colliders with this ranking will not be hidden, ensuring their constant visibility regardless of crowding. |\n *\n * Use this type to fine-tune the visibility of colliders, enhancing map readability and user experience by prioritizing important information.\n */\nexport type TCollisionRankingTier = 'low' | 'medium' | 'high' | 'always-visible';\n\n/**\n * Defines the placement position for a Marker, offering a selection of intuitive string options to pinpoint how the marker should be aligned. Choose from:\n *\n * | Value    | Description                                                                   |\n * |----------|-------------------------------------------------------------------------------|\n * | 'center' | Aligns the marker at its center, offering a balanced and centered appearance.|\n * | 'top'    | Aligns the marker at the top, ideal for marking locations from above.        |\n * | 'left'   | Aligns the marker on the left side, useful for when space is limited on the right.|\n * | 'bottom' | Aligns the marker at the bottom, suitable for hanging markers or when space is limited above.|\n * | 'top-left'  | Aligns the marker at the top-left corner. |\n * | 'top-right'  | Aligns the marker at the top-right corner. |\n * | 'bottom-left'  | Aligns the marker at the bottom-left corner. |\n * | 'bottom-right'  | Aligns the marker at the bottom-right corner. |\n *\n */\nexport type TMarkerPlacement = MarkerPlacement;\n\n/**\n * Options for controlling the behavior of the {@link Directions}.\n */\nexport type TGetDirectionsOptions = {\n\t/**\n\t * If true directions will only take accessible routes\n\t *\n\t * @default false\n\t */\n\taccessible?: boolean;\n\t/**\n\t * Enable or disable line-of-sight directions smoothing.\n\t * With this option enabled, the directions will be simplified to provide a more visually appealing path and shorter instructions.\n\t *\n\t * Can be a boolean to enable or disable smoothing, or an object with a radius property to specify the line of sight radius in metres.\n\t *\n\t * @default true for non-enterprise mode, false for enterprise mode\n\t *\n\t * @example\n\t * ```ts\n\t * // Enable smoothing with a radius of 3 metres\n\t * mapView.getDirections(firstSpace, secondSpace, {\n\t * \t smoothing: {\n\t *     radius: 3,\n\t *   }\n\t * })\n\t *\n\t * // Explicitly enable smoothing in enterprise mode\n\t * mapView.getDirections(firstSpace, secondSpace, {\n\t *   smoothing: true\n\t * })\n\t * ```\n\t */\n\tsmoothing?: boolean | { enabled?: boolean; radius: number };\n\t/**\n\t * Defines the special zones for navigation operations.\n\t *\n\t * @example\n\t * ```ts\n\t * mapView.getDirections(firstSpace, secondSpace, {\n\t *   zones: [\n\t *     {\n\t *       geometry: polygon as Feature<Polygon>,\n\t *       // The additional cost for navigation through the zone, from 0 to Infinity.\n\t *       // The final cost is calculated as the sum of basic cost that comes from the {@MapData}\n\t *       // and the additional zone cost.\n\t *       // A additional cost of 0 will make the zone free to navigate through\n\t *       // A additional cost of Infinity will make the zone impossible to navigate through\n\t *       cost: Infinity,\n\t *       floor: mapView.currentFloor,\n\t *     },\n\t *   ],\n\t * });\n\t * ```\n\t */\n\tzones?: TDirectionZone[];\n\t/**\n\t * @experimental\n\t * Enterprise only. Connections that should not be used for directions.\n\t *\n\t * If a connection is excluded, it will not be used in the directions even if it is the shortest (or only) path.\n\t * If there is no path that does not include the these connections, the directions will be undefined.\n\t */\n\texcludedConnections?: Connection[];\n\n\t/**\n\t * Override the default weights for specific connection ids.\n\t */\n\tconnectionIdWeightMap?: Record<string, number>;\n};\n\n/**\n * The target for the add model operation.\n */\nexport type TAddModel = {\n\t/**\n\t * The target for the model to be placed on.\n\t */\n\ttarget: IAnchorable;\n\n\t/**\n\t * Optional. Determines the opacity of the model.\n\t * @default 1\n\t */\n\topacity?: number;\n\t/**\n\t * Optional. Determines the rotation of the model, in degrees.\n\t * @default [0, 0, 0]\n\t */\n\trotation?: [number, number, number];\n\t/**\n\t * Optional. Determines the scale of the model. Can be a single number to scale uniformly in all dimensions,\n\t * or an array of three numbers [x, y, z] to scale differently in each dimension.\n\t * @default [1, 1, 1]\n\t */\n\tscale?: number | [number, number, number];\n\t/**\n\t * Whether the Model should be clickable\n\t * @default false\n\t */\n\tinteractive?: boolean;\n\t/**\n\t * Vertical offset of the model in meters.\n\t */\n\tverticalOffset?: number;\n};\n\n/**\n * Options for controlling the behavior of a {@link Model}.\n */\nexport type TAddModelOptions = Omit<InitializeModelState, 'scale' | 'url'> & {\n\tscale?: number | [number, number, number];\n};\n/**\n * @interface\n */\nexport type TAddText3DOptions = AddText3DOptions;\n\n/**\n * Options for controlling the behavior of an {@link Image}.\n */\nexport type TAddImageOptions = {\n\t/**\n\t * @internal\n\t */\n\tid?: string;\n\n\t/**\n\t * Width of the image in meters.\n\t */\n\twidth: number;\n\t/**\n\t * Height of the image in meters.\n\t */\n\theight: number;\n\t/**\n\t * Rotation of the image in degrees clockwise from North. 0 degrees is North, 90 degrees is East, 180 degrees is South, and 270 degrees is West.\n\t *\n\t * @default 0\n\t */\n\trotation?: number;\n\t/**\n\t * Vertical offset of the image in meters.\n\t *\n\t * @default 0\n\t */\n\tverticalOffset?: number;\n\t/**\n\t * Attempt to keep the image facing the camera as much as possible\n\t *\n\t * @default false\n\t */\n\tflipImageToFaceCamera?: boolean;\n};\n\n/**\n * Options for controlling the behavior of a {@link Marker}.\n */\nexport type TAddMarkerOptions = {\n\t/**\n\t * Optional. Determines the collision ranking tier of the marker, which influences its visibility in relation to other colliders.\n\t * For the possible values ('medium', 'high', 'always-visible') and their impact on label visibility, see {@link TCollisionRankingTier}.\n\t */\n\trank?: TCollisionRankingTier | 'initial';\n\t/**\n\t * Optional. Specifies the placement of the marker, determining its position relative to its coordinates.\n\t * If a list is provided, the marker will be aligned to the first placement that is available.\n\t *\n\t * The active placement will be exposed as a DOM attribute `data-placement` on the marker element.\n\t *\n\t * For the possible values and their descriptions, see {@link TMarkerPlacement}.\n\t */\n\tplacement?: TMarkerPlacement | TMarkerPlacement[];\n\t/**\n\t * Whether the {@link Marker} should be clickable.\n\t * If `true` the marker will be registered in the SDK interaction events.\n\t * If `'pointer-events-auto'` the marker will receive browser pointer events.\n\t * @default false\n\t */\n\tinteractive?: boolean | 'pointer-events-auto';\n\t/**\n\t * @internal\n\t */\n\tid?: string;\n\t/**\n\t * When true, the marker's collision boundary automatically adjusts when the marker's content or size changes.\n\t * Set to false for markers with static content that won't change after creation to improve performance.\n\t * @default true\n\t */\n\tdynamicResize?: boolean;\n\t/**\n\t * Whether the marker is enabled.\n\t * @default true\n\t */\n\tenabled?: boolean;\n\t/**\n\t * The z-index of the marker. Can be used used in conjunction with rank: 'always-visible' override the default distance from the camera based\n\t * sorting of markers and show certain markers always in front\n\t */\n\tzIndex?: number;\n\n\t/**\n\t * Configuration for the low priority pin fallback strategy.\n\t * When enabled, shows a smaller pin version of the marker when all anchor positions have collisions.\n\t * @default { enabled: true, size: 2, color: '#666' }\n\t */\n\tlowPriorityPin?: {\n\t\t/**\n\t\t * Whether to enable low priority pin strategy when all anchor positions have collisions.\n\t\t * @default true\n\t\t */\n\t\tenabled?: boolean;\n\t\t/**\n\t\t * Size of the low priority pin in pixels.\n\t\t * @default 2\n\t\t */\n\t\tsize?: number;\n\t\t/**\n\t\t * Color of the low priority pin.\n\t\t * @default '#666'\n\t\t */\n\t\tcolor?: string;\n\t};\n};\n\n/**\n * Options for creating a new {@link Label} with {@link Labels.add}.\n */\nexport type TAddLabelOptions = {\n\t/**\n\t * Optional. Determines the collision ranking tier of the label, which influences its visibility in relation to other colliders.\n\t * For the possible values ('medium', 'high', 'always-visible') and their impact on label visibility, see {@link TCollisionRankingTier}.\n\t */\n\trank?: TCollisionRankingTier | 'initial';\n\t/**\n\t * Customize the appearance of the {@link Label} and its pin\n\t */\n\tappearance?: LabelAppearance;\n\t/**\n\t * Whether the Label should be clickable.\n\t * @default false\n\t */\n\tinteractive?: boolean;\n\t/**\n\t * @internal\n\t */\n\tid?: string;\n\t/**\n\t * Whether the label is enabled.\n\t */\n\tenabled?: boolean;\n\t/**\n\t * The placement of the text relative to the pin.\n\t */\n\ttextPlacement?: LabelTextPlacement[];\n};\n\nexport type LanguagePackHydrationItem = {\n\tlanguage: Language;\n\tlocalePack: ParsedMVFLocalePack;\n};\n\n/**\n * All map elements which have state.\n */\nexport type MapElementsWithState = WithState<MapDataElements | MapViewElements | DOORS | WALLS>;\n\n/**\n * Filter for elements which have state.\n */\nexport type WithState<T> = T extends { __type: infer U }\n\t? U extends keyof MapElementToGetState\n\t\t? T\n\t\t: never\n\t: T extends string\n\t? T extends keyof MapElementToGetState\n\t\t? T\n\t\t: never\n\t: never;\n\n/**\n * The type for updating the state of map elements (colors, texts, etc.).\n * Accepts partial state updates for all element types.\n */\nexport type TUpdateState<T extends MapElementsWithState | string> = T extends { __type: infer U }\n\t? U extends keyof MapElementToUpdateState\n\t\t? MapElementToUpdateState[U]\n\t\t: never\n\t: T extends string\n\t? T extends keyof MapElementToUpdateState\n\t\t? MapElementToUpdateState[T]\n\t\t: Record<string, any>\n\t: never;\n\n/**\n * The type for getting the state of map elements.\n * Returns the full state type for all element types.\n */\nexport type TGetState<T extends MapElementsWithState | string> = T extends { __type: infer U }\n\t? U extends keyof MapElementToGetState\n\t\t? MapElementToGetState[U]\n\t\t: never\n\t: T extends string\n\t? T extends keyof MapElementToGetState\n\t\t? MapElementToGetState[T]\n\t\t: Record<string, any>\n\t: never;\n\nexport type GlobalState = {\n\t/**\n\t * The color of the background, in hex format(#000000).\n\t */\n\tbackgroundColor: string;\n\t/**\n\t * The alpha value of the background, between 0 and 1.\n\t * @default 1\n\t */\n\tbackgroundAlpha: number;\n\t/**\n\t * environment map for reflections.\n\t * @default 'basic'\n\t */\n\tenvironment: EnvMapOptions;\n\ttext3d: {\n\t\t/**\n\t\t * hover color of the text3d\n\t\t */\n\t\thoverColor: string;\n\t};\n\tgeometry: {\n\t\t/**\n\t\t * hover color of the geometries\n\t\t */\n\t\thoverColor: string;\n\t};\n};\n\nexport type UpdateGlobalState = PartialDeep<GlobalState>;\n\n/**\n * A map element that can be focused on by the camera.\n */\nexport type TFocusTarget = Coordinate | Space | Area | MapObject | Floor | Shape;\n\n/**\n * A class that implements IFocusable can be focused on by the camera.\n */\nexport interface IFocusable {\n\tget focusTarget(): TFocusTarget | TFocusTarget[];\n}\n\nexport interface INavigatable {\n\tget navigationTarget(): TNavigationTarget | TNavigationTarget[];\n}\n\n/**\n * A class that implements IAnchorable can have 2D elements like {@link Label}s and {@link Marker}s anchored to it.\n */\nexport interface IAnchorable {\n\tget anchorTarget(): Coordinate;\n}\n\n/**\n * Associates MapData type strings with their corresponding classes.\n */\nexport type TMapDataObjectTypes = {\n\t[LocationProfile.__type]: LocationProfile;\n\t[LocationCategory.__type]: LocationCategory;\n\t[Node.__type]: Node;\n\t[Space.__type]: Space;\n\t[Door.__type]: Door;\n\t[Floor.__type]: Floor;\n\t[FloorStack.__type]: FloorStack;\n\t[Connection.__type]: Connection;\n\t[MapObject.__type]: MapObject;\n\t[PointOfInterest.__type]: PointOfInterest;\n\t[Annotation.__type]: Annotation;\n\t[EnterpriseLocation.__type]: EnterpriseLocation;\n\t[EnterpriseCategory.__type]: EnterpriseCategory;\n\t[EnterpriseVenue.__type]: EnterpriseVenue;\n\t[Area.__type]: Area;\n\t[Facade.__type]: Facade;\n};\n\n/**\n * Associates MapView type strings with their corresponding classes.\n */\nexport type TMapViewObjectTypes = {\n\t[Label.__type]: Label;\n\t[Marker.__type]: Marker;\n\t[Model.__type]: Model;\n\t[Shape.__type]: Shape;\n\t[Path.__type]: Path;\n\t[PathSegment.__type]: PathSegment;\n\t[Image3DView.__type]: Image3DView;\n\t[Text3DView.__type]: Text3DView;\n};\n\n/**\n * Associates MapData and MapView type strings with their corresponding classes.\n */\nexport type TMapFeatureTypes = TMapDataObjectTypes & TMapViewObjectTypes;\n\n/**\n * Returns the class for a given type string.\n */\nexport type MapFeatureOfType<T extends string> = T extends keyof TMapFeatureTypes ? TMapFeatureTypes[T] : never;\n\n/**\n * @interface\n * @internal\n */\nexport type TImagePlacementOptions = ImagePlacementOptions;\n\nexport type TCameraInteractionsSetOptions = {\n\t/**\n\t * Whether to enable panning.\n\t */\n\tpan?: boolean;\n\t/**\n\t * Whether to enable zooming.\n\t */\n\tzoom?: boolean;\n\t/**\n\t * Whether to enable bearing and pitch.\n\t */\n\tbearingAndPitch?: boolean;\n};\n\nexport type TSetFloorOptions = {\n\t/**\n\t * Optionally provide the context for the floor change which will be published as the `reason` for the `floor-change` event.\n\t */\n\tcontext?: TFloorChangeReason;\n};\n\n/**\n * Options for controlling multi-floor view.\n * When enabled, displays all floors in a building stacked vertically below the active floor,\n * allowing users to see the building's vertical structure and navigate between floors.\n * The active floor is fully rendered while lower floors appear as semi-transparent footprints.\n */\nexport type TMultiFloorViewOptions = {\n\t/**\n\t * Enable multi-floor view to show floors stacked vertically below the active floor.\n\t * @default true\n\t */\n\tenabled?: boolean;\n\t/**\n\t * The vertical spacing between floors, measured in meters.\n\t * This controls how far apart the floors appear when stacked.\n\t * If a number is provided, this value will be used for all floors.\n\t * If 'auto' is provided, then the gap will be calculated based on the sum of all previous floors' max height\n\t * or the default gap of 10 meters if no max height is present for any of the provided floors.\n\t * @default 'auto'\n\t */\n\tfloorGap?: number | 'auto';\n\t/**\n\t * Automatically adjust the camera elevation when switching floors to match the floor's altitude.\n\t * @default true\n\t */\n\tupdateCameraElevationOnFloorChange?: boolean;\n};\n\nexport type TGetInViewOptions = Partial<{\n\tscreenOffsets: Partial<InsetPadding>;\n\tfullyContains: boolean;\n}>;\n\n/**\n * Options for highlighting a path section.\n */\nexport type TPathSectionHighlightOptions = {\n\t/**\n\t * The color of the highlight.\n\t */\n\tcolor?: string;\n\t/**\n\t * The width multiplier of the highlight.\n\t */\n\twidthMultiplier?: number;\n\t/**\n\t * The duration of the highlight animation.\n\t */\n\tanimationDuration?: number;\n};\n\n/**\n * Options for taking a screenshot.\n */\nexport type TTakeScreenshotOptions = {\n\t/**\n\t * Whether to include the outdoor context in the screenshot.\n\t * @default false\n\t */\n\twithOutdoorContext?: boolean;\n};\n", "import type { ParsedMVF, SpaceCollection } from '@mappedin/mvf-v2';\nimport type {\n\tDirectionFeature,\n\tDirectionsCollection,\n\tObstructionCollection,\n} from '@packages/internal/geojson-navigator';\nimport { Navigator } from '@packages/internal/geojson-navigator';\nimport type { Connection, MapDataInternal } from '../../map-data-objects';\nimport { Coordinate } from '../../map-data-objects';\nimport type { TDirectionZone, TNavigationTarget } from '../../types';\nimport type { Edge } from '@packages/internal/geojson-navigator/src/edge';\nimport { Directions } from './directions';\nimport {\n\tgetDepartureFromDirections,\n\tgetDestinationFromDirections,\n\tgetNodesFromTarget,\n\tgetNodesFromTargetSync,\n} from './utils';\n\nexport class DirectionsInternal {\n\tnavigator: Navigator;\n\tprivate readonly connections: ParsedMVF['connection.json'];\n\t//\n\t/**\n\t * @hidden\n\t */\n\tconstructor({\n\t\tnodes,\n\t\tgeojsonCollection,\n\t\tconnections,\n\t\tgroupBy,\n\t\tmultiplicativeDistanceWeightScaling,\n\t\tflagDeclarations,\n\t}: {\n\t\tnodes: ParsedMVF['node.geojson'];\n\t\tgeojsonCollection: ParsedMVF['obstruction'] | ParsedMVF['space'];\n\t\tconnections: ParsedMVF['connection.json'];\n\t\tgroupBy?: string;\n\t\tmultiplicativeDistanceWeightScaling?: boolean;\n\t\tflagDeclarations?: ParsedMVF['navigationFlags.json'];\n\t}) {\n\t\tthis.navigator = new Navigator({\n\t\t\tnodes,\n\t\t\tgeojsonCollection: this.createCollection(geojsonCollection),\n\t\t\tgroupBy,\n\t\t\tmultiplicativeDistanceWeightScaling,\n\t\t\tflagDeclarations,\n\t\t});\n\t\tthis.connections = connections;\n\t}\n\n\tprocessTargets(\n\t\tfromNodesByTarget: Map<TNavigationTarget, string[]>,\n\t\ttoNodesByTarget: Map<TNavigationTarget, string[]>,\n\t\tmapData: MapDataInternal,\n\t): {\n\t\toriginIds: string[];\n\t\tdestinationNodeIds: string[];\n\t\tfeatureToNodeIdsMap: Map<TNavigationTarget, string[]>;\n\t\t/**\n\t\t * Node ID for early return when origin and destination share same space.\n\t\t */\n\t\tearlyReturnNodeId?: string;\n\t} {\n\t\tconst originIds: string[] = [];\n\t\tconst destinationNodeIds: string[] = [];\n\t\tconst featureToNodeIdsMap = new Map<TNavigationTarget, string[]>();\n\t\t/**\n\t\t * Track the space ids we're departing from. If a destination has the same space id we can return early.\n\t\t */\n\t\tconst nodeSpaceIdsSet = new Set<string>();\n\n\t\tfor (const [target, nodeIds] of fromNodesByTarget) {\n\t\t\tfeatureToNodeIdsMap.set(target, nodeIds);\n\t\t\tfor (const nodeId of nodeIds) {\n\t\t\t\toriginIds.push(nodeId);\n\t\t\t\tif (mapData.nodesById[nodeId]?.space?.id) {\n\t\t\t\t\tnodeSpaceIdsSet.add(mapData.nodesById[nodeId].space.id);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (const [target, nodeIds] of toNodesByTarget) {\n\t\t\tfeatureToNodeIdsMap.set(target, nodeIds);\n\t\t\tfor (const nodeId of nodeIds) {\n\t\t\t\tdestinationNodeIds.push(nodeId);\n\t\t\t\tif (mapData.nodesById[nodeId]?.space && nodeSpaceIdsSet.has(mapData.nodesById[nodeId]?.space?.id)) {\n\t\t\t\t\t// A departure and destination share a space id. The distance is 0.\n\t\t\t\t\treturn {\n\t\t\t\t\t\toriginIds,\n\t\t\t\t\t\tdestinationNodeIds,\n\t\t\t\t\t\tfeatureToNodeIdsMap,\n\t\t\t\t\t\tearlyReturnNodeId: nodeId,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\toriginIds,\n\t\t\tdestinationNodeIds,\n\t\t\tfeatureToNodeIdsMap,\n\t\t};\n\t}\n\n\tpublic getDirections = async (\n\t\tfrom: TNavigationTarget[],\n\t\tto: TNavigationTarget[],\n\t\toptions: {\n\t\t\taccessible: boolean;\n\t\t\tsmoothing: { enabled: boolean; radius: number };\n\t\t\tzones: TDirectionZone[];\n\t\t\texcludedConnections: Connection[];\n\t\t\tconnectionIdWeightMap: Record<string, number>;\n\t\t},\n\t\tmapData: MapDataInternal,\n\t): Promise<Directions | undefined> => {\n\t\tconst fromNodesByTarget: Map<TNavigationTarget, string[]> = new Map();\n\t\tconst toNodesByTarget: Map<TNavigationTarget, string[]> = new Map();\n\n\t\tfor (const target of from) {\n\t\t\tfromNodesByTarget.set(target, await getNodesFromTarget(target, mapData, mapData.enterpriseMode));\n\t\t}\n\n\t\tfor (const target of to) {\n\t\t\ttoNodesByTarget.set(target, await getNodesFromTarget(target, mapData, mapData.enterpriseMode));\n\t\t}\n\n\t\tconst { originIds, destinationNodeIds, featureToNodeIdsMap, earlyReturnNodeId } = this.processTargets(\n\t\t\tfromNodesByTarget,\n\t\t\ttoNodesByTarget,\n\t\t\tmapData,\n\t\t);\n\n\t\tif (earlyReturnNodeId) {\n\t\t\treturn this.#execDirections(\n\t\t\t\tfrom,\n\t\t\t\tto,\n\t\t\t\t[earlyReturnNodeId],\n\t\t\t\t[earlyReturnNodeId],\n\t\t\t\toptions,\n\t\t\t\tmapData,\n\t\t\t\tfeatureToNodeIdsMap,\n\t\t\t);\n\t\t}\n\n\t\treturn this.#execDirections(from, to, originIds, destinationNodeIds, options, mapData, featureToNodeIdsMap);\n\t};\n\n\t/** @deprecated use getDirections instead */\n\tpublic getDirectionsSync = (\n\t\tfrom: TNavigationTarget[],\n\t\tto: TNavigationTarget[],\n\t\toptions: {\n\t\t\taccessible: boolean;\n\t\t\tsmoothing: { enabled: boolean; radius: number };\n\t\t\tzones: TDirectionZone[];\n\t\t\texcludedConnections: Connection[];\n\t\t\tconnectionIdWeightMap: Record<string, number>;\n\t\t},\n\t\tmapData: MapDataInternal,\n\t): Directions | undefined => {\n\t\tconst fromNodesByTarget: Map<TNavigationTarget, string[]> = new Map(\n\t\t\tfrom.map(target => [target, getNodesFromTargetSync(target, mapData, mapData.enterpriseMode)]),\n\t\t);\n\t\tconst toNodesByTarget: Map<TNavigationTarget, string[]> = new Map(\n\t\t\tto.map(target => [target, getNodesFromTargetSync(target, mapData, mapData.enterpriseMode)]),\n\t\t);\n\n\t\tconst { originIds, destinationNodeIds, featureToNodeIdsMap, earlyReturnNodeId } = this.processTargets(\n\t\t\tfromNodesByTarget,\n\t\t\ttoNodesByTarget,\n\t\t\tmapData,\n\t\t);\n\n\t\tif (earlyReturnNodeId) {\n\t\t\treturn this.#execDirections(\n\t\t\t\tfrom,\n\t\t\t\tto,\n\t\t\t\t[earlyReturnNodeId],\n\t\t\t\t[earlyReturnNodeId],\n\t\t\t\toptions,\n\t\t\t\tmapData,\n\t\t\t\tfeatureToNodeIdsMap,\n\t\t\t);\n\t\t}\n\n\t\treturn this.#execDirections(from, to, originIds, destinationNodeIds, options, mapData, featureToNodeIdsMap);\n\t};\n\n\t#execDirections = (\n\t\tfrom: TNavigationTarget[],\n\t\tto: TNavigationTarget[],\n\t\toriginIds: string[],\n\t\tdestinationNodeIds: string[],\n\t\toptions: {\n\t\t\taccessible: boolean;\n\t\t\tsmoothing: { enabled: boolean; radius: number };\n\t\t\tzones: TDirectionZone[];\n\t\t\texcludedConnections: Connection[];\n\t\t\tconnectionIdWeightMap: Record<string, number>;\n\t\t},\n\t\tmapData: MapDataInternal,\n\t\t/**\n\t\t * A pre-computed map of feature to node ids\n\t\t */\n\t\tfeatureToNodeIdsMap: Map<TNavigationTarget, string[]>,\n\t) => {\n\t\t// TODO: This should probably disable the edges not the two nodes of the connection but needs testing on Platform maps\n\t\t// we could also consider using the navigationFlags in MVF\n\t\tconst disabledConnectionNodeIds = this.getDisabledConnectionNodeIds(options.accessible).filter(\n\t\t\tnodeId => !originIds.includes(nodeId) && !destinationNodeIds.includes(nodeId),\n\t\t);\n\n\t\tconst overrideEdgeWeights = new Map<Edge, number>();\n\t\t// Merge the connectionIdWeightMap with the excludedConnections\n\t\tconst connectionWeights = { ...options.connectionIdWeightMap };\n\t\tfor (const connection of options.excludedConnections) {\n\t\t\t// Override with Infinity to disable the connection\n\t\t\tconnectionWeights[connection.id] = Infinity;\n\t\t}\n\t\tfor (const connectionId in connectionWeights) {\n\t\t\tconst connection = mapData.getById('connection', connectionId);\n\t\t\tif (!connection) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.#setConnectionWeight(connection, connectionWeights[connectionId], overrideEdgeWeights);\n\t\t}\n\n\t\tconst directions = this.navigator.getDirections({\n\t\t\tzones: options.zones.map(zone => ({ geometry: zone.geometry, cost: zone.cost, map: zone.floor?.id })),\n\t\t\toriginIds,\n\t\t\tdestinationNodeIds,\n\t\t\tdisabledConnectionNodeIds,\n\t\t\tsimplify: {\n\t\t\t\tenabled: options.smoothing.enabled,\n\t\t\t\tbufferRadius: options.smoothing.radius,\n\t\t\t},\n\t\t\toverrideEdgeWeights,\n\t\t\tmultiplicativeDistanceWeightScaling: !mapData.enterpriseMode,\n\t\t});\n\t\tthis.addCoordinateDirections(directions, from, to);\n\n\t\tconst departure = getDepartureFromDirections(directions, from, featureToNodeIdsMap);\n\t\tconst destination = getDestinationFromDirections(directions, to, featureToNodeIdsMap);\n\n\t\tconst makerDirections = new Directions(directions, mapData, departure, destination);\n\n\t\t/**\n\t\t * If the distance is 0, but the from and to targets do not share any nodes, then we can assume that the\n\t\t * directions are invalid and we should return undefined.\n\t\t */\n\t\tif (\n\t\t\tmakerDirections.distance === 0 &&\n\t\t\tnew Set([...originIds, ...destinationNodeIds]).size === originIds.length + destinationNodeIds.length\n\t\t) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn makerDirections;\n\t};\n\n\t/**\n\t * Get the node IDs of connections that do not match the accessibility setting provided.\n\t * A disabled connection node is a connection node that acts as a regular node\n\t * (ie. the edges that would cause a floor change are ignored).\n\t *\n\t * @hidden\n\t * @param accessible {boolean}\n\t */\n\tgetDisabledConnectionNodeIds = (accessible: boolean): string[] => {\n\t\tif (accessible === false) return [];\n\n\t\treturn this.connections.reduce((acc, connection) => {\n\t\t\tif (connection.accessible) return acc;\n\n\t\t\treturn acc.concat(connection.nodes);\n\t\t}, [] as string[]);\n\t};\n\n\t/**\n\t * Set the weight for all edges between a connection's nodes.\n\t */\n\t#setConnectionWeight = (connection: Connection, weight: number, overrideEdgeWeights: Map<Edge, number>) => {\n\t\tif (connection.nodes.length < 2) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst connectionNodeIds = new Set(connection.nodes.map(n => n.id));\n\n\t\tfor (const sourceNode of connection.nodes) {\n\t\t\tconst sourceEdges = this.navigator.graph.edges[sourceNode.id];\n\t\t\tif (!sourceEdges) continue;\n\n\t\t\tfor (const edge of sourceEdges) {\n\t\t\t\tif (!connectionNodeIds.has(edge.destination.properties.id)) continue;\n\n\t\t\t\t// Set weight for this specific edge (nodeA -> nodeB is different from nodeB -> nodeA)\n\t\t\t\toverrideEdgeWeights.set(edge, weight);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * If the navigation targets are coordinates, make sure to include them in the final directions. For other\n\t * data types (e.g. POIs, Doors, Spaces), the coordinate should have a coincidental node generated in the\n\t * navigation graph already, so this is unnecessary.\n\t *\n\t * @hidden\n\t * @param directions\n\t * @param from {TNavigationTarget[]}\n\t * @param to {TNavigationTarget[]}\n\t */\n\tprivate addCoordinateDirections = (\n\t\tdirections: DirectionsCollection,\n\t\t[from]: TNavigationTarget[],\n\t\t[to]: TNavigationTarget[],\n\t) => {\n\t\tif (!directions.features.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (Coordinate.is(from)) {\n\t\t\tconst direction = this.createDirectionFeature(\n\t\t\t\tfrom,\n\t\t\t\tthis.navigator.getAngle([from.longitude, from.latitude], directions.features[0].geometry.coordinates),\n\t\t\t\tthis.navigator.getDistance([from.longitude, from.latitude], directions.features[0].geometry.coordinates),\n\t\t\t);\n\t\t\tdirections.features.splice(0, 0, direction);\n\t\t}\n\t\tif (Coordinate.is(to)) {\n\t\t\tconst direction = this.createDirectionFeature(to, 0, 0);\n\t\t\tconst lastDirection = directions.features[directions.features.length - 1];\n\t\t\tlastDirection.properties.distance = this.navigator.getDistance(lastDirection.geometry.coordinates, [\n\t\t\t\tto.longitude,\n\t\t\t\tto.latitude,\n\t\t\t]);\n\t\t\tlastDirection.properties.angle = this.navigator.getAngle(lastDirection.geometry.coordinates, [\n\t\t\t\tto.longitude,\n\t\t\t\tto.latitude,\n\t\t\t]);\n\t\t\tdirections.features.push(direction);\n\t\t}\n\t};\n\n\t/**\n\t * Create an geojson collection from the parsed MVF.\n\t *\n\t * @hidden\n\t * @param obstructions\n\t */\n\tprivate createCollection(\n\t\tcollection: ParsedMVF['obstruction'] | ParsedMVF['space'],\n\t): ObstructionCollection | SpaceCollection {\n\t\treturn {\n\t\t\ttype: 'FeatureCollection',\n\t\t\tfeatures: Object.entries(collection).reduce((acc: any, [mapID, obstructions]) => {\n\t\t\t\treturn acc.concat(\n\t\t\t\t\tobstructions!.features.map(feature => {\n\t\t\t\t\t\tfeature.properties.map = mapID;\n\n\t\t\t\t\t\treturn feature;\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t}, [] as ObstructionCollection['features'] | SpaceCollection['features']),\n\t\t};\n\t}\n\n\t/**\n\t * Create a direction feature.\n\t *\n\t * @hidden\n\t * @param coordinate\n\t * @param angle\n\t * @param distance\n\t */\n\tprivate createDirectionFeature = (coordinate: Coordinate, angle: number, distance: number): DirectionFeature => {\n\t\treturn {\n\t\t\ttype: 'Feature',\n\t\t\tgeometry: {\n\t\t\t\ttype: 'Point',\n\t\t\t\tcoordinates: [coordinate.longitude, coordinate.latitude],\n\t\t\t},\n\t\t\tproperties: { groupBy: coordinate.floorId, id: coordinate.id, angle, distance, edges: [] },\n\t\t};\n\t};\n}\n", "export * from './src';\n", "export { Navigator } from './navigator';\nexport type { SimplifyDirectionsOptions } from './navigator/navigator';\nexport type { NodeCollection, NodeProperties, NodeFeature, NodeNeighbor } from './types/node';\nexport type { ObstructionCollection, ObstructionProperties, ObstructionFeature } from './types/obstruction';\nexport type { DirectionsCollection, DirectionProperties, DirectionFeature } from './types/directions';\nexport type { CoordinateFeature, CoordinateProperties } from './types/coordinate';\n", "export * from './navigator';\n", "import type { Position, Feature, MultiPolygon, Polygon } from 'geojson';\n\nimport { Edge } from '../edge';\nimport { DEFAULT_BUFFER_RADIUS, NavigationGraph } from '../navigation-graph';\nimport { hasLineOfSight, getAngle } from '../utils';\n\nimport type { NodeCollection } from '../types/node';\nimport type { ObstructionCollection, ObstructionFeature } from '../types/obstruction';\nimport type { SpaceCollection, SpaceFeature } from '../types/space';\nimport type { DirectionsCollection, DirectionProperties } from '../types/directions';\nimport { type NavigationFlagDeclarations } from '@mappedin/mvf-v2';\nimport { WELL_KNOWN_FLAGS } from '@mappedin/mvf-v2/no-validator';\nimport { hasFlag } from './utils';\nimport { equirectangularDistance } from '../../../common/utils';\n\n/**\n * Options for simplifying directions in the Navigator class.\n */\nexport type SimplifyDirectionsOptions = {\n\t/**\n\t * Enable or disable simplifying.\n\t */\n\tenabled: boolean;\n\t/**\n\t * The radius of the buffer around the path to consider when simplifying, in meters.\n\t * @default 0.7\n\t */\n\tbufferRadius?: number;\n};\n\n/**\n * Defines the special zone for navigation operations.\n */\nexport type DirectionsZone = {\n\tgeometry: Feature<MultiPolygon | Polygon>;\n\t/**\n\t * The additional cost for navigation through the zone.\n\t */\n\tcost: number;\n\t/**\n\t *\n\t *  Additional property specific to the navigator based on the 'groupBy' option.\n\t */\n\t[index: string]: any;\n};\n\nexport class Navigator {\n\tprivate groupBy: string;\n\tgraph: NavigationGraph;\n\tprivate geometryEdgesByMapId = new Map<string, [number, number][][]>();\n\tprivate flagDeclarations: NavigationFlagDeclarations = {};\n\n\t// Currently, we only disable nodes without the public flag when the flag is\n\t// present in declarations. No need to recompute at this time.\n\tprivate disabledNodeIds: Set<string>;\n\n\t/**\n\t * Constructs a Navigator instance to manage pathfinding with optional obstructions and grouping features.\n\t *\n\t * @param {NodeCollection} nodes - Collection of nodes for the navigation graph.\n\t * @param {ObstructionCollection} [obstructions] - Optional collection of obstructions that could block paths.\n\t * @param {SpaceCollection} [spaces] - Optional collection of spaces that could block paths.\n\t * @param {string} [groupBy] - Optional property name to group nodes and paths for differentiated processing.\n\t */\n\tconstructor({\n\t\tnodes,\n\t\tgeojsonCollection,\n\t\tgroupBy = 'default',\n\t\tmultiplicativeDistanceWeightScaling,\n\t\tflagDeclarations,\n\t}: {\n\t\tnodes: NodeCollection;\n\t\tgeojsonCollection?: ObstructionCollection | SpaceCollection;\n\t\tgroupBy?: string;\n\t\tmultiplicativeDistanceWeightScaling?: boolean;\n\t\tflagDeclarations?: NavigationFlagDeclarations;\n\t}) {\n\t\tthis.groupBy = groupBy;\n\t\tthis.graph = new NavigationGraph({ nodes, groupBy: this.groupBy, multiplicativeDistanceWeightScaling });\n\t\tlet features: ObstructionFeature[] | SpaceFeature[] = geojsonCollection?.features || [];\n\t\tthis.flagDeclarations = flagDeclarations ?? {};\n\t\tthis.disabledNodeIds = this.getDisabledNodeIds();\n\n\t\tfeatures.forEach(feature => {\n\t\t\tlet coords: [number, number][] | null = null;\n\n\t\t\tif (feature.geometry.type === 'LineString') {\n\t\t\t\tcoords = feature.geometry.coordinates as [number, number][];\n\t\t\t} else if (feature.geometry.type === 'Polygon') {\n\t\t\t\tcoords = feature.geometry.coordinates.flat() as [number, number][];\n\t\t\t}\n\n\t\t\tif (coords) {\n\t\t\t\tconst groupId = this.groupBy === 'default' ? this.groupBy : feature.properties[this.groupBy];\n\n\t\t\t\tif (!this.geometryEdgesByMapId.has(groupId)) {\n\t\t\t\t\tthis.geometryEdgesByMapId.set(groupId, []);\n\t\t\t\t}\n\t\t\t\tcoords.forEach((v, i) => {\n\t\t\t\t\tthis.geometryEdgesByMapId.get(groupId)!.push([\n\t\t\t\t\t\tv,\n\t\t\t\t\t\tcoords[i + 1] || coords[0], // Safely wrap around if at the end of the array.\n\t\t\t\t\t]);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate getDisabledNodeIds(): Set<string> {\n\t\tconst disabledNodeIds = new Set<string>();\n\n\t\t// Exclude non-public nodes when the well-known public flag is declared\n\t\tif (WELL_KNOWN_FLAGS.public in this.flagDeclarations) {\n\t\t\tfor (const nodeId in this.graph.nodesById) {\n\t\t\t\tif (\n\t\t\t\t\t!hasFlag(\n\t\t\t\t\t\tthis.graph.nodesById[nodeId].properties.flags,\n\t\t\t\t\t\tthis.flagDeclarations[WELL_KNOWN_FLAGS.public].index,\n\t\t\t\t\t\tthis.flagDeclarations[WELL_KNOWN_FLAGS.public].bit,\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tdisabledNodeIds.add(nodeId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn disabledNodeIds;\n\t}\n\n\t/**\n\t * Calculates and returns a set of directions from origin nodes to destination nodes, including detailed properties.\n\t *\n\t * @param {DirectionsZone[]} zones - special zones for navigation operations.\n\t * @param {string[]} originIds - IDs of origin nodes.\n\t * @param {string[]} destinationNodeIds - IDs of destination nodes.\n\t * @param {string[]} [disabledConnectionNodeIds] - IDs of connection nodes that are disabled (ie. act as regular nodes).\n\t * @param {SimplifyDirectionsOptions} [simplify] - Options to simplify the pathfinding result.\n\t * @returns {DirectionsCollection} A collection of directional features representing the path.\n\t */\n\tpublic getDirections({\n\t\tzones: directionsZones,\n\t\toriginIds,\n\t\tdestinationNodeIds,\n\t\tdisabledConnectionNodeIds,\n\t\tsimplify,\n\t\tmultiplicativeDistanceWeightScaling,\n\t\toverrideEdgeWeights,\n\t}: {\n\t\toriginIds: string[];\n\t\tdestinationNodeIds: string[];\n\t\tzones?: DirectionsZone[];\n\t\tdisabledConnectionNodeIds?: string[];\n\t\tsimplify?: SimplifyDirectionsOptions;\n\t\tmultiplicativeDistanceWeightScaling?: boolean;\n\t\toverrideEdgeWeights?: Map<Edge, number>;\n\t}): DirectionsCollection {\n\t\tconst simplifyEnabled = simplify?.enabled ?? true;\n\t\tconst zones = directionsZones ?? [];\n\n\t\tlet steps = this.graph.aStar({\n\t\t\toriginIds,\n\t\t\tdestinationNodeIds,\n\t\t\tzones,\n\t\t\tdisabledConnectionNodeIds: new Set(disabledConnectionNodeIds),\n\t\t\toverrideEdgeWeights,\n\t\t\t// TODO: We eventually may want to include non-public nodes for emergency pathing or other\n\t\t\t// such controllable options. For now, always exclude non-public nodes from pathing.\n\t\t\tdisabledNodeIds: this.disabledNodeIds,\n\t\t});\n\n\t\tif (steps.length === 0) {\n\t\t\treturn { type: 'FeatureCollection', features: [] };\n\t\t}\n\n\t\tif (simplifyEnabled) {\n\t\t\tsteps = this.simplifyAllSteps(\n\t\t\t\tsteps,\n\t\t\t\tsimplify?.bufferRadius ?? DEFAULT_BUFFER_RADIUS,\n\t\t\t\tmultiplicativeDistanceWeightScaling,\n\t\t\t);\n\t\t}\n\n\t\treturn this.generatePath(steps);\n\t}\n\n\t/**\n\t * Generates a path from a series of edges, constructing a feature collection of directional steps.\n\t *\n\t * @param {Edge[]} steps - An array of edges representing the path.\n\t * @returns {DirectionsCollection} A collection of directional features.\n\t */\n\tprivate generatePath = (steps: Edge[]): DirectionsCollection => {\n\t\tconst { destination } = steps[steps.length - 1];\n\t\tconst path: DirectionsCollection = {\n\t\t\ttype: 'FeatureCollection',\n\t\t\tfeatures: [],\n\t\t};\n\n\t\tfor (let i = 0; i < steps.length; i++) {\n\t\t\tconst { origin, destination } = steps[i];\n\t\t\tconst properties: DirectionProperties = {\n\t\t\t\tid: origin.properties.id,\n\t\t\t\tangle: steps[i].angle,\n\t\t\t\tdistance: steps[i].distance,\n\t\t\t\tdestination: destination.properties.id,\n\t\t\t\tedges: this.graph.edges[origin.properties.id],\n\t\t\t};\n\n\t\t\tif (this.groupBy !== 'default') {\n\t\t\t\tproperties.groupBy = origin.properties[this.groupBy];\n\t\t\t}\n\t\t\tpath.features.push({\n\t\t\t\ttype: 'Feature',\n\t\t\t\tgeometry: { type: 'Point', coordinates: [origin.geometry.coordinates[0], origin.geometry.coordinates[1]] },\n\t\t\t\tproperties,\n\t\t\t});\n\t\t}\n\n\t\tconst properties: DirectionProperties = {\n\t\t\tid: destination.properties.id,\n\t\t\tedges: this.graph.edges[destination.properties.id],\n\t\t};\n\n\t\tif (this.groupBy !== 'default') {\n\t\t\tproperties.groupBy = destination.properties[this.groupBy];\n\t\t}\n\n\t\tpath.features.push({\n\t\t\ttype: 'Feature',\n\t\t\tgeometry: {\n\t\t\t\ttype: 'Point',\n\t\t\t\tcoordinates: [destination.geometry.coordinates[0], destination.geometry.coordinates[1]],\n\t\t\t},\n\t\t\tproperties,\n\t\t});\n\n\t\treturn path;\n\t};\n\n\t/**\n\t * Simplifies a sequence of steps by reducing unnecessary nodes using a buffer radius to check for obstructions.\n\t *\n\t * @param {Edge[]} steps - The steps to simplify.\n\t * @param {number} bufferRadius - The buffer radius to use\n\t * for simplification.\n\t * @returns {Edge[]} An array of simplified edges representing a more direct path.\n\t */\n\tprivate simplifyAllSteps(steps: Edge[], bufferRadius: number, multiplicativeDistanceWeightScaling?: boolean): Edge[] {\n\t\tconst processedSteps: Edge[] = [];\n\t\tlet stepMapSegment: Edge[] = [steps[0]];\n\n\t\tfor (let i = 1; i < steps.length; i++) {\n\t\t\tif (\n\t\t\t\tthis.groupBy !== 'default' &&\n\t\t\t\tsteps[i].origin.properties[this.groupBy] !== steps[i - 1].origin.properties[this.groupBy]\n\t\t\t) {\n\t\t\t\tconst groupId = steps[i - 1].origin.properties[this.groupBy];\n\t\t\t\tconst edges = this.geometryEdgesByMapId.get(groupId) ?? [];\n\t\t\t\tprocessedSteps.push(\n\t\t\t\t\t...this.simplifySteps(stepMapSegment, edges, bufferRadius, multiplicativeDistanceWeightScaling),\n\t\t\t\t);\n\t\t\t\tstepMapSegment = [steps[i]];\n\t\t\t} else {\n\t\t\t\tstepMapSegment.push(steps[i]);\n\t\t\t}\n\t\t}\n\n\t\t// Handle the last segment\n\t\tconst finalStep = steps[steps.length - 1];\n\t\tconst finalGroupId = this.groupBy === 'default' ? this.groupBy : finalStep.origin.properties[this.groupBy];\n\t\tconst finalEdges = this.geometryEdgesByMapId.get(finalGroupId) ?? [];\n\t\tprocessedSteps.push(\n\t\t\t...this.simplifySteps(stepMapSegment, finalEdges, bufferRadius, multiplicativeDistanceWeightScaling),\n\t\t);\n\n\t\treturn processedSteps;\n\t}\n\n\t/**\n\t * Finds the nearest nodes on the graph within a given travel distance.\n\t *\n\t * @param originId - The ID of the origin node.\n\t * @param maxDistance - The maximum distance to search.\n\t * @param floorId - The ID of the floor.\n\t * @param includedNodeIds - The IDs of the nodes to include.\n\t * @param useLineOfSight - Whether to use line of sight.\n\t * @returns An array of nodes within the travel distance that satisfy the goal function.\n\t */\n\tpublic findNearestNodesOnGraph = (\n\t\toriginId: string,\n\t\tmaxDistance: number,\n\t\tfloorId: string,\n\t\tincludedNodeIds: string[],\n\t\tuseLineOfSight = false,\n\t\tlimitNumberOfResults = Infinity,\n\t) => {\n\t\treturn this.graph.dijkstraFindWithinTravelDistance(\n\t\t\toriginId,\n\t\t\tmaxDistance,\n\t\t\tincludedNodeIds,\n\t\t\tthis.geometryEdgesByMapId.get(floorId) ?? [],\n\t\t\tuseLineOfSight,\n\t\t\tlimitNumberOfResults,\n\t\t);\n\t};\n\n\t/**\n\t * Checks if there is a line of sight between two points on the map.\n\t *\n\t * @param origin - The origin point.\n\t * @param destination - The destination point.\n\t * @param floorId - The ID of the floor.\n\t * @param bufferRadius - The buffer radius to use when checking for line of sight.\n\t * @returns True if there is a line of sight, false otherwise.\n\t */\n\tpublic hasLineOfSight = (\n\t\torigin: [number, number],\n\t\tdestination: [number, number],\n\t\tfloorId: string,\n\t\tbufferRadius?: number,\n\t): boolean => {\n\t\treturn this.graph.hasLineOfSight(origin, destination, this.geometryEdgesByMapId.get(floorId), bufferRadius);\n\t};\n\n\t/**\n\t * Simplifies a section of steps by checking direct lines of sight between steps and eliminating intermediate nodes if unobstructed.\n\t *\n\t * @param {Edge[]} steps - The steps to potentially simplify.\n\t * @param {[number, number][][]} geometryEdges - The geometrical edges of the map used to check for line of sight.\n\t * @param {number} bufferRadius - The buffer radius to use when simplifying.\n\t * @returns {Edge[]} An array of simplified edges.\n\t */\n\tprivate simplifySteps(\n\t\tsteps: Edge[],\n\t\tgeometryEdges: [number, number][][],\n\t\tbufferRadius: number,\n\t\tmultiplicativeDistanceWeightScaling?: boolean,\n\t): Edge[] {\n\t\tif (steps.length < 3) return steps;\n\n\t\tconst simpleSteps: Edge[] = [steps[0]];\n\t\tlet n = 1;\n\t\tfor (let m = n + 2; m < steps.length; m++) {\n\t\t\t/*\n\t\t\t * TODO: Implement edge simplification zone checks.\n\t\t\t * In some cases, simplification and A* may need to consider zones to ensure the path remains valid.\n\t\t\t * When edge intersects with a zone, the simplification shouldn't remove the edge.\n\t\t\t * To implement this, we need have to create multiple equidistant points along the edge and\n\t\t\t * check if any of them are in the zone.\n\t\t\t */\n\t\t\tif (\n\t\t\t\t/**\n\t\t\t\t * Some nodes may be generated from ORS and accurately model roads; we don't want to simplify these.\n\t\t\t\t * MVFv3s and MVFv2s converted from MVFv3s will specify this flag.\n\t\t\t\t */\n\t\t\t\t('outdoors' in this.flagDeclarations &&\n\t\t\t\t\thasFlag(\n\t\t\t\t\t\tsteps[n]?.origin?.properties?.flags ?? [],\n\t\t\t\t\t\tthis.flagDeclarations.outdoors.index,\n\t\t\t\t\t\tthis.flagDeclarations.outdoors.bit,\n\t\t\t\t\t)) ||\n\t\t\t\t/**\n\t\t\t\t * Some nodes may explicitly specify that they should not be smoothed. Native MVFv2s will specify\n\t\t\t\t * this flag on outdoor nodes.\n\t\t\t\t */\n\t\t\t\tsteps[n].origin.properties.preventSmoothing ||\n\t\t\t\t/**\n\t\t\t\t * Otherwise, do not smooth if a node does not have line of sight to the next node, because the path\n\t\t\t\t * would go through obstructions.\n\t\t\t\t */\n\t\t\t\t!hasLineOfSight(steps[n].origin, steps[m].origin, geometryEdges, bufferRadius)\n\t\t\t) {\n\t\t\t\tconst lastVisible = m - 1;\n\t\t\t\tsimpleSteps.push(\n\t\t\t\t\tnew Edge({\n\t\t\t\t\t\t...steps[n],\n\t\t\t\t\t\tdestination: steps[lastVisible].origin,\n\t\t\t\t\t\tdistance: equirectangularDistance(\n\t\t\t\t\t\t\tsteps[n].origin.geometry.coordinates,\n\t\t\t\t\t\t\tsteps[lastVisible].origin.geometry.coordinates,\n\t\t\t\t\t\t),\n\t\t\t\t\t\tangle: getAngle(steps[n].origin.geometry.coordinates, steps[lastVisible].origin.geometry.coordinates),\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t\tn = lastVisible;\n\t\t\t}\n\t\t}\n\n\t\t// Add the last two steps leaving the final as is\n\t\t// This ensures the path will enter from the hallway node directly in front of the entranceNode\n\t\tsimpleSteps.push(\n\t\t\tnew Edge({\n\t\t\t\t...steps[n],\n\t\t\t\tdestination: steps[steps.length - 1].origin,\n\t\t\t\tdistance: equirectangularDistance(\n\t\t\t\t\tsteps[n].origin.geometry.coordinates,\n\t\t\t\t\tsteps[steps.length - 1].origin.geometry.coordinates,\n\t\t\t\t),\n\t\t\t\tangle: getAngle(steps[n].origin.geometry.coordinates, steps[steps.length - 1].origin.geometry.coordinates),\n\t\t\t\tmultiplicativeDistanceWeightScaling: multiplicativeDistanceWeightScaling,\n\t\t\t}),\n\t\t\tsteps[steps.length - 1],\n\t\t);\n\n\t\treturn simpleSteps;\n\t}\n\n\t/**\n\t * Calculates the approximate distance between two geographic coordinates on Earth's surface.\n\t *\n\t * This function uses the equirectangular approximation method to compute the distance, which simplifies\n\t * the math and speeds up calculations, but is less accurate over long distances compared to other methods\n\t * like the haversine formula.\n\t *\n\t * @param {Position} point1 - The first point's longitude and latitude as [longitude, latitude].\n\t * @param {Position} point2 - The second point's longitude and latitude as [longitude, latitude].\n\t * @return\n\t * @return {number} The approximate distance between the two points in meters.\n\t */\n\tpublic getDistance = (point1: Position, point2: Position) => {\n\t\treturn equirectangularDistance(point1, point2);\n\t};\n\n\t/**\n\t * Calculates the angle between two geographic coordinates.\n\t *\n\t * @param {Position} point1 - The first point's longitude and latitude as [longitude, latitude].\n\t * @param {Position} point2 - The second point's longitude and latitude as [longitude, latitude].\n\t * @hidden\n\t *\n\t * @return {number} The angle in radians, calculated clockwise from the north between the two points specified.\n\t */\n\tpublic getAngle = (point1: Position, point2: Position) => {\n\t\treturn getAngle(point1, point2);\n\t};\n}\n", "export * from './edge';\n", "import type { NodeFeature } from '../types/node';\n\nconst DEFAULT_WEIGHT = 0;\n\n/**\n * Represents an edge in a graph, containing data about its endpoints and metrics like distance and angle.\n * @hidden\n */\nexport class Edge {\n\t/** The originating node of the edge */\n\tpublic origin: NodeFeature;\n\t/** The destination node of the edge */\n\tpublic destination: NodeFeature;\n\t/** The distance between the origin and the destination nodes */\n\tpublic distance: number;\n\t/** The angle of the edge with respect to some reference, in degrees */\n\tpublic angle: number;\n\t/** A composite weight of the edge, combining distance and a custom path weight */\n\tpublic weight: number;\n\n\t/**\n\t * Constructs a new Edge instance.\n\t * @param {NodeFeature} origin - The originating node of the edge.\n\t * @param {NodeFeature} destination - The destination node of the edge.\n\t * @param {number} [distance=0] - The physical distance between the origin and destination.\n\t * @param {number} [angle=0] - The angle of the edge in degrees.\n\t * @param {number} [pathWeight=0] - An additional weight factor for the path.\n\t */\n\tconstructor({\n\t\torigin,\n\t\tdestination,\n\t\tdistance = 0,\n\t\tangle = 0,\n\t\tpathWeight = DEFAULT_WEIGHT,\n\t\tmultiplicativeDistanceWeightScaling = true,\n\t}: {\n\t\torigin: NodeFeature;\n\t\tdestination: NodeFeature;\n\t\tdistance?: number;\n\t\tangle?: number;\n\t\tpathWeight?: number;\n\t\tmultiplicativeDistanceWeightScaling?: boolean;\n\t}) {\n\t\tthis.origin = origin;\n\t\tthis.destination = destination;\n\t\tthis.distance = distance;\n\t\tthis.angle = angle;\n\t\t// The only case we directly use the path weight is when floor was changed\n\t\tthis.weight = pathWeight || DEFAULT_WEIGHT;\n\n\t\tif (multiplicativeDistanceWeightScaling) {\n\t\t\t// TODO: Improve distance handling for connections\n\t\t\t// Currently, connection nodes have zero distance but high weight. We need to enhance our algorithm to calculate more accurate distances for connection nodes.\n\t\t\t// - The distance is zero because it's computed entirely based on coordinates. ie we could consider vertical distance and transition time between floors.\n\t\t\t// - The weightValue is coming from mvf directly, for self serve the floor distance value is factored into weightValue\n\t\t\tif (origin.properties.floor === destination.properties.floor) {\n\t\t\t\t// see graph in: https://github.com/MappedIn/sdk/pull/461\n\t\t\t\tthis.weight = (this.weight >= 0 ? this.distance * this.weight : DEFAULT_WEIGHT) + this.distance;\n\t\t\t}\n\t\t} else {\n\t\t\tif (origin.properties.map === destination.properties.map) {\n\t\t\t\t// fallback to V5 weight calculation approach to avoid surprises\n\t\t\t\tthis.weight = this.weight >= 0 ? this.distance + this.weight : DEFAULT_WEIGHT;\n\t\t\t}\n\t\t}\n\n\t\tif (isNaN(this.angle)) {\n\t\t\tthrow new Error('Invalid angle: Expected a numeric value, but received NaN.');\n\t\t}\n\t}\n}\n", "export * from './navigation-graph';\n", "import booleanPointInPolygon from '@turf/boolean-point-in-polygon';\n\nimport { Edge } from '../edge';\nimport { getAngle, hasLineOfSight } from '../utils';\nimport { equirectangularDistance, euclideanDistance } from '../../../common/utils';\n\nimport type { NodeCollection, NodeFeature } from '../types/node';\nimport type { DirectionsZone } from '../navigator';\nimport type { Position } from 'geojson';\n\n/*\nDefault buffer radius of 0.4 meters.\nThis value is chosen to account for common navigational constraints such as doorways,\nwhich are typically around 0.85 meters wide in Canada and the US.\nBy setting the buffer radius to slightly less than half the average doorway width,\nwe ensure a comfortable margin that allows for accurate pathfinding around typical obstacles.\n */\nexport const DEFAULT_BUFFER_RADIUS = 0.4;\n\n/**\n * Represents a navigation graph for pathfinding operations, holding nodes and edges with utilities to perform routing.\n * @see {@link https://mappedin.atlassian.net/wiki/spaces/SDK/pages/234487854/A+Search+Algorithm+in+Navigation+Graph}\n * @hidden\n */\nexport class NavigationGraph {\n\tpublic readonly edges: { [propName: string]: Edge[] } = {};\n\t// The map of  node features by their ID for quick access\n\tpublic readonly nodesById: { [propName: string]: NodeFeature };\n\t// The map of node features by their group(specified by a property) for quick access\n\tpublic readonly nodesByGroup = new Map<string, NodeFeature[]>();\n\t#groupBy: string;\n\n\tconstructor({\n\t\tnodes,\n\t\tgroupBy,\n\t\tmultiplicativeDistanceWeightScaling,\n\t}: {\n\t\tnodes: NodeCollection;\n\t\tgroupBy: string;\n\t\tmultiplicativeDistanceWeightScaling?: boolean;\n\t}) {\n\t\tthis.#groupBy = groupBy;\n\t\tconst { features: nodesList } = nodes;\n\n\t\t// Mapping of node IDs to node features for quick access\n\t\tthis.nodesById = this.#createNodesById(nodesList);\n\t\t// Ensure there are no references to non-existent nodes\n\t\tthis.#removeInvalidNeighbors();\n\t\t// Initialize edges based on node neighbors with computed distance and angle and group nodes by a specified property\n\t\tthis.#initializeEdgesAndGroups(nodesList, groupBy, { multiplicativeDistanceWeightScaling });\n\t}\n\n\t/**\n\t * Calculates the shortest Euclidean distance from the origin node to any of the destination nodes.\n\t *\n\t * @param origin - The origin node.\n\t * @param destinations - An array of destination nodes.\n\t * @returns The shortest Euclidean distance.\n\t */\n\tpublic getShortestEuclideanDistance(origin: NodeFeature, destinations: NodeFeature[]): number {\n\t\treturn destinations.reduce((result, destination) => {\n\t\t\tconst distance = euclideanDistance(origin.geometry.coordinates, destination.geometry.coordinates);\n\n\t\t\treturn Math.min(result, distance);\n\t\t}, Number.MAX_VALUE);\n\t}\n\n\tpublic hasLineOfSight = (\n\t\torigin: Position,\n\t\tdestination: Position,\n\t\tedges: Position[][] = [],\n\t\tbufferRadius = DEFAULT_BUFFER_RADIUS,\n\t): boolean => {\n\t\tconst originFeature = {\n\t\t\ttype: 'Feature',\n\t\t\tproperties: {\n\t\t\t\tid: 'origin',\n\t\t\t\tneighbors: [],\n\t\t\t},\n\t\t\tgeometry: {\n\t\t\t\ttype: 'Point',\n\t\t\t\tcoordinates: origin,\n\t\t\t},\n\t\t} as NodeFeature;\n\n\t\tconst destinationFeature = {\n\t\t\ttype: 'Feature',\n\t\t\tproperties: {\n\t\t\t\tid: 'destination',\n\t\t\t\tneighbors: [],\n\t\t\t},\n\t\t\tgeometry: {\n\t\t\t\ttype: 'Point',\n\t\t\t\tcoordinates: destination,\n\t\t\t},\n\t\t} as NodeFeature;\n\n\t\treturn hasLineOfSight(originFeature, destinationFeature, edges, bufferRadius) === true;\n\t};\n\n\t/**\n\t * Performs a Dijkstra search to find nodes within a given travel distance that satisfy a goal function, sorted by distance.\n\t *\n\t * @param originId - Origin node ID.\n\t * @param maxTravelDistance - The maximum travel distance.\n\t * @param includedNodeIds - Array of node IDs to include in the search.\n\t * @param obstructionEdges - Array of obstruction edges for line of sight calculations.\n\t * @param useLineOfSight - Whether to use line of sight checking.\n\t * @returns An Array of nodes within the travel distance that satisfy the goal function.\n\t * - feature: The node feature.\n\t * - distance: The distance to the node.\n\t * - edges: The edges to the node.\n\t */\n\tpublic dijkstraFindWithinTravelDistance(\n\t\toriginId: string,\n\t\tmaxTravelDistance: number,\n\t\tincludedNodeIds: string[],\n\t\tobstructionEdges: Position[][],\n\t\tuseLineOfSight: boolean,\n\t\tlimitNumberOfResults: number,\n\t): {\n\t\tfeature: NodeFeature;\n\t\tdistance: number;\n\t}[] {\n\t\tconst origin = this.nodesById[originId];\n\n\t\tif (!origin) {\n\t\t\treturn [];\n\t\t}\n\n\t\t// Priority queue for nodes to explore, sorted by distance\n\t\tconst frontier: { node: NodeFeature; distance: number }[] = [];\n\t\t// Map of node IDs to their predecessors in the path\n\t\tconst cameFrom: { [propName: string]: Edge | null } = {};\n\t\t// Map of node IDs to the cost of the path from origin to that node\n\t\tconst costSoFar: { [propName: string]: number } = {};\n\t\t// Set of visited nodes to avoid revisiting\n\t\tconst visited = new Set<string>();\n\t\t// Results array for nodes that satisfy the goal function\n\t\tconst results: {\n\t\t\tfeature: NodeFeature;\n\t\t\tdistance: number;\n\t\t}[] = [];\n\n\t\t// Initialize with origin node\n\t\tfrontier.push({ node: origin, distance: 0 });\n\t\tcameFrom[origin.properties.id] = null;\n\t\tcostSoFar[origin.properties.id] = 0;\n\n\t\twhile (frontier.length > 0) {\n\t\t\t// TODO: consider using minHeap instead of sort the entire array in the loop\n\t\t\t// Get the node with the smallest distance\n\t\t\tfrontier.sort((a, b) => a.distance - b.distance);\n\t\t\tconst current = frontier.shift();\n\t\t\tif (!current) break;\n\n\t\t\tconst currentNode = current.node;\n\t\t\tconst currentDistance = current.distance;\n\n\t\t\t// Skip if already visited\n\t\t\tif (visited.has(currentNode.properties.id)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Mark as visited\n\t\t\tvisited.add(currentNode.properties.id);\n\n\t\t\tif (results.length >= limitNumberOfResults) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// Check if this node satisfies the goal function\n\t\t\tif (currentNode.properties.id != null && includedNodeIds.includes(currentNode.properties.id?.toString())) {\n\t\t\t\t// check if the node is visible from the origin\n\t\t\t\tif (useLineOfSight) {\n\t\t\t\t\t// TODO: can we make this faster by caching?\n\t\t\t\t\tif (this.hasLineOfSight(origin.geometry.coordinates, currentNode.geometry.coordinates, obstructionEdges)) {\n\t\t\t\t\t\t// if the node is visible, add it to the results\n\t\t\t\t\t\tresults.push({\n\t\t\t\t\t\t\tfeature: currentNode,\n\t\t\t\t\t\t\tdistance: currentDistance,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tresults.push({\n\t\t\t\t\t\tfeature: currentNode,\n\t\t\t\t\t\tdistance: currentDistance,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Explore neighbors\n\t\t\tfor (const edge of this.edges[currentNode.properties.id]) {\n\t\t\t\tconst neighbor = edge.destination;\n\t\t\t\t// Use edge.distance for actual travel distance, edge.weight for cost\n\t\t\t\tconst newDistance = currentDistance + edge.distance;\n\t\t\t\tconst newCost = costSoFar[currentNode.properties.id] + edge.weight;\n\n\t\t\t\t// Skip if beyond max travel distance\n\t\t\t\tif (newDistance > maxTravelDistance) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Skip if already visited or if we found a better path\n\t\t\t\tif (\n\t\t\t\t\tvisited.has(neighbor.properties.id) ||\n\t\t\t\t\t(costSoFar[neighbor.properties.id] !== undefined && newCost >= costSoFar[neighbor.properties.id])\n\t\t\t\t) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Update path information\n\t\t\t\tcostSoFar[neighbor.properties.id] = newCost;\n\t\t\t\tcameFrom[neighbor.properties.id] = edge;\n\t\t\t\tfrontier.push({ node: neighbor, distance: newDistance });\n\t\t\t}\n\t\t}\n\n\t\t// Sort results by distance (nearest first)\n\t\treturn results.sort((a, b) => a.distance - b.distance);\n\t}\n\n\t/**\n\t * Performs A* pathfinding from specified origins to destinations, considering optional constraints like accessibility.\n\t *\n\t * @param {string[]} originIds - Array of origin node IDs.\n\t * @param {string[]} destinationNodeIds - Array of destination node IDs.\n\t * @param {Set<string>} [disabledConnectionNodeIds] - Optional set of connection node IDs that are disabled (ie. act as regular nodes).\n\t * @param {Set<string>} [disabledNodeIds] - Optional set of node IDs which are ignored during pathfinding.\n\t * @returns {Edge[]} An array of edges representing the shortest path, or an empty array if no path is found.\n\t */\n\tpublic aStar({\n\t\toriginIds,\n\t\tdestinationNodeIds,\n\t\tdisabledConnectionNodeIds,\n\t\tzones,\n\t\toverrideEdgeWeights,\n\t\tdisabledNodeIds,\n\t}: {\n\t\toriginIds: string[];\n\t\tdestinationNodeIds: string[];\n\t\tzones: DirectionsZone[];\n\t\tdisabledConnectionNodeIds?: Set<string>;\n\t\toverrideEdgeWeights?: Map<Edge, number>;\n\t\tdisabledNodeIds?: Set<string>;\n\t}): Edge[] {\n\t\tconst origins = this.#filterValidNodes(originIds);\n\t\tconst destinations = this.#filterValidNodes(destinationNodeIds);\n\n\t\tif (origins.length === 0 || destinations.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\t/*\n\t\t * frontier - Priority queue of nodes to explore, sorted by the cost of the path to the node\n\t\t * cameFrom - Map of nodes and their predecessors in the path\n\t\t * costSoFar - Map of nodes and the cost of the path from the start node to the node\n\t\t */\n\t\tconst { frontier, cameFrom, costSoFar } = this.#initializeSearch(origins, destinations);\n\n\t\twhile (frontier.length > 0) {\n\t\t\tconst current = frontier.shift(); // Use shift() to remove the first element\n\t\t\tif (!current) break;\n\n\t\t\t// Check if the current node is a destination node and reconstruct the path if true\n\t\t\tif (this.#isDestinationNode(current.origin, destinations)) {\n\t\t\t\treturn this.#reconstructPath(cameFrom, current.origin.properties.id);\n\t\t\t}\n\n\t\t\t// Explore each edge from the current node\n\t\t\tfor (const edge of this.edges[current.origin.properties.id]) {\n\t\t\t\tconst edgeWeight = overrideEdgeWeights?.get(edge) ?? edge.weight;\n\t\t\t\t// if the connection is disabled, we don't want to consider edges that would take us to\n\t\t\t\t// a different floor, but we do want to consider edges on the current floor\n\t\t\t\t// Otherwise, if the node itself is disabled, skip it.\n\t\t\t\tif (\n\t\t\t\t\t(disabledConnectionNodeIds?.has(edge.origin.properties.id) &&\n\t\t\t\t\t\tedge.destination.properties.map !== edge.origin.properties.map) ||\n\t\t\t\t\tdisabledNodeIds?.has(edge.origin.properties.id)\n\t\t\t\t) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Calculate the new cost to reach the neighbor node\n\t\t\t\tconst newCost =\n\t\t\t\t\tcostSoFar[current.origin.properties.id] + edgeWeight + this.#getZonalCost(edge.destination, zones);\n\n\t\t\t\tif (newCost === Infinity) continue;\n\n\t\t\t\t// If this path to the neighbor is cheaper or the neighbor hasn't been visited yet, update the cost and priority\n\t\t\t\tif (costSoFar[edge.destination.properties.id] == null || newCost < costSoFar[edge.destination.properties.id]) {\n\t\t\t\t\t// Calculate the total priority for the neighbor node\n\t\t\t\t\tconst cost = newCost + this.getShortestEuclideanDistance(edge.destination, destinations);\n\n\t\t\t\t\t// Update costSoFar and cameFrom for the neighbor node\n\t\t\t\t\tcostSoFar[edge.destination.properties.id] = newCost;\n\t\t\t\t\tcameFrom[edge.destination.properties.id] = edge;\n\t\t\t\t\tfrontier.push({ origin: edge.destination, priority: cost });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfrontier.sort((a, b) => a.priority - b.priority);\n\t\t}\n\n\t\treturn [];\n\t}\n\n\t#filterValidNodes(nodeIds: string[]): NodeFeature[] {\n\t\treturn nodeIds.map(id => this.nodesById[id]).filter(Boolean);\n\t}\n\n\t#createNodesById(nodesList: NodeFeature[]): { [propName: string]: NodeFeature } {\n\t\treturn nodesList.reduce((result, node) => {\n\t\t\tresult[node.properties.id] = node;\n\n\t\t\treturn result;\n\t\t}, {});\n\t}\n\n\t#removeInvalidNeighbors() {\n\t\tfor (const id in this.nodesById) {\n\t\t\tif (this.nodesById.hasOwnProperty(id)) {\n\t\t\t\tthis.nodesById[id].properties.neighbors = this.nodesById[id].properties.neighbors.filter(\n\t\t\t\t\t({ id }) => !!this.nodesById[id],\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\t#initializeEdgesAndGroups(\n\t\tnodesList: NodeFeature[],\n\t\tgroupBy: string,\n\t\toptions?: { multiplicativeDistanceWeightScaling?: boolean },\n\t) {\n\t\tnodesList.forEach(origin => {\n\t\t\tconst groupId = groupBy === 'default' ? groupBy : origin.properties[groupBy];\n\t\t\tif (!this.nodesByGroup.has(groupId)) {\n\t\t\t\tthis.nodesByGroup.set(groupId, []);\n\t\t\t}\n\n\t\t\tthis.nodesByGroup.get(groupId)!.push(origin);\n\t\t\tthis.edges[origin.properties.id] = origin.properties.neighbors.map(({ id, weight: pathWeight }) => {\n\t\t\t\tconst destination = this.nodesById[id];\n\t\t\t\tconst distance = equirectangularDistance(origin.geometry.coordinates, destination.geometry.coordinates);\n\t\t\t\tconst angle = getAngle(origin.geometry.coordinates, destination.geometry.coordinates);\n\n\t\t\t\treturn new Edge({\n\t\t\t\t\torigin,\n\t\t\t\t\tdestination,\n\t\t\t\t\tpathWeight,\n\t\t\t\t\tdistance,\n\t\t\t\t\tangle,\n\t\t\t\t\tmultiplicativeDistanceWeightScaling: options?.multiplicativeDistanceWeightScaling,\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t#initializeSearch(origins: NodeFeature[], destinations: NodeFeature[]) {\n\t\tconst frontier: { origin: NodeFeature; priority: number }[] = [];\n\t\tconst cameFrom: { [propName: string]: Edge | null } = {};\n\t\tconst costSoFar: { [propName: string]: number } = {};\n\n\t\torigins.forEach(origin => {\n\t\t\tconst priority = this.getShortestEuclideanDistance(origin, destinations);\n\n\t\t\tfrontier.push({ origin, priority });\n\t\t\tcameFrom[origin.properties.id] = null;\n\t\t\tcostSoFar[origin.properties.id] = 0;\n\t\t});\n\n\t\tfrontier.sort((a, b) => a.priority - b.priority);\n\n\t\treturn { frontier, cameFrom, costSoFar };\n\t}\n\n\t#isDestinationNode(currentNode: NodeFeature, destinations: NodeFeature[]): boolean {\n\t\treturn destinations.some(destination => destination.properties.id === currentNode.properties.id);\n\t}\n\n\t#reconstructPath(cameFrom: { [propName: string]: Edge | null }, currentId: string): Edge[] {\n\t\tconst directions: Edge[] = [];\n\t\tlet step = cameFrom[currentId];\n\n\t\twhile (step) {\n\t\t\tdirections.push(step);\n\t\t\tstep = cameFrom[step.origin.properties.id];\n\t\t}\n\n\t\treturn directions.reverse();\n\t}\n\n\t#getZonalCost = (node: NodeFeature, zones: DirectionsZone[]): number => {\n\t\tlet cost = 0;\n\n\t\tfor (const zone of zones) {\n\t\t\tconst validZone = !zone[this.#groupBy] || zone[this.#groupBy] === node.properties[this.#groupBy];\n\n\t\t\tif (validZone && booleanPointInPolygon(node.geometry.coordinates, zone.geometry.geometry)) {\n\t\t\t\t/*\n\t\t\t\t * When newCost is lower than previous values, the node is pushed back into the frontier,\n\t\t\t\t * potentially with a higher priority.\n\t\t\t\t * This can cause the algorithm to reprocess the same nodes multiple times,\n\t\t\t\t * especially if the cost keeps decreasing, creating a loop.\n\t\t\t\t * The frontier doesn't get smaller, and the algorithm can continue to loop indefinitely.\n\t\t\t\t * So we have to ensure that the cost is always positive.\n\t\t\t\t */\n\t\t\t\tcost += Math.max(0, zone.cost); // Ensure no negative costs to avoid ifinite loops\n\t\t\t}\n\t\t}\n\n\t\treturn cost;\n\t};\n}\n", "import { getCoord, getGeom } from \"@turf/invariant\";\n// http://en.wikipedia.org/wiki/Even%E2%80%93odd_rule\n// modified from: https://github.com/substack/point-in-polygon/blob/master/index.js\n// which was modified from http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html\n/**\n * Takes a {@link Point} and a {@link Polygon} or {@link MultiPolygon} and determines if the point\n * resides inside the polygon. The polygon can be convex or concave. The function accounts for holes.\n *\n * @name booleanPointInPolygon\n * @param {Coord} point input point\n * @param {Feature<Polygon|MultiPolygon>} polygon input polygon or multipolygon\n * @param {Object} [options={}] Optional parameters\n * @param {boolean} [options.ignoreBoundary=false] True if polygon boundary should be ignored when determining if\n * the point is inside the polygon otherwise false.\n * @returns {boolean} `true` if the Point is inside the Polygon; `false` if the Point is not inside the Polygon\n * @example\n * var pt = turf.point([-77, 44]);\n * var poly = turf.polygon([[\n *   [-81, 41],\n *   [-81, 47],\n *   [-72, 47],\n *   [-72, 41],\n *   [-81, 41]\n * ]]);\n *\n * turf.booleanPointInPolygon(pt, poly);\n * //= true\n */\nexport default function booleanPointInPolygon(point, polygon, options) {\n    if (options === void 0) { options = {}; }\n    // validation\n    if (!point) {\n        throw new Error(\"point is required\");\n    }\n    if (!polygon) {\n        throw new Error(\"polygon is required\");\n    }\n    var pt = getCoord(point);\n    var geom = getGeom(polygon);\n    var type = geom.type;\n    var bbox = polygon.bbox;\n    var polys = geom.coordinates;\n    // Quick elimination if point is not inside bbox\n    if (bbox && inBBox(pt, bbox) === false) {\n        return false;\n    }\n    // normalize to multipolygon\n    if (type === \"Polygon\") {\n        polys = [polys];\n    }\n    var insidePoly = false;\n    for (var i = 0; i < polys.length && !insidePoly; i++) {\n        // check if it is in the outer ring first\n        if (inRing(pt, polys[i][0], options.ignoreBoundary)) {\n            var inHole = false;\n            var k = 1;\n            // check for the point in any of the holes\n            while (k < polys[i].length && !inHole) {\n                if (inRing(pt, polys[i][k], !options.ignoreBoundary)) {\n                    inHole = true;\n                }\n                k++;\n            }\n            if (!inHole) {\n                insidePoly = true;\n            }\n        }\n    }\n    return insidePoly;\n}\n/**\n * inRing\n *\n * @private\n * @param {Array<number>} pt [x,y]\n * @param {Array<Array<number>>} ring [[x,y], [x,y],..]\n * @param {boolean} ignoreBoundary ignoreBoundary\n * @returns {boolean} inRing\n */\nfunction inRing(pt, ring, ignoreBoundary) {\n    var isInside = false;\n    if (ring[0][0] === ring[ring.length - 1][0] &&\n        ring[0][1] === ring[ring.length - 1][1]) {\n        ring = ring.slice(0, ring.length - 1);\n    }\n    for (var i = 0, j = ring.length - 1; i < ring.length; j = i++) {\n        var xi = ring[i][0];\n        var yi = ring[i][1];\n        var xj = ring[j][0];\n        var yj = ring[j][1];\n        var onBoundary = pt[1] * (xi - xj) + yi * (xj - pt[0]) + yj * (pt[0] - xi) === 0 &&\n            (xi - pt[0]) * (xj - pt[0]) <= 0 &&\n            (yi - pt[1]) * (yj - pt[1]) <= 0;\n        if (onBoundary) {\n            return !ignoreBoundary;\n        }\n        var intersect = yi > pt[1] !== yj > pt[1] &&\n            pt[0] < ((xj - xi) * (pt[1] - yi)) / (yj - yi) + xi;\n        if (intersect) {\n            isInside = !isInside;\n        }\n    }\n    return isInside;\n}\n/**\n * inBBox\n *\n * @private\n * @param {Position} pt point [x,y]\n * @param {BBox} bbox BBox [west, south, east, north]\n * @returns {boolean} true/false if point is inside BBox\n */\nfunction inBBox(pt, bbox) {\n    return (bbox[0] <= pt[0] && bbox[1] <= pt[1] && bbox[2] >= pt[0] && bbox[3] >= pt[1]);\n}\n", "export * from './get-angle';\nexport * from './has-line-of-sight';\nexport * from './rad-to-deg-normalized';\n", "import type { Position } from 'geojson';\n\n/**\n * Calculates the angle between two geographic coordinates.\n *\n * @param {Position} position1 - The first point's longitude and latitude as [longitude, latitude].\n * @param {Position} position2 - The second point's longitude and latitude as [longitude, latitude].\n * @hidden\n *\n * @return {number} The angle in radians, calculated clockwise from the north between the two points specified.\n */\nexport function getAngle([point1Lon, point1Lat]: Position, [point2Lon, point2Lat]: Position): number {\n\tconst xDelta = point1Lat - point2Lat;\n\tconst yDelta = point1Lon - point2Lon;\n\n\t// We need to add 3 * PI to the result to make sure the angle is positive\n\treturn (Math.atan2(yDelta, xDelta) + Math.PI * 3) % (Math.PI * 2); // radians;\n}\n", "import type { NodeFeature } from '../types/node';\nimport type { Position } from 'geojson';\nimport { getLineIntersection } from './get-line-intersection';\nimport { getOffsetLine } from './get-offset-line';\nimport { getAngle } from './get-angle';\nimport { radToDegNormalized } from './rad-to-deg-normalized';\n\nconst KM_PER_DEGREE_LAT = 111000;\n\n/**\n * Determines if there is a clear line of sight between two nodes, considering possible obstructions.\n * The function uses a buffer radius to create a corridor around the direct line of sight and checks for\n * intersections with given edges that might block the view. The function can handle both single and dual\n * raycast approaches depending on the buffer radius provided.\n *\n * @param {NodeFeature} originFeature - The starting node, which includes geographic coordinates.\n * @param {NodeFeature} destinationFeature - The ending node, which includes geographic coordinates.\n * @param {Position[][]} edges - An array of line segments ([Position, Position]) representing potential obstructions.\n * @param {number} bufferRadius - The radius to create a corridor around the line of sight. A radius of 0 uses a single raycast.\n * @hidden\n * @returns {boolean} True if there is a clear line of sight, false if obstructed.\n */\nexport function hasLineOfSight(\n\toriginFeature: NodeFeature,\n\tdestinationFeature: NodeFeature,\n\tedges: Position[][] = [],\n\tbufferRadius = 0,\n) {\n\tlet isVisible = true;\n\tconst origin = originFeature.geometry.coordinates as Position;\n\tconst destination = destinationFeature.geometry.coordinates as Position;\n\tconst angleLeft = radToDegNormalized(getAngle(origin, destination) - Math.PI / 2);\n\tconst angleRight = radToDegNormalized(getAngle(origin, destination) + Math.PI / 2);\n\n\tconst metersToDegreesLat = bufferRadius / KM_PER_DEGREE_LAT; // 111km per degree of latitude\n\tconst metersToDegreesLon = bufferRadius / (KM_PER_DEGREE_LAT * Math.cos((origin[1] * Math.PI) / 180)); // Adjust for latitude\n\n\t// optimize by using an axis aligned bounding box to skip any edges that don't intersect with the AABB of the ray\n\tconst minX = Math.min(origin[1], destination[1]) - metersToDegreesLat;\n\tconst maxX = Math.max(origin[1], destination[1]) + metersToDegreesLat;\n\tconst minY = Math.min(origin[0], destination[0]) - metersToDegreesLon;\n\tconst maxY = Math.max(origin[0], destination[0]) + metersToDegreesLon;\n\n\tfor (const edge of edges) {\n\t\tif (\n\t\t\tMath.max(edge[0][1], edge[1][1]) < minX ||\n\t\t\tMath.min(edge[0][1], edge[1][1]) > maxX ||\n\t\t\tMath.max(edge[0][0], edge[1][0]) < minY ||\n\t\t\tMath.min(edge[0][0], edge[1][0]) > maxY\n\t\t) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (bufferRadius > 0) {\n\t\t\t// Create offset lines to the left and right of the original line by the buffer radius\n\t\t\tconst parallelLeft = getOffsetLine(origin, destination, bufferRadius, angleLeft);\n\t\t\tconst parallelRight = getOffsetLine(origin, destination, bufferRadius, angleRight);\n\n\t\t\t// Check for intersections with the buffered lines\n\t\t\tif (\n\t\t\t\tgetLineIntersection(parallelLeft[0], parallelLeft[1], edge[0], edge[1]) ||\n\t\t\t\tgetLineIntersection(parallelRight[0], parallelRight[1], edge[0], edge[1])\n\t\t\t) {\n\t\t\t\tisVisible = false;\n\n\t\t\t\treturn false; // Exit loop early if an intersection is found\n\t\t\t}\n\t\t} else {\n\t\t\t// Check for an intersection with a single direct line\n\t\t\tif (getLineIntersection(origin, destination, edge[0], edge[1])) {\n\t\t\t\tisVisible = false;\n\n\t\t\t\treturn false; // Exit loop early if an intersection is found\n\t\t\t}\n\t\t}\n\t}\n\n\treturn isVisible;\n}\n", "import type { Position } from 'geojson';\n\n/**\n * Calculates the intersection point of two line segments defined by their endpoints.\n *\n * Modified line intercept math by Paul Bourke http://paulbourke.net/geometry/pointlineplane/\n * Determines the intersection point of two line segments.\n * Return null if the lines don't intersect.\n *\n * @param {Position} line1Point1 - First endpoint of the first line segment ([longitude, latitude]).\n * @param {Position} line1Point2 - Second endpoint of the first line segment ([longitude, latitude]).\n * @param {Position} line2Point1 - First endpoint of the second line segment ([longitude, latitude]).\n * @param {Position} line2Point2 - Second endpoint of the second line segment ([longitude, latitude]).\n * @hidden\n * @returns {Position | null} The intersection point as [longitude, latitude] if it exists on both segments, otherwise null.\n */\nexport function getLineIntersection(\n\tline1Point1: Position,\n\tline1Point2: Position,\n\tline2Point1: Position,\n\tline2Point2: Position,\n) {\n\tconst [lon1, lat1] = line1Point1;\n\tconst [lon2, lat2] = line1Point2;\n\tconst [lon3, lat3] = line2Point1;\n\tconst [lon4, lat4] = line2Point2;\n\n\t// Check if any of the lines are of zero length\n\tif ((lat1 === lat2 && lon1 === lon2) || (lat3 === lat4 && lon3 === lon4)) {\n\t\treturn null;\n\t}\n\n\t// Calculate denominator to check for parallel lines\n\tconst denominator = (lon4 - lon3) * (lat2 - lat1) - (lat4 - lat3) * (lon2 - lon1);\n\tif (denominator === 0) {\n\t\treturn null; // Lines are parallel\n\t}\n\n\t// Calculate the intersection parameters\n\tconst ua = ((lat4 - lat3) * (lon1 - lon3) - (lon4 - lon3) * (lat1 - lat3)) / denominator;\n\tconst ub = ((lat2 - lat1) * (lon1 - lon3) - (lon2 - lon1) * (lat1 - lat3)) / denominator;\n\n\t// Check if intersection is within the segments\n\tif (ua < 0 || ua > 1 || ub < 0 || ub > 1) {\n\t\treturn null;\n\t}\n\n\t// Calculate the exact intersection coordinates\n\tconst lat = lat1 + ua * (lat2 - lat1);\n\tconst lon = lon1 + ua * (lon2 - lon1);\n\n\treturn [lon, lat] as Position;\n}\n", "import destination from '@turf/destination';\nimport type { Position } from 'geojson';\n\n/**\n * Offsets a line by a specified distance perpendicular to the original line.\n * The function handles both vertical and horizontal lines specifically, and calculates the\n * offset for diagonal lines by determining the line's perpendicular slope.\n *\n * @param {Position} point1 - The starting point of the line ([longitude, latitude]).\n * @param {Position} point2 - The ending point of the line ([longitude, latitude]).\n * @param {number} offset - The distance by which to offset the line, perpendicular to its initial direction.\n * @param {number} angle - The angle of the line in radians, from -180 to 180.\n * @hidden\n * @returns {[Position, Position]} The new line endpoints after the offset.\n */\nexport function getOffsetLine(point1: Position, point2: Position, offset: number, angle: number): [Position, Position] {\n\tconst destinationPoint1 = destination(point1, offset / 1000, angle);\n\tconst destinationPoint2 = destination(point2, offset / 1000, angle);\n\n\treturn [destinationPoint1.geometry.coordinates, destinationPoint2.geometry.coordinates];\n}\n", "/**\n * Function to convert radians to degrees and adjust the range from -180 to 180.\n * @param radians - The angle in radians.\n * @returns The angle in degrees, ranging from -180 to 180.\n */\nexport function radToDegNormalized(radians: number): number {\n\tlet degrees = radians * (180 / Math.PI);\n\tdegrees = degrees % 360;\n\tif (degrees > 180) {\n\t\tdegrees -= 360;\n\t} else if (degrees < -180) {\n\t\tdegrees += 360;\n\t}\n\n\treturn Object.is(degrees, -0) ? 0 : degrees;\n}\n", "/**\n * Based on an array of flags, check if a specific flag is set.\n * @param flags - The array of flags. Each entry is a number that should be read as a bitmap.\n * @param index - The index of the entry in the flags array on which to check the bit.\n * @param bit - The bit of the flag to check.\n * @returns - True if the flag is set, false otherwise.\n */\nexport function hasFlag(flags: number[] | undefined, index: number, bit: number) {\n\tif (flags == null || flags[index] == null) {\n\t\treturn false;\n\t}\n\n\tconst mask = 1 << bit;\n\treturn (flags[index] & mask) !== 0;\n}\n", "import type { DirectionsCollection } from '@packages/internal/geojson-navigator';\nimport type { MapDataInternal } from '../../map-data-objects';\nimport {\n\tConnection,\n\tCoordinate,\n\tDoor,\n\tEnterpriseLocation,\n\tMapObject,\n\tPointOfInterest,\n\tSpace,\n\tNode,\n\tArea,\n\tFacade,\n\tAnnotation,\n\tLocationProfile,\n} from '../../map-data-objects';\nimport type { TNavigationTarget } from '../../types';\nimport type { TFindNearestOptions } from '../../query';\n\nconst findNearestOptions: TFindNearestOptions = {\n\tlineOfSight: true,\n\tmode: 'absolute-distance',\n\tmaxResults: 1,\n};\n\nfunction getOptions(enterpriseMode: boolean): TFindNearestOptions {\n\treturn {\n\t\t...findNearestOptions,\n\t\tlineOfSight: enterpriseMode ? false : true,\n\t};\n}\n\n/**\n * Cache the nodes for each feature to avoid duplicate calls to getNodesFromTarget\n */\nconst featureNodeCache = new WeakMap<TNavigationTarget, string[]>();\n\ntype TNearestCandidate = Annotation | Coordinate | PointOfInterest;\n\n/**\n * @deprecated use nearestNodeIdsAsync unless you must call this synchronously.\n * Get nearest node ids synchronously. This is only used for CMS venues via compat.\n * @param feature - The feature to get the nearest node ids for\n * @param mapData - The map data instance\n * @returns The node ids\n */\nexport function nearestNodeIdsSync(\n\tfeature: TNearestCandidate,\n\tmapData: MapDataInternal,\n\tenterpriseMode: boolean,\n): string[] {\n\tconst options = getOptions(enterpriseMode);\n\n\tconst result = mapData.Query.__LEGACY_NEAREST_SYNC(feature, mapData.getByType('node'), options);\n\tconst id = result?.[0]?.feature.id;\n\tif (id) return [id];\n\n\treturn [];\n}\n\nexport async function nearestNodeIds(\n\tfeature: TNearestCandidate,\n\tmapData: MapDataInternal,\n\tenterpriseMode: boolean,\n): Promise<string[]> {\n\tconst options = getOptions(enterpriseMode);\n\tconst result = await mapData.Query.nearest(feature, mapData.getByType('node'), options);\n\tconst id = result?.[0]?.feature.id;\n\tif (id) return [id];\n\n\treturn [];\n}\n\n/** @deprecated use locationProfileNodeIds unless you must call this synchronously. */\nexport function locationProfileNodeIdsSync(\n\ttarget: LocationProfile,\n\tmapData: MapDataInternal,\n\tenterpriseMode: boolean,\n): string[] {\n\tconst nodeIds: string[] = [];\n\tfor (const navigationTarget of target.navigationTarget) {\n\t\tconst result = getNodesFromTargetSync(navigationTarget, mapData, enterpriseMode);\n\t\tnodeIds.push(...result);\n\t}\n\treturn nodeIds;\n}\n\nexport async function locationProfileNodeIds(\n\ttarget: LocationProfile,\n\tmapData: MapDataInternal,\n\tenterpriseMode: boolean,\n): Promise<string[]> {\n\tconst nodeIds: string[] = [];\n\tfor (const navigationTarget of target.navigationTarget) {\n\t\tconst result = await getNodesFromTarget(navigationTarget, mapData, enterpriseMode);\n\t\tnodeIds.push(...result);\n\t}\n\treturn nodeIds;\n}\n\nexport function doorNodeIds(target: Door, mapData: MapDataInternal): string[] {\n\tconst mvfDoor = mapData?.getMVFFeatureById('entrance', target.id);\n\tconst nodeId = mvfDoor?.properties.node;\n\tif (nodeId) return [nodeId];\n\n\treturn [];\n}\n\nexport function areaNodeIds(target: Area, mapData: MapDataInternal): string[] {\n\tconst mvfArea = mapData?.getMVFFeatureById('area', target.id);\n\treturn mvfArea?.properties.destinationNodes ?? [];\n}\n\nexport function spaceNodeIds(target: Space, mapData: MapDataInternal): string[] {\n\tconst mvfSpace = mapData?.getMVFFeatureById('space', target.id);\n\tif (mvfSpace == null) return [];\n\n\tconst precomputedEntrances = mapData.entranceNodeIdsBySpaceId?.[target.id];\n\tif (precomputedEntrances && precomputedEntrances.length > 0) {\n\t\treturn precomputedEntrances;\n\t}\n\n\t/**\n\t * No precomputed entrances - this is probably a CMS venue without doors.\n\t * Usually these are hand drawn node graphs so destination nodes will be a small array.\n\t * If this is autopathed, this will be expensive, but not much we can do about it.\n\t */\n\treturn mvfSpace.properties.destinationNodes ?? [];\n}\n\n/**\n * @deprecated use connectionNodeIds unless you must call this synchronously.\n */\nexport function connectionNodeIdsSync(target: Connection, mapData: MapDataInternal, enterpriseMode: boolean): string[] {\n\tconst nodeIds: string[] = [];\n\tfor (const coordinate of target.coordinates) {\n\t\tconst nearest = nearestNodeIdsSync(coordinate, mapData, enterpriseMode);\n\t\tif (nearest.length > 0) nodeIds.push(nearest[0]);\n\t}\n\n\treturn nodeIds;\n}\n\nexport async function connectionNodeIds(\n\ttarget: Connection,\n\tmapData: MapDataInternal,\n\tenterpriseMode: boolean,\n): Promise<string[]> {\n\tconst nodeIds: string[] = [];\n\tfor (const coordinate of target.coordinates) {\n\t\tconst nearest = await nearestNodeIds(coordinate, mapData, enterpriseMode);\n\t\tif (nearest.length > 0) nodeIds.push(nearest[0]);\n\t}\n\n\treturn nodeIds;\n}\n\nexport function mapObjectNodeIds(target: MapObject, mapData: MapDataInternal): string[] {\n\treturn mapData?.objectEntranceNodeIdsByObstructionId[target.id] ?? [];\n}\n\nexport function facadeNodeIds(target: Facade, mapData: MapDataInternal): string[] {\n\treturn target.spaces\n\t\t.flatMap(space => mapData?.getMVFFeatureById('space', space.id)?.properties.destinationNodes ?? [])\n\t\t.filter(node => typeof node === 'string');\n}\n\nexport function enterpriseLocationNodeIds(target: EnterpriseLocation): string[] {\n\treturn target.nodes.map(node => node.id);\n}\n\n/** @deprecated use getNodesFromTarget unless you must call this synchronously. */\nexport function getNodesFromTargetSync(\n\ttarget: TNavigationTarget,\n\tmapData: MapDataInternal,\n\tenterpriseMode: boolean,\n): string[] {\n\tif (featureNodeCache.has(target)) {\n\t\treturn featureNodeCache.get(target)!;\n\t}\n\tif (LocationProfile.is(target)) {\n\t\tconst nodeIds = locationProfileNodeIdsSync(target, mapData, enterpriseMode);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (Annotation.is(target)) {\n\t\tconst nodeIds = nearestNodeIdsSync(target, mapData, enterpriseMode);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (Coordinate.is(target)) {\n\t\tconst nodeIds = nearestNodeIdsSync(target, mapData, enterpriseMode);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (PointOfInterest.is(target)) {\n\t\treturn nearestNodeIdsSync(target, mapData, enterpriseMode);\n\t} else if (Door.is(target)) {\n\t\tconst nodeIds = doorNodeIds(target, mapData);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (Area.is(target)) {\n\t\tconst nodeIds = areaNodeIds(target, mapData);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (Space.is(target)) {\n\t\tconst nodeIds = spaceNodeIds(target, mapData);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (Connection.is(target)) {\n\t\tconst nodeIds = connectionNodeIdsSync(target, mapData, enterpriseMode);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (MapObject.is(target)) {\n\t\tconst nodeIds = mapObjectNodeIds(target, mapData);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (Facade.is(target)) {\n\t\tconst nodeIds = facadeNodeIds(target, mapData);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (EnterpriseLocation.is(target)) {\n\t\tconst nodeIds = enterpriseLocationNodeIds(target);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (Node.is(target)) {\n\t\tconst nodeIds = [target.id];\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else {\n\t\treturn [];\n\t}\n}\n\n/**\n * Get the nodes from the navigation target.\n *\n * @hidden\n * @param target\n * @param mapData\n */\nexport async function getNodesFromTarget(\n\ttarget: TNavigationTarget,\n\tmapData: MapDataInternal,\n\tenterpriseMode: boolean,\n): Promise<string[]> {\n\tif (featureNodeCache.has(target)) {\n\t\treturn featureNodeCache.get(target)!;\n\t}\n\n\tif (LocationProfile.is(target)) {\n\t\tconst nodeIds = await locationProfileNodeIds(target, mapData, enterpriseMode);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (Annotation.is(target)) {\n\t\tconst nodeIds = await nearestNodeIds(target, mapData, enterpriseMode);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (Coordinate.is(target)) {\n\t\tconst nodeIds = await nearestNodeIds(target, mapData, enterpriseMode);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (PointOfInterest.is(target)) {\n\t\tconst nodeIds = await nearestNodeIds(target, mapData, enterpriseMode);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (Door.is(target)) {\n\t\tconst nodeIds = doorNodeIds(target, mapData);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (Area.is(target)) {\n\t\tconst nodeIds = areaNodeIds(target, mapData);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (Space.is(target)) {\n\t\tconst nodeIds = spaceNodeIds(target, mapData);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (Connection.is(target)) {\n\t\tconst nodeIds = await connectionNodeIds(target, mapData, enterpriseMode);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (MapObject.is(target)) {\n\t\tconst nodeIds = mapObjectNodeIds(target, mapData);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (Facade.is(target)) {\n\t\treturn facadeNodeIds(target, mapData);\n\t} else if (EnterpriseLocation.is(target)) {\n\t\tconst nodeIds = enterpriseLocationNodeIds(target);\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else if (Node.is(target)) {\n\t\tconst nodeIds = [target.id];\n\t\tfeatureNodeCache.set(target, nodeIds);\n\t\treturn nodeIds;\n\t} else {\n\t\treturn [];\n\t}\n}\n\nexport function getDepartureFromDirections(\n\tdirections: DirectionsCollection,\n\tfrom: TNavigationTarget[],\n\tfeatureToNodeIdsMap: Map<TNavigationTarget, string[]>,\n): TNavigationTarget {\n\tconst firstNodeId = directions.features[0]?.properties.id;\n\tlet departure = from[0];\n\tif (from.length > 1) {\n\t\tfor (const target of from) {\n\t\t\tconst nodeIds = featureToNodeIdsMap.get(target) ?? [];\n\t\t\tif (nodeIds.includes(firstNodeId)) {\n\t\t\t\tdeparture = target;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn departure;\n}\n\nexport function getDestinationFromDirections(\n\tdirections: DirectionsCollection,\n\tto: TNavigationTarget[],\n\tfeatureToNodeIdsMap: Map<TNavigationTarget, string[]>,\n): TNavigationTarget {\n\tconst lastNodeId = directions.features[directions.features.length - 1]?.properties.id;\n\tlet destination = to[0];\n\tif (to.length > 1) {\n\t\tfor (const target of to) {\n\t\t\tconst nodeIds = featureToNodeIdsMap.get(target) ?? [];\n\t\t\tif (nodeIds.includes(lastNodeId)) {\n\t\t\t\tdestination = target;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn destination;\n}\n", "export { Query } from './external';\nexport type { TFindNearestOptions, TFindNearestResult, TQueriables } from './external';\n", "import { Node } from '../map-data-objects';\nimport type { Coordinate, MapDataInternal, Door, PointOfInterest, Annotation, Space } from '../map-data-objects';\nimport { QueryCache } from './cache';\nimport { getCoordinateFromStuffs } from '../utils';\nimport z from 'zod';\nimport { Logger } from '@packages/internal/common';\nimport { getNodesFromTarget } from '../api-geojson/directions';\nimport { getNodesFromTargetSync } from '../api-geojson/directions/utils';\n\nconst SEARCH_RADIUS_METERS = 50;\nconst METERS_PER_DEGREE_LAT = 111319.9; // circumference of the earth at the equator in meters / 360\nconst DEFAULT_MAX_RESULTS = 1;\n\n/**\n * We're turning off auto line of sight until we resolve the following issues:\n * On platform, line of sight does not go through doors/entrances.\n * On CMS, line of sight assumes all polygons are obstructing, which should not be the case.\n */\nconst SHOULD_USE_LINE_OF_SIGHT = false;\n\nconst findNearestOptionsSchema = z.object({\n\tlimit: z.enum(['same-floor', 'same-elevation']).optional(),\n\tmode: z.enum(['travel-distance', 'absolute-distance']).optional(),\n\tlineOfSight: z.boolean().optional().or(z.literal('auto')),\n\tmaxDistance: z.number().optional(),\n\tmaxResults: z.number().optional(),\n});\n\nexport type TQueriables = PointOfInterest | Door | Annotation | Node | Space;\n\nconst defaultOptions: Required<TFindNearestOptions> = {\n\tlineOfSight: SHOULD_USE_LINE_OF_SIGHT,\n\tmode: 'travel-distance',\n\tmaxDistance: SEARCH_RADIUS_METERS,\n\tlimit: 'same-floor',\n\tmaxResults: DEFAULT_MAX_RESULTS,\n};\n\n/**\n * Query allows users to query for nodes, locations, categories, and other points of interest within the venue.\n */\nexport class Query {\n\t#mapDataInternal: MapDataInternal;\n\t#cache: QueryCache;\n\t/**\n\t * @internal\n\t */\n\tconstructor(mapDataInternal: MapDataInternal) {\n\t\tthis.#mapDataInternal = mapDataInternal;\n\t\tthis.#cache = new QueryCache(this.#mapDataInternal, this.#projectOntoCartesianPlane);\n\t}\n\n\t/**\n\t * Project a longitude/latitude onto a cartesian plane, where y is up and x is right, and the passed in center is 0,0 on the cartesian plane\n\t */\n\t#projectOntoCartesianPlane = ([lon, lat]: [number, number]): { x: number; y: number } => {\n\t\tconst [centerLon, centerLat] = [\n\t\t\tthis.#mapDataInternal.mapCenter.longitude,\n\t\t\tthis.#mapDataInternal.mapCenter.latitude,\n\t\t];\n\n\t\tconst metersPerDegreeLat = METERS_PER_DEGREE_LAT;\n\t\tconst metersPerDegreeLon = METERS_PER_DEGREE_LAT * Math.cos((lat * Math.PI) / 180);\n\n\t\tconst x = (lon - centerLon) * metersPerDegreeLon;\n\t\tconst y = (lat - centerLat) * metersPerDegreeLat;\n\n\t\treturn {\n\t\t\tx,\n\t\t\ty,\n\t\t};\n\t};\n\n\t/**\n\t * @internal\n\t */\n\t__LEGACY_NEAREST_SYNC = <T extends TQueriables>(\n\t\torigin: Coordinate | PointOfInterest | Door | Annotation | Node,\n\t\tinclude: T[],\n\t\toptions?: TFindNearestOptions,\n\t) => {\n\t\tconst parsedOptions: Required<TFindNearestOptions> = { ...defaultOptions, ...options };\n\t\ttry {\n\t\t\tfindNearestOptionsSchema.parse(parsedOptions);\n\t\t} catch (error: unknown) {\n\t\t\tLogger.error(error);\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst coordinate = getCoordinateFromStuffs(origin);\n\t\tif (!coordinate) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// default to querying the floor the origin is on\n\t\tlet floorIds = this.#getFloorIds(coordinate, parsedOptions);\n\n\t\tlet results: TFindNearestResult<T> = [];\n\n\t\tconst nodeToFeatureMap: Record<string, TQueriables[]> = {};\n\n\t\tconst includedNodeIds: string[] = [];\n\t\t// iterate through the targets, and get their nodes as searches can only be performed via nodes\n\t\tfor (const feature of include) {\n\t\t\tconst targetNodeIds = getNodesFromTargetSync(\n\t\t\t\tfeature,\n\t\t\t\tthis.#mapDataInternal,\n\t\t\t\tthis.#mapDataInternal.enterpriseMode,\n\t\t\t);\n\t\t\tif (targetNodeIds) {\n\t\t\t\tfor (const targetNodeId of targetNodeIds) {\n\t\t\t\t\tif (!nodeToFeatureMap[targetNodeId]) {\n\t\t\t\t\t\tnodeToFeatureMap[targetNodeId] = [];\n\t\t\t\t\t}\n\t\t\t\t\tnodeToFeatureMap[targetNodeId].push(feature);\n\t\t\t\t\tincludedNodeIds.push(targetNodeId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (options?.mode === 'absolute-distance') {\n\t\t\tresults = this.#getAbsoluteDistance(coordinate, floorIds, include, parsedOptions);\n\t\t} else {\n\t\t\tresults = this.#getTravelDistanceSync(origin, floorIds, includedNodeIds, nodeToFeatureMap, parsedOptions);\n\t\t}\n\n\t\treturn results.sort((a, b) => a.distance - b.distance);\n\t};\n\n\t/**\n\t * Find the nearest feature to the origin\n\t * @param origin - The origin object\n\t * @param include - The features to include in the query\n\t * @param options - The options for the query\n\t * @returns Objects with the distance and the feature, sorted by distance\n\t */\n\tasync nearest<T extends TQueriables>(\n\t\torigin: Coordinate | PointOfInterest | Door | Annotation | Node,\n\t\tinclude: T[],\n\t\toptions?: TFindNearestOptions,\n\t): Promise<TFindNearestResult<T> | undefined> {\n\t\tconst parsedOptions: Required<TFindNearestOptions> = { ...defaultOptions, ...options };\n\n\t\ttry {\n\t\t\tfindNearestOptionsSchema.parse(parsedOptions);\n\t\t} catch (error: unknown) {\n\t\t\tLogger.error(error);\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst coordinate = getCoordinateFromStuffs(origin);\n\t\tif (!coordinate) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// default to querying the floor the origin is on\n\t\tlet floorIds = this.#getFloorIds(coordinate, parsedOptions);\n\n\t\tlet results: TFindNearestResult<T> = [];\n\n\t\tconst nodeToFeatureMap: Record<string, TQueriables[]> = {};\n\n\t\tconst includedNodeIds: string[] = [];\n\t\tconst promises: Promise<void>[] = [];\n\n\t\tif (options?.mode === 'absolute-distance') {\n\t\t\tresults = this.#getAbsoluteDistance(coordinate, floorIds, include, parsedOptions);\n\t\t} else {\n\t\t\t// iterate through the targets, and get their nodes as searches can only be performed via nodes\n\t\t\tfor (const feature of include) {\n\t\t\t\tpromises.push(\n\t\t\t\t\tgetNodesFromTarget(feature, this.#mapDataInternal, this.#mapDataInternal.enterpriseMode).then(\n\t\t\t\t\t\ttargetNodeIds => {\n\t\t\t\t\t\t\tif (targetNodeIds) {\n\t\t\t\t\t\t\t\tfor (const targetNodeId of targetNodeIds) {\n\t\t\t\t\t\t\t\t\tif (!nodeToFeatureMap[targetNodeId]) {\n\t\t\t\t\t\t\t\t\t\tnodeToFeatureMap[targetNodeId] = [];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tnodeToFeatureMap[targetNodeId].push(feature);\n\t\t\t\t\t\t\t\t\tincludedNodeIds.push(targetNodeId);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\t\t\tawait Promise.all(promises);\n\n\t\t\tresults = await this.#getTravelDistance(origin, floorIds, includedNodeIds, nodeToFeatureMap, parsedOptions);\n\t\t}\n\n\t\treturn results.sort((a, b) => a.distance - b.distance);\n\t}\n\n\t#getFloorIds(coordinate: Coordinate, options?: Required<TFindNearestOptions>) {\n\t\t// default to querying the floor the origin is on\n\t\tlet floorIds = coordinate.floorId ? [coordinate.floorId] : [];\n\n\t\tif (coordinate.floorId == null) {\n\t\t\t// If no floorId provided, we query all default floors on all floors-stacks (likely using GPS? coordinates)\n\t\t\tfor (const fs of this.#mapDataInternal.getByType('floor-stack')) {\n\t\t\t\tconst floor = fs.defaultFloor;\n\t\t\t\tif (floor) {\n\t\t\t\t\tfloorIds.push(floor.id);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (options?.limit === 'same-elevation') {\n\t\t\t// If limit is same-elevation, we query all floors in all floors-stacks at the same elevation as the origin (useful for multi-building venues)\n\t\t\tconst floor = this.#mapDataInternal.floorsById[coordinate.floorId];\n\t\t\tif (floor) {\n\t\t\t\tconst elevation = floor?.elevation;\n\t\t\t\tif (elevation) {\n\t\t\t\t\tfloorIds = this.#mapDataInternal\n\t\t\t\t\t\t.getByType('floor-stack')\n\t\t\t\t\t\t.map(fs => fs.floors.find(f => f.elevation === elevation)?.id)\n\t\t\t\t\t\t.filter(Boolean) as string[];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn floorIds;\n\t}\n\n\t#getAbsoluteDistance = <T extends TQueriables>(\n\t\tcoordinate: Coordinate,\n\t\tfloorIds: string[],\n\t\tincludedFeatures: TQueriables[],\n\t\toptions?: Required<TFindNearestOptions>,\n\t) => {\n\t\tconst results: TFindNearestResult<T> = [];\n\n\t\tconst types = new Set(includedFeatures.map(f => f.__type));\n\n\t\tfor (const floorId of floorIds) {\n\t\t\tfor (const type of types) {\n\t\t\t\tconst nearestResults = this.#cache.searchWithIncludedIds(\n\t\t\t\t\t[coordinate.longitude, coordinate.latitude],\n\t\t\t\t\ttype,\n\t\t\t\t\tthis.#mapDataInternal.mapName,\n\t\t\t\t\tfloorId,\n\t\t\t\t\tincludedFeatures.filter(f => f.__type === type).map(f => f.id),\n\t\t\t\t\toptions?.maxDistance ?? SEARCH_RADIUS_METERS,\n\t\t\t\t\toptions?.lineOfSight === 'auto' ? SHOULD_USE_LINE_OF_SIGHT : options?.lineOfSight,\n\t\t\t\t\toptions?.maxResults ?? 1,\n\t\t\t\t);\n\n\t\t\t\tif (nearestResults) {\n\t\t\t\t\tfor (const result of nearestResults) {\n\t\t\t\t\t\tresults.push({\n\t\t\t\t\t\t\tdistance: result.distance,\n\t\t\t\t\t\t\tfeature: (this.#mapDataInternal.getById(type, result.node.properties.parentId) ||\n\t\t\t\t\t\t\t\tthis.#mapDataInternal.getById(type, result.node.properties.id)) as T,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn results;\n\t};\n\n\t#getTravelDistance = async <T extends TQueriables>(\n\t\torigin: Coordinate | PointOfInterest | Door | Annotation | Node,\n\t\tfloorIds: string[],\n\t\tincludedNodeIds: string[],\n\t\tnodeToFeatureMap: Record<string, TQueriables[]>,\n\t\toptions?: TFindNearestOptions,\n\t) => {\n\t\tconst results: TFindNearestResult<T> = [];\n\n\t\tfor (const floorId of floorIds) {\n\t\t\t// find nearest node if origin isn't one\n\t\t\tlet node: Node | undefined;\n\t\t\tlet distanceToNode = 0;\n\t\t\tif (!Node.is(origin)) {\n\t\t\t\tconst results = this.#getAbsoluteDistance(\n\t\t\t\t\torigin.anchorTarget,\n\t\t\t\t\t[floorId],\n\t\t\t\t\tthis.#mapDataInternal.getByType('node').filter(n => n.floor.id === floorId),\n\t\t\t\t\t{\n\t\t\t\t\t\tlimit: 'same-floor',\n\t\t\t\t\t\tlineOfSight: options?.lineOfSight ?? true,\n\t\t\t\t\t\tmode: 'absolute-distance',\n\t\t\t\t\t\tmaxDistance: options?.maxDistance ?? SEARCH_RADIUS_METERS,\n\t\t\t\t\t\tmaxResults: 1, // hardcode for the first search, since we need one node to do the rest of travel\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tif (results.length > 0) {\n\t\t\t\t\tnode = results[0].feature as Node;\n\t\t\t\t\tdistanceToNode = results[0].distance;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (node) {\n\t\t\t\t// we only want unique features, as a space may have multiple nodes that get sorted by distance, but we only want to return\n\t\t\t\t// the closest to the single space\n\t\t\t\tconst uniqueFeatureIds = new Set();\n\t\t\t\tconst searchResults = this.#mapDataInternal.directions.navigator.findNearestNodesOnGraph(\n\t\t\t\t\tnode.id,\n\t\t\t\t\t(options?.maxDistance ?? SEARCH_RADIUS_METERS) - distanceToNode,\n\t\t\t\t\tfloorId,\n\t\t\t\t\tincludedNodeIds,\n\t\t\t\t\tfalse,\n\t\t\t\t\toptions?.maxResults ?? DEFAULT_MAX_RESULTS,\n\t\t\t\t);\n\n\t\t\t\tfor (const result of searchResults) {\n\t\t\t\t\tfor (const feature of nodeToFeatureMap[result.feature.properties.id]) {\n\t\t\t\t\t\tif (uniqueFeatureIds.has(feature.id)) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresults.push({\n\t\t\t\t\t\t\tdistance: result.distance + distanceToNode,\n\t\t\t\t\t\t\tfeature: feature as T,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tuniqueFeatureIds.add(feature.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn results;\n\t};\n\n\t#getTravelDistanceSync = <T extends TQueriables>(\n\t\torigin: Coordinate | PointOfInterest | Door | Annotation | Node,\n\t\tfloorIds: string[],\n\t\tincludedNodeIds: string[],\n\t\tnodeToFeatureMap: Record<string, TQueriables[]>,\n\t\toptions?: TFindNearestOptions,\n\t) => {\n\t\tconst results: TFindNearestResult<T> = [];\n\n\t\tfor (const floorId of floorIds) {\n\t\t\t// find nearest node if origin isn't one\n\t\t\tlet node: Node | undefined;\n\t\t\tif (!Node.is(origin)) {\n\t\t\t\tnode = this.__LEGACY_NEAREST_SYNC(origin, this.#mapDataInternal.getByType('node'), {\n\t\t\t\t\tlineOfSight: options?.lineOfSight ?? true,\n\t\t\t\t\tmode: 'absolute-distance',\n\t\t\t\t\tmaxDistance: options?.maxDistance ?? SEARCH_RADIUS_METERS,\n\t\t\t\t\tmaxResults: 1, // hardcode for the first search, since we need one node to do the rest of travel\n\t\t\t\t})?.[0].feature;\n\t\t\t}\n\t\t\tif (node) {\n\t\t\t\tconst searchResults = this.#mapDataInternal.directions.navigator.findNearestNodesOnGraph(\n\t\t\t\t\tnode.id,\n\t\t\t\t\toptions?.maxDistance ?? SEARCH_RADIUS_METERS,\n\t\t\t\t\tfloorId,\n\t\t\t\t\tincludedNodeIds,\n\t\t\t\t\toptions?.lineOfSight === 'auto' ? SHOULD_USE_LINE_OF_SIGHT : options?.lineOfSight,\n\t\t\t\t\toptions?.maxResults ?? DEFAULT_MAX_RESULTS,\n\t\t\t\t);\n\n\t\t\t\tfor (const result of searchResults) {\n\t\t\t\t\tfor (const feature of nodeToFeatureMap[result.feature.properties.id]) {\n\t\t\t\t\t\tresults.push({\n\t\t\t\t\t\t\tdistance: result.distance,\n\t\t\t\t\t\t\tfeature: feature as T,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn results;\n\t};\n}\n\nexport type TFindNearestResult<T extends TQueriables> = {\n\tdistance: number;\n\tfeature: T;\n}[];\n\nexport type TFindNearestOptions = {\n\t/**\n\t * Limit query to a set of floors. Only applies if the origin has floor information. If it doesn't, it limits the query to all floor-stacks' default floors.\n\t *\n\t * @default 'same-floor'\n\t */\n\tlimit?: /**\n\t * Limit query to current floor of origin\n\t */\n\t| 'same-floor'\n\t\t/**\n\t\t * Limit query to all floors at the same elevation as the origin\n\t\t */\n\t\t| 'same-elevation';\n\t/**\n\t * Whether to use line of sight checks to filter results. This ensures that results aren't obstructed by walls, etc.\n\t * When 'auto', heuristics are used to determine whether to use line of sight checks. These are currently experimental, and are subject to change.\n\t * @experimental\n\t * @default 'auto'\n\t */\n\tlineOfSight?: boolean | 'auto';\n\t/**\n\t * The mode to use for the query\n\t */\n\tmode?: 'travel-distance' | 'absolute-distance';\n\t/**\n\t * The max distance to search for features within\n\t */\n\tmaxDistance?: number;\n\n\t/**\n\t * The maximum number of results to return, the lower the number, the faster the query will be\n\t * @default 1\n\t */\n\tmaxResults?: number;\n};\n", "import { type NodeFeature } from '@packages/internal/geojson-navigator/src/types/node';\nimport { quadtree, type Quadtree } from 'd3-quadtree';\nimport type { MapDataInternal } from '../map-data-objects';\nimport { type CoordinateFeature } from '@packages/internal/geojson-navigator/src/types/coordinate';\nimport { type SpaceFeature } from '@packages/internal/geojson-navigator/src/types/space';\nimport { type TQueriables } from './external';\nimport { equirectangularDistance } from '@packages/internal/common/utils';\nimport { traverseQuadTree } from './utils';\n\nconst MAX_SEARCH_RADIUS_METERS = 1000;\nconst LINE_OF_SIGHT_BUFFER_RADIUS = 0.1;\nconst INITIAL_SEARCH_RADIUS_METERS = 5;\nconst RADIUS_EXPANSION_FACTOR = 1.5;\n\ntype SearchTrees<T extends NodeFeature | SpaceFeature | CoordinateFeature> = {\n\t[mapId: string]: {\n\t\t// TODO: think about how the outdoor map works\n\t\t// for example if a coordinate is on the base map\n\t\t// it should go lookup nodes on every map with the same elevation\n\t\t[floorId: number]: Quadtree<T>;\n\t};\n};\n\nexport class QueryCache {\n\t#queryTrees: {\n\t\t[type in TQueriables['__type']]?: SearchTrees<NodeFeature>;\n\t} = {};\n\n\t#maxSquareCache = new Map<string, Map<string, number>>();\n\n\t/**\n\t * Get the maximum search radius for a given type and floorId, this is typically the extent of the tree for the given type and floorId\n\t * @param type - The type of feature to search for\n\t * @param floorId - The floor to search on\n\t * @returns The maximum search radius in meters\n\t */\n\tgetMaxSearchRadiusForFloorId = (type: TQueriables['__type'], floorId: string) => {\n\t\tlet maxSquareSize = this.#maxSquareCache.get(this.#mapDataInternal.mapName)?.get(floorId);\n\t\tif (maxSquareSize) {\n\t\t\treturn maxSquareSize;\n\t\t}\n\n\t\tconst tree = this.getNodeTreeByTypeAndFloorId(type, this.#mapDataInternal.mapName, floorId);\n\t\tif (typeof tree.extent === 'function') {\n\t\t\tif (tree.extent()) {\n\t\t\t\tconst [[x0, y0], [x1, y1]] = tree.extent()!;\n\t\t\t\tconst width = x1 - x0;\n\t\t\t\tconst height = y1 - y0;\n\t\t\t\tmaxSquareSize = Math.max(width, height);\n\t\t\t} else {\n\t\t\t\tmaxSquareSize = MAX_SEARCH_RADIUS_METERS;\n\t\t\t}\n\t\t} else {\n\t\t\tmaxSquareSize = MAX_SEARCH_RADIUS_METERS;\n\t\t}\n\t\tthis.#maxSquareCache.set(this.#mapDataInternal.mapName, new Map([[floorId, maxSquareSize]]));\n\t\treturn maxSquareSize;\n\t};\n\n\t/**\n\t * Search for features within a radius of a coordinate using incremental radius expansion.\n\t * Uses geometric expansion to search in concentric circles, processing candidates by distance.\n\t * @param point - The coordinate to search around\n\t * @param type - The type of feature to search for\n\t * @param mapName - The name of the map to search on\n\t * @param floorId - The floor to search on\n\t * @param includedIds - The ids of the features to include in the search\n\t * @param maxDistance - The maximum distance to search for features within\n\t * @param lineOfSight - Whether to use line of sight checks to filter results\n\t * @param limit - The limit of the number of features to return, so an early return is possible\n\t * @returns An array of features sorted by distance from the coordinate\n\t */\n\tsearchWithIncludedIds(\n\t\tpoint: [number, number],\n\t\ttype: TQueriables['__type'],\n\t\tmapName: string,\n\t\tfloorId: string,\n\t\tincludedIds: string[],\n\t\tmaxDistance: number,\n\t\tlineOfSight = false,\n\t\tlimit = Infinity,\n\t): {\n\t\tnode: NodeFeature;\n\t\tdistance: number;\n\t}[] {\n\t\tconst tree = this.getNodeTreeByTypeAndFloorId(type, mapName, floorId);\n\t\tconst processedNodeIds = new Set<string>();\n\t\tconst results: { node: NodeFeature; distance: number }[] = [];\n\n\t\tlet currentRadius = INITIAL_SEARCH_RADIUS_METERS;\n\t\tconst effectiveMaxDistance = Math.max(maxDistance, this.getMaxSearchRadiusForFloorId(type, floorId));\n\n\t\t// Expand radius geometrically until we have enough results or reach max distance\n\t\twhile (results.length < limit && currentRadius <= effectiveMaxDistance) {\n\t\t\t// Find new candidates in the current radius that haven't been processed\n\t\t\tconst candidates = this.#findCandidatesInRadius(\n\t\t\t\tpoint,\n\t\t\t\ttree,\n\t\t\t\tincludedIds,\n\t\t\t\tcurrentRadius,\n\t\t\t\tmaxDistance,\n\t\t\t\tprocessedNodeIds,\n\t\t\t);\n\n\t\t\t// Sort candidates by distance (closest first)\n\t\t\tcandidates.sort((a, b) => a.distance - b.distance);\n\n\t\t\t// Process candidates in distance order, checking line-of-sight\n\t\t\tfor (const candidate of candidates) {\n\t\t\t\tif (results.length >= limit) break;\n\n\t\t\t\tif (lineOfSight) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.#mapDataInternal.directions.navigator.hasLineOfSight(\n\t\t\t\t\t\t\tpoint,\n\t\t\t\t\t\t\tcandidate.node.geometry.coordinates as [number, number],\n\t\t\t\t\t\t\tfloorId,\n\t\t\t\t\t\t\tLINE_OF_SIGHT_BUFFER_RADIUS,\n\t\t\t\t\t\t)\n\t\t\t\t\t) {\n\t\t\t\t\t\tresults.push(candidate);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tresults.push(candidate);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Expand radius geometrically for next iteration\n\t\t\tcurrentRadius = currentRadius * RADIUS_EXPANSION_FACTOR;\n\t\t}\n\n\t\t// Results are already sorted by distance due to processing order\n\t\treturn results;\n\t}\n\n\t/**\n\t * Find candidate nodes within the specified radius that haven't been processed yet\n\t * @private\n\t */\n\t#findCandidatesInRadius(\n\t\tpoint: [number, number],\n\t\ttree: Quadtree<NodeFeature>,\n\t\tincludedIds: string[],\n\t\tradius: number,\n\t\tmaxDistance: number,\n\t\tprocessedNodeIds: Set<string>,\n\t): { node: NodeFeature; distance: number }[] {\n\t\tconst { x, y } = this.#projectOntoCartesianPlane(point);\n\t\tconst xmin = x - radius;\n\t\tconst xmax = x + radius;\n\t\tconst ymin = y - radius;\n\t\tconst ymax = y + radius;\n\n\t\tconst candidates: { node: NodeFeature; distance: number }[] = [];\n\n\t\ttraverseQuadTree(tree, (node, x1, y1, x2, y2) => {\n\t\t\tconst quadIsOutsideRadius = x1 >= xmax || y1 >= ymax || x2 < xmin || y2 < ymin;\n\n\t\t\tif ('data' in node) {\n\t\t\t\tconst d = node.data;\n\t\t\t\tconst id = d.properties.parentId || d.properties.id;\n\t\t\t\t// Check if this node should be included and hasn't been processed\n\t\t\t\tif (includedIds.includes(id) && !processedNodeIds.has(id)) {\n\t\t\t\t\tprocessedNodeIds.add(id);\n\t\t\t\t\tconst distance = equirectangularDistance(point, d.geometry.coordinates as [number, number]);\n\t\t\t\t\t// Check if the distance condition is met\n\t\t\t\t\tif (distance <= maxDistance) {\n\t\t\t\t\t\tcandidates.push({\n\t\t\t\t\t\t\tnode: d,\n\t\t\t\t\t\t\tdistance,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Skip quadrant if outside radius bounds\n\t\t\treturn quadIsOutsideRadius;\n\t\t});\n\n\t\treturn candidates;\n\t}\n\n\t#mapDataInternal: MapDataInternal;\n\tgetNodeTreeByTypeAndFloorId(type: TQueriables['__type'], mapName: string, floorId: string): Quadtree<NodeFeature> {\n\t\tif (!this.#queryTrees[type]) {\n\t\t\tthis.#queryTrees[type] = {};\n\t\t}\n\n\t\tif (this.#queryTrees[type][mapName]?.[floorId]) {\n\t\t\treturn this.#queryTrees[type][mapName][floorId];\n\t\t}\n\n\t\tif (!this.#queryTrees[type][mapName]) {\n\t\t\tthis.#queryTrees[type][mapName] = {};\n\t\t}\n\n\t\t// Overwrite the tree with a new one\n\t\tthis.#queryTrees[type][mapName][floorId] = quadtree();\n\t\tlet tree: Quadtree<NodeFeature> = this.#queryTrees[type][mapName][floorId];\n\t\ttree.x(node => this.#projectOntoCartesianPlane(node.geometry.coordinates as [number, number]).x);\n\t\ttree.y(node => this.#projectOntoCartesianPlane(node.geometry.coordinates as [number, number]).y);\n\t\tlet targetsOnFloor: any[] = [];\n\n\t\tswitch (type) {\n\t\t\tcase 'space':\n\t\t\t\tconst destinationNodeIds = this.#mapDataInternal.mvfSpacesByFloorId[floorId].flatMap(\n\t\t\t\t\tspace => space.properties.destinationNodes,\n\t\t\t\t);\n\t\t\t\ttargetsOnFloor = destinationNodeIds.map(id => {\n\t\t\t\t\tconst node = this.#mapDataInternal.mvfNodesById[id];\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...node,\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tid: node.properties.id,\n\t\t\t\t\t\t\t\tparentId: node.properties.space[0],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'node':\n\t\t\t\ttargetsOnFloor =\n\t\t\t\t\tthis.#mapDataInternal.mvfNodesByFloorId[floorId]?.filter(node => node.properties.neighbors.length > 0) || [];\n\t\t\t\tbreak;\n\t\t\tcase 'point-of-interest':\n\t\t\t\ttargetsOnFloor = this.#mapDataInternal.mvfPoisByFloorId[floorId] || [];\n\t\t\t\tbreak;\n\t\t\tcase 'door':\n\t\t\t\ttargetsOnFloor = this.#mapDataInternal.mvfEntrancesByFloorId[floorId] || [];\n\t\t\t\tbreak;\n\t\t\tcase 'annotation':\n\t\t\t\ttargetsOnFloor = this.#mapDataInternal.mvfAnnotationsByFloorId[floorId] || [];\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (targetsOnFloor?.length > 0) {\n\t\t\ttree.addAll(targetsOnFloor);\n\t\t}\n\n\t\treturn tree;\n\t}\n\n\t#projectOntoCartesianPlane: (point: [number, number]) => { x: number; y: number };\n\n\tconstructor(\n\t\tmapDataInternal: MapDataInternal,\n\t\tprojectOntoCartesianPlane: (point: [number, number]) => { x: number; y: number },\n\t) {\n\t\tthis.#mapDataInternal = mapDataInternal;\n\t\tthis.#projectOntoCartesianPlane = projectOntoCartesianPlane;\n\t}\n}\n", "export {default as quadtree} from \"./quadtree.js\";\n", "import tree_add, {addAll as tree_addAll} from \"./add.js\";\nimport tree_cover from \"./cover.js\";\nimport tree_data from \"./data.js\";\nimport tree_extent from \"./extent.js\";\nimport tree_find from \"./find.js\";\nimport tree_remove, {removeAll as tree_removeAll} from \"./remove.js\";\nimport tree_root from \"./root.js\";\nimport tree_size from \"./size.js\";\nimport tree_visit from \"./visit.js\";\nimport tree_visitAfter from \"./visitAfter.js\";\nimport tree_x, {defaultX} from \"./x.js\";\nimport tree_y, {defaultY} from \"./y.js\";\n\nexport default function quadtree(nodes, x, y) {\n  var tree = new Quadtree(x == null ? defaultX : x, y == null ? defaultY : y, NaN, NaN, NaN, NaN);\n  return nodes == null ? tree : tree.addAll(nodes);\n}\n\nfunction Quadtree(x, y, x0, y0, x1, y1) {\n  this._x = x;\n  this._y = y;\n  this._x0 = x0;\n  this._y0 = y0;\n  this._x1 = x1;\n  this._y1 = y1;\n  this._root = undefined;\n}\n\nfunction leaf_copy(leaf) {\n  var copy = {data: leaf.data}, next = copy;\n  while (leaf = leaf.next) next = next.next = {data: leaf.data};\n  return copy;\n}\n\nvar treeProto = quadtree.prototype = Quadtree.prototype;\n\ntreeProto.copy = function() {\n  var copy = new Quadtree(this._x, this._y, this._x0, this._y0, this._x1, this._y1),\n      node = this._root,\n      nodes,\n      child;\n\n  if (!node) return copy;\n\n  if (!node.length) return copy._root = leaf_copy(node), copy;\n\n  nodes = [{source: node, target: copy._root = new Array(4)}];\n  while (node = nodes.pop()) {\n    for (var i = 0; i < 4; ++i) {\n      if (child = node.source[i]) {\n        if (child.length) nodes.push({source: child, target: node.target[i] = new Array(4)});\n        else node.target[i] = leaf_copy(child);\n      }\n    }\n  }\n\n  return copy;\n};\n\ntreeProto.add = tree_add;\ntreeProto.addAll = tree_addAll;\ntreeProto.cover = tree_cover;\ntreeProto.data = tree_data;\ntreeProto.extent = tree_extent;\ntreeProto.find = tree_find;\ntreeProto.remove = tree_remove;\ntreeProto.removeAll = tree_removeAll;\ntreeProto.root = tree_root;\ntreeProto.size = tree_size;\ntreeProto.visit = tree_visit;\ntreeProto.visitAfter = tree_visitAfter;\ntreeProto.x = tree_x;\ntreeProto.y = tree_y;\n", "export default function(d) {\n  const x = +this._x.call(null, d),\n      y = +this._y.call(null, d);\n  return add(this.cover(x, y), x, y, d);\n}\n\nfunction add(tree, x, y, d) {\n  if (isNaN(x) || isNaN(y)) return tree; // ignore invalid points\n\n  var parent,\n      node = tree._root,\n      leaf = {data: d},\n      x0 = tree._x0,\n      y0 = tree._y0,\n      x1 = tree._x1,\n      y1 = tree._y1,\n      xm,\n      ym,\n      xp,\n      yp,\n      right,\n      bottom,\n      i,\n      j;\n\n  // If the tree is empty, initialize the root as a leaf.\n  if (!node) return tree._root = leaf, tree;\n\n  // Find the existing leaf for the new point, or add it.\n  while (node.length) {\n    if (right = x >= (xm = (x0 + x1) / 2)) x0 = xm; else x1 = xm;\n    if (bottom = y >= (ym = (y0 + y1) / 2)) y0 = ym; else y1 = ym;\n    if (parent = node, !(node = node[i = bottom << 1 | right])) return parent[i] = leaf, tree;\n  }\n\n  // Is the new point is exactly coincident with the existing point?\n  xp = +tree._x.call(null, node.data);\n  yp = +tree._y.call(null, node.data);\n  if (x === xp && y === yp) return leaf.next = node, parent ? parent[i] = leaf : tree._root = leaf, tree;\n\n  // Otherwise, split the leaf node until the old and new point are separated.\n  do {\n    parent = parent ? parent[i] = new Array(4) : tree._root = new Array(4);\n    if (right = x >= (xm = (x0 + x1) / 2)) x0 = xm; else x1 = xm;\n    if (bottom = y >= (ym = (y0 + y1) / 2)) y0 = ym; else y1 = ym;\n  } while ((i = bottom << 1 | right) === (j = (yp >= ym) << 1 | (xp >= xm)));\n  return parent[j] = node, parent[i] = leaf, tree;\n}\n\nexport function addAll(data) {\n  var d, i, n = data.length,\n      x,\n      y,\n      xz = new Array(n),\n      yz = new Array(n),\n      x0 = Infinity,\n      y0 = Infinity,\n      x1 = -Infinity,\n      y1 = -Infinity;\n\n  // Compute the points and their extent.\n  for (i = 0; i < n; ++i) {\n    if (isNaN(x = +this._x.call(null, d = data[i])) || isNaN(y = +this._y.call(null, d))) continue;\n    xz[i] = x;\n    yz[i] = y;\n    if (x < x0) x0 = x;\n    if (x > x1) x1 = x;\n    if (y < y0) y0 = y;\n    if (y > y1) y1 = y;\n  }\n\n  // If there were no (valid) points, abort.\n  if (x0 > x1 || y0 > y1) return this;\n\n  // Expand the tree to cover the new points.\n  this.cover(x0, y0).cover(x1, y1);\n\n  // Add the new points.\n  for (i = 0; i < n; ++i) {\n    add(this, xz[i], yz[i], data[i]);\n  }\n\n  return this;\n}\n", "export default function(x, y) {\n  if (isNaN(x = +x) || isNaN(y = +y)) return this; // ignore invalid points\n\n  var x0 = this._x0,\n      y0 = this._y0,\n      x1 = this._x1,\n      y1 = this._y1;\n\n  // If the quadtree has no extent, initialize them.\n  // Integer extent are necessary so that if we later double the extent,\n  // the existing quadrant boundaries don\u2019t change due to floating point error!\n  if (isNaN(x0)) {\n    x1 = (x0 = Math.floor(x)) + 1;\n    y1 = (y0 = Math.floor(y)) + 1;\n  }\n\n  // Otherwise, double repeatedly to cover.\n  else {\n    var z = x1 - x0 || 1,\n        node = this._root,\n        parent,\n        i;\n\n    while (x0 > x || x >= x1 || y0 > y || y >= y1) {\n      i = (y < y0) << 1 | (x < x0);\n      parent = new Array(4), parent[i] = node, node = parent, z *= 2;\n      switch (i) {\n        case 0: x1 = x0 + z, y1 = y0 + z; break;\n        case 1: x0 = x1 - z, y1 = y0 + z; break;\n        case 2: x1 = x0 + z, y0 = y1 - z; break;\n        case 3: x0 = x1 - z, y0 = y1 - z; break;\n      }\n    }\n\n    if (this._root && this._root.length) this._root = node;\n  }\n\n  this._x0 = x0;\n  this._y0 = y0;\n  this._x1 = x1;\n  this._y1 = y1;\n  return this;\n}\n", "export default function() {\n  var data = [];\n  this.visit(function(node) {\n    if (!node.length) do data.push(node.data); while (node = node.next)\n  });\n  return data;\n}\n", "export default function(_) {\n  return arguments.length\n      ? this.cover(+_[0][0], +_[0][1]).cover(+_[1][0], +_[1][1])\n      : isNaN(this._x0) ? undefined : [[this._x0, this._y0], [this._x1, this._y1]];\n}\n", "import Quad from \"./quad.js\";\n\nexport default function(x, y, radius) {\n  var data,\n      x0 = this._x0,\n      y0 = this._y0,\n      x1,\n      y1,\n      x2,\n      y2,\n      x3 = this._x1,\n      y3 = this._y1,\n      quads = [],\n      node = this._root,\n      q,\n      i;\n\n  if (node) quads.push(new Quad(node, x0, y0, x3, y3));\n  if (radius == null) radius = Infinity;\n  else {\n    x0 = x - radius, y0 = y - radius;\n    x3 = x + radius, y3 = y + radius;\n    radius *= radius;\n  }\n\n  while (q = quads.pop()) {\n\n    // Stop searching if this quadrant can\u2019t contain a closer node.\n    if (!(node = q.node)\n        || (x1 = q.x0) > x3\n        || (y1 = q.y0) > y3\n        || (x2 = q.x1) < x0\n        || (y2 = q.y1) < y0) continue;\n\n    // Bisect the current quadrant.\n    if (node.length) {\n      var xm = (x1 + x2) / 2,\n          ym = (y1 + y2) / 2;\n\n      quads.push(\n        new Quad(node[3], xm, ym, x2, y2),\n        new Quad(node[2], x1, ym, xm, y2),\n        new Quad(node[1], xm, y1, x2, ym),\n        new Quad(node[0], x1, y1, xm, ym)\n      );\n\n      // Visit the closest quadrant first.\n      if (i = (y >= ym) << 1 | (x >= xm)) {\n        q = quads[quads.length - 1];\n        quads[quads.length - 1] = quads[quads.length - 1 - i];\n        quads[quads.length - 1 - i] = q;\n      }\n    }\n\n    // Visit this point. (Visiting coincident points isn\u2019t necessary!)\n    else {\n      var dx = x - +this._x.call(null, node.data),\n          dy = y - +this._y.call(null, node.data),\n          d2 = dx * dx + dy * dy;\n      if (d2 < radius) {\n        var d = Math.sqrt(radius = d2);\n        x0 = x - d, y0 = y - d;\n        x3 = x + d, y3 = y + d;\n        data = node.data;\n      }\n    }\n  }\n\n  return data;\n}\n", "export default function(node, x0, y0, x1, y1) {\n  this.node = node;\n  this.x0 = x0;\n  this.y0 = y0;\n  this.x1 = x1;\n  this.y1 = y1;\n}\n", "export default function(d) {\n  if (isNaN(x = +this._x.call(null, d)) || isNaN(y = +this._y.call(null, d))) return this; // ignore invalid points\n\n  var parent,\n      node = this._root,\n      retainer,\n      previous,\n      next,\n      x0 = this._x0,\n      y0 = this._y0,\n      x1 = this._x1,\n      y1 = this._y1,\n      x,\n      y,\n      xm,\n      ym,\n      right,\n      bottom,\n      i,\n      j;\n\n  // If the tree is empty, initialize the root as a leaf.\n  if (!node) return this;\n\n  // Find the leaf node for the point.\n  // While descending, also retain the deepest parent with a non-removed sibling.\n  if (node.length) while (true) {\n    if (right = x >= (xm = (x0 + x1) / 2)) x0 = xm; else x1 = xm;\n    if (bottom = y >= (ym = (y0 + y1) / 2)) y0 = ym; else y1 = ym;\n    if (!(parent = node, node = node[i = bottom << 1 | right])) return this;\n    if (!node.length) break;\n    if (parent[(i + 1) & 3] || parent[(i + 2) & 3] || parent[(i + 3) & 3]) retainer = parent, j = i;\n  }\n\n  // Find the point to remove.\n  while (node.data !== d) if (!(previous = node, node = node.next)) return this;\n  if (next = node.next) delete node.next;\n\n  // If there are multiple coincident points, remove just the point.\n  if (previous) return (next ? previous.next = next : delete previous.next), this;\n\n  // If this is the root point, remove it.\n  if (!parent) return this._root = next, this;\n\n  // Remove this leaf.\n  next ? parent[i] = next : delete parent[i];\n\n  // If the parent now contains exactly one leaf, collapse superfluous parents.\n  if ((node = parent[0] || parent[1] || parent[2] || parent[3])\n      && node === (parent[3] || parent[2] || parent[1] || parent[0])\n      && !node.length) {\n    if (retainer) retainer[j] = node;\n    else this._root = node;\n  }\n\n  return this;\n}\n\nexport function removeAll(data) {\n  for (var i = 0, n = data.length; i < n; ++i) this.remove(data[i]);\n  return this;\n}\n", "export default function() {\n  return this._root;\n}\n", "export default function() {\n  var size = 0;\n  this.visit(function(node) {\n    if (!node.length) do ++size; while (node = node.next)\n  });\n  return size;\n}\n", "import Quad from \"./quad.js\";\n\nexport default function(callback) {\n  var quads = [], q, node = this._root, child, x0, y0, x1, y1;\n  if (node) quads.push(new Quad(node, this._x0, this._y0, this._x1, this._y1));\n  while (q = quads.pop()) {\n    if (!callback(node = q.node, x0 = q.x0, y0 = q.y0, x1 = q.x1, y1 = q.y1) && node.length) {\n      var xm = (x0 + x1) / 2, ym = (y0 + y1) / 2;\n      if (child = node[3]) quads.push(new Quad(child, xm, ym, x1, y1));\n      if (child = node[2]) quads.push(new Quad(child, x0, ym, xm, y1));\n      if (child = node[1]) quads.push(new Quad(child, xm, y0, x1, ym));\n      if (child = node[0]) quads.push(new Quad(child, x0, y0, xm, ym));\n    }\n  }\n  return this;\n}\n", "import Quad from \"./quad.js\";\n\nexport default function(callback) {\n  var quads = [], next = [], q;\n  if (this._root) quads.push(new Quad(this._root, this._x0, this._y0, this._x1, this._y1));\n  while (q = quads.pop()) {\n    var node = q.node;\n    if (node.length) {\n      var child, x0 = q.x0, y0 = q.y0, x1 = q.x1, y1 = q.y1, xm = (x0 + x1) / 2, ym = (y0 + y1) / 2;\n      if (child = node[0]) quads.push(new Quad(child, x0, y0, xm, ym));\n      if (child = node[1]) quads.push(new Quad(child, xm, y0, x1, ym));\n      if (child = node[2]) quads.push(new Quad(child, x0, ym, xm, y1));\n      if (child = node[3]) quads.push(new Quad(child, xm, ym, x1, y1));\n    }\n    next.push(q);\n  }\n  while (q = next.pop()) {\n    callback(q.node, q.x0, q.y0, q.x1, q.y1);\n  }\n  return this;\n}\n", "export function defaultX(d) {\n  return d[0];\n}\n\nexport default function(_) {\n  return arguments.length ? (this._x = _, this) : this._x;\n}\n", "export function defaultY(d) {\n  return d[1];\n}\n\nexport default function(_) {\n  return arguments.length ? (this._y = _, this) : this._y;\n}\n", "import type { Quadtree, QuadtreeInternalNode, QuadtreeLeaf } from 'd3-quadtree';\n\n/**\n * Traverses a quad tree in depth-first order, starting with top-left quadrant\n * and calling a callback function on each leaf node.\n *\n * @param tree - The quad tree to traverse\n * @param callback - Function called on each leaf node. Return true to stop traversal, false to continue\n * @param node - Current node being processed (used internally for recursion)\n * @param x1 - Left boundary of current quadrant (used internally for recursion)\n * @param y1 - Top boundary of current quadrant (used internally for recursion)\n * @param x2 - Right boundary of current quadrant (used internally for recursion)\n * @param y2 - Bottom boundary of current quadrant (used internally for recursion)\n * @returns true if traversal was stopped by callback, false if completed\n *\n * @example\n * ```typescript\n * import { quadtree } from 'd3-quadtree';\n * import { traverseQuadTree } from './utils';\n *\n * // Create a quad tree with some data points\n * const tree = quadtree()\n *   .x(d => d.x)\n *   .y(d => d.y)\n *   .addAll([\n *     { x: 10, y: 10, id: 'point1' },\n *     { x: 20, y: 20, id: 'point2' },\n *     { x: 30, y: 30, id: 'point3' }\n *   ]);\n *\n * // Traverse all leaf nodes and process them\n * traverseQuadTree(tree, (data, x1, y1, x2, y2) => {\n *   console.log('Found leaf node:', data, 'in bounds:', [x1, y1, x2, y2]);\n *   return false; // Continue traversal\n * });\n *\n * // Stop traversal when a specific condition is met\n * traverseQuadTree(tree, (data, x1, y1, x2, y2) => {\n *   if (data.id === 'point2') {\n *     console.log('Found target point:', data);\n *     return true; // Stop traversal\n *   }\n *   return false; // Continue traversal\n * });\n * ```\n */\nexport function traverseQuadTree<T>(\n\ttree: Quadtree<T>,\n\tcallback: (\n\t\tnode: QuadtreeInternalNode<T> | QuadtreeLeaf<T>,\n\t\tx1: number,\n\t\ty1: number,\n\t\tx2: number,\n\t\ty2: number,\n\t) => boolean,\n\tnode?: QuadtreeInternalNode<T> | QuadtreeLeaf<T>,\n\tx1 = 0,\n\ty1 = 0,\n\tx2 = 0,\n\ty2 = 0,\n): boolean {\n\t// root tree\n\tif (node === undefined) {\n\t\tnode = tree.root();\n\t\tconst extent = tree.extent();\n\t\tif (extent) {\n\t\t\t[[x1, y1], [x2, y2]] = extent;\n\t\t\t// check callback for root and stop (which should never happen?)\n\t\t\tif (callback(node, x1, y1, x2, y2)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\tif (!node) return false;\n\t}\n\n\t// debugger;\n\n\t// Calculate quadrant bounds: [x1, y1, x2, y2] for each quadrant\n\tconst quadrants = [\n\t\t[x1, y1, (x2 + x1) / 2, (y2 + y1) / 2], // top-left\n\t\t[(x2 + x1) / 2, y1, x2, (y2 + y1) / 2], // top-right\n\t\t[x1, (y2 + y1) / 2, (x2 + x1) / 2, y2], // bottom-left\n\t\t[(x2 + x1) / 2, (y2 + y1) / 2, x2, y2], // bottom-right\n\t];\n\n\t// For each quadrant: top-left, top-right, bottom-left, bottom-right\n\tfor (let i = 0; i < 4; i++) {\n\t\tconst quadrant = node[i];\n\t\tif (quadrant) {\n\t\t\tconst [qx1, qy1, qx2, qy2] = quadrants[i];\n\n\t\t\tconst shouldNotSearchChildren = callback(quadrant, qx1, qy1, qx2, qy2);\n\t\t\t// Only search children if callback returns true (continue searching)\n\t\t\tif (!shouldNotSearchChildren) {\n\t\t\t\ttraverseQuadTree(tree, callback, quadrant, qx1, qy1, qx2, qy2);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn false;\n}\n\nexport function getDistanceFast(x1: number, y1: number, x2: number, y2: number) {\n\tconst xDiff = x2 - x1;\n\tconst yDiff = y2 - y1;\n\treturn Math.sqrt(xDiff * xDiff + yDiff * yDiff);\n}\n", "import type { LocationId, LocationSocial, Location as MVFLocation } from '@mappedin/mvf-v2';\nimport BaseMetaData from './base-metadata-object';\nimport type {\n\tAnnotation,\n\tConnection,\n\tDoor,\n\tLocationCategory,\n\tMapDataInternal,\n\tSpace,\n\tMapObject,\n\tPointOfInterest,\n\tArea,\n} from '.';\nimport type { TFocusTarget, TNavigationTarget, IFocusable, INavigatable } from '../types';\nimport { OpeningHours } from './opening-hours';\nimport Hyperlink from './hyperlink';\nimport ImageMetaData from './image';\nimport { serializeCoords } from '../utils';\n\n// This type helps us know we have all the properties we need\ntype LocationData = Omit<\n\tMVFLocation,\n\t| 'categories'\n\t| 'spaces'\n\t| 'obstructions'\n\t| 'entrances'\n\t| 'shapes'\n\t| 'connections'\n\t| 'annotations'\n\t| 'areas'\n\t| 'openingHoursSpecification'\n\t| 'links'\n\t| 'pictures'\n\t| 'website'\n\t| 'icon'\n> & {\n\t// These types are transformed to match the other SDK types\n\tlinks: Hyperlink[];\n\timages: ImageMetaData[];\n\ticon?: ImageMetaData;\n};\n\nclass LocationProfile extends BaseMetaData implements LocationData, IFocusable, INavigatable {\n\t/**\n\t * Checks if the provided instance is of type EnterpriseLocation.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a EnterpriseLocation, false otherwise.\n\t */\n\tstatic is(instance: object): instance is LocationProfile {\n\t\treturn (instance as { __type: string }).__type === LocationProfile.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'location-profile';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = LocationProfile.__type;\n\tid: LocationId = 'loc_';\n\tname = '';\n\texternalId?: string;\n\n\tdescription?: string;\n\n\t/**\n\t * The location's logo\n\t *\n\t * @format uri\n\t */\n\tlogo?: string;\n\n\tphone?: string;\n\n\t/**\n\t * The location's social media links.\n\t */\n\tsocial: LocationSocial[] = [];\n\n\t/**\n\t * The location's pictures\n\t */\n\timages: ImageMetaData[] = [];\n\n\t/**\n\t * Web links for the location\n\t */\n\tlinks: Hyperlink[] = [];\n\n\t/**\n\t * The location's website\n\t */\n\twebsite?: Hyperlink;\n\n\t/**\n\t * The location's icon to display. Will be either a logo, category, or image\n\t *\n\t * @format uri\n\t */\n\ticon?: ImageMetaData;\n\n\t#data: MapDataInternal;\n\t#cache: Partial<{\n\t\tareas: Area[];\n\t\tspaces: Space[];\n\t\tdoors: Door[];\n\t\tpoints: PointOfInterest[];\n\t\tconnections: Connection[];\n\t\tannotations: Annotation[];\n\t\tcategories: LocationCategory[];\n\t\tmapObjects: MapObject[];\n\t\tfocusTarget: TFocusTarget[];\n\t\tnavigationTarget: TNavigationTarget[];\n\t\topeningHours: OpeningHours;\n\t}> = {};\n\t#mvfData: MVFLocation;\n\n\tconstructor(data: MapDataInternal, options: { mvfData: MVFLocation }) {\n\t\tsuper(options.mvfData.id);\n\t\tthis.#data = data;\n\t\tthis.#mvfData = options.mvfData;\n\t\tfor (const prop in options.mvfData) {\n\t\t\t// Handle links and images special because there is a small type mismatch in MVF\n\t\t\t// TODO: Fix this when we move to MVFv3\n\t\t\tif (prop === 'links') {\n\t\t\t\tthis.links = options.mvfData.links.map(link => new Hyperlink({ mvfData: link }));\n\t\t\t} else if (prop === 'pictures') {\n\t\t\t\tthis.images = options.mvfData.pictures\n\t\t\t\t\t.map(image =>\n\t\t\t\t\t\timage.url\n\t\t\t\t\t\t\t? new ImageMetaData({\n\t\t\t\t\t\t\t\t\tmvfData: {\n\t\t\t\t\t\t\t\t\t\t...image,\n\t\t\t\t\t\t\t\t\t\turl: image.url ?? '',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tmapData: this.#data,\n\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t)\n\t\t\t\t\t.filter(image => image != null);\n\t\t\t} else if (prop === 'website') {\n\t\t\t\tif (options.mvfData.website) {\n\t\t\t\t\tthis.website = new Hyperlink({ mvfData: options.mvfData.website });\n\t\t\t\t}\n\t\t\t} else if (prop === 'icon') {\n\t\t\t\tif (options.mvfData.icon) {\n\t\t\t\t\tthis.icon = new ImageMetaData({ mvfData: { url: options.mvfData.icon }, mapData: this.#data });\n\t\t\t\t}\n\t\t\t} else if (!Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this), prop)) {\n\t\t\t\tObject.defineProperty(this, prop, {\n\t\t\t\t\tenumerable: true,\n\t\t\t\t\tget() {\n\t\t\t\t\t\treturn this.#mvfData[prop];\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Gets the {@link Space}s associated with the location.\n\t *\n\t * @returns {Space[]} The spaces array.\n\t */\n\tget spaces(): Space[] {\n\t\tif (this.#cache.spaces) {\n\t\t\treturn this.#cache.spaces;\n\t\t}\n\n\t\tif (this.#mvfData.spaces == null) {\n\t\t\tthis.#cache.spaces = [];\n\n\t\t\treturn this.#cache.spaces;\n\t\t}\n\n\t\tthis.#cache.spaces = [];\n\t\tfor (let i = 0; i < this.#mvfData.spaces.length; i++) {\n\t\t\tconst space = this.#data.getById('space', this.#mvfData.spaces[i].id);\n\t\t\tif (space) {\n\t\t\t\tthis.#cache.spaces.push(space);\n\t\t\t}\n\t\t}\n\n\t\treturn this.#cache.spaces;\n\t}\n\n\t/**\n\t * Gets the {@link PointOfInterest}s associated with the location.\n\t *\n\t * @returns {PointOfInterest[]} The points of interest array.\n\t */\n\tget points(): PointOfInterest[] {\n\t\tif (this.#cache.points) {\n\t\t\treturn this.#cache.points;\n\t\t}\n\n\t\tif (this.#mvfData.spaces == null) {\n\t\t\tthis.#cache.points = [];\n\n\t\t\treturn this.#cache.points;\n\t\t}\n\n\t\tthis.#cache.points = [];\n\t\t// POIs are also spaces in the MVF data\n\t\tfor (let i = 0; i < this.#mvfData.spaces.length; i++) {\n\t\t\tconst point = this.#data.getById('point-of-interest', this.#mvfData.spaces[i].id);\n\t\t\tif (point) {\n\t\t\t\tthis.#cache.points.push(point);\n\t\t\t}\n\t\t}\n\n\t\treturn this.#cache.points;\n\t}\n\n\t/**\n\t * Gets the {@link Door}s associated with the location.\n\t *\n\t * @returns {Door[]} The doors array.\n\t */\n\tget doors(): Door[] {\n\t\tif (this.#cache.doors) {\n\t\t\treturn this.#cache.doors;\n\t\t}\n\n\t\tif (this.#mvfData.entrances == null) {\n\t\t\tthis.#cache.doors = [];\n\n\t\t\treturn this.#cache.doors;\n\t\t}\n\n\t\tthis.#cache.doors = [];\n\t\tfor (let i = 0; i < this.#mvfData.entrances.length; i++) {\n\t\t\tconst door = this.#data.getById('door', this.#mvfData.entrances[i].id);\n\t\t\tif (door) {\n\t\t\t\tthis.#cache.doors.push(door);\n\t\t\t}\n\t\t}\n\n\t\treturn this.#cache.doors;\n\t}\n\n\t/**\n\t * Gets the {@link Connection}s associated with the location.\n\t *\n\t * @returns {Connection[]} The connections array.\n\t */\n\tget connections(): Connection[] {\n\t\tif (this.#cache.connections) {\n\t\t\treturn this.#cache.connections;\n\t\t}\n\n\t\tif (this.#mvfData.connections == null) {\n\t\t\tthis.#cache.connections = [];\n\n\t\t\treturn this.#cache.connections;\n\t\t}\n\n\t\t/**\n\t\t * The location metadata references connections by their group ID. In order to get the\n\t\t * connection instances, we need to do a reverse lookup by node IDs.\n\t\t *\n\t\t * TODO: Fix this when MVFv3 fixes connections.\n\t\t */\n\t\tconst uniqueConnections = new Set<Connection>();\n\t\tfor (let i = 0; i < this.#mvfData.connections.length; i++) {\n\t\t\tconst connectionGroupId = this.#mvfData.connections[i];\n\t\t\tconst mvfConnection = this.#data.mvfConnectionsById[connectionGroupId];\n\t\t\tconst nodeIds = mvfConnection == null ? [] : mvfConnection.nodes;\n\t\t\tconst nodes = nodeIds.map(id => this.#data.getById('node', id)).filter(Boolean);\n\t\t\tfor (const node of nodes) {\n\t\t\t\tif (node == null) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst latLonString = serializeCoords([node.coordinate.longitude, node.coordinate.latitude]);\n\t\t\t\tconst maybeConnectionIds = this.#data.connectionSpaceIdsByLatLon[latLonString] ?? [];\n\t\t\t\tconst connections = maybeConnectionIds.map(id => this.#data.connectionsById[id]).filter(c => c != null);\n\t\t\t\tfor (const connection of connections) {\n\t\t\t\t\tuniqueConnections.add(connection);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.#cache.connections = Array.from(uniqueConnections);\n\n\t\treturn this.#cache.connections;\n\t}\n\n\t/**\n\t * Gets the {@link Annotation}s associated with the location.\n\t *\n\t * @returns {Annotation[]} The annotations array.\n\t */\n\tget annotations(): Annotation[] {\n\t\tif (this.#cache.annotations) {\n\t\t\treturn this.#cache.annotations;\n\t\t}\n\n\t\tif (this.#mvfData.annotations == null) {\n\t\t\tthis.#cache.annotations = [];\n\n\t\t\treturn this.#cache.annotations;\n\t\t}\n\n\t\tthis.#cache.annotations = [];\n\t\tfor (let i = 0; i < this.#mvfData.annotations.length; i++) {\n\t\t\tconst annotation = this.#data.getById('annotation', this.#mvfData.annotations[i].id);\n\t\t\tif (annotation) {\n\t\t\t\tthis.#cache.annotations.push(annotation);\n\t\t\t}\n\t\t}\n\n\t\treturn this.#cache.annotations;\n\t}\n\n\t/**\n\t * Gets the {@link LocationCategory}s associated with the location.\n\t *\n\t * @returns {LocationCategory[]} The location categories array.\n\t */\n\tget categories(): LocationCategory[] {\n\t\tif (this.#cache.categories) {\n\t\t\treturn this.#cache.categories;\n\t\t}\n\n\t\tif (this.#mvfData.categories == null) {\n\t\t\tthis.#cache.categories = [];\n\n\t\t\treturn this.#cache.categories;\n\t\t}\n\n\t\tthis.#cache.categories = this.#mvfData.categories\n\t\t\t.map(cId => this.#data.getById('location-category', cId))\n\t\t\t.filter(c => c != null);\n\n\t\treturn this.#cache.categories;\n\t}\n\n\t/**\n\t * Gets the {@link MapObject}s associated with the location.\n\t *\n\t * @returns {MapObject[]} The map objects array.\n\t */\n\tget mapObjects(): MapObject[] {\n\t\tif (this.#cache.mapObjects) {\n\t\t\treturn this.#cache.mapObjects;\n\t\t}\n\n\t\tif (this.#mvfData.obstructions == null) {\n\t\t\tthis.#cache.mapObjects = [];\n\n\t\t\treturn this.#cache.mapObjects;\n\t\t}\n\n\t\tthis.#cache.mapObjects = this.#mvfData.obstructions\n\t\t\t.map(o => this.#data.getById('object', o.id))\n\t\t\t.filter(o => o != null);\n\n\t\treturn this.#cache.mapObjects;\n\t}\n\n\t/**\n\t * Gets the {@link Area}s associated with the location.\n\t *\n\t * @returns {Area[]} The areas array.\n\t */\n\tget areas(): Area[] {\n\t\tif (this.#cache.areas) {\n\t\t\treturn this.#cache.areas;\n\t\t}\n\n\t\tif (this.#mvfData.areas == null) {\n\t\t\tthis.#cache.areas = [];\n\n\t\t\treturn this.#cache.areas;\n\t\t}\n\n\t\tthis.#cache.areas = this.#mvfData.areas.map(a => this.#data.getById('area', a.id)).filter(a => a != null);\n\n\t\treturn this.#cache.areas;\n\t}\n\n\t/** @internal */\n\tget focusTarget() {\n\t\tif (this.#cache.focusTarget) {\n\t\t\treturn this.#cache.focusTarget;\n\t\t}\n\n\t\tconst targets: TFocusTarget[] = [];\n\t\tfor (const space of this.spaces) {\n\t\t\ttargets.push(space);\n\t\t}\n\t\tfor (const connection of this.connections) {\n\t\t\ttargets.push(...connection.coordinates);\n\t\t}\n\t\tfor (const door of this.doors) {\n\t\t\ttargets.push(door.focusTarget);\n\t\t}\n\t\tfor (const mapObject of this.mapObjects) {\n\t\t\ttargets.push(mapObject.focusTarget);\n\t\t}\n\t\tfor (const annotation of this.annotations) {\n\t\t\ttargets.push(annotation.focusTarget);\n\t\t}\n\t\tfor (const point of this.points) {\n\t\t\ttargets.push(point.focusTarget);\n\t\t}\n\t\tfor (const area of this.areas) {\n\t\t\ttargets.push(area.focusTarget);\n\t\t}\n\n\t\tthis.#cache.focusTarget = targets;\n\n\t\treturn targets;\n\t}\n\n\t/**\n\t * Gets the {@link OpeningHours} associated with the location.\n\t *\n\t * @returns {OpeningHours} The opening hours.\n\t */\n\tget openingHours(): OpeningHours {\n\t\tif (this.#cache.openingHours) {\n\t\t\treturn this.#cache.openingHours;\n\t\t}\n\n\t\tthis.#cache.openingHours = new OpeningHours(this.#mvfData.openingHoursSpecification ?? []);\n\n\t\treturn this.#cache.openingHours;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tget navigationTarget(): TNavigationTarget[] {\n\t\tif (this.#cache.navigationTarget) {\n\t\t\treturn this.#cache.navigationTarget;\n\t\t}\n\n\t\tconst targets: TNavigationTarget[] = [];\n\t\tfor (const space of this.spaces) {\n\t\t\ttargets.push(space);\n\t\t}\n\t\tfor (const connection of this.connections) {\n\t\t\ttargets.push(...connection.coordinates);\n\t\t}\n\t\tfor (const door of this.doors) {\n\t\t\ttargets.push(door.focusTarget);\n\t\t}\n\t\tfor (const mapObject of this.mapObjects) {\n\t\t\ttargets.push(mapObject.focusTarget);\n\t\t}\n\t\tfor (const annotation of this.annotations) {\n\t\t\ttargets.push(annotation.focusTarget);\n\t\t}\n\t\tfor (const point of this.points) {\n\t\t\ttargets.push(point.focusTarget);\n\t\t}\n\n\t\tthis.#cache.navigationTarget = targets;\n\n\t\treturn targets;\n\t}\n\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: LocationProfile.__type,\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t};\n\t}\n}\n\nexport default LocationProfile;\n", "import type { OpeningHoursSpecification } from '@mappedin/mvf-v2';\n\n/**\n * Represents the opening hours of a location.\n */\nexport class OpeningHours {\n\t#mvfData: OpeningHoursSpecification[];\n\tconstructor(mvfData: OpeningHoursSpecification[]) {\n\t\tthis.#mvfData = mvfData || [];\n\t}\n\n\t/**\n\t * Gets the raw opening hours data.\n\t */\n\tget raw() {\n\t\treturn this.#mvfData;\n\t}\n}\n", "import type { CategoryId, Category as MVFCategory } from '@mappedin/mvf-v2';\nimport BaseMetaData from './base-metadata-object';\nimport type { LocationProfile, MapDataInternal } from '.';\n\nclass LocationCategory extends BaseMetaData implements Omit<MVFCategory, 'parent'> {\n\t/**\n\t * Checks if the provided instance is of type EnterpriseLocation.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a EnterpriseLocation, false otherwise.\n\t */\n\tstatic is(instance: object): instance is LocationCategory {\n\t\treturn (instance as { __type: string }).__type === LocationCategory.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'location-category';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = LocationCategory.__type;\n\tid: CategoryId = 'cat_';\n\tname = '';\n\n\t/**\n\t * The category's icon\n\t *\n\t * @format uri\n\t */\n\ticon = '';\n\n\t#data: MapDataInternal;\n\t#cache: Partial<{\n\t\tparent: LocationCategory | undefined;\n\t\tlocationProfiles: LocationProfile[];\n\t\tchildren: LocationCategory[];\n\t}> = {};\n\t#mvfData: MVFCategory;\n\n\tconstructor(data: MapDataInternal, options: { mvfData: MVFCategory }) {\n\t\tsuper(options.mvfData.id);\n\t\tthis.#data = data;\n\t\tthis.#mvfData = options.mvfData;\n\t\tfor (const prop in options.mvfData) {\n\t\t\tif (!Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this), prop)) {\n\t\t\t\tObject.defineProperty(this, prop, {\n\t\t\t\t\tenumerable: true,\n\t\t\t\t\tget() {\n\t\t\t\t\t\treturn this.#mvfData[prop];\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Gets the parent {@link LocationCategory}.\n\t *\n\t * @returns {LocationCategory | undefined} The parent location category.\n\t */\n\tget parent(): LocationCategory | undefined {\n\t\tif (this.#cache.parent) {\n\t\t\treturn this.#cache.parent;\n\t\t}\n\n\t\tthis.#cache.parent = this.#mvfData.parent\n\t\t\t? this.#data.getById('location-category', this.#mvfData.parent)\n\t\t\t: undefined;\n\n\t\treturn this.#cache.parent;\n\t}\n\n\t/**\n\t * Gets the children {@link LocationCategory}s.\n\t */\n\tget children(): LocationCategory[] {\n\t\tif (this.#cache.children) {\n\t\t\treturn this.#cache.children;\n\t\t}\n\n\t\tthis.#cache.children = this.#data.locationCategoriesByParentId[this.id] || [];\n\n\t\treturn this.#cache.children;\n\t}\n\n\t/**\n\t * Gets the {@link LocationProfile}s that are associated with this category.\n\t */\n\tget locationProfiles(): LocationProfile[] {\n\t\tif (this.#cache.locationProfiles) {\n\t\t\treturn this.#cache.locationProfiles;\n\t\t}\n\n\t\tconst profiles: LocationProfile[] = [];\n\n\t\tfor (const profile of this.#data.locationProfilesByCategoryId[this.id] || []) {\n\t\t\tconst locationProfile = this.#data.getById('location-profile', profile.id);\n\t\t\tif (locationProfile) {\n\t\t\t\tprofiles.push(locationProfile);\n\t\t\t}\n\t\t}\n\n\t\tthis.#cache.locationProfiles = profiles;\n\n\t\treturn profiles;\n\t}\n\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: LocationCategory.__type,\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t};\n\t}\n}\n\nexport default LocationCategory;\n", "import { ANIMATION_TWEENS, type MapViewState, type RendererCore, type WatermarkUpdateOptions } from '../../geojson/src';\nimport type { EasingCurve } from '@packages/internal/common';\nimport { Logger, PubSub, MappedinError } from '@packages/internal/common';\nimport { type TEvents, type TShow3DMapOptions } from '.';\nimport type { Navigation } from './navigation';\nimport type {\n\tCamera,\n\tLabels,\n\tMarkers,\n\tModels,\n\tPaths,\n\tExporter,\n\tDirections,\n\tStyle,\n\tOutdoor,\n\tImage3D,\n\tText3D,\n} from './api-geojson';\nimport { GeoJsonApi } from './api-geojson';\nimport type MapData from './map-data';\nimport { Coordinate } from './map-data-objects';\nimport type {\n\tAnnotation,\n\tDoor,\n\tFloor,\n\tMapObject,\n\tPointOfInterest,\n\tSpace,\n\tNode,\n\tEnterpriseLocation,\n\tFloorStack,\n} from './map-data-objects';\nimport type { TCoordinateParams } from './map-data-objects/coordinate';\nimport type {\n\tTGetDirectionsOptions,\n\tTNavigationTarget,\n\tGlobalState,\n\tUpdateGlobalState,\n\tTSetFloorOptions,\n\tTCancellablePromise,\n\tTAnimateStateResult,\n\tTGetState,\n\tMapElementsWithState,\n\tTUpdateState,\n\tTGetInViewOptions,\n\tMapFeatureOfType,\n\tTTakeScreenshotOptions,\n} from './types';\nimport type { Label, Marker } from './map-view-objects';\nimport type { TEventPayload } from './events';\nimport type { Shapes } from './api-geojson/shapes';\nimport type { InspectorOption } from './api-geojson/inspector/inspector';\nimport { Debug } from './debug';\nimport { updateGlobalStateSchema } from './api-geojson/schemas';\nimport { animationFactory } from './utils/animation';\nimport type { Tween } from '@tweenjs/tween.js';\nimport { getPublicOptions } from './utils/options';\nimport type { PartialDeep, ReadonlyDeep } from 'type-fest';\nimport type { ExtractDeep } from '@packages/internal/common/type-utils';\n\n/**\n * ## MapView in Mappedin JS\n *\n * MapView is the main rendering and interaction class for Mappedin maps. It provides comprehensive controls for manipulating map elements, camera, styling, and user interactions.\n *\n * ### Features\n * - **Rendering Control**: Camera, labels, markers, models, paths, and more\n * - **Interactive Elements**: Hover effects, click handling, and state management\n * - **Animation System**: Smooth transitions and state animations\n * - **Multi-floor Support**: Floor switching and stacked maps\n * - **Navigation**: Built-in wayfinding and directions\n * - **Styling**: Dynamic theme and style customization\n * - **Event System**: Comprehensive event handling for user interactions\n *\n * > **Best Practice:** Use the specialized API classes (Camera, Markers, Labels, etc.) for specific functionality.\n *\n * ### Example Usage\n * ```ts\n * // Initialize MapView\n * const mapData = await getMapData({key: 'your-key', secret: 'your-secret', mapId: 'your-map-id'});\n * const mapView = await show3dMap(container, mapData);\n * mapView.on('click', (event) => {\n *   console.log('Clicked:', event.coordinate);\n * });\n * ```\n *\n * ### Core Components\n * - **Camera**: View control, zoom, pan, and rotation\n * - **Markers**: Point-based visual elements\n * - **Labels**: Text overlays on the map\n * - **Paths**: Route visualization and navigation\n * - **Models**: 3D model rendering\n * - **Style**: Theme and appearance customization\n * - **Navigation**: Wayfinding and directions\n *\n * ### State Management\n * - `updateState()`: Immediate state changes\n * - `animateState()`: Smooth animated transitions\n * - `getState()`: Retrieve current element states\n * - `updateGlobalState()`: Apply global styling changes\n *\n * ### Event Handling\n * ```ts\n * // Listen for user interactions\n * mapView.on('click', (event) => {\n *   console.log('Clicked:', event.coordinate);\n * });\n *\n * mapView.on('hover', (event) => {\n *   console.log('Hovered:', event.coordinate);\n * });\n *\n * mapView.on('floorChanged', (event) => {\n *   console.log('Floor changed to:', event.floor);\n * });\n * ```\n *\n * ### More Information\n * - [Getting Started Guide](https://developer.mappedin.com/web-sdk/getting-started)\n * - [Camera Guide](https://developer.mappedin.com/web-sdk/camera)\n * - [Markers Guide](https://developer.mappedin.com/web-sdk/markers)\n * - [Labels Guide](https://developer.mappedin.com/web-sdk/labels)\n * - [Paths Guide](https://developer.mappedin.com/web-sdk/wayfinding#drawing-a-path)\n *\n * The MapView class is the main class for rendering and interacting with the map.\n *\n * It provides a set of controls for manipulating the map's elements and state.\n *\n * For help getting started, refer to the [Getting Started Guide](https://developer.mappedin.com/web-sdk/getting-started).\n */\nexport class MapView {\n\t#pubSub: PubSub<TEvents>;\n\t#api: GeoJsonApi;\n\t#core: RendererCore;\n\n\t/**\n\t * Controls for the map's camera.\n\t *\n\t * Provides methods for camera positioning, zooming, panning, and view control.\n\t *\n\t * @example\n\t * ```ts\n\t * // Set camera position\n\t * mapView.Camera.setPosition(coordinate, { duration: 1000 });\n\t *\n\t * // Zoom to fit all spaces\n\t * mapView.Camera.fitToElements(spaces);\n\t *\n\t * // Animate camera movement\n\t * mapView.Camera.animateTo(coordinate, { duration: 2000 });\n\t * ```\n\t *\n\t * @see [Camera Guide](https://developer.mappedin.com/web-sdk/camera)\n\t */\n\tCamera: Camera;\n\t/**\n\t * Controls for the map's labels.\n\t *\n\t * Manages text overlays, tooltips, and label visibility on the map.\n\t *\n\t * @example\n\t * ```ts\n\t * // Add a label\n\t * const label = mapView.Labels.add(coordinate, 'Welcome!');\n\t *\n\t * // Update label style\n\t * mapView.Labels.update(label, { color: 'red', fontSize: 16 });\n\t *\n\t * // Remove label\n\t * mapView.Labels.remove(label);\n\t * ```\n\t *\n\t * @see [Labels Guide](https://developer.mappedin.com/web-sdk/labels)\n\t */\n\tLabels: Labels;\n\t/**\n\t * @experimental\n\t * Controls for the map's 3D texts.\n\t *\n\t * Provides 3D text rendering capabilities for enhanced visual effects.\n\t *\n\t * @example\n\t * ```ts\n\t * // Add 3D text\n\t * const text3d = mapView.Text3D.add(coordinate, '3D Text', {\n\t *   height: 10,\n\t *   color: 'blue'\n\t * });\n\t * ```\n\t */\n\tText3D: Text3D;\n\t/**\n\t * Controls for the map's markers.\n\t *\n\t * Manages point-based visual elements like pins, icons, and custom markers.\n\t *\n\t * @example\n\t * ```ts\n\t * // Add a marker\n\t * const marker = mapView.Markers.add(coordinate, {\n\t *   color: 'red',\n\t *   size: 20,\n\t *   label: 'Important Location'\n\t * });\n\t *\n\t * // Update marker\n\t * mapView.Markers.update(marker, { color: 'blue' });\n\t *\n\t * // Remove marker\n\t * mapView.Markers.remove(marker);\n\t * ```\n\t *\n\t * @see [Markers Guide](https://developer.mappedin.com/web-sdk/markers)\n\t */\n\tMarkers: Markers;\n\t/**\n\t * Controls for the map's 3D images.\n\t *\n\t * Manages image overlays and custom image elements on the map.\n\t *\n\t * @example\n\t * ```ts\n\t * // Add an image\n\t * const image = mapView.Image3D.add(coordinate, 'path/to/image.png', {\n\t *   width: 100,\n\t *   height: 100\n\t * });\n\t * ```\n\t */\n\tImage3D: Image3D;\n\t/**\n\t * Controls for the map's models.\n\t *\n\t * Manages 3D model rendering and positioning on the map.\n\t *\n\t * @example\n\t * ```ts\n\t * // Add a 3D model\n\t * const model = mapView.Models.add(coordinate, 'path/to/model.glb', {\n\t *   scale: 1.0,\n\t *   rotation: { x: 0, y: 0, z: 0 }\n\t * });\n\t * ```\n\t */\n\tModels: Models;\n\t/**\n\t * Controls for the map's paths.\n\t *\n\t * Manages route visualization, navigation paths, and custom path rendering.\n\t *\n\t * @example\n\t * ```ts\n\t * // Add a path\n\t * const path = mapView.Paths.add(coordinates, {\n\t *   color: 'blue',\n\t *   width: 3,\n\t *   animated: true\n\t * });\n\t *\n\t * // Show navigation route\n\t * const directions = mapData.getDirections(space1, space2);\n\t * if (directions) {\n\t *   mapView.Paths.show(directions);\n\t * }\n\t * ```\n\t *\n\t * @see [Paths Guide](https://developer.mappedin.com/web-sdk/wayfinding#drawing-a-path)\n\t */\n\tPaths: Paths;\n\t/**\n\t * Controls for the map's 3D exporter.\n\t * @hidden\n\t */\n\tExporter: Exporter;\n\t/**\n\t * Controls for the map's navigation.\n\t */\n\tNavigation: Navigation;\n\n\t/**\n\t * Controls for the indoor map's style.\n\t */\n\tStyle: Style;\n\n\t/**\n\t * Controls custom GeoJSON geometry on the map.\n\t *\n\t * Allows adding custom geometric shapes and overlays to the map.\n\t *\n\t * @example\n\t * ```ts\n\t * // Add custom shape\n\t * const shape = mapView.Shapes.add(geoJSON, {\n\t *   color: 'red',\n\t *   opacity: 0.5\n\t * });\n\t * ```\n\t */\n\tShapes: Shapes;\n\n\t/**\n\t * Controls for the outdoor map.\n\t *\n\t * Manages outdoor map integration and outdoor tile rendering.\n\t *\n\t * @example\n\t * ```ts\n\t * // Enable outdoor map\n\t * mapView.Outdoor.enable();\n\t *\n\t * // Set outdoor style\n\t * mapView.Outdoor.setStyle('satellite');\n\t * ```\n\t */\n\tOutdoor: Outdoor;\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(rendererCore: RendererCore) {\n\t\tthis.#pubSub = new PubSub<TEvents>();\n\t\tthis.#core = rendererCore;\n\t\tconst geojsonApi = new GeoJsonApi(rendererCore, this, this.#pubSub);\n\t\tthis.#api = geojsonApi;\n\t\tthis.Camera = this.#api.Camera;\n\n\t\tthis.Markers = this.#api.Markers;\n\t\tthis.Models = this.#api.Models;\n\t\tthis.Labels = this.#api.Labels;\n\t\tthis.Text3D = this.#api.Text3D;\n\t\tthis.Exporter = this.#api.Exporter;\n\t\tthis.Paths = this.#api.Paths;\n\t\tthis.Navigation = this.#api.Navigation;\n\t\tthis.Shapes = this.#api.Shapes;\n\t\tthis.Style = this.#api.Style;\n\t\tthis.Outdoor = this.#api.Outdoor;\n\t\tthis.Image3D = this.#api.Image3D;\n\t\tthis.#core.container.dataset['version'] = process.env.npm_package_version;\n\t\tthis.Debug = new Debug(this.#api.core);\n\t}\n\n\t/**\n\t * Updates the state of a map element immediately.\n\t *\n\t * This method provides direct control over the visual properties of map elements. Use `animateState()` for smooth transitions.\n\t *\n\t * The following table maps targets to their available states:\n\t *\n\t * | Target | State Type | Description |\n\t * |--------|------------|-------------|\n\t * | {@link Door} | {@link TDoorsUpdateState} | Open/closed state, color |\n\t * | {@link Floor} | {@link TFloorUpdateState} | Color, opacity, visibility |\n\t * | {@link Label} | {@link TLabelUpdateState} | Text, color, visibility |\n\t * | {@link Marker} | {@link TMarkerUpdateState} | Color, size, icon |\n\t * | {@link Model} | {@link TModelUpdateState} | Scale, rotation, visibility |\n\t * | {@link Path} | {@link TPathUpdateState} | Color, width, visibility |\n\t * | {@link Shape} | {@link TShapeUpdateState} | Color, opacity, geometry |\n\t * | {@link Space} | {@link TGeometryUpdateState} | Color, opacity, visibility |\n\t * | {@link Text3DView} | {@link TText3DUpdateState} | Text, color, height |\n\t * | {@link DOORS} | {@link TDoorsUpdateState} | Global door settings |\n\t * | {@link WALLS} | {@link TWallsUpdateState} | Global wall settings |\n\t *\n\t * @param target The map element to update.\n\t * @param state The new state to apply.\n\t *\n\t * @example Update space color\n\t * ```ts\n\t * const space = mapData.getById('space', 'space-123');\n\t * if (space) {\n\t *   mapView.updateState(space, { color: 'red' });\n\t * }\n\t * ```\n\t *\n\t * @example Update marker properties\n\t * ```ts\n\t * const marker = mapView.Markers.add(coordinate);\n\t * mapView.updateState(marker, {\n\t *   contentHTML: 'Updated Content'\n\t * });\n\t * ```\n\t *\n\t * @example Update global door settings\n\t * ```ts\n\t * mapView.updateState('DOORS', {\n\t *   color: 'green',\n\t *   opacity: 0.8\n\t * });\n\t * ```\n\t *\n\t * @example Update path appearance\n\t * ```ts\n\t * const path = mapView.Paths.add(coordinates);\n\t * mapView.updateState(path, {\n\t *   color: 'yellow',\n\t * });\n\t * ```\n\t */\n\tupdateState<T extends MapElementsWithState>(target: T, state: TUpdateState<T>): void {\n\t\treturn this.#api.updateState(target, state);\n\t}\n\n\t/**\n\t * Animate the state of a given target on the map from the current state to a new state. Only numeric properties and\n\t * colors can be animated.\n\t *\n\t * Use `updateState()` for immediate updates.\n\t *\n\t * The following table maps targets to their available states:\n\t *\n\t * | Target | State Type | Description |\n\t * |--------|------------|-------------|\n\t * | {@link Door} | {@link TDoorsUpdateState} | Open/closed state, color |\n\t * | {@link Floor} | {@link TFloorUpdateState} | Color, opacity, visibility |\n\t * | {@link Label} | {@link TLabelUpdateState} | Text, color, visibility |\n\t * | {@link Marker} | {@link TMarkerUpdateState} | Color, size, icon |\n\t * | {@link Model} | {@link TModelUpdateState} | Scale, rotation, visibility |\n\t * | {@link Path} | {@link TPathUpdateState} | Color, width, visibility |\n\t * | {@link Shape} | {@link TShapeUpdateState} | Color, opacity, geometry |\n\t * | {@link Space} | {@link TGeometryUpdateState} | Color, opacity, visibility |\n\t * | {@link Text3DView} | {@link TText3DUpdateState} | Text, color, height |\n\t * | {@link DOORS} | {@link TDoorsUpdateState} | Global door settings |\n\t * | {@link WALLS} | {@link TWallsUpdateState} | Global wall settings |\n\t *\n\t * @param target The map element to animate.\n\t * @param state The target state to animate to.\n\t * @param options Animation configuration options.\n\t * @param options.duration The duration of the animation in milliseconds (default: 1000).\n\t * @param options.easing The easing function to use for the animation.\n\t * @returns A cancellable promise that resolves when the animation completes.\n\t *\n\t * @example Animate label text size and color\n\t * ```ts\n\t * mapView.animateState(label, {\n\t *   appearance: {\n\t *     textSize: state.appearance.textSize! + 1,\n\t *     textColor: state.appearance.textColor! === '#000000' ? 'purple' : '#000000',\n\t *   },\n\t * });\n\t * ```\n\t *\n\t * @example When a space is clicked it sets it to non-interactive and animates its height and color and then sets it back\n\t * to interactive when the animation completes.\n\t *\n\t * ```ts\n\t * mapView.on('click', ({ spaces }) => {\n\t *   if (!spaces) return;\n\t *   spaces.forEach(space => {\n\t *     const state = mapView.getState(space)!;\n\t *     mapView.updateState(space, {\n\t *       interactive: false,\n\t *     });\n\t *     currentAnimation = mapView.animateState(space, {\n\t *       height: state.height + 1,\n\t *       color: state.color === 'rgb(255, 0, 0)' ? 'blue' : 'rgb(255, 0, 0)',\n\t *     });\n\t *     currentAnimation.finally(() => {\n\t *       mapView.updateState(space, {\n\t *         interactive: true,\n\t *       });\n\t *     });\n\t *   });\n\t * });\n\t * ```\n\t */\n\tanimateState<T extends MapElementsWithState>(\n\t\ttarget: T,\n\t\tstate: PartialDeep<ExtractDeep<TGetState<T>, number | string | undefined>>,\n\t\toptions?: {\n\t\t\tduration?: number;\n\t\t\teasing?: EasingCurve;\n\t\t},\n\t): TCancellablePromise<TAnimateStateResult>;\n\tanimateState(\n\t\ttarget: MapElementsWithState,\n\t\tstate: PartialDeep<ExtractDeep<TGetState<MapElementsWithState>, number | string | undefined>>,\n\t\toptions?: {\n\t\t\tduration?: number;\n\t\t\teasing?: EasingCurve;\n\t\t},\n\t): TCancellablePromise<TAnimateStateResult> {\n\t\tconst initialState = this.#api.getState(target);\n\t\tif (initialState == null) {\n\t\t\tLogger.warn(`Cannot animate state of ${target}.`);\n\t\t\tconst stubPromise = new Promise(res => res({ result: 'completed' }));\n\n\t\t\treturn stubPromise as TCancellablePromise<TAnimateStateResult>;\n\t\t}\n\n\t\tconst animate = animationFactory(initialState, state);\n\t\tconst tween = this.#api\n\t\t\t.tween({ percent: 0 })\n\t\t\t.to({ percent: 1 }, options?.duration ?? 1000)\n\t\t\t.onUpdate(({ percent }) => {\n\t\t\t\tthis.#api.updateState(target, animate(percent));\n\t\t\t});\n\n\t\tif (options?.easing && options.easing in ANIMATION_TWEENS) {\n\t\t\ttween.easing(ANIMATION_TWEENS[options.easing]);\n\t\t}\n\n\t\tconst promise = new Promise<TAnimateStateResult>(res => {\n\t\t\ttween\n\t\t\t\t.onComplete(() => {\n\t\t\t\t\tthis.#api.removeTween(tween);\n\t\t\t\t\tres({ result: 'completed' });\n\t\t\t\t})\n\t\t\t\t.onStop(() => {\n\t\t\t\t\tthis.#api.removeTween(tween);\n\t\t\t\t\tres({ result: 'cancelled' });\n\t\t\t\t});\n\t\t\ttween.start();\n\t\t}) as TCancellablePromise<TAnimateStateResult>;\n\n\t\tpromise.cancel = () => {\n\t\t\ttween.stop();\n\t\t\tthis.#api.updateState(target, animate(0));\n\t\t};\n\n\t\treturn promise;\n\t}\n\n\t/**\n\t * Update global state of the MapView\n\t */\n\tupdateGlobalState(update: UpdateGlobalState) {\n\t\ttry {\n\t\t\tupdateGlobalStateSchema.parse(update);\n\t\t} catch (e) {\n\t\t\tLogger.error('updateGlobalState', e);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (typeof update === 'object') {\n\t\t\tconst coreUpdate: Partial<MapViewState> = {};\n\t\t\tif (update.text3d?.hoverColor) {\n\t\t\t\tcoreUpdate.text3dHoverColor = update.text3d.hoverColor;\n\t\t\t}\n\t\t\tif (update.geometry?.hoverColor) {\n\t\t\t\tcoreUpdate.hoverColor = update.geometry.hoverColor;\n\t\t\t}\n\t\t\tif (update.backgroundColor || update.backgroundAlpha !== undefined) {\n\t\t\t\tconst backgroundColor = update.backgroundColor ?? this.#api.core.backgroundColor;\n\t\t\t\tconst backgroundAlpha = update.backgroundAlpha ?? this.#api.core.backgroundAlpha;\n\t\t\t\tthis.#api.core.setBackgroundColor(backgroundColor, backgroundAlpha);\n\t\t\t}\n\n\t\t\tif (update.environment != null) {\n\t\t\t\tthis.#api.core.setEnvironment(update.environment);\n\t\t\t}\n\n\t\t\tthis.#api.core.setState(coreUpdate);\n\t\t}\n\t}\n\n\t/**\n\t * The options passed in to the {@link show3dMap} method during initialization.\n\t */\n\tget options(): ReadonlyDeep<TShow3DMapOptions> {\n\t\treturn getPublicOptions(this.#api.currentMap.options);\n\t}\n\n\t/**\n\t * Get global state of the MapView\n\t */\n\tgetGlobalState(): ReadonlyDeep<GlobalState> {\n\t\tconst coreState = this.#api.core.getState();\n\n\t\treturn {\n\t\t\tbackgroundColor: this.#api.core.backgroundColor,\n\t\t\tbackgroundAlpha: this.#api.core.backgroundAlpha,\n\t\t\tenvironment: this.#api.core.getEnvironment(),\n\t\t\tgeometry: {\n\t\t\t\thoverColor: coreState.hoverColor,\n\t\t\t},\n\t\t\ttext3d: {\n\t\t\t\thoverColor: coreState.text3dHoverColor,\n\t\t\t},\n\t\t};\n\t}\n\n\t/**\n\t * Triggers a manual update of the map view.\n\t *\n\t * Forces the map to re-render. This is typically not needed as the map updates automatically, but can be useful in certain edge cases.\n\t *\n\t * @example\n\t * ```ts\n\t * // Force map update after external changes\n\t * mapView.update();\n\t * ```\n\t */\n\tupdate = () => {\n\t\tthis.#api.core.render();\n\t};\n\n\t/**\n\t * Gets the current map data associated with this view.\n\t *\n\t * @returns The current MapData instance, or undefined if no map is loaded.\n\t * @example\n\t * ```ts\n\t * const mapData = mapView.getMapData();\n\t * if (mapData) {\n\t *   console.log('Map name:', mapData.mapName);\n\t *   const spaces = mapData.getByType('space');\n\t *   console.log('Number of spaces:', spaces.length);\n\t * }\n\t * ```\n\t */\n\tgetMapData() {\n\t\tif (this.#api.mapData == null) {\n\t\t\tthrow new MappedinError('MapData not found.');\n\t\t}\n\t\treturn this.#api.mapData;\n\t}\n\n\t/**\n\t * Gets the current dimensions of the map container.\n\t *\n\t * @returns An object containing the width and height of the map container.\n\t * @example\n\t * ```ts\n\t * const dimensions = mapView.getDimensions();\n\t * console.log(`Map size: ${dimensions.width}x${dimensions.height}`);\n\t * ```\n\t */\n\tgetDimensions() {\n\t\treturn { width: this.#core.canvasWidth, height: this.#core.canvasHeight };\n\t}\n\n\t/**\n\t * Adds a map to the MapView.\n\t * @param mapData The map data to add.\n\t * @returns A promise that resolves with the added map data.\n\t * @hidden\n\t */\n\taddMap(mapData: MapData, options?: TShow3DMapOptions): Promise<MapData> {\n\t\treturn this.#api.addMap(mapData, options);\n\t}\n\n\t/**\n\t * Sets the current floor of the map.\n\t *\n\t * Changes the visible floor and updates the camera to focus on the new floor.\n\t *\n\t * @param floor The floor to set, either as a Floor object or floor ID string.\n\t * @param options Optional configuration for the floor change.\n\t * @returns A promise that resolves when the floor change is complete.\n\t *\n\t * @example Set floor by object\n\t * ```ts\n\t * const floors = mapData.getByType('floor');\n\t * const groundFloor = floors.find(f => f.elevation === 0);\n\t * if (groundFloor) {\n\t *   await mapView.setFloor(groundFloor);\n\t * }\n\t * ```\n\t *\n\t * @example Set floor by ID\n\t * ```ts\n\t * await mapView.setFloor('floor-1');\n\t * ```\n\t */\n\tsetFloor(floor: Floor | string, options?: TSetFloorOptions) {\n\t\treturn this.#api.setFloor(floor, options?.context);\n\t}\n\n\t/**\n\t * Sets the current ({@link FloorStack}) of the map.\n\t *\n\t * Changes to a specific floor stack, which may contain multiple floors for complex buildings.\n\t *\n\t * @param floorStack The floor stack to set, either as a ({@link FloorStack}) object or ID string.\n\t * @param options Optional configuration for the floor stack change defined in ({@link TSetFloorOptions}).\n\t * @returns A promise that resolves when the floor stack change is complete.\n\t *\n\t * @example Set floor stack\n\t * ```ts\n\t * const floorStacks = mapData.getByType('floor-stack');\n\t * const mainBuilding = floorStacks.find(fs => fs.name === 'Main Building');\n\t * if (mainBuilding) {\n\t *   await mapView.setFloorStack(mainBuilding);\n\t * }\n\t * ```\n\t */\n\tsetFloorStack(floorStack: FloorStack | string, options?: TSetFloorOptions) {\n\t\treturn this.#api.setFloorStack(floorStack, options?.context);\n\t}\n\n\t/**\n\t * Preload floor geometry and outlines for the map at runtime. Can be used when anticipating a large number of floors will be visible at once to\n\t * keep the map responsive.\n\t * @param floors The floors to preload.\n\t */\n\tpreloadFloors(floors: Floor[]) {\n\t\tthis.#api.preloadFloors(floors);\n\t}\n\n\t/**\n\t * Create a tween object that will be updated on every render frame.\n\t * See https://tweenjs.github.io/tween.js/docs/user_guide.html for more information.\n\t *\n\t * When creating a large number of tween objects, it may be important to call {@link MapView.removeTween | removeTween} to prevent memory leaks.\n\t *\n\t * @param object The data to be tweened.\n\t * @returns The tween object.\n\t */\n\ttween<T extends Record<string, unknown>>(object: T) {\n\t\treturn this.#api.tween<T>(object);\n\t}\n\n\t/**\n\t * Remove a tween created with {@link MapView.tween | tween}.\n\t * @param tween The tween to remove.\n\t */\n\tremoveTween(tween: Tween<any>) {\n\t\tthis.#api.removeTween(tween);\n\t}\n\n\t/**\n\t * The group which manages all tweens created with {@link MapView.tween | tween} or {@link MapView.animateState | animateState}.\n\t */\n\tget tweenGroup() {\n\t\treturn this.#api.tweenGroup();\n\t}\n\n\t/**\n\t * Gets the current ({@link FloorStack}).\n\t *\n\t * @returns The current FloorStack, or undefined if no floor stack is set.\n\t * @example\n\t * ```ts\n\t * const currentStack = mapView.currentFloorStack;\n\t * if (currentStack) {\n\t *   console.log('Current floor stack:', currentStack.name);\n\t * }\n\t * ```\n\t */\n\tget currentFloorStack() {\n\t\treturn this.#api.currentFloorStack;\n\t}\n\n\t/**\n\t * Gets the current ({@link Floor}) of the map.\n\t *\n\t * @returns The current Floor, or undefined if no floor is set.\n\t * @example\n\t * ```ts\n\t * const currentFloor = mapView.currentFloor;\n\t * if (currentFloor) {\n\t *   console.log('Current floor:', currentFloor.name);\n\t *   console.log('Floor level:', currentFloor.level);\n\t * }\n\t * ```\n\t */\n\tget currentFloor() {\n\t\treturn this.#api.currentFloor;\n\t}\n\n\t/**\n\t * Updates the watermark on the map.\n\t *\n\t * @param options {WatermarkOptions}\n\t * @hidden\n\t */\n\tupdateWatermark(options: WatermarkUpdateOptions) {\n\t\tthis.#api.updateWatermark(options);\n\t}\n\n\t/**\n\t * Gets the current state of a map element.\n\t *\n\t * Retrieves the current visual properties and state of a map element.\n\t *\n\t * @param target The map element to get the state for.\n\t * @returns The current state of the element.\n\t *\n\t * @example Get space state\n\t * ```ts\n\t * const space = mapData.getById('space', 'space-123');\n\t * if (space) {\n\t *   const state = mapView.getState(space);\n\t *   console.log('Space color:', state.color);\n\t *   console.log('Space opacity:', state.opacity);\n\t * }\n\t * ```\n\t *\n\t * @example Get marker state\n\t * ```ts\n\t * const marker = mapView.Markers.add(coordinate);\n\t * const state = mapView.getState(marker);\n\t * console.log('Marker rank:', state.rank);\n\t * console.log('Marker placement:', state.placement);\n\t * ```\n\t */\n\tgetState<T extends MapElementsWithState>(target: T): TGetState<T> {\n\t\treturn this.#api.getState(target);\n\t}\n\n\t/**\n\t * Sets the hover color for map elements.\n\t *\n\t * @param c The color to use for hover effects.\n\t * @example\n\t * ```ts\n\t * mapView.setHoverColor('#ff0000');\n\t * ```\n\t */\n\tsetHoverColor(c: string) {\n\t\tthis.#api.setHoverColor(c);\n\t}\n\n\t/**\n\t * Gets the current hover color.\n\t *\n\t * @returns The current hover color.\n\t * @example\n\t * ```ts\n\t * const hoverColor = mapView.getHoverColor();\n\t * console.log('Hover color:', hoverColor);\n\t * ```\n\t */\n\tgetHoverColor() {\n\t\treturn this.#api.getHoverColor();\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconvertAltitudeToMercatorZoomLevel(altitude: number) {\n\t\treturn this.#api.core.getSystems().cameraSystem.convertAltitudeToZoomLevel(altitude);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconvertMercatorZoomLevelToAltitude(zoomLevel: number) {\n\t\treturn this.#api.core.getSystems().cameraSystem.convertZoomLevelToAltitude(zoomLevel);\n\t}\n\n\t/**\n\t * Determines if a given target is within the viewport.\n\t *\n\t * This method checks if the specified target, such as a Space, MapObject, Label, Marker, or string identifier,\n\t * is currently within the visible area of the map viewport. Note that this method returns `true` even if the\n\t * target is not visible (e.g., its visibility is set to false).\n\t *\n\t * @param target - The target to check for viewport inclusion. This can be a Space, MapObject, Label, Marker, or string identifier.\n\t * @returns A boolean indicating whether the target is within the viewport.\n\t */\n\tisInView(target: Space | MapObject | Label | Marker | string) {\n\t\treturn this.#api.isInView(target);\n\t}\n\n\t/**\n\t * Gets the map elements that are currently in view.\n\t *\n\t * @param type The type of map element to get.\n\t * @param options Optional configuration for the in view check.\n\t * @returns An array of map elements that are currently in view.\n\t */\n\tgetInView<T extends string>(type: T, options?: TGetInViewOptions): MapFeatureOfType<T>[] {\n\t\treturn this.#api.getInView(type, options);\n\t}\n\n\t/**\n\t * Returns the current scale of the map in meters per pixel.\n\t * @returns\n\t * @example\n\t * ```ts\n\t * const metersPerPixel = mapView.getMetersPerPixel();\n\t * console.log('Meters per pixel:', metersPerPixel);\n\t * ```\n\t */\n\tgetMetersPerPixel() {\n\t\treturn this.#api.core.getMetersPerPixel();\n\t}\n\n\t/**\n\t * @deprecated Use the async version instead. This method will be made truly async in the upcoming future.\n\t * @internal\n\t */\n\t__LEGACY_GET_DIRECTIONS_SYNC = (\n\t\tfrom: TNavigationTarget | TNavigationTarget[],\n\t\tto: TNavigationTarget | TNavigationTarget[],\n\t\toptions?: TGetDirectionsOptions,\n\t): Directions | undefined => {\n\t\treturn this.#api.getMapData()?.__LEGACY_GET_DIRECTIONS_SYNC(from, to, options) ?? undefined;\n\t};\n\n\t/**\n\t * Calculates ({@link Directions}) from one navigable point ({@link TNavigationTarget}) to another on the map.\n\t *\n\t * Provides turn-by-turn navigation instructions and route visualization. This method delegates to the MapData instance.\n\t *\n\t * @note In enterprise mode, path smoothing is disabled by default. Use the `smoothing` option to explicitly enable it if needed.\n\t *\n\t * @param from The starting location(s).\n\t * @param to The destination location(s).\n\t * @param options Optional configuration for the directions calculation.\n\t * @returns A Promise resolving to a {@link Directions} object containing the route, or undefined if no route is found.\n\t *\n\t * @example Get directions between spaces\n\t * ```ts\n\t * const space1 = mapData.getById('space', 'space-123');\n\t * const space2 = mapData.getById('space', 'space-456');\n\t *\n\t * if (space1 && space2) {\n\t *   const directions = await mapView.getDirections(space1, space2);\n\t *   if (directions) {\n\t *     // Show the route on the map\n\t *     mapView.Paths.show(directions);\n\t *     console.log(`Distance: ${directions.distance}m`);\n\t *   }\n\t * }\n\t * ```\n\t *\n\t * @see [Wayfinding Guide](https://developer.mappedin.com/web-sdk/wayfinding)\n\t */\n\tgetDirections = (\n\t\tfrom: TNavigationTarget | TNavigationTarget[],\n\t\tto: TNavigationTarget | TNavigationTarget[],\n\t\toptions?: TGetDirectionsOptions,\n\t): Promise<Directions | undefined> => {\n\t\treturn this.#api.getMapData()?.getDirections(from, to, options) ?? Promise.resolve(undefined);\n\t};\n\n\t/**\n\t * Calculates directions ({@link Directions}) from one navigable point ({@link TNavigationTarget}) to multiple destination points on the map synchronously.\n\t *\n\t * Provides routes from a single starting point to multiple destinations. This method delegates to the MapData instance.\n\t *\n\t * @param from The starting location.\n\t * @param to An array of destination locations or arrays of destinations.\n\t * @param options Optional configuration for the directions calculation.\n\t * @returns An array of {@link Directions} objects, one for each destination.\n\t *\n\t * @example Get directions to multiple destinations\n\t * ```ts\n\t * const start = mapData.getById('space', 'entrance');\n\t * const destinations = [\n\t *   mapData.getById('space', 'store-1'),\n\t *   mapData.getById('space', 'store-2'),\n\t *   mapData.getById('space', 'restaurant')\n\t * ].filter(Boolean);\n\t *\n\t * const allDirections = mapView.getDirectionsMultiDestinationSync(start, destinations);\n\t * allDirections.forEach((directions, index) => {\n\t *   console.log(`Route ${index + 1}: ${directions.distance}m`);\n\t * });\n\t * ```\n\t *\n\t * @deprecated Use the async version instead. This method will be made truly async in the upcoming future.\n\t * @internal\n\t */\n\t__LEGACY_GET_DIRECTIONS_MULTI_DESTINATION_SYNC = (\n\t\tfrom: TNavigationTarget,\n\t\tto: (TNavigationTarget | TNavigationTarget[])[],\n\t\toptions?: TGetDirectionsOptions,\n\t): Directions[] | undefined => {\n\t\treturn this.#api.getMapData()?.__LEGACY_GET_DIRECTIONS_MULTI_DESTINATION_SYNC(from, to, options) ?? undefined;\n\t};\n\n\t/**\n\t * Calculates directions ({@link Directions}) from one navigable point ({@link TNavigationTarget}) to multiple destination points on the map.\n\t *\n\t * Provides routes from a single starting point to multiple destinations. This method delegates to the MapData instance.\n\t *\n\t * @note In enterprise mode, path smoothing is disabled by default. Use the `smoothing` option to explicitly enable it if needed.\n\t *\n\t * @param from The starting location.\n\t * @param to An array of destination locations or arrays of destinations.\n\t * @param options Optional configuration for the directions calculation.\n\t * @returns A Promise resolving to an array of {@link Directions} objects, one for each destination.\n\t *\n\t * @example Get directions to multiple destinations\n\t * ```ts\n\t * const start = mapData.getById('space', 'entrance');\n\t * const destinations = [\n\t *   mapData.getById('space', 'store-1'),\n\t *   mapData.getById('space', 'store-2'),\n\t *   mapData.getById('space', 'restaurant')\n\t * ].filter(Boolean);\n\t *\n\t * const allDirections = await mapView.getDirectionsMultiDestination(start, destinations);\n\t * allDirections.forEach((directions, index) => {\n\t *   console.log(`Route ${index + 1}: ${directions.distance}m`);\n\t * });\n\t * ```\n\t */\n\tgetDirectionsMultiDestination = (\n\t\tfrom: TNavigationTarget,\n\t\tto: (TNavigationTarget | TNavigationTarget[])[],\n\t\toptions?: TGetDirectionsOptions,\n\t): Promise<Directions[] | undefined> => {\n\t\treturn this.#api.getMapData()?.getDirectionsMultiDestination(from, to, options) ?? Promise.resolve(undefined);\n\t};\n\n\t/**\n\t * Calculates the walking distance between two navigable points ({@link TNavigationTarget}) on the map.\n\t *\n\t * Returns the walking distance between two points. This method delegates to the MapData instance.\n\t *\n\t * @param from The starting location.\n\t * @param to The destination location.\n\t * @returns The distance in meters.\n\t *\n\t * @example Calculate distance between spaces\n\t * ```ts\n\t * const space1 = mapData.getById('space', 'space-123');\n\t * const space2 = mapData.getById('space', 'space-456');\n\t *\n\t * if (space1 && space2) {\n\t *   const distance = mapView.getDistance(space1, space2);\n\t *   console.log(`Direct distance: ${distance}m`);\n\t * }\n\t * ```\n\t *\n\t * @example Calculate distance from coordinate\n\t * ```ts\n\t * const coordinate = mapData.mapCenter;\n\t * const space = mapData.getByType('space')[0];\n\t * const distance = mapView.getDistance(coordinate, space);\n\t * console.log(`Distance from center: ${distance}m`);\n\t * ```\n\t */\n\tgetDistance(\n\t\tfrom: Space | Door | Coordinate | MapObject | PointOfInterest | Annotation | Node | EnterpriseLocation,\n\t\tto: Space | Door | Coordinate | MapObject | PointOfInterest | Annotation | Node | EnterpriseLocation,\n\t) {\n\t\treturn this.#api.getMapData()?.getDistance(from, to);\n\t}\n\n\t/**\n\t * Creates a {@link Coordinate} on the map.\n\t *\n\t * @param latitude The latitude of the coordinate.\n\t * @param longitude The longitude of the coordinate.\n\t * @param floor Optional floor information if applicable.\n\t * @returns The created Coordinate object.\n\t * @example\n\t * // Create a coordinate at the CN Tower.\n\t * const coord = map.createCoordinate(43.642567, -79.387054);\n\t *\n\t * // Alternatively, you can directly use the Coordinate constructor:\n\t * import { Coordinate } from '@mappedin/mappedin-js';\n\t * const coord = new Coordinate(43.642567, -79.387054, floor?.id);\n\t */\n\tcreateCoordinate(latitude: number, longitude: number, floor?: Floor): Coordinate;\n\t/**\n\t * Creates a {@link Coordinate} on the map using a params object.\n\t *\n\t * @param params An object containing the coordinate parameters.\n\t * @param params.latitude The latitude of the coordinate in decimal degrees.\n\t * @param params.longitude The longitude of the coordinate in decimal degrees.\n\t * @param params.floorId Optional ID of the floor this coordinate is on.\n\t * @param params.verticalOffset Optional vertical offset from the floor in meters.\n\t * @returns The created Coordinate object.\n\t * @example\n\t * // Create a coordinate at the CN Tower using params object.\n\t * const coord = map.createCoordinate({\n\t *   latitude: 43.642567,\n\t *   longitude: -79.387054\n\t * });\n\t *\n\t * // Alternatively, you can directly use the Coordinate constructor:\n\t * import { Coordinate } from '@mappedin/mappedin-js';\n\t * const coord = new Coordinate({\n\t *   latitude: 43.642567,\n\t *   longitude: -79.387054,\n\t *   floorId: 'floor1',\n\t *   verticalOffset: 10\n\t * });\n\t */\n\tcreateCoordinate(params: TCoordinateParams): Coordinate;\n\tcreateCoordinate(latitudeOrParams: number | TCoordinateParams, longitude?: number, floor?: Floor): Coordinate {\n\t\tif (typeof latitudeOrParams === 'object') {\n\t\t\treturn new Coordinate(latitudeOrParams);\n\t\t}\n\n\t\treturn new Coordinate(latitudeOrParams, longitude!, floor?.id);\n\t}\n\n\t/**\n\t * Create a {@link Coordinate} from an X and Y position measured in pixels from the top left\n\t * corner of the map canvas.\n\t *\n\t * @experimental\n\t */\n\tcreateCoordinateFromScreenCoordinate(x: number, y: number, floor?: Floor) {\n\t\treturn this.#api.createCoordinateFromScreenCoordinate(x, y, floor);\n\t}\n\n\t/**\n\t * Get the X and Y of a {@link Coordinate} measured from the top left corner of the map canvas.\n\t *\n\t * @experimental\n\t */\n\tgetScreenCoordinateFromCoordinate(coordinate: Coordinate) {\n\t\treturn this.#api.getScreenCoordinateFromCoordinate(coordinate);\n\t}\n\n\t/**\n\t * @experimental\n\t * @warning **EXPERIMENTAL FEATURE UNDER CONSTRUCTION**\n\t *\n\t * This is an experimental feature that may undergo significant changes,\n\t * including breaking changes, renaming, or complete removal in future versions.\n\t * Do not rely on this API in production environments.\n\t *\n\t * Currently provides basic auto-labeling functionality for map elements.\n\t * Future versions may include comprehensive theming and auto-setup features.\n\t *\n\t * @returns An object containing auto-created labels\n\t */\n\t__EXPERIMENTAL__auto() {\n\t\treturn this.#api.__EXPERIMENTAL__auto();\n\t}\n\n\t/**\n\t * Subscribe a function to an event.\n\t *\n\t * @param eventName An event name which, when fired, will call the provided\n\t * function.\n\t * @param fn A callback that gets called when the corresponding event is fired. The\n\t * callback will get passed an argument with a type that's one of event payloads.\n\t * @example\n\t * // Subscribe to the 'click' event\n\t * const handler = (event) => {\n\t *  const { coordinate } = event;\n\t *  const { latitude, longitude } = coordinate;\n\t * \tconsole.log(`Map was clicked at ${latitude}, ${longitude}`);\n\t * };\n\t * mapView.on('click', handler);\n\t */\n\ton = <EventName extends keyof TEvents>(eventName: EventName, fn: (payload: TEventPayload<EventName>) => void) => {\n\t\tthis.#pubSub.on(eventName, fn);\n\t};\n\n\t/**\n\t * Unsubscribe a function previously subscribed with {@link on}\n\t *\n\t * @param eventName An event name to which the provided function was previously\n\t * subscribed.\n\t * @param fn A function that was previously passed to {@link on}. The function must\n\t * have the same reference as the function that was subscribed.\n\t * @example\n\t * // Unsubscribe from the 'click' event\n\t * const handler = (event) => {\n\t *  const { coordinate } = event;\n\t *  const { latitude, longitude } = coordinate;\n\t * \tconsole.log(`Map was clicked at ${latitude}, ${longitude}`);\n\t * };\n\t * mapView.off('click', handler);\n\t */\n\toff = <EventName extends keyof TEvents>(eventName: EventName, fn: (payload: TEventPayload<EventName>) => void) => {\n\t\tthis.#pubSub.off(eventName, fn);\n\t};\n\n\t/**\n\t * @internal\n\t */\n\tget __core() {\n\t\tif (process.env['INTERNAL'] === 'true') {\n\t\t\treturn this.#api.core;\n\t\t}\n\t\tthrow new Error('__core is not available.');\n\t}\n\n\t/**\n\t * The container element of the map.\n\t */\n\tget container() {\n\t\treturn this.#core.container;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublishAllState() {\n\t\tthis.#api.publishAllState();\n\t}\n\n\t/**\n\t * Clears all added elements from the map.\n\t */\n\tclear() {\n\t\tthis.#api.clear();\n\t}\n\n\t/**\n\t * Destroys the MapView.\n\t */\n\tdestroy() {\n\t\tthis.#api.destroy();\n\t}\n\n\t/**\n\t * @experimental\n\t * Enable debug interface. Learn more about the debug interface in the [Debug Mode Guide](https://developer.mappedin.com/web-sdk/getting-started#debug-mode).\n\t */\n\tasync enableDebug(opitons: InspectorOption = {}) {\n\t\tconst { Inspector } = await import('./api-geojson/inspector');\n\t\tconst inspector = new Inspector(this, this.#api);\n\t\tawait inspector.enable(opitons);\n\t}\n\n\t/**\n\t * @experimental\n\t * @internal\n\t */\n\tDebug: Debug;\n\n\t/**\n\t * Takes a screenshot of the current scene and returns it as a data URL.\n\t *\n\t * NOTE: This only captures the 3D scene, and optionally the outdoor context, not the UI elements like labels, markers, etc.\n\t * Also, this does not cause the screenshot to be saved to the user's device, it only returns\n\t * the data.\n\t *\n\t * @param options - Options for taking a screenshot.\n\t * @param options.withOutdoorContext - Whether to include the outdoor context in the screenshot.\n\t * @default false\n\t *\n\t * @returns A Promise that resolves with the screenshot as a base64-encoded data URL string\n\t * @experimental\n\t */\n\tasync takeScreenshot(options?: TTakeScreenshotOptions): Promise<string> {\n\t\tconst takeScreenshotOptions = {\n\t\t\twithOutdoorContext: options?.withOutdoorContext ?? false,\n\t\t};\n\n\t\tconst indoorCanvas = this.#core.rendererDomElement;\n\n\t\tif (takeScreenshotOptions.withOutdoorContext) {\n\t\t\tconst outdoorMap = this.#core.map;\n\n\t\t\tif (!outdoorMap) {\n\t\t\t\tawait this.#core.renderSync();\n\t\t\t\treturn indoorCanvas.toDataURL('image/png');\n\t\t\t}\n\n\t\t\tif (!outdoorMap.loaded()) {\n\t\t\t\tawait new Promise(resolve => {\n\t\t\t\t\toutdoorMap.once('idle', resolve);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst outdoorCanvas = outdoorMap.getCanvas();\n\n\t\t\tconst compositeCanvas = document.createElement('canvas');\n\t\t\tconst compositeCtx = compositeCanvas.getContext('2d');\n\t\t\tcompositeCanvas.width = indoorCanvas.width;\n\t\t\tcompositeCanvas.height = indoorCanvas.height;\n\n\t\t\tif (!compositeCtx) {\n\t\t\t\tthrow new Error('Failed to get 2D context for composite canvas');\n\t\t\t}\n\n\t\t\tcompositeCtx.drawImage(outdoorCanvas, 0, 0, compositeCanvas.width, compositeCanvas.height);\n\t\t\tcompositeCtx.drawImage(indoorCanvas, 0, 0, compositeCanvas.width, compositeCanvas.height);\n\n\t\t\treturn compositeCanvas.toDataURL('image/png');\n\t\t}\n\n\t\tawait this.#core.renderSync();\n\t\treturn indoorCanvas.toDataURL('image/png');\n\t}\n\n\t/**\n\t * @internal\n\t * @hidden\n\t * Whether the floor visibility is being self managed or automatically handled by the SDK.\n\t */\n\tget manualFloorVisibility(): boolean {\n\t\treturn this.#api.manualFloorVisibility;\n\t}\n\n\t/**\n\t * @internal\n\t * @hidden\n\t * Disables the default behavior of the SDK to automatically hide floors on setFloor.\n\t */\n\tset manualFloorVisibility(value: boolean) {\n\t\tthis.#api.manualFloorVisibility = value;\n\t}\n\n\t/**\n\t * @internal\n\t * @hidden\n\t * @experimental\n\t * Computes the optimal visual distance between floors\n\t */\n\tgetOptimalVisualDistanceBetweenFloors(floors: Floor[]) {\n\t\treturn this.#api.getOptimalVisualDistanceBetweenFloors(floors);\n\t}\n\n\t/**\n\t * @internal\n\t * @deprecated For legacy use only\n\t *\n\t * If true, the map will hide paths not on the current floor.\n\t *\n\t * @default false\n\t */\n\tget __INTERNAL__hidePathsNotOnCurrentFloor(): boolean {\n\t\treturn this.#api.hidePathsNotOnCurrentFloor;\n\t}\n\n\t/**\n\t * @internal\n\t * @deprecated For legacy use only\n\t *\n\t * If true, the map will hide paths not on the current floor.\n\t *\n\t * @default false\n\t */\n\tset __INTERNAL__hidePathsNotOnCurrentFloor(value: boolean) {\n\t\tthis.#api.hidePathsNotOnCurrentFloor = Boolean(value);\n\t}\n}\n", "import './request-idle-callback-polyfill';\nimport type { MarkerState, AddMarkerOptions } from './components/marker';\nimport type { PathState, AddPathOptions } from './components/path';\nimport type { LabelState } from './components/label';\nimport type { AddLabelOptionsInternal, LabelAppearance, LabelTextPlacement } from './components/label-utils';\nimport type { GroupContainerState } from './entities/group-container';\nimport type { GeometryGroupState } from './entities/geometry-group';\nimport type { Position } from './types/geometry';\nimport type {\n\tInsetPadding,\n\tInsetPaddingOption,\n\tRendererCoreOptions,\n\tClickPayload,\n\tHoverPayload,\n\tCameraPayload,\n\tMapEvent,\n\tMapEventPayload,\n\tEnvMapOptions,\n\tInterpolation,\n\tColorString,\n\tInterpolateOn,\n\tBevelState,\n} from './types';\nimport type { GeometryState } from './components/mesh';\nimport type { ShapeState, CustomGeometryBuilder } from './components/custom';\nimport type { ModelState, UpdateModelState, InitializeModelState } from './components/model';\nimport RendererCore, { DEFAULT_ZOOM_LEVEL, DEFAULT_PITCH, DEFAULT_BEARING, type MapViewState } from './renderer';\nimport type { Camera, AnimateToOptions, FocusOnOptions } from './camera';\nimport Logger from '../../packages/common/Mappedin.Logger';\nimport type { LngLatLike, MapDataEvent, MapStyleDataEvent } from '../../packages/outdoor-context-v5';\nimport { createCustomLayer, getPixelRatio, getRequestHeaders, transformRequest } from './utils';\nimport { mountSceneGraphVisualizer } from '../examples/src/utils/scene-graph-visualizer'; // reach in to avoid touching the init.ts file in the example utils\nimport '../../packages/outdoor-context-v5/css/maplibre-gl.css';\nimport type { CollisionRankingTier } from './utils/collision-ranking-tier';\nexport type { Text3DState } from './components/text3d';\nexport { TEXT3D_STYLE_UPDATE_PROPS } from './entities/utils';\nexport { Navigator } from '../../packages/geojson-navigator';\nexport { interpolate, debounce } from '@packages/internal/common';\nexport { MAPPEDIN_LAYER_ID, MAPLIBRE_WORKER_PATH, COLLISION_WORKER_PATH } from './utils/constants';\nexport type { DebugState, Debug } from './utils/debug';\nimport { setWorkerUrl } from '@packages/internal/outdoor-context-v5';\nexport type { ImageState } from './components/image';\nexport type { OptionalRemap, Remap } from './types/utils';\nimport { Map as MapLibreMap, MercatorCoordinate } from '../../packages/outdoor-context-v5';\n\nconst url = 'https://tiles-cdn.mappedin.com/styles/mappedin/style.json';\nconst authURL = 'https://auth.mappedin.com/oauth2/token';\n\n/**\n * Enable test mode for the renderer. This will disable the WebGLRenderer and WebGL1Renderer and replace them with a dummy object\n * so you can run tests against it\n */\nexport { enableTestMode } from './services/test-mode';\n// export { convertCollisionRankingTeirToNumber, convertRankToCollisionRankingTier } from './components/label';\nexport { mountSceneGraphVisualizer };\nexport type {\n\tEntityId,\n\tEntityState,\n\tLineStyle,\n\tPaintStyle,\n\tModelProperties,\n\tShading,\n\tImagePlacementOptions,\n} from './types';\n\nexport type * from 'geojson';\n\nexport let maplibreWorkerUrl = '';\n\nexport function setMaplibreWorkerUrl(url: string) {\n\tmaplibreWorkerUrl = url;\n\tsetWorkerUrl(url);\n}\n\nexport let collisionWorkerUrl = '';\n/**\n * Sets the URL for the collision system worker script.\n *\n * This function allows specifying a custom URL for the collision system's web worker,\n * which is particularly useful in environments with strict Content Security Policy (CSP)\n * that don't allow blob: URLs or inline scripts.\n *\n * When provided, the collision system will load its worker from the specified URL\n * instead of creating an inline worker from a blob. This enables compatibility with\n * environments that have restrictive CSP settings.\n *\n * @param url - The absolute URL pointing to the collision worker script.\n *              This should be a URL where the compiled version of the worker.ts file is hosted.\n *\n * @example\n * ```typescript\n * // Set a custom URL for the collision worker\n * import { setWorkerUrl } from '@mappedin/core-sdk';\n *\n * // Must be called before initializing any maps\n * setWorkerUrl('https://cdn.example.com/workers/collision-worker.js');\n * ```\n *\n * @remarks\n * - This function must be called before any map instances are created\n * - The worker file must be built and hosted separately as part of your deployment process\n * - Ideal for applications that need to comply with strict CSP requirements\n */\nexport function setCollisionWorkerUrl(url: string) {\n\tcollisionWorkerUrl = url;\n}\n\nexport type { WatermarkUpdateOptions, WatermarkOptions, WatermarkPosition } from './systems/watermark/system';\nexport type { CameraSystemState } from './systems/camera/system';\nexport type { PanBounds } from './systems/camera/types';\nexport { preloadFont, configureWorker } from './systems/text3d/system';\nexport type { GLTFExportOptions } from './systems/exporter';\nexport type { AttributionControlOptions, AttributionPosition } from './systems/html-controls/system';\nexport type { Text3DStyle, ModelStyle } from './components/styles';\nexport type { AddText3DOptions, InitializeText3DState, UpdatableText3DState } from './components/text3d';\nexport { ATTRIBUTION_POSITIONS } from './systems/html-controls/system';\nexport { ANIMATION_TWEENS } from './camera';\n\nexport type {\n\tAddPathOptions,\n\tAddMarkerOptions,\n\tAddLabelOptionsInternal,\n\tAnimateToOptions,\n\tFocusOnOptions,\n\tMapViewState,\n\tMarkerState,\n\tPathState,\n\tGroupContainerState,\n\tGeometryGroupState,\n\tShapeState,\n\tCustomGeometryBuilder,\n\tLabelState,\n\tGeometryState,\n\tModelState,\n\tUpdateModelState,\n\tInitializeModelState,\n\tCamera,\n\tInsetPadding,\n\tInsetPaddingOption,\n\tPosition,\n\tClickPayload,\n\tHoverPayload,\n\tCameraPayload,\n\tMapEvent,\n\tMapEventPayload,\n\tCollisionRankingTier,\n\tLabelAppearance,\n\tLabelTextPlacement,\n\tRendererCore,\n\tEnvMapOptions,\n\tRendererCoreOptions,\n\tInterpolation,\n\tColorString,\n\tInterpolateOn,\n\tBevelState,\n};\n\nexport async function createRenderer(container: HTMLElement, options?: RendererCoreOptions & { [key: string]: any }) {\n\tconst useWorkers = options?.useWorkers ?? true;\n\n\tconst coreOptions = {\n\t\t...options,\n\t\twatermark: options?.watermark,\n\t\tattribution: options?.attribution,\n\t\tantialias: options?.antialias,\n\t\tocclusionEnabled: options?.occlusionEnabled,\n\t\ttransformImageRequest: options?.transformImageRequest,\n\t\tnaturalBearing: options?.naturalBearing ?? 0,\n\t\timagePlacementOptions: options?.imagePlacementOptions,\n\t\tonWebGLContextCreationError: options?.onWebGLContextCreationError,\n\t\tonWebGLContextLost: options?.onWebGLContextLost,\n\t\tonWebGLContextRestored: options?.onWebGLContextRestored,\n\t\tonWebGLRendererError: options?.onWebGLRendererError,\n\t\tuseStandaloneCamera: options?.useStandaloneCamera ?? false,\n\t\tuseCollisionWorker: options?.useCollisionWorker ?? true,\n\t\tuseWorkers,\n\t};\n\n\tif (useWorkers === true && options?.outdoorView?.enabled) {\n\t\tlet headers = options.outdoorView.headers;\n\t\tif (headers == null) {\n\t\t\theaders = await getRequestHeaders(authURL);\n\t\t}\n\n\t\tconst center = (options.center || [0, 0]) as LngLatLike;\n\n\t\tconst map = new MapLibreMap({\n\t\t\tcontainer,\n\t\t\tstyle: options.outdoorView.style || url,\n\t\t\tcenter,\n\t\t\tattributionControl: false, // we handle this ourselves\n\t\t\tzoom: options.zoomLevel ?? DEFAULT_ZOOM_LEVEL,\n\t\t\tpitch: options.pitch ?? DEFAULT_PITCH,\n\t\t\tbearing: options.bearing ?? DEFAULT_BEARING,\n\t\t\ttransformRequest: transformRequest(headers),\n\t\t\ttrackResize: false,\n\t\t\tpixelRatio: options.outdoorView.lowDpi ? 1 : getPixelRatio(),\n\t\t\tcanvasContextAttributes: {\n\t\t\t\tantialias: typeof options.antialias === 'boolean' ? options.antialias : true,\n\t\t\t\tpowerPreference: 'high-performance',\n\t\t\t},\n\t\t\tinteractive: false,\n\t\t\tvalidateStyle: false,\n\t\t\tcenterClampedToGround: false,\n\t\t\tboxZoom: false,\n\t\t\tdoubleClickZoom: false,\n\t\t\tscrollZoom: false,\n\t\t\tdragPan: false,\n\t\t\tdragRotate: false,\n\t\t\tkeyboard: false,\n\t\t\ttouchZoomRotate: false,\n\t\t});\n\n\t\tconst gl = map.painter.context.gl;\n\n\t\tconst core = new RendererCore(container, {\n\t\t\tcenter: center as Position,\n\t\t\tzoomLevel: map.getZoom(),\n\t\t\tpitch: map.getPitch(),\n\t\t\tbearing: map.getBearing(),\n\t\t\tgl: gl,\n\t\t\tmap: map,\n\t\t\tmode: 'outdoors-interleaved',\n\t\t\t...coreOptions,\n\t\t});\n\n\t\tconst cachedPosition = {\n\t\t\tcenter: map.getCenter().toArray() as LngLatLike,\n\t\t\tzoom: map.getZoom(),\n\t\t\tbearing: map.getBearing(),\n\t\t\tpitch: map.getPitch(),\n\t\t\televation: map.getCenterElevation(),\n\t\t};\n\n\t\tmap.setMinZoom(core.camera.minZoomLevel);\n\t\tmap.setMaxZoom(core.camera.maxZoomLevel);\n\t\tmap.setMaxPitch(core.camera.maxPitch);\n\t\tmap.setMinPitch(core.camera.minPitch);\n\n\t\tcore.on('camera-change', position => {\n\t\t\tcachedPosition.center = position.center as LngLatLike;\n\t\t\tcachedPosition.zoom = position.zoomLevel;\n\t\t\tcachedPosition.bearing = position.bearing;\n\t\t\tcachedPosition.pitch = position.pitch;\n\t\t\tcachedPosition.elevation = position.elevation;\n\t\t\tmap.jumpTo(cachedPosition);\n\t\t});\n\n\t\tconst modelAsMercatorCoordinate = MercatorCoordinate.fromLngLat(center as LngLatLike, 0);\n\n\t\t// @TODO: should viewCamera be exposed this way?\n\t\tconst layer = createCustomLayer(modelAsMercatorCoordinate, core.viewCamera, () => {\n\t\t\tcore.renderSync();\n\t\t});\n\n\t\tconst styleLoadHandler = async () => {\n\t\t\tif (!map) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tmap.addLayer(layer);\n\t\t\tcore.renderSync();\n\t\t};\n\t\tcore.onMapLibreEvent('style.load', styleLoadHandler);\n\n\t\tlet outdoorsLoaded = false; // will be true when outdoor view has finished loading in map.on('idle')\n\t\tlet outdoorStyleLoaded = false; // set to true in map.on('idle'), set back to false in map.on('styledata')\n\t\tconst idleHandler = () => {\n\t\t\tif (!map) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!outdoorsLoaded) {\n\t\t\t\tcore.publish('outdoor-view-loaded');\n\t\t\t\toutdoorsLoaded = true;\n\t\t\t}\n\t\t\tif (!outdoorStyleLoaded) {\n\t\t\t\toutdoorStyleLoaded = true;\n\t\t\t\t// we can't rely on style.load event, as it's not fired when the style changes\n\t\t\t\tcore.publish('outdoor-style-loaded');\n\t\t\t}\n\t\t};\n\t\tcore.onMapLibreEvent('idle', idleHandler);\n\n\t\tconst updateData = (e: MapDataEvent) => {\n\t\t\tif (\n\t\t\t\te &&\n\t\t\t\t(e.sourceDataType === 'metadata' ||\n\t\t\t\t\te.sourceDataType === 'visibility' ||\n\t\t\t\t\te.dataType === 'style' ||\n\t\t\t\t\te.type === 'terrain')\n\t\t\t) {\n\t\t\t\tcore.getSystems().htmlControlsSystem.updateData(map);\n\t\t\t}\n\t\t};\n\n\t\tconst styleDataHandler = (e: MapStyleDataEvent) => {\n\t\t\tif (map && e && e.dataType === 'style' && e.type === 'styledata') {\n\t\t\t\toutdoorStyleLoaded = false;\n\t\t\t}\n\t\t\tupdateData(e as unknown as MapDataEvent);\n\t\t};\n\t\tcore.onMapLibreEvent('styledata', styleDataHandler);\n\t\tcore.onMapLibreEvent('sourcedata', updateData);\n\t\tcore.onMapLibreEvent('terrain', updateData);\n\n\t\tconst errorHandler = (e: any) => {\n\t\t\tif (e.error?.url === url) {\n\t\t\t\tLogger.error(\n\t\t\t\t\t`Failed to load outdoor view style, possibly due to invalid token \"${headers['x-mappedin-tiles-key']}\"`,\n\t\t\t\t);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tLogger.warn(e);\n\t\t};\n\t\tcore.onMapLibreEvent('error', errorHandler);\n\n\t\treturn core;\n\t} else {\n\t\treturn new RendererCore(container, coreOptions);\n\t}\n}\n", "globalThis.requestIdleCallback =\n\tglobalThis.requestIdleCallback ||\n\tfunction (cb) {\n\t\tvar start = performance.now();\n\t\treturn setTimeout(function () {\n\t\t\tcb({\n\t\t\t\tdidTimeout: false,\n\t\t\t\ttimeRemaining: function () {\n\t\t\t\t\treturn Math.max(0, 50 - (performance.now() - start));\n\t\t\t\t},\n\t\t\t});\n\t\t}, 0);\n\t};\n\nglobalThis.cancelIdleCallback =\n\tglobalThis.cancelIdleCallback ||\n\tfunction (id) {\n\t\tclearTimeout(id);\n\t};\n", "/* global Float32Array Promise */\nimport './utils/object-this-polyfill';\nimport blaze_thick_compressed from './assets/blaze_thick_compressed.jpg';\nimport type { Texture } from 'three';\nimport {\n\tMathUtils,\n\tDirectionalLight,\n\tAmbientLight,\n\tMesh,\n\tMeshBasicMaterial,\n\tPlaneGeometry,\n\tObject3D,\n\tPerspectiveCamera,\n\tScene,\n\tVector2,\n\tVector3,\n\tRaycaster,\n\tCamera as ThreeCamera,\n\tBox3,\n\tFrustum,\n\tMatrix4,\n\tBatchedMesh,\n\tEquirectangularReflectionMapping,\n} from 'three';\n\nimport type { GroupContainerState } from './entities/group-container';\nimport { GroupContainerComponents, GroupContainerObject3D } from './entities/group-container';\n\nimport { assertType, isColor, Logger } from '@packages/internal/common';\nimport { PubSub } from '../../packages/common/pubsub';\nimport { Renderer } from './services/renderer';\n\nimport {\n\tcartesianToGeographic,\n\tmaplibreFrustrumCullHack,\n\tgeographicToCartesian,\n\tgetBoundingBoxCenter,\n\tgetCornersOfBoundingBox,\n\tgetGeometryByGeometryId,\n\tgetPixelRatio,\n\tisFiniteBox,\n\tshouldExpandZoomLevel,\n\tprojectToBox2D,\n\tdrawProjectedBox,\n\trectFromScreenOffsets,\n} from './utils';\nimport { Geometry3D, Geometry3DComponents } from './entities/geometry3d';\nimport { Geometry2DComponents, Geometry2D } from './entities/geometry2d';\nimport { CollisionSystem } from './systems/collisions/system';\nimport { InteractionSystem } from './systems/interactions';\nimport type { AddMarkerOptions, MarkerState, MarkerStateUpdate } from './components/marker';\nimport { MarkerComponent, validateMarker } from './components/marker';\nimport type { GLTFExportOptions } from './systems/exporter';\nimport { ExporterSystem } from './systems/exporter';\nimport type { LabelState } from './components/label';\nimport type { AddLabelOptionsInternal } from './components/label-utils';\nimport {\n\tDEFAULT_COLOR,\n\tDEFAULT_TEXT_STYLE,\n\tStyleComponent,\n\tText3DStyleComponent,\n\tDEFAULT_ROTATION,\n\tDEFAULT_SCALE,\n} from './components/styles';\nimport LabelComponent from './components/label';\nimport { validateLabel } from './components/label-utils';\nimport type {\n\tLineStyle,\n\tPaintStyle,\n\tRendererCoreOptions,\n\tPosition,\n\tEntity2DHTMLDivElementContainer,\n\tModelProperties,\n\tEntityState,\n\tEntityId,\n\tMapEvent,\n\tMapEventPayload,\n\tRendererState,\n\tEntityTypes,\n\tEnvMapOptions,\n\tInsetPadding,\n} from './types';\nimport { MeshCreationAndOptimizationSystem } from './systems/mesh-creation-and-optimization/system';\nimport { DOMVisibilitySystem } from './systems/dom-visiblity/system';\nimport { TwoDProjectionSystem } from './systems/2d-projection/system';\nimport { TwoDDrawSystem } from './systems/2d-draw/system';\nimport { DrawSystem } from './systems/draw/system';\nimport { TwoDVisibilitySystem } from './systems/2d-visibility/system';\nimport { RenderSystem } from './systems/render/system';\nimport type {\n\tPosition as GeoJsonPosition,\n\tFeatureCollection,\n\tLineString,\n\tMultiPolygon,\n\tPolygon,\n\tPoint,\n\tFeature,\n\tBBox,\n} from 'geojson';\nimport { debounce } from './utils/async';\nimport { randomId } from '../../packages/common/random-id';\nimport type { AddPathOptions, PathProperties, PathState, PathUpdateState } from './components/path';\nimport { PathComponent, validatePath } from './components/path';\nimport { CameraSystem, CAMERA_CONSTANTS } from './systems/camera';\nimport { DOMDrawSystem } from './systems/dom-draw/system';\nimport { type Map as MapLibreMap, type MapEventType as MapLibreMapEventType } from '../../packages/outdoor-context-v5';\nimport type { GeometryState } from './components/mesh';\nimport { MeshComponent } from './components/mesh';\nimport type { InteractionComponent } from './components/interaction';\nimport { ModelComponent, validateModelGroup } from './components/model';\nimport type { InitializeModelState, ModelState, UpdateModelState } from './components/model';\nimport type { GeometryGroupState } from './entities/geometry-group';\nimport { GeometryGroupObject3D } from './entities/geometry-group';\nimport { updateInteractivity } from './entities';\nimport { DOMResizeSystem } from './systems/dom-resize/system';\nimport { Camera } from './camera';\nimport { destroyObject3D } from './utils/object3d-destroy';\nimport { type WatermarkUpdateOptions, WatermarkSystem } from './systems/watermark/system';\nimport { PanBoundsSystem } from './systems/pan-bounds/system';\nimport { HTMLControlsSystem } from './systems/html-controls/system';\nimport { type CustomGeometryBuilder, CustomGeometryComponent, type ShapeState } from './components/custom';\nimport { CustomGeometrySystem } from './systems/custom-geometry/system';\nimport { OutlineInterpolationSystem } from './systems/outline-interpolation/system';\nimport { ImageSystem } from './systems/image/system';\nimport { GeometryInFocusSystem } from './systems/geometry-in-focus/system';\nimport {\n\tupdateAltitude,\n\tupdateColor,\n\tupdateEnabled,\n\tupdateFlipImageToFaceCamera,\n\tupdateGroupColor,\n\tupdateGroupShading,\n\tupdateHeight,\n\tupdateHoverColor,\n\tupdateImageProps,\n\tupdateIndividualGeometryOpacity,\n\tupdateIndividualGeometryTexture,\n\tupdateLabel,\n\tupdateMarker,\n\tupdateOpacity,\n\tupdateOutline,\n\tupdateParent,\n\tupdatePosition,\n\tupdateGroupTexture,\n\tupdateVisibility,\n\thandlePathUpdate,\n\tpickPathOptions,\n\tupdateHovered,\n\tupdateIndividualGeometryRenderOrder,\n\tupdateFocusable,\n\tassetGeometryIsText3D,\n\thandleText3DUpdate,\n\thandleModelStyleUpdate,\n\tupdateSide,\n\tupdateBorder,\n\tupdateEnableImageCollisions,\n\tupdateClippingPlane,\n} from './entities/utils';\nimport { convertNumberToCollisionRankingTier } from './utils/collision-ranking-tier';\nimport { OutdoorLayers } from './systems/outdoor-layers/system';\nimport { PathSystem } from './systems/path/';\nimport {\n\tImageComponent,\n\tvalidateImage,\n\ttype ImageProperties,\n\ttype ImageState,\n\ttype ImageStyle,\n} from './components/image';\nimport type { AddText3DOptions, Text3DProperties, Text3DState, UpdatableText3DState } from './components/text3d';\nimport { addText3DOptionsSchema, Text3DComponent } from './components/text3d';\nimport { MeshDetachmentSystem } from './systems/mesh-detachment/system';\nimport { MeshModificationSystem } from './systems/mesh-modification/system';\nimport { Text3DSystem } from './systems/text3d/system';\nimport { Group as TweenGroup } from '@tweenjs/tween.js';\nimport { Debug } from './utils/debug';\nimport { Occlusion2DSystem } from './systems/2d-occlusion/system';\nimport { TextureLoader } from './utils/texture-loader';\nimport { DEFAULT_INSET_PADDING, TAP_ZOOM_DURATION } from './utils/constants';\nimport { throttle } from '@packages/internal/outdoor-context-v5/util/throttle';\nimport type { FloatingFloorTextProperties } from '@mappedin/mvf-v2';\nimport type { OutlineComponent } from './components/outline';\nimport type { FocusableComponent } from './components/focusable';\nimport { GeometryDisposalSystem } from './systems/geometry-disposal/system';\nimport { TextureSystem } from './systems/texture/system';\nimport type { TextureComponent } from './components/texture';\nimport type { LiteralUnion } from 'type-fest';\nimport { Rectangle } from '@packages/internal/quad-tree';\nimport { BorderSystem } from './systems/border/system';\nimport { RenderOrderSystem } from './systems/render-order/system';\nimport { ClippingPlaneSystem } from './systems/clipping-plane/system';\nimport { ClippingPlaneComponent } from './components/clipping-plane';\n\nexport type * from './types';\nexport const raycaster = new Raycaster();\n\n/**\n * Some preset orderings for updates.\n */\nexport const UPDATE_ORDERING = {\n\tBEFORE_CAMERA: 5,\n\tCAMERA: 4,\n\tAFTER_CAMERA: 3,\n\tRENDER: 2,\n\tAFTER_RENDER: 1,\n\tAFTER_ALL_UPDATES: 0,\n};\nexport const { DEFAULT_PITCH, DEFAULT_BEARING, DEFAULT_ZOOM_LEVEL, DEFAULT_MIN_ZOOM_LEVEL, DEFAULT_MAX_ZOOM_LEVEL } =\n\tCAMERA_CONSTANTS;\n\n/** This must align with Maplibre's FOV */\nconst FIELD_OF_VIEW = MathUtils.radToDeg(0.6435011087932844); // ~ 37 degrees\n\nexport type Systems = {\n\tcameraSystem: CameraSystem;\n\tpanBoundsSystem: PanBoundsSystem;\n\tcollisionSystem: CollisionSystem;\n\tinteractionSystem: InteractionSystem;\n\tmeshOptimizationSystem: MeshCreationAndOptimizationSystem;\n\tdomVisiblitySystem: DOMVisibilitySystem;\n\tdomMutationSystem: DOMResizeSystem;\n\tdomDrawSystem: DOMDrawSystem;\n\ttwoDProjectionSystem: TwoDProjectionSystem;\n\ttwoDDrawSystem: TwoDDrawSystem;\n\tdrawSystem: DrawSystem;\n\ttwoDVisiblitySystem: TwoDVisibilitySystem;\n\trenderSystem: RenderSystem;\n\twatermarkSystem: WatermarkSystem;\n\thtmlControlsSystem: HTMLControlsSystem;\n\texporterSystem: ExporterSystem;\n\tcustomGeometrySystem: CustomGeometrySystem;\n\toutlineInterpolationSystem: OutlineInterpolationSystem;\n\toutdoorLayersSystem: OutdoorLayers;\n\tpathSystem: PathSystem;\n\timageSystem: ImageSystem;\n\tgeometryInFocusSystem: GeometryInFocusSystem;\n\tmeshDetachmentSystem: MeshDetachmentSystem;\n\tmeshModificationSystem: MeshModificationSystem;\n\ttext3DSystem: Text3DSystem;\n\tocclusion2DSystem: Occlusion2DSystem;\n\tgeometryDisposalSystem: GeometryDisposalSystem;\n\ttextureSystem: TextureSystem;\n\tborderSystem: BorderSystem;\n\trenderOrderSystem: RenderOrderSystem;\n\tclippingPlaneSystem: ClippingPlaneSystem;\n};\n\nexport type MapViewState = {\n\treadonly type: 'map-view';\n\thoverColor: string;\n\ttext3dHoverColor: string;\n};\n\nclass Core extends PubSub<MapEvent> {\n\toptions: Omit<RendererCoreOptions, 'outdoorView'>;\n\tcontainer: HTMLElement;\n\tDebug: Debug;\n\t#scene?: Scene;\n\t#cameraObject: PerspectiveCamera;\n\t#cachedBasicEnvMapPromise: Promise<Texture> | undefined;\n\t#viewCamera: ThreeCamera;\n\t/**\n\t * The view camera is used for projecting both the outdoor map and our scene\n\t */\n\tget viewCamera() {\n\t\treturn this.#viewCamera;\n\t}\n\t#resolution: Vector2;\n\t#worldPlane: Mesh<PlaneGeometry, MeshBasicMaterial>;\n\t#resizeObserver?: ResizeObserver;\n\t#cameraOrbit: Object3D;\n\tget canvasWidth() {\n\t\treturn this.#state.canvasWidth;\n\t}\n\tget canvasHeight() {\n\t\treturn this.#state.canvasHeight;\n\t}\n\trendererDomElement: HTMLCanvasElement;\n\t/**\n\t * Returns pixel ratio of the renderer\n\t */\n\tget resolutionScale(): number {\n\t\t// make sure we use maplibre's clamped pixel ratio. Do not ask me why, but this fixes the issue with ultra wide monitors\n\t\t// TODO: figure out what clamped pixel ratio is and why it's needed\n\t\treturn this.map?._getClampedPixelRatio(this.canvasWidth, this.canvasHeight) ?? getPixelRatio();\n\t}\n\n\t/**\n\t * Sets pixel ratio of the renderer. In interleaved mode, maplibre will decide what pixel ratio to use based on canvas dimensions\n\t * and `this.resolutionScale` will reflect that.\n\t */\n\t#setResolutionScale(value: number) {\n\t\tif (this.#mode !== 'outdoors-overlay') {\n\t\t\tthis.map?.setPixelRatio(value);\n\t\t}\n\t\tthis.#state.pixelRatio = this.resolutionScale;\n\t}\n\n\tget aspect() {\n\t\treturn this.canvasWidth / this.canvasHeight;\n\t}\n\n\t#state: RendererState = {\n\t\tgeometry3DMap: new Map(),\n\t\tgeometry2DMap: new Map(),\n\t\tgeometry2DIdsInScene: new Set(),\n\t\tgeometry3DIdsInScene: new Set(),\n\t\tgeometryGroupIdsToLoad: new Set(),\n\t\tentityScene: new GroupContainerObject3D('__scene'),\n\t\thoverColor: '#f6efff',\n\t\ttext3dHoverColor: 'white',\n\t\tinsetsPadding: DEFAULT_INSET_PADDING,\n\t\tshouldMeasureCanvas: true,\n\t\tpixelRatio: this.resolutionScale,\n\t\tcanvasWidth: 0,\n\t\tcanvasHeight: 0,\n\t\tinternalTweenGroup: new TweenGroup(),\n\t\texternalTweenGroup: new TweenGroup(),\n\t\tcameraObject: new PerspectiveCamera(),\n\t\tnaturalBearing: 0,\n\t\tcontainerOffset: [0, 0],\n\t\tuseStandaloneCamera: false,\n\t};\n\n\t/**\n\t * MapLibre event listeners that the renderer is subscribed to.\n\t */\n\t#mapLibreEventListeners: Record<keyof MapLibreMapEventType, ((...args: any[]) => void)[]> = {} as any;\n\n\t/**\n\t * The abort controller for the renderer.\n\t */\n\t#abortController: AbortController = new AbortController();\n\n\t// APIs\n\tcamera: Camera;\n\n\t// DOM elements\n\t#collisionEngineContainerEl!: HTMLDivElement;\n\t#debugCanvas!: HTMLCanvasElement;\n\t#colliderCanvas!: HTMLCanvasElement;\n\t#twoDEntityScene!: Entity2DHTMLDivElementContainer;\n\n\t// Services\n\t#renderer: Renderer;\n\n\t// Systems\n\t#systems: Systems = {} as Systems;\n\n\t#matchMediaMinResolution: MediaQueryList = window.matchMedia('screen and (min-resolution: 2dppx)');\n\n\tmap: MapLibreMap | undefined;\n\n\t#invalidate2DEntities = () => {\n\t\tif (this.aborted || !this.#systems?.renderSystem) {\n\t\t\treturn;\n\t\t}\n\t\tthis.#systems.renderSystem.twoDdirty = true;\n\t};\n\n\t#invalidate3DEntities = () => {\n\t\tif (this.aborted || !this.#systems?.renderSystem) {\n\t\t\treturn;\n\t\t}\n\t\tthis.#systems.renderSystem.threeDdirty = true;\n\t};\n\n\t#renderEntity2DContainer() {\n\t\tthis.#collisionEngineContainerEl = document.createElement('div');\n\t\tthis.#collisionEngineContainerEl.classList.add('mappedin__smart-collision-engine__container');\n\t\tthis.#debugCanvas = document.createElement('canvas');\n\t\tthis.#debugCanvas.classList.add('mappedin__smart-collision-engine-debug__container');\n\t\tthis.container.appendChild(this.#collisionEngineContainerEl);\n\t\tthis.#colliderCanvas = document.createElement('canvas');\n\t\tthis.#colliderCanvas.classList.add('mappedin__smart-collision-engine__container');\n\t\tthis.#colliderCanvas.width = this.#collisionEngineContainerEl.clientWidth * this.resolutionScale;\n\t\tthis.#colliderCanvas.height = this.#collisionEngineContainerEl.clientHeight * this.resolutionScale;\n\t\tthis.#colliderCanvas.style.width = this.#collisionEngineContainerEl.clientWidth + 'px';\n\t\tthis.#colliderCanvas.style.height = this.#collisionEngineContainerEl.clientHeight + 'px';\n\t\tthis.#collisionEngineContainerEl.appendChild(this.#debugCanvas);\n\t\tthis.#collisionEngineContainerEl.appendChild(this.#colliderCanvas);\n\t\tthis.#debugCanvas.width = this.#collisionEngineContainerEl.clientWidth;\n\t\tthis.#debugCanvas.height = this.#collisionEngineContainerEl.clientHeight;\n\t\tthis.#colliderCanvas.width = this.#collisionEngineContainerEl.clientWidth * this.resolutionScale;\n\t\tthis.#colliderCanvas.height = this.#collisionEngineContainerEl.clientHeight * this.resolutionScale;\n\t\tthis.#colliderCanvas.style.width = this.#collisionEngineContainerEl.clientWidth + 'px';\n\t\tthis.#colliderCanvas.style.height = this.#collisionEngineContainerEl.clientHeight + 'px';\n\t}\n\n\t#renderEntityDOMContainer() {\n\t\tthis.#twoDEntityScene = document.createElement('div') as Entity2DHTMLDivElementContainer;\n\t\tthis.#twoDEntityScene.classList.add('mappedin-2d-entities');\n\t\tObject.assign(this.#twoDEntityScene.style, {\n\t\t\tposition: 'absolute',\n\t\t\ttop: '0',\n\t\t\tleft: '0',\n\t\t\tbottom: '0',\n\t\t\tright: '0',\n\t\t\tpointerEvents: 'none',\n\t\t\t'transform-style': 'preserve-3d',\n\t\t});\n\t\tthis.container.appendChild(this.#twoDEntityScene);\n\t}\n\n\t#resizeCollisionCanvas() {\n\t\tthis.#colliderCanvas.width = this.#collisionEngineContainerEl.clientWidth * this.resolutionScale;\n\t\tthis.#colliderCanvas.height = this.#collisionEngineContainerEl.clientHeight * this.resolutionScale;\n\t\tthis.#colliderCanvas.style.width = this.#collisionEngineContainerEl.clientWidth + 'px';\n\t\tthis.#colliderCanvas.style.height = this.#collisionEngineContainerEl.clientHeight + 'px';\n\t\tthis.#debugCanvas.width = this.#collisionEngineContainerEl.clientWidth;\n\t\tthis.#debugCanvas.height = this.#collisionEngineContainerEl.clientHeight;\n\t\tthis.#colliderCanvas.width = this.#collisionEngineContainerEl.clientWidth * this.resolutionScale;\n\t\tthis.#colliderCanvas.height = this.#collisionEngineContainerEl.clientHeight * this.resolutionScale;\n\t\tthis.#colliderCanvas.style.width = this.#collisionEngineContainerEl.clientWidth + 'px';\n\t\tthis.#colliderCanvas.style.height = this.#collisionEngineContainerEl.clientHeight + 'px';\n\t\tthis.#systems.collisionSystem.collidersDirty = true;\n\t}\n\n\t#mode: RendererCoreOptions['mode'] = 'standalone';\n\n\t/**\n\t * Returns the mode the Renderer is in.\n\t */\n\tget mode() {\n\t\treturn this.#mode;\n\t}\n\t/**\n\t * @internal\n\t */\n\tconstructor(container: HTMLElement, options: RendererCoreOptions = {}) {\n\t\tsuper();\n\n\t\tthis.#abortController = new AbortController();\n\n\t\tthis.#state.useStandaloneCamera = options.useStandaloneCamera ?? false;\n\t\tthis.#state.naturalBearing = options.naturalBearing ?? 0;\n\t\tthis.convertTo3DMapPosition = this.convertTo3DMapPosition.bind(this);\n\t\tif (!container.clientWidth || !container.clientHeight) {\n\t\t\tthrow new Error('[MappedinJS] Container width and height must be greater than 0');\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.convertTo3DMapPosition = this.convertTo3DMapPosition.bind(this);\n\t\tif ((options.mode === 'outdoors-interleaved' || options.mode === 'outdoors-overlay') && options.map) {\n\t\t\tthis.#mode = options.mode;\n\t\t\tthis.map = options.map;\n\t\t}\n\t\tthis.#state.entityScene.addEventListener('childadded', () => {\n\t\t\tthis.#invalidate3DEntities();\n\t\t\tthis.#invalidate2DEntities();\n\t\t});\n\t\tthis.#state.entityScene.addEventListener('childremoved', () => {\n\t\t\tthis.#invalidate3DEntities();\n\t\t\tthis.#invalidate2DEntities();\n\t\t});\n\n\t\tthis.#state.geometry3DMap.set(this.#state.entityScene.userData.entityId, this.#state.entityScene);\n\n\t\tif (options.center) {\n\t\t\tthis.#state.center = options.center ? [...options.center] : [0, 0];\n\t\t}\n\t\tthis.options = options;\n\t\tthis.container = container;\n\t\tthis.#renderEntity2DContainer();\n\t\tthis.#renderEntityDOMContainer();\n\n\t\tthis.#systems.htmlControlsSystem = new HTMLControlsSystem(this.container, {\n\t\t\toutdoorEnabled: !!this.map,\n\t\t});\n\t\tif (this.#mode !== 'outdoors-overlay') {\n\t\t\tthis.#systems.htmlControlsSystem.addAttributionControl(this.options.attribution);\n\t\t}\n\n\t\tif (!(window as any).MappedinDebug) {\n\t\t\t(window as any).MappedinDebug = {};\n\t\t}\n\n\t\t// Expose some things on the window object when running integration tests\n\t\tif (process.env.NODE_ENV === 'test') {\n\t\t\t(window as any).MappedinDebug.mapViewCoreInstance = this;\n\t\t}\n\n\t\tthis.#renderer = new Renderer({\n\t\t\tantialias: typeof options.antialias === 'boolean' ? options.antialias : true,\n\t\t\talpha: false,\n\t\t\tcanvas: this.mode !== 'standalone' ? options.gl?.canvas : undefined,\n\t\t\tonWebGLContextCreationError: options.onWebGLContextCreationError,\n\t\t\tonWebGLContextLost: options.onWebGLContextLost,\n\t\t\tonWebGLContextRestored: event => {\n\t\t\t\toptions.onWebGLContextRestored?.(event);\n\t\t\t\tthis.#invalidate2DEntities();\n\t\t\t\tthis.#invalidate3DEntities();\n\t\t\t\tthis.render();\n\t\t\t},\n\t\t\tonWebGLRendererError: options.onWebGLRendererError,\n\t\t\tbackgroundColor: options.backgroundColor || '#ffffff',\n\t\t\tbackgroundAlpha: options.backgroundAlpha ?? 1,\n\t\t});\n\n\t\t// Our 3D scene. The different camera layers holds elements based on\n\t\t// their re-rendering frequency.\n\t\tthis.#scene = new Scene();\n\t\tif (this.#mode !== 'standalone') {\n\t\t\t// TODO: replace this with a more robust solution\n\t\t\tthis.#scene.add(maplibreFrustrumCullHack());\n\t\t}\n\n\t\t// (window as any).scene = this.scene;\n\t\tthis.#scene.add(this.#state.entityScene);\n\n\t\t// Observe a scene and a renderer for the Three.js Developer Tools extension\n\t\tconst __THREE_DEVTOOLS__ = window['__THREE_DEVTOOLS__'];\n\t\tif (process.env.NODE_ENV === 'dev' && typeof __THREE_DEVTOOLS__ !== 'undefined') {\n\t\t\t__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent('observe', { detail: this.#scene }));\n\t\t\t__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent('observe', { detail: this.#renderer }));\n\t\t}\n\t\t// The camera object has two other objects that act as joints. Camera orbit is what handles panning and rotation\n\t\t// cameraElevation is what controls the angle of the camera off the ground, and zoom is the distance between the camera and cameraElevation.\n\t\t// This makes it trivial to anchor the camera's pan motion to the map plane.\n\t\tthis.#cameraObject = new PerspectiveCamera(FIELD_OF_VIEW, this.aspect, 50, 100000);\n\t\tthis.#state.cameraObject = this.#cameraObject;\n\t\t// the view camera is used for projecting both the outdoor map and our scene\n\t\t// we should never touch the view camera\n\t\tthis.#viewCamera = new ThreeCamera();\n\n\t\tthis.#cameraObject.renderOrder = 999;\n\t\tlet cameraElevation = new Object3D();\n\t\tcameraElevation.add(this.#cameraObject);\n\n\t\tthis.#cameraOrbit = new Object3D();\n\t\tthis.#cameraOrbit.add(cameraElevation);\n\n\t\tthis.#scene.add(this.#cameraOrbit);\n\n\t\tthis.#cameraObject.updateProjectionMatrix();\n\t\tthis.#cameraObject.updateMatrixWorld(true);\n\n\t\t// @ts-ignore TODO: backwards compat, remove\n\t\tthis.referenceMap = {\n\t\t\tscale: 1,\n\t\t\tlatitude: 0,\n\t\t\tlongitude: 0,\n\t\t\tgetNorth: () => 0,\n\t\t\tgeoreference: [\n\t\t\t\t{\n\t\t\t\t\ttarget: {\n\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\ty: 0,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttarget: {\n\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\ty: 0,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttarget: {\n\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\ty: 0,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttarget: {\n\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\ty: 0,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tthis.rendererDomElement = this.#renderer.domElement()!;\n\t\tthis.#resolution = new Vector2();\n\n\t\tconst worldPlaneGeometery = new PlaneGeometry(1000000, 1000000); // Should set this to be the map bounds later\n\t\tconst worldPlaneMaterial = new MeshBasicMaterial({\n\t\t\tcolor: 0x000000,\n\t\t\tvisible: false,\n\t\t});\n\t\tthis.#worldPlane = new Mesh(worldPlaneGeometery, worldPlaneMaterial);\n\t\tthis.#worldPlane.name = 'worldPlane';\n\n\t\tthis.#scene.add(this.#worldPlane);\n\n\t\tif (!options.gl?.canvas) {\n\t\t\t// Set up all our events\n\t\t\tcontainer.appendChild(this.rendererDomElement);\n\t\t}\n\n\t\twindow.addEventListener('resize', this.#handleWindowResizeWithEvent, false);\n\t\tthis.#matchMediaMinResolution.addEventListener('change', this.#handlePixelRatioChange);\n\n\t\t/**\n\t\t * ResizeObserver is only supported on ~92% of browsers, with the notable\n\t\t * exceptions being IE, early Edge versions and early Safari versions\n\t\t * (<= 13.1 on desktop, <= 13.4 on mobile). Fortunately this isn't a deal-\n\t\t * breaker if unsupported, so we can just skip it.\n\t\t */\n\t\tif (\n\t\t\ttypeof ResizeObserver === 'function' &&\n\t\t\t// [Anzor] ResizeObserver causes issues when running integration tests\n\t\t\t// needs investigation (the height just keeps growing, crashing the browser,\n\t\t\t// I've seen this behavior in a couple other places too)\n\t\t\tprocess.env?.NODE_ENV !== 'test'\n\t\t) {\n\t\t\t// https://stackoverflow.com/questions/49384120/resizeobserver-loop-limit-exceeded\n\t\t\tthis.#resizeObserver = new ResizeObserver(\n\t\t\t\tthrottle(a => {\n\t\t\t\t\t// this may be a browser bug, but the container dimensions are not updated\n\t\t\t\t\t// until the next tick, so we need to use the contentRect to get the correct dimensions\n\t\t\t\t\tthis.#handleWindowResize(a[0].contentRect.width, a[0].contentRect.height);\n\t\t\t\t}, 50),\n\t\t\t);\n\t\t\tthis.#resizeObserver?.observe(container);\n\t\t}\n\n\t\tcontainer.classList.add('mappedin-map');\n\t\t// integration tests in iOS are headless, so we have to set fake\n\t\t// width and heights here to get it as close to the real thing as possible\n\t\tthis.rendererDomElement.style.width = globalThis.MappedinDebug?.TEST_IOS ? '1080px' : '100%';\n\t\tthis.rendererDomElement.style.height = globalThis.MappedinDebug?.TEST_IOS ? '1920px' : '100%';\n\n\t\tif (process.env.NODE_ENV === 'test') this.rendererDomElement.setAttribute('data-testid', 'mappedin-canvas');\n\n\t\t/**\n\t\t * Maplibre adds a tabindex to the canvas because they have keyboard controls.\n\t\t * Since our camera doesn't have keyboard controls, we need to remove it.\n\t\t */\n\t\tif (this.mode !== 'outdoors-overlay' && this.rendererDomElement.tabIndex !== undefined) {\n\t\t\tthis.rendererDomElement.removeAttribute('tabindex');\n\t\t}\n\n\t\tthis.#state.canvasWidth = this.rendererDomElement.clientWidth;\n\t\tthis.#state.canvasHeight = this.rendererDomElement.clientHeight;\n\n\t\t/**\n\t\t * touch-action: manipulation will ensure that double tapping on the\n\t\t * canvas will not result in a browser zoom\n\t\t */\n\t\tthis.rendererDomElement.style.touchAction = 'manipulation';\n\n\t\tlet canvasWidth = this.canvasWidth;\n\t\tlet canvasHeight = this.canvasHeight;\n\n\t\t// Create and enable the watermark\n\t\tthis.#systems.watermarkSystem = new WatermarkSystem(this.#cameraObject, this.#state, options?.watermark);\n\t\tthis.#systems.watermarkSystem.on('texture-loaded', this.render);\n\n\t\t/**\n\t\t * We want to defer the intial canvas measurement until the first render,\n\t\t * to ensure everything in Core has initialized\n\t\t */\n\t\tthis.#state.shouldMeasureCanvas = true;\n\n\t\tthis.#state.pixelRatio = this.resolutionScale;\n\n\t\tthis.#setBufferSize(\n\t\t\tMath.floor(canvasWidth * this.resolutionScale),\n\t\t\tMath.floor(canvasHeight * this.resolutionScale),\n\t\t);\n\n\t\t/**\n\t\t * These light settings mirror what things look liked in the Mappedin CMS.\n\t\t *\n\t\t * The renderer.useLegacyLights has been set to false in three.js v.0.155.0.\n\t\t * This means that light intensities are no longer internally scaled by factor PI.\n\t\t * Before, this trick made the lights look nicer by keeping their intensity levels close to 1\n\t\t * (so-called artist-friendly light intensity scaling factor).\n\t\t *\n\t\t * @internal\n\t\t * @see https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733\n\t\t */\n\t\tlet directionalLight = new DirectionalLight(0xffffff, 0.3 * Math.PI);\n\t\tdirectionalLight.position.set(-150, -150, 350);\n\t\tthis.#scene.add(directionalLight);\n\n\t\tlet ambientLight = new AmbientLight(0xffffff, 0.741 * Math.PI);\n\t\tthis.#scene.add(ambientLight);\n\n\t\t// Set up the camera controls\n\t\tthis.#systems.cameraSystem = new CameraSystem(\n\t\t\tthis.#cameraObject,\n\t\t\tthis.#scene,\n\t\t\tthis.#renderer.renderer!,\n\t\t\tthis.#state,\n\t\t\t{\n\t\t\t\tmode: this.mode,\n\t\t\t\tcanvasHeight: canvasHeight,\n\t\t\t\tcanvasWidth: canvasWidth,\n\t\t\t},\n\t\t);\n\n\t\tthis.#systems.cameraSystem.on('user-dolly-start', this.#aggregateUserEventsStart);\n\t\tthis.#systems.cameraSystem.on('user-pan-start', this.#aggregateUserEventsStart);\n\t\tthis.#systems.cameraSystem.on('user-rotate-start', this.#aggregateUserEventsStart);\n\t\tthis.#systems.cameraSystem.on('user-zoom-start', this.#aggregateUserEventsStart);\n\t\tthis.#systems.cameraSystem.on('user-tilt-start', this.#aggregateUserEventsStart);\n\t\tthis.#systems.cameraSystem.on('user-pedestal-start', this.#aggregateUserEventsStart);\n\t\tthis.#systems.cameraSystem.on('user-dolly-end', this.#aggregateUserEventsEnd);\n\t\tthis.#systems.cameraSystem.on('user-pan-end', this.#aggregateUserEventsEnd);\n\t\tthis.#systems.cameraSystem.on('user-rotate-end', this.#aggregateUserEventsEnd);\n\t\tthis.#systems.cameraSystem.on('user-zoom-end', this.#aggregateUserEventsEnd);\n\t\tthis.#systems.cameraSystem.on('user-tilt-end', this.#aggregateUserEventsEnd);\n\t\tthis.#systems.cameraSystem.on('user-pedestal-end', this.#aggregateUserEventsEnd);\n\n\t\tthis.#systems.cameraSystem.on('change', () => {\n\t\t\tthis.publish('camera-change', this.camera);\n\t\t\tif (this.#systems.geometryInFocusSystem) {\n\t\t\t\tthis.#systems.geometryInFocusSystem.cameraDirty = true;\n\t\t\t}\n\t\t\tthis.render();\n\t\t});\n\t\tthis.onAbort(() => {\n\t\t\tthis.#systems.cameraSystem.off('user-dolly-start', this.#aggregateUserEventsStart);\n\t\t\tthis.#systems.cameraSystem.off('user-pan-start', this.#aggregateUserEventsStart);\n\t\t\tthis.#systems.cameraSystem.off('user-rotate-start', this.#aggregateUserEventsStart);\n\t\t\tthis.#systems.cameraSystem.off('user-zoom-start', this.#aggregateUserEventsStart);\n\t\t\tthis.#systems.cameraSystem.off('user-tilt-start', this.#aggregateUserEventsStart);\n\t\t\tthis.#systems.cameraSystem.off('user-pedestal-start', this.#aggregateUserEventsStart);\n\t\t\tthis.#systems.cameraSystem.off('user-dolly-end', this.#aggregateUserEventsEnd);\n\t\t\tthis.#systems.cameraSystem.off('user-pan-end', this.#aggregateUserEventsEnd);\n\t\t\tthis.#systems.cameraSystem.off('user-rotate-end', this.#aggregateUserEventsEnd);\n\t\t\tthis.#systems.cameraSystem.off('user-zoom-end', this.#aggregateUserEventsEnd);\n\t\t\tthis.#systems.cameraSystem.off('user-tilt-end', this.#aggregateUserEventsEnd);\n\t\t\tthis.#systems.cameraSystem.off('user-pedestal-end', this.#aggregateUserEventsEnd);\n\t\t\tthis.#systems.renderSystem.off('measure-canvas', this.#measureCanvas);\n\t\t\tthis.#systems.cameraSystem.off('change', this.render);\n\t\t\tthis.#systems.outlineInterpolationSystem.off('needs-render', this.render);\n\t\t});\n\n\t\tthis.#systems.pathSystem = new PathSystem(\n\t\t\tthis.#state,\n\t\t\tthis.convertTo3DMapPosition,\n\t\t\tthis.getParentContainer,\n\t\t\tthis.#systems.cameraSystem.convertZoomLevelToAltitude,\n\t\t);\n\t\tthis.#systems.pathSystem.on('animate:path', this.render);\n\t\tthis.onAbort(() => {\n\t\t\tthis.#systems.pathSystem.off('animate:path', this.render);\n\t\t});\n\n\t\tthis.#systems.panBoundsSystem = new PanBoundsSystem(this.#state, this.#systems.cameraSystem);\n\t\t/* TODO Move the maplibre camera logic into cameraSystem, so we don't need these events. */\n\t\tconst handlePanBoundsUpdate = () => {\n\t\t\tconst { panBounds, fov, convertAltitudeToZoomLevel } = this.#systems.cameraSystem;\n\t\t\tif (this.#systems.panBoundsSystem.autoMinZoomLevel) {\n\t\t\t\tif (panBounds.radius <= 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// Three.js perspective camera uses vertical FOV by default. For landscape orientation (width > height),\n\t\t\t\t// we can use the FOV directly (clamped at minimum of 1). For portrait orientation (width < height),\n\t\t\t\t// we need to reduce the effective FOV based on the width-to-height ratio to maintain proper scaling.\n\t\t\t\tconst screenWidthHeightRatio = Math.min(this.#state.canvasWidth / this.#state.canvasHeight, 1);\n\t\t\t\tconst fovInRadians = ((fov * Math.PI) / 180) * screenWidthHeightRatio;\n\t\t\t\tconst tanFovHalf = Math.tan(fovInRadians / 2); // Tangent of half the field of view (used for calculating the visible area spread)\n\n\t\t\t\t// See image in: https://github.com/MappedIn/sdk/pull/448\n\t\t\t\tconst { radius: r, center } = this.#systems.cameraSystem.panBounds;\n\t\t\t\tconst d = r / tanFovHalf;\n\t\t\t\tconst cameraPosition = this.getThreeCamera().getWorldPosition(new Vector3());\n\t\t\t\tconst cameraToCenterDistance = center.distanceTo(cameraPosition);\n\t\t\t\tconst cameraToCenterPlane = Math.abs(cameraPosition.z - center.z);\n\t\t\t\tconst y = (d * cameraToCenterPlane) / cameraToCenterDistance;\n\n\t\t\t\tconst minZoomFromCurrentPanBounds = convertAltitudeToZoomLevel(y);\n\t\t\t\tif (shouldExpandZoomLevel(minZoomFromCurrentPanBounds, this.camera.minZoomLevel)) {\n\t\t\t\t\tthis.camera.setMinZoomLevel(minZoomFromCurrentPanBounds);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.publish('pan-bounds-change', this.#systems.cameraSystem.panBounds);\n\t\t};\n\t\tthis.#systems.panBoundsSystem.on('update', handlePanBoundsUpdate);\n\t\tthis.onAbort(() => {\n\t\t\tthis.#systems.panBoundsSystem.off('update', handlePanBoundsUpdate);\n\t\t});\n\n\t\tthis.camera = new Camera(this, this.#systems, this.#state);\n\n\t\tthis.camera.setZoomLevel(options.zoomLevel ?? DEFAULT_ZOOM_LEVEL);\n\t\tthis.camera.setBearing(options.bearing ?? DEFAULT_BEARING);\n\t\tthis.camera.setPitch(options.pitch ?? DEFAULT_PITCH);\n\t\tthis.camera.setMaxZoomLevel(DEFAULT_MAX_ZOOM_LEVEL);\n\t\tthis.camera.setMinZoomLevel(DEFAULT_MIN_ZOOM_LEVEL);\n\n\t\tthis.#systems.domVisiblitySystem = new DOMVisibilitySystem(this.#state, this.#twoDEntityScene);\n\t\tthis.#systems.domMutationSystem = new DOMResizeSystem(this.#state, this.#twoDEntityScene);\n\t\tthis.#systems.domMutationSystem.on('dimensions-update', () => {\n\t\t\tthis.#systems.collisionSystem.collidersDirty = true;\n\t\t\tthis.render();\n\t\t});\n\t\tthis.#systems.domDrawSystem = new DOMDrawSystem(this.#state);\n\n\t\tthis.#systems.collisionSystem = new CollisionSystem(\n\t\t\tthis.#debugCanvas,\n\t\t\tthis.#state,\n\t\t\t(options.useCollisionWorker ?? true) && (options.useWorkers ?? true),\n\t\t);\n\t\tthis.#systems.twoDDrawSystem = new TwoDDrawSystem(this.#state, this.#colliderCanvas, options.transformImageRequest);\n\t\tthis.#systems.twoDDrawSystem.on('img:loaded', this.render);\n\t\tthis.#systems.interactionSystem = new InteractionSystem(\n\t\t\tthis.rendererDomElement,\n\t\t\tthis.#state,\n\t\t\tthis.#cameraObject,\n\t\t\tthis.#worldPlane,\n\t\t\tthis.#systems.cameraSystem.isUserInteracting,\n\t\t);\n\t\tthis.#systems.interactionSystem.on('doubletap-with-onefinger', (e: PointerEvent) => {\n\t\t\tif (this.#systems.cameraSystem.enableZoom) {\n\t\t\t\tthis.camera.animateTo({\n\t\t\t\t\tcenter: this.projectScreenXYToCoordinate(e.clientX, e.clientY)?.coordinate,\n\t\t\t\t\tzoomLevel: this.camera.zoomLevel + 1,\n\t\t\t\t\tduration: TAP_ZOOM_DURATION,\n\t\t\t\t\teasing: 'ease-out',\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tthis.#systems.interactionSystem.on('singletap-with-twofinger', () => {\n\t\t\tif (this.#systems.cameraSystem.enableZoom) {\n\t\t\t\tthis.camera.animateTo({\n\t\t\t\t\tzoomLevel: this.camera.zoomLevel - 1,\n\t\t\t\t\tduration: TAP_ZOOM_DURATION,\n\t\t\t\t\teasing: 'ease-out',\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tthis.#systems.interactionSystem.on('hover', this.render);\n\t\tthis.#systems.interactionSystem.on('click', payload => {\n\t\t\tif (\n\t\t\t\tpayload.entity2D?.id === 'watermark' &&\n\t\t\t\ttypeof this.#systems.watermarkSystem.options.onClick === 'function' &&\n\t\t\t\tthis.#systems.watermarkSystem.options.interactive\n\t\t\t) {\n\t\t\t\tthis.#systems.watermarkSystem.options.onClick();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst geometry = payload.entity3D ? [payload.entity3D?.id] : [];\n\t\t\tif (payload.entity3D?.parentObject3D?.userData?.entityId) {\n\t\t\t\tgeometry.push(payload.entity3D?.parentObject3D?.userData?.entityId);\n\t\t\t}\n\n\t\t\tthis.publish('click', {\n\t\t\t\tcoordinate: this.convert3DMapPositionToCoordinate(payload.position!),\n\t\t\t\tgeometry,\n\t\t\t\tpaths:\n\t\t\t\t\tpayload.entity3D?.components[Geometry3DComponents.Mesh] instanceof PathComponent ? [payload.entity3D.id] : [],\n\t\t\t\tmarkers:\n\t\t\t\t\tpayload.entity2D?.components[Geometry2DComponents.UI] instanceof MarkerComponent ? [payload.entity2D.id] : [],\n\t\t\t\tmodels:\n\t\t\t\t\tpayload.entity3D?.components[Geometry3DComponents.Mesh] instanceof ModelComponent\n\t\t\t\t\t\t? [payload.entity3D.id]\n\t\t\t\t\t\t: [],\n\t\t\t\tlabels:\n\t\t\t\t\tpayload.entity2D?.components[Geometry2DComponents.UI] instanceof LabelComponent ? [payload.entity2D.id] : [],\n\t\t\t\tcontainers: Array.isArray(payload.groupContainers)\n\t\t\t\t\t? payload.groupContainers.map(container => container.userData.entityId)\n\t\t\t\t\t: [],\n\t\t\t\tpointerEvent: payload.pointerEvent,\n\t\t\t});\n\t\t});\n\t\t// TODO: possibly refactor with click\n\t\tthis.#systems.interactionSystem.on('hover', payload => {\n\t\t\tif (!payload.position) return;\n\n\t\t\tthis.publish('hover', {\n\t\t\t\tcoordinate: this.convert3DMapPositionToCoordinate(payload.position!),\n\t\t\t\tgeometry: payload.entity3D ? [payload.entity3D?.id] : [],\n\t\t\t\tpaths:\n\t\t\t\t\tpayload.entity3D?.components[Geometry3DComponents.Mesh] instanceof PathComponent ? [payload.entity3D.id] : [],\n\t\t\t\tmarkers:\n\t\t\t\t\tpayload.entity2D?.components[Geometry2DComponents.UI] instanceof MarkerComponent ? [payload.entity2D.id] : [],\n\t\t\t\tmodels:\n\t\t\t\t\tpayload.entity3D?.components[Geometry3DComponents.Mesh] instanceof ModelComponent\n\t\t\t\t\t\t? [payload.entity3D.id]\n\t\t\t\t\t\t: [],\n\t\t\t\tlabels:\n\t\t\t\t\tpayload.entity2D?.components[Geometry2DComponents.UI] instanceof LabelComponent ? [payload.entity2D.id] : [],\n\t\t\t\tcontainers: Array.isArray(payload.groupContainers)\n\t\t\t\t\t? payload.groupContainers.map(container => container.userData.entityId)\n\t\t\t\t\t: [],\n\t\t\t});\n\t\t});\n\n\t\tthis.#systems.geometryInFocusSystem = new GeometryInFocusSystem(this.#state, this.#cameraObject);\n\t\tconst handleGeometryInFocus = geometry => {\n\t\t\tthis.publish('geometry-in-focus', geometry);\n\t\t};\n\t\tthis.#systems.geometryInFocusSystem.on('geometry-in-focus', handleGeometryInFocus);\n\t\tthis.onAbort(() => {\n\t\t\tthis.#systems.geometryInFocusSystem.off('geometry-in-focus', handleGeometryInFocus);\n\t\t});\n\n\t\tthis.#systems.twoDVisiblitySystem = new TwoDVisibilitySystem(this.#state);\n\t\tthis.#systems.drawSystem = new DrawSystem(this.#state, this.convertTo3DMapPosition);\n\n\t\tthis.#systems.twoDProjectionSystem = new TwoDProjectionSystem(this.#state, this.#project);\n\t\tthis.#systems.exporterSystem = new ExporterSystem(this.#state);\n\n\t\tthis.#systems.meshOptimizationSystem = new MeshCreationAndOptimizationSystem(\n\t\t\tthis.#state,\n\t\t\tthis.convertTo3DMapPosition,\n\t\t);\n\t\tthis.#systems.meshOptimizationSystem.on('model-loaded', this.render);\n\t\tthis.#systems.meshOptimizationSystem.on('geometry-2d-added', this.render);\n\t\tthis.#systems.meshOptimizationSystem.on('geometry-group-added', this.#setGeometryDisposalDirty);\n\t\tthis.onAbort(() => {\n\t\t\tthis.#systems.meshOptimizationSystem.off('model-loaded', this.render);\n\t\t\tthis.#systems.meshOptimizationSystem.off('geometry-2d-added', this.render);\n\t\t\tthis.#systems.meshOptimizationSystem.off('geometry-group-added', this.#setGeometryDisposalDirty);\n\t\t});\n\t\tthis.#systems.meshDetachmentSystem = new MeshDetachmentSystem(this.#state);\n\t\tthis.#systems.meshModificationSystem = new MeshModificationSystem(this.#state);\n\t\tthis.#systems.geometryDisposalSystem = new GeometryDisposalSystem(this.#state);\n\t\tthis.#systems.textureSystem = new TextureSystem(this.#state);\n\t\tthis.#systems.textureSystem.on('texture-added', this.render);\n\t\tthis.onAbort(() => {\n\t\t\tthis.#systems.textureSystem.off('texture-added', this.render);\n\t\t});\n\t\tthis.#systems.borderSystem = new BorderSystem(this.#state, this.convertTo3DMapPosition);\n\t\tthis.#systems.clippingPlaneSystem = new ClippingPlaneSystem(this.#state);\n\t\tthis.#systems.renderOrderSystem = new RenderOrderSystem(this.#state);\n\n\t\tthis.#systems.customGeometrySystem = new CustomGeometrySystem(this.#state, this.convertTo3DMapPosition);\n\n\t\tthis.#systems.outlineInterpolationSystem = new OutlineInterpolationSystem(this.#state);\n\t\tthis.#systems.outlineInterpolationSystem.on('needs-render', this.render);\n\t\tthis.#systems.renderSystem = new RenderSystem(\n\t\t\tthis.#renderer,\n\t\t\tthis.#state,\n\t\t\tthis.mode,\n\t\t\tthis.#scene,\n\t\t\tthis.#cameraObject,\n\t\t\tthis.viewCamera,\n\t\t\tthis.#systems,\n\t\t);\n\t\tthis.#systems.imageSystem = new ImageSystem(\n\t\t\tthis.#state,\n\t\t\tthis.convertTo3DMapPosition,\n\t\t\tthis.#project,\n\t\t\toptions.bearing,\n\t\t\toptions.naturalBearing,\n\t\t\toptions.imagePlacementOptions,\n\t\t);\n\t\tthis.#systems.text3DSystem = new Text3DSystem(this.#state, this.convertTo3DMapPosition, options.useWorkers ?? true);\n\t\tthis.#systems.text3DSystem.on('render', this.render);\n\t\tthis.#systems.imageSystem.on('image-loaded', this.render);\n\n\t\tthis.#systems.renderSystem.on('pre-render', () => this.publish('pre-render'));\n\t\tthis.#systems.renderSystem.on('post-render', () => this.publish('post-render'));\n\t\tthis.#systems.renderSystem.on('measure-canvas', this.#measureCanvas);\n\t\tthis.onAbort(() => {\n\t\t\tthis.#systems.renderSystem.off('pre-render', () => this.publish('pre-render'));\n\t\t\tthis.#systems.renderSystem.off('post-render', () => this.publish('post-render'));\n\t\t\tthis.#systems.renderSystem.off('measure-canvas', this.#measureCanvas);\n\t\t});\n\t\tthis.#systems.outdoorLayersSystem = new OutdoorLayers(this.map);\n\t\tthis.#systems.occlusion2DSystem = new Occlusion2DSystem(this.#state, this.convertTo3DMapPosition, this.#renderer);\n\t\tif (options.occlusionEnabled) {\n\t\t\tthis.#systems.occlusion2DSystem.enable();\n\t\t}\n\n\t\tthis.Debug = new Debug(this);\n\n\t\tif (options.environment !== false) {\n\t\t\tthis.#cachedBasicEnvMapPromise = this.#loadEnvMap();\n\t\t}\n\n\t\t// Perform initial render so canvas is drawn with background color\n\t\tthis.#renderFull();\n\t}\n\n\t#setGeometryDisposalDirty = () => {\n\t\tthis.#systems.geometryDisposalSystem.dirty = true;\n\t\tthis.render();\n\t};\n\n\t#round10 = value => {\n\t\treturn Math.trunc(value * 10) / 10;\n\t};\n\n\t#handlePixelRatioChange = () => {\n\t\tthis.#setResolutionScale(getPixelRatio());\n\t\tthis.#systems.twoDDrawSystem.dirty = true;\n\t\t// proceed with the window resize\n\t\tthis.#handleWindowResize(undefined, undefined, true);\n\t};\n\n\t// make typescript happy\n\t#handleWindowResizeWithEvent = () => {\n\t\tthis.#handleWindowResize();\n\t};\n\n\t// Updates the size of the renderer and where everything is when the window is resized\n\t#handleWindowResize = (width?: number, height?: number, force = false) => {\n\t\tconst currentWidth = width ?? this.rendererDomElement.clientWidth;\n\t\tconst currentHeight = height ?? this.rendererDomElement.clientHeight;\n\t\tif ((currentWidth === 0 || currentHeight === 0) && !force) {\n\t\t\treturn;\n\t\t}\n\t\t// if the window is resized, we want to measure the canvas again (immediately)\n\t\t// and then do a full render, to ensure any deffered render tasks\n\t\t// have the updated canvas size\n\t\tthis.#state.canvasWidth = currentWidth;\n\t\tthis.#state.canvasHeight = currentHeight;\n\t\tthis.#setResolutionScale(getPixelRatio());\n\n\t\tthis.#measureCanvas();\n\n\t\tthis.#resizeCollisionCanvas();\n\t\tthis.#systems.cameraSystem.resize(this.canvasWidth, this.canvasHeight);\n\t\tthis.#systems.cameraSystem.dirty = true;\n\t\tif (this.map != null) {\n\t\t\t/**\n\t\t\t * Sync Maplibre's min/max zoom with the camera's, since our camera's zoom\n\t\t\t * levels are recalculated on canvas resize and may diverge from Maplibre's fixed values.\n\t\t\t */\n\t\t\tthis.map.setMinZoom(this.camera.minZoomLevel);\n\t\t\tthis.map.setMaxZoom(this.camera.maxZoomLevel);\n\t\t}\n\t\tthis.#systems.watermarkSystem.resize(this.canvasWidth, this.canvasHeight);\n\t\tthis.#systems.htmlControlsSystem.resize(this.canvasWidth);\n\t\tthis.#systems.geometryInFocusSystem.resize();\n\t\tthis.#systems.occlusion2DSystem.resize();\n\t\tconst { top, left } = this.container.getBoundingClientRect();\n\t\tthis.#state.containerOffset = [top, left];\n\t\tthis.publish('resize');\n\t\tthis.render();\n\t};\n\n\t// Perform a full rendering pass, synchronously\n\t#renderFull = () => {\n\t\tthis.renderSync();\n\t};\n\n\t#tempProjectionVector = new Vector3();\n\n\t#project = (projectVector: Vector2, position: Vector3) => {\n\t\tconst camera = this.mode === 'standalone' ? this.#cameraObject : this.viewCamera;\n\n\t\t// make sure that the object is not behind the camera\n\t\tif (this.#cameraObject.position.z + this.camera.elevation > position.z) {\n\t\t\tthis.#tempProjectionVector.copy(position);\n\t\t\tconst projection = this.#tempProjectionVector.project(camera);\n\t\t\tlet x = ((projection.x + 1) / 2) * this.canvasWidth - 0 / 2;\n\t\t\tlet y = ((-projection.y + 1) / 2) * this.canvasHeight - 0 / 2;\n\n\t\t\tlet translateX = this.#round10(x);\n\t\t\tlet translateY = this.#round10(y);\n\n\t\t\tprojectVector.x = translateX;\n\t\t\tprojectVector.y = translateY;\n\t\t} else {\n\t\t\t// toss projections out of viewport, until they're in view\n\t\t\t// @TODO: we should be smarter and stop processing these, but that can come later\n\t\t\t// maybe a frustum culling type thing but for 2D entities\n\t\t\tprojectVector.x = -1000;\n\t\t\tprojectVector.y = -1000;\n\t\t}\n\t};\n\n\t#setBufferSize = (width, height) => {\n\t\tthis.#renderer.setBufferSize(width, height);\n\t\tthis.#cameraObject.aspect = width / height;\n\t\tthis.#cameraObject.updateProjectionMatrix();\n\t\tthis.#cameraObject.updateMatrixWorld(true);\n\t\tthis.#resolution.x = width;\n\t\tthis.#resolution.y = height;\n\t};\n\n\t#measureCanvas = () => {\n\t\t// look up the size the canvas is being displayed in CSS pixels\n\t\tlet width = (this.#state.canvasWidth = this.rendererDomElement.clientWidth);\n\t\tlet height = (this.#state.canvasHeight = this.rendererDomElement.clientHeight);\n\n\t\t// guess the width and height js will use if we ask for that size\n\t\tlet widthThreeJS = Math.floor(width * this.resolutionScale);\n\t\tlet heightThreeJS = Math.floor(height * this.resolutionScale);\n\n\t\t// check if our canvas is that widthThreeJS\n\t\t// if (this.rendererDomElement.width !== widthThreeJS || this.rendererDomElement.height !== heightThreeJS) {\n\t\t// \tif (this.rendererDomElement.width * this.rendererDomElement.height * widthThreeJS * heightThreeJS !== 0) {\n\t\t// \t\tlet factor =\n\t\t// \t\t\tthis.rendererDomElement.width !== widthThreeJS\n\t\t// \t\t\t\t? this.rendererDomElement.width / widthThreeJS\n\t\t// \t\t\t\t: this.rendererDomElement.height / heightThreeJS;\n\t\t// \t\tthis.cameraSystem.setZoom(factor * this.cameraSystem.getZoom());\n\t\t// \t}\n\t\t// \t// it's not the same size so\n\t\t// \t// set it to the width and height we want and pray\n\t\t// \t// that it matches what js actually uses\n\t\tthis.#setBufferSize(widthThreeJS, heightThreeJS);\n\t\tthis.map?.resize();\n\t\t// }\n\t\tthis.#state.shouldMeasureCanvas = false;\n\t};\n\n\t/**\n\t * Add a container that can hold other containers, geometry groups, markers, labels and paths. Use this to group entities together.\n\t */\n\taddGroupContainer(\n\t\tid: string,\n\t\toptions?: {\n\t\t\tvisible?: boolean;\n\t\t\taltitude?: number;\n\t\t\tinteractive?: boolean;\n\t\t\tfocusable?: boolean;\n\t\t\tpreloadGeometry?: boolean;\n\t\t},\n\t\tparent?: EntityId<GroupContainerState> | string | number | null,\n\t) {\n\t\tif (!this.#state.geometry3DMap.has(id) && !this.#state.geometry2DMap.has(id)) {\n\t\t\tconst containerObject = new GroupContainerObject3D(id);\n\t\t\tcontainerObject.addEventListener('childadded', () => {\n\t\t\t\tthis.#invalidate3DEntities();\n\t\t\t\tthis.#invalidate2DEntities();\n\t\t\t});\n\t\t\tcontainerObject.addEventListener('childremoved', () => {\n\t\t\t\tthis.#invalidate3DEntities();\n\t\t\t\tthis.#invalidate2DEntities();\n\t\t\t});\n\t\t\tif (options?.visible !== undefined) {\n\t\t\t\tcontainerObject.visible = options.visible;\n\t\t\t}\n\t\t\tif (options?.altitude !== undefined) {\n\t\t\t\tcontainerObject.setAltitude(options.altitude);\n\t\t\t}\n\t\t\tif (options?.interactive !== undefined) {\n\t\t\t\tupdateInteractivity(containerObject, options.interactive, this.#state);\n\t\t\t}\n\t\t\tif (options?.focusable !== undefined) {\n\t\t\t\tupdateFocusable(containerObject, options.focusable);\n\t\t\t}\n\t\t\tif (options?.preloadGeometry !== undefined) {\n\t\t\t\tcontainerObject.userData.preloadGeometry = options.preloadGeometry;\n\t\t\t}\n\t\t\tthis.#state.geometry3DMap.set(id, containerObject);\n\t\t\tconst parentContainer = this.getParentContainer(parent);\n\t\t\tif (parentContainer instanceof GroupContainerObject3D) {\n\t\t\t\tparentContainer.addEntity(containerObject);\n\t\t\t}\n\n\t\t\tthis.#invalidate3DEntities();\n\t\t\tthis.render();\n\t\t} else {\n\t\t\tLogger.error(`Group container with ID '${id}' already exists. The group container cannot be added.`);\n\t\t}\n\n\t\treturn { id, type: 'group-container' } as EntityId<GroupContainerState>;\n\t}\n\n\tgetParentContainer = (\n\t\tparent?: EntityId<GroupContainerState> | EntityId<GeometryState> | string | number | null,\n\t\tdefaultToScene = true,\n\t): GroupContainerObject3D | undefined => {\n\t\tif (!parent) {\n\t\t\treturn defaultToScene ? this.#state.entityScene : undefined;\n\t\t}\n\n\t\tif (typeof parent === 'string' || typeof parent === 'number') {\n\t\t\tconst parentEntity = this.#state.geometry3DMap.get(parent);\n\n\t\t\tif (parentEntity instanceof GroupContainerObject3D) {\n\t\t\t\treturn parentEntity;\n\t\t\t} else {\n\t\t\t\tLogger.warn(\n\t\t\t\t\t`Parent (${\n\t\t\t\t\t\ttypeof parent === 'object' ? (parent as EntityId<GroupContainerState>).id : parent\n\t\t\t\t\t}) is not a valid container, adding to scene`,\n\t\t\t\t);\n\n\t\t\t\treturn defaultToScene ? this.#state.entityScene : undefined;\n\t\t\t}\n\t\t} else if (parent.type === 'group-container') {\n\t\t\tconst parentContainer = this.#state.geometry3DMap.get(parent.id);\n\t\t\tif (parentContainer instanceof GroupContainerObject3D) {\n\t\t\t\treturn parentContainer;\n\t\t\t}\n\t\t}\n\n\t\treturn defaultToScene ? this.#state.entityScene : undefined;\n\t};\n\n\t/**\n\t * Add a custom THREE.js entity to the map. The geometry is placed at the GeoJSON coordinate and includes a `setup` and `update` methods.\n\t * Setup is called when the first time the geometry visible, and update is called every render frame.\n\t */\n\taddCustomGeometry(\n\t\tid: string,\n\t\tfeature: Feature<Point>,\n\t\tbuilder: CustomGeometryBuilder,\n\t\tstyle?: { visible?: boolean; altitude?: number; interactive?: boolean },\n\t\tparent?: EntityId<GroupContainerState> | string | number | null,\n\t) {\n\t\tif (!this.#state.geometry3DMap.has(id)) {\n\t\t\tconst geometry = new CustomGeometryComponent(feature, builder);\n\t\t\tconst entity = new Geometry3D(geometry, new StyleComponent(style));\n\n\t\t\tif (style?.interactive !== undefined) {\n\t\t\t\tupdateInteractivity(entity, style.interactive, this.#state);\n\t\t\t}\n\t\t\tentity.id = id;\n\n\t\t\tgeometry.mesh.userData = {\n\t\t\t\tentityId: id,\n\t\t\t\ttype: 'custom-geometry',\n\t\t\t};\n\n\t\t\tthis.#state.geometry3DMap.set(entity.id, entity);\n\n\t\t\tconst parentContainer = this.getParentContainer(parent);\n\t\t\tif (parent && parentContainer instanceof GroupContainerObject3D) {\n\t\t\t\tparentContainer.addEntity(entity);\n\t\t\t} else {\n\t\t\t\tthis.#state.entityScene.addEntity(entity);\n\t\t\t}\n\t\t\tthis.#invalidate3DEntities();\n\t\t\tthis.render();\n\t\t} else {\n\t\t\tLogger.error(`Custom geometry with ID '${id}' already exists. The custom geometry cannot be added.`);\n\t\t}\n\n\t\treturn {\n\t\t\tid,\n\t\t\ttype: 'custom-geometry',\n\t\t} as EntityId<ShapeState>;\n\t}\n\n\t/**\n\t * Add a geometry group from GeoJSON data\n\t */\n\taddGeometryGroup<T extends FeatureCollection<Polygon | MultiPolygon | LineString, any>>(\n\t\tid: string,\n\t\tgeometry: T,\n\t\tstyle?: T extends FeatureCollection<LineString, any> ? LineStyle : PaintStyle,\n\t\tparent?: EntityId<GroupContainerState> | string | number | null,\n\t) {\n\t\tif (!this.#state.geometry3DMap.has(id) && !this.#state.geometry2DMap.has(id)) {\n\t\t\tconst groupObject = new GeometryGroupObject3D(id);\n\t\t\tgroupObject.addEventListener('childadded', () => {\n\t\t\t\tthis.#invalidate3DEntities();\n\t\t\t\tthis.#invalidate2DEntities();\n\t\t\t});\n\t\t\tgroupObject.addEventListener('childremoved', () => {\n\t\t\t\tthis.#invalidate3DEntities();\n\t\t\t\tthis.#invalidate2DEntities();\n\t\t\t});\n\n\t\t\tgroupObject.userData.dirty = true;\n\n\t\t\tthis.#state.geometry3DMap.set(id, groupObject);\n\t\t\tconst { visible, ...rest } = style || { color: DEFAULT_COLOR };\n\t\t\tfor (const feature of geometry.features) {\n\t\t\t\tif (feature.geometry == null) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (!['Polygon', 'MultiPolygon', 'LineString', 'MultiLineString'].includes(feature.geometry.type)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst id = feature?.id || feature?.properties?.id || randomId();\n\n\t\t\t\tconst entity = this.#systems.meshOptimizationSystem.createEntityFromFeature(id, feature, {\n\t\t\t\t\toutline: true, // default to true unless overwritten by the user\n\t\t\t\t\t...rest,\n\t\t\t\t});\n\t\t\t\tthis.#state.geometry3DMap.set(id, entity);\n\t\t\t\tgroupObject.userData.entities3D.add(id);\n\t\t\t\tthis.#systems.textureSystem.dirty = true;\n\t\t\t}\n\t\t\tgroupObject.setVisible(visible ?? true);\n\n\t\t\tconst parentContainer = this.getParentContainer(parent);\n\t\t\tif (parentContainer instanceof GroupContainerObject3D) {\n\t\t\t\tparentContainer.addEntity(groupObject);\n\t\t\t}\n\t\t\tthis.#invalidate3DEntities();\n\t\t\tthis.render();\n\t\t} else {\n\t\t\tLogger.error(`Geometry group with ID '${id}' already exists. The geometry group cannot be added.`);\n\t\t}\n\n\t\tthis.#systems.outlineInterpolationSystem.geometries3DDirty = true;\n\n\t\treturn { id, type: 'geometry-group' } as EntityId<GeometryGroupState>;\n\t}\n\n\taddOccluder<T extends Feature<Polygon | MultiPolygon, any>>(\n\t\tfeature: T,\n\t\tparent?: EntityId<GroupContainerState> | string | number | null,\n\t): number {\n\t\tconst parentContainer = this.getParentContainer(parent);\n\n\t\tconst occluderId = this.#systems.occlusion2DSystem.reserveOccluderId();\n\t\tparentContainer?.addOccluderFeature(feature, occluderId);\n\n\t\treturn occluderId;\n\t}\n\n\taddImage(\n\t\tid: string,\n\t\tgeometry: Feature<Point, ImageProperties>,\n\t\tstyle: ImageStyle,\n\t\tparent?: EntityId<GroupContainerState> | string | null,\n\t) {\n\t\ttry {\n\t\t\tvalidateImage(id, geometry, style);\n\t\t} catch (error: unknown) {\n\t\t\tLogger.error(error);\n\n\t\t\treturn;\n\t\t}\n\t\tif (!this.#state.geometry3DMap.has(id) && !this.#state.geometry2DMap.has(id)) {\n\t\t\tconst meshComponent = new ImageComponent(geometry);\n\n\t\t\tconst entity = new Geometry3D(meshComponent, new StyleComponent(style));\n\t\t\tentity.id = id || randomId();\n\t\t\tmeshComponent.mesh.userData = {\n\t\t\t\tentityId: entity.id,\n\t\t\t\ttype: 'path',\n\t\t\t};\n\n\t\t\tthis.#state.geometry3DMap.set(entity.id, entity);\n\n\t\t\tconst parentContainer = this.getParentContainer(parent);\n\t\t\tif (parentContainer instanceof GroupContainerObject3D) {\n\t\t\t\tparentContainer.addEntity(entity);\n\t\t\t}\n\n\t\t\tthis.#invalidate3DEntities();\n\t\t\tthis.render();\n\t\t} else {\n\t\t\tLogger.error(`Image with ID '${id}' already exists. The image cannot be added.`);\n\t\t}\n\n\t\treturn { id, type: 'image' } as EntityId<ImageState>;\n\t}\n\n\t/**\n\t * Add a group of models from GeoJSON data. These will be instanced automatically for better performance.\n\t */\n\taddModelGroup(\n\t\tid: string,\n\t\tgeometry: FeatureCollection<Point, ModelProperties>,\n\t\tstyle: Partial<InitializeModelState>,\n\t\t{\n\t\t\tparent,\n\t\t\tonComplete: onAdd,\n\t\t}: {\n\t\t\tparent?: EntityId<GroupContainerState> | string | null;\n\t\t\tonComplete?: () => void;\n\t\t} = {},\n\t) {\n\t\ttry {\n\t\t\tvalidateModelGroup(id, geometry, style);\n\t\t} catch (error: unknown) {\n\t\t\tLogger.error(error);\n\n\t\t\treturn;\n\t\t}\n\t\tif (!this.#state.geometry3DMap.has(id) && !this.#state.geometry2DMap.has(id)) {\n\t\t\tconst groupObject = new GeometryGroupObject3D(id);\n\t\t\tgroupObject.addEventListener('childadded', () => {\n\t\t\t\tthis.#invalidate3DEntities();\n\t\t\t\tthis.#invalidate2DEntities();\n\t\t\t});\n\t\t\tgroupObject.addEventListener('childremoved', () => {\n\t\t\t\tthis.#invalidate3DEntities();\n\t\t\t\tthis.#invalidate2DEntities();\n\t\t\t});\n\t\t\tthis.#state.geometry3DMap.set(id, groupObject);\n\n\t\t\tgroupObject.userData.dirty = true;\n\t\t\tgroupObject.userData.modelURL = style.url;\n\t\t\tfor (const feature of geometry.features) {\n\t\t\t\tconst id = feature.id || feature.properties.id || randomId();\n\t\t\t\tconst entity = this.#systems.meshOptimizationSystem.createModelFromFeature(id, feature, {\n\t\t\t\t\t...style,\n\t\t\t\t});\n\t\t\t\tif (feature.properties.interactive !== undefined || style.interactive != null) {\n\t\t\t\t\tupdateInteractivity(entity, feature.properties.interactive ?? style.interactive, this.#state);\n\t\t\t\t}\n\t\t\t\tif (style.clippingPlaneZOffset != null) {\n\t\t\t\t\tentity.components[Geometry3DComponents.ClippingPlane] = new ClippingPlaneComponent();\n\t\t\t\t\tentity.components[Geometry3DComponents.ClippingPlane].verticalOffset = style.clippingPlaneZOffset;\n\t\t\t\t}\n\t\t\t\t// store the parent id on the geometry so we can handle cases where we want to remove the geometry from the group\n\t\t\t\t// before the mesh is created\n\t\t\t\tentity.parentId = groupObject.userData.entityId;\n\t\t\t\tthis.#state.geometry3DMap.set(id, entity);\n\t\t\t\tgroupObject.userData.entities3D.add(id);\n\t\t\t}\n\n\t\t\tconst parentContainer = this.getParentContainer(parent);\n\t\t\tif (parentContainer instanceof GroupContainerObject3D) {\n\t\t\t\tparentContainer.addEntity(groupObject);\n\t\t\t}\n\t\t\tthis.#invalidate3DEntities();\n\t\t\tthis.render()?.then(onAdd);\n\t\t} else {\n\t\t\tLogger.error(`Model group with ID '${id}' already exists. The model group cannot be added.`);\n\t\t}\n\n\t\treturn { id, type: 'geometry-group' } as EntityId<GeometryGroupState>;\n\t}\n\n\t#createEntity2D(\n\t\tcoordinate: Position,\n\t\tcomponent: MarkerComponent | LabelComponent,\n\t\toccluderId?: number,\n\t\tverticalOffset?: number,\n\t) {\n\t\tconst entity = new Geometry2D(\n\t\t\tcomponent,\n\t\t\tthis.convertTo3DMapPosition(coordinate[1], coordinate[0], coordinate[2] || 0),\n\t\t\tverticalOffset,\n\t\t);\n\t\tentity.occluderId = occluderId ?? this.#systems.occlusion2DSystem.backgroundId;\n\t\tthis.#state.geometry2DMap.set(entity.id, entity);\n\n\t\treturn entity;\n\t}\n\n\t/**\n\t * Add an HTML Marker at a GeoJSON coordinate.\n\t */\n\taddMarker2D(\n\t\tcoordinate: Position,\n\t\tcontentHTML: string,\n\t\toptions?: AddMarkerOptions,\n\t\tparent?: EntityId<GroupContainerState> | string | number | null,\n\t) {\n\t\tlet entityId = options?.id;\n\n\t\ttry {\n\t\t\tvalidateMarker(coordinate, contentHTML, options || {});\n\t\t} catch (error: unknown) {\n\t\t\tLogger.error(error);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tentityId === undefined ||\n\t\t\t(!this.#state.geometry2DMap.has(entityId) && !this.#state.geometry3DMap.has(entityId))\n\t\t) {\n\t\t\tconst entity = this.#createEntity2D(\n\t\t\t\tcoordinate,\n\t\t\t\tnew MarkerComponent(contentHTML, options),\n\t\t\t\toptions?.occluderId,\n\t\t\t\toptions?.verticalOffset,\n\t\t\t);\n\t\t\tentity.id = entityId || String(entity.id);\n\t\t\tentityId = entity.id;\n\n\t\t\t// only add an interactive component if the marker's not set to pointer-events-auto\n\t\t\tif (options?.interactive != null && options.interactive !== 'pointer-events-auto') {\n\t\t\t\tupdateInteractivity(entity, options?.interactive, this.#state);\n\t\t\t}\n\t\t\tif (options?.enabled != null) {\n\t\t\t\tupdateEnabled(entity, options.enabled);\n\t\t\t}\n\n\t\t\tconst attachedEntity =\n\t\t\t\ttypeof options?.attachTo === 'string' || typeof options?.attachTo === 'number'\n\t\t\t\t\t? this.#state.geometry3DMap.get(options.attachTo)\n\t\t\t\t\t: undefined;\n\t\t\tif (attachedEntity instanceof Geometry3D) {\n\t\t\t\tattachedEntity.attach(entity);\n\t\t\t}\n\n\t\t\tthis.getParentContainer(parent)?.addEntity(entity);\n\t\t\tthis.render();\n\t\t} else {\n\t\t\tLogger.error(`Marker2D with ID '${entityId}' already exists. The marker cannot be added.`);\n\t\t}\n\n\t\treturn {\n\t\t\tid: entityId,\n\t\t\ttype: 'marker',\n\t\t} as EntityId<MarkerState>;\n\t}\n\n\taddText3D(\n\t\tid: string,\n\t\tgeometry: Feature<Point, FloatingFloorTextProperties>,\n\t\toptions: AddText3DOptions,\n\t\tparent?: EntityId<GroupContainerState> | string | null,\n\t) {\n\t\tif (!this.#state.geometry3DMap.has(id) && !this.#state.geometry2DMap.has(id)) {\n\t\t\tconst textComponent = new Text3DComponent({\n\t\t\t\t...geometry,\n\t\t\t\tproperties: {\n\t\t\t\t\t...geometry.properties,\n\t\t\t\t\tid,\n\t\t\t\t\tcontent: geometry.properties.text,\n\t\t\t\t},\n\t\t\t});\n\t\t\tconst entity = new Geometry3D(textComponent, new Text3DStyleComponent(options?.appearance));\n\t\t\tentity.id = id;\n\n\t\t\ttextComponent.mesh.userData.entityId = id.toString();\n\t\t\ttextComponent.mesh.userData.type = 'text3d';\n\n\t\t\tthis.#state.geometry3DMap.set(id, entity);\n\n\t\t\tconst parentContainer = this.getParentContainer(parent);\n\t\t\tif (parentContainer instanceof GroupContainerObject3D) {\n\t\t\t\tparentContainer.addEntity(entity);\n\t\t\t}\n\n\t\t\tthis.#invalidate3DEntities();\n\t\t\tthis.render();\n\t\t} else {\n\t\t\tLogger.error(`Text3D with ID '${id}' already exists. The text3d cannot be added.`);\n\t\t}\n\n\t\treturn { id, type: 'text3d' } as EntityId<Text3DState>;\n\t}\n\n\t/**\n\t * Labels an existing 3D geometry with a text area.\n\t *\n\t * @param meshGeometryId - The ID of the target 3D geometry to label.\n\t * @param content - The text content to display.\n\t * @param options - Additional options for adding the text label, including:\n\t *   - parentId: Optional ID of the parent container.\n\t *   - appearance: Optional appearance settings for the text label.\n\t *\n\t * @returns An object containing the ID and type of the created or existing text label, or undefined if labeling failed. If geometry is already labeld, the same text id will be returned\n\t *\n\t * @example\n\t * ```typescript\n\t * const label = renderer.labelText3D('geometry123', 'Hello World', { parentId: 'parent456', appearance: { color: 'red' } });\n\t * if (label) {\n\t *   console.log(`Label created with ID: ${label.id}`);\n\t * }\n\t *\n\t */\n\tlabelText3D(meshGeometryId: string, content: string, options: AddText3DOptions & { parentId?: string } = {}) {\n\t\ttry {\n\t\t\tif (!content || !meshGeometryId) {\n\t\t\t\tthrow new Error('content and meshGeometryId are required');\n\t\t\t}\n\t\t\taddText3DOptionsSchema.parse(options);\n\t\t} catch (error: unknown) {\n\t\t\tLogger.error(error);\n\n\t\t\treturn;\n\t\t}\n\t\tconst targetGeometry3D = this.#state.geometry3DMap.get(meshGeometryId);\n\t\tif (targetGeometry3D?.type !== 'geometry') {\n\t\t\tLogger.error('.labelText3D failed: target incorrect');\n\n\t\t\treturn;\n\t\t}\n\t\tconst targetMeshComponent = targetGeometry3D?.components[Geometry3DComponents.Mesh];\n\n\t\t// Skip labeling due to missing textArea property\n\t\tif (!targetMeshComponent.feature.properties.textArea) {\n\t\t\treturn;\n\t\t}\n\n\t\t// return existing label id if exists\n\t\tif (targetMeshComponent.textEntityId) {\n\t\t\tconst existing = this.#state.geometry3DMap.get(targetMeshComponent.textEntityId);\n\t\t\tif (existing?.type !== 'text3d') {\n\t\t\t\tLogger.error('.labelText3D failed: existing text3d not found');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tid: existing.id,\n\t\t\t\ttype: existing.type,\n\t\t\t};\n\t\t}\n\n\t\tconst textComponent = new Text3DComponent({\n\t\t\ttype: 'Feature',\n\t\t\tgeometry: {\n\t\t\t\tcoordinates: targetMeshComponent.feature.properties.textArea?.position,\n\t\t\t\ttype: 'Point',\n\t\t\t},\n\t\t\tproperties: { textArea: targetMeshComponent.feature.properties.textArea, content, id: randomId() },\n\t\t});\n\n\t\ttextComponent.polygonEntityId = meshGeometryId;\n\t\tconst entity = new Geometry3D(textComponent, new Text3DStyleComponent(options?.appearance));\n\t\ttargetMeshComponent.textEntityId = entity.id.toString();\n\t\ttextComponent.mesh.userData.entityId = entity.id.toString();\n\t\ttextComponent.mesh.userData.type = 'text3d';\n\n\t\tthis.#state.geometry3DMap.set(entity.id.toString(), entity);\n\n\t\tif (options.parentId) {\n\t\t\tthis.getParentContainer(options.parentId)?.addEntity(entity);\n\t\t}\n\n\t\tthis.render();\n\n\t\treturn {\n\t\t\tid: entity.id,\n\t\t\ttype: 'text3d',\n\t\t} as EntityId<Text3DState>;\n\t}\n\n\t/**\n\t * Add a 2D label at a GeoJSON coordinate.\n\t */\n\taddLabel2D(\n\t\tcoordinate: Position,\n\t\ttext: string,\n\t\toptions?: AddLabelOptionsInternal,\n\t\tparent?: EntityId<GroupContainerState> | string | null,\n\t) {\n\t\tlet entityId = options?.id;\n\n\t\ttry {\n\t\t\tvalidateLabel(coordinate, text, options || {});\n\t\t} catch (error: unknown) {\n\t\t\tLogger.error(error);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tentityId === undefined ||\n\t\t\t(!this.#state.geometry2DMap.has(entityId) && !this.#state.geometry3DMap.has(entityId))\n\t\t) {\n\t\t\tconst entity = this.#createEntity2D(\n\t\t\t\tcoordinate,\n\t\t\t\tnew LabelComponent(text, options || {}, this.#state),\n\t\t\t\toptions?.occluderId,\n\t\t\t\toptions?.verticalOffset,\n\t\t\t);\n\t\t\tentity.id = entityId || String(entity.id);\n\t\t\tentityId = entity.id;\n\t\t\tif (options?.interactive != null) {\n\t\t\t\tupdateInteractivity(entity, options?.interactive, this.#state);\n\t\t\t}\n\t\t\tif (options?.enabled != null) {\n\t\t\t\tupdateEnabled(entity, options.enabled);\n\t\t\t}\n\n\t\t\tconst attachedEntity =\n\t\t\t\ttypeof options?.attachTo === 'string' || typeof options?.attachTo === 'number'\n\t\t\t\t\t? this.#state.geometry3DMap.get(options.attachTo)\n\t\t\t\t\t: undefined;\n\t\t\tif (attachedEntity instanceof Geometry3D) {\n\t\t\t\tattachedEntity.attach(entity);\n\t\t\t}\n\n\t\t\tthis.getParentContainer(parent)?.addEntity(entity);\n\n\t\t\tthis.#invalidate2DEntities();\n\t\t\tthis.render();\n\t\t} else {\n\t\t\tLogger.error(`Label2D with ID '${entityId}' already exists. The label cannot be added.`);\n\t\t}\n\n\t\treturn {\n\t\t\tid: entityId,\n\t\t\ttype: 'label',\n\t\t} as EntityId<LabelState>;\n\t}\n\n\t/**\n\t * Add a Path along a set of GeoJSON coordinates that can be animated.\n\t */\n\taddPath(\n\t\tgeometry: FeatureCollection<Point, PathProperties>,\n\t\toptions: AddPathOptions = {},\n\t\tparent?: EntityId<GroupContainerState> | string | null,\n\t) {\n\t\ttry {\n\t\t\tvalidatePath(geometry, options || {});\n\t\t} catch (error: unknown) {\n\t\t\tLogger.error(error);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst meshComponent = new PathComponent(geometry, pickPathOptions(options));\n\n\t\tconst entity = new Geometry3D(\n\t\t\tmeshComponent,\n\t\t\tnew StyleComponent({\n\t\t\t\tcolor: options?.color ?? '#ff834c',\n\t\t\t\taltitude: options?.verticalOffset ?? 0.1,\n\t\t\t}),\n\t\t);\n\t\tentity.id = options?.id || randomId();\n\t\tmeshComponent.mesh.userData = {\n\t\t\t// @ts-ignore\n\t\t\tentityId: entity.id,\n\t\t\ttype: 'path',\n\t\t};\n\n\t\tthis.#state.geometry3DMap.set(entity.id, entity);\n\t\tif (options?.interactive != null) {\n\t\t\tupdateInteractivity(entity, options?.interactive, this.#state);\n\t\t}\n\n\t\tconst parentContainer = this.getParentContainer(parent);\n\t\tif (parentContainer instanceof GroupContainerObject3D) {\n\t\t\tparentContainer.addEntity(entity);\n\t\t}\n\n\t\tthis.#invalidate3DEntities();\n\t\tthis.render();\n\n\t\treturn {\n\t\t\tid: entity.id,\n\t\t\ttype: 'path',\n\t\t} as EntityId<PathState>;\n\t}\n\n\t/**\n\t * Updates the watermark on the map.\n\t *\n\t * @param options {WatermarkUpdateOptions}\n\t */\n\tupdateWatermark(options: WatermarkUpdateOptions) {\n\t\tthis.#systems.watermarkSystem.options = options;\n\t\tthis.#systems.watermarkSystem.dirty = true;\n\t\tthis.#systems.collisionSystem.collidersDirty = true;\n\t\tthis.render();\n\t}\n\n\t/**\n\t * Remove an entity from the renderer and release associated resources.\n\t */\n\tremove(object: string | number): void;\n\tremove(object: EntityTypes): void;\n\tremove(object: string | number | EntityTypes) {\n\t\tlet geometry: EntityTypes | undefined;\n\t\tif (typeof object === 'string' || typeof object === 'number') {\n\t\t\tgeometry = this.#state.geometry2DMap.get(object);\n\t\t\tif (geometry == null) {\n\t\t\t\tgeometry = this.#state.geometry3DMap.get(object);\n\t\t\t}\n\t\t} else if (typeof object.id === 'string' || typeof object.id === 'number') {\n\t\t\tgeometry = this.#state.geometry2DMap.get(object.id);\n\t\t\tif (geometry == null) {\n\t\t\t\tgeometry = this.#state.geometry3DMap.get(object.id);\n\t\t\t}\n\t\t} else {\n\t\t\tgeometry = object as EntityTypes;\n\t\t}\n\n\t\tif (geometry == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (geometry.type === 'custom-geometry') {\n\t\t\tthis.#state.geometry3DMap.delete(geometry.id);\n\t\t\tif (geometry.object3d) {\n\t\t\t\tdestroyObject3D(geometry.object3d);\n\t\t\t}\n\t\t} else if (geometry.type === 'group-container') {\n\t\t\tthis.#state.geometry3DMap.delete(geometry.userData.entityId);\n\t\t\tfor (const entityId of geometry.childrenIds.values()) {\n\t\t\t\tthis.remove(entityId);\n\t\t\t\tgeometry.userData.entities2D.delete(entityId);\n\t\t\t}\n\t\t\tconst focusComponent = geometry.components[GroupContainerComponents.Focusable];\n\t\t\tif (focusComponent && focusComponent.focusMesh) {\n\t\t\t\tdestroyObject3D(focusComponent.focusMesh);\n\t\t\t}\n\t\t\tdestroyObject3D(geometry);\n\t\t} else if (geometry.type === 'geometry-group') {\n\t\t\tthis.#state.geometry3DMap.delete(geometry.userData.entityId);\n\t\t\tfor (const entityId of geometry.userData.entities3D.values()) {\n\t\t\t\tthis.remove(entityId);\n\t\t\t\tgeometry.userData.entities3D.delete(entityId);\n\t\t\t}\n\t\t\tdestroyObject3D(geometry);\n\t\t} else if (geometry.type === 'geometry' || geometry.type === 'model' || geometry.type === 'path') {\n\t\t\tconst meshComponent = geometry.components[Geometry3DComponents.Mesh];\n\t\t\tconst focusableComponent = geometry.components[Geometry3DComponents.Focusable];\n\t\t\tif (geometry.entities2D.size > 0) {\n\t\t\t\t// remove all the 2D entities from the parent\n\t\t\t\tfor (const entity of geometry.entities2D.values()) {\n\t\t\t\t\tthis.remove(entity);\n\t\t\t\t}\n\t\t\t\t// and clean up the geometry3D\n\t\t\t\tgeometry.removeAllEntities();\n\t\t\t}\n\t\t\tconst parentGroupId = geometry.parentObject3D?.userData.entityId ?? geometry.parentId;\n\t\t\tif (parentGroupId) {\n\t\t\t\tconst group = this.#state.geometry3DMap.get(parentGroupId);\n\t\t\t\tif (group instanceof GeometryGroupObject3D) {\n\t\t\t\t\tgroup.userData.entities3D.delete(geometry.id);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (geometry.object3d) {\n\t\t\t\tdestroyObject3D(geometry.object3d);\n\t\t\t}\n\t\t\tif (geometry.type === 'geometry') {\n\t\t\t\tconst outlineComponent = geometry.components[Geometry3DComponents.Outline];\n\t\t\t\tif (outlineComponent) {\n\t\t\t\t\toutlineComponent.enabled = false;\n\t\t\t\t\toutlineComponent.dirty = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (focusableComponent && 'focusMesh' in focusableComponent && focusableComponent.focusMesh != null) {\n\t\t\t\tdestroyObject3D(focusableComponent.focusMesh);\n\t\t\t}\n\t\t\tif ('textMesh' in meshComponent && meshComponent.textMesh != null) {\n\t\t\t\tthis.remove(meshComponent.textMesh.userData.entityId);\n\t\t\t}\n\t\t\tthis.#state.geometry3DMap.delete(geometry.id);\n\t\t} else if (geometry.type === 'marker' || geometry.type === 'label') {\n\t\t\tconst parentId = geometry.attachedTo;\n\t\t\tif (parentId) {\n\t\t\t\tconst parent = this.#state.geometry3DMap.get(parentId);\n\t\t\t\tif (parent instanceof Geometry3D) {\n\t\t\t\t\t// make sure we remove the entity from the parent\n\t\t\t\t\tparent.detach(geometry);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (geometry.object3d) {\n\t\t\t\tdestroyObject3D(geometry.object3d);\n\t\t\t}\n\t\t\tif (geometry.type === 'label') {\n\t\t\t\tdelete this.#systems.twoDDrawSystem.textCache[geometry.id];\n\t\t\t}\n\t\t\tthis.#state.geometry2DMap.delete(geometry.id);\n\t\t} else if (geometry.type === 'image') {\n\t\t\tif (geometry.object3d) {\n\t\t\t\tdestroyObject3D(geometry.object3d);\n\t\t\t}\n\t\t\tthis.#state.geometry3DMap.delete(geometry.id);\n\t\t} else if (geometry.type === 'text3d') {\n\t\t\tdestroyObject3D(geometry.object3d);\n\t\t\tconst { batchedText, textMesh, polygonEntityId } = geometry.components[Geometry3DComponents.Mesh];\n\t\t\tif (textMesh) {\n\t\t\t\tif (batchedText) {\n\t\t\t\t\tbatchedText.removeText(textMesh);\n\t\t\t\t}\n\t\t\t\tdestroyObject3D(textMesh);\n\t\t\t}\n\t\t\tif (polygonEntityId) {\n\t\t\t\tthis.#systems.text3DSystem.remove(polygonEntityId);\n\t\t\t\tconst meshGeometry3D = this.#state.geometry3DMap.get(polygonEntityId);\n\t\t\t\tif (meshGeometry3D?.type === 'geometry') {\n\t\t\t\t\tmeshGeometry3D.components[Geometry3DComponents.Mesh].textMesh = undefined;\n\t\t\t\t\tmeshGeometry3D.components[Geometry3DComponents.Mesh].textEntityId = undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.#state.geometry3DMap.delete(geometry.id);\n\t\t}\n\n\t\tthis.#invalidate3DEntities();\n\t\tthis.#invalidate2DEntities();\n\t\tthis.render();\n\t}\n\n\t/**\n\t * Show collision boxes for 2D entities for debugging\n\t */\n\tshowCollisionBoxes = () => {\n\t\tthis.#systems.collisionSystem.showCollisionBoxes();\n\t\tthis.render();\n\t};\n\n\t/**\n\t * Hide collision boxes for 2D entities for debugging\n\t */\n\thideCollisionBoxes = () => {\n\t\tthis.#systems.collisionSystem.hideCollisionBoxes();\n\t\tthis.render();\n\t};\n\n\t/**\n\t * Recursively get the state for the whole scene. Can be an expensive operation.\n\t */\n\tgetScene() {\n\t\treturn this.getState<GroupContainerState>('__scene');\n\t}\n\n\tgetThreeScene() {\n\t\treturn this.#scene;\n\t}\n\tgetThreeCamera() {\n\t\treturn this.#cameraObject;\n\t}\n\n\tasync setEnvironment(update: EnvMapOptions) {\n\t\tif (!this.#scene) return;\n\t\tif (update === 'basic') {\n\t\t\tif (!this.#cachedBasicEnvMapPromise) this.#cachedBasicEnvMapPromise = this.#loadEnvMap();\n\t\t\tconst texture = await this.#cachedBasicEnvMapPromise;\n\t\t\tthis.#scene.environment = texture;\n\t\t} else {\n\t\t\tthis.#scene.environment = null;\n\t\t}\n\t}\n\n\tgetEnvironment(): EnvMapOptions {\n\t\treturn this.#scene?.environment ? 'basic' : false;\n\t}\n\t/**\n\t * Get the current scene as a GLB file\n\t */\n\tgetCurrentSceneGLTF(options: GLTFExportOptions) {\n\t\treturn this.#systems.exporterSystem.getCurrentSceneGLTF(options);\n\t}\n\n\t/**\n\t * Gets the bounding area (4 corners) in lon,lat of a geometry, geomrtry group, or group container. This can be used with Camera to focus on an entity\n\t */\n\tgetBoundingArea(geometryOrGeometryId?: string | number | EntityId<EntityState>) {\n\t\tif (this.#systems.renderSystem.threeDdirty || this.#systems.renderSystem.twoDdirty) {\n\t\t\tthis.renderSync();\n\t\t}\n\t\tconst box = new Box3();\n\t\tif (geometryOrGeometryId == null) {\n\t\t\tbox.setFromObject(this.#state.entityScene);\n\t\t} else {\n\t\t\tconst geometryEntity = getGeometryByGeometryId(this.#state, geometryOrGeometryId);\n\t\t\tif (geometryEntity?.type === 'geometry' && geometryEntity?.object3d != null) {\n\t\t\t\tconst component = geometryEntity.components[Geometry3DComponents.Mesh];\n\t\t\t\tconst geometry = component instanceof MeshComponent ? component.geometry : undefined;\n\t\t\t\tif (component.mesh instanceof BatchedMesh && geometry) {\n\t\t\t\t\t// when it's batched meshes we want to compute bounding box of the geometry which contains the data for the geometry itself\n\t\t\t\t\tgeometry.computeBoundingBox();\n\t\t\t\t\tif (geometry.boundingBox) {\n\t\t\t\t\t\tbox.union(geometry.boundingBox);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tbox.setFromObject(geometryEntity.object3d);\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\t(geometryEntity?.type === 'geometry-group' || geometryEntity?.type === 'group-container') &&\n\t\t\t\tgeometryEntity?.userData.entityId != null\n\t\t\t) {\n\t\t\t\tbox.setFromObject(geometryEntity);\n\t\t\t}\n\t\t}\n\t\tif (isFiniteBox(box)) {\n\t\t\treturn getCornersOfBoundingBox(box).map(this.convert3DMapPositionToCoordinate);\n\t\t}\n\t}\n\n\t/**\n\t * Check if the state for a given geometry or geometry id exists\n\t * @param geometryOrGeometryId - The geometry or geometry id to check\n\t * @returns True if the state exists, false otherwise\n\t */\n\thasState(geometryOrGeometryId: string | number | EntityId<EntityState>) {\n\t\treturn getGeometryByGeometryId(this.#state, geometryOrGeometryId) != null;\n\t}\n\n\t/**\n\t * Get the current state of the map view, or any entity that was added, regardless of whether it is visible in the scene\n\t */\n\tgetState(): MapViewState;\n\tgetState<T extends EntityId<EntityState>>(\n\t\tgeometryOrGeometryId: T,\n\t): T extends EntityId<LabelState>\n\t\t? LabelState\n\t\t: T extends EntityId<GeometryState>\n\t\t? GeometryState\n\t\t: T extends EntityId<MarkerState>\n\t\t? MarkerState\n\t\t: T extends EntityId<GeometryGroupState>\n\t\t? GeometryGroupState\n\t\t: T extends EntityId<GroupContainerState>\n\t\t? GroupContainerState\n\t\t: T extends EntityId<ModelState>\n\t\t? ModelState\n\t\t: T extends EntityId<PathState>\n\t\t? PathState\n\t\t: T extends EntityId<ShapeState>\n\t\t? ShapeState\n\t\t: T extends EntityId<ImageState>\n\t\t? ImageState\n\t\t: T extends EntityId<Text3DState>\n\t\t? Text3DState\n\t\t: EntityState;\n\tgetState(geometryOrGeometryId?: Record<string | number, any> | string | number): EntityState;\n\tgetState<T extends EntityState>(\n\t\tgeometryOrGeometryId: T['id'],\n\t): T extends LabelState\n\t\t? LabelState\n\t\t: T extends GeometryState\n\t\t? GeometryState\n\t\t: T extends MarkerState\n\t\t? MarkerState\n\t\t: T extends GeometryGroupState\n\t\t? GeometryGroupState\n\t\t: T extends GroupContainerState\n\t\t? GroupContainerState\n\t\t: T extends ModelState\n\t\t? ModelState\n\t\t: T extends PathState\n\t\t? PathState\n\t\t: T extends ShapeState\n\t\t? ShapeState\n\t\t: T extends ImageState\n\t\t? ImageState\n\t\t: EntityState;\n\tgetState(geometryOrGeometryId?: Record<string | number, any> | string | number) {\n\t\tif (geometryOrGeometryId == null) {\n\t\t\treturn {\n\t\t\t\ttype: 'map-view',\n\t\t\t\thoverColor: this.#state.hoverColor,\n\t\t\t\ttext3dHoverColor: this.#state.text3dHoverColor,\n\t\t\t} satisfies MapViewState as MapViewState;\n\t\t}\n\t\tconst geometry = getGeometryByGeometryId(this.#state, geometryOrGeometryId);\n\n\t\tif (geometry?.type === 'custom-geometry') {\n\t\t\tconst component = geometry.components[Geometry3DComponents.Mesh] as CustomGeometryComponent;\n\t\t\tconst styleComponent = geometry.components[Geometry3DComponents.Style] as StyleComponent;\n\n\t\t\treturn {\n\t\t\t\tid: geometry.id,\n\t\t\t\ttype: 'custom-geometry',\n\t\t\t\tvisible: styleComponent.visible,\n\t\t\t\taltitude: styleComponent.altitude,\n\t\t\t\tparent: geometry.parentObject3D?.userData.entityId,\n\t\t\t\tposition: this.convert3DMapPositionToCoordinate(component.position!),\n\t\t\t} as ShapeState;\n\t\t} else if (geometry?.type === 'geometry-group') {\n\t\t\tconst children = Array.from(geometry.userData.entities3D.values());\n\t\t\t// leaving this here for backwards compatibility, but will remove it as move towards getting rid of the geometry group as an external entity\n\t\t\t// TODO: remove this once we have removed the geometry group as an external entity\n\t\t\tconst firstChildId = children?.[0];\n\t\t\tconst firstChildState = firstChildId ? this.getState<GeometryState>(firstChildId) : ({} as GeometryState);\n\n\t\t\treturn {\n\t\t\t\tid: geometry.userData.entityId,\n\t\t\t\ttype: 'geometry-group',\n\t\t\t\tvisible: geometry.visible,\n\t\t\t\taltitude: firstChildState?.altitude,\n\t\t\t\tinitialColor: firstChildState?.initialColor,\n\t\t\t\tcolor: firstChildState?.color,\n\t\t\t\tside: firstChildState?.side ?? 'double',\n\t\t\t\topacity: firstChildState?.opacity,\n\t\t\t\theight: firstChildState?.height,\n\t\t\t\ttexture: firstChildState?.texture,\n\t\t\t\ttopColor: firstChildState?.topColor,\n\t\t\t\ttopTexture: firstChildState?.topTexture,\n\t\t\t\tinteractive: Array.from(geometry.userData.entities3D.values())\n\t\t\t\t\t.map(entityId => this.#state.geometry3DMap.get(entityId))\n\t\t\t\t\t.every(e => e && (e as Geometry3D).components[Geometry3DComponents.Interaction] != null),\n\t\t\t\tchildren,\n\t\t\t\tbevel: firstChildState?.bevel,\n\t\t\t} as GeometryGroupState;\n\t\t} else if (geometry?.type === 'group-container') {\n\t\t\treturn {\n\t\t\t\tid: geometry.userData.entityId,\n\t\t\t\ttype: 'group-container',\n\t\t\t\tvisible: geometry.visible,\n\t\t\t\taltitude: geometry.getWorldPosition(tempVec).z ?? 0, // flooor altittude is always relates to the ground take world position altitude.\n\t\t\t\topacity: geometry.opacity,\n\t\t\t\tinteractive: !!geometry.components[GroupContainerComponents.Interaction],\n\t\t\t\tchildren: Array.from(geometry.childrenIds.values())\n\t\t\t\t\t.map(childId => this.getState(childId))\n\t\t\t\t\t.filter(Boolean),\n\t\t\t} as GroupContainerState;\n\t\t} else if (geometry?.type === 'label') {\n\t\t\tconst component = geometry.components[Geometry2DComponents.UI] as LabelComponent;\n\t\t\tconst parentObject = geometry.object3d.parent;\n\t\t\tconst parentId = parentObject?.userData.entityId;\n\n\t\t\treturn {\n\t\t\t\tid: geometry.id,\n\t\t\t\ttype: 'label',\n\t\t\t\ttext: component.text || '',\n\t\t\t\tparent: {\n\t\t\t\t\tid: parentId,\n\t\t\t\t\ttype: parentObject?.type,\n\t\t\t\t},\n\t\t\t\tposition: this.convert3DMapPositionToCoordinate(geometry.position),\n\t\t\t\tenabled: component.enabled,\n\t\t\t\tvisible: component.visible,\n\t\t\t\tinitialRank: convertNumberToCollisionRankingTier(component.initialRank),\n\t\t\t\toptions: {\n\t\t\t\t\trank: convertNumberToCollisionRankingTier(component.rank),\n\t\t\t\t\tappearance: component.appearance,\n\t\t\t\t\tinteractive: geometry.components[Geometry2DComponents.Interaction] != null,\n\t\t\t\t\tverticalOffset: geometry.verticalOffset,\n\t\t\t\t\tattachTo: geometry.attachedTo,\n\t\t\t\t},\n\t\t\t} as LabelState;\n\t\t} else if (geometry?.type === 'marker') {\n\t\t\tconst component = geometry.components[Geometry2DComponents.UI] as MarkerComponent;\n\t\t\tconst parentObject = geometry.object3d.parent;\n\t\t\tconst parentId = parentObject?.userData.entityId;\n\n\t\t\treturn {\n\t\t\t\tid: geometry.id,\n\t\t\t\ttype: 'marker',\n\t\t\t\tenabled: component.enabled,\n\t\t\t\tvisible: component.visible,\n\t\t\t\tplacement: component.options.placement,\n\t\t\t\tdynamicResize: component.options.dynamicResize,\n\t\t\t\tparent: {\n\t\t\t\t\tid: parentId,\n\t\t\t\t\ttype: parentObject?.type,\n\t\t\t\t},\n\t\t\t\tposition: this.convert3DMapPositionToCoordinate(geometry.position),\n\t\t\t\telement: component.containerEl,\n\t\t\t\tinitialRank: convertNumberToCollisionRankingTier(component.initialRank),\n\t\t\t\tcontentHTML: component.contentHtml,\n\t\t\t\toptions: {\n\t\t\t\t\trank: convertNumberToCollisionRankingTier(component.rank),\n\t\t\t\t\tinteractive: geometry.components[Geometry2DComponents.Interaction] != null || false,\n\t\t\t\t\tverticalOffset: geometry.verticalOffset,\n\t\t\t\t\tattachTo: geometry.attachedTo,\n\t\t\t\t\tlowPriorityPin: component.options.lowPriorityPin,\n\t\t\t\t},\n\t\t\t} as MarkerState;\n\t\t} else if (geometry?.type === 'geometry') {\n\t\t\tconst { color, hoverColor, initialColor, initialTopColor, topColor, altitude } =\n\t\t\t\tgeometry.components[Geometry3DComponents.Style];\n\t\t\tconst meshComponent = geometry.components[Geometry3DComponents.Mesh] as MeshComponent;\n\t\t\tconst focusableComponent = geometry.components[GroupContainerComponents.Focusable] as FocusableComponent;\n\t\t\tconst styleComponent = geometry.components[Geometry3DComponents.Style] as StyleComponent;\n\t\t\tconst textureComponent = geometry.components[Geometry3DComponents.TextureComponent] as TextureComponent;\n\t\t\tconst interactionComponent = geometry.components[Geometry3DComponents.Interaction] as InteractionComponent;\n\t\t\tconst outlineComponent = geometry.components[Geometry3DComponents.Outline] as OutlineComponent;\n\t\t\tconst parent = geometry.parentObject3D;\n\n\t\t\treturn {\n\t\t\t\tid: geometry.id,\n\t\t\t\ttype: 'geometry',\n\t\t\t\topacity: styleComponent.opacity,\n\t\t\t\tinitialColor,\n\t\t\t\tcolor,\n\t\t\t\tfocusable: focusableComponent != null && focusableComponent.focusMesh != null,\n\t\t\t\tinitialTopColor,\n\t\t\t\ttopColor,\n\t\t\t\tside: styleComponent.side,\n\t\t\t\thoverColor,\n\t\t\t\thovered: Boolean(interactionComponent?.hover),\n\t\t\t\theight: styleComponent.height,\n\t\t\t\tvisible: styleComponent.visible,\n\t\t\t\toutline: outlineComponent?.enabled,\n\t\t\t\tshowImage: styleComponent.showImage,\n\t\t\t\ttexture: textureComponent?.texture?.path,\n\t\t\t\ttopTexture: textureComponent?.topTexture?.path,\n\t\t\t\tflipImageToFaceCamera: styleComponent.flipImageToFaceCamera,\n\t\t\t\tenableImageCollisions: styleComponent.enableImageCollisions,\n\t\t\t\tparent: {\n\t\t\t\t\tid: parent?.userData.entityId,\n\t\t\t\t\ttype: parent?.type,\n\t\t\t\t},\n\t\t\t\taltitude,\n\t\t\t\tbevel: styleComponent.bevel,\n\t\t\t\t// TODO: should these be lazy getters? In which case we would only send a single copy of the state\n\t\t\t\tposition: this.convert3DMapPositionToCoordinate(meshComponent.position),\n\t\t\t\tinteractive: geometry.components[Geometry3DComponents.Interaction] != null,\n\t\t\t\tborderVisible: styleComponent.borderVisible,\n\t\t\t\tborderColor: styleComponent.borderColor,\n\t\t\t\tborderWidth: styleComponent.borderWidth,\n\t\t\t} as GeometryState;\n\t\t} else if (geometry?.type === 'model') {\n\t\t\tconst modelComponent = geometry.components[Geometry3DComponents.Mesh];\n\t\t\tconst styleComp = geometry.components[Geometry3DComponents.Style];\n\t\t\tconst interactionComponent = geometry.components[Geometry3DComponents.Interaction] as InteractionComponent;\n\n\t\t\treturn {\n\t\t\t\tid: geometry.id,\n\t\t\t\ttype: 'model',\n\t\t\t\tposition: modelComponent.mesh\n\t\t\t\t\t? this.convert3DMapPositionToCoordinate(modelComponent.mesh?.getWorldPosition(new Vector3()))\n\t\t\t\t\t: this.convert3DMapPositionToCoordinate(modelComponent.position),\n\t\t\t\tinteractive: interactionComponent != null,\n\t\t\t\tmaterial: styleComp.material,\n\t\t\t\tparent: geometry.parentObject3D?.parent\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tid: geometry.parentObject3D.parent.userData.entityId,\n\t\t\t\t\t\t\ttype: geometry.parentObject3D.parent.type,\n\t\t\t\t\t  }\n\t\t\t\t\t: undefined,\n\t\t\t\tvisible: styleComp.visible,\n\t\t\t\tverticalOffset: styleComp.verticalOffset,\n\t\t\t\tcolor: styleComp.color,\n\t\t\t\topacity: styleComp.opacity,\n\t\t\t\trotation: styleComp.rotation ?? DEFAULT_ROTATION,\n\t\t\t\tscale: styleComp.scale ?? DEFAULT_SCALE,\n\t\t\t} as ModelState;\n\t\t} else if (geometry?.type === 'path') {\n\t\t\tconst pathComponent = geometry.components[Geometry3DComponents.Mesh] as PathComponent;\n\t\t\tconst interactionComponent = geometry.components[Geometry3DComponents.Interaction] as InteractionComponent;\n\t\t\tconst styleComponent = geometry.components[Geometry3DComponents.Style] as StyleComponent;\n\n\t\t\treturn {\n\t\t\t\tid: geometry.id,\n\t\t\t\ttype: 'path',\n\t\t\t\tposition: this.convert3DMapPositionToCoordinate(pathComponent.position),\n\t\t\t\tvisible: styleComponent.visible,\n\t\t\t\tinteractive: interactionComponent != null,\n\t\t\t\tcompleteFraction: pathComponent.completeFraction,\n\t\t\t\tcolor: styleComponent.color,\n\t\t\t\taccentColor: pathComponent.accentColor,\n\t\t\t\twidth: pathComponent.width,\n\t\t\t\tanimateArrowsOnPath: pathComponent.animateArrowsOnPath,\n\t\t\t\tdisplayArrowsOnPath: pathComponent.displayArrowsOnPath,\n\t\t\t\tverticalOffset: styleComponent.altitude,\n\t\t\t\thighlightCompleteFraction: pathComponent.highlightCompleteFraction,\n\t\t\t\thighlightStartFraction: pathComponent.highlightStartFraction,\n\t\t\t\thighlightEndFraction: pathComponent.highlightEndFraction,\n\t\t\t\thighlightColor: pathComponent.highlightColor,\n\t\t\t\thighlightWidthMultiplier: pathComponent.highlightWidthMultiplier,\n\t\t\t} satisfies PathState as PathState;\n\t\t} else if (geometry?.type === 'image') {\n\t\t\tconst imageComp = geometry.components[Geometry3DComponents.Mesh] as ImageComponent;\n\n\t\t\treturn {\n\t\t\t\tid: geometry.id,\n\t\t\t\ttype: 'image',\n\t\t\t\tposition: this.convert3DMapPositionToCoordinate(imageComp.position),\n\t\t\t\tvisible: geometry.components[Geometry3DComponents.Style].visible,\n\t\t\t\tverticalOffset: imageComp.feature.properties.verticalOffset ?? 0,\n\t\t\t\topacity: geometry.components[Geometry3DComponents.Style].opacity,\n\t\t\t\tflipImageToFaceCamera: geometry.components[Geometry3DComponents.Style].flipImageToFaceCamera,\n\t\t\t\twidth: imageComp.feature.properties.width ?? 0,\n\t\t\t\theight: imageComp.feature.properties.height ?? 0,\n\t\t\t\trotation: imageComp.feature.properties.rotation ?? 0,\n\t\t\t} as ImageState;\n\t\t} else if (\n\t\t\tgeometry?.type === 'text3d' &&\n\t\t\tgeometry.components[Geometry3DComponents.Mesh] instanceof Text3DComponent &&\n\t\t\t'textArea' in geometry.components[Geometry3DComponents.Mesh].feature.properties\n\t\t) {\n\t\t\tassetGeometryIsText3D(geometry);\n\t\t\tconst text3DComp = geometry.components[Geometry3DComponents.Mesh];\n\t\t\tconst styleComp = geometry.components[Geometry3DComponents.Style];\n\t\t\tconst { textMesh } = text3DComp;\n\n\t\t\tconst parent = text3DComp.mesh?.parent;\n\t\t\tif (parent instanceof GroupContainerObject3D) {\n\t\t\t\tparent.children.find(v => v.type === 'batchedtext')?.getWorldPosition(this.#batchoffsetTempVec);\n\t\t\t}\n\t\t\tthis.#tempVec.set(0, 0, 0);\n\t\t\tconst position = textMesh ? textMesh.getWorldPosition(this.#tempVec) : this.#tempVec;\n\n\t\t\tconst state = Object.assign({}, DEFAULT_TEXT_STYLE, styleComp.getState(), {\n\t\t\t\tid: geometry.id,\n\t\t\t\ttype: 'text3d' as const,\n\t\t\t\tposition: this.convert3DMapPositionToCoordinate(position.add(this.#batchoffsetTempVec)), // text is not a children of batched text need this to get altitude\n\t\t\t\tvisible: text3DComp.visible ?? false,\n\t\t\t\tcontent: (text3DComp.feature.properties as Text3DProperties).content ?? '',\n\t\t\t} as Text3DState);\n\n\t\t\treturn state satisfies Text3DState as Text3DState;\n\t\t} else {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t/**\n\t * Set the state of the map view or any entity that was added, regardless of whether it is visible in the scene.\n\t */\n\tsetState(object: Partial<Omit<MapViewState, 'type'>>): void;\n\tsetState<T extends EntityId<LabelState>>(object: T | T['id'], state: Partial<LabelState>): void;\n\tsetState<T extends EntityId<MarkerState>>(object: T | T['id'], state: Partial<MarkerStateUpdate>): void;\n\tsetState<T extends EntityId<GeometryGroupState>>(object: T | T['id'], state: Partial<GeometryGroupState>): void;\n\tsetState<T extends EntityId<GroupContainerState>>(object: T | T['id'], state: Partial<GroupContainerState>): void;\n\tsetState<T extends EntityId<GeometryState>>(object: T | T['id'], state: Partial<GeometryState>): void;\n\tsetState<T extends EntityId<ShapeState>>(object: T | T['id'], state: Partial<ShapeState>): void;\n\tsetState<T extends EntityId<PathState>>(object: T | T['id'], state: PathUpdateState): void;\n\tsetState<T extends EntityId<ModelState>>(object: T | T['id'], state: Partial<UpdateModelState>): void;\n\tsetState<T extends EntityId<ImageState>>(object: T | T['id'], state: Partial<ImageState>): void;\n\tsetState<T extends EntityId<Text3DState>>(object: T | T['id'], state: Partial<UpdatableText3DState>): void;\n\tsetState<T extends EntityId<PathState>>(object: T | T['id'], state: Partial<PathState>): void;\n\tsetState<T extends EntityState>(object: T | T['id'], state: Partial<T>): void;\n\tsetState(object: Record<string | number, any> | string | number, state?: Record<string, any>) {\n\t\tif (typeof object === 'object' && state == null) {\n\t\t\tif ('hoverColor' in object) {\n\t\t\t\tif (isColor(object.hoverColor)) {\n\t\t\t\t\tthis.#state.hoverColor = object.hoverColor ?? this.#state.hoverColor;\n\t\t\t\t} else {\n\t\t\t\t\tLogger.warn(`Failed to update global hover color. Invalid color \"${object.hoverColor}\".`);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ('text3dHoverColor' in object) {\n\t\t\t\tthis.#state.text3dHoverColor = object.text3dHoverColor ?? this.#state.text3dHoverColor;\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst geometry = getGeometryByGeometryId(this.#state, object);\n\n\t\tif (geometry == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (geometry.type === 'custom-geometry') {\n\t\t\tconst geometry3D = this.#state.geometry3DMap.get(geometry.id);\n\t\t\tif (\n\t\t\t\tgeometry3D instanceof Geometry3D &&\n\t\t\t\tgeometry3D.components[Geometry3DComponents.Mesh] instanceof CustomGeometryComponent\n\t\t\t) {\n\t\t\t\tconst _state = state as Partial<ShapeState>;\n\t\t\t\tupdateVisibility(geometry, this.#state, _state.visible);\n\t\t\t\tupdateAltitude(geometry, this.#state, _state.altitude);\n\t\t\t\tupdatePosition(geometry, _state.position, this.convertTo3DMapPosition);\n\t\t\t\tupdateParent(geometry, this.getParentContainer(_state.parent, false) as GroupContainerObject3D);\n\t\t\t\tif (updateInteractivity(geometry, _state.interactive, this.#state)) {\n\t\t\t\t\tthis.#invalidate3DEntities();\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (geometry.type === 'path') {\n\t\t\tlet _state = state as Partial<PathState>;\n\t\t\tif (updateInteractivity(geometry, _state.interactive, this.#state)) {\n\t\t\t\tthis.#invalidate3DEntities();\n\t\t\t}\n\t\t\tupdateAltitude(geometry, this.#state, (_state as PathState).verticalOffset);\n\t\t\thandlePathUpdate(geometry, this.#state, _state);\n\t\t} else if (geometry.type === 'model') {\n\t\t\tlet _state = state as Partial<ModelState>;\n\t\t\tif (updateInteractivity(geometry, _state.interactive, this.#state)) {\n\t\t\t\tthis.#invalidate3DEntities();\n\t\t\t}\n\t\t\tupdateVisibility(geometry, this.#state, _state.visible);\n\t\t\thandleModelStyleUpdate(geometry, _state);\n\t\t\tupdateClippingPlane(geometry, _state);\n\t\t} else if (geometry.type === 'group-container') {\n\t\t\tconst _state = state as Partial<GroupContainerState>;\n\t\t\tif (updateVisibility(geometry, this.#state, _state.visible)) {\n\t\t\t\tthis.#systems.pathSystem.verticalDistanceDirty = true;\n\t\t\t\tthis.#systems.geometryInFocusSystem.focusablesDirty = true;\n\t\t\t}\n\t\t\tif (updateAltitude(geometry, this.#state, _state.altitude)) {\n\t\t\t\tthis.#systems.pathSystem.verticalDistanceDirty = true;\n\t\t\t}\n\t\t\tif (updateInteractivity(geometry, _state.interactive, this.#state)) {\n\t\t\t\tthis.#invalidate3DEntities();\n\t\t\t}\n\t\t\tif (updateOpacity(geometry, this.#state, _state.opacity)) {\n\t\t\t\tthis.#systems.outlineInterpolationSystem.outlineOpacitiesDirty = true;\n\t\t\t}\n\t\t\tif (_state.preloadGeometry && geometry.userData.preloadGeometry !== true) {\n\t\t\t\tgeometry.userData.preloadGeometry = true;\n\t\t\t\tthis.#systems.outlineInterpolationSystem.geometries3DDirty = true;\n\t\t\t}\n\t\t\tif (updateFocusable(geometry, _state.focusable)) {\n\t\t\t\tthis.#systems.geometryInFocusSystem.focusablesDirty = true;\n\t\t\t}\n\t\t} else if (geometry.type === 'geometry-group') {\n\t\t\tconst _state = state as Partial<GeometryGroupState>;\n\t\t\tupdateVisibility(geometry, this.#state, _state.visible);\n\t\t\tupdateGroupColor(geometry, this.#state, _state);\n\t\t\tupdateOutline(geometry, this.#state, _state.outline);\n\t\t\tif (_state.height != null) {\n\t\t\t\tupdateHeight(geometry, this.#state, _state.height);\n\t\t\t}\n\t\t\tupdateAltitude(geometry, this.#state, _state.altitude);\n\t\t\tif (updateGroupTexture(geometry, this.#state, _state)) {\n\t\t\t\tthis.#systems.textureSystem.dirty = true;\n\t\t\t}\n\t\t\tupdateGroupTexture(geometry, this.#state, _state);\n\t\t\tupdateGroupShading(geometry, this.#state, _state.shading);\n\t\t\tif (updateOpacity(geometry, this.#state, _state.opacity)) {\n\t\t\t\tthis.#systems.outlineInterpolationSystem.outlineOpacitiesDirty = true;\n\t\t\t}\n\t\t\tif (updateInteractivity(geometry, _state.interactive, this.#state)) {\n\t\t\t\tthis.#invalidate3DEntities();\n\t\t\t\tthis.#invalidate2DEntities();\n\t\t\t}\n\t\t\tupdateSide(geometry, this.#state, _state.side);\n\t\t} else if (geometry.type === 'geometry') {\n\t\t\tif (geometry.components[Geometry3DComponents.Mesh] instanceof MeshComponent) {\n\t\t\t\tconst _state = state as Partial<GeometryState>;\n\t\t\t\tupdateVisibility(geometry, this.#state, _state.visible);\n\t\t\t\tupdateOutline(geometry, this.#state, _state.outline);\n\t\t\t\tupdateImageProps(geometry, _state);\n\t\t\t\tif (updateFocusable(geometry, _state.focusable)) {\n\t\t\t\t\tthis.#systems.geometryInFocusSystem.focusablesDirty = true;\n\t\t\t\t}\n\t\t\t\tif (updateIndividualGeometryRenderOrder(geometry, _state.renderOrder)) {\n\t\t\t\t\tthis.#systems.meshDetachmentSystem.dirty = true;\n\t\t\t\t}\n\t\t\t\tif (updateIndividualGeometryOpacity(geometry, _state.opacity)) {\n\t\t\t\t\tthis.#systems.meshDetachmentSystem.dirty = true;\n\t\t\t\t\tthis.#systems.interactionSystem.dirty3D = true;\n\t\t\t\t\tthis.#systems.outlineInterpolationSystem.outlineOpacitiesDirty = true;\n\t\t\t\t}\n\t\t\t\tupdateFlipImageToFaceCamera(geometry, _state.flipImageToFaceCamera);\n\t\t\t\tupdateEnableImageCollisions(geometry, _state.enableImageCollisions);\n\t\t\t\tupdateAltitude(geometry, this.#state, _state.altitude);\n\t\t\t\tif (_state.height != null) {\n\t\t\t\t\tupdateHeight(geometry, this.#state, _state.height);\n\t\t\t\t}\n\t\t\t\tif (updateIndividualGeometryTexture(geometry, _state)) {\n\t\t\t\t\tthis.#systems.meshDetachmentSystem.dirty = true;\n\t\t\t\t\tthis.#systems.textureSystem.dirty = true;\n\t\t\t\t}\n\t\t\t\tupdateColor(geometry, _state);\n\t\t\t\tupdateHoverColor(geometry, _state.hoverColor);\n\t\t\t\tupdateInteractivity(geometry, _state.interactive, this.#state);\n\t\t\t\tupdateHovered(geometry, _state.hovered);\n\t\t\t\tupdateSide(geometry, this.#state, _state.side);\n\t\t\t\tupdateBorder(geometry, _state);\n\t\t\t}\n\t\t\tthis.#invalidate3DEntities();\n\t\t} else if (geometry.type === 'label' || geometry.type === 'marker') {\n\t\t\tconst _state = state as Partial<LabelState | MarkerState>;\n\t\t\tupdateLabel(geometry, state as Partial<LabelState>, this.#state);\n\t\t\tif (updateMarker(geometry, state as Partial<MarkerState>, this.#state)) {\n\t\t\t\tthis.#invalidate2DEntities();\n\t\t\t\tthis.#systems.domMutationSystem.dirty = true;\n\t\t\t}\n\n\t\t\tupdatePosition(geometry, _state.position, this.convertTo3DMapPosition);\n\t\t\tif (updateParent(geometry, this.getParentContainer(_state.parent, false) as GroupContainerObject3D)) {\n\t\t\t\tthis.#invalidate2DEntities();\n\t\t\t\tthis.#systems.panBoundsSystem.dirty = true;\n\t\t\t}\n\t\t\tupdateEnabled(geometry, _state.enabled);\n\t\t\tupdateVisibility(geometry, this.#state, _state.visible);\n\t\t} else if (geometry.type === 'image') {\n\t\t\tconst _state = state as Partial<ImageState>;\n\t\t\tupdateVisibility(geometry, this.#state, _state.visible);\n\t\t\tupdateOpacity(geometry, this.#state, _state.opacity);\n\t\t\tupdateFlipImageToFaceCamera(geometry, _state.flipImageToFaceCamera);\n\t\t} else if (geometry.type === 'text3d') {\n\t\t\tconst _state = state as Partial<UpdatableText3DState>;\n\t\t\thandleText3DUpdate(geometry, this.#state, _state);\n\t\t}\n\t\tthis.render();\n\t}\n\n\t/**\n\t * Project a clientX/clientY screen coordinate to a geographic coordinate\n\t */\n\tprojectScreenXYToCoordinate = (\n\t\tclientX: MouseEvent['clientX'],\n\t\tclientY: MouseEvent['clientY'],\n\t\tuseWorldPlane = false,\n\t) => {\n\t\t// Get fresh container position to handle scroll correctly\n\t\tconst containerRect = this.container.getBoundingClientRect();\n\t\tconst offsetX = ((clientX - containerRect.left) / this.#state.canvasWidth) * 2 - 1;\n\t\tconst offsetY = -((clientY - containerRect.top) / this.#state.canvasHeight) * 2 + 1;\n\t\tconst point = new Vector2(offsetX, offsetY);\n\t\tlet pointThreeD: Vector3 | undefined;\n\t\tlet groupContainers: GroupContainerObject3D[] | undefined;\n\t\tif (useWorldPlane) {\n\t\t\traycaster.setFromCamera(point, this.#cameraObject);\n\t\t\tpointThreeD = raycaster.intersectObject(this.#worldPlane, false)[0]?.point;\n\t\t} else {\n\t\t\tconst intersects = this.#systems.interactionSystem.getThreeDIntersectsFromXY(point);\n\t\t\tpointThreeD = intersects?.[0]?.point;\n\t\t\tgroupContainers = this.#systems.interactionSystem.getGroupContainerIntersectsFromXY(point);\n\t\t}\n\n\t\tif (pointThreeD) {\n\t\t\treturn {\n\t\t\t\tcoordinate: this.convert3DMapPositionToCoordinate(pointThreeD),\n\t\t\t\tgroupContainers,\n\t\t\t};\n\t\t}\n\n\t\treturn undefined;\n\t};\n\n\t/**\n\t * Project a geographic coordinate to a screen coordinate\n\t */\n\tprojectCoordinateToScreenXY = (coordinate: Position) => {\n\t\tconst vector3D = this.convertTo3DMapPosition(coordinate[1], coordinate[0], coordinate[2] || 0);\n\t\tconst vector2D = new Vector2();\n\n\t\tthis.#project(vector2D, vector3D);\n\n\t\treturn {\n\t\t\tx: vector2D.x,\n\t\t\ty: vector2D.y,\n\t\t};\n\t};\n\n\t/**\n\t * Convert a GeoJSON position to a 3D map position.\n\t *\n\t * @param position - The GeoJSON position to convert.\n\t * @param vector - Optional vector to copy the result into instead of creating a new vector.\n\t * @returns The converted 3D map position.\n\t */\n\tconvertTo3DMapPosition(position: GeoJsonPosition, vector?: Vector3): Vector3;\n\t/**\n\t * Convert latitude and longitude to a 3D map position.\n\t *\n\t * @param latitude - The latitude to convert.\n\t * @param longitude - The longitude to convert.\n\t * @param altitude - Optional altitude to include in the conversion. Defaults to 0.\n\t * @param vector - Optional vector to copy the result into instead of creating a new vector.\n\t * @returns The converted 3D map position.\n\t */\n\tconvertTo3DMapPosition(latitude: number, longitude: number, altitude?: number, vector?: Vector3): Vector3;\n\n\tconvertTo3DMapPosition(\n\t\tlatitudeOrPosition: number | GeoJsonPosition,\n\t\tlongitude?: number | Vector3,\n\t\taltitude = 0,\n\t\tvector?: Vector3,\n\t) {\n\t\tif (Array.isArray(latitudeOrPosition)) {\n\t\t\treturn this.convertTo3DMapPosition(\n\t\t\t\tlatitudeOrPosition[1],\n\t\t\t\tlatitudeOrPosition[0],\n\t\t\t\tlatitudeOrPosition[2] ?? altitude,\n\t\t\t\ttypeof longitude === 'function' ? longitude : undefined,\n\t\t\t);\n\t\t}\n\n\t\tif (typeof longitude !== 'number') throw new Error('convertTo3DMapPosition failed: longitude must be a number');\n\n\t\tconst { x, y } = geographicToCartesian(\n\t\t\tthis.#state.center?.[1] ?? 0,\n\t\t\tthis.#state.center?.[0] ?? 0,\n\t\t\tlatitudeOrPosition,\n\t\t\tlongitude,\n\t\t);\n\n\t\tif (vector) {\n\t\t\tvector.set(x, y, altitude);\n\n\t\t\treturn vector;\n\t\t}\n\n\t\treturn new Vector3(x, y, altitude);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconvert3DMapPositionToCoordinate = (v: Vector3): Position => {\n\t\tconst { lat, lon } = cartesianToGeographic(this.#state.center?.[1] ?? 0, this.#state.center?.[0] ?? 0, v.x, v.y);\n\n\t\treturn [lon, lat, v.z];\n\t};\n\n\t/**\n\t * Sets the background color of the renderer. Only applies to \"standalone mode\"\n\t */\n\tsetBackgroundColor = (color: string, alpha: number) => {\n\t\tthis.#renderer.setBackgroundColor(color, alpha);\n\t};\n\n\t/**\n\t * Returns  the background color of the renderer. Only applies to \"standalone mode\"\n\t */\n\tget backgroundColor() {\n\t\tif (typeof this.#renderer.backgroundColor === 'string') {\n\t\t\treturn this.#renderer.backgroundColor;\n\t\t}\n\n\t\treturn `#${this.#renderer.backgroundColor.getHexString()}`;\n\t}\n\n\t/**\n\t * Returns  the background alpha of the renderer. Only applies to \"standalone mode\"\n\t */\n\tget backgroundAlpha() {\n\t\treturn this.#renderer.backgroundAlpha;\n\t}\n\n\t/**\n\t * internal\n\t */\n\tgetThreeRenderer() {\n\t\treturn this.#renderer;\n\t}\n\n\t/**\n\t * Returns the current scale of the map in meters per pixel.\n\t */\n\tgetMetersPerPixel = () => {\n\t\treturn this.#systems.cameraSystem.getCurrentMetersPerPixel();\n\t};\n\n\t/**\n\t * Filters out layers at a certain point on the outdoor map. This can be used to hide the outdoor building footprint underneath the 3D geometry.\n\t * @param bbox The bounding box to filter layers under.\n\t * @param polygons The polygons to filter layers under.\n\t * @param layers The layers to filter out.\n\t */\n\thideOutdoorLayersIntersectingPolygons = (\n\t\tbbox: BBox,\n\t\tpolygons: GeoJSON.Feature<GeoJSON.Polygon | GeoJSON.MultiPolygon, any>[],\n\t\tlayers: string[],\n\t) => {\n\t\tthis.#systems.outdoorLayersSystem.hideLayersIntersectingPolygons(bbox, polygons, layers);\n\t\tthis.render();\n\t};\n\n\t/**\n\t * Get the center of a geometry or bounding box.\n\t * @param geometryOrBoundingBox Geometry, geometry id, or bounding box to get the center of.\n\t */\n\tgetCenter(geometryOrBoundingBox: string | number | EntityId<EntityState> | Position[]) {\n\t\tconst bbox = Array.isArray(geometryOrBoundingBox)\n\t\t\t? geometryOrBoundingBox\n\t\t\t: this.getBoundingArea(geometryOrBoundingBox);\n\n\t\treturn bbox ? getBoundingBoxCenter(bbox) : undefined;\n\t}\n\n\t#cameraFrustum = new Frustum();\n\t#viewProjectionMatrix = new Matrix4();\n\n\t/**\n\t * Checks if the given entity is within the current camera's view frustum.\n\t * This method is useful for determining if an entity is visible on the screen.\n\t *\n\t * @param target - The entity to check. This can be an object with `id` and `type` properties,\n\t *                 a string representing the entity's ID, or an entity state object.\n\t * @returns - Returns `true` if the entity is within the camera's view, otherwise `false`.\n\t */\n\tisInView(target: { id: EntityState['id']; type: EntityState['type'] } | string | EntityState) {\n\t\tconst geometry = getGeometryByGeometryId(this.#state, target);\n\n\t\tthis.#viewProjectionMatrix\n\t\t\t.identity()\n\t\t\t.multiply(this.#cameraObject.projectionMatrix)\n\t\t\t.multiply(this.#cameraObject.matrixWorldInverse);\n\t\tthis.#cameraFrustum.setFromProjectionMatrix(this.#viewProjectionMatrix);\n\n\t\tif (geometry instanceof Geometry2D) {\n\t\t\treturn this.#cameraFrustum.containsPoint(geometry.position); // 2D object we use position for now\n\t\t} else if (geometry instanceof Geometry3D) {\n\t\t\tconst mesh = geometry?.components[Geometry3DComponents.Mesh];\n\t\t\tif (mesh instanceof CustomGeometryComponent || mesh instanceof ModelComponent) {\n\t\t\t\treturn this.#cameraFrustum.containsPoint(this.convertTo3DMapPosition(mesh.feature.geometry.coordinates));\n\t\t\t} else if (mesh instanceof MeshComponent) {\n\t\t\t\tconst box = new Box3(\n\t\t\t\t\tthis.convertTo3DMapPosition(mesh.featureBbox[1], mesh.featureBbox[0], 0),\n\t\t\t\t\tthis.convertTo3DMapPosition(mesh.featureBbox[3], mesh.featureBbox[2], 0),\n\t\t\t\t);\n\n\t\t\t\treturn this.#cameraFrustum.intersectsBox(box);\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Return a list of Geometry2D IDs currently rendered on screen.\n\t *\n\t * @param options - The options to query.\n\t * @param options.screenOffsets - Optional offsets to account for on the edges of the screen.\n\t * @param options.fullyContains - Whether to exclude entities that intersect with the screen edges after accounting for offsets.\n\t * @returns A list of IDs.\n\t */\n\tqueryGeometry2DInView(options?: { screenOffsets?: Partial<InsetPadding>; fullyContains?: boolean }): string[] {\n\t\tconst { screenOffsets, fullyContains } = options ?? {};\n\n\t\tconst [x, y, w, h] = rectFromScreenOffsets(this.container, screenOffsets);\n\t\tconst rectangle = new Rectangle(x, y, w, h);\n\t\tconst candidates = this.#systems.collisionSystem.visibleCollidersQTree.queryRect(rectangle);\n\t\tconst intersects = candidates.filter(c => (fullyContains ? rectangle.contains(c) : rectangle.intersects(c)));\n\t\tconst entities = intersects\n\t\t\t.map(i => this.#state.geometry2DMap.get(i.userData.entityId))\n\t\t\t.filter(e => e != null)\n\t\t\t.filter(e => {\n\t\t\t\tif (e.components[Geometry2DComponents.UI] instanceof LabelComponent) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tif (e.components[Geometry2DComponents.UI] instanceof MarkerComponent) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\treturn entities.map(e => e.id.toString());\n\t}\n\n\t#onRenderError = (e: Error) => {\n\t\tLogger.error('Render failed: ', e, e.stack ?? 'No stack trace available');\n\t\tthis.publish('render-error', { error: e });\n\t};\n\n\t/**\n\t * Perform a render of the scene. This is called internally when something changes, but can be called when adding external models\n\t * The render happens in an animation frame, not matter how frequently it is called\n\t * @method render\n\t */\n\trender = () => {\n\t\tif (this.#systems?.renderSystem == null || this.aborted) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.map && (this.mode === 'outdoors-interleaved' || this.mode === 'outdoors-overlay')) {\n\t\t\tthis.map.triggerRepaint();\n\t\t} else {\n\t\t\treturn this.#systems.renderSystem.update().catch(this.#onRenderError);\n\t\t}\n\t};\n\n\t/**\n\t * Perform a synchronous render of the scene. This bypasses the animation frame and renders immediately.\n\t *\n\t * Note: Only use this if you have an animation frame setup elsewhere\n\t */\n\trenderSync = () => {\n\t\tif (this.aborted) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn this.#systems.renderSystem.update(true).catch(this.#onRenderError);\n\t};\n\n\t#aggregateUserEventsStart = debounce(\n\t\t() => {\n\t\t\tthis.publish('user-interaction-start', undefined);\n\t\t},\n\t\t0,\n\t\ttrue,\n\t);\n\n\t#aggregateUserEventsEnd = debounce(\n\t\t() => {\n\t\t\tthis.publish('user-interaction-end', undefined);\n\t\t\tthis.render();\n\t\t},\n\t\t0,\n\t\ttrue,\n\t);\n\n\t/**\n\t * Register a MapLibre event listener\n\t */\n\tonMapLibreEvent(event: LiteralUnion<keyof MapLibreMapEventType, string>, handler: (...args: any[]) => void) {\n\t\tif (!this.map) {\n\t\t\tLogger.warn(`Tried to add event listener \"${event}\" but MapLibre map is not initialized.`);\n\t\t\treturn;\n\t\t}\n\t\tthis.map.on(event, handler);\n\t\tthis.#mapLibreEventListeners[event] = this.#mapLibreEventListeners[event] || [];\n\t\tthis.#mapLibreEventListeners[event].push(handler);\n\t}\n\n\t/**\n\t * Remove a MapLibre event listener\n\t */\n\toffMapLibreEvent(event: keyof MapLibreMapEventType, handler: (...args: any[]) => void) {\n\t\tif (!this.map || !Array.isArray(this.#mapLibreEventListeners[event])) {\n\t\t\treturn;\n\t\t}\n\t\tthis.map.off(event, handler);\n\t\tthis.#mapLibreEventListeners[event] = this.#mapLibreEventListeners[event].filter(h => h !== handler);\n\t}\n\n\t/**\n\t * Returns true if the renderer has been aborted.\n\t */\n\tget aborted() {\n\t\treturn this.#abortController.signal.aborted;\n\t}\n\n\t/**\n\t * Register a handler once to be called when the renderer is aborted.\n\t * The handler will be removed after it is called.\n\t */\n\tonAbort(handler: () => void) {\n\t\tthis.#abortController.signal.addEventListener('abort', handler, { once: true });\n\t}\n\n\t/**\n\t * @internal for testing\n\t */\n\tgetSystems() {\n\t\treturn this.#systems;\n\t}\n\n\t/**\n\t * @internal for testing\n\t */\n\tgetInternalState() {\n\t\treturn this.#state;\n\t}\n\n\t/** @internal */\n\tgetInternalTweenGroup() {\n\t\treturn this.#state.internalTweenGroup;\n\t}\n\n\tgetExternalTweenGroup() {\n\t\treturn this.#state.externalTweenGroup;\n\t}\n\n\tasync #loadEnvMap() {\n\t\treturn TextureLoader.load(blaze_thick_compressed).then(texture => {\n\t\t\tif (!this.#scene) return texture;\n\t\t\tthis.#scene.environment?.dispose();\n\t\t\ttexture.mapping = EquirectangularReflectionMapping;\n\t\t\tthis.#scene.environment = texture;\n\t\t\tthis.render();\n\n\t\t\treturn texture;\n\t\t});\n\t}\n\n\tcomputeMinZOffsetBetweenContainers(\n\t\tlowerContainer: GroupContainerObject3D,\n\t\tupperContainer: GroupContainerObject3D,\n\t\tdebug?: boolean,\n\t) {\n\t\tif (!lowerContainer || !upperContainer) return -1;\n\n\t\tassertType(lowerContainer, 'group-container');\n\t\tassertType(upperContainer, 'group-container');\n\n\t\tconst lowerObjectNDCBox = projectToBox2D(lowerContainer, this.getThreeCamera());\n\t\tconst upperObjectClone = upperContainer.clone();\n\t\tconst upperObjectNDCBox = projectToBox2D(upperObjectClone, this.getThreeCamera());\n\n\t\tif (!isFiniteBox(lowerObjectNDCBox) || !isFiniteBox(upperObjectNDCBox)) {\n\t\t\treturn -1;\n\t\t}\n\n\t\tlet zOffset = 0;\n\t\tlet overlaps: boolean;\n\n\t\tif (debug) {\n\t\t\tconst debugElements = this.container.querySelectorAll('.debug-box');\n\t\t\tdebugElements.forEach(el => el.remove());\n\t\t}\n\n\t\tdo {\n\t\t\tif (zOffset > 10000) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tzOffset += 20;\n\t\t\tupperObjectClone.position.z = zOffset;\n\t\t\tupperObjectClone.updateMatrixWorld();\n\t\t\tupperObjectNDCBox.makeEmpty();\n\t\t\tprojectToBox2D(upperObjectClone, this.#cameraObject, upperObjectNDCBox);\n\t\t\toverlaps = lowerObjectNDCBox.intersectsBox(upperObjectNDCBox);\n\t\t\tif (debug) {\n\t\t\t\t// Draw projected boxes\n\t\t\t\tconst bottomBox = drawProjectedBox(lowerObjectNDCBox, 'blue', this.container);\n\t\t\t\tconst topBox = drawProjectedBox(upperObjectNDCBox, overlaps ? 'red' : 'green', this.container);\n\n\t\t\t\t// Add debug class for easy removal\n\t\t\t\tbottomBox.classList.add('debug-box');\n\t\t\t\ttopBox.classList.add('debug-box');\n\t\t\t}\n\t\t} while (overlaps);\n\n\t\treturn zOffset;\n\t}\n\n\t/**\n\t * Subscribe a function to an event.\n\t *\n\t * @param eventName An event name which, when fired, will call the provided\n\t * function.\n\t * @param fn A callback that gets called when the corresponding event is fired. The\n\t * callback will get passed an argument with a type that's one of event payloads.\n\t * @example\n\t * // Subscribe to the 'click' event\n\t * const handler = (event) => {\n\t *  const { coordinate } = event;\n\t *  const { latitude, longitude } = coordinate;\n\t * \tconsole.log(`Map was clicked at ${latitude}, ${longitude}`);\n\t * };\n\t * map.on('click', handler);\n\t */\n\ton = <EventName extends keyof MapEvent>(eventName: EventName, fn: (payload: MapEventPayload<EventName>) => void) => {\n\t\tif (this.aborted) {\n\t\t\treturn;\n\t\t}\n\n\t\tsuper.on(eventName, fn);\n\n\t\tif (\n\t\t\t['outdoor-view-loaded', 'outdoor-style-loaded'].includes(eventName) &&\n\t\t\tthis.mode === 'standalone' &&\n\t\t\tprocess.env.NODE_ENV !== 'test'\n\t\t) {\n\t\t\tLogger.warn(\n\t\t\t\t`\"${eventName}\" was subscribed to but outdoor view is disabled. The event has been triggered immediately. Enable outdoor view or remove the listener.`,\n\t\t\t);\n\t\t\tthis.publish(eventName);\n\t\t}\n\t};\n\n\t/**\n\t * Unsubscribe a function previously subscribed with {@link on}\n\t *\n\t * @param eventName An event name to which the provided function was previously\n\t * subscribed.\n\t * @param fn A function that was previously passed to {@link on}. The function must\n\t * have the same reference as the function that was subscribed.\n\t * @example\n\t * // Unsubscribe from the 'click' event\n\t * const handler = (event) => {\n\t * \tconsole.log('Map was clicked', event);\n\t * };\n\t * map.off('click', handler);\n\t */\n\toff = <EventName extends keyof MapEvent>(eventName: EventName, fn: (payload: MapEventPayload<EventName>) => void) => {\n\t\tsuper.off(eventName, fn);\n\t};\n\n\t/**\n\t * @hidden\n\t * Returns the current cursor decided by Mappedin. This is useful when integrating with other overlays to show the correct user interaction.\n\t */\n\tgetCursor = () => {\n\t\treturn this.#systems.interactionSystem.getCursor();\n\t};\n\n\t/**\n\t * Clears MapLibre and core event listeners.\n\t */\n\t#cleanupEventListeners = () => {\n\t\tthis.#state.entityScene.removeEventListener('childadded', this.#invalidate3DEntities);\n\t\tthis.#state.entityScene.removeEventListener('childadded', this.#invalidate2DEntities);\n\t\tthis.#state.entityScene.removeEventListener('childremoved', this.#invalidate3DEntities);\n\t\tthis.#state.entityScene.removeEventListener('childremoved', this.#invalidate2DEntities);\n\t\twindow.removeEventListener('resize', this.#handleWindowResizeWithEvent, false);\n\t\tthis.#matchMediaMinResolution.removeEventListener('change', this.#handlePixelRatioChange);\n\t\t// Clean up MapLibre event listeners\n\t\tif (this.map) {\n\t\t\tfor (const event in this.#mapLibreEventListeners) {\n\t\t\t\tfor (const handler of this.#mapLibreEventListeners[event]) {\n\t\t\t\t\tthis.map.off(event as any, handler as any);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.#mapLibreEventListeners = {} as any;\n\t\t}\n\t\tthis['_subscribers'] = {};\n\t};\n\n\t/**\n\t * Safe DOM cleanup that handles edge cases\n\t */\n\t#cleanupDOMElements = () => {\n\t\ttry {\n\t\t\tif (this.#mode !== 'outdoors-overlay') {\n\t\t\t\tif (this.map) {\n\t\t\t\t\tthis.map.remove();\n\t\t\t\t}\n\t\t\t\tif (this.container && this.rendererDomElement && this.container.contains(this.rendererDomElement)) {\n\t\t\t\t\tthis.container.removeChild(this.rendererDomElement);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.container) {\n\t\t\t\tif (this.#twoDEntityScene && this.container.contains(this.#twoDEntityScene)) {\n\t\t\t\t\tthis.container.removeChild(this.#twoDEntityScene);\n\t\t\t\t}\n\t\t\t\tif (this.#collisionEngineContainerEl && this.container.contains(this.#collisionEngineContainerEl)) {\n\t\t\t\t\tthis.container.removeChild(this.#collisionEngineContainerEl);\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tLogger.warn('Error during DOM cleanup, some elements may not have been removed:', error);\n\t\t}\n\t};\n\n\t/**\n\t * Destroys instance and frees resources\n\t */\n\tdestroy = () => {\n\t\tif (!this.#systems) return;\n\t\tthis.#systems.textureSystem.destroy();\n\t\tif (!this.aborted) {\n\t\t\tthis.#abortController.abort();\n\t\t}\n\t\tthis.#cleanupEventListeners();\n\t\tthis.remove('__scene');\n\t\tthis.#systems.renderSystem.destroy();\n\t\tthis.#systems.cameraSystem.dispose();\n\t\tthis.#systems.exporterSystem.destroy();\n\t\tthis.#systems.outdoorLayersSystem.destroy();\n\n\t\tthis.#systems.borderSystem.destroy();\n\t\tif (this.#resizeObserver) {\n\t\t\tthis.#resizeObserver.disconnect();\n\t\t}\n\t\tthis.#renderer.destroy();\n\t\tthis.#scene?.traverse(obj => {\n\t\t\tdestroyObject3D(obj);\n\t\t\tif ('dispose' in obj && typeof obj.dispose === 'function') {\n\t\t\t\tobj.dispose();\n\t\t\t}\n\t\t});\n\t\tthis.#scene = undefined;\n\t\tthis.#systems.htmlControlsSystem.destroy();\n\t\tthis.#systems.collisionSystem.destroy();\n\t\tthis.#systems.interactionSystem.destroy();\n\t\tthis.#systems.domMutationSystem.destroy();\n\t\tthis.#systems.geometryInFocusSystem.destroy();\n\t\tthis.#systems.occlusion2DSystem.destroy();\n\t\t// @ts-expect-error\n\t\tthis.#systems = undefined;\n\t\tthis.#cleanupDOMElements();\n\t\t(this.#renderer as any) = undefined;\n\t};\n\t#tempVec = new Vector3();\n\t#batchoffsetTempVec = new Vector3();\n}\n\nconst tempVec = new Vector3();\nexport default Core;\n", "// https://mathiasbynens.be/notes/globalthis#robust-polyfill\n\n(function () {\n\tif (typeof globalThis === 'object') return;\n\tObject.defineProperty(Object.prototype, '__magic__', {\n\t\tget: function () {\n\t\t\treturn this;\n\t\t},\n\t\tconfigurable: true, // This makes it possible to `delete` the getter later.\n\t});\n\t__magic__.globalThis = __magic__; // lolwat\n\tdelete Object.prototype.__magic__;\n})();\n", "import type { Scene, Camera } from 'three';\nimport { Color, WebGLRenderer } from 'three';\nimport Logger from '../../../packages/common/Mappedin.Logger';\nimport { isTestMode } from './test-mode';\nimport { RENDER_LAYERS } from '../utils/constants';\n\nexport type TRendererOptions = Partial<{\n\tcanvas: HTMLCanvasElement | OffscreenCanvas;\n\tantialias: boolean;\n\tbackgroundColor: string;\n\tbackgroundAlpha: number;\n\talpha: boolean;\n\tonWebGLRendererError: (e: Error) => void;\n\txRayPath: boolean;\n\tonWebGLContextCreationError: (e: Event) => void;\n\tonWebGLContextLost: (e: Event) => void;\n\tonWebGLContextRestored: (e: Event) => void;\n}>;\n\nexport class Renderer {\n\tbackgroundAlpha = 1.0;\n\tbackgroundColor = new Color();\n\n\twidth = 0;\n\theight = 0;\n\n\toptions: TRendererOptions = {};\n\n\trenderer?: WebGLRenderer;\n\n\tconstructor(renderOptions: TRendererOptions) {\n\t\ttry {\n\t\t\tthis.options = renderOptions;\n\n\t\t\tif (isTestMode()) {\n\t\t\t\tthis.renderer = {\n\t\t\t\t\tsetSize: () => {},\n\t\t\t\t\tstate: {\n\t\t\t\t\t\treset: () => {},\n\t\t\t\t\t},\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tget: () => {},\n\t\t\t\t\t},\n\t\t\t\t\tgetSize: () => ({ width: window.innerWidth, height: innerHeight }),\n\t\t\t\t\tgetDrawingBufferSize: () => ({ width: window.innerWidth, height: innerHeight }),\n\t\t\t\t\tgetClearAlpha: () => 1.0,\n\t\t\t\t\tgetClearColor: () => new Color(),\n\t\t\t\t\tautoUpdate: true,\n\t\t\t\t\tshadowMap: {\n\t\t\t\t\t\tautoUpdate: true,\n\t\t\t\t\t},\n\t\t\t\t\tgetContext: () => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tgetContextAttributes() {\n\t\t\t\t\t\t\t\treturn { alpha: true, antialias: false, depth: true, stencil: false };\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t\treadRenderTargetPixelsAsync: () => Promise.resolve([]),\n\t\t\t\t\tsetRenderTarget: () => {},\n\t\t\t\t\tsetClearColor: () => {},\n\t\t\t\t\tclear: () => {},\n\t\t\t\t\trender: () => {},\n\t\t\t\t\tclearStencil: () => {},\n\t\t\t\t\tclearDepth: () => {},\n\t\t\t\t\tdomElement: document.createElement('canvas'),\n\t\t\t\t\tcapabilities: {\n\t\t\t\t\t\tisWebGL2: true,\n\t\t\t\t\t},\n\t\t\t\t} as unknown as WebGLRenderer;\n\n\t\t\t\tthis.renderer.domElement.style.width = '1920px';\n\t\t\t\tObject.defineProperty(this.renderer.domElement, 'clientWidth', {\n\t\t\t\t\tvalue: 1920,\n\t\t\t\t});\n\t\t\t\tthis.renderer.domElement.style.height = '1080px';\n\t\t\t\tObject.defineProperty(this.renderer.domElement, 'clientHeight', {\n\t\t\t\t\tvalue: 1080,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.renderer = new WebGLRenderer({\n\t\t\t\t\tcanvas: renderOptions.canvas,\n\t\t\t\t\talpha: renderOptions.alpha || false,\n\t\t\t\t\tstencil: true,\n\t\t\t\t\tantialias: typeof renderOptions.antialias === 'boolean' ? renderOptions.antialias : true,\n\t\t\t\t\tpowerPreference: 'high-performance',\n\t\t\t\t\tpreserveDrawingBuffer: true,\n\t\t\t\t});\n\t\t\t\tthis.renderer.localClippingEnabled = true;\n\t\t\t}\n\t\t\tthis.backgroundColor = new Color(renderOptions.backgroundColor ?? '#ffffff');\n\t\t\tthis.backgroundAlpha = renderOptions.backgroundAlpha ?? 1.0;\n\t\t} catch (e) {\n\t\t\tLogger.error(e);\n\t\t\tif (renderOptions.onWebGLRendererError) {\n\t\t\t\trenderOptions.onWebGLRendererError(e as Error);\n\t\t\t}\n\t\t}\n\t\tthis.domElement()?.addEventListener('webglcontextlost', this.handleWebGLContextLost);\n\t\tthis.domElement()?.addEventListener('webglcontextrestored', this.handleWebGLContextRestored);\n\t\tthis.domElement()?.addEventListener('webglcontextcreationerror', this.handleWebGLContextCreationError);\n\t}\n\n\t/**\n\t * Dispose of the renderer and its buffers.\n\t */\n\tdestroy() {\n\t\tif (this.renderer) {\n\t\t\tthis.renderer.dispose?.();\n\t\t}\n\t\tthis.domElement()?.removeEventListener('webglcontextlost', this.handleWebGLContextLost);\n\t\tthis.domElement()?.removeEventListener('webglcontextrestored', this.handleWebGLContextRestored);\n\t\tthis.domElement()?.removeEventListener('webglcontextcreationerror', this.handleWebGLContextCreationError);\n\t}\n\n\tenabledLayers = new Set([0, 1]);\n\n\t/**\n\t * Re-render the scene, depending on which parts of the scene have been\n\t * invalidated.\n\t *\n\t * @method render\n\t * @param renderTarget {null or WebGLRenderTarget}\n\t * @param scene {Scene}\n\t * @param sceneCamera {Camera}\n\t */\n\trender(scene: Scene, sceneCamera: Camera) {\n\t\tif (this.renderer) {\n\t\t\tthis.renderer.state.reset();\n\n\t\t\tsceneCamera.layers.disableAll();\n\t\t\tfor (const l of this.enabledLayers.values()) {\n\t\t\t\tsceneCamera.layers.enable(l);\n\t\t\t}\n\t\t\tthis.renderer.clearStencil();\n\t\t\tthis.renderer.autoClear = false;\n\t\t\tthis.renderer.setRenderTarget(null);\n\t\t\tthis.renderer.render(scene, sceneCamera);\n\n\t\t\t// clear the depth buffer\n\t\t\tthis.renderer.clearDepth();\n\n\t\t\t// render the scene again with the always on top layer enabled\n\t\t\tsceneCamera.layers.disableAll();\n\t\t\tsceneCamera.layers.enable(RENDER_LAYERS.ALWAYS_ON_TOP_PATHS);\n\t\t\tthis.renderer.render(scene, sceneCamera);\n\n\t\t\tthis.renderer.state.reset();\n\t\t}\n\t}\n\n\tclear() {\n\t\tif (this.renderer) {\n\t\t\tthis.renderer.setClearColor(this.backgroundColor, this.backgroundAlpha);\n\t\t\tthis.renderer.clear();\n\t\t}\n\t}\n\n\t/**\n\t * Set the size of the renderer, composer, and all its internal buffers.\n\t *\n\t * @method setBufferSize\n\t * @param width {number}\n\t * @param height {number}\n\t */\n\tsetBufferSize(width: number, height: number) {\n\t\tif (process.env.NODE_ENV === 'test' || !this.renderer) {\n\t\t\treturn;\n\t\t}\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.renderer.setSize(width, height, false);\n\t}\n\n\t/**\n\t * Set the color and opacity that will be drawn behind the scene.\n\t *\n\t * @method setBackgroundColor\n\t * @param color {Color}\n\t * @param alpha {number}\n\t */\n\tsetBackgroundColor(color, alpha) {\n\t\tthis.backgroundColor = color;\n\t\tthis.backgroundAlpha = alpha;\n\t}\n\n\tdomElement() {\n\t\treturn this.renderer?.domElement;\n\t}\n\n\thandleWebGLContextCreationError = (event: Event) => {\n\t\tthis.options.onWebGLContextCreationError?.(event);\n\t};\n\n\thandleWebGLContextLost = (event: Event) => {\n\t\tthis.options.onWebGLContextLost?.(event);\n\t};\n\n\thandleWebGLContextRestored = (event: Event) => {\n\t\tthis.options.onWebGLContextRestored?.(event);\n\t};\n}\n", "/**\n * Isolated module to handle whether the renderer service is in test mode\n * Avoid any external imports to polute jest setup import tree.\n * TODO: use proper options instead of this\n */\nlet testMode = false;\nexport function enableTestMode() {\n\ttestMode = true;\n}\nexport function isTestMode() {\n\treturn testMode;\n}\n", "// @ts-ignore\nimport collisionWorker from 'inline-worker:./worker';\nimport { QuadTree, Rectangle } from '@packages/internal/quad-tree';\nimport '../../styles/collisions.scss';\nimport { throttle } from './utils';\nimport type { Geometry2D } from '../../entities/geometry2d';\nimport { Geometry2DComponents } from '../../entities/geometry2d';\nimport type { MarkerComponent } from '../../components/marker';\nimport type LabelComponent from '../../components/label';\nimport { PubSub } from '../../../../packages/common/pubsub';\nimport type { RendererState } from '../../renderer';\nimport {\n\tSTATIC_COLLIDER_INDEX,\n\ttype TSerializedCollider,\n\ttype TSerializedColliderResponse,\n} from './collider-processor';\nimport type { WatermarkPosition } from '../watermark/system';\nimport { ALWAYS_VISIBLE_RANK_INDEX } from '../../utils/collision-ranking-tier';\nimport { SyncWorker } from './sync-worker';\nimport { collisionWorkerUrl } from '../..';\nimport type { Point2D } from '@packages/internal/quad-tree/src/types';\n\nlet DEBUG = false;\n\nexport type TMessageEvent = MessageEvent<{\n\tmsgId: string;\n\tcolliders: TSerializedColliderResponse[];\n\tdebug: { x: number; y: number; w: number; h: number }[];\n}>;\n\nexport type TMessage = {\n\tmsgId: string;\n\ttotalWidth: number;\n\ttotalHeight: number;\n\twatermarkWidth: number;\n\twatermarkHeight: number;\n\twatermarkPosition: WatermarkPosition;\n\tcolliders: TSerializedCollider[];\n\tdevicePixelRatio: number;\n};\n\ntype TCollisionSystemEvent = {\n\t'visibility-changed': undefined;\n};\n\nconst THROTTLE_TIME = 150;\n\nexport type PackedBBox = [x: number, y: number, w: number, h: number, index: number];\nexport type PackedPolygon = Point2D[];\nexport type PackedBBoxes = PackedBBox[];\nexport type PackedCollider = [\n\tbboxes: PackedBBoxes,\n\tenabled: 0 | 1,\n\talwaysVisible: 0 | 1,\n\tx: number,\n\ty: number,\n\tshouldCollideWithScreenEdges?: 0 | 1,\n\tonlyExposeStrategyIndex?: number,\n];\nexport type PackedMessage = [\n\tcolliders: PackedCollider[],\n\tdevicePixelRatio: number,\n\ttotalHeight: number,\n\ttotalWidth: number,\n\twatermarkWidth: number,\n\twatermarkHeight: number,\n\twatermarkPosition: WatermarkPosition,\n];\nexport type PackedJsonMessage = {\n\tx: number;\n\ty: number;\n\tenabled: boolean;\n\trank: number;\n\tbboxes: PackedBBoxes;\n\tshouldCollideWithScreenEdges: boolean;\n\tlockedToStrategyIndex: number;\n};\n\nexport class CollisionSystem extends PubSub<TCollisionSystemEvent, keyof TCollisionSystemEvent> {\n\tprivate worker: Worker | SyncWorker;\n\tprivate debugContext: CanvasRenderingContext2D;\n\tprivate debugCanvas: HTMLCanvasElement;\n\tcollidersDirty = true;\n\n\tpackedMessage: PackedMessage = [[], 0, 0, 0, 0, 0, 'bottom-left'];\n\n\tvisibleCollidersQTree = new QuadTree<{ entityId: string | number }>(\n\t\tnew Rectangle<{ entityId: string | number }>(0, 0, 0, 0),\n\t);\n\tinteractiveCollidersQTree = new QuadTree<{ entityId: string | number }>(\n\t\tnew Rectangle<{ entityId: string | number }>(0, 0, 0, 0),\n\t);\n\n\tcoreState: RendererState;\n\n\tconstructor(debugCanvas: HTMLCanvasElement, coreState: RendererState, useWorker = true) {\n\t\tsuper();\n\t\tthis.worker =\n\t\t\tuseWorker === false\n\t\t\t\t? new SyncWorker()\n\t\t\t\t: collisionWorkerUrl !== ''\n\t\t\t\t? new Worker(collisionWorkerUrl)\n\t\t\t\t: new Worker(URL.createObjectURL(new Blob([collisionWorker], { type: 'text/javascript' })));\n\n\t\t// In Chrome >= 139, worker sends an error event if CSP rules prohibit it from loading\n\t\tthis.worker.onerror = () => {\n\t\t\tthis.worker = new SyncWorker();\n\t\t\tthis.worker.onmessage = e => this.resolve(e);\n\t\t};\n\n\t\tthis.coreState = coreState;\n\t\tthis.debugCanvas = debugCanvas;\n\t\tthis.debugContext = debugCanvas.getContext('2d')!;\n\n\t\tthis.worker.onmessage = e => this.resolve(e);\n\t\tthis.postMessage = throttle(this._postMessage, THROTTLE_TIME, false);\n\t\tif (DEBUG) {\n\t\t\tthis.showCollisionBoxes();\n\t\t} else {\n\t\t\tthis.hideCollisionBoxes();\n\t\t}\n\t}\n\n\tpostMessage: () => void;\n\n\tshowCollisionBoxes = () => {\n\t\tDEBUG = true;\n\t\tthis.debugCanvas.style.display = 'block';\n\t};\n\n\thideCollisionBoxes = () => {\n\t\tDEBUG = false;\n\t\tthis.debugContext.clearRect(0, 0, this.debugCanvas.width, this.debugCanvas.height);\n\t\tthis.debugCanvas.style.display = 'none';\n\t};\n\n\tcurrentMsgId = '';\n\tworking = false;\n\n\tprivate _postMessage = () => {\n\t\tthis.worker.postMessage(this.packedMessage);\n\t};\n\n\tcomponentArray: (MarkerComponent | LabelComponent)[] = [];\n\n\tupdate = (\n\t\twatermarkWidth: number,\n\t\twatermarkHeight: number,\n\t\twatermarkPosition: WatermarkPosition = 'bottom-left',\n\t\tisPanning = false,\n\t\tstaticColliders: Rectangle[] = [],\n\t) => {\n\t\tlet needsSort = false;\n\t\tif (this.collidersDirty) {\n\t\t\tthis.packedMessage = [[], 0, 0, 0, 0, 0, 'bottom-left'];\n\t\t\tthis.componentArray = [];\n\t\t\tlet component: MarkerComponent | LabelComponent;\n\t\t\tfor (const entityId of this.coreState.geometry2DIdsInScene) {\n\t\t\t\tconst entity = this.coreState.geometry2DMap.get(entityId);\n\t\t\t\tif (entity) {\n\t\t\t\t\tcomponent = entity.components[Geometry2DComponents.UI];\n\t\t\t\t\tthis.componentArray.push(component as MarkerComponent | LabelComponent);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.resize(watermarkWidth, watermarkHeight, watermarkPosition);\n\t\t\tthis.collidersDirty = false;\n\t\t\tneedsSort = true;\n\t\t} else {\n\t\t\tneedsSort = this.componentArray.some(c => c.collisionDirty === true);\n\t\t}\n\n\t\tif (needsSort) {\n\t\t\tthis.componentArray.sort((a, b) => b.rank - a.rank);\n\t\t}\n\n\t\tlet currentIndex = 0;\n\t\t// let's add the static colliders\n\t\tfor (const staticCollider of staticColliders) {\n\t\t\tif (this.packedMessage[0][currentIndex] == null) {\n\t\t\t\tthis.packedMessage[0][currentIndex] = [] as unknown as PackedCollider;\n\t\t\t}\n\t\t\tif (this.packedMessage[0][currentIndex][0] == null) {\n\t\t\t\tthis.packedMessage[0][currentIndex][0] = [];\n\t\t\t}\n\n\t\t\t// simulate a regular collider with a single bbox, with a static collider index\n\t\t\t// so that we can tell what these are in the collision worker\n\t\t\t// TODO: we need a more friendly way to add colliders\n\t\t\tthis.packedMessage[0][currentIndex][0] = [\n\t\t\t\t[staticCollider.h / 2, staticCollider.h / 2, staticCollider.w / 2, staticCollider.w / 2, STATIC_COLLIDER_INDEX],\n\t\t\t];\n\t\t\tthis.packedMessage[0][currentIndex][1] = 1;\n\t\t\tthis.packedMessage[0][currentIndex][2] = 1;\n\t\t\tthis.packedMessage[0][currentIndex][3] = staticCollider.x;\n\t\t\tthis.packedMessage[0][currentIndex][4] = staticCollider.y;\n\t\t\tthis.packedMessage[0][currentIndex][5] = 0;\n\t\t\tthis.packedMessage[0][currentIndex][6] = -1;\n\t\t\tcurrentIndex++;\n\t\t}\n\n\t\tlet componentIndex = 0;\n\t\twhile (currentIndex < this.componentArray.length + staticColliders.length) {\n\t\t\tif (this.packedMessage) {\n\t\t\t\tconst json = this.componentArray[componentIndex].toPackedMessage(isPanning && !needsSort);\n\t\t\t\tif (this.packedMessage[0][currentIndex] == null) {\n\t\t\t\t\tthis.packedMessage[0][currentIndex] = [] as unknown as PackedCollider;\n\t\t\t\t}\n\t\t\t\tif (this.packedMessage[0][currentIndex][0] == null) {\n\t\t\t\t\tthis.packedMessage[0][currentIndex][0] = [];\n\t\t\t\t}\n\t\t\t\tthis.packedMessage[0][currentIndex][0] = json.bboxes;\n\t\t\t\tthis.packedMessage[0][currentIndex][1] =\n\t\t\t\t\tjson.enabled && this.componentArray[componentIndex].visible && !this.componentArray[componentIndex].isOccluded\n\t\t\t\t\t\t? 1\n\t\t\t\t\t\t: 0;\n\t\t\t\tthis.packedMessage[0][currentIndex][2] = json.rank === ALWAYS_VISIBLE_RANK_INDEX ? 1 : 0;\n\t\t\t\tthis.packedMessage[0][currentIndex][3] = json.x;\n\t\t\t\tthis.packedMessage[0][currentIndex][4] = json.y;\n\t\t\t\tthis.packedMessage[0][currentIndex][5] = json.shouldCollideWithScreenEdges ? 1 : 0;\n\t\t\t\tthis.packedMessage[0][currentIndex][6] = json.lockedToStrategyIndex;\n\t\t\t}\n\t\t\tcurrentIndex++;\n\t\t\tcomponentIndex++;\n\t\t}\n\n\t\tif (this.working) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.postMessage();\n\t};\n\n\tresize(watermarkWidth: number, watermarkHeight: number, watermarkPosition: WatermarkPosition) {\n\t\tthis.packedMessage[6] = watermarkPosition;\n\t\tthis.packedMessage[5] = watermarkHeight;\n\t\tthis.packedMessage[4] = watermarkWidth;\n\t\tthis.packedMessage[3] = this.debugCanvas.width;\n\t\tthis.packedMessage[2] = this.debugCanvas.height;\n\t}\n\n\t/**\n\t * Resolve collisions\n\t */\n\tresolve = (\n\t\te: MessageEvent<{\n\t\t\tmsgId: string;\n\t\t\tcolliders: TSerializedColliderResponse[];\n\t\t\tstaticColliders: Rectangle[];\n\t\t}>,\n\t) => {\n\t\tthis.working = false;\n\n\t\tif (this.collidersDirty || !e.data) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst visibleColliders = e.data.colliders;\n\t\tlet strategyIndex = -1;\n\t\tlet rectangle: Rectangle | undefined;\n\t\tlet entity: Geometry2D | undefined;\n\t\tlet boundingRect: Rectangle<{ entityId: string | number }>;\n\t\tconst canvasRect = new Rectangle(0, 0, this.debugCanvas.width, this.debugCanvas.height);\n\t\tthis.visibleCollidersQTree = new QuadTree<any>(canvasRect);\n\t\tthis.interactiveCollidersQTree = new QuadTree<any>(canvasRect);\n\t\tif (DEBUG) {\n\t\t\t// insert static colliders\n\t\t\tfor (const staticCollider of e.data.staticColliders) {\n\t\t\t\tthis.visibleCollidersQTree.insert(\n\t\t\t\t\tnew Rectangle(staticCollider.x, staticCollider.y, staticCollider.w, staticCollider.h),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 0; i < this.componentArray.length; i++) {\n\t\t\tconst component = this.componentArray[i];\n\t\t\tif (visibleColliders[i] == null) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tstrategyIndex = visibleColliders[i][0];\n\t\t\trectangle = visibleColliders[i][2];\n\t\t\tcomponent.offscreen = visibleColliders[i][1] === 1;\n\n\t\t\tif (strategyIndex !== -1 && rectangle != null) {\n\t\t\t\tboundingRect = new Rectangle(rectangle.x, rectangle.y, rectangle.w, rectangle.h, {\n\t\t\t\t\tentityId: component.id,\n\t\t\t\t});\n\t\t\t\tthis.visibleCollidersQTree.insert(boundingRect);\n\t\t\t\tentity = this.coreState.geometry2DMap.get(component.id)!;\n\t\t\t\tif (entity?.components[Geometry2DComponents.Interaction] != null) {\n\t\t\t\t\tthis.interactiveCollidersQTree.insert(boundingRect);\n\t\t\t\t}\n\t\t\t\tif (component.canShow === false || component.visibilityNeedsUpdate !== false) {\n\t\t\t\t\tif ('visibilityNeedsUpdate' in component) {\n\t\t\t\t\t\tcomponent.visibilityNeedsUpdate = 'show';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (strategyIndex !== -1 && strategyIndex !== component.currentStrategyIndex) {\n\t\t\t\t\tcomponent.activeBoundingBox = boundingRect;\n\t\t\t\t\tcomponent.onStrategySelected(strategyIndex);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (component.canShow === true || component.visibilityNeedsUpdate !== false) {\n\t\t\t\t\tif ('visibilityNeedsUpdate' in component) {\n\t\t\t\t\t\tcomponent.visibilityNeedsUpdate = 'hide';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (strategyIndex !== -1 && strategyIndex !== component.currentStrategyIndex) {\n\t\t\t\t\tcomponent.onStrategySelected(strategyIndex);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (DEBUG) {\n\t\t\tthis.drawDebug();\n\t\t}\n\n\t\tthis.publish('visibility-changed');\n\t};\n\n\tdrawDebug = () => {\n\t\tif (DEBUG && this.visibleCollidersQTree) {\n\t\t\tthis.debugContext.clearRect(0, 0, this.debugCanvas.width, this.debugCanvas.height);\n\t\t\tthis.debugContext.beginPath();\n\t\t\tthis.visibleCollidersQTree.drawObjects(this.debugContext);\n\t\t}\n\t};\n\n\tdestroy = () => {\n\t\tthis.worker.terminate();\n\t};\n}\n", "export default \"\\\"use strict\\\";(()=>{var Ja=Object.defineProperty;var us=(e,r,n)=>r in e?Ja(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n;var pe=(e,r)=>{for(var n in r)Ja(e,n,{get:r[n],enumerable:!0})};var E=(e,r,n)=>us(e,typeof r!=\\\"symbol\\\"?r+\\\"\\\":r,n);function Ma(e,r){return r.x+r.w<e.x+e.w&&r.x>e.x&&r.y>e.y&&r.y+r.h<e.y+e.h}function Ba(e,r){let[n,o]=r;return n>=e.x&&n<=e.x+e.w&&o>=e.y&&o<=e.y+e.h}function Ka(e,r){let n=r.x,o=r.y,t=r.x+r.w,i=r.y+r.h,a=e.x,u=e.y,s=e.x+e.w,m=e.y+e.h;return n<s&&a<t&&o<m&&u<i}function Q(e,r){for(let n=0;n<r.length;n++)e.push(r[n])}var U=class{constructor(r,n,o,t,i){E(this,\\\"x\\\");E(this,\\\"y\\\");E(this,\\\"w\\\");E(this,\\\"h\\\");E(this,\\\"userData\\\");this.userData=typeof i>\\\"u\\\"?null:i,this.x=r,this.y=n,this.w=o,this.h=t}contains(r){return r===this?!1:Ma(this,r)}intersects(r){return Ka(this,r)}intersectsPoint(r){return Ba(this,r)}draw(r){r.fillStyle=\\\"rgba(123,222,26, 0.8)\\\",r.fillRect(this.x,this.y,this.w,this.h)}};var Ae=class e{constructor(r,n){E(this,\\\"topLeft\\\");E(this,\\\"topRight\\\");E(this,\\\"bottomLeft\\\");E(this,\\\"bottomRight\\\");E(this,\\\"divided\\\",!1);E(this,\\\"boundary\\\");E(this,\\\"capacity\\\",16);E(this,\\\"objects\\\",[]);E(this,\\\"parent\\\");this.parent=n,this.boundary=r}getSize(){return this.divided?this.objects.length+this.topLeft.getSize()+this.topRight.getSize()+this.bottomLeft.getSize()+this.bottomRight.getSize():this.objects.length}subdivide(){let{x:r,y:n,w:o,h:t}=this.boundary;this.topLeft=new e(new U(r,n,o/2,t/2),this),this.topRight=new e(new U(r+o/2,n,o/2,t/2),this),this.bottomLeft=new e(new U(r,n+t/2,o/2,t/2),this),this.bottomRight=new e(new U(r+o/2,n+t/2,o/2,t/2),this),this.divided=!0}queryRect(r){let n=[];if(this.boundary.intersects(r))n.push(...this.objects);else return[];return this.divided&&(Q(n,this.topLeft.queryRect(r)),Q(n,this.topRight.queryRect(r)),Q(n,this.bottomLeft.queryRect(r)),Q(n,this.bottomRight.queryRect(r))),n}queryPoint(r){let n=[];if(this.boundary.intersectsPoint(r))n.push(...this.objects);else return[];return this.divided&&(Q(n,this.topLeft.queryPoint(r)),Q(n,this.topRight.queryPoint(r)),Q(n,this.bottomLeft.queryPoint(r)),Q(n,this.bottomRight.queryPoint(r))),n}insert(r){return(this.parent?!this.boundary.contains(r):!this.boundary.intersects(r))?!1:this.objects.length<this.capacity?(this.objects.push(r),!0):(this.divided||this.subdivide(),(this.topLeft.insert(r)||this.topRight.insert(r)||this.bottomLeft.insert(r)||this.bottomRight.insert(r))===!1&&this.objects.push(r),!0)}drawObjects(r){this.objects.forEach(n=>n.draw(r)),this.divided&&(this.topLeft.drawObjects(r),this.topRight.drawObjects(r),this.bottomLeft.drawObjects(r),this.bottomRight.drawObjects(r))}draw(r){r.rect(this.boundary.x,this.boundary.y,this.boundary.w,this.boundary.h),this.divided&&(this.topLeft.draw(r),this.topRight.draw(r),this.bottomLeft.draw(r),this.bottomRight.draw(r)),r.strokeStyle=\\\"black\\\",r.lineWidth=4,r.stroke()}};var Te={};pe(Te,{$brand:()=>zt,$input:()=>to,$output:()=>eo,NEVER:()=>Ar,TimePrecision:()=>io,ZodAny:()=>xc,ZodArray:()=>wc,ZodBase64:()=>xa,ZodBase64URL:()=>ka,ZodBigInt:()=>xt,ZodBigIntFormat:()=>wa,ZodBoolean:()=>yt,ZodCIDRv4:()=>_a,ZodCIDRv6:()=>ya,ZodCUID:()=>fa,ZodCUID2:()=>pa,ZodCatch:()=>Bc,ZodCodec:()=>Ea,ZodCustom:()=>Nr,ZodCustomStringFormat:()=>bt,ZodDate:()=>Or,ZodDefault:()=>Lc,ZodDiscriminatedUnion:()=>Sc,ZodE164:()=>za,ZodEmail:()=>la,ZodEmoji:()=>da,ZodEnum:()=>ht,ZodError:()=>Ed,ZodFile:()=>Ec,ZodFirstPartyTypeKind:()=>Aa,ZodFunction:()=>es,ZodGUID:()=>zr,ZodIPv4:()=>$a,ZodIPv6:()=>ba,ZodISODate:()=>_r,ZodISODateTime:()=>br,ZodISODuration:()=>xr,ZodISOTime:()=>yr,ZodIntersection:()=>jc,ZodIssueCode:()=>Gm,ZodJWT:()=>Ia,ZodKSUID:()=>ha,ZodLazy:()=>Yc,ZodLiteral:()=>Tc,ZodMap:()=>Zc,ZodNaN:()=>Gc,ZodNanoID:()=>ma,ZodNever:()=>zc,ZodNonOptional:()=>Da,ZodNull:()=>_c,ZodNullable:()=>Rc,ZodNumber:()=>_t,ZodNumberFormat:()=>De,ZodObject:()=>Ur,ZodOptional:()=>Za,ZodPipe:()=>Ta,ZodPrefault:()=>Vc,ZodPromise:()=>Hc,ZodReadonly:()=>Wc,ZodRealError:()=>V,ZodRecord:()=>Pa,ZodSet:()=>Dc,ZodString:()=>$t,ZodStringFormat:()=>N,ZodSuccess:()=>Mc,ZodSymbol:()=>$c,ZodTemplateLiteral:()=>qc,ZodTransform:()=>Ac,ZodTuple:()=>Pc,ZodType:()=>k,ZodULID:()=>ga,ZodURL:()=>jr,ZodUUID:()=>ne,ZodUndefined:()=>bc,ZodUnion:()=>ja,ZodUnknown:()=>kc,ZodVoid:()=>Ic,ZodXID:()=>va,_ZodString:()=>sa,_default:()=>Cc,_function:()=>Cm,any:()=>_m,array:()=>Pr,base64:()=>nm,base64url:()=>im,bigint:()=>gm,boolean:()=>hc,catch:()=>Kc,check:()=>Vm,cidrv4:()=>tm,cidrv6:()=>rm,clone:()=>R,codec:()=>Am,coerce:()=>Ra,config:()=>D,core:()=>re,cuid:()=>Wd,cuid2:()=>Xd,custom:()=>Fm,date:()=>xm,decode:()=>ea,decodeAsync:()=>ra,discriminatedUnion:()=>Sm,e164:()=>om,email:()=>Rd,emoji:()=>Kd,encode:()=>Ho,encodeAsync:()=>ta,endsWith:()=>lt,enum:()=>Ua,file:()=>Zm,flattenError:()=>Ke,float32:()=>dm,float64:()=>mm,formatError:()=>Ge,function:()=>Cm,getErrorMap:()=>Xm,globalRegistry:()=>q,gt:()=>ee,gte:()=>C,guid:()=>Ld,hash:()=>lm,hex:()=>sm,hostname:()=>cm,httpUrl:()=>Bd,includes:()=>ct,instanceof:()=>Jm,int:()=>ca,int32:()=>fm,int64:()=>vm,intersection:()=>Oc,ipv4:()=>Hd,ipv6:()=>em,iso:()=>kr,json:()=>Bm,jwt:()=>am,keyof:()=>km,ksuid:()=>Qd,lazy:()=>Qc,length:()=>Ue,literal:()=>Nm,locales:()=>tt,looseObject:()=>wm,lowercase:()=>at,lt:()=>H,lte:()=>G,map:()=>Om,maxLength:()=>Pe,maxSize:()=>Oe,mime:()=>dt,minLength:()=>le,minSize:()=>be,multipleOf:()=>$e,nan:()=>Em,nanoid:()=>Gd,nativeEnum:()=>Um,negative:()=>Do,never:()=>Sa,nonnegative:()=>Eo,nonoptional:()=>Jc,nonpositive:()=>To,normalize:()=>mt,null:()=>yc,nullable:()=>wr,nullish:()=>Dm,number:()=>vc,object:()=>zm,optional:()=>Ir,overwrite:()=>te,parse:()=>Xo,parseAsync:()=>qo,partialRecord:()=>jm,pipe:()=>Sr,positive:()=>Zo,prefault:()=>Fc,preprocess:()=>Km,prettifyError:()=>Wr,promise:()=>Lm,property:()=>Ao,readonly:()=>Xc,record:()=>Nc,refine:()=>ts,regex:()=>ot,regexes:()=>K,registry:()=>Qt,safeDecode:()=>ia,safeDecodeAsync:()=>aa,safeEncode:()=>na,safeEncodeAsync:()=>oa,safeParse:()=>Yo,safeParseAsync:()=>Qo,set:()=>Pm,setErrorMap:()=>Wm,size:()=>it,startsWith:()=>st,strictObject:()=>Im,string:()=>ua,stringFormat:()=>um,stringbool:()=>Mm,success:()=>Tm,superRefine:()=>rs,symbol:()=>$m,templateLiteral:()=>Rm,toJSONSchema:()=>Mo,toLowerCase:()=>pt,toUpperCase:()=>gt,transform:()=>Na,treeifyError:()=>Gr,trim:()=>ft,tuple:()=>Uc,uint32:()=>pm,uint64:()=>hm,ulid:()=>qd,undefined:()=>bm,union:()=>Oa,unknown:()=>Ze,uppercase:()=>ut,url:()=>Md,util:()=>h,uuid:()=>Cd,uuidv4:()=>Vd,uuidv6:()=>Fd,uuidv7:()=>Jd,void:()=>ym,xid:()=>Yd});var re={};pe(re,{$ZodAny:()=>ki,$ZodArray:()=>ji,$ZodAsyncError:()=>W,$ZodBase64:()=>fi,$ZodBase64URL:()=>pi,$ZodBigInt:()=>Kt,$ZodBigIntFormat:()=>bi,$ZodBoolean:()=>Ye,$ZodCIDRv4:()=>li,$ZodCIDRv6:()=>di,$ZodCUID:()=>Hn,$ZodCUID2:()=>ei,$ZodCatch:()=>Bi,$ZodCheck:()=>Z,$ZodCheckBigIntFormat:()=>On,$ZodCheckEndsWith:()=>Vn,$ZodCheckGreaterThan:()=>Lt,$ZodCheckIncludes:()=>Ln,$ZodCheckLengthEquals:()=>Tn,$ZodCheckLessThan:()=>Rt,$ZodCheckLowerCase:()=>An,$ZodCheckMaxLength:()=>Zn,$ZodCheckMaxSize:()=>Pn,$ZodCheckMimeType:()=>Jn,$ZodCheckMinLength:()=>Dn,$ZodCheckMinSize:()=>Un,$ZodCheckMultipleOf:()=>Sn,$ZodCheckNumberFormat:()=>jn,$ZodCheckOverwrite:()=>Mn,$ZodCheckProperty:()=>Fn,$ZodCheckRegex:()=>En,$ZodCheckSizeEquals:()=>Nn,$ZodCheckStartsWith:()=>Cn,$ZodCheckStringFormat:()=>Se,$ZodCheckUpperCase:()=>Rn,$ZodCodec:()=>Qe,$ZodCustom:()=>Hi,$ZodCustomStringFormat:()=>hi,$ZodDate:()=>Si,$ZodDefault:()=>Vi,$ZodDiscriminatedUnion:()=>Pi,$ZodE164:()=>gi,$ZodEmail:()=>Xn,$ZodEmoji:()=>Yn,$ZodEncodeError:()=>ie,$ZodEnum:()=>Ti,$ZodError:()=>Be,$ZodFile:()=>Ai,$ZodFunction:()=>qi,$ZodGUID:()=>Gn,$ZodIPv4:()=>ci,$ZodIPv6:()=>si,$ZodISODate:()=>oi,$ZodISODateTime:()=>ii,$ZodISODuration:()=>ui,$ZodISOTime:()=>ai,$ZodIntersection:()=>Ui,$ZodJWT:()=>vi,$ZodKSUID:()=>ni,$ZodLazy:()=>Qi,$ZodLiteral:()=>Ei,$ZodMap:()=>Zi,$ZodNaN:()=>Ki,$ZodNanoID:()=>Qn,$ZodNever:()=>Ii,$ZodNonOptional:()=>Ji,$ZodNull:()=>xi,$ZodNullable:()=>Ci,$ZodNumber:()=>Bt,$ZodNumberFormat:()=>$i,$ZodObject:()=>$u,$ZodObjectJIT:()=>Oi,$ZodOptional:()=>Li,$ZodPipe:()=>Gi,$ZodPrefault:()=>Fi,$ZodPromise:()=>Yi,$ZodReadonly:()=>Wi,$ZodRealError:()=>L,$ZodRecord:()=>Ni,$ZodRegistry:()=>je,$ZodSet:()=>Di,$ZodString:()=>he,$ZodStringFormat:()=>O,$ZodSuccess:()=>Mi,$ZodSymbol:()=>_i,$ZodTemplateLiteral:()=>Xi,$ZodTransform:()=>Ri,$ZodTuple:()=>Wt,$ZodType:()=>x,$ZodULID:()=>ti,$ZodURL:()=>qn,$ZodUUID:()=>Wn,$ZodUndefined:()=>yi,$ZodUnion:()=>Gt,$ZodUnknown:()=>zi,$ZodVoid:()=>wi,$ZodXID:()=>ri,$brand:()=>zt,$constructor:()=>c,$input:()=>to,$output:()=>eo,Doc:()=>qe,JSONSchema:()=>fc,JSONSchemaGenerator:()=>vt,NEVER:()=>Ar,TimePrecision:()=>io,_any:()=>wo,_array:()=>Ro,_base64:()=>gr,_base64url:()=>vr,_bigint:()=>bo,_boolean:()=>ho,_catch:()=>Od,_check:()=>mc,_cidrv4:()=>fr,_cidrv6:()=>pr,_coercedBigint:()=>_o,_coercedBoolean:()=>$o,_coercedDate:()=>Uo,_coercedNumber:()=>lo,_coercedString:()=>no,_cuid:()=>ar,_cuid2:()=>ur,_custom:()=>Co,_date:()=>Po,_decode:()=>Pt,_decodeAsync:()=>Nt,_default:()=>wd,_discriminatedUnion:()=>pd,_e164:()=>hr,_email:()=>Ht,_emoji:()=>ir,_encode:()=>Ot,_encodeAsync:()=>Ut,_endsWith:()=>lt,_enum:()=>_d,_file:()=>Lo,_float32:()=>fo,_float64:()=>po,_gt:()=>ee,_gte:()=>C,_guid:()=>rt,_includes:()=>ct,_int:()=>mo,_int32:()=>go,_int64:()=>yo,_intersection:()=>gd,_ipv4:()=>dr,_ipv6:()=>mr,_isoDate:()=>ao,_isoDateTime:()=>oo,_isoDuration:()=>co,_isoTime:()=>uo,_jwt:()=>$r,_ksuid:()=>lr,_lazy:()=>Zd,_length:()=>Ue,_literal:()=>xd,_lowercase:()=>at,_lt:()=>H,_lte:()=>G,_map:()=>$d,_max:()=>G,_maxLength:()=>Pe,_maxSize:()=>Oe,_mime:()=>dt,_min:()=>C,_minLength:()=>le,_minSize:()=>be,_multipleOf:()=>$e,_nan:()=>No,_nanoid:()=>or,_nativeEnum:()=>yd,_negative:()=>Do,_never:()=>jo,_nonnegative:()=>Eo,_nonoptional:()=>Sd,_nonpositive:()=>To,_normalize:()=>mt,_null:()=>Io,_nullable:()=>Id,_number:()=>so,_optional:()=>zd,_overwrite:()=>te,_parse:()=>ke,_parseAsync:()=>ze,_pipe:()=>Pd,_positive:()=>Zo,_promise:()=>Dd,_property:()=>Ao,_readonly:()=>Ud,_record:()=>hd,_refine:()=>Vo,_regex:()=>ot,_safeDecode:()=>Dt,_safeDecodeAsync:()=>Et,_safeEncode:()=>Zt,_safeEncodeAsync:()=>Tt,_safeParse:()=>Ie,_safeParseAsync:()=>we,_set:()=>bd,_size:()=>it,_startsWith:()=>st,_string:()=>ro,_stringFormat:()=>Ne,_stringbool:()=>Jo,_success:()=>jd,_superRefine:()=>Fo,_symbol:()=>ko,_templateLiteral:()=>Nd,_toLowerCase:()=>pt,_toUpperCase:()=>gt,_transform:()=>kd,_trim:()=>ft,_tuple:()=>vd,_uint32:()=>vo,_uint64:()=>xo,_ulid:()=>cr,_undefined:()=>zo,_union:()=>fd,_unknown:()=>So,_uppercase:()=>ut,_url:()=>nt,_uuid:()=>er,_uuidv4:()=>tr,_uuidv6:()=>rr,_uuidv7:()=>nr,_void:()=>Oo,_xid:()=>sr,clone:()=>R,config:()=>D,decode:()=>Ts,decodeAsync:()=>As,encode:()=>Ds,encodeAsync:()=>Es,flattenError:()=>Ke,formatError:()=>Ge,globalConfig:()=>Re,globalRegistry:()=>q,isValidBase64:()=>mi,isValidBase64URL:()=>pu,isValidJWT:()=>gu,locales:()=>tt,parse:()=>St,parseAsync:()=>jt,prettifyError:()=>Wr,regexes:()=>K,registry:()=>Qt,safeDecode:()=>Ls,safeDecodeAsync:()=>Vs,safeEncode:()=>Rs,safeEncodeAsync:()=>Cs,safeParse:()=>Xr,safeParseAsync:()=>qr,toDotPath:()=>Ya,toJSONSchema:()=>Mo,treeifyError:()=>Gr,util:()=>h,version:()=>Bn});var Ar=Object.freeze({status:\\\"aborted\\\"});function c(e,r,n){function o(u,s){var m;Object.defineProperty(u,\\\"_zod\\\",{value:u._zod??{},enumerable:!1}),(m=u._zod).traits??(m.traits=new Set),u._zod.traits.add(e),r(u,s);for(let f in a.prototype)f in u||Object.defineProperty(u,f,{value:a.prototype[f].bind(u)});u._zod.constr=a,u._zod.def=s}let t=n?.Parent??Object;class i extends t{}Object.defineProperty(i,\\\"name\\\",{value:e});function a(u){var s;let m=n?.Parent?new i:this;o(m,u),(s=m._zod).deferred??(s.deferred=[]);for(let f of m._zod.deferred)f();return m}return Object.defineProperty(a,\\\"init\\\",{value:o}),Object.defineProperty(a,Symbol.hasInstance,{value:u=>n?.Parent&&u instanceof n.Parent?!0:u?._zod?.traits?.has(e)}),Object.defineProperty(a,\\\"name\\\",{value:e}),a}var zt=Symbol(\\\"zod_brand\\\"),W=class extends Error{constructor(){super(\\\"Encountered Promise during synchronous parse. Use .parseAsync() instead.\\\")}},ie=class extends Error{constructor(r){super(`Encountered unidirectional transform during encode: ${r}`),this.name=\\\"ZodEncodeError\\\"}},Re={};function D(e){return e&&Object.assign(Re,e),Re}var h={};pe(h,{BIGINT_FORMAT_RANGES:()=>Kr,Class:()=>Lr,NUMBER_FORMAT_RANGES:()=>Br,aborted:()=>se,allowsEval:()=>Vr,assert:()=>ms,assertEqual:()=>cs,assertIs:()=>ls,assertNever:()=>ds,assertNotEqual:()=>ss,assignProp:()=>ae,base64ToUint8Array:()=>Wa,base64urlToUint8Array:()=>Os,cached:()=>ye,captureStackTrace:()=>wt,cleanEnum:()=>js,cleanRegex:()=>Ve,clone:()=>R,cloneDef:()=>ps,createTransparentProxy:()=>_s,defineLazy:()=>I,esc:()=>It,escapeRegex:()=>X,extend:()=>ks,finalizeIssue:()=>J,floatSafeRemainder:()=>Cr,getElementAtPath:()=>gs,getEnumValues:()=>Ce,getLengthableOrigin:()=>Me,getParsedType:()=>bs,getSizableOrigin:()=>Je,hexToUint8Array:()=>Us,isObject:()=>ge,isPlainObject:()=>ce,issue:()=>xe,joinValues:()=>l,jsonStringifyReplacer:()=>_e,merge:()=>Is,mergeDefs:()=>ue,normalizeParams:()=>v,nullish:()=>oe,numKeys:()=>$s,objectClone:()=>fs,omit:()=>xs,optionalKeys:()=>Mr,partial:()=>ws,pick:()=>ys,prefixIssues:()=>F,primitiveTypes:()=>Jr,promiseAllObject:()=>vs,propertyKeyTypes:()=>Fe,randomString:()=>hs,required:()=>Ss,safeExtend:()=>zs,shallowClone:()=>Fr,stringifyPrimitive:()=>p,uint8ArrayToBase64:()=>Xa,uint8ArrayToBase64url:()=>Ps,uint8ArrayToHex:()=>Ns,unwrapMessage:()=>Le});function cs(e){return e}function ss(e){return e}function ls(e){}function ds(e){throw new Error}function ms(e){}function Ce(e){let r=Object.values(e).filter(o=>typeof o==\\\"number\\\");return Object.entries(e).filter(([o,t])=>r.indexOf(+o)===-1).map(([o,t])=>t)}function l(e,r=\\\"|\\\"){return e.map(n=>p(n)).join(r)}function _e(e,r){return typeof r==\\\"bigint\\\"?r.toString():r}function ye(e){return{get value(){{let n=e();return Object.defineProperty(this,\\\"value\\\",{value:n}),n}throw new Error(\\\"cached value already set\\\")}}}function oe(e){return e==null}function Ve(e){let r=e.startsWith(\\\"^\\\")?1:0,n=e.endsWith(\\\"$\\\")?e.length-1:e.length;return e.slice(r,n)}function Cr(e,r){let n=(e.toString().split(\\\".\\\")[1]||\\\"\\\").length,o=r.toString(),t=(o.split(\\\".\\\")[1]||\\\"\\\").length;if(t===0&&/\\\\d?e-\\\\d?/.test(o)){let s=o.match(/\\\\d?e-(\\\\d?)/);s?.[1]&&(t=Number.parseInt(s[1]))}let i=n>t?n:t,a=Number.parseInt(e.toFixed(i).replace(\\\".\\\",\\\"\\\")),u=Number.parseInt(r.toFixed(i).replace(\\\".\\\",\\\"\\\"));return a%u/10**i}var Ga=Symbol(\\\"evaluating\\\");function I(e,r,n){let o;Object.defineProperty(e,r,{get(){if(o!==Ga)return o===void 0&&(o=Ga,o=n()),o},set(t){Object.defineProperty(e,r,{value:t})},configurable:!0})}function fs(e){return Object.create(Object.getPrototypeOf(e),Object.getOwnPropertyDescriptors(e))}function ae(e,r,n){Object.defineProperty(e,r,{value:n,writable:!0,enumerable:!0,configurable:!0})}function ue(...e){let r={};for(let n of e){let o=Object.getOwnPropertyDescriptors(n);Object.assign(r,o)}return Object.defineProperties({},r)}function ps(e){return ue(e._zod.def)}function gs(e,r){return r?r.reduce((n,o)=>n?.[o],e):e}function vs(e){let r=Object.keys(e),n=r.map(o=>e[o]);return Promise.all(n).then(o=>{let t={};for(let i=0;i<r.length;i++)t[r[i]]=o[i];return t})}function hs(e=10){let r=\\\"abcdefghijklmnopqrstuvwxyz\\\",n=\\\"\\\";for(let o=0;o<e;o++)n+=r[Math.floor(Math.random()*r.length)];return n}function It(e){return JSON.stringify(e)}var wt=\\\"captureStackTrace\\\"in Error?Error.captureStackTrace:(...e)=>{};function ge(e){return typeof e==\\\"object\\\"&&e!==null&&!Array.isArray(e)}var Vr=ye(()=>{if(typeof navigator<\\\"u\\\"&&navigator?.userAgent?.includes(\\\"Cloudflare\\\"))return!1;try{let e=Function;return new e(\\\"\\\"),!0}catch{return!1}});function ce(e){if(ge(e)===!1)return!1;let r=e.constructor;if(r===void 0)return!0;let n=r.prototype;return!(ge(n)===!1||Object.prototype.hasOwnProperty.call(n,\\\"isPrototypeOf\\\")===!1)}function Fr(e){return ce(e)?{...e}:Array.isArray(e)?[...e]:e}function $s(e){let r=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r++;return r}var bs=e=>{let r=typeof e;switch(r){case\\\"undefined\\\":return\\\"undefined\\\";case\\\"string\\\":return\\\"string\\\";case\\\"number\\\":return Number.isNaN(e)?\\\"nan\\\":\\\"number\\\";case\\\"boolean\\\":return\\\"boolean\\\";case\\\"function\\\":return\\\"function\\\";case\\\"bigint\\\":return\\\"bigint\\\";case\\\"symbol\\\":return\\\"symbol\\\";case\\\"object\\\":return Array.isArray(e)?\\\"array\\\":e===null?\\\"null\\\":e.then&&typeof e.then==\\\"function\\\"&&e.catch&&typeof e.catch==\\\"function\\\"?\\\"promise\\\":typeof Map<\\\"u\\\"&&e instanceof Map?\\\"map\\\":typeof Set<\\\"u\\\"&&e instanceof Set?\\\"set\\\":typeof Date<\\\"u\\\"&&e instanceof Date?\\\"date\\\":typeof File<\\\"u\\\"&&e instanceof File?\\\"file\\\":\\\"object\\\";default:throw new Error(`Unknown data type: ${r}`)}},Fe=new Set([\\\"string\\\",\\\"number\\\",\\\"symbol\\\"]),Jr=new Set([\\\"string\\\",\\\"number\\\",\\\"bigint\\\",\\\"boolean\\\",\\\"symbol\\\",\\\"undefined\\\"]);function X(e){return e.replace(/[.*+?^${}()|[\\\\]\\\\\\\\]/g,\\\"\\\\\\\\$&\\\")}function R(e,r,n){let o=new e._zod.constr(r??e._zod.def);return(!r||n?.parent)&&(o._zod.parent=e),o}function v(e){let r=e;if(!r)return{};if(typeof r==\\\"string\\\")return{error:()=>r};if(r?.message!==void 0){if(r?.error!==void 0)throw new Error(\\\"Cannot specify both `message` and `error` params\\\");r.error=r.message}return delete r.message,typeof r.error==\\\"string\\\"?{...r,error:()=>r.error}:r}function _s(e){let r;return new Proxy({},{get(n,o,t){return r??(r=e()),Reflect.get(r,o,t)},set(n,o,t,i){return r??(r=e()),Reflect.set(r,o,t,i)},has(n,o){return r??(r=e()),Reflect.has(r,o)},deleteProperty(n,o){return r??(r=e()),Reflect.deleteProperty(r,o)},ownKeys(n){return r??(r=e()),Reflect.ownKeys(r)},getOwnPropertyDescriptor(n,o){return r??(r=e()),Reflect.getOwnPropertyDescriptor(r,o)},defineProperty(n,o,t){return r??(r=e()),Reflect.defineProperty(r,o,t)}})}function p(e){return typeof e==\\\"bigint\\\"?e.toString()+\\\"n\\\":typeof e==\\\"string\\\"?`\\\"${e}\\\"`:`${e}`}function Mr(e){return Object.keys(e).filter(r=>e[r]._zod.optin===\\\"optional\\\"&&e[r]._zod.optout===\\\"optional\\\")}var Br={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},Kr={int64:[BigInt(\\\"-9223372036854775808\\\"),BigInt(\\\"9223372036854775807\\\")],uint64:[BigInt(0),BigInt(\\\"18446744073709551615\\\")]};function ys(e,r){let n=e._zod.def,o=ue(e._zod.def,{get shape(){let t={};for(let i in r){if(!(i in n.shape))throw new Error(`Unrecognized key: \\\"${i}\\\"`);r[i]&&(t[i]=n.shape[i])}return ae(this,\\\"shape\\\",t),t},checks:[]});return R(e,o)}function xs(e,r){let n=e._zod.def,o=ue(e._zod.def,{get shape(){let t={...e._zod.def.shape};for(let i in r){if(!(i in n.shape))throw new Error(`Unrecognized key: \\\"${i}\\\"`);r[i]&&delete t[i]}return ae(this,\\\"shape\\\",t),t},checks:[]});return R(e,o)}function ks(e,r){if(!ce(r))throw new Error(\\\"Invalid input to extend: expected a plain object\\\");let n=e._zod.def.checks;if(n&&n.length>0)throw new Error(\\\"Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.\\\");let t=ue(e._zod.def,{get shape(){let i={...e._zod.def.shape,...r};return ae(this,\\\"shape\\\",i),i},checks:[]});return R(e,t)}function zs(e,r){if(!ce(r))throw new Error(\\\"Invalid input to safeExtend: expected a plain object\\\");let n={...e._zod.def,get shape(){let o={...e._zod.def.shape,...r};return ae(this,\\\"shape\\\",o),o},checks:e._zod.def.checks};return R(e,n)}function Is(e,r){let n=ue(e._zod.def,{get shape(){let o={...e._zod.def.shape,...r._zod.def.shape};return ae(this,\\\"shape\\\",o),o},get catchall(){return r._zod.def.catchall},checks:[]});return R(e,n)}function ws(e,r,n){let o=ue(r._zod.def,{get shape(){let t=r._zod.def.shape,i={...t};if(n)for(let a in n){if(!(a in t))throw new Error(`Unrecognized key: \\\"${a}\\\"`);n[a]&&(i[a]=e?new e({type:\\\"optional\\\",innerType:t[a]}):t[a])}else for(let a in t)i[a]=e?new e({type:\\\"optional\\\",innerType:t[a]}):t[a];return ae(this,\\\"shape\\\",i),i},checks:[]});return R(r,o)}function Ss(e,r,n){let o=ue(r._zod.def,{get shape(){let t=r._zod.def.shape,i={...t};if(n)for(let a in n){if(!(a in i))throw new Error(`Unrecognized key: \\\"${a}\\\"`);n[a]&&(i[a]=new e({type:\\\"nonoptional\\\",innerType:t[a]}))}else for(let a in t)i[a]=new e({type:\\\"nonoptional\\\",innerType:t[a]});return ae(this,\\\"shape\\\",i),i},checks:[]});return R(r,o)}function se(e,r=0){if(e.aborted===!0)return!0;for(let n=r;n<e.issues.length;n++)if(e.issues[n]?.continue!==!0)return!0;return!1}function F(e,r){return r.map(n=>{var o;return(o=n).path??(o.path=[]),n.path.unshift(e),n})}function Le(e){return typeof e==\\\"string\\\"?e:e?.message}function J(e,r,n){let o={...e,path:e.path??[]};if(!e.message){let t=Le(e.inst?._zod.def?.error?.(e))??Le(r?.error?.(e))??Le(n.customError?.(e))??Le(n.localeError?.(e))??\\\"Invalid input\\\";o.message=t}return delete o.inst,delete o.continue,r?.reportInput||delete o.input,o}function Je(e){return e instanceof Set?\\\"set\\\":e instanceof Map?\\\"map\\\":e instanceof File?\\\"file\\\":\\\"unknown\\\"}function Me(e){return Array.isArray(e)?\\\"array\\\":typeof e==\\\"string\\\"?\\\"string\\\":\\\"unknown\\\"}function xe(...e){let[r,n,o]=e;return typeof r==\\\"string\\\"?{message:r,code:\\\"custom\\\",input:n,inst:o}:{...r}}function js(e){return Object.entries(e).filter(([r,n])=>Number.isNaN(Number.parseInt(r,10))).map(r=>r[1])}function Wa(e){let r=atob(e),n=new Uint8Array(r.length);for(let o=0;o<r.length;o++)n[o]=r.charCodeAt(o);return n}function Xa(e){let r=\\\"\\\";for(let n=0;n<e.length;n++)r+=String.fromCharCode(e[n]);return btoa(r)}function Os(e){let r=e.replace(/-/g,\\\"+\\\").replace(/_/g,\\\"/\\\"),n=\\\"=\\\".repeat((4-r.length%4)%4);return Wa(r+n)}function Ps(e){return Xa(e).replace(/\\\\+/g,\\\"-\\\").replace(/\\\\//g,\\\"_\\\").replace(/=/g,\\\"\\\")}function Us(e){let r=e.replace(/^0x/,\\\"\\\");if(r.length%2!==0)throw new Error(\\\"Invalid hex string length\\\");let n=new Uint8Array(r.length/2);for(let o=0;o<r.length;o+=2)n[o/2]=Number.parseInt(r.slice(o,o+2),16);return n}function Ns(e){return Array.from(e).map(r=>r.toString(16).padStart(2,\\\"0\\\")).join(\\\"\\\")}var Lr=class{constructor(...r){}};var qa=(e,r)=>{e.name=\\\"$ZodError\\\",Object.defineProperty(e,\\\"_zod\\\",{value:e._zod,enumerable:!1}),Object.defineProperty(e,\\\"issues\\\",{value:r,enumerable:!1}),e.message=JSON.stringify(r,_e,2),Object.defineProperty(e,\\\"toString\\\",{value:()=>e.message,enumerable:!1})},Be=c(\\\"$ZodError\\\",qa),L=c(\\\"$ZodError\\\",qa,{Parent:Error});function Ke(e,r=n=>n.message){let n={},o=[];for(let t of e.issues)t.path.length>0?(n[t.path[0]]=n[t.path[0]]||[],n[t.path[0]].push(r(t))):o.push(r(t));return{formErrors:o,fieldErrors:n}}function Ge(e,r=n=>n.message){let n={_errors:[]},o=t=>{for(let i of t.issues)if(i.code===\\\"invalid_union\\\"&&i.errors.length)i.errors.map(a=>o({issues:a}));else if(i.code===\\\"invalid_key\\\")o({issues:i.issues});else if(i.code===\\\"invalid_element\\\")o({issues:i.issues});else if(i.path.length===0)n._errors.push(r(i));else{let a=n,u=0;for(;u<i.path.length;){let s=i.path[u];u===i.path.length-1?(a[s]=a[s]||{_errors:[]},a[s]._errors.push(r(i))):a[s]=a[s]||{_errors:[]},a=a[s],u++}}};return o(e),n}function Gr(e,r=n=>n.message){let n={errors:[]},o=(t,i=[])=>{var a,u;for(let s of t.issues)if(s.code===\\\"invalid_union\\\"&&s.errors.length)s.errors.map(m=>o({issues:m},s.path));else if(s.code===\\\"invalid_key\\\")o({issues:s.issues},s.path);else if(s.code===\\\"invalid_element\\\")o({issues:s.issues},s.path);else{let m=[...i,...s.path];if(m.length===0){n.errors.push(r(s));continue}let f=n,g=0;for(;g<m.length;){let y=m[g],$=g===m.length-1;typeof y==\\\"string\\\"?(f.properties??(f.properties={}),(a=f.properties)[y]??(a[y]={errors:[]}),f=f.properties[y]):(f.items??(f.items=[]),(u=f.items)[y]??(u[y]={errors:[]}),f=f.items[y]),$&&f.errors.push(r(s)),g++}}};return o(e),n}function Ya(e){let r=[],n=e.map(o=>typeof o==\\\"object\\\"?o.key:o);for(let o of n)typeof o==\\\"number\\\"?r.push(`[${o}]`):typeof o==\\\"symbol\\\"?r.push(`[${JSON.stringify(String(o))}]`):/[^\\\\w$]/.test(o)?r.push(`[${JSON.stringify(o)}]`):(r.length&&r.push(\\\".\\\"),r.push(o));return r.join(\\\"\\\")}function Wr(e){let r=[],n=[...e.issues].sort((o,t)=>(o.path??[]).length-(t.path??[]).length);for(let o of n)r.push(`\\\\u2716 ${o.message}`),o.path?.length&&r.push(`  \\\\u2192 at ${Ya(o.path)}`);return r.join(`\\n`)}var ke=e=>(r,n,o,t)=>{let i=o?Object.assign(o,{async:!1}):{async:!1},a=r._zod.run({value:n,issues:[]},i);if(a instanceof Promise)throw new W;if(a.issues.length){let u=new(t?.Err??e)(a.issues.map(s=>J(s,i,D())));throw wt(u,t?.callee),u}return a.value},St=ke(L),ze=e=>async(r,n,o,t)=>{let i=o?Object.assign(o,{async:!0}):{async:!0},a=r._zod.run({value:n,issues:[]},i);if(a instanceof Promise&&(a=await a),a.issues.length){let u=new(t?.Err??e)(a.issues.map(s=>J(s,i,D())));throw wt(u,t?.callee),u}return a.value},jt=ze(L),Ie=e=>(r,n,o)=>{let t=o?{...o,async:!1}:{async:!1},i=r._zod.run({value:n,issues:[]},t);if(i instanceof Promise)throw new W;return i.issues.length?{success:!1,error:new(e??Be)(i.issues.map(a=>J(a,t,D())))}:{success:!0,data:i.value}},Xr=Ie(L),we=e=>async(r,n,o)=>{let t=o?Object.assign(o,{async:!0}):{async:!0},i=r._zod.run({value:n,issues:[]},t);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new e(i.issues.map(a=>J(a,t,D())))}:{success:!0,data:i.value}},qr=we(L),Ot=e=>(r,n,o)=>{let t=o?Object.assign(o,{direction:\\\"backward\\\"}):{direction:\\\"backward\\\"};return ke(e)(r,n,t)},Ds=Ot(L),Pt=e=>(r,n,o)=>ke(e)(r,n,o),Ts=Pt(L),Ut=e=>async(r,n,o)=>{let t=o?Object.assign(o,{direction:\\\"backward\\\"}):{direction:\\\"backward\\\"};return ze(e)(r,n,t)},Es=Ut(L),Nt=e=>async(r,n,o)=>ze(e)(r,n,o),As=Nt(L),Zt=e=>(r,n,o)=>{let t=o?Object.assign(o,{direction:\\\"backward\\\"}):{direction:\\\"backward\\\"};return Ie(e)(r,n,t)},Rs=Zt(L),Dt=e=>(r,n,o)=>Ie(e)(r,n,o),Ls=Dt(L),Tt=e=>async(r,n,o)=>{let t=o?Object.assign(o,{direction:\\\"backward\\\"}):{direction:\\\"backward\\\"};return we(e)(r,n,t)},Cs=Tt(L),Et=e=>async(r,n,o)=>we(e)(r,n,o),Vs=Et(L);var K={};pe(K,{base64:()=>mn,base64url:()=>At,bigint:()=>bn,boolean:()=>xn,browserEmail:()=>Xs,cidrv4:()=>ln,cidrv6:()=>dn,cuid:()=>Yr,cuid2:()=>Qr,date:()=>gn,datetime:()=>hn,domain:()=>Ys,duration:()=>nn,e164:()=>pn,email:()=>an,emoji:()=>un,extendedDuration:()=>Fs,guid:()=>on,hex:()=>Qs,hostname:()=>fn,html5Email:()=>Ks,idnEmail:()=>Ws,integer:()=>_n,ipv4:()=>cn,ipv6:()=>sn,ksuid:()=>tn,lowercase:()=>In,md5_base64:()=>el,md5_base64url:()=>tl,md5_hex:()=>Hs,nanoid:()=>rn,null:()=>kn,number:()=>yn,rfc5322Email:()=>Gs,sha1_base64:()=>nl,sha1_base64url:()=>il,sha1_hex:()=>rl,sha256_base64:()=>al,sha256_base64url:()=>ul,sha256_hex:()=>ol,sha384_base64:()=>sl,sha384_base64url:()=>ll,sha384_hex:()=>cl,sha512_base64:()=>ml,sha512_base64url:()=>fl,sha512_hex:()=>dl,string:()=>$n,time:()=>vn,ulid:()=>Hr,undefined:()=>zn,unicodeEmail:()=>Qa,uppercase:()=>wn,uuid:()=>ve,uuid4:()=>Js,uuid6:()=>Ms,uuid7:()=>Bs,xid:()=>en});var Yr=/^[cC][^\\\\s-]{8,}$/,Qr=/^[0-9a-z]+$/,Hr=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,en=/^[0-9a-vA-V]{20}$/,tn=/^[A-Za-z0-9]{27}$/,rn=/^[a-zA-Z0-9_-]{21}$/,nn=/^P(?:(\\\\d+W)|(?!.*W)(?=\\\\d|T\\\\d)(\\\\d+Y)?(\\\\d+M)?(\\\\d+D)?(T(?=\\\\d)(\\\\d+H)?(\\\\d+M)?(\\\\d+([.,]\\\\d+)?S)?)?)$/,Fs=/^[-+]?P(?!$)(?:(?:[-+]?\\\\d+Y)|(?:[-+]?\\\\d+[.,]\\\\d+Y$))?(?:(?:[-+]?\\\\d+M)|(?:[-+]?\\\\d+[.,]\\\\d+M$))?(?:(?:[-+]?\\\\d+W)|(?:[-+]?\\\\d+[.,]\\\\d+W$))?(?:(?:[-+]?\\\\d+D)|(?:[-+]?\\\\d+[.,]\\\\d+D$))?(?:T(?=[\\\\d+-])(?:(?:[-+]?\\\\d+H)|(?:[-+]?\\\\d+[.,]\\\\d+H$))?(?:(?:[-+]?\\\\d+M)|(?:[-+]?\\\\d+[.,]\\\\d+M$))?(?:[-+]?\\\\d+(?:[.,]\\\\d+)?S)?)??$/,on=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,ve=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,Js=ve(4),Ms=ve(6),Bs=ve(7),an=/^(?!\\\\.)(?!.*\\\\.\\\\.)([A-Za-z0-9_'+\\\\-\\\\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\\\\-]*\\\\.)+[A-Za-z]{2,}$/,Ks=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Gs=/^(([^<>()\\\\[\\\\]\\\\\\\\.,;:\\\\s@\\\"]+(\\\\.[^<>()\\\\[\\\\]\\\\\\\\.,;:\\\\s@\\\"]+)*)|(\\\".+\\\"))@((\\\\[[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}])|(([a-zA-Z\\\\-0-9]+\\\\.)+[a-zA-Z]{2,}))$/,Qa=/^[^\\\\s@\\\"]{1,64}@[^\\\\s@]{1,255}$/u,Ws=Qa,Xs=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,qs=\\\"^(\\\\\\\\p{Extended_Pictographic}|\\\\\\\\p{Emoji_Component})+$\\\";function un(){return new RegExp(qs,\\\"u\\\")}var cn=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,sn=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,ln=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\\\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\\\/([0-9]|[1-2][0-9]|3[0-2])$/,dn=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\\\\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,mn=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,At=/^[A-Za-z0-9_-]*$/,fn=/^(?=.{1,253}\\\\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\\\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\\\\.?$/,Ys=/^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\\\\.)+[a-zA-Z]{2,}$/,pn=/^\\\\+(?:[0-9]){6,14}[0-9]$/,Ha=\\\"(?:(?:\\\\\\\\d\\\\\\\\d[2468][048]|\\\\\\\\d\\\\\\\\d[13579][26]|\\\\\\\\d\\\\\\\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\\\\\\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\\\\\\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\\\\\\\d|30)|(?:02)-(?:0[1-9]|1\\\\\\\\d|2[0-8])))\\\",gn=new RegExp(`^${Ha}$`);function eu(e){let r=\\\"(?:[01]\\\\\\\\d|2[0-3]):[0-5]\\\\\\\\d\\\";return typeof e.precision==\\\"number\\\"?e.precision===-1?`${r}`:e.precision===0?`${r}:[0-5]\\\\\\\\d`:`${r}:[0-5]\\\\\\\\d\\\\\\\\.\\\\\\\\d{${e.precision}}`:`${r}(?::[0-5]\\\\\\\\d(?:\\\\\\\\.\\\\\\\\d+)?)?`}function vn(e){return new RegExp(`^${eu(e)}$`)}function hn(e){let r=eu({precision:e.precision}),n=[\\\"Z\\\"];e.local&&n.push(\\\"\\\"),e.offset&&n.push(\\\"([+-](?:[01]\\\\\\\\d|2[0-3]):[0-5]\\\\\\\\d)\\\");let o=`${r}(?:${n.join(\\\"|\\\")})`;return new RegExp(`^${Ha}T(?:${o})$`)}var $n=e=>{let r=e?`[\\\\\\\\s\\\\\\\\S]{${e?.minimum??0},${e?.maximum??\\\"\\\"}}`:\\\"[\\\\\\\\s\\\\\\\\S]*\\\";return new RegExp(`^${r}$`)},bn=/^-?\\\\d+n?$/,_n=/^-?\\\\d+$/,yn=/^-?\\\\d+(?:\\\\.\\\\d+)?/,xn=/^(?:true|false)$/i,kn=/^null$/i;var zn=/^undefined$/i;var In=/^[^A-Z]*$/,wn=/^[^a-z]*$/,Qs=/^[0-9a-fA-F]*$/;function We(e,r){return new RegExp(`^[A-Za-z0-9+/]{${e}}${r}$`)}function Xe(e){return new RegExp(`^[A-Za-z0-9_-]{${e}}$`)}var Hs=/^[0-9a-fA-F]{32}$/,el=We(22,\\\"==\\\"),tl=Xe(22),rl=/^[0-9a-fA-F]{40}$/,nl=We(27,\\\"=\\\"),il=Xe(27),ol=/^[0-9a-fA-F]{64}$/,al=We(43,\\\"=\\\"),ul=Xe(43),cl=/^[0-9a-fA-F]{96}$/,sl=We(64,\\\"\\\"),ll=Xe(64),dl=/^[0-9a-fA-F]{128}$/,ml=We(86,\\\"==\\\"),fl=Xe(86);var Z=c(\\\"$ZodCheck\\\",(e,r)=>{var n;e._zod??(e._zod={}),e._zod.def=r,(n=e._zod).onattach??(n.onattach=[])}),ru={number:\\\"number\\\",bigint:\\\"bigint\\\",object:\\\"date\\\"},Rt=c(\\\"$ZodCheckLessThan\\\",(e,r)=>{Z.init(e,r);let n=ru[typeof r.value];e._zod.onattach.push(o=>{let t=o._zod.bag,i=(r.inclusive?t.maximum:t.exclusiveMaximum)??Number.POSITIVE_INFINITY;r.value<i&&(r.inclusive?t.maximum=r.value:t.exclusiveMaximum=r.value)}),e._zod.check=o=>{(r.inclusive?o.value<=r.value:o.value<r.value)||o.issues.push({origin:n,code:\\\"too_big\\\",maximum:r.value,input:o.value,inclusive:r.inclusive,inst:e,continue:!r.abort})}}),Lt=c(\\\"$ZodCheckGreaterThan\\\",(e,r)=>{Z.init(e,r);let n=ru[typeof r.value];e._zod.onattach.push(o=>{let t=o._zod.bag,i=(r.inclusive?t.minimum:t.exclusiveMinimum)??Number.NEGATIVE_INFINITY;r.value>i&&(r.inclusive?t.minimum=r.value:t.exclusiveMinimum=r.value)}),e._zod.check=o=>{(r.inclusive?o.value>=r.value:o.value>r.value)||o.issues.push({origin:n,code:\\\"too_small\\\",minimum:r.value,input:o.value,inclusive:r.inclusive,inst:e,continue:!r.abort})}}),Sn=c(\\\"$ZodCheckMultipleOf\\\",(e,r)=>{Z.init(e,r),e._zod.onattach.push(n=>{var o;(o=n._zod.bag).multipleOf??(o.multipleOf=r.value)}),e._zod.check=n=>{if(typeof n.value!=typeof r.value)throw new Error(\\\"Cannot mix number and bigint in multiple_of check.\\\");(typeof n.value==\\\"bigint\\\"?n.value%r.value===BigInt(0):Cr(n.value,r.value)===0)||n.issues.push({origin:typeof n.value,code:\\\"not_multiple_of\\\",divisor:r.value,input:n.value,inst:e,continue:!r.abort})}}),jn=c(\\\"$ZodCheckNumberFormat\\\",(e,r)=>{Z.init(e,r),r.format=r.format||\\\"float64\\\";let n=r.format?.includes(\\\"int\\\"),o=n?\\\"int\\\":\\\"number\\\",[t,i]=Br[r.format];e._zod.onattach.push(a=>{let u=a._zod.bag;u.format=r.format,u.minimum=t,u.maximum=i,n&&(u.pattern=_n)}),e._zod.check=a=>{let u=a.value;if(n){if(!Number.isInteger(u)){a.issues.push({expected:o,format:r.format,code:\\\"invalid_type\\\",continue:!1,input:u,inst:e});return}if(!Number.isSafeInteger(u)){u>0?a.issues.push({input:u,code:\\\"too_big\\\",maximum:Number.MAX_SAFE_INTEGER,note:\\\"Integers must be within the safe integer range.\\\",inst:e,origin:o,continue:!r.abort}):a.issues.push({input:u,code:\\\"too_small\\\",minimum:Number.MIN_SAFE_INTEGER,note:\\\"Integers must be within the safe integer range.\\\",inst:e,origin:o,continue:!r.abort});return}}u<t&&a.issues.push({origin:\\\"number\\\",input:u,code:\\\"too_small\\\",minimum:t,inclusive:!0,inst:e,continue:!r.abort}),u>i&&a.issues.push({origin:\\\"number\\\",input:u,code:\\\"too_big\\\",maximum:i,inst:e})}}),On=c(\\\"$ZodCheckBigIntFormat\\\",(e,r)=>{Z.init(e,r);let[n,o]=Kr[r.format];e._zod.onattach.push(t=>{let i=t._zod.bag;i.format=r.format,i.minimum=n,i.maximum=o}),e._zod.check=t=>{let i=t.value;i<n&&t.issues.push({origin:\\\"bigint\\\",input:i,code:\\\"too_small\\\",minimum:n,inclusive:!0,inst:e,continue:!r.abort}),i>o&&t.issues.push({origin:\\\"bigint\\\",input:i,code:\\\"too_big\\\",maximum:o,inst:e})}}),Pn=c(\\\"$ZodCheckMaxSize\\\",(e,r)=>{var n;Z.init(e,r),(n=e._zod.def).when??(n.when=o=>{let t=o.value;return!oe(t)&&t.size!==void 0}),e._zod.onattach.push(o=>{let t=o._zod.bag.maximum??Number.POSITIVE_INFINITY;r.maximum<t&&(o._zod.bag.maximum=r.maximum)}),e._zod.check=o=>{let t=o.value;t.size<=r.maximum||o.issues.push({origin:Je(t),code:\\\"too_big\\\",maximum:r.maximum,inclusive:!0,input:t,inst:e,continue:!r.abort})}}),Un=c(\\\"$ZodCheckMinSize\\\",(e,r)=>{var n;Z.init(e,r),(n=e._zod.def).when??(n.when=o=>{let t=o.value;return!oe(t)&&t.size!==void 0}),e._zod.onattach.push(o=>{let t=o._zod.bag.minimum??Number.NEGATIVE_INFINITY;r.minimum>t&&(o._zod.bag.minimum=r.minimum)}),e._zod.check=o=>{let t=o.value;t.size>=r.minimum||o.issues.push({origin:Je(t),code:\\\"too_small\\\",minimum:r.minimum,inclusive:!0,input:t,inst:e,continue:!r.abort})}}),Nn=c(\\\"$ZodCheckSizeEquals\\\",(e,r)=>{var n;Z.init(e,r),(n=e._zod.def).when??(n.when=o=>{let t=o.value;return!oe(t)&&t.size!==void 0}),e._zod.onattach.push(o=>{let t=o._zod.bag;t.minimum=r.size,t.maximum=r.size,t.size=r.size}),e._zod.check=o=>{let t=o.value,i=t.size;if(i===r.size)return;let a=i>r.size;o.issues.push({origin:Je(t),...a?{code:\\\"too_big\\\",maximum:r.size}:{code:\\\"too_small\\\",minimum:r.size},inclusive:!0,exact:!0,input:o.value,inst:e,continue:!r.abort})}}),Zn=c(\\\"$ZodCheckMaxLength\\\",(e,r)=>{var n;Z.init(e,r),(n=e._zod.def).when??(n.when=o=>{let t=o.value;return!oe(t)&&t.length!==void 0}),e._zod.onattach.push(o=>{let t=o._zod.bag.maximum??Number.POSITIVE_INFINITY;r.maximum<t&&(o._zod.bag.maximum=r.maximum)}),e._zod.check=o=>{let t=o.value;if(t.length<=r.maximum)return;let a=Me(t);o.issues.push({origin:a,code:\\\"too_big\\\",maximum:r.maximum,inclusive:!0,input:t,inst:e,continue:!r.abort})}}),Dn=c(\\\"$ZodCheckMinLength\\\",(e,r)=>{var n;Z.init(e,r),(n=e._zod.def).when??(n.when=o=>{let t=o.value;return!oe(t)&&t.length!==void 0}),e._zod.onattach.push(o=>{let t=o._zod.bag.minimum??Number.NEGATIVE_INFINITY;r.minimum>t&&(o._zod.bag.minimum=r.minimum)}),e._zod.check=o=>{let t=o.value;if(t.length>=r.minimum)return;let a=Me(t);o.issues.push({origin:a,code:\\\"too_small\\\",minimum:r.minimum,inclusive:!0,input:t,inst:e,continue:!r.abort})}}),Tn=c(\\\"$ZodCheckLengthEquals\\\",(e,r)=>{var n;Z.init(e,r),(n=e._zod.def).when??(n.when=o=>{let t=o.value;return!oe(t)&&t.length!==void 0}),e._zod.onattach.push(o=>{let t=o._zod.bag;t.minimum=r.length,t.maximum=r.length,t.length=r.length}),e._zod.check=o=>{let t=o.value,i=t.length;if(i===r.length)return;let a=Me(t),u=i>r.length;o.issues.push({origin:a,...u?{code:\\\"too_big\\\",maximum:r.length}:{code:\\\"too_small\\\",minimum:r.length},inclusive:!0,exact:!0,input:o.value,inst:e,continue:!r.abort})}}),Se=c(\\\"$ZodCheckStringFormat\\\",(e,r)=>{var n,o;Z.init(e,r),e._zod.onattach.push(t=>{let i=t._zod.bag;i.format=r.format,r.pattern&&(i.patterns??(i.patterns=new Set),i.patterns.add(r.pattern))}),r.pattern?(n=e._zod).check??(n.check=t=>{r.pattern.lastIndex=0,!r.pattern.test(t.value)&&t.issues.push({origin:\\\"string\\\",code:\\\"invalid_format\\\",format:r.format,input:t.value,...r.pattern?{pattern:r.pattern.toString()}:{},inst:e,continue:!r.abort})}):(o=e._zod).check??(o.check=()=>{})}),En=c(\\\"$ZodCheckRegex\\\",(e,r)=>{Se.init(e,r),e._zod.check=n=>{r.pattern.lastIndex=0,!r.pattern.test(n.value)&&n.issues.push({origin:\\\"string\\\",code:\\\"invalid_format\\\",format:\\\"regex\\\",input:n.value,pattern:r.pattern.toString(),inst:e,continue:!r.abort})}}),An=c(\\\"$ZodCheckLowerCase\\\",(e,r)=>{r.pattern??(r.pattern=In),Se.init(e,r)}),Rn=c(\\\"$ZodCheckUpperCase\\\",(e,r)=>{r.pattern??(r.pattern=wn),Se.init(e,r)}),Ln=c(\\\"$ZodCheckIncludes\\\",(e,r)=>{Z.init(e,r);let n=X(r.includes),o=new RegExp(typeof r.position==\\\"number\\\"?`^.{${r.position}}${n}`:n);r.pattern=o,e._zod.onattach.push(t=>{let i=t._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(o)}),e._zod.check=t=>{t.value.includes(r.includes,r.position)||t.issues.push({origin:\\\"string\\\",code:\\\"invalid_format\\\",format:\\\"includes\\\",includes:r.includes,input:t.value,inst:e,continue:!r.abort})}}),Cn=c(\\\"$ZodCheckStartsWith\\\",(e,r)=>{Z.init(e,r);let n=new RegExp(`^${X(r.prefix)}.*`);r.pattern??(r.pattern=n),e._zod.onattach.push(o=>{let t=o._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(n)}),e._zod.check=o=>{o.value.startsWith(r.prefix)||o.issues.push({origin:\\\"string\\\",code:\\\"invalid_format\\\",format:\\\"starts_with\\\",prefix:r.prefix,input:o.value,inst:e,continue:!r.abort})}}),Vn=c(\\\"$ZodCheckEndsWith\\\",(e,r)=>{Z.init(e,r);let n=new RegExp(`.*${X(r.suffix)}$`);r.pattern??(r.pattern=n),e._zod.onattach.push(o=>{let t=o._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(n)}),e._zod.check=o=>{o.value.endsWith(r.suffix)||o.issues.push({origin:\\\"string\\\",code:\\\"invalid_format\\\",format:\\\"ends_with\\\",suffix:r.suffix,input:o.value,inst:e,continue:!r.abort})}});function tu(e,r,n){e.issues.length&&r.issues.push(...F(n,e.issues))}var Fn=c(\\\"$ZodCheckProperty\\\",(e,r)=>{Z.init(e,r),e._zod.check=n=>{let o=r.schema._zod.run({value:n.value[r.property],issues:[]},{});if(o instanceof Promise)return o.then(t=>tu(t,n,r.property));tu(o,n,r.property)}}),Jn=c(\\\"$ZodCheckMimeType\\\",(e,r)=>{Z.init(e,r);let n=new Set(r.mime);e._zod.onattach.push(o=>{o._zod.bag.mime=r.mime}),e._zod.check=o=>{n.has(o.value.type)||o.issues.push({code:\\\"invalid_value\\\",values:r.mime,input:o.value.type,inst:e,continue:!r.abort})}}),Mn=c(\\\"$ZodCheckOverwrite\\\",(e,r)=>{Z.init(e,r),e._zod.check=n=>{n.value=r.tx(n.value)}});var qe=class{constructor(r=[]){this.content=[],this.indent=0,this&&(this.args=r)}indented(r){this.indent+=1,r(this),this.indent-=1}write(r){if(typeof r==\\\"function\\\"){r(this,{execution:\\\"sync\\\"}),r(this,{execution:\\\"async\\\"});return}let o=r.split(`\\n`).filter(a=>a),t=Math.min(...o.map(a=>a.length-a.trimStart().length)),i=o.map(a=>a.slice(t)).map(a=>\\\" \\\".repeat(this.indent*2)+a);for(let a of i)this.content.push(a)}compile(){let r=Function,n=this?.args,t=[...(this?.content??[\\\"\\\"]).map(i=>`  ${i}`)];return new r(...n,t.join(`\\n`))}};var Bn={major:4,minor:1,patch:12};var x=c(\\\"$ZodType\\\",(e,r)=>{var n;e??(e={}),e._zod.def=r,e._zod.bag=e._zod.bag||{},e._zod.version=Bn;let o=[...e._zod.def.checks??[]];e._zod.traits.has(\\\"$ZodCheck\\\")&&o.unshift(e);for(let t of o)for(let i of t._zod.onattach)i(e);if(o.length===0)(n=e._zod).deferred??(n.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{let t=(a,u,s)=>{let m=se(a),f;for(let g of u){if(g._zod.def.when){if(!g._zod.def.when(a))continue}else if(m)continue;let y=a.issues.length,$=g._zod.check(a);if($ instanceof Promise&&s?.async===!1)throw new W;if(f||$ instanceof Promise)f=(f??Promise.resolve()).then(async()=>{await $,a.issues.length!==y&&(m||(m=se(a,y)))});else{if(a.issues.length===y)continue;m||(m=se(a,y))}}return f?f.then(()=>a):a},i=(a,u,s)=>{if(se(a))return a.aborted=!0,a;let m=t(u,o,s);if(m instanceof Promise){if(s.async===!1)throw new W;return m.then(f=>e._zod.parse(f,s))}return e._zod.parse(m,s)};e._zod.run=(a,u)=>{if(u.skipChecks)return e._zod.parse(a,u);if(u.direction===\\\"backward\\\"){let m=e._zod.parse({value:a.value,issues:[]},{...u,skipChecks:!0});return m instanceof Promise?m.then(f=>i(f,a,u)):i(m,a,u)}let s=e._zod.parse(a,u);if(s instanceof Promise){if(u.async===!1)throw new W;return s.then(m=>t(m,o,u))}return t(s,o,u)}}e[\\\"~standard\\\"]={validate:t=>{try{let i=Xr(e,t);return i.success?{value:i.data}:{issues:i.error?.issues}}catch{return qr(e,t).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:\\\"zod\\\",version:1}}),he=c(\\\"$ZodString\\\",(e,r)=>{x.init(e,r),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??$n(e._zod.bag),e._zod.parse=(n,o)=>{if(r.coerce)try{n.value=String(n.value)}catch{}return typeof n.value==\\\"string\\\"||n.issues.push({expected:\\\"string\\\",code:\\\"invalid_type\\\",input:n.value,inst:e}),n}}),O=c(\\\"$ZodStringFormat\\\",(e,r)=>{Se.init(e,r),he.init(e,r)}),Gn=c(\\\"$ZodGUID\\\",(e,r)=>{r.pattern??(r.pattern=on),O.init(e,r)}),Wn=c(\\\"$ZodUUID\\\",(e,r)=>{if(r.version){let o={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[r.version];if(o===void 0)throw new Error(`Invalid UUID version: \\\"${r.version}\\\"`);r.pattern??(r.pattern=ve(o))}else r.pattern??(r.pattern=ve());O.init(e,r)}),Xn=c(\\\"$ZodEmail\\\",(e,r)=>{r.pattern??(r.pattern=an),O.init(e,r)}),qn=c(\\\"$ZodURL\\\",(e,r)=>{O.init(e,r),e._zod.check=n=>{try{let o=n.value.trim(),t=new URL(o);r.hostname&&(r.hostname.lastIndex=0,r.hostname.test(t.hostname)||n.issues.push({code:\\\"invalid_format\\\",format:\\\"url\\\",note:\\\"Invalid hostname\\\",pattern:fn.source,input:n.value,inst:e,continue:!r.abort})),r.protocol&&(r.protocol.lastIndex=0,r.protocol.test(t.protocol.endsWith(\\\":\\\")?t.protocol.slice(0,-1):t.protocol)||n.issues.push({code:\\\"invalid_format\\\",format:\\\"url\\\",note:\\\"Invalid protocol\\\",pattern:r.protocol.source,input:n.value,inst:e,continue:!r.abort})),r.normalize?n.value=t.href:n.value=o;return}catch{n.issues.push({code:\\\"invalid_format\\\",format:\\\"url\\\",input:n.value,inst:e,continue:!r.abort})}}}),Yn=c(\\\"$ZodEmoji\\\",(e,r)=>{r.pattern??(r.pattern=un()),O.init(e,r)}),Qn=c(\\\"$ZodNanoID\\\",(e,r)=>{r.pattern??(r.pattern=rn),O.init(e,r)}),Hn=c(\\\"$ZodCUID\\\",(e,r)=>{r.pattern??(r.pattern=Yr),O.init(e,r)}),ei=c(\\\"$ZodCUID2\\\",(e,r)=>{r.pattern??(r.pattern=Qr),O.init(e,r)}),ti=c(\\\"$ZodULID\\\",(e,r)=>{r.pattern??(r.pattern=Hr),O.init(e,r)}),ri=c(\\\"$ZodXID\\\",(e,r)=>{r.pattern??(r.pattern=en),O.init(e,r)}),ni=c(\\\"$ZodKSUID\\\",(e,r)=>{r.pattern??(r.pattern=tn),O.init(e,r)}),ii=c(\\\"$ZodISODateTime\\\",(e,r)=>{r.pattern??(r.pattern=hn(r)),O.init(e,r)}),oi=c(\\\"$ZodISODate\\\",(e,r)=>{r.pattern??(r.pattern=gn),O.init(e,r)}),ai=c(\\\"$ZodISOTime\\\",(e,r)=>{r.pattern??(r.pattern=vn(r)),O.init(e,r)}),ui=c(\\\"$ZodISODuration\\\",(e,r)=>{r.pattern??(r.pattern=nn),O.init(e,r)}),ci=c(\\\"$ZodIPv4\\\",(e,r)=>{r.pattern??(r.pattern=cn),O.init(e,r),e._zod.onattach.push(n=>{let o=n._zod.bag;o.format=\\\"ipv4\\\"})}),si=c(\\\"$ZodIPv6\\\",(e,r)=>{r.pattern??(r.pattern=sn),O.init(e,r),e._zod.onattach.push(n=>{let o=n._zod.bag;o.format=\\\"ipv6\\\"}),e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:\\\"invalid_format\\\",format:\\\"ipv6\\\",input:n.value,inst:e,continue:!r.abort})}}}),li=c(\\\"$ZodCIDRv4\\\",(e,r)=>{r.pattern??(r.pattern=ln),O.init(e,r)}),di=c(\\\"$ZodCIDRv6\\\",(e,r)=>{r.pattern??(r.pattern=dn),O.init(e,r),e._zod.check=n=>{let o=n.value.split(\\\"/\\\");try{if(o.length!==2)throw new Error;let[t,i]=o;if(!i)throw new Error;let a=Number(i);if(`${a}`!==i)throw new Error;if(a<0||a>128)throw new Error;new URL(`http://[${t}]`)}catch{n.issues.push({code:\\\"invalid_format\\\",format:\\\"cidrv6\\\",input:n.value,inst:e,continue:!r.abort})}}});function mi(e){if(e===\\\"\\\")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}var fi=c(\\\"$ZodBase64\\\",(e,r)=>{r.pattern??(r.pattern=mn),O.init(e,r),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding=\\\"base64\\\"}),e._zod.check=n=>{mi(n.value)||n.issues.push({code:\\\"invalid_format\\\",format:\\\"base64\\\",input:n.value,inst:e,continue:!r.abort})}});function pu(e){if(!At.test(e))return!1;let r=e.replace(/[-_]/g,o=>o===\\\"-\\\"?\\\"+\\\":\\\"/\\\"),n=r.padEnd(Math.ceil(r.length/4)*4,\\\"=\\\");return mi(n)}var pi=c(\\\"$ZodBase64URL\\\",(e,r)=>{r.pattern??(r.pattern=At),O.init(e,r),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding=\\\"base64url\\\"}),e._zod.check=n=>{pu(n.value)||n.issues.push({code:\\\"invalid_format\\\",format:\\\"base64url\\\",input:n.value,inst:e,continue:!r.abort})}}),gi=c(\\\"$ZodE164\\\",(e,r)=>{r.pattern??(r.pattern=pn),O.init(e,r)});function gu(e,r=null){try{let n=e.split(\\\".\\\");if(n.length!==3)return!1;let[o]=n;if(!o)return!1;let t=JSON.parse(atob(o));return!(\\\"typ\\\"in t&&t?.typ!==\\\"JWT\\\"||!t.alg||r&&(!(\\\"alg\\\"in t)||t.alg!==r))}catch{return!1}}var vi=c(\\\"$ZodJWT\\\",(e,r)=>{O.init(e,r),e._zod.check=n=>{gu(n.value,r.alg)||n.issues.push({code:\\\"invalid_format\\\",format:\\\"jwt\\\",input:n.value,inst:e,continue:!r.abort})}}),hi=c(\\\"$ZodCustomStringFormat\\\",(e,r)=>{O.init(e,r),e._zod.check=n=>{r.fn(n.value)||n.issues.push({code:\\\"invalid_format\\\",format:r.format,input:n.value,inst:e,continue:!r.abort})}}),Bt=c(\\\"$ZodNumber\\\",(e,r)=>{x.init(e,r),e._zod.pattern=e._zod.bag.pattern??yn,e._zod.parse=(n,o)=>{if(r.coerce)try{n.value=Number(n.value)}catch{}let t=n.value;if(typeof t==\\\"number\\\"&&!Number.isNaN(t)&&Number.isFinite(t))return n;let i=typeof t==\\\"number\\\"?Number.isNaN(t)?\\\"NaN\\\":Number.isFinite(t)?void 0:\\\"Infinity\\\":void 0;return n.issues.push({expected:\\\"number\\\",code:\\\"invalid_type\\\",input:t,inst:e,...i?{received:i}:{}}),n}}),$i=c(\\\"$ZodNumber\\\",(e,r)=>{jn.init(e,r),Bt.init(e,r)}),Ye=c(\\\"$ZodBoolean\\\",(e,r)=>{x.init(e,r),e._zod.pattern=xn,e._zod.parse=(n,o)=>{if(r.coerce)try{n.value=!!n.value}catch{}let t=n.value;return typeof t==\\\"boolean\\\"||n.issues.push({expected:\\\"boolean\\\",code:\\\"invalid_type\\\",input:t,inst:e}),n}}),Kt=c(\\\"$ZodBigInt\\\",(e,r)=>{x.init(e,r),e._zod.pattern=bn,e._zod.parse=(n,o)=>{if(r.coerce)try{n.value=BigInt(n.value)}catch{}return typeof n.value==\\\"bigint\\\"||n.issues.push({expected:\\\"bigint\\\",code:\\\"invalid_type\\\",input:n.value,inst:e}),n}}),bi=c(\\\"$ZodBigInt\\\",(e,r)=>{On.init(e,r),Kt.init(e,r)}),_i=c(\\\"$ZodSymbol\\\",(e,r)=>{x.init(e,r),e._zod.parse=(n,o)=>{let t=n.value;return typeof t==\\\"symbol\\\"||n.issues.push({expected:\\\"symbol\\\",code:\\\"invalid_type\\\",input:t,inst:e}),n}}),yi=c(\\\"$ZodUndefined\\\",(e,r)=>{x.init(e,r),e._zod.pattern=zn,e._zod.values=new Set([void 0]),e._zod.optin=\\\"optional\\\",e._zod.optout=\\\"optional\\\",e._zod.parse=(n,o)=>{let t=n.value;return typeof t>\\\"u\\\"||n.issues.push({expected:\\\"undefined\\\",code:\\\"invalid_type\\\",input:t,inst:e}),n}}),xi=c(\\\"$ZodNull\\\",(e,r)=>{x.init(e,r),e._zod.pattern=kn,e._zod.values=new Set([null]),e._zod.parse=(n,o)=>{let t=n.value;return t===null||n.issues.push({expected:\\\"null\\\",code:\\\"invalid_type\\\",input:t,inst:e}),n}}),ki=c(\\\"$ZodAny\\\",(e,r)=>{x.init(e,r),e._zod.parse=n=>n}),zi=c(\\\"$ZodUnknown\\\",(e,r)=>{x.init(e,r),e._zod.parse=n=>n}),Ii=c(\\\"$ZodNever\\\",(e,r)=>{x.init(e,r),e._zod.parse=(n,o)=>(n.issues.push({expected:\\\"never\\\",code:\\\"invalid_type\\\",input:n.value,inst:e}),n)}),wi=c(\\\"$ZodVoid\\\",(e,r)=>{x.init(e,r),e._zod.parse=(n,o)=>{let t=n.value;return typeof t>\\\"u\\\"||n.issues.push({expected:\\\"void\\\",code:\\\"invalid_type\\\",input:t,inst:e}),n}}),Si=c(\\\"$ZodDate\\\",(e,r)=>{x.init(e,r),e._zod.parse=(n,o)=>{if(r.coerce)try{n.value=new Date(n.value)}catch{}let t=n.value,i=t instanceof Date;return i&&!Number.isNaN(t.getTime())||n.issues.push({expected:\\\"date\\\",code:\\\"invalid_type\\\",input:t,...i?{received:\\\"Invalid Date\\\"}:{},inst:e}),n}});function iu(e,r,n){e.issues.length&&r.issues.push(...F(n,e.issues)),r.value[n]=e.value}var ji=c(\\\"$ZodArray\\\",(e,r)=>{x.init(e,r),e._zod.parse=(n,o)=>{let t=n.value;if(!Array.isArray(t))return n.issues.push({expected:\\\"array\\\",code:\\\"invalid_type\\\",input:t,inst:e}),n;n.value=Array(t.length);let i=[];for(let a=0;a<t.length;a++){let u=t[a],s=r.element._zod.run({value:u,issues:[]},o);s instanceof Promise?i.push(s.then(m=>iu(m,n,a))):iu(s,n,a)}return i.length?Promise.all(i).then(()=>n):n}});function Mt(e,r,n,o){e.issues.length&&r.issues.push(...F(n,e.issues)),e.value===void 0?n in o&&(r.value[n]=void 0):r.value[n]=e.value}function vu(e){let r=Object.keys(e.shape);for(let o of r)if(!e.shape?.[o]?._zod?.traits?.has(\\\"$ZodType\\\"))throw new Error(`Invalid element at key \\\"${o}\\\": expected a Zod schema`);let n=Mr(e.shape);return{...e,keys:r,keySet:new Set(r),numKeys:r.length,optionalKeys:new Set(n)}}function hu(e,r,n,o,t,i){let a=[],u=t.keySet,s=t.catchall._zod,m=s.def.type;for(let f of Object.keys(r)){if(u.has(f))continue;if(m===\\\"never\\\"){a.push(f);continue}let g=s.run({value:r[f],issues:[]},o);g instanceof Promise?e.push(g.then(y=>Mt(y,n,f,r))):Mt(g,n,f,r)}return a.length&&n.issues.push({code:\\\"unrecognized_keys\\\",keys:a,input:r,inst:i}),e.length?Promise.all(e).then(()=>n):n}var $u=c(\\\"$ZodObject\\\",(e,r)=>{if(x.init(e,r),!Object.getOwnPropertyDescriptor(r,\\\"shape\\\")?.get){let u=r.shape;Object.defineProperty(r,\\\"shape\\\",{get:()=>{let s={...u};return Object.defineProperty(r,\\\"shape\\\",{value:s}),s}})}let o=ye(()=>vu(r));I(e._zod,\\\"propValues\\\",()=>{let u=r.shape,s={};for(let m in u){let f=u[m]._zod;if(f.values){s[m]??(s[m]=new Set);for(let g of f.values)s[m].add(g)}}return s});let t=ge,i=r.catchall,a;e._zod.parse=(u,s)=>{a??(a=o.value);let m=u.value;if(!t(m))return u.issues.push({expected:\\\"object\\\",code:\\\"invalid_type\\\",input:m,inst:e}),u;u.value={};let f=[],g=a.shape;for(let y of a.keys){let d=g[y]._zod.run({value:m[y],issues:[]},s);d instanceof Promise?f.push(d.then(b=>Mt(b,u,y,m))):Mt(d,u,y,m)}return i?hu(f,m,u,s,o.value,e):f.length?Promise.all(f).then(()=>u):u}}),Oi=c(\\\"$ZodObjectJIT\\\",(e,r)=>{$u.init(e,r);let n=e._zod.parse,o=ye(()=>vu(r)),t=y=>{let $=new qe([\\\"shape\\\",\\\"payload\\\",\\\"ctx\\\"]),d=o.value,b=z=>{let j=It(z);return`shape[${j}]._zod.run({ value: input[${j}], issues: [] }, ctx)`};$.write(\\\"const input = payload.value;\\\");let _=Object.create(null),S=0;for(let z of d.keys)_[z]=`key_${S++}`;$.write(\\\"const newResult = {};\\\");for(let z of d.keys){let j=_[z],A=It(z);$.write(`const ${j} = ${b(z)};`),$.write(`\\n        if (${j}.issues.length) {\\n          payload.issues = payload.issues.concat(${j}.issues.map(iss => ({\\n            ...iss,\\n            path: iss.path ? [${A}, ...iss.path] : [${A}]\\n          })));\\n        }\\n        \\n        \\n        if (${j}.value === undefined) {\\n          if (${A} in input) {\\n            newResult[${A}] = undefined;\\n          }\\n        } else {\\n          newResult[${A}] = ${j}.value;\\n        }\\n        \\n      `)}$.write(\\\"payload.value = newResult;\\\"),$.write(\\\"return payload;\\\");let w=$.compile();return(z,j)=>w(y,z,j)},i,a=ge,u=!Re.jitless,m=u&&Vr.value,f=r.catchall,g;e._zod.parse=(y,$)=>{g??(g=o.value);let d=y.value;return a(d)?u&&m&&$?.async===!1&&$.jitless!==!0?(i||(i=t(r.shape)),y=i(y,$),f?hu([],d,y,$,g,e):y):n(y,$):(y.issues.push({expected:\\\"object\\\",code:\\\"invalid_type\\\",input:d,inst:e}),y)}});function ou(e,r,n,o){for(let i of e)if(i.issues.length===0)return r.value=i.value,r;let t=e.filter(i=>!se(i));return t.length===1?(r.value=t[0].value,t[0]):(r.issues.push({code:\\\"invalid_union\\\",input:r.value,inst:n,errors:e.map(i=>i.issues.map(a=>J(a,o,D())))}),r)}var Gt=c(\\\"$ZodUnion\\\",(e,r)=>{x.init(e,r),I(e._zod,\\\"optin\\\",()=>r.options.some(t=>t._zod.optin===\\\"optional\\\")?\\\"optional\\\":void 0),I(e._zod,\\\"optout\\\",()=>r.options.some(t=>t._zod.optout===\\\"optional\\\")?\\\"optional\\\":void 0),I(e._zod,\\\"values\\\",()=>{if(r.options.every(t=>t._zod.values))return new Set(r.options.flatMap(t=>Array.from(t._zod.values)))}),I(e._zod,\\\"pattern\\\",()=>{if(r.options.every(t=>t._zod.pattern)){let t=r.options.map(i=>i._zod.pattern);return new RegExp(`^(${t.map(i=>Ve(i.source)).join(\\\"|\\\")})$`)}});let n=r.options.length===1,o=r.options[0]._zod.run;e._zod.parse=(t,i)=>{if(n)return o(t,i);let a=!1,u=[];for(let s of r.options){let m=s._zod.run({value:t.value,issues:[]},i);if(m instanceof Promise)u.push(m),a=!0;else{if(m.issues.length===0)return m;u.push(m)}}return a?Promise.all(u).then(s=>ou(s,t,e,i)):ou(u,t,e,i)}}),Pi=c(\\\"$ZodDiscriminatedUnion\\\",(e,r)=>{Gt.init(e,r);let n=e._zod.parse;I(e._zod,\\\"propValues\\\",()=>{let t={};for(let i of r.options){let a=i._zod.propValues;if(!a||Object.keys(a).length===0)throw new Error(`Invalid discriminated union option at index \\\"${r.options.indexOf(i)}\\\"`);for(let[u,s]of Object.entries(a)){t[u]||(t[u]=new Set);for(let m of s)t[u].add(m)}}return t});let o=ye(()=>{let t=r.options,i=new Map;for(let a of t){let u=a._zod.propValues?.[r.discriminator];if(!u||u.size===0)throw new Error(`Invalid discriminated union option at index \\\"${r.options.indexOf(a)}\\\"`);for(let s of u){if(i.has(s))throw new Error(`Duplicate discriminator value \\\"${String(s)}\\\"`);i.set(s,a)}}return i});e._zod.parse=(t,i)=>{let a=t.value;if(!ge(a))return t.issues.push({code:\\\"invalid_type\\\",expected:\\\"object\\\",input:a,inst:e}),t;let u=o.value.get(a?.[r.discriminator]);return u?u._zod.run(t,i):r.unionFallback?n(t,i):(t.issues.push({code:\\\"invalid_union\\\",errors:[],note:\\\"No matching discriminator\\\",discriminator:r.discriminator,input:a,path:[r.discriminator],inst:e}),t)}}),Ui=c(\\\"$ZodIntersection\\\",(e,r)=>{x.init(e,r),e._zod.parse=(n,o)=>{let t=n.value,i=r.left._zod.run({value:t,issues:[]},o),a=r.right._zod.run({value:t,issues:[]},o);return i instanceof Promise||a instanceof Promise?Promise.all([i,a]).then(([s,m])=>au(n,s,m)):au(n,i,a)}});function Kn(e,r){if(e===r)return{valid:!0,data:e};if(e instanceof Date&&r instanceof Date&&+e==+r)return{valid:!0,data:e};if(ce(e)&&ce(r)){let n=Object.keys(r),o=Object.keys(e).filter(i=>n.indexOf(i)!==-1),t={...e,...r};for(let i of o){let a=Kn(e[i],r[i]);if(!a.valid)return{valid:!1,mergeErrorPath:[i,...a.mergeErrorPath]};t[i]=a.data}return{valid:!0,data:t}}if(Array.isArray(e)&&Array.isArray(r)){if(e.length!==r.length)return{valid:!1,mergeErrorPath:[]};let n=[];for(let o=0;o<e.length;o++){let t=e[o],i=r[o],a=Kn(t,i);if(!a.valid)return{valid:!1,mergeErrorPath:[o,...a.mergeErrorPath]};n.push(a.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function au(e,r,n){if(r.issues.length&&e.issues.push(...r.issues),n.issues.length&&e.issues.push(...n.issues),se(e))return e;let o=Kn(r.value,n.value);if(!o.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(o.mergeErrorPath)}`);return e.value=o.data,e}var Wt=c(\\\"$ZodTuple\\\",(e,r)=>{x.init(e,r);let n=r.items,o=n.length-[...n].reverse().findIndex(t=>t._zod.optin!==\\\"optional\\\");e._zod.parse=(t,i)=>{let a=t.value;if(!Array.isArray(a))return t.issues.push({input:a,inst:e,expected:\\\"tuple\\\",code:\\\"invalid_type\\\"}),t;t.value=[];let u=[];if(!r.rest){let m=a.length>n.length,f=a.length<o-1;if(m||f)return t.issues.push({...m?{code:\\\"too_big\\\",maximum:n.length}:{code:\\\"too_small\\\",minimum:n.length},input:a,inst:e,origin:\\\"array\\\"}),t}let s=-1;for(let m of n){if(s++,s>=a.length&&s>=o)continue;let f=m._zod.run({value:a[s],issues:[]},i);f instanceof Promise?u.push(f.then(g=>Ct(g,t,s))):Ct(f,t,s)}if(r.rest){let m=a.slice(n.length);for(let f of m){s++;let g=r.rest._zod.run({value:f,issues:[]},i);g instanceof Promise?u.push(g.then(y=>Ct(y,t,s))):Ct(g,t,s)}}return u.length?Promise.all(u).then(()=>t):t}});function Ct(e,r,n){e.issues.length&&r.issues.push(...F(n,e.issues)),r.value[n]=e.value}var Ni=c(\\\"$ZodRecord\\\",(e,r)=>{x.init(e,r),e._zod.parse=(n,o)=>{let t=n.value;if(!ce(t))return n.issues.push({expected:\\\"record\\\",code:\\\"invalid_type\\\",input:t,inst:e}),n;let i=[];if(r.keyType._zod.values){let a=r.keyType._zod.values;n.value={};for(let s of a)if(typeof s==\\\"string\\\"||typeof s==\\\"number\\\"||typeof s==\\\"symbol\\\"){let m=r.valueType._zod.run({value:t[s],issues:[]},o);m instanceof Promise?i.push(m.then(f=>{f.issues.length&&n.issues.push(...F(s,f.issues)),n.value[s]=f.value})):(m.issues.length&&n.issues.push(...F(s,m.issues)),n.value[s]=m.value)}let u;for(let s in t)a.has(s)||(u=u??[],u.push(s));u&&u.length>0&&n.issues.push({code:\\\"unrecognized_keys\\\",input:t,inst:e,keys:u})}else{n.value={};for(let a of Reflect.ownKeys(t)){if(a===\\\"__proto__\\\")continue;let u=r.keyType._zod.run({value:a,issues:[]},o);if(u instanceof Promise)throw new Error(\\\"Async schemas not supported in object keys currently\\\");if(u.issues.length){n.issues.push({code:\\\"invalid_key\\\",origin:\\\"record\\\",issues:u.issues.map(m=>J(m,o,D())),input:a,path:[a],inst:e}),n.value[u.value]=u.value;continue}let s=r.valueType._zod.run({value:t[a],issues:[]},o);s instanceof Promise?i.push(s.then(m=>{m.issues.length&&n.issues.push(...F(a,m.issues)),n.value[u.value]=m.value})):(s.issues.length&&n.issues.push(...F(a,s.issues)),n.value[u.value]=s.value)}}return i.length?Promise.all(i).then(()=>n):n}}),Zi=c(\\\"$ZodMap\\\",(e,r)=>{x.init(e,r),e._zod.parse=(n,o)=>{let t=n.value;if(!(t instanceof Map))return n.issues.push({expected:\\\"map\\\",code:\\\"invalid_type\\\",input:t,inst:e}),n;let i=[];n.value=new Map;for(let[a,u]of t){let s=r.keyType._zod.run({value:a,issues:[]},o),m=r.valueType._zod.run({value:u,issues:[]},o);s instanceof Promise||m instanceof Promise?i.push(Promise.all([s,m]).then(([f,g])=>{uu(f,g,n,a,t,e,o)})):uu(s,m,n,a,t,e,o)}return i.length?Promise.all(i).then(()=>n):n}});function uu(e,r,n,o,t,i,a){e.issues.length&&(Fe.has(typeof o)?n.issues.push(...F(o,e.issues)):n.issues.push({code:\\\"invalid_key\\\",origin:\\\"map\\\",input:t,inst:i,issues:e.issues.map(u=>J(u,a,D()))})),r.issues.length&&(Fe.has(typeof o)?n.issues.push(...F(o,r.issues)):n.issues.push({origin:\\\"map\\\",code:\\\"invalid_element\\\",input:t,inst:i,key:o,issues:r.issues.map(u=>J(u,a,D()))})),n.value.set(e.value,r.value)}var Di=c(\\\"$ZodSet\\\",(e,r)=>{x.init(e,r),e._zod.parse=(n,o)=>{let t=n.value;if(!(t instanceof Set))return n.issues.push({input:t,inst:e,expected:\\\"set\\\",code:\\\"invalid_type\\\"}),n;let i=[];n.value=new Set;for(let a of t){let u=r.valueType._zod.run({value:a,issues:[]},o);u instanceof Promise?i.push(u.then(s=>cu(s,n))):cu(u,n)}return i.length?Promise.all(i).then(()=>n):n}});function cu(e,r){e.issues.length&&r.issues.push(...e.issues),r.value.add(e.value)}var Ti=c(\\\"$ZodEnum\\\",(e,r)=>{x.init(e,r);let n=Ce(r.entries),o=new Set(n);e._zod.values=o,e._zod.pattern=new RegExp(`^(${n.filter(t=>Fe.has(typeof t)).map(t=>typeof t==\\\"string\\\"?X(t):t.toString()).join(\\\"|\\\")})$`),e._zod.parse=(t,i)=>{let a=t.value;return o.has(a)||t.issues.push({code:\\\"invalid_value\\\",values:n,input:a,inst:e}),t}}),Ei=c(\\\"$ZodLiteral\\\",(e,r)=>{if(x.init(e,r),r.values.length===0)throw new Error(\\\"Cannot create literal schema with no valid values\\\");e._zod.values=new Set(r.values),e._zod.pattern=new RegExp(`^(${r.values.map(n=>typeof n==\\\"string\\\"?X(n):n?X(n.toString()):String(n)).join(\\\"|\\\")})$`),e._zod.parse=(n,o)=>{let t=n.value;return e._zod.values.has(t)||n.issues.push({code:\\\"invalid_value\\\",values:r.values,input:t,inst:e}),n}}),Ai=c(\\\"$ZodFile\\\",(e,r)=>{x.init(e,r),e._zod.parse=(n,o)=>{let t=n.value;return t instanceof File||n.issues.push({expected:\\\"file\\\",code:\\\"invalid_type\\\",input:t,inst:e}),n}}),Ri=c(\\\"$ZodTransform\\\",(e,r)=>{x.init(e,r),e._zod.parse=(n,o)=>{if(o.direction===\\\"backward\\\")throw new ie(e.constructor.name);let t=r.transform(n.value,n);if(o.async)return(t instanceof Promise?t:Promise.resolve(t)).then(a=>(n.value=a,n));if(t instanceof Promise)throw new W;return n.value=t,n}});function su(e,r){return e.issues.length&&r===void 0?{issues:[],value:void 0}:e}var Li=c(\\\"$ZodOptional\\\",(e,r)=>{x.init(e,r),e._zod.optin=\\\"optional\\\",e._zod.optout=\\\"optional\\\",I(e._zod,\\\"values\\\",()=>r.innerType._zod.values?new Set([...r.innerType._zod.values,void 0]):void 0),I(e._zod,\\\"pattern\\\",()=>{let n=r.innerType._zod.pattern;return n?new RegExp(`^(${Ve(n.source)})?$`):void 0}),e._zod.parse=(n,o)=>{if(r.innerType._zod.optin===\\\"optional\\\"){let t=r.innerType._zod.run(n,o);return t instanceof Promise?t.then(i=>su(i,n.value)):su(t,n.value)}return n.value===void 0?n:r.innerType._zod.run(n,o)}}),Ci=c(\\\"$ZodNullable\\\",(e,r)=>{x.init(e,r),I(e._zod,\\\"optin\\\",()=>r.innerType._zod.optin),I(e._zod,\\\"optout\\\",()=>r.innerType._zod.optout),I(e._zod,\\\"pattern\\\",()=>{let n=r.innerType._zod.pattern;return n?new RegExp(`^(${Ve(n.source)}|null)$`):void 0}),I(e._zod,\\\"values\\\",()=>r.innerType._zod.values?new Set([...r.innerType._zod.values,null]):void 0),e._zod.parse=(n,o)=>n.value===null?n:r.innerType._zod.run(n,o)}),Vi=c(\\\"$ZodDefault\\\",(e,r)=>{x.init(e,r),e._zod.optin=\\\"optional\\\",I(e._zod,\\\"values\\\",()=>r.innerType._zod.values),e._zod.parse=(n,o)=>{if(o.direction===\\\"backward\\\")return r.innerType._zod.run(n,o);if(n.value===void 0)return n.value=r.defaultValue,n;let t=r.innerType._zod.run(n,o);return t instanceof Promise?t.then(i=>lu(i,r)):lu(t,r)}});function lu(e,r){return e.value===void 0&&(e.value=r.defaultValue),e}var Fi=c(\\\"$ZodPrefault\\\",(e,r)=>{x.init(e,r),e._zod.optin=\\\"optional\\\",I(e._zod,\\\"values\\\",()=>r.innerType._zod.values),e._zod.parse=(n,o)=>(o.direction===\\\"backward\\\"||n.value===void 0&&(n.value=r.defaultValue),r.innerType._zod.run(n,o))}),Ji=c(\\\"$ZodNonOptional\\\",(e,r)=>{x.init(e,r),I(e._zod,\\\"values\\\",()=>{let n=r.innerType._zod.values;return n?new Set([...n].filter(o=>o!==void 0)):void 0}),e._zod.parse=(n,o)=>{let t=r.innerType._zod.run(n,o);return t instanceof Promise?t.then(i=>du(i,e)):du(t,e)}});function du(e,r){return!e.issues.length&&e.value===void 0&&e.issues.push({code:\\\"invalid_type\\\",expected:\\\"nonoptional\\\",input:e.value,inst:r}),e}var Mi=c(\\\"$ZodSuccess\\\",(e,r)=>{x.init(e,r),e._zod.parse=(n,o)=>{if(o.direction===\\\"backward\\\")throw new ie(\\\"ZodSuccess\\\");let t=r.innerType._zod.run(n,o);return t instanceof Promise?t.then(i=>(n.value=i.issues.length===0,n)):(n.value=t.issues.length===0,n)}}),Bi=c(\\\"$ZodCatch\\\",(e,r)=>{x.init(e,r),I(e._zod,\\\"optin\\\",()=>r.innerType._zod.optin),I(e._zod,\\\"optout\\\",()=>r.innerType._zod.optout),I(e._zod,\\\"values\\\",()=>r.innerType._zod.values),e._zod.parse=(n,o)=>{if(o.direction===\\\"backward\\\")return r.innerType._zod.run(n,o);let t=r.innerType._zod.run(n,o);return t instanceof Promise?t.then(i=>(n.value=i.value,i.issues.length&&(n.value=r.catchValue({...n,error:{issues:i.issues.map(a=>J(a,o,D()))},input:n.value}),n.issues=[]),n)):(n.value=t.value,t.issues.length&&(n.value=r.catchValue({...n,error:{issues:t.issues.map(i=>J(i,o,D()))},input:n.value}),n.issues=[]),n)}}),Ki=c(\\\"$ZodNaN\\\",(e,r)=>{x.init(e,r),e._zod.parse=(n,o)=>((typeof n.value!=\\\"number\\\"||!Number.isNaN(n.value))&&n.issues.push({input:n.value,inst:e,expected:\\\"nan\\\",code:\\\"invalid_type\\\"}),n)}),Gi=c(\\\"$ZodPipe\\\",(e,r)=>{x.init(e,r),I(e._zod,\\\"values\\\",()=>r.in._zod.values),I(e._zod,\\\"optin\\\",()=>r.in._zod.optin),I(e._zod,\\\"optout\\\",()=>r.out._zod.optout),I(e._zod,\\\"propValues\\\",()=>r.in._zod.propValues),e._zod.parse=(n,o)=>{if(o.direction===\\\"backward\\\"){let i=r.out._zod.run(n,o);return i instanceof Promise?i.then(a=>Vt(a,r.in,o)):Vt(i,r.in,o)}let t=r.in._zod.run(n,o);return t instanceof Promise?t.then(i=>Vt(i,r.out,o)):Vt(t,r.out,o)}});function Vt(e,r,n){return e.issues.length?(e.aborted=!0,e):r._zod.run({value:e.value,issues:e.issues},n)}var Qe=c(\\\"$ZodCodec\\\",(e,r)=>{x.init(e,r),I(e._zod,\\\"values\\\",()=>r.in._zod.values),I(e._zod,\\\"optin\\\",()=>r.in._zod.optin),I(e._zod,\\\"optout\\\",()=>r.out._zod.optout),I(e._zod,\\\"propValues\\\",()=>r.in._zod.propValues),e._zod.parse=(n,o)=>{if((o.direction||\\\"forward\\\")===\\\"forward\\\"){let i=r.in._zod.run(n,o);return i instanceof Promise?i.then(a=>Ft(a,r,o)):Ft(i,r,o)}else{let i=r.out._zod.run(n,o);return i instanceof Promise?i.then(a=>Ft(a,r,o)):Ft(i,r,o)}}});function Ft(e,r,n){if(e.issues.length)return e.aborted=!0,e;if((n.direction||\\\"forward\\\")===\\\"forward\\\"){let t=r.transform(e.value,e);return t instanceof Promise?t.then(i=>Jt(e,i,r.out,n)):Jt(e,t,r.out,n)}else{let t=r.reverseTransform(e.value,e);return t instanceof Promise?t.then(i=>Jt(e,i,r.in,n)):Jt(e,t,r.in,n)}}function Jt(e,r,n,o){return e.issues.length?(e.aborted=!0,e):n._zod.run({value:r,issues:e.issues},o)}var Wi=c(\\\"$ZodReadonly\\\",(e,r)=>{x.init(e,r),I(e._zod,\\\"propValues\\\",()=>r.innerType._zod.propValues),I(e._zod,\\\"values\\\",()=>r.innerType._zod.values),I(e._zod,\\\"optin\\\",()=>r.innerType._zod.optin),I(e._zod,\\\"optout\\\",()=>r.innerType._zod.optout),e._zod.parse=(n,o)=>{if(o.direction===\\\"backward\\\")return r.innerType._zod.run(n,o);let t=r.innerType._zod.run(n,o);return t instanceof Promise?t.then(mu):mu(t)}});function mu(e){return e.value=Object.freeze(e.value),e}var Xi=c(\\\"$ZodTemplateLiteral\\\",(e,r)=>{x.init(e,r);let n=[];for(let o of r.parts)if(typeof o==\\\"object\\\"&&o!==null){if(!o._zod.pattern)throw new Error(`Invalid template literal part, no pattern found: ${[...o._zod.traits].shift()}`);let t=o._zod.pattern instanceof RegExp?o._zod.pattern.source:o._zod.pattern;if(!t)throw new Error(`Invalid template literal part: ${o._zod.traits}`);let i=t.startsWith(\\\"^\\\")?1:0,a=t.endsWith(\\\"$\\\")?t.length-1:t.length;n.push(t.slice(i,a))}else if(o===null||Jr.has(typeof o))n.push(X(`${o}`));else throw new Error(`Invalid template literal part: ${o}`);e._zod.pattern=new RegExp(`^${n.join(\\\"\\\")}$`),e._zod.parse=(o,t)=>typeof o.value!=\\\"string\\\"?(o.issues.push({input:o.value,inst:e,expected:\\\"template_literal\\\",code:\\\"invalid_type\\\"}),o):(e._zod.pattern.lastIndex=0,e._zod.pattern.test(o.value)||o.issues.push({input:o.value,inst:e,code:\\\"invalid_format\\\",format:r.format??\\\"template_literal\\\",pattern:e._zod.pattern.source}),o)}),qi=c(\\\"$ZodFunction\\\",(e,r)=>(x.init(e,r),e._def=r,e._zod.def=r,e.implement=n=>{if(typeof n!=\\\"function\\\")throw new Error(\\\"implement() must be called with a function\\\");return function(...o){let t=e._def.input?St(e._def.input,o):o,i=Reflect.apply(n,this,t);return e._def.output?St(e._def.output,i):i}},e.implementAsync=n=>{if(typeof n!=\\\"function\\\")throw new Error(\\\"implementAsync() must be called with a function\\\");return async function(...o){let t=e._def.input?await jt(e._def.input,o):o,i=await Reflect.apply(n,this,t);return e._def.output?await jt(e._def.output,i):i}},e._zod.parse=(n,o)=>typeof n.value!=\\\"function\\\"?(n.issues.push({code:\\\"invalid_type\\\",expected:\\\"function\\\",input:n.value,inst:e}),n):(e._def.output&&e._def.output._zod.def.type===\\\"promise\\\"?n.value=e.implementAsync(n.value):n.value=e.implement(n.value),n),e.input=(...n)=>{let o=e.constructor;return Array.isArray(n[0])?new o({type:\\\"function\\\",input:new Wt({type:\\\"tuple\\\",items:n[0],rest:n[1]}),output:e._def.output}):new o({type:\\\"function\\\",input:n[0],output:e._def.output})},e.output=n=>{let o=e.constructor;return new o({type:\\\"function\\\",input:e._def.input,output:n})},e)),Yi=c(\\\"$ZodPromise\\\",(e,r)=>{x.init(e,r),e._zod.parse=(n,o)=>Promise.resolve(n.value).then(t=>r.innerType._zod.run({value:t,issues:[]},o))}),Qi=c(\\\"$ZodLazy\\\",(e,r)=>{x.init(e,r),I(e._zod,\\\"innerType\\\",()=>r.getter()),I(e._zod,\\\"pattern\\\",()=>e._zod.innerType._zod.pattern),I(e._zod,\\\"propValues\\\",()=>e._zod.innerType._zod.propValues),I(e._zod,\\\"optin\\\",()=>e._zod.innerType._zod.optin??void 0),I(e._zod,\\\"optout\\\",()=>e._zod.innerType._zod.optout??void 0),e._zod.parse=(n,o)=>e._zod.innerType._zod.run(n,o)}),Hi=c(\\\"$ZodCustom\\\",(e,r)=>{Z.init(e,r),x.init(e,r),e._zod.parse=(n,o)=>n,e._zod.check=n=>{let o=n.value,t=r.fn(o);if(t instanceof Promise)return t.then(i=>fu(i,n,o,e));fu(t,n,o,e)}});function fu(e,r,n,o){if(!e){let t={code:\\\"custom\\\",input:n,inst:o,path:[...o._zod.def.path??[]],continue:!o._zod.def.abort};o._zod.def.params&&(t.params=o._zod.def.params),r.issues.push(xe(t))}}var tt={};pe(tt,{ar:()=>bu,az:()=>_u,be:()=>xu,bg:()=>ku,ca:()=>zu,cs:()=>Iu,da:()=>wu,de:()=>Su,en:()=>Xt,eo:()=>ju,es:()=>Ou,fa:()=>Pu,fi:()=>Uu,fr:()=>Nu,frCA:()=>Zu,he:()=>Du,hu:()=>Tu,id:()=>Eu,is:()=>Au,it:()=>Ru,ja:()=>Lu,ka:()=>Cu,kh:()=>Vu,km:()=>qt,ko:()=>Fu,lt:()=>Mu,mk:()=>Bu,ms:()=>Ku,nl:()=>Gu,no:()=>Wu,ota:()=>Xu,pl:()=>Yu,ps:()=>qu,pt:()=>Qu,ru:()=>ec,sl:()=>tc,sv:()=>rc,ta:()=>nc,th:()=>ic,tr:()=>oc,ua:()=>ac,uk:()=>Yt,ur:()=>uc,vi:()=>cc,yo:()=>dc,zhCN:()=>sc,zhTW:()=>lc});var gl=()=>{let e={string:{unit:\\\"\\\\u062D\\\\u0631\\\\u0641\\\",verb:\\\"\\\\u0623\\\\u0646 \\\\u064A\\\\u062D\\\\u0648\\\\u064A\\\"},file:{unit:\\\"\\\\u0628\\\\u0627\\\\u064A\\\\u062A\\\",verb:\\\"\\\\u0623\\\\u0646 \\\\u064A\\\\u062D\\\\u0648\\\\u064A\\\"},array:{unit:\\\"\\\\u0639\\\\u0646\\\\u0635\\\\u0631\\\",verb:\\\"\\\\u0623\\\\u0646 \\\\u064A\\\\u062D\\\\u0648\\\\u064A\\\"},set:{unit:\\\"\\\\u0639\\\\u0646\\\\u0635\\\\u0631\\\",verb:\\\"\\\\u0623\\\\u0646 \\\\u064A\\\\u062D\\\\u0648\\\\u064A\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"number\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"array\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"\\\\u0645\\\\u062F\\\\u062E\\\\u0644\\\",email:\\\"\\\\u0628\\\\u0631\\\\u064A\\\\u062F \\\\u0625\\\\u0644\\\\u0643\\\\u062A\\\\u0631\\\\u0648\\\\u0646\\\\u064A\\\",url:\\\"\\\\u0631\\\\u0627\\\\u0628\\\\u0637\\\",emoji:\\\"\\\\u0625\\\\u064A\\\\u0645\\\\u0648\\\\u062C\\\\u064A\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"\\\\u062A\\\\u0627\\\\u0631\\\\u064A\\\\u062E \\\\u0648\\\\u0648\\\\u0642\\\\u062A \\\\u0628\\\\u0645\\\\u0639\\\\u064A\\\\u0627\\\\u0631 ISO\\\",date:\\\"\\\\u062A\\\\u0627\\\\u0631\\\\u064A\\\\u062E \\\\u0628\\\\u0645\\\\u0639\\\\u064A\\\\u0627\\\\u0631 ISO\\\",time:\\\"\\\\u0648\\\\u0642\\\\u062A \\\\u0628\\\\u0645\\\\u0639\\\\u064A\\\\u0627\\\\u0631 ISO\\\",duration:\\\"\\\\u0645\\\\u062F\\\\u0629 \\\\u0628\\\\u0645\\\\u0639\\\\u064A\\\\u0627\\\\u0631 ISO\\\",ipv4:\\\"\\\\u0639\\\\u0646\\\\u0648\\\\u0627\\\\u0646 IPv4\\\",ipv6:\\\"\\\\u0639\\\\u0646\\\\u0648\\\\u0627\\\\u0646 IPv6\\\",cidrv4:\\\"\\\\u0645\\\\u062F\\\\u0649 \\\\u0639\\\\u0646\\\\u0627\\\\u0648\\\\u064A\\\\u0646 \\\\u0628\\\\u0635\\\\u064A\\\\u063A\\\\u0629 IPv4\\\",cidrv6:\\\"\\\\u0645\\\\u062F\\\\u0649 \\\\u0639\\\\u0646\\\\u0627\\\\u0648\\\\u064A\\\\u0646 \\\\u0628\\\\u0635\\\\u064A\\\\u063A\\\\u0629 IPv6\\\",base64:\\\"\\\\u0646\\\\u064E\\\\u0635 \\\\u0628\\\\u062A\\\\u0631\\\\u0645\\\\u064A\\\\u0632 base64-encoded\\\",base64url:\\\"\\\\u0646\\\\u064E\\\\u0635 \\\\u0628\\\\u062A\\\\u0631\\\\u0645\\\\u064A\\\\u0632 base64url-encoded\\\",json_string:\\\"\\\\u0646\\\\u064E\\\\u0635 \\\\u0639\\\\u0644\\\\u0649 \\\\u0647\\\\u064A\\\\u0626\\\\u0629 JSON\\\",e164:\\\"\\\\u0631\\\\u0642\\\\u0645 \\\\u0647\\\\u0627\\\\u062A\\\\u0641 \\\\u0628\\\\u0645\\\\u0639\\\\u064A\\\\u0627\\\\u0631 E.164\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\u0645\\\\u062F\\\\u062E\\\\u0644\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\u0645\\\\u062F\\\\u062E\\\\u0644\\\\u0627\\\\u062A \\\\u063A\\\\u064A\\\\u0631 \\\\u0645\\\\u0642\\\\u0628\\\\u0648\\\\u0644\\\\u0629: \\\\u064A\\\\u0641\\\\u062A\\\\u0631\\\\u0636 \\\\u0625\\\\u062F\\\\u062E\\\\u0627\\\\u0644 ${t.expected}\\\\u060C \\\\u0648\\\\u0644\\\\u0643\\\\u0646 \\\\u062A\\\\u0645 \\\\u0625\\\\u062F\\\\u062E\\\\u0627\\\\u0644 ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`\\\\u0645\\\\u062F\\\\u062E\\\\u0644\\\\u0627\\\\u062A \\\\u063A\\\\u064A\\\\u0631 \\\\u0645\\\\u0642\\\\u0628\\\\u0648\\\\u0644\\\\u0629: \\\\u064A\\\\u0641\\\\u062A\\\\u0631\\\\u0636 \\\\u0625\\\\u062F\\\\u062E\\\\u0627\\\\u0644 ${p(t.values[0])}`:`\\\\u0627\\\\u062E\\\\u062A\\\\u064A\\\\u0627\\\\u0631 \\\\u063A\\\\u064A\\\\u0631 \\\\u0645\\\\u0642\\\\u0628\\\\u0648\\\\u0644: \\\\u064A\\\\u062A\\\\u0648\\\\u0642\\\\u0639 \\\\u0627\\\\u0646\\\\u062A\\\\u0642\\\\u0627\\\\u0621 \\\\u0623\\\\u062D\\\\u062F \\\\u0647\\\\u0630\\\\u0647 \\\\u0627\\\\u0644\\\\u062E\\\\u064A\\\\u0627\\\\u0631\\\\u0627\\\\u062A: ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?` \\\\u0623\\\\u0643\\\\u0628\\\\u0631 \\\\u0645\\\\u0646 \\\\u0627\\\\u0644\\\\u0644\\\\u0627\\\\u0632\\\\u0645: \\\\u064A\\\\u0641\\\\u062A\\\\u0631\\\\u0636 \\\\u0623\\\\u0646 \\\\u062A\\\\u0643\\\\u0648\\\\u0646 ${t.origin??\\\"\\\\u0627\\\\u0644\\\\u0642\\\\u064A\\\\u0645\\\\u0629\\\"} ${i} ${t.maximum.toString()} ${a.unit??\\\"\\\\u0639\\\\u0646\\\\u0635\\\\u0631\\\"}`:`\\\\u0623\\\\u0643\\\\u0628\\\\u0631 \\\\u0645\\\\u0646 \\\\u0627\\\\u0644\\\\u0644\\\\u0627\\\\u0632\\\\u0645: \\\\u064A\\\\u0641\\\\u062A\\\\u0631\\\\u0636 \\\\u0623\\\\u0646 \\\\u062A\\\\u0643\\\\u0648\\\\u0646 ${t.origin??\\\"\\\\u0627\\\\u0644\\\\u0642\\\\u064A\\\\u0645\\\\u0629\\\"} ${i} ${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`\\\\u0623\\\\u0635\\\\u063A\\\\u0631 \\\\u0645\\\\u0646 \\\\u0627\\\\u0644\\\\u0644\\\\u0627\\\\u0632\\\\u0645: \\\\u064A\\\\u0641\\\\u062A\\\\u0631\\\\u0636 \\\\u0644\\\\u0640 ${t.origin} \\\\u0623\\\\u0646 \\\\u064A\\\\u0643\\\\u0648\\\\u0646 ${i} ${t.minimum.toString()} ${a.unit}`:`\\\\u0623\\\\u0635\\\\u063A\\\\u0631 \\\\u0645\\\\u0646 \\\\u0627\\\\u0644\\\\u0644\\\\u0627\\\\u0632\\\\u0645: \\\\u064A\\\\u0641\\\\u062A\\\\u0631\\\\u0636 \\\\u0644\\\\u0640 ${t.origin} \\\\u0623\\\\u0646 \\\\u064A\\\\u0643\\\\u0648\\\\u0646 ${i} ${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`\\\\u0646\\\\u064E\\\\u0635 \\\\u063A\\\\u064A\\\\u0631 \\\\u0645\\\\u0642\\\\u0628\\\\u0648\\\\u0644: \\\\u064A\\\\u062C\\\\u0628 \\\\u0623\\\\u0646 \\\\u064A\\\\u0628\\\\u062F\\\\u0623 \\\\u0628\\\\u0640 \\\"${t.prefix}\\\"`:i.format===\\\"ends_with\\\"?`\\\\u0646\\\\u064E\\\\u0635 \\\\u063A\\\\u064A\\\\u0631 \\\\u0645\\\\u0642\\\\u0628\\\\u0648\\\\u0644: \\\\u064A\\\\u062C\\\\u0628 \\\\u0623\\\\u0646 \\\\u064A\\\\u0646\\\\u062A\\\\u0647\\\\u064A \\\\u0628\\\\u0640 \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`\\\\u0646\\\\u064E\\\\u0635 \\\\u063A\\\\u064A\\\\u0631 \\\\u0645\\\\u0642\\\\u0628\\\\u0648\\\\u0644: \\\\u064A\\\\u062C\\\\u0628 \\\\u0623\\\\u0646 \\\\u064A\\\\u062A\\\\u0636\\\\u0645\\\\u0651\\\\u064E\\\\u0646 \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`\\\\u0646\\\\u064E\\\\u0635 \\\\u063A\\\\u064A\\\\u0631 \\\\u0645\\\\u0642\\\\u0628\\\\u0648\\\\u0644: \\\\u064A\\\\u062C\\\\u0628 \\\\u0623\\\\u0646 \\\\u064A\\\\u0637\\\\u0627\\\\u0628\\\\u0642 \\\\u0627\\\\u0644\\\\u0646\\\\u0645\\\\u0637 ${i.pattern}`:`${o[i.format]??t.format} \\\\u063A\\\\u064A\\\\u0631 \\\\u0645\\\\u0642\\\\u0628\\\\u0648\\\\u0644`}case\\\"not_multiple_of\\\":return`\\\\u0631\\\\u0642\\\\u0645 \\\\u063A\\\\u064A\\\\u0631 \\\\u0645\\\\u0642\\\\u0628\\\\u0648\\\\u0644: \\\\u064A\\\\u062C\\\\u0628 \\\\u0623\\\\u0646 \\\\u064A\\\\u0643\\\\u0648\\\\u0646 \\\\u0645\\\\u0646 \\\\u0645\\\\u0636\\\\u0627\\\\u0639\\\\u0641\\\\u0627\\\\u062A ${t.divisor}`;case\\\"unrecognized_keys\\\":return`\\\\u0645\\\\u0639\\\\u0631\\\\u0641${t.keys.length>1?\\\"\\\\u0627\\\\u062A\\\":\\\"\\\"} \\\\u063A\\\\u0631\\\\u064A\\\\u0628${t.keys.length>1?\\\"\\\\u0629\\\":\\\"\\\"}: ${l(t.keys,\\\"\\\\u060C \\\")}`;case\\\"invalid_key\\\":return`\\\\u0645\\\\u0639\\\\u0631\\\\u0641 \\\\u063A\\\\u064A\\\\u0631 \\\\u0645\\\\u0642\\\\u0628\\\\u0648\\\\u0644 \\\\u0641\\\\u064A ${t.origin}`;case\\\"invalid_union\\\":return\\\"\\\\u0645\\\\u062F\\\\u062E\\\\u0644 \\\\u063A\\\\u064A\\\\u0631 \\\\u0645\\\\u0642\\\\u0628\\\\u0648\\\\u0644\\\";case\\\"invalid_element\\\":return`\\\\u0645\\\\u062F\\\\u062E\\\\u0644 \\\\u063A\\\\u064A\\\\u0631 \\\\u0645\\\\u0642\\\\u0628\\\\u0648\\\\u0644 \\\\u0641\\\\u064A ${t.origin}`;default:return\\\"\\\\u0645\\\\u062F\\\\u062E\\\\u0644 \\\\u063A\\\\u064A\\\\u0631 \\\\u0645\\\\u0642\\\\u0628\\\\u0648\\\\u0644\\\"}}};function bu(){return{localeError:gl()}}var vl=()=>{let e={string:{unit:\\\"simvol\\\",verb:\\\"olmal\\\\u0131d\\\\u0131r\\\"},file:{unit:\\\"bayt\\\",verb:\\\"olmal\\\\u0131d\\\\u0131r\\\"},array:{unit:\\\"element\\\",verb:\\\"olmal\\\\u0131d\\\\u0131r\\\"},set:{unit:\\\"element\\\",verb:\\\"olmal\\\\u0131d\\\\u0131r\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"number\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"array\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"input\\\",email:\\\"email address\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO datetime\\\",date:\\\"ISO date\\\",time:\\\"ISO time\\\",duration:\\\"ISO duration\\\",ipv4:\\\"IPv4 address\\\",ipv6:\\\"IPv6 address\\\",cidrv4:\\\"IPv4 range\\\",cidrv6:\\\"IPv6 range\\\",base64:\\\"base64-encoded string\\\",base64url:\\\"base64url-encoded string\\\",json_string:\\\"JSON string\\\",e164:\\\"E.164 number\\\",jwt:\\\"JWT\\\",template_literal:\\\"input\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`Yanl\\\\u0131\\\\u015F d\\\\u0259y\\\\u0259r: g\\\\xF6zl\\\\u0259nil\\\\u0259n ${t.expected}, daxil olan ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`Yanl\\\\u0131\\\\u015F d\\\\u0259y\\\\u0259r: g\\\\xF6zl\\\\u0259nil\\\\u0259n ${p(t.values[0])}`:`Yanl\\\\u0131\\\\u015F se\\\\xE7im: a\\\\u015Fa\\\\u011F\\\\u0131dak\\\\u0131lardan biri olmal\\\\u0131d\\\\u0131r: ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`\\\\xC7ox b\\\\xF6y\\\\xFCk: g\\\\xF6zl\\\\u0259nil\\\\u0259n ${t.origin??\\\"d\\\\u0259y\\\\u0259r\\\"} ${i}${t.maximum.toString()} ${a.unit??\\\"element\\\"}`:`\\\\xC7ox b\\\\xF6y\\\\xFCk: g\\\\xF6zl\\\\u0259nil\\\\u0259n ${t.origin??\\\"d\\\\u0259y\\\\u0259r\\\"} ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`\\\\xC7ox ki\\\\xE7ik: g\\\\xF6zl\\\\u0259nil\\\\u0259n ${t.origin} ${i}${t.minimum.toString()} ${a.unit}`:`\\\\xC7ox ki\\\\xE7ik: g\\\\xF6zl\\\\u0259nil\\\\u0259n ${t.origin} ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`Yanl\\\\u0131\\\\u015F m\\\\u0259tn: \\\"${i.prefix}\\\" il\\\\u0259 ba\\\\u015Flamal\\\\u0131d\\\\u0131r`:i.format===\\\"ends_with\\\"?`Yanl\\\\u0131\\\\u015F m\\\\u0259tn: \\\"${i.suffix}\\\" il\\\\u0259 bitm\\\\u0259lidir`:i.format===\\\"includes\\\"?`Yanl\\\\u0131\\\\u015F m\\\\u0259tn: \\\"${i.includes}\\\" daxil olmal\\\\u0131d\\\\u0131r`:i.format===\\\"regex\\\"?`Yanl\\\\u0131\\\\u015F m\\\\u0259tn: ${i.pattern} \\\\u015Fablonuna uy\\\\u011Fun olmal\\\\u0131d\\\\u0131r`:`Yanl\\\\u0131\\\\u015F ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`Yanl\\\\u0131\\\\u015F \\\\u0259d\\\\u0259d: ${t.divisor} il\\\\u0259 b\\\\xF6l\\\\xFCn\\\\u0259 bil\\\\u0259n olmal\\\\u0131d\\\\u0131r`;case\\\"unrecognized_keys\\\":return`Tan\\\\u0131nmayan a\\\\xE7ar${t.keys.length>1?\\\"lar\\\":\\\"\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`${t.origin} daxilind\\\\u0259 yanl\\\\u0131\\\\u015F a\\\\xE7ar`;case\\\"invalid_union\\\":return\\\"Yanl\\\\u0131\\\\u015F d\\\\u0259y\\\\u0259r\\\";case\\\"invalid_element\\\":return`${t.origin} daxilind\\\\u0259 yanl\\\\u0131\\\\u015F d\\\\u0259y\\\\u0259r`;default:return\\\"Yanl\\\\u0131\\\\u015F d\\\\u0259y\\\\u0259r\\\"}}};function _u(){return{localeError:vl()}}function yu(e,r,n,o){let t=Math.abs(e),i=t%10,a=t%100;return a>=11&&a<=19?o:i===1?r:i>=2&&i<=4?n:o}var hl=()=>{let e={string:{unit:{one:\\\"\\\\u0441\\\\u0456\\\\u043C\\\\u0432\\\\u0430\\\\u043B\\\",few:\\\"\\\\u0441\\\\u0456\\\\u043C\\\\u0432\\\\u0430\\\\u043B\\\\u044B\\\",many:\\\"\\\\u0441\\\\u0456\\\\u043C\\\\u0432\\\\u0430\\\\u043B\\\\u0430\\\\u045E\\\"},verb:\\\"\\\\u043C\\\\u0435\\\\u0446\\\\u044C\\\"},array:{unit:{one:\\\"\\\\u044D\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\",few:\\\"\\\\u044D\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\\u044B\\\",many:\\\"\\\\u044D\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\\u0430\\\\u045E\\\"},verb:\\\"\\\\u043C\\\\u0435\\\\u0446\\\\u044C\\\"},set:{unit:{one:\\\"\\\\u044D\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\",few:\\\"\\\\u044D\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\\u044B\\\",many:\\\"\\\\u044D\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\\u0430\\\\u045E\\\"},verb:\\\"\\\\u043C\\\\u0435\\\\u0446\\\\u044C\\\"},file:{unit:{one:\\\"\\\\u0431\\\\u0430\\\\u0439\\\\u0442\\\",few:\\\"\\\\u0431\\\\u0430\\\\u0439\\\\u0442\\\\u044B\\\",many:\\\"\\\\u0431\\\\u0430\\\\u0439\\\\u0442\\\\u0430\\\\u045E\\\"},verb:\\\"\\\\u043C\\\\u0435\\\\u0446\\\\u044C\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"\\\\u043B\\\\u0456\\\\u043A\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"\\\\u043C\\\\u0430\\\\u0441\\\\u0456\\\\u045E\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"\\\\u0443\\\\u0432\\\\u043E\\\\u0434\\\",email:\\\"email \\\\u0430\\\\u0434\\\\u0440\\\\u0430\\\\u0441\\\",url:\\\"URL\\\",emoji:\\\"\\\\u044D\\\\u043C\\\\u043E\\\\u0434\\\\u0437\\\\u0456\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO \\\\u0434\\\\u0430\\\\u0442\\\\u0430 \\\\u0456 \\\\u0447\\\\u0430\\\\u0441\\\",date:\\\"ISO \\\\u0434\\\\u0430\\\\u0442\\\\u0430\\\",time:\\\"ISO \\\\u0447\\\\u0430\\\\u0441\\\",duration:\\\"ISO \\\\u043F\\\\u0440\\\\u0430\\\\u0446\\\\u044F\\\\u0433\\\\u043B\\\\u0430\\\\u0441\\\\u0446\\\\u044C\\\",ipv4:\\\"IPv4 \\\\u0430\\\\u0434\\\\u0440\\\\u0430\\\\u0441\\\",ipv6:\\\"IPv6 \\\\u0430\\\\u0434\\\\u0440\\\\u0430\\\\u0441\\\",cidrv4:\\\"IPv4 \\\\u0434\\\\u044B\\\\u044F\\\\u043F\\\\u0430\\\\u0437\\\\u043E\\\\u043D\\\",cidrv6:\\\"IPv6 \\\\u0434\\\\u044B\\\\u044F\\\\u043F\\\\u0430\\\\u0437\\\\u043E\\\\u043D\\\",base64:\\\"\\\\u0440\\\\u0430\\\\u0434\\\\u043E\\\\u043A \\\\u0443 \\\\u0444\\\\u0430\\\\u0440\\\\u043C\\\\u0430\\\\u0446\\\\u0435 base64\\\",base64url:\\\"\\\\u0440\\\\u0430\\\\u0434\\\\u043E\\\\u043A \\\\u0443 \\\\u0444\\\\u0430\\\\u0440\\\\u043C\\\\u0430\\\\u0446\\\\u0435 base64url\\\",json_string:\\\"JSON \\\\u0440\\\\u0430\\\\u0434\\\\u043E\\\\u043A\\\",e164:\\\"\\\\u043D\\\\u0443\\\\u043C\\\\u0430\\\\u0440 E.164\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\u0443\\\\u0432\\\\u043E\\\\u0434\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\u041D\\\\u044F\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0456\\\\u043B\\\\u044C\\\\u043D\\\\u044B \\\\u045E\\\\u0432\\\\u043E\\\\u0434: \\\\u0447\\\\u0430\\\\u043A\\\\u0430\\\\u045E\\\\u0441\\\\u044F ${t.expected}, \\\\u0430\\\\u0442\\\\u0440\\\\u044B\\\\u043C\\\\u0430\\\\u043D\\\\u0430 ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`\\\\u041D\\\\u044F\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0456\\\\u043B\\\\u044C\\\\u043D\\\\u044B \\\\u045E\\\\u0432\\\\u043E\\\\u0434: \\\\u0447\\\\u0430\\\\u043A\\\\u0430\\\\u043B\\\\u0430\\\\u0441\\\\u044F ${p(t.values[0])}`:`\\\\u041D\\\\u044F\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0456\\\\u043B\\\\u044C\\\\u043D\\\\u044B \\\\u0432\\\\u0430\\\\u0440\\\\u044B\\\\u044F\\\\u043D\\\\u0442: \\\\u0447\\\\u0430\\\\u043A\\\\u0430\\\\u045E\\\\u0441\\\\u044F \\\\u0430\\\\u0434\\\\u0437\\\\u0456\\\\u043D \\\\u0437 ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);if(a){let u=Number(t.maximum),s=yu(u,a.unit.one,a.unit.few,a.unit.many);return`\\\\u0417\\\\u0430\\\\u043D\\\\u0430\\\\u0434\\\\u0442\\\\u0430 \\\\u0432\\\\u044F\\\\u043B\\\\u0456\\\\u043A\\\\u0456: \\\\u0447\\\\u0430\\\\u043A\\\\u0430\\\\u043B\\\\u0430\\\\u0441\\\\u044F, \\\\u0448\\\\u0442\\\\u043E ${t.origin??\\\"\\\\u0437\\\\u043D\\\\u0430\\\\u0447\\\\u044D\\\\u043D\\\\u043D\\\\u0435\\\"} \\\\u043F\\\\u0430\\\\u0432\\\\u0456\\\\u043D\\\\u043D\\\\u0430 ${a.verb} ${i}${t.maximum.toString()} ${s}`}return`\\\\u0417\\\\u0430\\\\u043D\\\\u0430\\\\u0434\\\\u0442\\\\u0430 \\\\u0432\\\\u044F\\\\u043B\\\\u0456\\\\u043A\\\\u0456: \\\\u0447\\\\u0430\\\\u043A\\\\u0430\\\\u043B\\\\u0430\\\\u0441\\\\u044F, \\\\u0448\\\\u0442\\\\u043E ${t.origin??\\\"\\\\u0437\\\\u043D\\\\u0430\\\\u0447\\\\u044D\\\\u043D\\\\u043D\\\\u0435\\\"} \\\\u043F\\\\u0430\\\\u0432\\\\u0456\\\\u043D\\\\u043D\\\\u0430 \\\\u0431\\\\u044B\\\\u0446\\\\u044C ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);if(a){let u=Number(t.minimum),s=yu(u,a.unit.one,a.unit.few,a.unit.many);return`\\\\u0417\\\\u0430\\\\u043D\\\\u0430\\\\u0434\\\\u0442\\\\u0430 \\\\u043C\\\\u0430\\\\u043B\\\\u044B: \\\\u0447\\\\u0430\\\\u043A\\\\u0430\\\\u043B\\\\u0430\\\\u0441\\\\u044F, \\\\u0448\\\\u0442\\\\u043E ${t.origin} \\\\u043F\\\\u0430\\\\u0432\\\\u0456\\\\u043D\\\\u043D\\\\u0430 ${a.verb} ${i}${t.minimum.toString()} ${s}`}return`\\\\u0417\\\\u0430\\\\u043D\\\\u0430\\\\u0434\\\\u0442\\\\u0430 \\\\u043C\\\\u0430\\\\u043B\\\\u044B: \\\\u0447\\\\u0430\\\\u043A\\\\u0430\\\\u043B\\\\u0430\\\\u0441\\\\u044F, \\\\u0448\\\\u0442\\\\u043E ${t.origin} \\\\u043F\\\\u0430\\\\u0432\\\\u0456\\\\u043D\\\\u043D\\\\u0430 \\\\u0431\\\\u044B\\\\u0446\\\\u044C ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`\\\\u041D\\\\u044F\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0456\\\\u043B\\\\u044C\\\\u043D\\\\u044B \\\\u0440\\\\u0430\\\\u0434\\\\u043E\\\\u043A: \\\\u043F\\\\u0430\\\\u0432\\\\u0456\\\\u043D\\\\u0435\\\\u043D \\\\u043F\\\\u0430\\\\u0447\\\\u044B\\\\u043D\\\\u0430\\\\u0446\\\\u0446\\\\u0430 \\\\u0437 \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`\\\\u041D\\\\u044F\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0456\\\\u043B\\\\u044C\\\\u043D\\\\u044B \\\\u0440\\\\u0430\\\\u0434\\\\u043E\\\\u043A: \\\\u043F\\\\u0430\\\\u0432\\\\u0456\\\\u043D\\\\u0435\\\\u043D \\\\u0437\\\\u0430\\\\u043A\\\\u0430\\\\u043D\\\\u0447\\\\u0432\\\\u0430\\\\u0446\\\\u0446\\\\u0430 \\\\u043D\\\\u0430 \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`\\\\u041D\\\\u044F\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0456\\\\u043B\\\\u044C\\\\u043D\\\\u044B \\\\u0440\\\\u0430\\\\u0434\\\\u043E\\\\u043A: \\\\u043F\\\\u0430\\\\u0432\\\\u0456\\\\u043D\\\\u0435\\\\u043D \\\\u0437\\\\u043C\\\\u044F\\\\u0448\\\\u0447\\\\u0430\\\\u0446\\\\u044C \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`\\\\u041D\\\\u044F\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0456\\\\u043B\\\\u044C\\\\u043D\\\\u044B \\\\u0440\\\\u0430\\\\u0434\\\\u043E\\\\u043A: \\\\u043F\\\\u0430\\\\u0432\\\\u0456\\\\u043D\\\\u0435\\\\u043D \\\\u0430\\\\u0434\\\\u043F\\\\u0430\\\\u0432\\\\u044F\\\\u0434\\\\u0430\\\\u0446\\\\u044C \\\\u0448\\\\u0430\\\\u0431\\\\u043B\\\\u043E\\\\u043D\\\\u0443 ${i.pattern}`:`\\\\u041D\\\\u044F\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0456\\\\u043B\\\\u044C\\\\u043D\\\\u044B ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`\\\\u041D\\\\u044F\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0456\\\\u043B\\\\u044C\\\\u043D\\\\u044B \\\\u043B\\\\u0456\\\\u043A: \\\\u043F\\\\u0430\\\\u0432\\\\u0456\\\\u043D\\\\u0435\\\\u043D \\\\u0431\\\\u044B\\\\u0446\\\\u044C \\\\u043A\\\\u0440\\\\u0430\\\\u0442\\\\u043D\\\\u044B\\\\u043C ${t.divisor}`;case\\\"unrecognized_keys\\\":return`\\\\u041D\\\\u0435\\\\u0440\\\\u0430\\\\u0441\\\\u043F\\\\u0430\\\\u0437\\\\u043D\\\\u0430\\\\u043D\\\\u044B ${t.keys.length>1?\\\"\\\\u043A\\\\u043B\\\\u044E\\\\u0447\\\\u044B\\\":\\\"\\\\u043A\\\\u043B\\\\u044E\\\\u0447\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`\\\\u041D\\\\u044F\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0456\\\\u043B\\\\u044C\\\\u043D\\\\u044B \\\\u043A\\\\u043B\\\\u044E\\\\u0447 \\\\u0443 ${t.origin}`;case\\\"invalid_union\\\":return\\\"\\\\u041D\\\\u044F\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0456\\\\u043B\\\\u044C\\\\u043D\\\\u044B \\\\u045E\\\\u0432\\\\u043E\\\\u0434\\\";case\\\"invalid_element\\\":return`\\\\u041D\\\\u044F\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0456\\\\u043B\\\\u044C\\\\u043D\\\\u0430\\\\u0435 \\\\u0437\\\\u043D\\\\u0430\\\\u0447\\\\u044D\\\\u043D\\\\u043D\\\\u0435 \\\\u045E ${t.origin}`;default:return\\\"\\\\u041D\\\\u044F\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0456\\\\u043B\\\\u044C\\\\u043D\\\\u044B \\\\u045E\\\\u0432\\\\u043E\\\\u0434\\\"}}};function xu(){return{localeError:hl()}}var $l=e=>{let r=typeof e;switch(r){case\\\"number\\\":return Number.isNaN(e)?\\\"NaN\\\":\\\"\\\\u0447\\\\u0438\\\\u0441\\\\u043B\\\\u043E\\\";case\\\"object\\\":{if(Array.isArray(e))return\\\"\\\\u043C\\\\u0430\\\\u0441\\\\u0438\\\\u0432\\\";if(e===null)return\\\"null\\\";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return r},bl=()=>{let e={string:{unit:\\\"\\\\u0441\\\\u0438\\\\u043C\\\\u0432\\\\u043E\\\\u043B\\\\u0430\\\",verb:\\\"\\\\u0434\\\\u0430 \\\\u0441\\\\u044A\\\\u0434\\\\u044A\\\\u0440\\\\u0436\\\\u0430\\\"},file:{unit:\\\"\\\\u0431\\\\u0430\\\\u0439\\\\u0442\\\\u0430\\\",verb:\\\"\\\\u0434\\\\u0430 \\\\u0441\\\\u044A\\\\u0434\\\\u044A\\\\u0440\\\\u0436\\\\u0430\\\"},array:{unit:\\\"\\\\u0435\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\\u0430\\\",verb:\\\"\\\\u0434\\\\u0430 \\\\u0441\\\\u044A\\\\u0434\\\\u044A\\\\u0440\\\\u0436\\\\u0430\\\"},set:{unit:\\\"\\\\u0435\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\\u0430\\\",verb:\\\"\\\\u0434\\\\u0430 \\\\u0441\\\\u044A\\\\u0434\\\\u044A\\\\u0440\\\\u0436\\\\u0430\\\"}};function r(o){return e[o]??null}let n={regex:\\\"\\\\u0432\\\\u0445\\\\u043E\\\\u0434\\\",email:\\\"\\\\u0438\\\\u043C\\\\u0435\\\\u0439\\\\u043B \\\\u0430\\\\u0434\\\\u0440\\\\u0435\\\\u0441\\\",url:\\\"URL\\\",emoji:\\\"\\\\u0435\\\\u043C\\\\u043E\\\\u0434\\\\u0436\\\\u0438\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO \\\\u0432\\\\u0440\\\\u0435\\\\u043C\\\\u0435\\\",date:\\\"ISO \\\\u0434\\\\u0430\\\\u0442\\\\u0430\\\",time:\\\"ISO \\\\u0432\\\\u0440\\\\u0435\\\\u043C\\\\u0435\\\",duration:\\\"ISO \\\\u043F\\\\u0440\\\\u043E\\\\u0434\\\\u044A\\\\u043B\\\\u0436\\\\u0438\\\\u0442\\\\u0435\\\\u043B\\\\u043D\\\\u043E\\\\u0441\\\\u0442\\\",ipv4:\\\"IPv4 \\\\u0430\\\\u0434\\\\u0440\\\\u0435\\\\u0441\\\",ipv6:\\\"IPv6 \\\\u0430\\\\u0434\\\\u0440\\\\u0435\\\\u0441\\\",cidrv4:\\\"IPv4 \\\\u0434\\\\u0438\\\\u0430\\\\u043F\\\\u0430\\\\u0437\\\\u043E\\\\u043D\\\",cidrv6:\\\"IPv6 \\\\u0434\\\\u0438\\\\u0430\\\\u043F\\\\u0430\\\\u0437\\\\u043E\\\\u043D\\\",base64:\\\"base64-\\\\u043A\\\\u043E\\\\u0434\\\\u0438\\\\u0440\\\\u0430\\\\u043D \\\\u043D\\\\u0438\\\\u0437\\\",base64url:\\\"base64url-\\\\u043A\\\\u043E\\\\u0434\\\\u0438\\\\u0440\\\\u0430\\\\u043D \\\\u043D\\\\u0438\\\\u0437\\\",json_string:\\\"JSON \\\\u043D\\\\u0438\\\\u0437\\\",e164:\\\"E.164 \\\\u043D\\\\u043E\\\\u043C\\\\u0435\\\\u0440\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\u0432\\\\u0445\\\\u043E\\\\u0434\\\"};return o=>{switch(o.code){case\\\"invalid_type\\\":return`\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u043B\\\\u0438\\\\u0434\\\\u0435\\\\u043D \\\\u0432\\\\u0445\\\\u043E\\\\u0434: \\\\u043E\\\\u0447\\\\u0430\\\\u043A\\\\u0432\\\\u0430\\\\u043D ${o.expected}, \\\\u043F\\\\u043E\\\\u043B\\\\u0443\\\\u0447\\\\u0435\\\\u043D ${$l(o.input)}`;case\\\"invalid_value\\\":return o.values.length===1?`\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u043B\\\\u0438\\\\u0434\\\\u0435\\\\u043D \\\\u0432\\\\u0445\\\\u043E\\\\u0434: \\\\u043E\\\\u0447\\\\u0430\\\\u043A\\\\u0432\\\\u0430\\\\u043D ${p(o.values[0])}`:`\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u043B\\\\u0438\\\\u0434\\\\u043D\\\\u0430 \\\\u043E\\\\u043F\\\\u0446\\\\u0438\\\\u044F: \\\\u043E\\\\u0447\\\\u0430\\\\u043A\\\\u0432\\\\u0430\\\\u043D\\\\u043E \\\\u0435\\\\u0434\\\\u043D\\\\u043E \\\\u043E\\\\u0442 ${l(o.values,\\\"|\\\")}`;case\\\"too_big\\\":{let t=o.inclusive?\\\"<=\\\":\\\"<\\\",i=r(o.origin);return i?`\\\\u0422\\\\u0432\\\\u044A\\\\u0440\\\\u0434\\\\u0435 \\\\u0433\\\\u043E\\\\u043B\\\\u044F\\\\u043C\\\\u043E: \\\\u043E\\\\u0447\\\\u0430\\\\u043A\\\\u0432\\\\u0430 \\\\u0441\\\\u0435 ${o.origin??\\\"\\\\u0441\\\\u0442\\\\u043E\\\\u0439\\\\u043D\\\\u043E\\\\u0441\\\\u0442\\\"} \\\\u0434\\\\u0430 \\\\u0441\\\\u044A\\\\u0434\\\\u044A\\\\u0440\\\\u0436\\\\u0430 ${t}${o.maximum.toString()} ${i.unit??\\\"\\\\u0435\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\\u0430\\\"}`:`\\\\u0422\\\\u0432\\\\u044A\\\\u0440\\\\u0434\\\\u0435 \\\\u0433\\\\u043E\\\\u043B\\\\u044F\\\\u043C\\\\u043E: \\\\u043E\\\\u0447\\\\u0430\\\\u043A\\\\u0432\\\\u0430 \\\\u0441\\\\u0435 ${o.origin??\\\"\\\\u0441\\\\u0442\\\\u043E\\\\u0439\\\\u043D\\\\u043E\\\\u0441\\\\u0442\\\"} \\\\u0434\\\\u0430 \\\\u0431\\\\u044A\\\\u0434\\\\u0435 ${t}${o.maximum.toString()}`}case\\\"too_small\\\":{let t=o.inclusive?\\\">=\\\":\\\">\\\",i=r(o.origin);return i?`\\\\u0422\\\\u0432\\\\u044A\\\\u0440\\\\u0434\\\\u0435 \\\\u043C\\\\u0430\\\\u043B\\\\u043A\\\\u043E: \\\\u043E\\\\u0447\\\\u0430\\\\u043A\\\\u0432\\\\u0430 \\\\u0441\\\\u0435 ${o.origin} \\\\u0434\\\\u0430 \\\\u0441\\\\u044A\\\\u0434\\\\u044A\\\\u0440\\\\u0436\\\\u0430 ${t}${o.minimum.toString()} ${i.unit}`:`\\\\u0422\\\\u0432\\\\u044A\\\\u0440\\\\u0434\\\\u0435 \\\\u043C\\\\u0430\\\\u043B\\\\u043A\\\\u043E: \\\\u043E\\\\u0447\\\\u0430\\\\u043A\\\\u0432\\\\u0430 \\\\u0441\\\\u0435 ${o.origin} \\\\u0434\\\\u0430 \\\\u0431\\\\u044A\\\\u0434\\\\u0435 ${t}${o.minimum.toString()}`}case\\\"invalid_format\\\":{let t=o;if(t.format===\\\"starts_with\\\")return`\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u043B\\\\u0438\\\\u0434\\\\u0435\\\\u043D \\\\u043D\\\\u0438\\\\u0437: \\\\u0442\\\\u0440\\\\u044F\\\\u0431\\\\u0432\\\\u0430 \\\\u0434\\\\u0430 \\\\u0437\\\\u0430\\\\u043F\\\\u043E\\\\u0447\\\\u0432\\\\u0430 \\\\u0441 \\\"${t.prefix}\\\"`;if(t.format===\\\"ends_with\\\")return`\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u043B\\\\u0438\\\\u0434\\\\u0435\\\\u043D \\\\u043D\\\\u0438\\\\u0437: \\\\u0442\\\\u0440\\\\u044F\\\\u0431\\\\u0432\\\\u0430 \\\\u0434\\\\u0430 \\\\u0437\\\\u0430\\\\u0432\\\\u044A\\\\u0440\\\\u0448\\\\u0432\\\\u0430 \\\\u0441 \\\"${t.suffix}\\\"`;if(t.format===\\\"includes\\\")return`\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u043B\\\\u0438\\\\u0434\\\\u0435\\\\u043D \\\\u043D\\\\u0438\\\\u0437: \\\\u0442\\\\u0440\\\\u044F\\\\u0431\\\\u0432\\\\u0430 \\\\u0434\\\\u0430 \\\\u0432\\\\u043A\\\\u043B\\\\u044E\\\\u0447\\\\u0432\\\\u0430 \\\"${t.includes}\\\"`;if(t.format===\\\"regex\\\")return`\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u043B\\\\u0438\\\\u0434\\\\u0435\\\\u043D \\\\u043D\\\\u0438\\\\u0437: \\\\u0442\\\\u0440\\\\u044F\\\\u0431\\\\u0432\\\\u0430 \\\\u0434\\\\u0430 \\\\u0441\\\\u044A\\\\u0432\\\\u043F\\\\u0430\\\\u0434\\\\u0430 \\\\u0441 ${t.pattern}`;let i=\\\"\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u043B\\\\u0438\\\\u0434\\\\u0435\\\\u043D\\\";return t.format===\\\"emoji\\\"&&(i=\\\"\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u043B\\\\u0438\\\\u0434\\\\u043D\\\\u043E\\\"),t.format===\\\"datetime\\\"&&(i=\\\"\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u043B\\\\u0438\\\\u0434\\\\u043D\\\\u043E\\\"),t.format===\\\"date\\\"&&(i=\\\"\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u043B\\\\u0438\\\\u0434\\\\u043D\\\\u0430\\\"),t.format===\\\"time\\\"&&(i=\\\"\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u043B\\\\u0438\\\\u0434\\\\u043D\\\\u043E\\\"),t.format===\\\"duration\\\"&&(i=\\\"\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u043B\\\\u0438\\\\u0434\\\\u043D\\\\u0430\\\"),`${i} ${n[t.format]??o.format}`}case\\\"not_multiple_of\\\":return`\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u043B\\\\u0438\\\\u0434\\\\u043D\\\\u043E \\\\u0447\\\\u0438\\\\u0441\\\\u043B\\\\u043E: \\\\u0442\\\\u0440\\\\u044F\\\\u0431\\\\u0432\\\\u0430 \\\\u0434\\\\u0430 \\\\u0431\\\\u044A\\\\u0434\\\\u0435 \\\\u043A\\\\u0440\\\\u0430\\\\u0442\\\\u043D\\\\u043E \\\\u043D\\\\u0430 ${o.divisor}`;case\\\"unrecognized_keys\\\":return`\\\\u041D\\\\u0435\\\\u0440\\\\u0430\\\\u0437\\\\u043F\\\\u043E\\\\u0437\\\\u043D\\\\u0430\\\\u0442${o.keys.length>1?\\\"\\\\u0438\\\":\\\"\\\"} \\\\u043A\\\\u043B\\\\u044E\\\\u0447${o.keys.length>1?\\\"\\\\u043E\\\\u0432\\\\u0435\\\":\\\"\\\"}: ${l(o.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u043B\\\\u0438\\\\u0434\\\\u0435\\\\u043D \\\\u043A\\\\u043B\\\\u044E\\\\u0447 \\\\u0432 ${o.origin}`;case\\\"invalid_union\\\":return\\\"\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u043B\\\\u0438\\\\u0434\\\\u0435\\\\u043D \\\\u0432\\\\u0445\\\\u043E\\\\u0434\\\";case\\\"invalid_element\\\":return`\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u043B\\\\u0438\\\\u0434\\\\u043D\\\\u0430 \\\\u0441\\\\u0442\\\\u043E\\\\u0439\\\\u043D\\\\u043E\\\\u0441\\\\u0442 \\\\u0432 ${o.origin}`;default:return\\\"\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u043B\\\\u0438\\\\u0434\\\\u0435\\\\u043D \\\\u0432\\\\u0445\\\\u043E\\\\u0434\\\"}}};function ku(){return{localeError:bl()}}var _l=()=>{let e={string:{unit:\\\"car\\\\xE0cters\\\",verb:\\\"contenir\\\"},file:{unit:\\\"bytes\\\",verb:\\\"contenir\\\"},array:{unit:\\\"elements\\\",verb:\\\"contenir\\\"},set:{unit:\\\"elements\\\",verb:\\\"contenir\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"number\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"array\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"entrada\\\",email:\\\"adre\\\\xE7a electr\\\\xF2nica\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"data i hora ISO\\\",date:\\\"data ISO\\\",time:\\\"hora ISO\\\",duration:\\\"durada ISO\\\",ipv4:\\\"adre\\\\xE7a IPv4\\\",ipv6:\\\"adre\\\\xE7a IPv6\\\",cidrv4:\\\"rang IPv4\\\",cidrv6:\\\"rang IPv6\\\",base64:\\\"cadena codificada en base64\\\",base64url:\\\"cadena codificada en base64url\\\",json_string:\\\"cadena JSON\\\",e164:\\\"n\\\\xFAmero E.164\\\",jwt:\\\"JWT\\\",template_literal:\\\"entrada\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`Tipus inv\\\\xE0lid: s'esperava ${t.expected}, s'ha rebut ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`Valor inv\\\\xE0lid: s'esperava ${p(t.values[0])}`:`Opci\\\\xF3 inv\\\\xE0lida: s'esperava una de ${l(t.values,\\\" o \\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"com a m\\\\xE0xim\\\":\\\"menys de\\\",a=r(t.origin);return a?`Massa gran: s'esperava que ${t.origin??\\\"el valor\\\"} contingu\\\\xE9s ${i} ${t.maximum.toString()} ${a.unit??\\\"elements\\\"}`:`Massa gran: s'esperava que ${t.origin??\\\"el valor\\\"} fos ${i} ${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\"com a m\\\\xEDnim\\\":\\\"m\\\\xE9s de\\\",a=r(t.origin);return a?`Massa petit: s'esperava que ${t.origin} contingu\\\\xE9s ${i} ${t.minimum.toString()} ${a.unit}`:`Massa petit: s'esperava que ${t.origin} fos ${i} ${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`Format inv\\\\xE0lid: ha de comen\\\\xE7ar amb \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`Format inv\\\\xE0lid: ha d'acabar amb \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`Format inv\\\\xE0lid: ha d'incloure \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`Format inv\\\\xE0lid: ha de coincidir amb el patr\\\\xF3 ${i.pattern}`:`Format inv\\\\xE0lid per a ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`N\\\\xFAmero inv\\\\xE0lid: ha de ser m\\\\xFAltiple de ${t.divisor}`;case\\\"unrecognized_keys\\\":return`Clau${t.keys.length>1?\\\"s\\\":\\\"\\\"} no reconeguda${t.keys.length>1?\\\"s\\\":\\\"\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Clau inv\\\\xE0lida a ${t.origin}`;case\\\"invalid_union\\\":return\\\"Entrada inv\\\\xE0lida\\\";case\\\"invalid_element\\\":return`Element inv\\\\xE0lid a ${t.origin}`;default:return\\\"Entrada inv\\\\xE0lida\\\"}}};function zu(){return{localeError:_l()}}var yl=()=>{let e={string:{unit:\\\"znak\\\\u016F\\\",verb:\\\"m\\\\xEDt\\\"},file:{unit:\\\"bajt\\\\u016F\\\",verb:\\\"m\\\\xEDt\\\"},array:{unit:\\\"prvk\\\\u016F\\\",verb:\\\"m\\\\xEDt\\\"},set:{unit:\\\"prvk\\\\u016F\\\",verb:\\\"m\\\\xEDt\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"\\\\u010D\\\\xEDslo\\\";case\\\"string\\\":return\\\"\\\\u0159et\\\\u011Bzec\\\";case\\\"boolean\\\":return\\\"boolean\\\";case\\\"bigint\\\":return\\\"bigint\\\";case\\\"function\\\":return\\\"funkce\\\";case\\\"symbol\\\":return\\\"symbol\\\";case\\\"undefined\\\":return\\\"undefined\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"pole\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"regul\\\\xE1rn\\\\xED v\\\\xFDraz\\\",email:\\\"e-mailov\\\\xE1 adresa\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"datum a \\\\u010Das ve form\\\\xE1tu ISO\\\",date:\\\"datum ve form\\\\xE1tu ISO\\\",time:\\\"\\\\u010Das ve form\\\\xE1tu ISO\\\",duration:\\\"doba trv\\\\xE1n\\\\xED ISO\\\",ipv4:\\\"IPv4 adresa\\\",ipv6:\\\"IPv6 adresa\\\",cidrv4:\\\"rozsah IPv4\\\",cidrv6:\\\"rozsah IPv6\\\",base64:\\\"\\\\u0159et\\\\u011Bzec zak\\\\xF3dovan\\\\xFD ve form\\\\xE1tu base64\\\",base64url:\\\"\\\\u0159et\\\\u011Bzec zak\\\\xF3dovan\\\\xFD ve form\\\\xE1tu base64url\\\",json_string:\\\"\\\\u0159et\\\\u011Bzec ve form\\\\xE1tu JSON\\\",e164:\\\"\\\\u010D\\\\xEDslo E.164\\\",jwt:\\\"JWT\\\",template_literal:\\\"vstup\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`Neplatn\\\\xFD vstup: o\\\\u010Dek\\\\xE1v\\\\xE1no ${t.expected}, obdr\\\\u017Eeno ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`Neplatn\\\\xFD vstup: o\\\\u010Dek\\\\xE1v\\\\xE1no ${p(t.values[0])}`:`Neplatn\\\\xE1 mo\\\\u017Enost: o\\\\u010Dek\\\\xE1v\\\\xE1na jedna z hodnot ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`Hodnota je p\\\\u0159\\\\xEDli\\\\u0161 velk\\\\xE1: ${t.origin??\\\"hodnota\\\"} mus\\\\xED m\\\\xEDt ${i}${t.maximum.toString()} ${a.unit??\\\"prvk\\\\u016F\\\"}`:`Hodnota je p\\\\u0159\\\\xEDli\\\\u0161 velk\\\\xE1: ${t.origin??\\\"hodnota\\\"} mus\\\\xED b\\\\xFDt ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`Hodnota je p\\\\u0159\\\\xEDli\\\\u0161 mal\\\\xE1: ${t.origin??\\\"hodnota\\\"} mus\\\\xED m\\\\xEDt ${i}${t.minimum.toString()} ${a.unit??\\\"prvk\\\\u016F\\\"}`:`Hodnota je p\\\\u0159\\\\xEDli\\\\u0161 mal\\\\xE1: ${t.origin??\\\"hodnota\\\"} mus\\\\xED b\\\\xFDt ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`Neplatn\\\\xFD \\\\u0159et\\\\u011Bzec: mus\\\\xED za\\\\u010D\\\\xEDnat na \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`Neplatn\\\\xFD \\\\u0159et\\\\u011Bzec: mus\\\\xED kon\\\\u010Dit na \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`Neplatn\\\\xFD \\\\u0159et\\\\u011Bzec: mus\\\\xED obsahovat \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`Neplatn\\\\xFD \\\\u0159et\\\\u011Bzec: mus\\\\xED odpov\\\\xEDdat vzoru ${i.pattern}`:`Neplatn\\\\xFD form\\\\xE1t ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`Neplatn\\\\xE9 \\\\u010D\\\\xEDslo: mus\\\\xED b\\\\xFDt n\\\\xE1sobkem ${t.divisor}`;case\\\"unrecognized_keys\\\":return`Nezn\\\\xE1m\\\\xE9 kl\\\\xED\\\\u010De: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Neplatn\\\\xFD kl\\\\xED\\\\u010D v ${t.origin}`;case\\\"invalid_union\\\":return\\\"Neplatn\\\\xFD vstup\\\";case\\\"invalid_element\\\":return`Neplatn\\\\xE1 hodnota v ${t.origin}`;default:return\\\"Neplatn\\\\xFD vstup\\\"}}};function Iu(){return{localeError:yl()}}var xl=()=>{let e={string:{unit:\\\"tegn\\\",verb:\\\"havde\\\"},file:{unit:\\\"bytes\\\",verb:\\\"havde\\\"},array:{unit:\\\"elementer\\\",verb:\\\"indeholdt\\\"},set:{unit:\\\"elementer\\\",verb:\\\"indeholdt\\\"}},r={string:\\\"streng\\\",number:\\\"tal\\\",boolean:\\\"boolean\\\",array:\\\"liste\\\",object:\\\"objekt\\\",set:\\\"s\\\\xE6t\\\",file:\\\"fil\\\"};function n(a){return e[a]??null}function o(a){return r[a]??a}let t=a=>{let u=typeof a;switch(u){case\\\"number\\\":return Number.isNaN(a)?\\\"NaN\\\":\\\"tal\\\";case\\\"object\\\":return Array.isArray(a)?\\\"liste\\\":a===null?\\\"null\\\":Object.getPrototypeOf(a)!==Object.prototype&&a.constructor?a.constructor.name:\\\"objekt\\\"}return u},i={regex:\\\"input\\\",email:\\\"e-mailadresse\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO dato- og klokkesl\\\\xE6t\\\",date:\\\"ISO-dato\\\",time:\\\"ISO-klokkesl\\\\xE6t\\\",duration:\\\"ISO-varighed\\\",ipv4:\\\"IPv4-omr\\\\xE5de\\\",ipv6:\\\"IPv6-omr\\\\xE5de\\\",cidrv4:\\\"IPv4-spektrum\\\",cidrv6:\\\"IPv6-spektrum\\\",base64:\\\"base64-kodet streng\\\",base64url:\\\"base64url-kodet streng\\\",json_string:\\\"JSON-streng\\\",e164:\\\"E.164-nummer\\\",jwt:\\\"JWT\\\",template_literal:\\\"input\\\"};return a=>{switch(a.code){case\\\"invalid_type\\\":return`Ugyldigt input: forventede ${o(a.expected)}, fik ${o(t(a.input))}`;case\\\"invalid_value\\\":return a.values.length===1?`Ugyldig v\\\\xE6rdi: forventede ${p(a.values[0])}`:`Ugyldigt valg: forventede en af f\\\\xF8lgende ${l(a.values,\\\"|\\\")}`;case\\\"too_big\\\":{let u=a.inclusive?\\\"<=\\\":\\\"<\\\",s=n(a.origin),m=o(a.origin);return s?`For stor: forventede ${m??\\\"value\\\"} ${s.verb} ${u} ${a.maximum.toString()} ${s.unit??\\\"elementer\\\"}`:`For stor: forventede ${m??\\\"value\\\"} havde ${u} ${a.maximum.toString()}`}case\\\"too_small\\\":{let u=a.inclusive?\\\">=\\\":\\\">\\\",s=n(a.origin),m=o(a.origin);return s?`For lille: forventede ${m} ${s.verb} ${u} ${a.minimum.toString()} ${s.unit}`:`For lille: forventede ${m} havde ${u} ${a.minimum.toString()}`}case\\\"invalid_format\\\":{let u=a;return u.format===\\\"starts_with\\\"?`Ugyldig streng: skal starte med \\\"${u.prefix}\\\"`:u.format===\\\"ends_with\\\"?`Ugyldig streng: skal ende med \\\"${u.suffix}\\\"`:u.format===\\\"includes\\\"?`Ugyldig streng: skal indeholde \\\"${u.includes}\\\"`:u.format===\\\"regex\\\"?`Ugyldig streng: skal matche m\\\\xF8nsteret ${u.pattern}`:`Ugyldig ${i[u.format]??a.format}`}case\\\"not_multiple_of\\\":return`Ugyldigt tal: skal v\\\\xE6re deleligt med ${a.divisor}`;case\\\"unrecognized_keys\\\":return`${a.keys.length>1?\\\"Ukendte n\\\\xF8gler\\\":\\\"Ukendt n\\\\xF8gle\\\"}: ${l(a.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Ugyldig n\\\\xF8gle i ${a.origin}`;case\\\"invalid_union\\\":return\\\"Ugyldigt input: matcher ingen af de tilladte typer\\\";case\\\"invalid_element\\\":return`Ugyldig v\\\\xE6rdi i ${a.origin}`;default:return\\\"Ugyldigt input\\\"}}};function wu(){return{localeError:xl()}}var kl=()=>{let e={string:{unit:\\\"Zeichen\\\",verb:\\\"zu haben\\\"},file:{unit:\\\"Bytes\\\",verb:\\\"zu haben\\\"},array:{unit:\\\"Elemente\\\",verb:\\\"zu haben\\\"},set:{unit:\\\"Elemente\\\",verb:\\\"zu haben\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"Zahl\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"Array\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"Eingabe\\\",email:\\\"E-Mail-Adresse\\\",url:\\\"URL\\\",emoji:\\\"Emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO-Datum und -Uhrzeit\\\",date:\\\"ISO-Datum\\\",time:\\\"ISO-Uhrzeit\\\",duration:\\\"ISO-Dauer\\\",ipv4:\\\"IPv4-Adresse\\\",ipv6:\\\"IPv6-Adresse\\\",cidrv4:\\\"IPv4-Bereich\\\",cidrv6:\\\"IPv6-Bereich\\\",base64:\\\"Base64-codierter String\\\",base64url:\\\"Base64-URL-codierter String\\\",json_string:\\\"JSON-String\\\",e164:\\\"E.164-Nummer\\\",jwt:\\\"JWT\\\",template_literal:\\\"Eingabe\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`Ung\\\\xFCltige Eingabe: erwartet ${t.expected}, erhalten ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`Ung\\\\xFCltige Eingabe: erwartet ${p(t.values[0])}`:`Ung\\\\xFCltige Option: erwartet eine von ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`Zu gro\\\\xDF: erwartet, dass ${t.origin??\\\"Wert\\\"} ${i}${t.maximum.toString()} ${a.unit??\\\"Elemente\\\"} hat`:`Zu gro\\\\xDF: erwartet, dass ${t.origin??\\\"Wert\\\"} ${i}${t.maximum.toString()} ist`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`Zu klein: erwartet, dass ${t.origin} ${i}${t.minimum.toString()} ${a.unit} hat`:`Zu klein: erwartet, dass ${t.origin} ${i}${t.minimum.toString()} ist`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`Ung\\\\xFCltiger String: muss mit \\\"${i.prefix}\\\" beginnen`:i.format===\\\"ends_with\\\"?`Ung\\\\xFCltiger String: muss mit \\\"${i.suffix}\\\" enden`:i.format===\\\"includes\\\"?`Ung\\\\xFCltiger String: muss \\\"${i.includes}\\\" enthalten`:i.format===\\\"regex\\\"?`Ung\\\\xFCltiger String: muss dem Muster ${i.pattern} entsprechen`:`Ung\\\\xFCltig: ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`Ung\\\\xFCltige Zahl: muss ein Vielfaches von ${t.divisor} sein`;case\\\"unrecognized_keys\\\":return`${t.keys.length>1?\\\"Unbekannte Schl\\\\xFCssel\\\":\\\"Unbekannter Schl\\\\xFCssel\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Ung\\\\xFCltiger Schl\\\\xFCssel in ${t.origin}`;case\\\"invalid_union\\\":return\\\"Ung\\\\xFCltige Eingabe\\\";case\\\"invalid_element\\\":return`Ung\\\\xFCltiger Wert in ${t.origin}`;default:return\\\"Ung\\\\xFCltige Eingabe\\\"}}};function Su(){return{localeError:kl()}}var zl=e=>{let r=typeof e;switch(r){case\\\"number\\\":return Number.isNaN(e)?\\\"NaN\\\":\\\"number\\\";case\\\"object\\\":{if(Array.isArray(e))return\\\"array\\\";if(e===null)return\\\"null\\\";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return r},Il=()=>{let e={string:{unit:\\\"characters\\\",verb:\\\"to have\\\"},file:{unit:\\\"bytes\\\",verb:\\\"to have\\\"},array:{unit:\\\"items\\\",verb:\\\"to have\\\"},set:{unit:\\\"items\\\",verb:\\\"to have\\\"}};function r(o){return e[o]??null}let n={regex:\\\"input\\\",email:\\\"email address\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO datetime\\\",date:\\\"ISO date\\\",time:\\\"ISO time\\\",duration:\\\"ISO duration\\\",ipv4:\\\"IPv4 address\\\",ipv6:\\\"IPv6 address\\\",cidrv4:\\\"IPv4 range\\\",cidrv6:\\\"IPv6 range\\\",base64:\\\"base64-encoded string\\\",base64url:\\\"base64url-encoded string\\\",json_string:\\\"JSON string\\\",e164:\\\"E.164 number\\\",jwt:\\\"JWT\\\",template_literal:\\\"input\\\"};return o=>{switch(o.code){case\\\"invalid_type\\\":return`Invalid input: expected ${o.expected}, received ${zl(o.input)}`;case\\\"invalid_value\\\":return o.values.length===1?`Invalid input: expected ${p(o.values[0])}`:`Invalid option: expected one of ${l(o.values,\\\"|\\\")}`;case\\\"too_big\\\":{let t=o.inclusive?\\\"<=\\\":\\\"<\\\",i=r(o.origin);return i?`Too big: expected ${o.origin??\\\"value\\\"} to have ${t}${o.maximum.toString()} ${i.unit??\\\"elements\\\"}`:`Too big: expected ${o.origin??\\\"value\\\"} to be ${t}${o.maximum.toString()}`}case\\\"too_small\\\":{let t=o.inclusive?\\\">=\\\":\\\">\\\",i=r(o.origin);return i?`Too small: expected ${o.origin} to have ${t}${o.minimum.toString()} ${i.unit}`:`Too small: expected ${o.origin} to be ${t}${o.minimum.toString()}`}case\\\"invalid_format\\\":{let t=o;return t.format===\\\"starts_with\\\"?`Invalid string: must start with \\\"${t.prefix}\\\"`:t.format===\\\"ends_with\\\"?`Invalid string: must end with \\\"${t.suffix}\\\"`:t.format===\\\"includes\\\"?`Invalid string: must include \\\"${t.includes}\\\"`:t.format===\\\"regex\\\"?`Invalid string: must match pattern ${t.pattern}`:`Invalid ${n[t.format]??o.format}`}case\\\"not_multiple_of\\\":return`Invalid number: must be a multiple of ${o.divisor}`;case\\\"unrecognized_keys\\\":return`Unrecognized key${o.keys.length>1?\\\"s\\\":\\\"\\\"}: ${l(o.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Invalid key in ${o.origin}`;case\\\"invalid_union\\\":return\\\"Invalid input\\\";case\\\"invalid_element\\\":return`Invalid value in ${o.origin}`;default:return\\\"Invalid input\\\"}}};function Xt(){return{localeError:Il()}}var wl=e=>{let r=typeof e;switch(r){case\\\"number\\\":return Number.isNaN(e)?\\\"NaN\\\":\\\"nombro\\\";case\\\"object\\\":{if(Array.isArray(e))return\\\"tabelo\\\";if(e===null)return\\\"senvalora\\\";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return r},Sl=()=>{let e={string:{unit:\\\"karaktrojn\\\",verb:\\\"havi\\\"},file:{unit:\\\"bajtojn\\\",verb:\\\"havi\\\"},array:{unit:\\\"elementojn\\\",verb:\\\"havi\\\"},set:{unit:\\\"elementojn\\\",verb:\\\"havi\\\"}};function r(o){return e[o]??null}let n={regex:\\\"enigo\\\",email:\\\"retadreso\\\",url:\\\"URL\\\",emoji:\\\"emo\\\\u011Dio\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO-datotempo\\\",date:\\\"ISO-dato\\\",time:\\\"ISO-tempo\\\",duration:\\\"ISO-da\\\\u016Dro\\\",ipv4:\\\"IPv4-adreso\\\",ipv6:\\\"IPv6-adreso\\\",cidrv4:\\\"IPv4-rango\\\",cidrv6:\\\"IPv6-rango\\\",base64:\\\"64-ume kodita karaktraro\\\",base64url:\\\"URL-64-ume kodita karaktraro\\\",json_string:\\\"JSON-karaktraro\\\",e164:\\\"E.164-nombro\\\",jwt:\\\"JWT\\\",template_literal:\\\"enigo\\\"};return o=>{switch(o.code){case\\\"invalid_type\\\":return`Nevalida enigo: atendi\\\\u011Dis ${o.expected}, ricevi\\\\u011Dis ${wl(o.input)}`;case\\\"invalid_value\\\":return o.values.length===1?`Nevalida enigo: atendi\\\\u011Dis ${p(o.values[0])}`:`Nevalida opcio: atendi\\\\u011Dis unu el ${l(o.values,\\\"|\\\")}`;case\\\"too_big\\\":{let t=o.inclusive?\\\"<=\\\":\\\"<\\\",i=r(o.origin);return i?`Tro granda: atendi\\\\u011Dis ke ${o.origin??\\\"valoro\\\"} havu ${t}${o.maximum.toString()} ${i.unit??\\\"elementojn\\\"}`:`Tro granda: atendi\\\\u011Dis ke ${o.origin??\\\"valoro\\\"} havu ${t}${o.maximum.toString()}`}case\\\"too_small\\\":{let t=o.inclusive?\\\">=\\\":\\\">\\\",i=r(o.origin);return i?`Tro malgranda: atendi\\\\u011Dis ke ${o.origin} havu ${t}${o.minimum.toString()} ${i.unit}`:`Tro malgranda: atendi\\\\u011Dis ke ${o.origin} estu ${t}${o.minimum.toString()}`}case\\\"invalid_format\\\":{let t=o;return t.format===\\\"starts_with\\\"?`Nevalida karaktraro: devas komenci\\\\u011Di per \\\"${t.prefix}\\\"`:t.format===\\\"ends_with\\\"?`Nevalida karaktraro: devas fini\\\\u011Di per \\\"${t.suffix}\\\"`:t.format===\\\"includes\\\"?`Nevalida karaktraro: devas inkluzivi \\\"${t.includes}\\\"`:t.format===\\\"regex\\\"?`Nevalida karaktraro: devas kongrui kun la modelo ${t.pattern}`:`Nevalida ${n[t.format]??o.format}`}case\\\"not_multiple_of\\\":return`Nevalida nombro: devas esti oblo de ${o.divisor}`;case\\\"unrecognized_keys\\\":return`Nekonata${o.keys.length>1?\\\"j\\\":\\\"\\\"} \\\\u015Dlosilo${o.keys.length>1?\\\"j\\\":\\\"\\\"}: ${l(o.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Nevalida \\\\u015Dlosilo en ${o.origin}`;case\\\"invalid_union\\\":return\\\"Nevalida enigo\\\";case\\\"invalid_element\\\":return`Nevalida valoro en ${o.origin}`;default:return\\\"Nevalida enigo\\\"}}};function ju(){return{localeError:Sl()}}var jl=()=>{let e={string:{unit:\\\"caracteres\\\",verb:\\\"tener\\\"},file:{unit:\\\"bytes\\\",verb:\\\"tener\\\"},array:{unit:\\\"elementos\\\",verb:\\\"tener\\\"},set:{unit:\\\"elementos\\\",verb:\\\"tener\\\"}},r={string:\\\"texto\\\",number:\\\"n\\\\xFAmero\\\",boolean:\\\"booleano\\\",array:\\\"arreglo\\\",object:\\\"objeto\\\",set:\\\"conjunto\\\",file:\\\"archivo\\\",date:\\\"fecha\\\",bigint:\\\"n\\\\xFAmero grande\\\",symbol:\\\"s\\\\xEDmbolo\\\",undefined:\\\"indefinido\\\",null:\\\"nulo\\\",function:\\\"funci\\\\xF3n\\\",map:\\\"mapa\\\",record:\\\"registro\\\",tuple:\\\"tupla\\\",enum:\\\"enumeraci\\\\xF3n\\\",union:\\\"uni\\\\xF3n\\\",literal:\\\"literal\\\",promise:\\\"promesa\\\",void:\\\"vac\\\\xEDo\\\",never:\\\"nunca\\\",unknown:\\\"desconocido\\\",any:\\\"cualquiera\\\"};function n(a){return e[a]??null}function o(a){return r[a]??a}let t=a=>{let u=typeof a;switch(u){case\\\"number\\\":return Number.isNaN(a)?\\\"NaN\\\":\\\"number\\\";case\\\"object\\\":return Array.isArray(a)?\\\"array\\\":a===null?\\\"null\\\":Object.getPrototypeOf(a)!==Object.prototype?a.constructor.name:\\\"object\\\"}return u},i={regex:\\\"entrada\\\",email:\\\"direcci\\\\xF3n de correo electr\\\\xF3nico\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"fecha y hora ISO\\\",date:\\\"fecha ISO\\\",time:\\\"hora ISO\\\",duration:\\\"duraci\\\\xF3n ISO\\\",ipv4:\\\"direcci\\\\xF3n IPv4\\\",ipv6:\\\"direcci\\\\xF3n IPv6\\\",cidrv4:\\\"rango IPv4\\\",cidrv6:\\\"rango IPv6\\\",base64:\\\"cadena codificada en base64\\\",base64url:\\\"URL codificada en base64\\\",json_string:\\\"cadena JSON\\\",e164:\\\"n\\\\xFAmero E.164\\\",jwt:\\\"JWT\\\",template_literal:\\\"entrada\\\"};return a=>{switch(a.code){case\\\"invalid_type\\\":return`Entrada inv\\\\xE1lida: se esperaba ${o(a.expected)}, recibido ${o(t(a.input))}`;case\\\"invalid_value\\\":return a.values.length===1?`Entrada inv\\\\xE1lida: se esperaba ${p(a.values[0])}`:`Opci\\\\xF3n inv\\\\xE1lida: se esperaba una de ${l(a.values,\\\"|\\\")}`;case\\\"too_big\\\":{let u=a.inclusive?\\\"<=\\\":\\\"<\\\",s=n(a.origin),m=o(a.origin);return s?`Demasiado grande: se esperaba que ${m??\\\"valor\\\"} tuviera ${u}${a.maximum.toString()} ${s.unit??\\\"elementos\\\"}`:`Demasiado grande: se esperaba que ${m??\\\"valor\\\"} fuera ${u}${a.maximum.toString()}`}case\\\"too_small\\\":{let u=a.inclusive?\\\">=\\\":\\\">\\\",s=n(a.origin),m=o(a.origin);return s?`Demasiado peque\\\\xF1o: se esperaba que ${m} tuviera ${u}${a.minimum.toString()} ${s.unit}`:`Demasiado peque\\\\xF1o: se esperaba que ${m} fuera ${u}${a.minimum.toString()}`}case\\\"invalid_format\\\":{let u=a;return u.format===\\\"starts_with\\\"?`Cadena inv\\\\xE1lida: debe comenzar con \\\"${u.prefix}\\\"`:u.format===\\\"ends_with\\\"?`Cadena inv\\\\xE1lida: debe terminar en \\\"${u.suffix}\\\"`:u.format===\\\"includes\\\"?`Cadena inv\\\\xE1lida: debe incluir \\\"${u.includes}\\\"`:u.format===\\\"regex\\\"?`Cadena inv\\\\xE1lida: debe coincidir con el patr\\\\xF3n ${u.pattern}`:`Inv\\\\xE1lido ${i[u.format]??a.format}`}case\\\"not_multiple_of\\\":return`N\\\\xFAmero inv\\\\xE1lido: debe ser m\\\\xFAltiplo de ${a.divisor}`;case\\\"unrecognized_keys\\\":return`Llave${a.keys.length>1?\\\"s\\\":\\\"\\\"} desconocida${a.keys.length>1?\\\"s\\\":\\\"\\\"}: ${l(a.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Llave inv\\\\xE1lida en ${o(a.origin)}`;case\\\"invalid_union\\\":return\\\"Entrada inv\\\\xE1lida\\\";case\\\"invalid_element\\\":return`Valor inv\\\\xE1lido en ${o(a.origin)}`;default:return\\\"Entrada inv\\\\xE1lida\\\"}}};function Ou(){return{localeError:jl()}}var Ol=()=>{let e={string:{unit:\\\"\\\\u06A9\\\\u0627\\\\u0631\\\\u0627\\\\u06A9\\\\u062A\\\\u0631\\\",verb:\\\"\\\\u062F\\\\u0627\\\\u0634\\\\u062A\\\\u0647 \\\\u0628\\\\u0627\\\\u0634\\\\u062F\\\"},file:{unit:\\\"\\\\u0628\\\\u0627\\\\u06CC\\\\u062A\\\",verb:\\\"\\\\u062F\\\\u0627\\\\u0634\\\\u062A\\\\u0647 \\\\u0628\\\\u0627\\\\u0634\\\\u062F\\\"},array:{unit:\\\"\\\\u0622\\\\u06CC\\\\u062A\\\\u0645\\\",verb:\\\"\\\\u062F\\\\u0627\\\\u0634\\\\u062A\\\\u0647 \\\\u0628\\\\u0627\\\\u0634\\\\u062F\\\"},set:{unit:\\\"\\\\u0622\\\\u06CC\\\\u062A\\\\u0645\\\",verb:\\\"\\\\u062F\\\\u0627\\\\u0634\\\\u062A\\\\u0647 \\\\u0628\\\\u0627\\\\u0634\\\\u062F\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"\\\\u0639\\\\u062F\\\\u062F\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"\\\\u0622\\\\u0631\\\\u0627\\\\u06CC\\\\u0647\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"\\\\u0648\\\\u0631\\\\u0648\\\\u062F\\\\u06CC\\\",email:\\\"\\\\u0622\\\\u062F\\\\u0631\\\\u0633 \\\\u0627\\\\u06CC\\\\u0645\\\\u06CC\\\\u0644\\\",url:\\\"URL\\\",emoji:\\\"\\\\u0627\\\\u06CC\\\\u0645\\\\u0648\\\\u062C\\\\u06CC\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"\\\\u062A\\\\u0627\\\\u0631\\\\u06CC\\\\u062E \\\\u0648 \\\\u0632\\\\u0645\\\\u0627\\\\u0646 \\\\u0627\\\\u06CC\\\\u0632\\\\u0648\\\",date:\\\"\\\\u062A\\\\u0627\\\\u0631\\\\u06CC\\\\u062E \\\\u0627\\\\u06CC\\\\u0632\\\\u0648\\\",time:\\\"\\\\u0632\\\\u0645\\\\u0627\\\\u0646 \\\\u0627\\\\u06CC\\\\u0632\\\\u0648\\\",duration:\\\"\\\\u0645\\\\u062F\\\\u062A \\\\u0632\\\\u0645\\\\u0627\\\\u0646 \\\\u0627\\\\u06CC\\\\u0632\\\\u0648\\\",ipv4:\\\"IPv4 \\\\u0622\\\\u062F\\\\u0631\\\\u0633\\\",ipv6:\\\"IPv6 \\\\u0622\\\\u062F\\\\u0631\\\\u0633\\\",cidrv4:\\\"IPv4 \\\\u062F\\\\u0627\\\\u0645\\\\u0646\\\\u0647\\\",cidrv6:\\\"IPv6 \\\\u062F\\\\u0627\\\\u0645\\\\u0646\\\\u0647\\\",base64:\\\"base64-encoded \\\\u0631\\\\u0634\\\\u062A\\\\u0647\\\",base64url:\\\"base64url-encoded \\\\u0631\\\\u0634\\\\u062A\\\\u0647\\\",json_string:\\\"JSON \\\\u0631\\\\u0634\\\\u062A\\\\u0647\\\",e164:\\\"E.164 \\\\u0639\\\\u062F\\\\u062F\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\u0648\\\\u0631\\\\u0648\\\\u062F\\\\u06CC\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\u0648\\\\u0631\\\\u0648\\\\u062F\\\\u06CC \\\\u0646\\\\u0627\\\\u0645\\\\u0639\\\\u062A\\\\u0628\\\\u0631: \\\\u0645\\\\u06CC\\\\u200C\\\\u0628\\\\u0627\\\\u06CC\\\\u0633\\\\u062A ${t.expected} \\\\u0645\\\\u06CC\\\\u200C\\\\u0628\\\\u0648\\\\u062F\\\\u060C ${n(t.input)} \\\\u062F\\\\u0631\\\\u06CC\\\\u0627\\\\u0641\\\\u062A \\\\u0634\\\\u062F`;case\\\"invalid_value\\\":return t.values.length===1?`\\\\u0648\\\\u0631\\\\u0648\\\\u062F\\\\u06CC \\\\u0646\\\\u0627\\\\u0645\\\\u0639\\\\u062A\\\\u0628\\\\u0631: \\\\u0645\\\\u06CC\\\\u200C\\\\u0628\\\\u0627\\\\u06CC\\\\u0633\\\\u062A ${p(t.values[0])} \\\\u0645\\\\u06CC\\\\u200C\\\\u0628\\\\u0648\\\\u062F`:`\\\\u06AF\\\\u0632\\\\u06CC\\\\u0646\\\\u0647 \\\\u0646\\\\u0627\\\\u0645\\\\u0639\\\\u062A\\\\u0628\\\\u0631: \\\\u0645\\\\u06CC\\\\u200C\\\\u0628\\\\u0627\\\\u06CC\\\\u0633\\\\u062A \\\\u06CC\\\\u06A9\\\\u06CC \\\\u0627\\\\u0632 ${l(t.values,\\\"|\\\")} \\\\u0645\\\\u06CC\\\\u200C\\\\u0628\\\\u0648\\\\u062F`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`\\\\u062E\\\\u06CC\\\\u0644\\\\u06CC \\\\u0628\\\\u0632\\\\u0631\\\\u06AF: ${t.origin??\\\"\\\\u0645\\\\u0642\\\\u062F\\\\u0627\\\\u0631\\\"} \\\\u0628\\\\u0627\\\\u06CC\\\\u062F ${i}${t.maximum.toString()} ${a.unit??\\\"\\\\u0639\\\\u0646\\\\u0635\\\\u0631\\\"} \\\\u0628\\\\u0627\\\\u0634\\\\u062F`:`\\\\u062E\\\\u06CC\\\\u0644\\\\u06CC \\\\u0628\\\\u0632\\\\u0631\\\\u06AF: ${t.origin??\\\"\\\\u0645\\\\u0642\\\\u062F\\\\u0627\\\\u0631\\\"} \\\\u0628\\\\u0627\\\\u06CC\\\\u062F ${i}${t.maximum.toString()} \\\\u0628\\\\u0627\\\\u0634\\\\u062F`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`\\\\u062E\\\\u06CC\\\\u0644\\\\u06CC \\\\u06A9\\\\u0648\\\\u0686\\\\u06A9: ${t.origin} \\\\u0628\\\\u0627\\\\u06CC\\\\u062F ${i}${t.minimum.toString()} ${a.unit} \\\\u0628\\\\u0627\\\\u0634\\\\u062F`:`\\\\u062E\\\\u06CC\\\\u0644\\\\u06CC \\\\u06A9\\\\u0648\\\\u0686\\\\u06A9: ${t.origin} \\\\u0628\\\\u0627\\\\u06CC\\\\u062F ${i}${t.minimum.toString()} \\\\u0628\\\\u0627\\\\u0634\\\\u062F`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`\\\\u0631\\\\u0634\\\\u062A\\\\u0647 \\\\u0646\\\\u0627\\\\u0645\\\\u0639\\\\u062A\\\\u0628\\\\u0631: \\\\u0628\\\\u0627\\\\u06CC\\\\u062F \\\\u0628\\\\u0627 \\\"${i.prefix}\\\" \\\\u0634\\\\u0631\\\\u0648\\\\u0639 \\\\u0634\\\\u0648\\\\u062F`:i.format===\\\"ends_with\\\"?`\\\\u0631\\\\u0634\\\\u062A\\\\u0647 \\\\u0646\\\\u0627\\\\u0645\\\\u0639\\\\u062A\\\\u0628\\\\u0631: \\\\u0628\\\\u0627\\\\u06CC\\\\u062F \\\\u0628\\\\u0627 \\\"${i.suffix}\\\" \\\\u062A\\\\u0645\\\\u0627\\\\u0645 \\\\u0634\\\\u0648\\\\u062F`:i.format===\\\"includes\\\"?`\\\\u0631\\\\u0634\\\\u062A\\\\u0647 \\\\u0646\\\\u0627\\\\u0645\\\\u0639\\\\u062A\\\\u0628\\\\u0631: \\\\u0628\\\\u0627\\\\u06CC\\\\u062F \\\\u0634\\\\u0627\\\\u0645\\\\u0644 \\\"${i.includes}\\\" \\\\u0628\\\\u0627\\\\u0634\\\\u062F`:i.format===\\\"regex\\\"?`\\\\u0631\\\\u0634\\\\u062A\\\\u0647 \\\\u0646\\\\u0627\\\\u0645\\\\u0639\\\\u062A\\\\u0628\\\\u0631: \\\\u0628\\\\u0627\\\\u06CC\\\\u062F \\\\u0628\\\\u0627 \\\\u0627\\\\u0644\\\\u06AF\\\\u0648\\\\u06CC ${i.pattern} \\\\u0645\\\\u0637\\\\u0627\\\\u0628\\\\u0642\\\\u062A \\\\u062F\\\\u0627\\\\u0634\\\\u062A\\\\u0647 \\\\u0628\\\\u0627\\\\u0634\\\\u062F`:`${o[i.format]??t.format} \\\\u0646\\\\u0627\\\\u0645\\\\u0639\\\\u062A\\\\u0628\\\\u0631`}case\\\"not_multiple_of\\\":return`\\\\u0639\\\\u062F\\\\u062F \\\\u0646\\\\u0627\\\\u0645\\\\u0639\\\\u062A\\\\u0628\\\\u0631: \\\\u0628\\\\u0627\\\\u06CC\\\\u062F \\\\u0645\\\\u0636\\\\u0631\\\\u0628 ${t.divisor} \\\\u0628\\\\u0627\\\\u0634\\\\u062F`;case\\\"unrecognized_keys\\\":return`\\\\u06A9\\\\u0644\\\\u06CC\\\\u062F${t.keys.length>1?\\\"\\\\u0647\\\\u0627\\\\u06CC\\\":\\\"\\\"} \\\\u0646\\\\u0627\\\\u0634\\\\u0646\\\\u0627\\\\u0633: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`\\\\u06A9\\\\u0644\\\\u06CC\\\\u062F \\\\u0646\\\\u0627\\\\u0634\\\\u0646\\\\u0627\\\\u0633 \\\\u062F\\\\u0631 ${t.origin}`;case\\\"invalid_union\\\":return\\\"\\\\u0648\\\\u0631\\\\u0648\\\\u062F\\\\u06CC \\\\u0646\\\\u0627\\\\u0645\\\\u0639\\\\u062A\\\\u0628\\\\u0631\\\";case\\\"invalid_element\\\":return`\\\\u0645\\\\u0642\\\\u062F\\\\u0627\\\\u0631 \\\\u0646\\\\u0627\\\\u0645\\\\u0639\\\\u062A\\\\u0628\\\\u0631 \\\\u062F\\\\u0631 ${t.origin}`;default:return\\\"\\\\u0648\\\\u0631\\\\u0648\\\\u062F\\\\u06CC \\\\u0646\\\\u0627\\\\u0645\\\\u0639\\\\u062A\\\\u0628\\\\u0631\\\"}}};function Pu(){return{localeError:Ol()}}var Pl=()=>{let e={string:{unit:\\\"merkki\\\\xE4\\\",subject:\\\"merkkijonon\\\"},file:{unit:\\\"tavua\\\",subject:\\\"tiedoston\\\"},array:{unit:\\\"alkiota\\\",subject:\\\"listan\\\"},set:{unit:\\\"alkiota\\\",subject:\\\"joukon\\\"},number:{unit:\\\"\\\",subject:\\\"luvun\\\"},bigint:{unit:\\\"\\\",subject:\\\"suuren kokonaisluvun\\\"},int:{unit:\\\"\\\",subject:\\\"kokonaisluvun\\\"},date:{unit:\\\"\\\",subject:\\\"p\\\\xE4iv\\\\xE4m\\\\xE4\\\\xE4r\\\\xE4n\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"number\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"array\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"s\\\\xE4\\\\xE4nn\\\\xF6llinen lauseke\\\",email:\\\"s\\\\xE4hk\\\\xF6postiosoite\\\",url:\\\"URL-osoite\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO-aikaleima\\\",date:\\\"ISO-p\\\\xE4iv\\\\xE4m\\\\xE4\\\\xE4r\\\\xE4\\\",time:\\\"ISO-aika\\\",duration:\\\"ISO-kesto\\\",ipv4:\\\"IPv4-osoite\\\",ipv6:\\\"IPv6-osoite\\\",cidrv4:\\\"IPv4-alue\\\",cidrv6:\\\"IPv6-alue\\\",base64:\\\"base64-koodattu merkkijono\\\",base64url:\\\"base64url-koodattu merkkijono\\\",json_string:\\\"JSON-merkkijono\\\",e164:\\\"E.164-luku\\\",jwt:\\\"JWT\\\",template_literal:\\\"templaattimerkkijono\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`Virheellinen tyyppi: odotettiin ${t.expected}, oli ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`Virheellinen sy\\\\xF6te: t\\\\xE4ytyy olla ${p(t.values[0])}`:`Virheellinen valinta: t\\\\xE4ytyy olla yksi seuraavista: ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`Liian suuri: ${a.subject} t\\\\xE4ytyy olla ${i}${t.maximum.toString()} ${a.unit}`.trim():`Liian suuri: arvon t\\\\xE4ytyy olla ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`Liian pieni: ${a.subject} t\\\\xE4ytyy olla ${i}${t.minimum.toString()} ${a.unit}`.trim():`Liian pieni: arvon t\\\\xE4ytyy olla ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`Virheellinen sy\\\\xF6te: t\\\\xE4ytyy alkaa \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`Virheellinen sy\\\\xF6te: t\\\\xE4ytyy loppua \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`Virheellinen sy\\\\xF6te: t\\\\xE4ytyy sis\\\\xE4lt\\\\xE4\\\\xE4 \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`Virheellinen sy\\\\xF6te: t\\\\xE4ytyy vastata s\\\\xE4\\\\xE4nn\\\\xF6llist\\\\xE4 lauseketta ${i.pattern}`:`Virheellinen ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`Virheellinen luku: t\\\\xE4ytyy olla luvun ${t.divisor} monikerta`;case\\\"unrecognized_keys\\\":return`${t.keys.length>1?\\\"Tuntemattomat avaimet\\\":\\\"Tuntematon avain\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return\\\"Virheellinen avain tietueessa\\\";case\\\"invalid_union\\\":return\\\"Virheellinen unioni\\\";case\\\"invalid_element\\\":return\\\"Virheellinen arvo joukossa\\\";default:return\\\"Virheellinen sy\\\\xF6te\\\"}}};function Uu(){return{localeError:Pl()}}var Ul=()=>{let e={string:{unit:\\\"caract\\\\xE8res\\\",verb:\\\"avoir\\\"},file:{unit:\\\"octets\\\",verb:\\\"avoir\\\"},array:{unit:\\\"\\\\xE9l\\\\xE9ments\\\",verb:\\\"avoir\\\"},set:{unit:\\\"\\\\xE9l\\\\xE9ments\\\",verb:\\\"avoir\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"nombre\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"tableau\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"entr\\\\xE9e\\\",email:\\\"adresse e-mail\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"date et heure ISO\\\",date:\\\"date ISO\\\",time:\\\"heure ISO\\\",duration:\\\"dur\\\\xE9e ISO\\\",ipv4:\\\"adresse IPv4\\\",ipv6:\\\"adresse IPv6\\\",cidrv4:\\\"plage IPv4\\\",cidrv6:\\\"plage IPv6\\\",base64:\\\"cha\\\\xEEne encod\\\\xE9e en base64\\\",base64url:\\\"cha\\\\xEEne encod\\\\xE9e en base64url\\\",json_string:\\\"cha\\\\xEEne JSON\\\",e164:\\\"num\\\\xE9ro E.164\\\",jwt:\\\"JWT\\\",template_literal:\\\"entr\\\\xE9e\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`Entr\\\\xE9e invalide : ${t.expected} attendu, ${n(t.input)} re\\\\xE7u`;case\\\"invalid_value\\\":return t.values.length===1?`Entr\\\\xE9e invalide : ${p(t.values[0])} attendu`:`Option invalide : une valeur parmi ${l(t.values,\\\"|\\\")} attendue`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`Trop grand : ${t.origin??\\\"valeur\\\"} doit ${a.verb} ${i}${t.maximum.toString()} ${a.unit??\\\"\\\\xE9l\\\\xE9ment(s)\\\"}`:`Trop grand : ${t.origin??\\\"valeur\\\"} doit \\\\xEAtre ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`Trop petit : ${t.origin} doit ${a.verb} ${i}${t.minimum.toString()} ${a.unit}`:`Trop petit : ${t.origin} doit \\\\xEAtre ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`Cha\\\\xEEne invalide : doit commencer par \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`Cha\\\\xEEne invalide : doit se terminer par \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`Cha\\\\xEEne invalide : doit inclure \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`Cha\\\\xEEne invalide : doit correspondre au mod\\\\xE8le ${i.pattern}`:`${o[i.format]??t.format} invalide`}case\\\"not_multiple_of\\\":return`Nombre invalide : doit \\\\xEAtre un multiple de ${t.divisor}`;case\\\"unrecognized_keys\\\":return`Cl\\\\xE9${t.keys.length>1?\\\"s\\\":\\\"\\\"} non reconnue${t.keys.length>1?\\\"s\\\":\\\"\\\"} : ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Cl\\\\xE9 invalide dans ${t.origin}`;case\\\"invalid_union\\\":return\\\"Entr\\\\xE9e invalide\\\";case\\\"invalid_element\\\":return`Valeur invalide dans ${t.origin}`;default:return\\\"Entr\\\\xE9e invalide\\\"}}};function Nu(){return{localeError:Ul()}}var Nl=()=>{let e={string:{unit:\\\"caract\\\\xE8res\\\",verb:\\\"avoir\\\"},file:{unit:\\\"octets\\\",verb:\\\"avoir\\\"},array:{unit:\\\"\\\\xE9l\\\\xE9ments\\\",verb:\\\"avoir\\\"},set:{unit:\\\"\\\\xE9l\\\\xE9ments\\\",verb:\\\"avoir\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"number\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"array\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"entr\\\\xE9e\\\",email:\\\"adresse courriel\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"date-heure ISO\\\",date:\\\"date ISO\\\",time:\\\"heure ISO\\\",duration:\\\"dur\\\\xE9e ISO\\\",ipv4:\\\"adresse IPv4\\\",ipv6:\\\"adresse IPv6\\\",cidrv4:\\\"plage IPv4\\\",cidrv6:\\\"plage IPv6\\\",base64:\\\"cha\\\\xEEne encod\\\\xE9e en base64\\\",base64url:\\\"cha\\\\xEEne encod\\\\xE9e en base64url\\\",json_string:\\\"cha\\\\xEEne JSON\\\",e164:\\\"num\\\\xE9ro E.164\\\",jwt:\\\"JWT\\\",template_literal:\\\"entr\\\\xE9e\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`Entr\\\\xE9e invalide : attendu ${t.expected}, re\\\\xE7u ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`Entr\\\\xE9e invalide : attendu ${p(t.values[0])}`:`Option invalide : attendu l'une des valeurs suivantes ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"\\\\u2264\\\":\\\"<\\\",a=r(t.origin);return a?`Trop grand : attendu que ${t.origin??\\\"la valeur\\\"} ait ${i}${t.maximum.toString()} ${a.unit}`:`Trop grand : attendu que ${t.origin??\\\"la valeur\\\"} soit ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\"\\\\u2265\\\":\\\">\\\",a=r(t.origin);return a?`Trop petit : attendu que ${t.origin} ait ${i}${t.minimum.toString()} ${a.unit}`:`Trop petit : attendu que ${t.origin} soit ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`Cha\\\\xEEne invalide : doit commencer par \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`Cha\\\\xEEne invalide : doit se terminer par \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`Cha\\\\xEEne invalide : doit inclure \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`Cha\\\\xEEne invalide : doit correspondre au motif ${i.pattern}`:`${o[i.format]??t.format} invalide`}case\\\"not_multiple_of\\\":return`Nombre invalide : doit \\\\xEAtre un multiple de ${t.divisor}`;case\\\"unrecognized_keys\\\":return`Cl\\\\xE9${t.keys.length>1?\\\"s\\\":\\\"\\\"} non reconnue${t.keys.length>1?\\\"s\\\":\\\"\\\"} : ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Cl\\\\xE9 invalide dans ${t.origin}`;case\\\"invalid_union\\\":return\\\"Entr\\\\xE9e invalide\\\";case\\\"invalid_element\\\":return`Valeur invalide dans ${t.origin}`;default:return\\\"Entr\\\\xE9e invalide\\\"}}};function Zu(){return{localeError:Nl()}}var Zl=()=>{let e={string:{unit:\\\"\\\\u05D0\\\\u05D5\\\\u05EA\\\\u05D9\\\\u05D5\\\\u05EA\\\",verb:\\\"\\\\u05DC\\\\u05DB\\\\u05DC\\\\u05D5\\\\u05DC\\\"},file:{unit:\\\"\\\\u05D1\\\\u05D9\\\\u05D9\\\\u05D8\\\\u05D9\\\\u05DD\\\",verb:\\\"\\\\u05DC\\\\u05DB\\\\u05DC\\\\u05D5\\\\u05DC\\\"},array:{unit:\\\"\\\\u05E4\\\\u05E8\\\\u05D9\\\\u05D8\\\\u05D9\\\\u05DD\\\",verb:\\\"\\\\u05DC\\\\u05DB\\\\u05DC\\\\u05D5\\\\u05DC\\\"},set:{unit:\\\"\\\\u05E4\\\\u05E8\\\\u05D9\\\\u05D8\\\\u05D9\\\\u05DD\\\",verb:\\\"\\\\u05DC\\\\u05DB\\\\u05DC\\\\u05D5\\\\u05DC\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"number\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"array\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"\\\\u05E7\\\\u05DC\\\\u05D8\\\",email:\\\"\\\\u05DB\\\\u05EA\\\\u05D5\\\\u05D1\\\\u05EA \\\\u05D0\\\\u05D9\\\\u05DE\\\\u05D9\\\\u05D9\\\\u05DC\\\",url:\\\"\\\\u05DB\\\\u05EA\\\\u05D5\\\\u05D1\\\\u05EA \\\\u05E8\\\\u05E9\\\\u05EA\\\",emoji:\\\"\\\\u05D0\\\\u05D9\\\\u05DE\\\\u05D5\\\\u05D2'\\\\u05D9\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"\\\\u05EA\\\\u05D0\\\\u05E8\\\\u05D9\\\\u05DA \\\\u05D5\\\\u05D6\\\\u05DE\\\\u05DF ISO\\\",date:\\\"\\\\u05EA\\\\u05D0\\\\u05E8\\\\u05D9\\\\u05DA ISO\\\",time:\\\"\\\\u05D6\\\\u05DE\\\\u05DF ISO\\\",duration:\\\"\\\\u05DE\\\\u05E9\\\\u05DA \\\\u05D6\\\\u05DE\\\\u05DF ISO\\\",ipv4:\\\"\\\\u05DB\\\\u05EA\\\\u05D5\\\\u05D1\\\\u05EA IPv4\\\",ipv6:\\\"\\\\u05DB\\\\u05EA\\\\u05D5\\\\u05D1\\\\u05EA IPv6\\\",cidrv4:\\\"\\\\u05D8\\\\u05D5\\\\u05D5\\\\u05D7 IPv4\\\",cidrv6:\\\"\\\\u05D8\\\\u05D5\\\\u05D5\\\\u05D7 IPv6\\\",base64:\\\"\\\\u05DE\\\\u05D7\\\\u05E8\\\\u05D5\\\\u05D6\\\\u05EA \\\\u05D1\\\\u05D1\\\\u05E1\\\\u05D9\\\\u05E1 64\\\",base64url:\\\"\\\\u05DE\\\\u05D7\\\\u05E8\\\\u05D5\\\\u05D6\\\\u05EA \\\\u05D1\\\\u05D1\\\\u05E1\\\\u05D9\\\\u05E1 64 \\\\u05DC\\\\u05DB\\\\u05EA\\\\u05D5\\\\u05D1\\\\u05D5\\\\u05EA \\\\u05E8\\\\u05E9\\\\u05EA\\\",json_string:\\\"\\\\u05DE\\\\u05D7\\\\u05E8\\\\u05D5\\\\u05D6\\\\u05EA JSON\\\",e164:\\\"\\\\u05DE\\\\u05E1\\\\u05E4\\\\u05E8 E.164\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\u05E7\\\\u05DC\\\\u05D8\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\u05E7\\\\u05DC\\\\u05D8 \\\\u05DC\\\\u05D0 \\\\u05EA\\\\u05E7\\\\u05D9\\\\u05DF: \\\\u05E6\\\\u05E8\\\\u05D9\\\\u05DA ${t.expected}, \\\\u05D4\\\\u05EA\\\\u05E7\\\\u05D1\\\\u05DC ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`\\\\u05E7\\\\u05DC\\\\u05D8 \\\\u05DC\\\\u05D0 \\\\u05EA\\\\u05E7\\\\u05D9\\\\u05DF: \\\\u05E6\\\\u05E8\\\\u05D9\\\\u05DA ${p(t.values[0])}`:`\\\\u05E7\\\\u05DC\\\\u05D8 \\\\u05DC\\\\u05D0 \\\\u05EA\\\\u05E7\\\\u05D9\\\\u05DF: \\\\u05E6\\\\u05E8\\\\u05D9\\\\u05DA \\\\u05D0\\\\u05D7\\\\u05EA \\\\u05DE\\\\u05D4\\\\u05D0\\\\u05E4\\\\u05E9\\\\u05E8\\\\u05D5\\\\u05D9\\\\u05D5\\\\u05EA  ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`\\\\u05D2\\\\u05D3\\\\u05D5\\\\u05DC \\\\u05DE\\\\u05D3\\\\u05D9: ${t.origin??\\\"value\\\"} \\\\u05E6\\\\u05E8\\\\u05D9\\\\u05DA \\\\u05DC\\\\u05D4\\\\u05D9\\\\u05D5\\\\u05EA ${i}${t.maximum.toString()} ${a.unit??\\\"elements\\\"}`:`\\\\u05D2\\\\u05D3\\\\u05D5\\\\u05DC \\\\u05DE\\\\u05D3\\\\u05D9: ${t.origin??\\\"value\\\"} \\\\u05E6\\\\u05E8\\\\u05D9\\\\u05DA \\\\u05DC\\\\u05D4\\\\u05D9\\\\u05D5\\\\u05EA ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`\\\\u05E7\\\\u05D8\\\\u05DF \\\\u05DE\\\\u05D3\\\\u05D9: ${t.origin} \\\\u05E6\\\\u05E8\\\\u05D9\\\\u05DA \\\\u05DC\\\\u05D4\\\\u05D9\\\\u05D5\\\\u05EA ${i}${t.minimum.toString()} ${a.unit}`:`\\\\u05E7\\\\u05D8\\\\u05DF \\\\u05DE\\\\u05D3\\\\u05D9: ${t.origin} \\\\u05E6\\\\u05E8\\\\u05D9\\\\u05DA \\\\u05DC\\\\u05D4\\\\u05D9\\\\u05D5\\\\u05EA ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`\\\\u05DE\\\\u05D7\\\\u05E8\\\\u05D5\\\\u05D6\\\\u05EA \\\\u05DC\\\\u05D0 \\\\u05EA\\\\u05E7\\\\u05D9\\\\u05E0\\\\u05D4: \\\\u05D7\\\\u05D9\\\\u05D9\\\\u05D1\\\\u05EA \\\\u05DC\\\\u05D4\\\\u05EA\\\\u05D7\\\\u05D9\\\\u05DC \\\\u05D1\\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`\\\\u05DE\\\\u05D7\\\\u05E8\\\\u05D5\\\\u05D6\\\\u05EA \\\\u05DC\\\\u05D0 \\\\u05EA\\\\u05E7\\\\u05D9\\\\u05E0\\\\u05D4: \\\\u05D7\\\\u05D9\\\\u05D9\\\\u05D1\\\\u05EA \\\\u05DC\\\\u05D4\\\\u05E1\\\\u05EA\\\\u05D9\\\\u05D9\\\\u05DD \\\\u05D1 \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`\\\\u05DE\\\\u05D7\\\\u05E8\\\\u05D5\\\\u05D6\\\\u05EA \\\\u05DC\\\\u05D0 \\\\u05EA\\\\u05E7\\\\u05D9\\\\u05E0\\\\u05D4: \\\\u05D7\\\\u05D9\\\\u05D9\\\\u05D1\\\\u05EA \\\\u05DC\\\\u05DB\\\\u05DC\\\\u05D5\\\\u05DC \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`\\\\u05DE\\\\u05D7\\\\u05E8\\\\u05D5\\\\u05D6\\\\u05EA \\\\u05DC\\\\u05D0 \\\\u05EA\\\\u05E7\\\\u05D9\\\\u05E0\\\\u05D4: \\\\u05D7\\\\u05D9\\\\u05D9\\\\u05D1\\\\u05EA \\\\u05DC\\\\u05D4\\\\u05EA\\\\u05D0\\\\u05D9\\\\u05DD \\\\u05DC\\\\u05EA\\\\u05D1\\\\u05E0\\\\u05D9\\\\u05EA ${i.pattern}`:`${o[i.format]??t.format} \\\\u05DC\\\\u05D0 \\\\u05EA\\\\u05E7\\\\u05D9\\\\u05DF`}case\\\"not_multiple_of\\\":return`\\\\u05DE\\\\u05E1\\\\u05E4\\\\u05E8 \\\\u05DC\\\\u05D0 \\\\u05EA\\\\u05E7\\\\u05D9\\\\u05DF: \\\\u05D7\\\\u05D9\\\\u05D9\\\\u05D1 \\\\u05DC\\\\u05D4\\\\u05D9\\\\u05D5\\\\u05EA \\\\u05DE\\\\u05DB\\\\u05E4\\\\u05DC\\\\u05D4 \\\\u05E9\\\\u05DC ${t.divisor}`;case\\\"unrecognized_keys\\\":return`\\\\u05DE\\\\u05E4\\\\u05EA\\\\u05D7${t.keys.length>1?\\\"\\\\u05D5\\\\u05EA\\\":\\\"\\\"} \\\\u05DC\\\\u05D0 \\\\u05DE\\\\u05D6\\\\u05D5\\\\u05D4${t.keys.length>1?\\\"\\\\u05D9\\\\u05DD\\\":\\\"\\\\u05D4\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`\\\\u05DE\\\\u05E4\\\\u05EA\\\\u05D7 \\\\u05DC\\\\u05D0 \\\\u05EA\\\\u05E7\\\\u05D9\\\\u05DF \\\\u05D1${t.origin}`;case\\\"invalid_union\\\":return\\\"\\\\u05E7\\\\u05DC\\\\u05D8 \\\\u05DC\\\\u05D0 \\\\u05EA\\\\u05E7\\\\u05D9\\\\u05DF\\\";case\\\"invalid_element\\\":return`\\\\u05E2\\\\u05E8\\\\u05DA \\\\u05DC\\\\u05D0 \\\\u05EA\\\\u05E7\\\\u05D9\\\\u05DF \\\\u05D1${t.origin}`;default:return\\\"\\\\u05E7\\\\u05DC\\\\u05D8 \\\\u05DC\\\\u05D0 \\\\u05EA\\\\u05E7\\\\u05D9\\\\u05DF\\\"}}};function Du(){return{localeError:Zl()}}var Dl=()=>{let e={string:{unit:\\\"karakter\\\",verb:\\\"legyen\\\"},file:{unit:\\\"byte\\\",verb:\\\"legyen\\\"},array:{unit:\\\"elem\\\",verb:\\\"legyen\\\"},set:{unit:\\\"elem\\\",verb:\\\"legyen\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"sz\\\\xE1m\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"t\\\\xF6mb\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"bemenet\\\",email:\\\"email c\\\\xEDm\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO id\\\\u0151b\\\\xE9lyeg\\\",date:\\\"ISO d\\\\xE1tum\\\",time:\\\"ISO id\\\\u0151\\\",duration:\\\"ISO id\\\\u0151intervallum\\\",ipv4:\\\"IPv4 c\\\\xEDm\\\",ipv6:\\\"IPv6 c\\\\xEDm\\\",cidrv4:\\\"IPv4 tartom\\\\xE1ny\\\",cidrv6:\\\"IPv6 tartom\\\\xE1ny\\\",base64:\\\"base64-k\\\\xF3dolt string\\\",base64url:\\\"base64url-k\\\\xF3dolt string\\\",json_string:\\\"JSON string\\\",e164:\\\"E.164 sz\\\\xE1m\\\",jwt:\\\"JWT\\\",template_literal:\\\"bemenet\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\xC9rv\\\\xE9nytelen bemenet: a v\\\\xE1rt \\\\xE9rt\\\\xE9k ${t.expected}, a kapott \\\\xE9rt\\\\xE9k ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`\\\\xC9rv\\\\xE9nytelen bemenet: a v\\\\xE1rt \\\\xE9rt\\\\xE9k ${p(t.values[0])}`:`\\\\xC9rv\\\\xE9nytelen opci\\\\xF3: valamelyik \\\\xE9rt\\\\xE9k v\\\\xE1rt ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`T\\\\xFAl nagy: ${t.origin??\\\"\\\\xE9rt\\\\xE9k\\\"} m\\\\xE9rete t\\\\xFAl nagy ${i}${t.maximum.toString()} ${a.unit??\\\"elem\\\"}`:`T\\\\xFAl nagy: a bemeneti \\\\xE9rt\\\\xE9k ${t.origin??\\\"\\\\xE9rt\\\\xE9k\\\"} t\\\\xFAl nagy: ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`T\\\\xFAl kicsi: a bemeneti \\\\xE9rt\\\\xE9k ${t.origin} m\\\\xE9rete t\\\\xFAl kicsi ${i}${t.minimum.toString()} ${a.unit}`:`T\\\\xFAl kicsi: a bemeneti \\\\xE9rt\\\\xE9k ${t.origin} t\\\\xFAl kicsi ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`\\\\xC9rv\\\\xE9nytelen string: \\\"${i.prefix}\\\" \\\\xE9rt\\\\xE9kkel kell kezd\\\\u0151dnie`:i.format===\\\"ends_with\\\"?`\\\\xC9rv\\\\xE9nytelen string: \\\"${i.suffix}\\\" \\\\xE9rt\\\\xE9kkel kell v\\\\xE9gz\\\\u0151dnie`:i.format===\\\"includes\\\"?`\\\\xC9rv\\\\xE9nytelen string: \\\"${i.includes}\\\" \\\\xE9rt\\\\xE9ket kell tartalmaznia`:i.format===\\\"regex\\\"?`\\\\xC9rv\\\\xE9nytelen string: ${i.pattern} mint\\\\xE1nak kell megfelelnie`:`\\\\xC9rv\\\\xE9nytelen ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`\\\\xC9rv\\\\xE9nytelen sz\\\\xE1m: ${t.divisor} t\\\\xF6bbsz\\\\xF6r\\\\xF6s\\\\xE9nek kell lennie`;case\\\"unrecognized_keys\\\":return`Ismeretlen kulcs${t.keys.length>1?\\\"s\\\":\\\"\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`\\\\xC9rv\\\\xE9nytelen kulcs ${t.origin}`;case\\\"invalid_union\\\":return\\\"\\\\xC9rv\\\\xE9nytelen bemenet\\\";case\\\"invalid_element\\\":return`\\\\xC9rv\\\\xE9nytelen \\\\xE9rt\\\\xE9k: ${t.origin}`;default:return\\\"\\\\xC9rv\\\\xE9nytelen bemenet\\\"}}};function Tu(){return{localeError:Dl()}}var Tl=()=>{let e={string:{unit:\\\"karakter\\\",verb:\\\"memiliki\\\"},file:{unit:\\\"byte\\\",verb:\\\"memiliki\\\"},array:{unit:\\\"item\\\",verb:\\\"memiliki\\\"},set:{unit:\\\"item\\\",verb:\\\"memiliki\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"number\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"array\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"input\\\",email:\\\"alamat email\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"tanggal dan waktu format ISO\\\",date:\\\"tanggal format ISO\\\",time:\\\"jam format ISO\\\",duration:\\\"durasi format ISO\\\",ipv4:\\\"alamat IPv4\\\",ipv6:\\\"alamat IPv6\\\",cidrv4:\\\"rentang alamat IPv4\\\",cidrv6:\\\"rentang alamat IPv6\\\",base64:\\\"string dengan enkode base64\\\",base64url:\\\"string dengan enkode base64url\\\",json_string:\\\"string JSON\\\",e164:\\\"angka E.164\\\",jwt:\\\"JWT\\\",template_literal:\\\"input\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`Input tidak valid: diharapkan ${t.expected}, diterima ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`Input tidak valid: diharapkan ${p(t.values[0])}`:`Pilihan tidak valid: diharapkan salah satu dari ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`Terlalu besar: diharapkan ${t.origin??\\\"value\\\"} memiliki ${i}${t.maximum.toString()} ${a.unit??\\\"elemen\\\"}`:`Terlalu besar: diharapkan ${t.origin??\\\"value\\\"} menjadi ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`Terlalu kecil: diharapkan ${t.origin} memiliki ${i}${t.minimum.toString()} ${a.unit}`:`Terlalu kecil: diharapkan ${t.origin} menjadi ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`String tidak valid: harus dimulai dengan \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`String tidak valid: harus berakhir dengan \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`String tidak valid: harus menyertakan \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`String tidak valid: harus sesuai pola ${i.pattern}`:`${o[i.format]??t.format} tidak valid`}case\\\"not_multiple_of\\\":return`Angka tidak valid: harus kelipatan dari ${t.divisor}`;case\\\"unrecognized_keys\\\":return`Kunci tidak dikenali ${t.keys.length>1?\\\"s\\\":\\\"\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Kunci tidak valid di ${t.origin}`;case\\\"invalid_union\\\":return\\\"Input tidak valid\\\";case\\\"invalid_element\\\":return`Nilai tidak valid di ${t.origin}`;default:return\\\"Input tidak valid\\\"}}};function Eu(){return{localeError:Tl()}}var El=e=>{let r=typeof e;switch(r){case\\\"number\\\":return Number.isNaN(e)?\\\"NaN\\\":\\\"n\\\\xFAmer\\\";case\\\"object\\\":{if(Array.isArray(e))return\\\"fylki\\\";if(e===null)return\\\"null\\\";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return r},Al=()=>{let e={string:{unit:\\\"stafi\\\",verb:\\\"a\\\\xF0 hafa\\\"},file:{unit:\\\"b\\\\xE6ti\\\",verb:\\\"a\\\\xF0 hafa\\\"},array:{unit:\\\"hluti\\\",verb:\\\"a\\\\xF0 hafa\\\"},set:{unit:\\\"hluti\\\",verb:\\\"a\\\\xF0 hafa\\\"}};function r(o){return e[o]??null}let n={regex:\\\"gildi\\\",email:\\\"netfang\\\",url:\\\"vefsl\\\\xF3\\\\xF0\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO dagsetning og t\\\\xEDmi\\\",date:\\\"ISO dagsetning\\\",time:\\\"ISO t\\\\xEDmi\\\",duration:\\\"ISO t\\\\xEDmalengd\\\",ipv4:\\\"IPv4 address\\\",ipv6:\\\"IPv6 address\\\",cidrv4:\\\"IPv4 range\\\",cidrv6:\\\"IPv6 range\\\",base64:\\\"base64-encoded strengur\\\",base64url:\\\"base64url-encoded strengur\\\",json_string:\\\"JSON strengur\\\",e164:\\\"E.164 t\\\\xF6lugildi\\\",jwt:\\\"JWT\\\",template_literal:\\\"gildi\\\"};return o=>{switch(o.code){case\\\"invalid_type\\\":return`Rangt gildi: \\\\xDE\\\\xFA sl\\\\xF3st inn ${El(o.input)} \\\\xFEar sem \\\\xE1 a\\\\xF0 vera ${o.expected}`;case\\\"invalid_value\\\":return o.values.length===1?`Rangt gildi: gert r\\\\xE1\\\\xF0 fyrir ${p(o.values[0])}`:`\\\\xD3gilt val: m\\\\xE1 vera eitt af eftirfarandi ${l(o.values,\\\"|\\\")}`;case\\\"too_big\\\":{let t=o.inclusive?\\\"<=\\\":\\\"<\\\",i=r(o.origin);return i?`Of st\\\\xF3rt: gert er r\\\\xE1\\\\xF0 fyrir a\\\\xF0 ${o.origin??\\\"gildi\\\"} hafi ${t}${o.maximum.toString()} ${i.unit??\\\"hluti\\\"}`:`Of st\\\\xF3rt: gert er r\\\\xE1\\\\xF0 fyrir a\\\\xF0 ${o.origin??\\\"gildi\\\"} s\\\\xE9 ${t}${o.maximum.toString()}`}case\\\"too_small\\\":{let t=o.inclusive?\\\">=\\\":\\\">\\\",i=r(o.origin);return i?`Of l\\\\xEDti\\\\xF0: gert er r\\\\xE1\\\\xF0 fyrir a\\\\xF0 ${o.origin} hafi ${t}${o.minimum.toString()} ${i.unit}`:`Of l\\\\xEDti\\\\xF0: gert er r\\\\xE1\\\\xF0 fyrir a\\\\xF0 ${o.origin} s\\\\xE9 ${t}${o.minimum.toString()}`}case\\\"invalid_format\\\":{let t=o;return t.format===\\\"starts_with\\\"?`\\\\xD3gildur strengur: ver\\\\xF0ur a\\\\xF0 byrja \\\\xE1 \\\"${t.prefix}\\\"`:t.format===\\\"ends_with\\\"?`\\\\xD3gildur strengur: ver\\\\xF0ur a\\\\xF0 enda \\\\xE1 \\\"${t.suffix}\\\"`:t.format===\\\"includes\\\"?`\\\\xD3gildur strengur: ver\\\\xF0ur a\\\\xF0 innihalda \\\"${t.includes}\\\"`:t.format===\\\"regex\\\"?`\\\\xD3gildur strengur: ver\\\\xF0ur a\\\\xF0 fylgja mynstri ${t.pattern}`:`Rangt ${n[t.format]??o.format}`}case\\\"not_multiple_of\\\":return`R\\\\xF6ng tala: ver\\\\xF0ur a\\\\xF0 vera margfeldi af ${o.divisor}`;case\\\"unrecognized_keys\\\":return`\\\\xD3\\\\xFEekkt ${o.keys.length>1?\\\"ir lyklar\\\":\\\"ur lykill\\\"}: ${l(o.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Rangur lykill \\\\xED ${o.origin}`;case\\\"invalid_union\\\":return\\\"Rangt gildi\\\";case\\\"invalid_element\\\":return`Rangt gildi \\\\xED ${o.origin}`;default:return\\\"Rangt gildi\\\"}}};function Au(){return{localeError:Al()}}var Rl=()=>{let e={string:{unit:\\\"caratteri\\\",verb:\\\"avere\\\"},file:{unit:\\\"byte\\\",verb:\\\"avere\\\"},array:{unit:\\\"elementi\\\",verb:\\\"avere\\\"},set:{unit:\\\"elementi\\\",verb:\\\"avere\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"numero\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"vettore\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"input\\\",email:\\\"indirizzo email\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"data e ora ISO\\\",date:\\\"data ISO\\\",time:\\\"ora ISO\\\",duration:\\\"durata ISO\\\",ipv4:\\\"indirizzo IPv4\\\",ipv6:\\\"indirizzo IPv6\\\",cidrv4:\\\"intervallo IPv4\\\",cidrv6:\\\"intervallo IPv6\\\",base64:\\\"stringa codificata in base64\\\",base64url:\\\"URL codificata in base64\\\",json_string:\\\"stringa JSON\\\",e164:\\\"numero E.164\\\",jwt:\\\"JWT\\\",template_literal:\\\"input\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`Input non valido: atteso ${t.expected}, ricevuto ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`Input non valido: atteso ${p(t.values[0])}`:`Opzione non valida: atteso uno tra ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`Troppo grande: ${t.origin??\\\"valore\\\"} deve avere ${i}${t.maximum.toString()} ${a.unit??\\\"elementi\\\"}`:`Troppo grande: ${t.origin??\\\"valore\\\"} deve essere ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`Troppo piccolo: ${t.origin} deve avere ${i}${t.minimum.toString()} ${a.unit}`:`Troppo piccolo: ${t.origin} deve essere ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`Stringa non valida: deve iniziare con \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`Stringa non valida: deve terminare con \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`Stringa non valida: deve includere \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`Stringa non valida: deve corrispondere al pattern ${i.pattern}`:`Invalid ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`Numero non valido: deve essere un multiplo di ${t.divisor}`;case\\\"unrecognized_keys\\\":return`Chiav${t.keys.length>1?\\\"i\\\":\\\"e\\\"} non riconosciut${t.keys.length>1?\\\"e\\\":\\\"a\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Chiave non valida in ${t.origin}`;case\\\"invalid_union\\\":return\\\"Input non valido\\\";case\\\"invalid_element\\\":return`Valore non valido in ${t.origin}`;default:return\\\"Input non valido\\\"}}};function Ru(){return{localeError:Rl()}}var Ll=()=>{let e={string:{unit:\\\"\\\\u6587\\\\u5B57\\\",verb:\\\"\\\\u3067\\\\u3042\\\\u308B\\\"},file:{unit:\\\"\\\\u30D0\\\\u30A4\\\\u30C8\\\",verb:\\\"\\\\u3067\\\\u3042\\\\u308B\\\"},array:{unit:\\\"\\\\u8981\\\\u7D20\\\",verb:\\\"\\\\u3067\\\\u3042\\\\u308B\\\"},set:{unit:\\\"\\\\u8981\\\\u7D20\\\",verb:\\\"\\\\u3067\\\\u3042\\\\u308B\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"\\\\u6570\\\\u5024\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"\\\\u914D\\\\u5217\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"\\\\u5165\\\\u529B\\\\u5024\\\",email:\\\"\\\\u30E1\\\\u30FC\\\\u30EB\\\\u30A2\\\\u30C9\\\\u30EC\\\\u30B9\\\",url:\\\"URL\\\",emoji:\\\"\\\\u7D75\\\\u6587\\\\u5B57\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO\\\\u65E5\\\\u6642\\\",date:\\\"ISO\\\\u65E5\\\\u4ED8\\\",time:\\\"ISO\\\\u6642\\\\u523B\\\",duration:\\\"ISO\\\\u671F\\\\u9593\\\",ipv4:\\\"IPv4\\\\u30A2\\\\u30C9\\\\u30EC\\\\u30B9\\\",ipv6:\\\"IPv6\\\\u30A2\\\\u30C9\\\\u30EC\\\\u30B9\\\",cidrv4:\\\"IPv4\\\\u7BC4\\\\u56F2\\\",cidrv6:\\\"IPv6\\\\u7BC4\\\\u56F2\\\",base64:\\\"base64\\\\u30A8\\\\u30F3\\\\u30B3\\\\u30FC\\\\u30C9\\\\u6587\\\\u5B57\\\\u5217\\\",base64url:\\\"base64url\\\\u30A8\\\\u30F3\\\\u30B3\\\\u30FC\\\\u30C9\\\\u6587\\\\u5B57\\\\u5217\\\",json_string:\\\"JSON\\\\u6587\\\\u5B57\\\\u5217\\\",e164:\\\"E.164\\\\u756A\\\\u53F7\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\u5165\\\\u529B\\\\u5024\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\u7121\\\\u52B9\\\\u306A\\\\u5165\\\\u529B: ${t.expected}\\\\u304C\\\\u671F\\\\u5F85\\\\u3055\\\\u308C\\\\u307E\\\\u3057\\\\u305F\\\\u304C\\\\u3001${n(t.input)}\\\\u304C\\\\u5165\\\\u529B\\\\u3055\\\\u308C\\\\u307E\\\\u3057\\\\u305F`;case\\\"invalid_value\\\":return t.values.length===1?`\\\\u7121\\\\u52B9\\\\u306A\\\\u5165\\\\u529B: ${p(t.values[0])}\\\\u304C\\\\u671F\\\\u5F85\\\\u3055\\\\u308C\\\\u307E\\\\u3057\\\\u305F`:`\\\\u7121\\\\u52B9\\\\u306A\\\\u9078\\\\u629E: ${l(t.values,\\\"\\\\u3001\\\")}\\\\u306E\\\\u3044\\\\u305A\\\\u308C\\\\u304B\\\\u3067\\\\u3042\\\\u308B\\\\u5FC5\\\\u8981\\\\u304C\\\\u3042\\\\u308A\\\\u307E\\\\u3059`;case\\\"too_big\\\":{let i=t.inclusive?\\\"\\\\u4EE5\\\\u4E0B\\\\u3067\\\\u3042\\\\u308B\\\":\\\"\\\\u3088\\\\u308A\\\\u5C0F\\\\u3055\\\\u3044\\\",a=r(t.origin);return a?`\\\\u5927\\\\u304D\\\\u3059\\\\u304E\\\\u308B\\\\u5024: ${t.origin??\\\"\\\\u5024\\\"}\\\\u306F${t.maximum.toString()}${a.unit??\\\"\\\\u8981\\\\u7D20\\\"}${i}\\\\u5FC5\\\\u8981\\\\u304C\\\\u3042\\\\u308A\\\\u307E\\\\u3059`:`\\\\u5927\\\\u304D\\\\u3059\\\\u304E\\\\u308B\\\\u5024: ${t.origin??\\\"\\\\u5024\\\"}\\\\u306F${t.maximum.toString()}${i}\\\\u5FC5\\\\u8981\\\\u304C\\\\u3042\\\\u308A\\\\u307E\\\\u3059`}case\\\"too_small\\\":{let i=t.inclusive?\\\"\\\\u4EE5\\\\u4E0A\\\\u3067\\\\u3042\\\\u308B\\\":\\\"\\\\u3088\\\\u308A\\\\u5927\\\\u304D\\\\u3044\\\",a=r(t.origin);return a?`\\\\u5C0F\\\\u3055\\\\u3059\\\\u304E\\\\u308B\\\\u5024: ${t.origin}\\\\u306F${t.minimum.toString()}${a.unit}${i}\\\\u5FC5\\\\u8981\\\\u304C\\\\u3042\\\\u308A\\\\u307E\\\\u3059`:`\\\\u5C0F\\\\u3055\\\\u3059\\\\u304E\\\\u308B\\\\u5024: ${t.origin}\\\\u306F${t.minimum.toString()}${i}\\\\u5FC5\\\\u8981\\\\u304C\\\\u3042\\\\u308A\\\\u307E\\\\u3059`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`\\\\u7121\\\\u52B9\\\\u306A\\\\u6587\\\\u5B57\\\\u5217: \\\"${i.prefix}\\\"\\\\u3067\\\\u59CB\\\\u307E\\\\u308B\\\\u5FC5\\\\u8981\\\\u304C\\\\u3042\\\\u308A\\\\u307E\\\\u3059`:i.format===\\\"ends_with\\\"?`\\\\u7121\\\\u52B9\\\\u306A\\\\u6587\\\\u5B57\\\\u5217: \\\"${i.suffix}\\\"\\\\u3067\\\\u7D42\\\\u308F\\\\u308B\\\\u5FC5\\\\u8981\\\\u304C\\\\u3042\\\\u308A\\\\u307E\\\\u3059`:i.format===\\\"includes\\\"?`\\\\u7121\\\\u52B9\\\\u306A\\\\u6587\\\\u5B57\\\\u5217: \\\"${i.includes}\\\"\\\\u3092\\\\u542B\\\\u3080\\\\u5FC5\\\\u8981\\\\u304C\\\\u3042\\\\u308A\\\\u307E\\\\u3059`:i.format===\\\"regex\\\"?`\\\\u7121\\\\u52B9\\\\u306A\\\\u6587\\\\u5B57\\\\u5217: \\\\u30D1\\\\u30BF\\\\u30FC\\\\u30F3${i.pattern}\\\\u306B\\\\u4E00\\\\u81F4\\\\u3059\\\\u308B\\\\u5FC5\\\\u8981\\\\u304C\\\\u3042\\\\u308A\\\\u307E\\\\u3059`:`\\\\u7121\\\\u52B9\\\\u306A${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`\\\\u7121\\\\u52B9\\\\u306A\\\\u6570\\\\u5024: ${t.divisor}\\\\u306E\\\\u500D\\\\u6570\\\\u3067\\\\u3042\\\\u308B\\\\u5FC5\\\\u8981\\\\u304C\\\\u3042\\\\u308A\\\\u307E\\\\u3059`;case\\\"unrecognized_keys\\\":return`\\\\u8A8D\\\\u8B58\\\\u3055\\\\u308C\\\\u3066\\\\u3044\\\\u306A\\\\u3044\\\\u30AD\\\\u30FC${t.keys.length>1?\\\"\\\\u7FA4\\\":\\\"\\\"}: ${l(t.keys,\\\"\\\\u3001\\\")}`;case\\\"invalid_key\\\":return`${t.origin}\\\\u5185\\\\u306E\\\\u7121\\\\u52B9\\\\u306A\\\\u30AD\\\\u30FC`;case\\\"invalid_union\\\":return\\\"\\\\u7121\\\\u52B9\\\\u306A\\\\u5165\\\\u529B\\\";case\\\"invalid_element\\\":return`${t.origin}\\\\u5185\\\\u306E\\\\u7121\\\\u52B9\\\\u306A\\\\u5024`;default:return\\\"\\\\u7121\\\\u52B9\\\\u306A\\\\u5165\\\\u529B\\\"}}};function Lu(){return{localeError:Ll()}}var Cl=e=>{let r=typeof e;switch(r){case\\\"number\\\":return Number.isNaN(e)?\\\"NaN\\\":\\\"\\\\u10E0\\\\u10D8\\\\u10EA\\\\u10EE\\\\u10D5\\\\u10D8\\\";case\\\"object\\\":{if(Array.isArray(e))return\\\"\\\\u10DB\\\\u10D0\\\\u10E1\\\\u10D8\\\\u10D5\\\\u10D8\\\";if(e===null)return\\\"null\\\";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return{string:\\\"\\\\u10E1\\\\u10E2\\\\u10E0\\\\u10D8\\\\u10DC\\\\u10D2\\\\u10D8\\\",boolean:\\\"\\\\u10D1\\\\u10E3\\\\u10DA\\\\u10D4\\\\u10D0\\\\u10DC\\\\u10D8\\\",undefined:\\\"undefined\\\",bigint:\\\"bigint\\\",symbol:\\\"symbol\\\",function:\\\"\\\\u10E4\\\\u10E3\\\\u10DC\\\\u10E5\\\\u10EA\\\\u10D8\\\\u10D0\\\"}[r]??r},Vl=()=>{let e={string:{unit:\\\"\\\\u10E1\\\\u10D8\\\\u10DB\\\\u10D1\\\\u10DD\\\\u10DA\\\\u10DD\\\",verb:\\\"\\\\u10E3\\\\u10DC\\\\u10D3\\\\u10D0 \\\\u10E8\\\\u10D4\\\\u10D8\\\\u10EA\\\\u10D0\\\\u10D5\\\\u10D3\\\\u10D4\\\\u10E1\\\"},file:{unit:\\\"\\\\u10D1\\\\u10D0\\\\u10D8\\\\u10E2\\\\u10D8\\\",verb:\\\"\\\\u10E3\\\\u10DC\\\\u10D3\\\\u10D0 \\\\u10E8\\\\u10D4\\\\u10D8\\\\u10EA\\\\u10D0\\\\u10D5\\\\u10D3\\\\u10D4\\\\u10E1\\\"},array:{unit:\\\"\\\\u10D4\\\\u10DA\\\\u10D4\\\\u10DB\\\\u10D4\\\\u10DC\\\\u10E2\\\\u10D8\\\",verb:\\\"\\\\u10E3\\\\u10DC\\\\u10D3\\\\u10D0 \\\\u10E8\\\\u10D4\\\\u10D8\\\\u10EA\\\\u10D0\\\\u10D5\\\\u10D3\\\\u10D4\\\\u10E1\\\"},set:{unit:\\\"\\\\u10D4\\\\u10DA\\\\u10D4\\\\u10DB\\\\u10D4\\\\u10DC\\\\u10E2\\\\u10D8\\\",verb:\\\"\\\\u10E3\\\\u10DC\\\\u10D3\\\\u10D0 \\\\u10E8\\\\u10D4\\\\u10D8\\\\u10EA\\\\u10D0\\\\u10D5\\\\u10D3\\\\u10D4\\\\u10E1\\\"}};function r(o){return e[o]??null}let n={regex:\\\"\\\\u10E8\\\\u10D4\\\\u10E7\\\\u10D5\\\\u10D0\\\\u10DC\\\\u10D0\\\",email:\\\"\\\\u10D4\\\\u10DA-\\\\u10E4\\\\u10DD\\\\u10E1\\\\u10E2\\\\u10D8\\\\u10E1 \\\\u10DB\\\\u10D8\\\\u10E1\\\\u10D0\\\\u10DB\\\\u10D0\\\\u10E0\\\\u10D7\\\\u10D8\\\",url:\\\"URL\\\",emoji:\\\"\\\\u10D4\\\\u10DB\\\\u10DD\\\\u10EF\\\\u10D8\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"\\\\u10D7\\\\u10D0\\\\u10E0\\\\u10D8\\\\u10E6\\\\u10D8-\\\\u10D3\\\\u10E0\\\\u10DD\\\",date:\\\"\\\\u10D7\\\\u10D0\\\\u10E0\\\\u10D8\\\\u10E6\\\\u10D8\\\",time:\\\"\\\\u10D3\\\\u10E0\\\\u10DD\\\",duration:\\\"\\\\u10EE\\\\u10D0\\\\u10DC\\\\u10D2\\\\u10E0\\\\u10EB\\\\u10DA\\\\u10D8\\\\u10D5\\\\u10DD\\\\u10D1\\\\u10D0\\\",ipv4:\\\"IPv4 \\\\u10DB\\\\u10D8\\\\u10E1\\\\u10D0\\\\u10DB\\\\u10D0\\\\u10E0\\\\u10D7\\\\u10D8\\\",ipv6:\\\"IPv6 \\\\u10DB\\\\u10D8\\\\u10E1\\\\u10D0\\\\u10DB\\\\u10D0\\\\u10E0\\\\u10D7\\\\u10D8\\\",cidrv4:\\\"IPv4 \\\\u10D3\\\\u10D8\\\\u10D0\\\\u10DE\\\\u10D0\\\\u10D6\\\\u10DD\\\\u10DC\\\\u10D8\\\",cidrv6:\\\"IPv6 \\\\u10D3\\\\u10D8\\\\u10D0\\\\u10DE\\\\u10D0\\\\u10D6\\\\u10DD\\\\u10DC\\\\u10D8\\\",base64:\\\"base64-\\\\u10D9\\\\u10DD\\\\u10D3\\\\u10D8\\\\u10E0\\\\u10D4\\\\u10D1\\\\u10E3\\\\u10DA\\\\u10D8 \\\\u10E1\\\\u10E2\\\\u10E0\\\\u10D8\\\\u10DC\\\\u10D2\\\\u10D8\\\",base64url:\\\"base64url-\\\\u10D9\\\\u10DD\\\\u10D3\\\\u10D8\\\\u10E0\\\\u10D4\\\\u10D1\\\\u10E3\\\\u10DA\\\\u10D8 \\\\u10E1\\\\u10E2\\\\u10E0\\\\u10D8\\\\u10DC\\\\u10D2\\\\u10D8\\\",json_string:\\\"JSON \\\\u10E1\\\\u10E2\\\\u10E0\\\\u10D8\\\\u10DC\\\\u10D2\\\\u10D8\\\",e164:\\\"E.164 \\\\u10DC\\\\u10DD\\\\u10DB\\\\u10D4\\\\u10E0\\\\u10D8\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\u10E8\\\\u10D4\\\\u10E7\\\\u10D5\\\\u10D0\\\\u10DC\\\\u10D0\\\"};return o=>{switch(o.code){case\\\"invalid_type\\\":return`\\\\u10D0\\\\u10E0\\\\u10D0\\\\u10E1\\\\u10EC\\\\u10DD\\\\u10E0\\\\u10D8 \\\\u10E8\\\\u10D4\\\\u10E7\\\\u10D5\\\\u10D0\\\\u10DC\\\\u10D0: \\\\u10DB\\\\u10DD\\\\u10E1\\\\u10D0\\\\u10DA\\\\u10DD\\\\u10D3\\\\u10DC\\\\u10D4\\\\u10DA\\\\u10D8 ${o.expected}, \\\\u10DB\\\\u10D8\\\\u10E6\\\\u10D4\\\\u10D1\\\\u10E3\\\\u10DA\\\\u10D8 ${Cl(o.input)}`;case\\\"invalid_value\\\":return o.values.length===1?`\\\\u10D0\\\\u10E0\\\\u10D0\\\\u10E1\\\\u10EC\\\\u10DD\\\\u10E0\\\\u10D8 \\\\u10E8\\\\u10D4\\\\u10E7\\\\u10D5\\\\u10D0\\\\u10DC\\\\u10D0: \\\\u10DB\\\\u10DD\\\\u10E1\\\\u10D0\\\\u10DA\\\\u10DD\\\\u10D3\\\\u10DC\\\\u10D4\\\\u10DA\\\\u10D8 ${p(o.values[0])}`:`\\\\u10D0\\\\u10E0\\\\u10D0\\\\u10E1\\\\u10EC\\\\u10DD\\\\u10E0\\\\u10D8 \\\\u10D5\\\\u10D0\\\\u10E0\\\\u10D8\\\\u10D0\\\\u10DC\\\\u10E2\\\\u10D8: \\\\u10DB\\\\u10DD\\\\u10E1\\\\u10D0\\\\u10DA\\\\u10DD\\\\u10D3\\\\u10DC\\\\u10D4\\\\u10DA\\\\u10D8\\\\u10D0 \\\\u10D4\\\\u10E0\\\\u10D7-\\\\u10D4\\\\u10E0\\\\u10D7\\\\u10D8 ${l(o.values,\\\"|\\\")}-\\\\u10D3\\\\u10D0\\\\u10DC`;case\\\"too_big\\\":{let t=o.inclusive?\\\"<=\\\":\\\"<\\\",i=r(o.origin);return i?`\\\\u10D6\\\\u10D4\\\\u10D3\\\\u10DB\\\\u10D4\\\\u10E2\\\\u10D0\\\\u10D3 \\\\u10D3\\\\u10D8\\\\u10D3\\\\u10D8: \\\\u10DB\\\\u10DD\\\\u10E1\\\\u10D0\\\\u10DA\\\\u10DD\\\\u10D3\\\\u10DC\\\\u10D4\\\\u10DA\\\\u10D8 ${o.origin??\\\"\\\\u10DB\\\\u10DC\\\\u10D8\\\\u10E8\\\\u10D5\\\\u10DC\\\\u10D4\\\\u10DA\\\\u10DD\\\\u10D1\\\\u10D0\\\"} ${i.verb} ${t}${o.maximum.toString()} ${i.unit}`:`\\\\u10D6\\\\u10D4\\\\u10D3\\\\u10DB\\\\u10D4\\\\u10E2\\\\u10D0\\\\u10D3 \\\\u10D3\\\\u10D8\\\\u10D3\\\\u10D8: \\\\u10DB\\\\u10DD\\\\u10E1\\\\u10D0\\\\u10DA\\\\u10DD\\\\u10D3\\\\u10DC\\\\u10D4\\\\u10DA\\\\u10D8 ${o.origin??\\\"\\\\u10DB\\\\u10DC\\\\u10D8\\\\u10E8\\\\u10D5\\\\u10DC\\\\u10D4\\\\u10DA\\\\u10DD\\\\u10D1\\\\u10D0\\\"} \\\\u10D8\\\\u10E7\\\\u10DD\\\\u10E1 ${t}${o.maximum.toString()}`}case\\\"too_small\\\":{let t=o.inclusive?\\\">=\\\":\\\">\\\",i=r(o.origin);return i?`\\\\u10D6\\\\u10D4\\\\u10D3\\\\u10DB\\\\u10D4\\\\u10E2\\\\u10D0\\\\u10D3 \\\\u10DE\\\\u10D0\\\\u10E2\\\\u10D0\\\\u10E0\\\\u10D0: \\\\u10DB\\\\u10DD\\\\u10E1\\\\u10D0\\\\u10DA\\\\u10DD\\\\u10D3\\\\u10DC\\\\u10D4\\\\u10DA\\\\u10D8 ${o.origin} ${i.verb} ${t}${o.minimum.toString()} ${i.unit}`:`\\\\u10D6\\\\u10D4\\\\u10D3\\\\u10DB\\\\u10D4\\\\u10E2\\\\u10D0\\\\u10D3 \\\\u10DE\\\\u10D0\\\\u10E2\\\\u10D0\\\\u10E0\\\\u10D0: \\\\u10DB\\\\u10DD\\\\u10E1\\\\u10D0\\\\u10DA\\\\u10DD\\\\u10D3\\\\u10DC\\\\u10D4\\\\u10DA\\\\u10D8 ${o.origin} \\\\u10D8\\\\u10E7\\\\u10DD\\\\u10E1 ${t}${o.minimum.toString()}`}case\\\"invalid_format\\\":{let t=o;return t.format===\\\"starts_with\\\"?`\\\\u10D0\\\\u10E0\\\\u10D0\\\\u10E1\\\\u10EC\\\\u10DD\\\\u10E0\\\\u10D8 \\\\u10E1\\\\u10E2\\\\u10E0\\\\u10D8\\\\u10DC\\\\u10D2\\\\u10D8: \\\\u10E3\\\\u10DC\\\\u10D3\\\\u10D0 \\\\u10D8\\\\u10EC\\\\u10E7\\\\u10D4\\\\u10D1\\\\u10DD\\\\u10D3\\\\u10D4\\\\u10E1 \\\"${t.prefix}\\\"-\\\\u10D8\\\\u10D7`:t.format===\\\"ends_with\\\"?`\\\\u10D0\\\\u10E0\\\\u10D0\\\\u10E1\\\\u10EC\\\\u10DD\\\\u10E0\\\\u10D8 \\\\u10E1\\\\u10E2\\\\u10E0\\\\u10D8\\\\u10DC\\\\u10D2\\\\u10D8: \\\\u10E3\\\\u10DC\\\\u10D3\\\\u10D0 \\\\u10DB\\\\u10D7\\\\u10D0\\\\u10D5\\\\u10E0\\\\u10D3\\\\u10D4\\\\u10D1\\\\u10DD\\\\u10D3\\\\u10D4\\\\u10E1 \\\"${t.suffix}\\\"-\\\\u10D8\\\\u10D7`:t.format===\\\"includes\\\"?`\\\\u10D0\\\\u10E0\\\\u10D0\\\\u10E1\\\\u10EC\\\\u10DD\\\\u10E0\\\\u10D8 \\\\u10E1\\\\u10E2\\\\u10E0\\\\u10D8\\\\u10DC\\\\u10D2\\\\u10D8: \\\\u10E3\\\\u10DC\\\\u10D3\\\\u10D0 \\\\u10E8\\\\u10D4\\\\u10D8\\\\u10EA\\\\u10D0\\\\u10D5\\\\u10D3\\\\u10D4\\\\u10E1 \\\"${t.includes}\\\"-\\\\u10E1`:t.format===\\\"regex\\\"?`\\\\u10D0\\\\u10E0\\\\u10D0\\\\u10E1\\\\u10EC\\\\u10DD\\\\u10E0\\\\u10D8 \\\\u10E1\\\\u10E2\\\\u10E0\\\\u10D8\\\\u10DC\\\\u10D2\\\\u10D8: \\\\u10E3\\\\u10DC\\\\u10D3\\\\u10D0 \\\\u10E8\\\\u10D4\\\\u10D4\\\\u10E1\\\\u10D0\\\\u10D1\\\\u10D0\\\\u10DB\\\\u10D4\\\\u10D1\\\\u10DD\\\\u10D3\\\\u10D4\\\\u10E1 \\\\u10E8\\\\u10D0\\\\u10D1\\\\u10DA\\\\u10DD\\\\u10DC\\\\u10E1 ${t.pattern}`:`\\\\u10D0\\\\u10E0\\\\u10D0\\\\u10E1\\\\u10EC\\\\u10DD\\\\u10E0\\\\u10D8 ${n[t.format]??o.format}`}case\\\"not_multiple_of\\\":return`\\\\u10D0\\\\u10E0\\\\u10D0\\\\u10E1\\\\u10EC\\\\u10DD\\\\u10E0\\\\u10D8 \\\\u10E0\\\\u10D8\\\\u10EA\\\\u10EE\\\\u10D5\\\\u10D8: \\\\u10E3\\\\u10DC\\\\u10D3\\\\u10D0 \\\\u10D8\\\\u10E7\\\\u10DD\\\\u10E1 ${o.divisor}-\\\\u10D8\\\\u10E1 \\\\u10EF\\\\u10D4\\\\u10E0\\\\u10D0\\\\u10D3\\\\u10D8`;case\\\"unrecognized_keys\\\":return`\\\\u10E3\\\\u10EA\\\\u10DC\\\\u10DD\\\\u10D1\\\\u10D8 \\\\u10D2\\\\u10D0\\\\u10E1\\\\u10D0\\\\u10E6\\\\u10D4\\\\u10D1${o.keys.length>1?\\\"\\\\u10D4\\\\u10D1\\\\u10D8\\\":\\\"\\\\u10D8\\\"}: ${l(o.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`\\\\u10D0\\\\u10E0\\\\u10D0\\\\u10E1\\\\u10EC\\\\u10DD\\\\u10E0\\\\u10D8 \\\\u10D2\\\\u10D0\\\\u10E1\\\\u10D0\\\\u10E6\\\\u10D4\\\\u10D1\\\\u10D8 ${o.origin}-\\\\u10E8\\\\u10D8`;case\\\"invalid_union\\\":return\\\"\\\\u10D0\\\\u10E0\\\\u10D0\\\\u10E1\\\\u10EC\\\\u10DD\\\\u10E0\\\\u10D8 \\\\u10E8\\\\u10D4\\\\u10E7\\\\u10D5\\\\u10D0\\\\u10DC\\\\u10D0\\\";case\\\"invalid_element\\\":return`\\\\u10D0\\\\u10E0\\\\u10D0\\\\u10E1\\\\u10EC\\\\u10DD\\\\u10E0\\\\u10D8 \\\\u10DB\\\\u10DC\\\\u10D8\\\\u10E8\\\\u10D5\\\\u10DC\\\\u10D4\\\\u10DA\\\\u10DD\\\\u10D1\\\\u10D0 ${o.origin}-\\\\u10E8\\\\u10D8`;default:return\\\"\\\\u10D0\\\\u10E0\\\\u10D0\\\\u10E1\\\\u10EC\\\\u10DD\\\\u10E0\\\\u10D8 \\\\u10E8\\\\u10D4\\\\u10E7\\\\u10D5\\\\u10D0\\\\u10DC\\\\u10D0\\\"}}};function Cu(){return{localeError:Vl()}}var Fl=()=>{let e={string:{unit:\\\"\\\\u178F\\\\u17BD\\\\u17A2\\\\u1780\\\\u17D2\\\\u179F\\\\u179A\\\",verb:\\\"\\\\u1782\\\\u17BD\\\\u179A\\\\u1798\\\\u17B6\\\\u1793\\\"},file:{unit:\\\"\\\\u1794\\\\u17C3\\\",verb:\\\"\\\\u1782\\\\u17BD\\\\u179A\\\\u1798\\\\u17B6\\\\u1793\\\"},array:{unit:\\\"\\\\u1792\\\\u17B6\\\\u178F\\\\u17BB\\\",verb:\\\"\\\\u1782\\\\u17BD\\\\u179A\\\\u1798\\\\u17B6\\\\u1793\\\"},set:{unit:\\\"\\\\u1792\\\\u17B6\\\\u178F\\\\u17BB\\\",verb:\\\"\\\\u1782\\\\u17BD\\\\u179A\\\\u1798\\\\u17B6\\\\u1793\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"\\\\u1798\\\\u17B7\\\\u1793\\\\u1798\\\\u17C2\\\\u1793\\\\u1787\\\\u17B6\\\\u179B\\\\u17C1\\\\u1781 (NaN)\\\":\\\"\\\\u179B\\\\u17C1\\\\u1781\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"\\\\u17A2\\\\u17B6\\\\u179A\\\\u17C1 (Array)\\\";if(t===null)return\\\"\\\\u1782\\\\u17D2\\\\u1798\\\\u17B6\\\\u1793\\\\u178F\\\\u1798\\\\u17D2\\\\u179B\\\\u17C3 (null)\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"\\\\u1791\\\\u17B7\\\\u1793\\\\u17D2\\\\u1793\\\\u1793\\\\u17D0\\\\u1799\\\\u1794\\\\u1789\\\\u17D2\\\\u1785\\\\u17BC\\\\u179B\\\",email:\\\"\\\\u17A2\\\\u17B6\\\\u179F\\\\u1799\\\\u178A\\\\u17D2\\\\u178B\\\\u17B6\\\\u1793\\\\u17A2\\\\u17CA\\\\u17B8\\\\u1798\\\\u17C2\\\\u179B\\\",url:\\\"URL\\\",emoji:\\\"\\\\u179F\\\\u1789\\\\u17D2\\\\u1789\\\\u17B6\\\\u17A2\\\\u17B6\\\\u179A\\\\u1798\\\\u17D2\\\\u1798\\\\u178E\\\\u17CD\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"\\\\u1780\\\\u17B6\\\\u179B\\\\u1794\\\\u179A\\\\u17B7\\\\u1785\\\\u17D2\\\\u1786\\\\u17C1\\\\u1791 \\\\u1793\\\\u17B7\\\\u1784\\\\u1798\\\\u17C9\\\\u17C4\\\\u1784 ISO\\\",date:\\\"\\\\u1780\\\\u17B6\\\\u179B\\\\u1794\\\\u179A\\\\u17B7\\\\u1785\\\\u17D2\\\\u1786\\\\u17C1\\\\u1791 ISO\\\",time:\\\"\\\\u1798\\\\u17C9\\\\u17C4\\\\u1784 ISO\\\",duration:\\\"\\\\u179A\\\\u1799\\\\u17C8\\\\u1796\\\\u17C1\\\\u179B ISO\\\",ipv4:\\\"\\\\u17A2\\\\u17B6\\\\u179F\\\\u1799\\\\u178A\\\\u17D2\\\\u178B\\\\u17B6\\\\u1793 IPv4\\\",ipv6:\\\"\\\\u17A2\\\\u17B6\\\\u179F\\\\u1799\\\\u178A\\\\u17D2\\\\u178B\\\\u17B6\\\\u1793 IPv6\\\",cidrv4:\\\"\\\\u178A\\\\u17C2\\\\u1793\\\\u17A2\\\\u17B6\\\\u179F\\\\u1799\\\\u178A\\\\u17D2\\\\u178B\\\\u17B6\\\\u1793 IPv4\\\",cidrv6:\\\"\\\\u178A\\\\u17C2\\\\u1793\\\\u17A2\\\\u17B6\\\\u179F\\\\u1799\\\\u178A\\\\u17D2\\\\u178B\\\\u17B6\\\\u1793 IPv6\\\",base64:\\\"\\\\u1781\\\\u17D2\\\\u179F\\\\u17C2\\\\u17A2\\\\u1780\\\\u17D2\\\\u179F\\\\u179A\\\\u17A2\\\\u17CA\\\\u17B7\\\\u1780\\\\u17BC\\\\u178A base64\\\",base64url:\\\"\\\\u1781\\\\u17D2\\\\u179F\\\\u17C2\\\\u17A2\\\\u1780\\\\u17D2\\\\u179F\\\\u179A\\\\u17A2\\\\u17CA\\\\u17B7\\\\u1780\\\\u17BC\\\\u178A base64url\\\",json_string:\\\"\\\\u1781\\\\u17D2\\\\u179F\\\\u17C2\\\\u17A2\\\\u1780\\\\u17D2\\\\u179F\\\\u179A JSON\\\",e164:\\\"\\\\u179B\\\\u17C1\\\\u1781 E.164\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\u1791\\\\u17B7\\\\u1793\\\\u17D2\\\\u1793\\\\u1793\\\\u17D0\\\\u1799\\\\u1794\\\\u1789\\\\u17D2\\\\u1785\\\\u17BC\\\\u179B\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\u1791\\\\u17B7\\\\u1793\\\\u17D2\\\\u1793\\\\u1793\\\\u17D0\\\\u1799\\\\u1794\\\\u1789\\\\u17D2\\\\u1785\\\\u17BC\\\\u179B\\\\u1798\\\\u17B7\\\\u1793\\\\u178F\\\\u17D2\\\\u179A\\\\u17B9\\\\u1798\\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u17D6 \\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u1780\\\\u17B6\\\\u179A ${t.expected} \\\\u1794\\\\u17C9\\\\u17BB\\\\u1793\\\\u17D2\\\\u178F\\\\u17C2\\\\u1791\\\\u1791\\\\u17BD\\\\u179B\\\\u1794\\\\u17B6\\\\u1793 ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`\\\\u1791\\\\u17B7\\\\u1793\\\\u17D2\\\\u1793\\\\u1793\\\\u17D0\\\\u1799\\\\u1794\\\\u1789\\\\u17D2\\\\u1785\\\\u17BC\\\\u179B\\\\u1798\\\\u17B7\\\\u1793\\\\u178F\\\\u17D2\\\\u179A\\\\u17B9\\\\u1798\\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u17D6 \\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u1780\\\\u17B6\\\\u179A ${p(t.values[0])}`:`\\\\u1787\\\\u1798\\\\u17D2\\\\u179A\\\\u17BE\\\\u179F\\\\u1798\\\\u17B7\\\\u1793\\\\u178F\\\\u17D2\\\\u179A\\\\u17B9\\\\u1798\\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u17D6 \\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u1787\\\\u17B6\\\\u1798\\\\u17BD\\\\u1799\\\\u1780\\\\u17D2\\\\u1793\\\\u17BB\\\\u1784\\\\u1785\\\\u17C6\\\\u178E\\\\u17C4\\\\u1798 ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`\\\\u1792\\\\u17C6\\\\u1796\\\\u17C1\\\\u1780\\\\u17D6 \\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u1780\\\\u17B6\\\\u179A ${t.origin??\\\"\\\\u178F\\\\u1798\\\\u17D2\\\\u179B\\\\u17C3\\\"} ${i} ${t.maximum.toString()} ${a.unit??\\\"\\\\u1792\\\\u17B6\\\\u178F\\\\u17BB\\\"}`:`\\\\u1792\\\\u17C6\\\\u1796\\\\u17C1\\\\u1780\\\\u17D6 \\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u1780\\\\u17B6\\\\u179A ${t.origin??\\\"\\\\u178F\\\\u1798\\\\u17D2\\\\u179B\\\\u17C3\\\"} ${i} ${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`\\\\u178F\\\\u17BC\\\\u1785\\\\u1796\\\\u17C1\\\\u1780\\\\u17D6 \\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u1780\\\\u17B6\\\\u179A ${t.origin} ${i} ${t.minimum.toString()} ${a.unit}`:`\\\\u178F\\\\u17BC\\\\u1785\\\\u1796\\\\u17C1\\\\u1780\\\\u17D6 \\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u1780\\\\u17B6\\\\u179A ${t.origin} ${i} ${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`\\\\u1781\\\\u17D2\\\\u179F\\\\u17C2\\\\u17A2\\\\u1780\\\\u17D2\\\\u179F\\\\u179A\\\\u1798\\\\u17B7\\\\u1793\\\\u178F\\\\u17D2\\\\u179A\\\\u17B9\\\\u1798\\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u17D6 \\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u1785\\\\u17B6\\\\u1794\\\\u17CB\\\\u1795\\\\u17D2\\\\u178F\\\\u17BE\\\\u1798\\\\u178A\\\\u17C4\\\\u1799 \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`\\\\u1781\\\\u17D2\\\\u179F\\\\u17C2\\\\u17A2\\\\u1780\\\\u17D2\\\\u179F\\\\u179A\\\\u1798\\\\u17B7\\\\u1793\\\\u178F\\\\u17D2\\\\u179A\\\\u17B9\\\\u1798\\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u17D6 \\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u1794\\\\u1789\\\\u17D2\\\\u1785\\\\u1794\\\\u17CB\\\\u178A\\\\u17C4\\\\u1799 \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`\\\\u1781\\\\u17D2\\\\u179F\\\\u17C2\\\\u17A2\\\\u1780\\\\u17D2\\\\u179F\\\\u179A\\\\u1798\\\\u17B7\\\\u1793\\\\u178F\\\\u17D2\\\\u179A\\\\u17B9\\\\u1798\\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u17D6 \\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u1798\\\\u17B6\\\\u1793 \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`\\\\u1781\\\\u17D2\\\\u179F\\\\u17C2\\\\u17A2\\\\u1780\\\\u17D2\\\\u179F\\\\u179A\\\\u1798\\\\u17B7\\\\u1793\\\\u178F\\\\u17D2\\\\u179A\\\\u17B9\\\\u1798\\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u17D6 \\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u178F\\\\u17C2\\\\u1795\\\\u17D2\\\\u1782\\\\u17BC\\\\u1795\\\\u17D2\\\\u1782\\\\u1784\\\\u1793\\\\u17B9\\\\u1784\\\\u1791\\\\u1798\\\\u17D2\\\\u179A\\\\u1784\\\\u17CB\\\\u178A\\\\u17C2\\\\u179B\\\\u1794\\\\u17B6\\\\u1793\\\\u1780\\\\u17C6\\\\u178E\\\\u178F\\\\u17CB ${i.pattern}`:`\\\\u1798\\\\u17B7\\\\u1793\\\\u178F\\\\u17D2\\\\u179A\\\\u17B9\\\\u1798\\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u17D6 ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`\\\\u179B\\\\u17C1\\\\u1781\\\\u1798\\\\u17B7\\\\u1793\\\\u178F\\\\u17D2\\\\u179A\\\\u17B9\\\\u1798\\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u17D6 \\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u178F\\\\u17C2\\\\u1787\\\\u17B6\\\\u1796\\\\u17A0\\\\u17BB\\\\u1782\\\\u17BB\\\\u178E\\\\u1793\\\\u17C3 ${t.divisor}`;case\\\"unrecognized_keys\\\":return`\\\\u179A\\\\u1780\\\\u1783\\\\u17BE\\\\u1789\\\\u179F\\\\u17C4\\\\u1798\\\\u17B7\\\\u1793\\\\u179F\\\\u17D2\\\\u1782\\\\u17B6\\\\u179B\\\\u17CB\\\\u17D6 ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`\\\\u179F\\\\u17C4\\\\u1798\\\\u17B7\\\\u1793\\\\u178F\\\\u17D2\\\\u179A\\\\u17B9\\\\u1798\\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u1793\\\\u17C5\\\\u1780\\\\u17D2\\\\u1793\\\\u17BB\\\\u1784 ${t.origin}`;case\\\"invalid_union\\\":return\\\"\\\\u1791\\\\u17B7\\\\u1793\\\\u17D2\\\\u1793\\\\u1793\\\\u17D0\\\\u1799\\\\u1798\\\\u17B7\\\\u1793\\\\u178F\\\\u17D2\\\\u179A\\\\u17B9\\\\u1798\\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\";case\\\"invalid_element\\\":return`\\\\u1791\\\\u17B7\\\\u1793\\\\u17D2\\\\u1793\\\\u1793\\\\u17D0\\\\u1799\\\\u1798\\\\u17B7\\\\u1793\\\\u178F\\\\u17D2\\\\u179A\\\\u17B9\\\\u1798\\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\\u1793\\\\u17C5\\\\u1780\\\\u17D2\\\\u1793\\\\u17BB\\\\u1784 ${t.origin}`;default:return\\\"\\\\u1791\\\\u17B7\\\\u1793\\\\u17D2\\\\u1793\\\\u1793\\\\u17D0\\\\u1799\\\\u1798\\\\u17B7\\\\u1793\\\\u178F\\\\u17D2\\\\u179A\\\\u17B9\\\\u1798\\\\u178F\\\\u17D2\\\\u179A\\\\u17BC\\\\u179C\\\"}}};function qt(){return{localeError:Fl()}}function Vu(){return qt()}var Jl=()=>{let e={string:{unit:\\\"\\\\uBB38\\\\uC790\\\",verb:\\\"to have\\\"},file:{unit:\\\"\\\\uBC14\\\\uC774\\\\uD2B8\\\",verb:\\\"to have\\\"},array:{unit:\\\"\\\\uAC1C\\\",verb:\\\"to have\\\"},set:{unit:\\\"\\\\uAC1C\\\",verb:\\\"to have\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"number\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"array\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"\\\\uC785\\\\uB825\\\",email:\\\"\\\\uC774\\\\uBA54\\\\uC77C \\\\uC8FC\\\\uC18C\\\",url:\\\"URL\\\",emoji:\\\"\\\\uC774\\\\uBAA8\\\\uC9C0\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO \\\\uB0A0\\\\uC9DC\\\\uC2DC\\\\uAC04\\\",date:\\\"ISO \\\\uB0A0\\\\uC9DC\\\",time:\\\"ISO \\\\uC2DC\\\\uAC04\\\",duration:\\\"ISO \\\\uAE30\\\\uAC04\\\",ipv4:\\\"IPv4 \\\\uC8FC\\\\uC18C\\\",ipv6:\\\"IPv6 \\\\uC8FC\\\\uC18C\\\",cidrv4:\\\"IPv4 \\\\uBC94\\\\uC704\\\",cidrv6:\\\"IPv6 \\\\uBC94\\\\uC704\\\",base64:\\\"base64 \\\\uC778\\\\uCF54\\\\uB529 \\\\uBB38\\\\uC790\\\\uC5F4\\\",base64url:\\\"base64url \\\\uC778\\\\uCF54\\\\uB529 \\\\uBB38\\\\uC790\\\\uC5F4\\\",json_string:\\\"JSON \\\\uBB38\\\\uC790\\\\uC5F4\\\",e164:\\\"E.164 \\\\uBC88\\\\uD638\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\uC785\\\\uB825\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\uC798\\\\uBABB\\\\uB41C \\\\uC785\\\\uB825: \\\\uC608\\\\uC0C1 \\\\uD0C0\\\\uC785\\\\uC740 ${t.expected}, \\\\uBC1B\\\\uC740 \\\\uD0C0\\\\uC785\\\\uC740 ${n(t.input)}\\\\uC785\\\\uB2C8\\\\uB2E4`;case\\\"invalid_value\\\":return t.values.length===1?`\\\\uC798\\\\uBABB\\\\uB41C \\\\uC785\\\\uB825: \\\\uAC12\\\\uC740 ${p(t.values[0])} \\\\uC774\\\\uC5B4\\\\uC57C \\\\uD569\\\\uB2C8\\\\uB2E4`:`\\\\uC798\\\\uBABB\\\\uB41C \\\\uC635\\\\uC158: ${l(t.values,\\\"\\\\uB610\\\\uB294 \\\")} \\\\uC911 \\\\uD558\\\\uB098\\\\uC5EC\\\\uC57C \\\\uD569\\\\uB2C8\\\\uB2E4`;case\\\"too_big\\\":{let i=t.inclusive?\\\"\\\\uC774\\\\uD558\\\":\\\"\\\\uBBF8\\\\uB9CC\\\",a=i===\\\"\\\\uBBF8\\\\uB9CC\\\"?\\\"\\\\uC774\\\\uC5B4\\\\uC57C \\\\uD569\\\\uB2C8\\\\uB2E4\\\":\\\"\\\\uC5EC\\\\uC57C \\\\uD569\\\\uB2C8\\\\uB2E4\\\",u=r(t.origin),s=u?.unit??\\\"\\\\uC694\\\\uC18C\\\";return u?`${t.origin??\\\"\\\\uAC12\\\"}\\\\uC774 \\\\uB108\\\\uBB34 \\\\uD07D\\\\uB2C8\\\\uB2E4: ${t.maximum.toString()}${s} ${i}${a}`:`${t.origin??\\\"\\\\uAC12\\\"}\\\\uC774 \\\\uB108\\\\uBB34 \\\\uD07D\\\\uB2C8\\\\uB2E4: ${t.maximum.toString()} ${i}${a}`}case\\\"too_small\\\":{let i=t.inclusive?\\\"\\\\uC774\\\\uC0C1\\\":\\\"\\\\uCD08\\\\uACFC\\\",a=i===\\\"\\\\uC774\\\\uC0C1\\\"?\\\"\\\\uC774\\\\uC5B4\\\\uC57C \\\\uD569\\\\uB2C8\\\\uB2E4\\\":\\\"\\\\uC5EC\\\\uC57C \\\\uD569\\\\uB2C8\\\\uB2E4\\\",u=r(t.origin),s=u?.unit??\\\"\\\\uC694\\\\uC18C\\\";return u?`${t.origin??\\\"\\\\uAC12\\\"}\\\\uC774 \\\\uB108\\\\uBB34 \\\\uC791\\\\uC2B5\\\\uB2C8\\\\uB2E4: ${t.minimum.toString()}${s} ${i}${a}`:`${t.origin??\\\"\\\\uAC12\\\"}\\\\uC774 \\\\uB108\\\\uBB34 \\\\uC791\\\\uC2B5\\\\uB2C8\\\\uB2E4: ${t.minimum.toString()} ${i}${a}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`\\\\uC798\\\\uBABB\\\\uB41C \\\\uBB38\\\\uC790\\\\uC5F4: \\\"${i.prefix}\\\"(\\\\uC73C)\\\\uB85C \\\\uC2DC\\\\uC791\\\\uD574\\\\uC57C \\\\uD569\\\\uB2C8\\\\uB2E4`:i.format===\\\"ends_with\\\"?`\\\\uC798\\\\uBABB\\\\uB41C \\\\uBB38\\\\uC790\\\\uC5F4: \\\"${i.suffix}\\\"(\\\\uC73C)\\\\uB85C \\\\uB05D\\\\uB098\\\\uC57C \\\\uD569\\\\uB2C8\\\\uB2E4`:i.format===\\\"includes\\\"?`\\\\uC798\\\\uBABB\\\\uB41C \\\\uBB38\\\\uC790\\\\uC5F4: \\\"${i.includes}\\\"\\\\uC744(\\\\uB97C) \\\\uD3EC\\\\uD568\\\\uD574\\\\uC57C \\\\uD569\\\\uB2C8\\\\uB2E4`:i.format===\\\"regex\\\"?`\\\\uC798\\\\uBABB\\\\uB41C \\\\uBB38\\\\uC790\\\\uC5F4: \\\\uC815\\\\uADDC\\\\uC2DD ${i.pattern} \\\\uD328\\\\uD134\\\\uACFC \\\\uC77C\\\\uCE58\\\\uD574\\\\uC57C \\\\uD569\\\\uB2C8\\\\uB2E4`:`\\\\uC798\\\\uBABB\\\\uB41C ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`\\\\uC798\\\\uBABB\\\\uB41C \\\\uC22B\\\\uC790: ${t.divisor}\\\\uC758 \\\\uBC30\\\\uC218\\\\uC5EC\\\\uC57C \\\\uD569\\\\uB2C8\\\\uB2E4`;case\\\"unrecognized_keys\\\":return`\\\\uC778\\\\uC2DD\\\\uD560 \\\\uC218 \\\\uC5C6\\\\uB294 \\\\uD0A4: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`\\\\uC798\\\\uBABB\\\\uB41C \\\\uD0A4: ${t.origin}`;case\\\"invalid_union\\\":return\\\"\\\\uC798\\\\uBABB\\\\uB41C \\\\uC785\\\\uB825\\\";case\\\"invalid_element\\\":return`\\\\uC798\\\\uBABB\\\\uB41C \\\\uAC12: ${t.origin}`;default:return\\\"\\\\uC798\\\\uBABB\\\\uB41C \\\\uC785\\\\uB825\\\"}}};function Fu(){return{localeError:Jl()}}var Ml=e=>et(typeof e,e),et=(e,r=void 0)=>{switch(e){case\\\"number\\\":return Number.isNaN(r)?\\\"NaN\\\":\\\"skai\\\\u010Dius\\\";case\\\"bigint\\\":return\\\"sveikasis skai\\\\u010Dius\\\";case\\\"string\\\":return\\\"eilut\\\\u0117\\\";case\\\"boolean\\\":return\\\"login\\\\u0117 reik\\\\u0161m\\\\u0117\\\";case\\\"undefined\\\":case\\\"void\\\":return\\\"neapibr\\\\u0117\\\\u017Eta reik\\\\u0161m\\\\u0117\\\";case\\\"function\\\":return\\\"funkcija\\\";case\\\"symbol\\\":return\\\"simbolis\\\";case\\\"object\\\":return r===void 0?\\\"ne\\\\u017Einomas objektas\\\":r===null?\\\"nulin\\\\u0117 reik\\\\u0161m\\\\u0117\\\":Array.isArray(r)?\\\"masyvas\\\":Object.getPrototypeOf(r)!==Object.prototype&&r.constructor?r.constructor.name:\\\"objektas\\\";case\\\"null\\\":return\\\"nulin\\\\u0117 reik\\\\u0161m\\\\u0117\\\"}return e},He=e=>e.charAt(0).toUpperCase()+e.slice(1);function Ju(e){let r=Math.abs(e),n=r%10,o=r%100;return o>=11&&o<=19||n===0?\\\"many\\\":n===1?\\\"one\\\":\\\"few\\\"}var Bl=()=>{let e={string:{unit:{one:\\\"simbolis\\\",few:\\\"simboliai\\\",many:\\\"simboli\\\\u0173\\\"},verb:{smaller:{inclusive:\\\"turi b\\\\u016Bti ne ilgesn\\\\u0117 kaip\\\",notInclusive:\\\"turi b\\\\u016Bti trumpesn\\\\u0117 kaip\\\"},bigger:{inclusive:\\\"turi b\\\\u016Bti ne trumpesn\\\\u0117 kaip\\\",notInclusive:\\\"turi b\\\\u016Bti ilgesn\\\\u0117 kaip\\\"}}},file:{unit:{one:\\\"baitas\\\",few:\\\"baitai\\\",many:\\\"bait\\\\u0173\\\"},verb:{smaller:{inclusive:\\\"turi b\\\\u016Bti ne didesnis kaip\\\",notInclusive:\\\"turi b\\\\u016Bti ma\\\\u017Eesnis kaip\\\"},bigger:{inclusive:\\\"turi b\\\\u016Bti ne ma\\\\u017Eesnis kaip\\\",notInclusive:\\\"turi b\\\\u016Bti didesnis kaip\\\"}}},array:{unit:{one:\\\"element\\\\u0105\\\",few:\\\"elementus\\\",many:\\\"element\\\\u0173\\\"},verb:{smaller:{inclusive:\\\"turi tur\\\\u0117ti ne daugiau kaip\\\",notInclusive:\\\"turi tur\\\\u0117ti ma\\\\u017Eiau kaip\\\"},bigger:{inclusive:\\\"turi tur\\\\u0117ti ne ma\\\\u017Eiau kaip\\\",notInclusive:\\\"turi tur\\\\u0117ti daugiau kaip\\\"}}},set:{unit:{one:\\\"element\\\\u0105\\\",few:\\\"elementus\\\",many:\\\"element\\\\u0173\\\"},verb:{smaller:{inclusive:\\\"turi tur\\\\u0117ti ne daugiau kaip\\\",notInclusive:\\\"turi tur\\\\u0117ti ma\\\\u017Eiau kaip\\\"},bigger:{inclusive:\\\"turi tur\\\\u0117ti ne ma\\\\u017Eiau kaip\\\",notInclusive:\\\"turi tur\\\\u0117ti daugiau kaip\\\"}}}};function r(o,t,i,a){let u=e[o]??null;return u===null?u:{unit:u.unit[t],verb:u.verb[a][i?\\\"inclusive\\\":\\\"notInclusive\\\"]}}let n={regex:\\\"\\\\u012Fvestis\\\",email:\\\"el. pa\\\\u0161to adresas\\\",url:\\\"URL\\\",emoji:\\\"jaustukas\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO data ir laikas\\\",date:\\\"ISO data\\\",time:\\\"ISO laikas\\\",duration:\\\"ISO trukm\\\\u0117\\\",ipv4:\\\"IPv4 adresas\\\",ipv6:\\\"IPv6 adresas\\\",cidrv4:\\\"IPv4 tinklo prefiksas (CIDR)\\\",cidrv6:\\\"IPv6 tinklo prefiksas (CIDR)\\\",base64:\\\"base64 u\\\\u017Ekoduota eilut\\\\u0117\\\",base64url:\\\"base64url u\\\\u017Ekoduota eilut\\\\u0117\\\",json_string:\\\"JSON eilut\\\\u0117\\\",e164:\\\"E.164 numeris\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\u012Fvestis\\\"};return o=>{switch(o.code){case\\\"invalid_type\\\":return`Gautas tipas ${Ml(o.input)}, o tik\\\\u0117tasi - ${et(o.expected)}`;case\\\"invalid_value\\\":return o.values.length===1?`Privalo b\\\\u016Bti ${p(o.values[0])}`:`Privalo b\\\\u016Bti vienas i\\\\u0161 ${l(o.values,\\\"|\\\")} pasirinkim\\\\u0173`;case\\\"too_big\\\":{let t=et(o.origin),i=r(o.origin,Ju(Number(o.maximum)),o.inclusive??!1,\\\"smaller\\\");if(i?.verb)return`${He(t??o.origin??\\\"reik\\\\u0161m\\\\u0117\\\")} ${i.verb} ${o.maximum.toString()} ${i.unit??\\\"element\\\\u0173\\\"}`;let a=o.inclusive?\\\"ne didesnis kaip\\\":\\\"ma\\\\u017Eesnis kaip\\\";return`${He(t??o.origin??\\\"reik\\\\u0161m\\\\u0117\\\")} turi b\\\\u016Bti ${a} ${o.maximum.toString()} ${i?.unit}`}case\\\"too_small\\\":{let t=et(o.origin),i=r(o.origin,Ju(Number(o.minimum)),o.inclusive??!1,\\\"bigger\\\");if(i?.verb)return`${He(t??o.origin??\\\"reik\\\\u0161m\\\\u0117\\\")} ${i.verb} ${o.minimum.toString()} ${i.unit??\\\"element\\\\u0173\\\"}`;let a=o.inclusive?\\\"ne ma\\\\u017Eesnis kaip\\\":\\\"didesnis kaip\\\";return`${He(t??o.origin??\\\"reik\\\\u0161m\\\\u0117\\\")} turi b\\\\u016Bti ${a} ${o.minimum.toString()} ${i?.unit}`}case\\\"invalid_format\\\":{let t=o;return t.format===\\\"starts_with\\\"?`Eilut\\\\u0117 privalo prasid\\\\u0117ti \\\"${t.prefix}\\\"`:t.format===\\\"ends_with\\\"?`Eilut\\\\u0117 privalo pasibaigti \\\"${t.suffix}\\\"`:t.format===\\\"includes\\\"?`Eilut\\\\u0117 privalo \\\\u012Ftraukti \\\"${t.includes}\\\"`:t.format===\\\"regex\\\"?`Eilut\\\\u0117 privalo atitikti ${t.pattern}`:`Neteisingas ${n[t.format]??o.format}`}case\\\"not_multiple_of\\\":return`Skai\\\\u010Dius privalo b\\\\u016Bti ${o.divisor} kartotinis.`;case\\\"unrecognized_keys\\\":return`Neatpa\\\\u017Eint${o.keys.length>1?\\\"i\\\":\\\"as\\\"} rakt${o.keys.length>1?\\\"ai\\\":\\\"as\\\"}: ${l(o.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return\\\"Rastas klaidingas raktas\\\";case\\\"invalid_union\\\":return\\\"Klaidinga \\\\u012Fvestis\\\";case\\\"invalid_element\\\":{let t=et(o.origin);return`${He(t??o.origin??\\\"reik\\\\u0161m\\\\u0117\\\")} turi klaiding\\\\u0105 \\\\u012Fvest\\\\u012F`}default:return\\\"Klaidinga \\\\u012Fvestis\\\"}}};function Mu(){return{localeError:Bl()}}var Kl=()=>{let e={string:{unit:\\\"\\\\u0437\\\\u043D\\\\u0430\\\\u0446\\\\u0438\\\",verb:\\\"\\\\u0434\\\\u0430 \\\\u0438\\\\u043C\\\\u0430\\\\u0430\\\\u0442\\\"},file:{unit:\\\"\\\\u0431\\\\u0430\\\\u0458\\\\u0442\\\\u0438\\\",verb:\\\"\\\\u0434\\\\u0430 \\\\u0438\\\\u043C\\\\u0430\\\\u0430\\\\u0442\\\"},array:{unit:\\\"\\\\u0441\\\\u0442\\\\u0430\\\\u0432\\\\u043A\\\\u0438\\\",verb:\\\"\\\\u0434\\\\u0430 \\\\u0438\\\\u043C\\\\u0430\\\\u0430\\\\u0442\\\"},set:{unit:\\\"\\\\u0441\\\\u0442\\\\u0430\\\\u0432\\\\u043A\\\\u0438\\\",verb:\\\"\\\\u0434\\\\u0430 \\\\u0438\\\\u043C\\\\u0430\\\\u0430\\\\u0442\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"\\\\u0431\\\\u0440\\\\u043E\\\\u0458\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"\\\\u043D\\\\u0438\\\\u0437\\\\u0430\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"\\\\u0432\\\\u043D\\\\u0435\\\\u0441\\\",email:\\\"\\\\u0430\\\\u0434\\\\u0440\\\\u0435\\\\u0441\\\\u0430 \\\\u043D\\\\u0430 \\\\u0435-\\\\u043F\\\\u043E\\\\u0448\\\\u0442\\\\u0430\\\",url:\\\"URL\\\",emoji:\\\"\\\\u0435\\\\u043C\\\\u043E\\\\u045F\\\\u0438\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO \\\\u0434\\\\u0430\\\\u0442\\\\u0443\\\\u043C \\\\u0438 \\\\u0432\\\\u0440\\\\u0435\\\\u043C\\\\u0435\\\",date:\\\"ISO \\\\u0434\\\\u0430\\\\u0442\\\\u0443\\\\u043C\\\",time:\\\"ISO \\\\u0432\\\\u0440\\\\u0435\\\\u043C\\\\u0435\\\",duration:\\\"ISO \\\\u0432\\\\u0440\\\\u0435\\\\u043C\\\\u0435\\\\u0442\\\\u0440\\\\u0430\\\\u0435\\\\u045A\\\\u0435\\\",ipv4:\\\"IPv4 \\\\u0430\\\\u0434\\\\u0440\\\\u0435\\\\u0441\\\\u0430\\\",ipv6:\\\"IPv6 \\\\u0430\\\\u0434\\\\u0440\\\\u0435\\\\u0441\\\\u0430\\\",cidrv4:\\\"IPv4 \\\\u043E\\\\u043F\\\\u0441\\\\u0435\\\\u0433\\\",cidrv6:\\\"IPv6 \\\\u043E\\\\u043F\\\\u0441\\\\u0435\\\\u0433\\\",base64:\\\"base64-\\\\u0435\\\\u043D\\\\u043A\\\\u043E\\\\u0434\\\\u0438\\\\u0440\\\\u0430\\\\u043D\\\\u0430 \\\\u043D\\\\u0438\\\\u0437\\\\u0430\\\",base64url:\\\"base64url-\\\\u0435\\\\u043D\\\\u043A\\\\u043E\\\\u0434\\\\u0438\\\\u0440\\\\u0430\\\\u043D\\\\u0430 \\\\u043D\\\\u0438\\\\u0437\\\\u0430\\\",json_string:\\\"JSON \\\\u043D\\\\u0438\\\\u0437\\\\u0430\\\",e164:\\\"E.164 \\\\u0431\\\\u0440\\\\u043E\\\\u0458\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\u0432\\\\u043D\\\\u0435\\\\u0441\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\u0413\\\\u0440\\\\u0435\\\\u0448\\\\u0435\\\\u043D \\\\u0432\\\\u043D\\\\u0435\\\\u0441: \\\\u0441\\\\u0435 \\\\u043E\\\\u0447\\\\u0435\\\\u043A\\\\u0443\\\\u0432\\\\u0430 ${t.expected}, \\\\u043F\\\\u0440\\\\u0438\\\\u043C\\\\u0435\\\\u043D\\\\u043E ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`Invalid input: expected ${p(t.values[0])}`:`\\\\u0413\\\\u0440\\\\u0435\\\\u0448\\\\u0430\\\\u043D\\\\u0430 \\\\u043E\\\\u043F\\\\u0446\\\\u0438\\\\u0458\\\\u0430: \\\\u0441\\\\u0435 \\\\u043E\\\\u0447\\\\u0435\\\\u043A\\\\u0443\\\\u0432\\\\u0430 \\\\u0435\\\\u0434\\\\u043D\\\\u0430 ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`\\\\u041F\\\\u0440\\\\u0435\\\\u043C\\\\u043D\\\\u043E\\\\u0433\\\\u0443 \\\\u0433\\\\u043E\\\\u043B\\\\u0435\\\\u043C: \\\\u0441\\\\u0435 \\\\u043E\\\\u0447\\\\u0435\\\\u043A\\\\u0443\\\\u0432\\\\u0430 ${t.origin??\\\"\\\\u0432\\\\u0440\\\\u0435\\\\u0434\\\\u043D\\\\u043E\\\\u0441\\\\u0442\\\\u0430\\\"} \\\\u0434\\\\u0430 \\\\u0438\\\\u043C\\\\u0430 ${i}${t.maximum.toString()} ${a.unit??\\\"\\\\u0435\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\\u0438\\\"}`:`\\\\u041F\\\\u0440\\\\u0435\\\\u043C\\\\u043D\\\\u043E\\\\u0433\\\\u0443 \\\\u0433\\\\u043E\\\\u043B\\\\u0435\\\\u043C: \\\\u0441\\\\u0435 \\\\u043E\\\\u0447\\\\u0435\\\\u043A\\\\u0443\\\\u0432\\\\u0430 ${t.origin??\\\"\\\\u0432\\\\u0440\\\\u0435\\\\u0434\\\\u043D\\\\u043E\\\\u0441\\\\u0442\\\\u0430\\\"} \\\\u0434\\\\u0430 \\\\u0431\\\\u0438\\\\u0434\\\\u0435 ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`\\\\u041F\\\\u0440\\\\u0435\\\\u043C\\\\u043D\\\\u043E\\\\u0433\\\\u0443 \\\\u043C\\\\u0430\\\\u043B: \\\\u0441\\\\u0435 \\\\u043E\\\\u0447\\\\u0435\\\\u043A\\\\u0443\\\\u0432\\\\u0430 ${t.origin} \\\\u0434\\\\u0430 \\\\u0438\\\\u043C\\\\u0430 ${i}${t.minimum.toString()} ${a.unit}`:`\\\\u041F\\\\u0440\\\\u0435\\\\u043C\\\\u043D\\\\u043E\\\\u0433\\\\u0443 \\\\u043C\\\\u0430\\\\u043B: \\\\u0441\\\\u0435 \\\\u043E\\\\u0447\\\\u0435\\\\u043A\\\\u0443\\\\u0432\\\\u0430 ${t.origin} \\\\u0434\\\\u0430 \\\\u0431\\\\u0438\\\\u0434\\\\u0435 ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u0436\\\\u0435\\\\u0447\\\\u043A\\\\u0430 \\\\u043D\\\\u0438\\\\u0437\\\\u0430: \\\\u043C\\\\u043E\\\\u0440\\\\u0430 \\\\u0434\\\\u0430 \\\\u0437\\\\u0430\\\\u043F\\\\u043E\\\\u0447\\\\u043D\\\\u0443\\\\u0432\\\\u0430 \\\\u0441\\\\u043E \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u0436\\\\u0435\\\\u0447\\\\u043A\\\\u0430 \\\\u043D\\\\u0438\\\\u0437\\\\u0430: \\\\u043C\\\\u043E\\\\u0440\\\\u0430 \\\\u0434\\\\u0430 \\\\u0437\\\\u0430\\\\u0432\\\\u0440\\\\u0448\\\\u0443\\\\u0432\\\\u0430 \\\\u0441\\\\u043E \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u0436\\\\u0435\\\\u0447\\\\u043A\\\\u0430 \\\\u043D\\\\u0438\\\\u0437\\\\u0430: \\\\u043C\\\\u043E\\\\u0440\\\\u0430 \\\\u0434\\\\u0430 \\\\u0432\\\\u043A\\\\u043B\\\\u0443\\\\u0447\\\\u0443\\\\u0432\\\\u0430 \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`\\\\u041D\\\\u0435\\\\u0432\\\\u0430\\\\u0436\\\\u0435\\\\u0447\\\\u043A\\\\u0430 \\\\u043D\\\\u0438\\\\u0437\\\\u0430: \\\\u043C\\\\u043E\\\\u0440\\\\u0430 \\\\u0434\\\\u0430 \\\\u043E\\\\u0434\\\\u0433\\\\u043E\\\\u0430\\\\u0440\\\\u0430 \\\\u043D\\\\u0430 \\\\u043F\\\\u0430\\\\u0442\\\\u0435\\\\u0440\\\\u043D\\\\u043E\\\\u0442 ${i.pattern}`:`Invalid ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`\\\\u0413\\\\u0440\\\\u0435\\\\u0448\\\\u0435\\\\u043D \\\\u0431\\\\u0440\\\\u043E\\\\u0458: \\\\u043C\\\\u043E\\\\u0440\\\\u0430 \\\\u0434\\\\u0430 \\\\u0431\\\\u0438\\\\u0434\\\\u0435 \\\\u0434\\\\u0435\\\\u043B\\\\u0438\\\\u0432 \\\\u0441\\\\u043E ${t.divisor}`;case\\\"unrecognized_keys\\\":return`${t.keys.length>1?\\\"\\\\u041D\\\\u0435\\\\u043F\\\\u0440\\\\u0435\\\\u043F\\\\u043E\\\\u0437\\\\u043D\\\\u0430\\\\u0435\\\\u043D\\\\u0438 \\\\u043A\\\\u043B\\\\u0443\\\\u0447\\\\u0435\\\\u0432\\\\u0438\\\":\\\"\\\\u041D\\\\u0435\\\\u043F\\\\u0440\\\\u0435\\\\u043F\\\\u043E\\\\u0437\\\\u043D\\\\u0430\\\\u0435\\\\u043D \\\\u043A\\\\u043B\\\\u0443\\\\u0447\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`\\\\u0413\\\\u0440\\\\u0435\\\\u0448\\\\u0435\\\\u043D \\\\u043A\\\\u043B\\\\u0443\\\\u0447 \\\\u0432\\\\u043E ${t.origin}`;case\\\"invalid_union\\\":return\\\"\\\\u0413\\\\u0440\\\\u0435\\\\u0448\\\\u0435\\\\u043D \\\\u0432\\\\u043D\\\\u0435\\\\u0441\\\";case\\\"invalid_element\\\":return`\\\\u0413\\\\u0440\\\\u0435\\\\u0448\\\\u043D\\\\u0430 \\\\u0432\\\\u0440\\\\u0435\\\\u0434\\\\u043D\\\\u043E\\\\u0441\\\\u0442 \\\\u0432\\\\u043E ${t.origin}`;default:return\\\"\\\\u0413\\\\u0440\\\\u0435\\\\u0448\\\\u0435\\\\u043D \\\\u0432\\\\u043D\\\\u0435\\\\u0441\\\"}}};function Bu(){return{localeError:Kl()}}var Gl=()=>{let e={string:{unit:\\\"aksara\\\",verb:\\\"mempunyai\\\"},file:{unit:\\\"bait\\\",verb:\\\"mempunyai\\\"},array:{unit:\\\"elemen\\\",verb:\\\"mempunyai\\\"},set:{unit:\\\"elemen\\\",verb:\\\"mempunyai\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"nombor\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"array\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"input\\\",email:\\\"alamat e-mel\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"tarikh masa ISO\\\",date:\\\"tarikh ISO\\\",time:\\\"masa ISO\\\",duration:\\\"tempoh ISO\\\",ipv4:\\\"alamat IPv4\\\",ipv6:\\\"alamat IPv6\\\",cidrv4:\\\"julat IPv4\\\",cidrv6:\\\"julat IPv6\\\",base64:\\\"string dikodkan base64\\\",base64url:\\\"string dikodkan base64url\\\",json_string:\\\"string JSON\\\",e164:\\\"nombor E.164\\\",jwt:\\\"JWT\\\",template_literal:\\\"input\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`Input tidak sah: dijangka ${t.expected}, diterima ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`Input tidak sah: dijangka ${p(t.values[0])}`:`Pilihan tidak sah: dijangka salah satu daripada ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`Terlalu besar: dijangka ${t.origin??\\\"nilai\\\"} ${a.verb} ${i}${t.maximum.toString()} ${a.unit??\\\"elemen\\\"}`:`Terlalu besar: dijangka ${t.origin??\\\"nilai\\\"} adalah ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`Terlalu kecil: dijangka ${t.origin} ${a.verb} ${i}${t.minimum.toString()} ${a.unit}`:`Terlalu kecil: dijangka ${t.origin} adalah ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`String tidak sah: mesti bermula dengan \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`String tidak sah: mesti berakhir dengan \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`String tidak sah: mesti mengandungi \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`String tidak sah: mesti sepadan dengan corak ${i.pattern}`:`${o[i.format]??t.format} tidak sah`}case\\\"not_multiple_of\\\":return`Nombor tidak sah: perlu gandaan ${t.divisor}`;case\\\"unrecognized_keys\\\":return`Kunci tidak dikenali: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Kunci tidak sah dalam ${t.origin}`;case\\\"invalid_union\\\":return\\\"Input tidak sah\\\";case\\\"invalid_element\\\":return`Nilai tidak sah dalam ${t.origin}`;default:return\\\"Input tidak sah\\\"}}};function Ku(){return{localeError:Gl()}}var Wl=()=>{let e={string:{unit:\\\"tekens\\\"},file:{unit:\\\"bytes\\\"},array:{unit:\\\"elementen\\\"},set:{unit:\\\"elementen\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"getal\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"array\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"invoer\\\",email:\\\"emailadres\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO datum en tijd\\\",date:\\\"ISO datum\\\",time:\\\"ISO tijd\\\",duration:\\\"ISO duur\\\",ipv4:\\\"IPv4-adres\\\",ipv6:\\\"IPv6-adres\\\",cidrv4:\\\"IPv4-bereik\\\",cidrv6:\\\"IPv6-bereik\\\",base64:\\\"base64-gecodeerde tekst\\\",base64url:\\\"base64 URL-gecodeerde tekst\\\",json_string:\\\"JSON string\\\",e164:\\\"E.164-nummer\\\",jwt:\\\"JWT\\\",template_literal:\\\"invoer\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`Ongeldige invoer: verwacht ${t.expected}, ontving ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`Ongeldige invoer: verwacht ${p(t.values[0])}`:`Ongeldige optie: verwacht \\\\xE9\\\\xE9n van ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`Te lang: verwacht dat ${t.origin??\\\"waarde\\\"} ${i}${t.maximum.toString()} ${a.unit??\\\"elementen\\\"} bevat`:`Te lang: verwacht dat ${t.origin??\\\"waarde\\\"} ${i}${t.maximum.toString()} is`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`Te kort: verwacht dat ${t.origin} ${i}${t.minimum.toString()} ${a.unit} bevat`:`Te kort: verwacht dat ${t.origin} ${i}${t.minimum.toString()} is`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`Ongeldige tekst: moet met \\\"${i.prefix}\\\" beginnen`:i.format===\\\"ends_with\\\"?`Ongeldige tekst: moet op \\\"${i.suffix}\\\" eindigen`:i.format===\\\"includes\\\"?`Ongeldige tekst: moet \\\"${i.includes}\\\" bevatten`:i.format===\\\"regex\\\"?`Ongeldige tekst: moet overeenkomen met patroon ${i.pattern}`:`Ongeldig: ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`Ongeldig getal: moet een veelvoud van ${t.divisor} zijn`;case\\\"unrecognized_keys\\\":return`Onbekende key${t.keys.length>1?\\\"s\\\":\\\"\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Ongeldige key in ${t.origin}`;case\\\"invalid_union\\\":return\\\"Ongeldige invoer\\\";case\\\"invalid_element\\\":return`Ongeldige waarde in ${t.origin}`;default:return\\\"Ongeldige invoer\\\"}}};function Gu(){return{localeError:Wl()}}var Xl=()=>{let e={string:{unit:\\\"tegn\\\",verb:\\\"\\\\xE5 ha\\\"},file:{unit:\\\"bytes\\\",verb:\\\"\\\\xE5 ha\\\"},array:{unit:\\\"elementer\\\",verb:\\\"\\\\xE5 inneholde\\\"},set:{unit:\\\"elementer\\\",verb:\\\"\\\\xE5 inneholde\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"tall\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"liste\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"input\\\",email:\\\"e-postadresse\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO dato- og klokkeslett\\\",date:\\\"ISO-dato\\\",time:\\\"ISO-klokkeslett\\\",duration:\\\"ISO-varighet\\\",ipv4:\\\"IPv4-omr\\\\xE5de\\\",ipv6:\\\"IPv6-omr\\\\xE5de\\\",cidrv4:\\\"IPv4-spekter\\\",cidrv6:\\\"IPv6-spekter\\\",base64:\\\"base64-enkodet streng\\\",base64url:\\\"base64url-enkodet streng\\\",json_string:\\\"JSON-streng\\\",e164:\\\"E.164-nummer\\\",jwt:\\\"JWT\\\",template_literal:\\\"input\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`Ugyldig input: forventet ${t.expected}, fikk ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`Ugyldig verdi: forventet ${p(t.values[0])}`:`Ugyldig valg: forventet en av ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`For stor(t): forventet ${t.origin??\\\"value\\\"} til \\\\xE5 ha ${i}${t.maximum.toString()} ${a.unit??\\\"elementer\\\"}`:`For stor(t): forventet ${t.origin??\\\"value\\\"} til \\\\xE5 ha ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`For lite(n): forventet ${t.origin} til \\\\xE5 ha ${i}${t.minimum.toString()} ${a.unit}`:`For lite(n): forventet ${t.origin} til \\\\xE5 ha ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`Ugyldig streng: m\\\\xE5 starte med \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`Ugyldig streng: m\\\\xE5 ende med \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`Ugyldig streng: m\\\\xE5 inneholde \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`Ugyldig streng: m\\\\xE5 matche m\\\\xF8nsteret ${i.pattern}`:`Ugyldig ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`Ugyldig tall: m\\\\xE5 v\\\\xE6re et multiplum av ${t.divisor}`;case\\\"unrecognized_keys\\\":return`${t.keys.length>1?\\\"Ukjente n\\\\xF8kler\\\":\\\"Ukjent n\\\\xF8kkel\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Ugyldig n\\\\xF8kkel i ${t.origin}`;case\\\"invalid_union\\\":return\\\"Ugyldig input\\\";case\\\"invalid_element\\\":return`Ugyldig verdi i ${t.origin}`;default:return\\\"Ugyldig input\\\"}}};function Wu(){return{localeError:Xl()}}var ql=()=>{let e={string:{unit:\\\"harf\\\",verb:\\\"olmal\\\\u0131d\\\\u0131r\\\"},file:{unit:\\\"bayt\\\",verb:\\\"olmal\\\\u0131d\\\\u0131r\\\"},array:{unit:\\\"unsur\\\",verb:\\\"olmal\\\\u0131d\\\\u0131r\\\"},set:{unit:\\\"unsur\\\",verb:\\\"olmal\\\\u0131d\\\\u0131r\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"numara\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"saf\\\";if(t===null)return\\\"gayb\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"giren\\\",email:\\\"epostag\\\\xE2h\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO heng\\\\xE2m\\\\u0131\\\",date:\\\"ISO tarihi\\\",time:\\\"ISO zaman\\\\u0131\\\",duration:\\\"ISO m\\\\xFCddeti\\\",ipv4:\\\"IPv4 ni\\\\u015F\\\\xE2n\\\\u0131\\\",ipv6:\\\"IPv6 ni\\\\u015F\\\\xE2n\\\\u0131\\\",cidrv4:\\\"IPv4 menzili\\\",cidrv6:\\\"IPv6 menzili\\\",base64:\\\"base64-\\\\u015Fifreli metin\\\",base64url:\\\"base64url-\\\\u015Fifreli metin\\\",json_string:\\\"JSON metin\\\",e164:\\\"E.164 say\\\\u0131s\\\\u0131\\\",jwt:\\\"JWT\\\",template_literal:\\\"giren\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`F\\\\xE2sit giren: umulan ${t.expected}, al\\\\u0131nan ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`F\\\\xE2sit giren: umulan ${p(t.values[0])}`:`F\\\\xE2sit tercih: m\\\\xFBteberler ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`Fazla b\\\\xFCy\\\\xFCk: ${t.origin??\\\"value\\\"}, ${i}${t.maximum.toString()} ${a.unit??\\\"elements\\\"} sahip olmal\\\\u0131yd\\\\u0131.`:`Fazla b\\\\xFCy\\\\xFCk: ${t.origin??\\\"value\\\"}, ${i}${t.maximum.toString()} olmal\\\\u0131yd\\\\u0131.`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`Fazla k\\\\xFC\\\\xE7\\\\xFCk: ${t.origin}, ${i}${t.minimum.toString()} ${a.unit} sahip olmal\\\\u0131yd\\\\u0131.`:`Fazla k\\\\xFC\\\\xE7\\\\xFCk: ${t.origin}, ${i}${t.minimum.toString()} olmal\\\\u0131yd\\\\u0131.`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`F\\\\xE2sit metin: \\\"${i.prefix}\\\" ile ba\\\\u015Flamal\\\\u0131.`:i.format===\\\"ends_with\\\"?`F\\\\xE2sit metin: \\\"${i.suffix}\\\" ile bitmeli.`:i.format===\\\"includes\\\"?`F\\\\xE2sit metin: \\\"${i.includes}\\\" ihtiv\\\\xE2 etmeli.`:i.format===\\\"regex\\\"?`F\\\\xE2sit metin: ${i.pattern} nak\\\\u015F\\\\u0131na uymal\\\\u0131.`:`F\\\\xE2sit ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`F\\\\xE2sit say\\\\u0131: ${t.divisor} kat\\\\u0131 olmal\\\\u0131yd\\\\u0131.`;case\\\"unrecognized_keys\\\":return`Tan\\\\u0131nmayan anahtar ${t.keys.length>1?\\\"s\\\":\\\"\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`${t.origin} i\\\\xE7in tan\\\\u0131nmayan anahtar var.`;case\\\"invalid_union\\\":return\\\"Giren tan\\\\u0131namad\\\\u0131.\\\";case\\\"invalid_element\\\":return`${t.origin} i\\\\xE7in tan\\\\u0131nmayan k\\\\u0131ymet var.`;default:return\\\"K\\\\u0131ymet tan\\\\u0131namad\\\\u0131.\\\"}}};function Xu(){return{localeError:ql()}}var Yl=()=>{let e={string:{unit:\\\"\\\\u062A\\\\u0648\\\\u06A9\\\\u064A\\\",verb:\\\"\\\\u0648\\\\u0644\\\\u0631\\\\u064A\\\"},file:{unit:\\\"\\\\u0628\\\\u0627\\\\u06CC\\\\u067C\\\\u0633\\\",verb:\\\"\\\\u0648\\\\u0644\\\\u0631\\\\u064A\\\"},array:{unit:\\\"\\\\u062A\\\\u0648\\\\u06A9\\\\u064A\\\",verb:\\\"\\\\u0648\\\\u0644\\\\u0631\\\\u064A\\\"},set:{unit:\\\"\\\\u062A\\\\u0648\\\\u06A9\\\\u064A\\\",verb:\\\"\\\\u0648\\\\u0644\\\\u0631\\\\u064A\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"\\\\u0639\\\\u062F\\\\u062F\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"\\\\u0627\\\\u0631\\\\u06D0\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"\\\\u0648\\\\u0631\\\\u0648\\\\u062F\\\\u064A\\\",email:\\\"\\\\u0628\\\\u0631\\\\u06CC\\\\u069A\\\\u0646\\\\u0627\\\\u0644\\\\u06CC\\\\u06A9\\\",url:\\\"\\\\u06CC\\\\u0648 \\\\u0622\\\\u0631 \\\\u0627\\\\u0644\\\",emoji:\\\"\\\\u0627\\\\u06CC\\\\u0645\\\\u0648\\\\u062C\\\\u064A\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"\\\\u0646\\\\u06CC\\\\u067C\\\\u0647 \\\\u0627\\\\u0648 \\\\u0648\\\\u062E\\\\u062A\\\",date:\\\"\\\\u0646\\\\u06D0\\\\u067C\\\\u0647\\\",time:\\\"\\\\u0648\\\\u062E\\\\u062A\\\",duration:\\\"\\\\u0645\\\\u0648\\\\u062F\\\\u0647\\\",ipv4:\\\"\\\\u062F IPv4 \\\\u067E\\\\u062A\\\\u0647\\\",ipv6:\\\"\\\\u062F IPv6 \\\\u067E\\\\u062A\\\\u0647\\\",cidrv4:\\\"\\\\u062F IPv4 \\\\u0633\\\\u0627\\\\u062D\\\\u0647\\\",cidrv6:\\\"\\\\u062F IPv6 \\\\u0633\\\\u0627\\\\u062D\\\\u0647\\\",base64:\\\"base64-encoded \\\\u0645\\\\u062A\\\\u0646\\\",base64url:\\\"base64url-encoded \\\\u0645\\\\u062A\\\\u0646\\\",json_string:\\\"JSON \\\\u0645\\\\u062A\\\\u0646\\\",e164:\\\"\\\\u062F E.164 \\\\u0634\\\\u0645\\\\u06D0\\\\u0631\\\\u0647\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\u0648\\\\u0631\\\\u0648\\\\u062F\\\\u064A\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\u0646\\\\u0627\\\\u0633\\\\u0645 \\\\u0648\\\\u0631\\\\u0648\\\\u062F\\\\u064A: \\\\u0628\\\\u0627\\\\u06CC\\\\u062F ${t.expected} \\\\u0648\\\\u0627\\\\u06CC, \\\\u0645\\\\u06AB\\\\u0631 ${n(t.input)} \\\\u062A\\\\u0631\\\\u0644\\\\u0627\\\\u0633\\\\u0647 \\\\u0634\\\\u0648`;case\\\"invalid_value\\\":return t.values.length===1?`\\\\u0646\\\\u0627\\\\u0633\\\\u0645 \\\\u0648\\\\u0631\\\\u0648\\\\u062F\\\\u064A: \\\\u0628\\\\u0627\\\\u06CC\\\\u062F ${p(t.values[0])} \\\\u0648\\\\u0627\\\\u06CC`:`\\\\u0646\\\\u0627\\\\u0633\\\\u0645 \\\\u0627\\\\u0646\\\\u062A\\\\u062E\\\\u0627\\\\u0628: \\\\u0628\\\\u0627\\\\u06CC\\\\u062F \\\\u06CC\\\\u0648 \\\\u0644\\\\u0647 ${l(t.values,\\\"|\\\")} \\\\u0685\\\\u062E\\\\u0647 \\\\u0648\\\\u0627\\\\u06CC`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`\\\\u0689\\\\u06CC\\\\u0631 \\\\u0644\\\\u0648\\\\u06CC: ${t.origin??\\\"\\\\u0627\\\\u0631\\\\u0632\\\\u069A\\\\u062A\\\"} \\\\u0628\\\\u0627\\\\u06CC\\\\u062F ${i}${t.maximum.toString()} ${a.unit??\\\"\\\\u0639\\\\u0646\\\\u0635\\\\u0631\\\\u0648\\\\u0646\\\\u0647\\\"} \\\\u0648\\\\u0644\\\\u0631\\\\u064A`:`\\\\u0689\\\\u06CC\\\\u0631 \\\\u0644\\\\u0648\\\\u06CC: ${t.origin??\\\"\\\\u0627\\\\u0631\\\\u0632\\\\u069A\\\\u062A\\\"} \\\\u0628\\\\u0627\\\\u06CC\\\\u062F ${i}${t.maximum.toString()} \\\\u0648\\\\u064A`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`\\\\u0689\\\\u06CC\\\\u0631 \\\\u06A9\\\\u0648\\\\u0686\\\\u0646\\\\u06CC: ${t.origin} \\\\u0628\\\\u0627\\\\u06CC\\\\u062F ${i}${t.minimum.toString()} ${a.unit} \\\\u0648\\\\u0644\\\\u0631\\\\u064A`:`\\\\u0689\\\\u06CC\\\\u0631 \\\\u06A9\\\\u0648\\\\u0686\\\\u0646\\\\u06CC: ${t.origin} \\\\u0628\\\\u0627\\\\u06CC\\\\u062F ${i}${t.minimum.toString()} \\\\u0648\\\\u064A`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`\\\\u0646\\\\u0627\\\\u0633\\\\u0645 \\\\u0645\\\\u062A\\\\u0646: \\\\u0628\\\\u0627\\\\u06CC\\\\u062F \\\\u062F \\\"${i.prefix}\\\" \\\\u0633\\\\u0631\\\\u0647 \\\\u067E\\\\u06CC\\\\u0644 \\\\u0634\\\\u064A`:i.format===\\\"ends_with\\\"?`\\\\u0646\\\\u0627\\\\u0633\\\\u0645 \\\\u0645\\\\u062A\\\\u0646: \\\\u0628\\\\u0627\\\\u06CC\\\\u062F \\\\u062F \\\"${i.suffix}\\\" \\\\u0633\\\\u0631\\\\u0647 \\\\u067E\\\\u0627\\\\u06CC \\\\u062A\\\\u0647 \\\\u0648\\\\u0631\\\\u0633\\\\u064A\\\\u0696\\\\u064A`:i.format===\\\"includes\\\"?`\\\\u0646\\\\u0627\\\\u0633\\\\u0645 \\\\u0645\\\\u062A\\\\u0646: \\\\u0628\\\\u0627\\\\u06CC\\\\u062F \\\"${i.includes}\\\" \\\\u0648\\\\u0644\\\\u0631\\\\u064A`:i.format===\\\"regex\\\"?`\\\\u0646\\\\u0627\\\\u0633\\\\u0645 \\\\u0645\\\\u062A\\\\u0646: \\\\u0628\\\\u0627\\\\u06CC\\\\u062F \\\\u062F ${i.pattern} \\\\u0633\\\\u0631\\\\u0647 \\\\u0645\\\\u0637\\\\u0627\\\\u0628\\\\u0642\\\\u062A \\\\u0648\\\\u0644\\\\u0631\\\\u064A`:`${o[i.format]??t.format} \\\\u0646\\\\u0627\\\\u0633\\\\u0645 \\\\u062F\\\\u06CC`}case\\\"not_multiple_of\\\":return`\\\\u0646\\\\u0627\\\\u0633\\\\u0645 \\\\u0639\\\\u062F\\\\u062F: \\\\u0628\\\\u0627\\\\u06CC\\\\u062F \\\\u062F ${t.divisor} \\\\u0645\\\\u0636\\\\u0631\\\\u0628 \\\\u0648\\\\u064A`;case\\\"unrecognized_keys\\\":return`\\\\u0646\\\\u0627\\\\u0633\\\\u0645 ${t.keys.length>1?\\\"\\\\u06A9\\\\u0644\\\\u06CC\\\\u0689\\\\u0648\\\\u0646\\\\u0647\\\":\\\"\\\\u06A9\\\\u0644\\\\u06CC\\\\u0689\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`\\\\u0646\\\\u0627\\\\u0633\\\\u0645 \\\\u06A9\\\\u0644\\\\u06CC\\\\u0689 \\\\u067E\\\\u0647 ${t.origin} \\\\u06A9\\\\u06D0`;case\\\"invalid_union\\\":return\\\"\\\\u0646\\\\u0627\\\\u0633\\\\u0645\\\\u0647 \\\\u0648\\\\u0631\\\\u0648\\\\u062F\\\\u064A\\\";case\\\"invalid_element\\\":return`\\\\u0646\\\\u0627\\\\u0633\\\\u0645 \\\\u0639\\\\u0646\\\\u0635\\\\u0631 \\\\u067E\\\\u0647 ${t.origin} \\\\u06A9\\\\u06D0`;default:return\\\"\\\\u0646\\\\u0627\\\\u0633\\\\u0645\\\\u0647 \\\\u0648\\\\u0631\\\\u0648\\\\u062F\\\\u064A\\\"}}};function qu(){return{localeError:Yl()}}var Ql=()=>{let e={string:{unit:\\\"znak\\\\xF3w\\\",verb:\\\"mie\\\\u0107\\\"},file:{unit:\\\"bajt\\\\xF3w\\\",verb:\\\"mie\\\\u0107\\\"},array:{unit:\\\"element\\\\xF3w\\\",verb:\\\"mie\\\\u0107\\\"},set:{unit:\\\"element\\\\xF3w\\\",verb:\\\"mie\\\\u0107\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"liczba\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"tablica\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"wyra\\\\u017Cenie\\\",email:\\\"adres email\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"data i godzina w formacie ISO\\\",date:\\\"data w formacie ISO\\\",time:\\\"godzina w formacie ISO\\\",duration:\\\"czas trwania ISO\\\",ipv4:\\\"adres IPv4\\\",ipv6:\\\"adres IPv6\\\",cidrv4:\\\"zakres IPv4\\\",cidrv6:\\\"zakres IPv6\\\",base64:\\\"ci\\\\u0105g znak\\\\xF3w zakodowany w formacie base64\\\",base64url:\\\"ci\\\\u0105g znak\\\\xF3w zakodowany w formacie base64url\\\",json_string:\\\"ci\\\\u0105g znak\\\\xF3w w formacie JSON\\\",e164:\\\"liczba E.164\\\",jwt:\\\"JWT\\\",template_literal:\\\"wej\\\\u015Bcie\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`Nieprawid\\\\u0142owe dane wej\\\\u015Bciowe: oczekiwano ${t.expected}, otrzymano ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`Nieprawid\\\\u0142owe dane wej\\\\u015Bciowe: oczekiwano ${p(t.values[0])}`:`Nieprawid\\\\u0142owa opcja: oczekiwano jednej z warto\\\\u015Bci ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`Za du\\\\u017Ca warto\\\\u015B\\\\u0107: oczekiwano, \\\\u017Ce ${t.origin??\\\"warto\\\\u015B\\\\u0107\\\"} b\\\\u0119dzie mie\\\\u0107 ${i}${t.maximum.toString()} ${a.unit??\\\"element\\\\xF3w\\\"}`:`Zbyt du\\\\u017C(y/a/e): oczekiwano, \\\\u017Ce ${t.origin??\\\"warto\\\\u015B\\\\u0107\\\"} b\\\\u0119dzie wynosi\\\\u0107 ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`Za ma\\\\u0142a warto\\\\u015B\\\\u0107: oczekiwano, \\\\u017Ce ${t.origin??\\\"warto\\\\u015B\\\\u0107\\\"} b\\\\u0119dzie mie\\\\u0107 ${i}${t.minimum.toString()} ${a.unit??\\\"element\\\\xF3w\\\"}`:`Zbyt ma\\\\u0142(y/a/e): oczekiwano, \\\\u017Ce ${t.origin??\\\"warto\\\\u015B\\\\u0107\\\"} b\\\\u0119dzie wynosi\\\\u0107 ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`Nieprawid\\\\u0142owy ci\\\\u0105g znak\\\\xF3w: musi zaczyna\\\\u0107 si\\\\u0119 od \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`Nieprawid\\\\u0142owy ci\\\\u0105g znak\\\\xF3w: musi ko\\\\u0144czy\\\\u0107 si\\\\u0119 na \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`Nieprawid\\\\u0142owy ci\\\\u0105g znak\\\\xF3w: musi zawiera\\\\u0107 \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`Nieprawid\\\\u0142owy ci\\\\u0105g znak\\\\xF3w: musi odpowiada\\\\u0107 wzorcowi ${i.pattern}`:`Nieprawid\\\\u0142ow(y/a/e) ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`Nieprawid\\\\u0142owa liczba: musi by\\\\u0107 wielokrotno\\\\u015Bci\\\\u0105 ${t.divisor}`;case\\\"unrecognized_keys\\\":return`Nierozpoznane klucze${t.keys.length>1?\\\"s\\\":\\\"\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Nieprawid\\\\u0142owy klucz w ${t.origin}`;case\\\"invalid_union\\\":return\\\"Nieprawid\\\\u0142owe dane wej\\\\u015Bciowe\\\";case\\\"invalid_element\\\":return`Nieprawid\\\\u0142owa warto\\\\u015B\\\\u0107 w ${t.origin}`;default:return\\\"Nieprawid\\\\u0142owe dane wej\\\\u015Bciowe\\\"}}};function Yu(){return{localeError:Ql()}}var Hl=()=>{let e={string:{unit:\\\"caracteres\\\",verb:\\\"ter\\\"},file:{unit:\\\"bytes\\\",verb:\\\"ter\\\"},array:{unit:\\\"itens\\\",verb:\\\"ter\\\"},set:{unit:\\\"itens\\\",verb:\\\"ter\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"n\\\\xFAmero\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"array\\\";if(t===null)return\\\"nulo\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"padr\\\\xE3o\\\",email:\\\"endere\\\\xE7o de e-mail\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"data e hora ISO\\\",date:\\\"data ISO\\\",time:\\\"hora ISO\\\",duration:\\\"dura\\\\xE7\\\\xE3o ISO\\\",ipv4:\\\"endere\\\\xE7o IPv4\\\",ipv6:\\\"endere\\\\xE7o IPv6\\\",cidrv4:\\\"faixa de IPv4\\\",cidrv6:\\\"faixa de IPv6\\\",base64:\\\"texto codificado em base64\\\",base64url:\\\"URL codificada em base64\\\",json_string:\\\"texto JSON\\\",e164:\\\"n\\\\xFAmero E.164\\\",jwt:\\\"JWT\\\",template_literal:\\\"entrada\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`Tipo inv\\\\xE1lido: esperado ${t.expected}, recebido ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`Entrada inv\\\\xE1lida: esperado ${p(t.values[0])}`:`Op\\\\xE7\\\\xE3o inv\\\\xE1lida: esperada uma das ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`Muito grande: esperado que ${t.origin??\\\"valor\\\"} tivesse ${i}${t.maximum.toString()} ${a.unit??\\\"elementos\\\"}`:`Muito grande: esperado que ${t.origin??\\\"valor\\\"} fosse ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`Muito pequeno: esperado que ${t.origin} tivesse ${i}${t.minimum.toString()} ${a.unit}`:`Muito pequeno: esperado que ${t.origin} fosse ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`Texto inv\\\\xE1lido: deve come\\\\xE7ar com \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`Texto inv\\\\xE1lido: deve terminar com \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`Texto inv\\\\xE1lido: deve incluir \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`Texto inv\\\\xE1lido: deve corresponder ao padr\\\\xE3o ${i.pattern}`:`${o[i.format]??t.format} inv\\\\xE1lido`}case\\\"not_multiple_of\\\":return`N\\\\xFAmero inv\\\\xE1lido: deve ser m\\\\xFAltiplo de ${t.divisor}`;case\\\"unrecognized_keys\\\":return`Chave${t.keys.length>1?\\\"s\\\":\\\"\\\"} desconhecida${t.keys.length>1?\\\"s\\\":\\\"\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Chave inv\\\\xE1lida em ${t.origin}`;case\\\"invalid_union\\\":return\\\"Entrada inv\\\\xE1lida\\\";case\\\"invalid_element\\\":return`Valor inv\\\\xE1lido em ${t.origin}`;default:return\\\"Campo inv\\\\xE1lido\\\"}}};function Qu(){return{localeError:Hl()}}function Hu(e,r,n,o){let t=Math.abs(e),i=t%10,a=t%100;return a>=11&&a<=19?o:i===1?r:i>=2&&i<=4?n:o}var ed=()=>{let e={string:{unit:{one:\\\"\\\\u0441\\\\u0438\\\\u043C\\\\u0432\\\\u043E\\\\u043B\\\",few:\\\"\\\\u0441\\\\u0438\\\\u043C\\\\u0432\\\\u043E\\\\u043B\\\\u0430\\\",many:\\\"\\\\u0441\\\\u0438\\\\u043C\\\\u0432\\\\u043E\\\\u043B\\\\u043E\\\\u0432\\\"},verb:\\\"\\\\u0438\\\\u043C\\\\u0435\\\\u0442\\\\u044C\\\"},file:{unit:{one:\\\"\\\\u0431\\\\u0430\\\\u0439\\\\u0442\\\",few:\\\"\\\\u0431\\\\u0430\\\\u0439\\\\u0442\\\\u0430\\\",many:\\\"\\\\u0431\\\\u0430\\\\u0439\\\\u0442\\\"},verb:\\\"\\\\u0438\\\\u043C\\\\u0435\\\\u0442\\\\u044C\\\"},array:{unit:{one:\\\"\\\\u044D\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\",few:\\\"\\\\u044D\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\\u0430\\\",many:\\\"\\\\u044D\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\\u043E\\\\u0432\\\"},verb:\\\"\\\\u0438\\\\u043C\\\\u0435\\\\u0442\\\\u044C\\\"},set:{unit:{one:\\\"\\\\u044D\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\",few:\\\"\\\\u044D\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\\u0430\\\",many:\\\"\\\\u044D\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\\u043E\\\\u0432\\\"},verb:\\\"\\\\u0438\\\\u043C\\\\u0435\\\\u0442\\\\u044C\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"\\\\u0447\\\\u0438\\\\u0441\\\\u043B\\\\u043E\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"\\\\u043C\\\\u0430\\\\u0441\\\\u0441\\\\u0438\\\\u0432\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"\\\\u0432\\\\u0432\\\\u043E\\\\u0434\\\",email:\\\"email \\\\u0430\\\\u0434\\\\u0440\\\\u0435\\\\u0441\\\",url:\\\"URL\\\",emoji:\\\"\\\\u044D\\\\u043C\\\\u043E\\\\u0434\\\\u0437\\\\u0438\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO \\\\u0434\\\\u0430\\\\u0442\\\\u0430 \\\\u0438 \\\\u0432\\\\u0440\\\\u0435\\\\u043C\\\\u044F\\\",date:\\\"ISO \\\\u0434\\\\u0430\\\\u0442\\\\u0430\\\",time:\\\"ISO \\\\u0432\\\\u0440\\\\u0435\\\\u043C\\\\u044F\\\",duration:\\\"ISO \\\\u0434\\\\u043B\\\\u0438\\\\u0442\\\\u0435\\\\u043B\\\\u044C\\\\u043D\\\\u043E\\\\u0441\\\\u0442\\\\u044C\\\",ipv4:\\\"IPv4 \\\\u0430\\\\u0434\\\\u0440\\\\u0435\\\\u0441\\\",ipv6:\\\"IPv6 \\\\u0430\\\\u0434\\\\u0440\\\\u0435\\\\u0441\\\",cidrv4:\\\"IPv4 \\\\u0434\\\\u0438\\\\u0430\\\\u043F\\\\u0430\\\\u0437\\\\u043E\\\\u043D\\\",cidrv6:\\\"IPv6 \\\\u0434\\\\u0438\\\\u0430\\\\u043F\\\\u0430\\\\u0437\\\\u043E\\\\u043D\\\",base64:\\\"\\\\u0441\\\\u0442\\\\u0440\\\\u043E\\\\u043A\\\\u0430 \\\\u0432 \\\\u0444\\\\u043E\\\\u0440\\\\u043C\\\\u0430\\\\u0442\\\\u0435 base64\\\",base64url:\\\"\\\\u0441\\\\u0442\\\\u0440\\\\u043E\\\\u043A\\\\u0430 \\\\u0432 \\\\u0444\\\\u043E\\\\u0440\\\\u043C\\\\u0430\\\\u0442\\\\u0435 base64url\\\",json_string:\\\"JSON \\\\u0441\\\\u0442\\\\u0440\\\\u043E\\\\u043A\\\\u0430\\\",e164:\\\"\\\\u043D\\\\u043E\\\\u043C\\\\u0435\\\\u0440 E.164\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\u0432\\\\u0432\\\\u043E\\\\u0434\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\u041D\\\\u0435\\\\u0432\\\\u0435\\\\u0440\\\\u043D\\\\u044B\\\\u0439 \\\\u0432\\\\u0432\\\\u043E\\\\u0434: \\\\u043E\\\\u0436\\\\u0438\\\\u0434\\\\u0430\\\\u043B\\\\u043E\\\\u0441\\\\u044C ${t.expected}, \\\\u043F\\\\u043E\\\\u043B\\\\u0443\\\\u0447\\\\u0435\\\\u043D\\\\u043E ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`\\\\u041D\\\\u0435\\\\u0432\\\\u0435\\\\u0440\\\\u043D\\\\u044B\\\\u0439 \\\\u0432\\\\u0432\\\\u043E\\\\u0434: \\\\u043E\\\\u0436\\\\u0438\\\\u0434\\\\u0430\\\\u043B\\\\u043E\\\\u0441\\\\u044C ${p(t.values[0])}`:`\\\\u041D\\\\u0435\\\\u0432\\\\u0435\\\\u0440\\\\u043D\\\\u044B\\\\u0439 \\\\u0432\\\\u0430\\\\u0440\\\\u0438\\\\u0430\\\\u043D\\\\u0442: \\\\u043E\\\\u0436\\\\u0438\\\\u0434\\\\u0430\\\\u043B\\\\u043E\\\\u0441\\\\u044C \\\\u043E\\\\u0434\\\\u043D\\\\u043E \\\\u0438\\\\u0437 ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);if(a){let u=Number(t.maximum),s=Hu(u,a.unit.one,a.unit.few,a.unit.many);return`\\\\u0421\\\\u043B\\\\u0438\\\\u0448\\\\u043A\\\\u043E\\\\u043C \\\\u0431\\\\u043E\\\\u043B\\\\u044C\\\\u0448\\\\u043E\\\\u0435 \\\\u0437\\\\u043D\\\\u0430\\\\u0447\\\\u0435\\\\u043D\\\\u0438\\\\u0435: \\\\u043E\\\\u0436\\\\u0438\\\\u0434\\\\u0430\\\\u043B\\\\u043E\\\\u0441\\\\u044C, \\\\u0447\\\\u0442\\\\u043E ${t.origin??\\\"\\\\u0437\\\\u043D\\\\u0430\\\\u0447\\\\u0435\\\\u043D\\\\u0438\\\\u0435\\\"} \\\\u0431\\\\u0443\\\\u0434\\\\u0435\\\\u0442 \\\\u0438\\\\u043C\\\\u0435\\\\u0442\\\\u044C ${i}${t.maximum.toString()} ${s}`}return`\\\\u0421\\\\u043B\\\\u0438\\\\u0448\\\\u043A\\\\u043E\\\\u043C \\\\u0431\\\\u043E\\\\u043B\\\\u044C\\\\u0448\\\\u043E\\\\u0435 \\\\u0437\\\\u043D\\\\u0430\\\\u0447\\\\u0435\\\\u043D\\\\u0438\\\\u0435: \\\\u043E\\\\u0436\\\\u0438\\\\u0434\\\\u0430\\\\u043B\\\\u043E\\\\u0441\\\\u044C, \\\\u0447\\\\u0442\\\\u043E ${t.origin??\\\"\\\\u0437\\\\u043D\\\\u0430\\\\u0447\\\\u0435\\\\u043D\\\\u0438\\\\u0435\\\"} \\\\u0431\\\\u0443\\\\u0434\\\\u0435\\\\u0442 ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);if(a){let u=Number(t.minimum),s=Hu(u,a.unit.one,a.unit.few,a.unit.many);return`\\\\u0421\\\\u043B\\\\u0438\\\\u0448\\\\u043A\\\\u043E\\\\u043C \\\\u043C\\\\u0430\\\\u043B\\\\u0435\\\\u043D\\\\u044C\\\\u043A\\\\u043E\\\\u0435 \\\\u0437\\\\u043D\\\\u0430\\\\u0447\\\\u0435\\\\u043D\\\\u0438\\\\u0435: \\\\u043E\\\\u0436\\\\u0438\\\\u0434\\\\u0430\\\\u043B\\\\u043E\\\\u0441\\\\u044C, \\\\u0447\\\\u0442\\\\u043E ${t.origin} \\\\u0431\\\\u0443\\\\u0434\\\\u0435\\\\u0442 \\\\u0438\\\\u043C\\\\u0435\\\\u0442\\\\u044C ${i}${t.minimum.toString()} ${s}`}return`\\\\u0421\\\\u043B\\\\u0438\\\\u0448\\\\u043A\\\\u043E\\\\u043C \\\\u043C\\\\u0430\\\\u043B\\\\u0435\\\\u043D\\\\u044C\\\\u043A\\\\u043E\\\\u0435 \\\\u0437\\\\u043D\\\\u0430\\\\u0447\\\\u0435\\\\u043D\\\\u0438\\\\u0435: \\\\u043E\\\\u0436\\\\u0438\\\\u0434\\\\u0430\\\\u043B\\\\u043E\\\\u0441\\\\u044C, \\\\u0447\\\\u0442\\\\u043E ${t.origin} \\\\u0431\\\\u0443\\\\u0434\\\\u0435\\\\u0442 ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`\\\\u041D\\\\u0435\\\\u0432\\\\u0435\\\\u0440\\\\u043D\\\\u0430\\\\u044F \\\\u0441\\\\u0442\\\\u0440\\\\u043E\\\\u043A\\\\u0430: \\\\u0434\\\\u043E\\\\u043B\\\\u0436\\\\u043D\\\\u0430 \\\\u043D\\\\u0430\\\\u0447\\\\u0438\\\\u043D\\\\u0430\\\\u0442\\\\u044C\\\\u0441\\\\u044F \\\\u0441 \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`\\\\u041D\\\\u0435\\\\u0432\\\\u0435\\\\u0440\\\\u043D\\\\u0430\\\\u044F \\\\u0441\\\\u0442\\\\u0440\\\\u043E\\\\u043A\\\\u0430: \\\\u0434\\\\u043E\\\\u043B\\\\u0436\\\\u043D\\\\u0430 \\\\u0437\\\\u0430\\\\u043A\\\\u0430\\\\u043D\\\\u0447\\\\u0438\\\\u0432\\\\u0430\\\\u0442\\\\u044C\\\\u0441\\\\u044F \\\\u043D\\\\u0430 \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`\\\\u041D\\\\u0435\\\\u0432\\\\u0435\\\\u0440\\\\u043D\\\\u0430\\\\u044F \\\\u0441\\\\u0442\\\\u0440\\\\u043E\\\\u043A\\\\u0430: \\\\u0434\\\\u043E\\\\u043B\\\\u0436\\\\u043D\\\\u0430 \\\\u0441\\\\u043E\\\\u0434\\\\u0435\\\\u0440\\\\u0436\\\\u0430\\\\u0442\\\\u044C \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`\\\\u041D\\\\u0435\\\\u0432\\\\u0435\\\\u0440\\\\u043D\\\\u0430\\\\u044F \\\\u0441\\\\u0442\\\\u0440\\\\u043E\\\\u043A\\\\u0430: \\\\u0434\\\\u043E\\\\u043B\\\\u0436\\\\u043D\\\\u0430 \\\\u0441\\\\u043E\\\\u043E\\\\u0442\\\\u0432\\\\u0435\\\\u0442\\\\u0441\\\\u0442\\\\u0432\\\\u043E\\\\u0432\\\\u0430\\\\u0442\\\\u044C \\\\u0448\\\\u0430\\\\u0431\\\\u043B\\\\u043E\\\\u043D\\\\u0443 ${i.pattern}`:`\\\\u041D\\\\u0435\\\\u0432\\\\u0435\\\\u0440\\\\u043D\\\\u044B\\\\u0439 ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`\\\\u041D\\\\u0435\\\\u0432\\\\u0435\\\\u0440\\\\u043D\\\\u043E\\\\u0435 \\\\u0447\\\\u0438\\\\u0441\\\\u043B\\\\u043E: \\\\u0434\\\\u043E\\\\u043B\\\\u0436\\\\u043D\\\\u043E \\\\u0431\\\\u044B\\\\u0442\\\\u044C \\\\u043A\\\\u0440\\\\u0430\\\\u0442\\\\u043D\\\\u044B\\\\u043C ${t.divisor}`;case\\\"unrecognized_keys\\\":return`\\\\u041D\\\\u0435\\\\u0440\\\\u0430\\\\u0441\\\\u043F\\\\u043E\\\\u0437\\\\u043D\\\\u0430\\\\u043D\\\\u043D${t.keys.length>1?\\\"\\\\u044B\\\\u0435\\\":\\\"\\\\u044B\\\\u0439\\\"} \\\\u043A\\\\u043B\\\\u044E\\\\u0447${t.keys.length>1?\\\"\\\\u0438\\\":\\\"\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`\\\\u041D\\\\u0435\\\\u0432\\\\u0435\\\\u0440\\\\u043D\\\\u044B\\\\u0439 \\\\u043A\\\\u043B\\\\u044E\\\\u0447 \\\\u0432 ${t.origin}`;case\\\"invalid_union\\\":return\\\"\\\\u041D\\\\u0435\\\\u0432\\\\u0435\\\\u0440\\\\u043D\\\\u044B\\\\u0435 \\\\u0432\\\\u0445\\\\u043E\\\\u0434\\\\u043D\\\\u044B\\\\u0435 \\\\u0434\\\\u0430\\\\u043D\\\\u043D\\\\u044B\\\\u0435\\\";case\\\"invalid_element\\\":return`\\\\u041D\\\\u0435\\\\u0432\\\\u0435\\\\u0440\\\\u043D\\\\u043E\\\\u0435 \\\\u0437\\\\u043D\\\\u0430\\\\u0447\\\\u0435\\\\u043D\\\\u0438\\\\u0435 \\\\u0432 ${t.origin}`;default:return\\\"\\\\u041D\\\\u0435\\\\u0432\\\\u0435\\\\u0440\\\\u043D\\\\u044B\\\\u0435 \\\\u0432\\\\u0445\\\\u043E\\\\u0434\\\\u043D\\\\u044B\\\\u0435 \\\\u0434\\\\u0430\\\\u043D\\\\u043D\\\\u044B\\\\u0435\\\"}}};function ec(){return{localeError:ed()}}var td=()=>{let e={string:{unit:\\\"znakov\\\",verb:\\\"imeti\\\"},file:{unit:\\\"bajtov\\\",verb:\\\"imeti\\\"},array:{unit:\\\"elementov\\\",verb:\\\"imeti\\\"},set:{unit:\\\"elementov\\\",verb:\\\"imeti\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"\\\\u0161tevilo\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"tabela\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"vnos\\\",email:\\\"e-po\\\\u0161tni naslov\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO datum in \\\\u010Das\\\",date:\\\"ISO datum\\\",time:\\\"ISO \\\\u010Das\\\",duration:\\\"ISO trajanje\\\",ipv4:\\\"IPv4 naslov\\\",ipv6:\\\"IPv6 naslov\\\",cidrv4:\\\"obseg IPv4\\\",cidrv6:\\\"obseg IPv6\\\",base64:\\\"base64 kodiran niz\\\",base64url:\\\"base64url kodiran niz\\\",json_string:\\\"JSON niz\\\",e164:\\\"E.164 \\\\u0161tevilka\\\",jwt:\\\"JWT\\\",template_literal:\\\"vnos\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`Neveljaven vnos: pri\\\\u010Dakovano ${t.expected}, prejeto ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`Neveljaven vnos: pri\\\\u010Dakovano ${p(t.values[0])}`:`Neveljavna mo\\\\u017Enost: pri\\\\u010Dakovano eno izmed ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`Preveliko: pri\\\\u010Dakovano, da bo ${t.origin??\\\"vrednost\\\"} imelo ${i}${t.maximum.toString()} ${a.unit??\\\"elementov\\\"}`:`Preveliko: pri\\\\u010Dakovano, da bo ${t.origin??\\\"vrednost\\\"} ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`Premajhno: pri\\\\u010Dakovano, da bo ${t.origin} imelo ${i}${t.minimum.toString()} ${a.unit}`:`Premajhno: pri\\\\u010Dakovano, da bo ${t.origin} ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`Neveljaven niz: mora se za\\\\u010Deti z \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`Neveljaven niz: mora se kon\\\\u010Dati z \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`Neveljaven niz: mora vsebovati \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`Neveljaven niz: mora ustrezati vzorcu ${i.pattern}`:`Neveljaven ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`Neveljavno \\\\u0161tevilo: mora biti ve\\\\u010Dkratnik ${t.divisor}`;case\\\"unrecognized_keys\\\":return`Neprepoznan${t.keys.length>1?\\\"i klju\\\\u010Di\\\":\\\" klju\\\\u010D\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Neveljaven klju\\\\u010D v ${t.origin}`;case\\\"invalid_union\\\":return\\\"Neveljaven vnos\\\";case\\\"invalid_element\\\":return`Neveljavna vrednost v ${t.origin}`;default:return\\\"Neveljaven vnos\\\"}}};function tc(){return{localeError:td()}}var rd=()=>{let e={string:{unit:\\\"tecken\\\",verb:\\\"att ha\\\"},file:{unit:\\\"bytes\\\",verb:\\\"att ha\\\"},array:{unit:\\\"objekt\\\",verb:\\\"att inneh\\\\xE5lla\\\"},set:{unit:\\\"objekt\\\",verb:\\\"att inneh\\\\xE5lla\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"antal\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"lista\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"regulj\\\\xE4rt uttryck\\\",email:\\\"e-postadress\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO-datum och tid\\\",date:\\\"ISO-datum\\\",time:\\\"ISO-tid\\\",duration:\\\"ISO-varaktighet\\\",ipv4:\\\"IPv4-intervall\\\",ipv6:\\\"IPv6-intervall\\\",cidrv4:\\\"IPv4-spektrum\\\",cidrv6:\\\"IPv6-spektrum\\\",base64:\\\"base64-kodad str\\\\xE4ng\\\",base64url:\\\"base64url-kodad str\\\\xE4ng\\\",json_string:\\\"JSON-str\\\\xE4ng\\\",e164:\\\"E.164-nummer\\\",jwt:\\\"JWT\\\",template_literal:\\\"mall-literal\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`Ogiltig inmatning: f\\\\xF6rv\\\\xE4ntat ${t.expected}, fick ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`Ogiltig inmatning: f\\\\xF6rv\\\\xE4ntat ${p(t.values[0])}`:`Ogiltigt val: f\\\\xF6rv\\\\xE4ntade en av ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`F\\\\xF6r stor(t): f\\\\xF6rv\\\\xE4ntade ${t.origin??\\\"v\\\\xE4rdet\\\"} att ha ${i}${t.maximum.toString()} ${a.unit??\\\"element\\\"}`:`F\\\\xF6r stor(t): f\\\\xF6rv\\\\xE4ntat ${t.origin??\\\"v\\\\xE4rdet\\\"} att ha ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`F\\\\xF6r lite(t): f\\\\xF6rv\\\\xE4ntade ${t.origin??\\\"v\\\\xE4rdet\\\"} att ha ${i}${t.minimum.toString()} ${a.unit}`:`F\\\\xF6r lite(t): f\\\\xF6rv\\\\xE4ntade ${t.origin??\\\"v\\\\xE4rdet\\\"} att ha ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`Ogiltig str\\\\xE4ng: m\\\\xE5ste b\\\\xF6rja med \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`Ogiltig str\\\\xE4ng: m\\\\xE5ste sluta med \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`Ogiltig str\\\\xE4ng: m\\\\xE5ste inneh\\\\xE5lla \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`Ogiltig str\\\\xE4ng: m\\\\xE5ste matcha m\\\\xF6nstret \\\"${i.pattern}\\\"`:`Ogiltig(t) ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`Ogiltigt tal: m\\\\xE5ste vara en multipel av ${t.divisor}`;case\\\"unrecognized_keys\\\":return`${t.keys.length>1?\\\"Ok\\\\xE4nda nycklar\\\":\\\"Ok\\\\xE4nd nyckel\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Ogiltig nyckel i ${t.origin??\\\"v\\\\xE4rdet\\\"}`;case\\\"invalid_union\\\":return\\\"Ogiltig input\\\";case\\\"invalid_element\\\":return`Ogiltigt v\\\\xE4rde i ${t.origin??\\\"v\\\\xE4rdet\\\"}`;default:return\\\"Ogiltig input\\\"}}};function rc(){return{localeError:rd()}}var nd=()=>{let e={string:{unit:\\\"\\\\u0B8E\\\\u0BB4\\\\u0BC1\\\\u0BA4\\\\u0BCD\\\\u0BA4\\\\u0BC1\\\\u0B95\\\\u0BCD\\\\u0B95\\\\u0BB3\\\\u0BCD\\\",verb:\\\"\\\\u0B95\\\\u0BCA\\\\u0BA3\\\\u0BCD\\\\u0B9F\\\\u0BBF\\\\u0BB0\\\\u0BC1\\\\u0B95\\\\u0BCD\\\\u0B95 \\\\u0BB5\\\\u0BC7\\\\u0BA3\\\\u0BCD\\\\u0B9F\\\\u0BC1\\\\u0BAE\\\\u0BCD\\\"},file:{unit:\\\"\\\\u0BAA\\\\u0BC8\\\\u0B9F\\\\u0BCD\\\\u0B9F\\\\u0BC1\\\\u0B95\\\\u0BB3\\\\u0BCD\\\",verb:\\\"\\\\u0B95\\\\u0BCA\\\\u0BA3\\\\u0BCD\\\\u0B9F\\\\u0BBF\\\\u0BB0\\\\u0BC1\\\\u0B95\\\\u0BCD\\\\u0B95 \\\\u0BB5\\\\u0BC7\\\\u0BA3\\\\u0BCD\\\\u0B9F\\\\u0BC1\\\\u0BAE\\\\u0BCD\\\"},array:{unit:\\\"\\\\u0B89\\\\u0BB1\\\\u0BC1\\\\u0BAA\\\\u0BCD\\\\u0BAA\\\\u0BC1\\\\u0B95\\\\u0BB3\\\\u0BCD\\\",verb:\\\"\\\\u0B95\\\\u0BCA\\\\u0BA3\\\\u0BCD\\\\u0B9F\\\\u0BBF\\\\u0BB0\\\\u0BC1\\\\u0B95\\\\u0BCD\\\\u0B95 \\\\u0BB5\\\\u0BC7\\\\u0BA3\\\\u0BCD\\\\u0B9F\\\\u0BC1\\\\u0BAE\\\\u0BCD\\\"},set:{unit:\\\"\\\\u0B89\\\\u0BB1\\\\u0BC1\\\\u0BAA\\\\u0BCD\\\\u0BAA\\\\u0BC1\\\\u0B95\\\\u0BB3\\\\u0BCD\\\",verb:\\\"\\\\u0B95\\\\u0BCA\\\\u0BA3\\\\u0BCD\\\\u0B9F\\\\u0BBF\\\\u0BB0\\\\u0BC1\\\\u0B95\\\\u0BCD\\\\u0B95 \\\\u0BB5\\\\u0BC7\\\\u0BA3\\\\u0BCD\\\\u0B9F\\\\u0BC1\\\\u0BAE\\\\u0BCD\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"\\\\u0B8E\\\\u0BA3\\\\u0BCD \\\\u0B85\\\\u0BB2\\\\u0BCD\\\\u0BB2\\\\u0BBE\\\\u0BA4\\\\u0BA4\\\\u0BC1\\\":\\\"\\\\u0B8E\\\\u0BA3\\\\u0BCD\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"\\\\u0B85\\\\u0BA3\\\\u0BBF\\\";if(t===null)return\\\"\\\\u0BB5\\\\u0BC6\\\\u0BB1\\\\u0BC1\\\\u0BAE\\\\u0BC8\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"\\\\u0B89\\\\u0BB3\\\\u0BCD\\\\u0BB3\\\\u0BC0\\\\u0B9F\\\\u0BC1\\\",email:\\\"\\\\u0BAE\\\\u0BBF\\\\u0BA9\\\\u0BCD\\\\u0BA9\\\\u0B9E\\\\u0BCD\\\\u0B9A\\\\u0BB2\\\\u0BCD \\\\u0BAE\\\\u0BC1\\\\u0B95\\\\u0BB5\\\\u0BB0\\\\u0BBF\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO \\\\u0BA4\\\\u0BC7\\\\u0BA4\\\\u0BBF \\\\u0BA8\\\\u0BC7\\\\u0BB0\\\\u0BAE\\\\u0BCD\\\",date:\\\"ISO \\\\u0BA4\\\\u0BC7\\\\u0BA4\\\\u0BBF\\\",time:\\\"ISO \\\\u0BA8\\\\u0BC7\\\\u0BB0\\\\u0BAE\\\\u0BCD\\\",duration:\\\"ISO \\\\u0B95\\\\u0BBE\\\\u0BB2 \\\\u0B85\\\\u0BB3\\\\u0BB5\\\\u0BC1\\\",ipv4:\\\"IPv4 \\\\u0BAE\\\\u0BC1\\\\u0B95\\\\u0BB5\\\\u0BB0\\\\u0BBF\\\",ipv6:\\\"IPv6 \\\\u0BAE\\\\u0BC1\\\\u0B95\\\\u0BB5\\\\u0BB0\\\\u0BBF\\\",cidrv4:\\\"IPv4 \\\\u0BB5\\\\u0BB0\\\\u0BAE\\\\u0BCD\\\\u0BAA\\\\u0BC1\\\",cidrv6:\\\"IPv6 \\\\u0BB5\\\\u0BB0\\\\u0BAE\\\\u0BCD\\\\u0BAA\\\\u0BC1\\\",base64:\\\"base64-encoded \\\\u0B9A\\\\u0BB0\\\\u0BAE\\\\u0BCD\\\",base64url:\\\"base64url-encoded \\\\u0B9A\\\\u0BB0\\\\u0BAE\\\\u0BCD\\\",json_string:\\\"JSON \\\\u0B9A\\\\u0BB0\\\\u0BAE\\\\u0BCD\\\",e164:\\\"E.164 \\\\u0B8E\\\\u0BA3\\\\u0BCD\\\",jwt:\\\"JWT\\\",template_literal:\\\"input\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\u0BA4\\\\u0BB5\\\\u0BB1\\\\u0BBE\\\\u0BA9 \\\\u0B89\\\\u0BB3\\\\u0BCD\\\\u0BB3\\\\u0BC0\\\\u0B9F\\\\u0BC1: \\\\u0B8E\\\\u0BA4\\\\u0BBF\\\\u0BB0\\\\u0BCD\\\\u0BAA\\\\u0BBE\\\\u0BB0\\\\u0BCD\\\\u0B95\\\\u0BCD\\\\u0B95\\\\u0BAA\\\\u0BCD\\\\u0BAA\\\\u0B9F\\\\u0BCD\\\\u0B9F\\\\u0BA4\\\\u0BC1 ${t.expected}, \\\\u0BAA\\\\u0BC6\\\\u0BB1\\\\u0BAA\\\\u0BCD\\\\u0BAA\\\\u0B9F\\\\u0BCD\\\\u0B9F\\\\u0BA4\\\\u0BC1 ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`\\\\u0BA4\\\\u0BB5\\\\u0BB1\\\\u0BBE\\\\u0BA9 \\\\u0B89\\\\u0BB3\\\\u0BCD\\\\u0BB3\\\\u0BC0\\\\u0B9F\\\\u0BC1: \\\\u0B8E\\\\u0BA4\\\\u0BBF\\\\u0BB0\\\\u0BCD\\\\u0BAA\\\\u0BBE\\\\u0BB0\\\\u0BCD\\\\u0B95\\\\u0BCD\\\\u0B95\\\\u0BAA\\\\u0BCD\\\\u0BAA\\\\u0B9F\\\\u0BCD\\\\u0B9F\\\\u0BA4\\\\u0BC1 ${p(t.values[0])}`:`\\\\u0BA4\\\\u0BB5\\\\u0BB1\\\\u0BBE\\\\u0BA9 \\\\u0BB5\\\\u0BBF\\\\u0BB0\\\\u0BC1\\\\u0BAA\\\\u0BCD\\\\u0BAA\\\\u0BAE\\\\u0BCD: \\\\u0B8E\\\\u0BA4\\\\u0BBF\\\\u0BB0\\\\u0BCD\\\\u0BAA\\\\u0BBE\\\\u0BB0\\\\u0BCD\\\\u0B95\\\\u0BCD\\\\u0B95\\\\u0BAA\\\\u0BCD\\\\u0BAA\\\\u0B9F\\\\u0BCD\\\\u0B9F\\\\u0BA4\\\\u0BC1 ${l(t.values,\\\"|\\\")} \\\\u0B87\\\\u0BB2\\\\u0BCD \\\\u0B92\\\\u0BA9\\\\u0BCD\\\\u0BB1\\\\u0BC1`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`\\\\u0BAE\\\\u0BBF\\\\u0B95 \\\\u0BAA\\\\u0BC6\\\\u0BB0\\\\u0BBF\\\\u0BAF\\\\u0BA4\\\\u0BC1: \\\\u0B8E\\\\u0BA4\\\\u0BBF\\\\u0BB0\\\\u0BCD\\\\u0BAA\\\\u0BBE\\\\u0BB0\\\\u0BCD\\\\u0B95\\\\u0BCD\\\\u0B95\\\\u0BAA\\\\u0BCD\\\\u0BAA\\\\u0B9F\\\\u0BCD\\\\u0B9F\\\\u0BA4\\\\u0BC1 ${t.origin??\\\"\\\\u0BAE\\\\u0BA4\\\\u0BBF\\\\u0BAA\\\\u0BCD\\\\u0BAA\\\\u0BC1\\\"} ${i}${t.maximum.toString()} ${a.unit??\\\"\\\\u0B89\\\\u0BB1\\\\u0BC1\\\\u0BAA\\\\u0BCD\\\\u0BAA\\\\u0BC1\\\\u0B95\\\\u0BB3\\\\u0BCD\\\"} \\\\u0B86\\\\u0B95 \\\\u0B87\\\\u0BB0\\\\u0BC1\\\\u0B95\\\\u0BCD\\\\u0B95 \\\\u0BB5\\\\u0BC7\\\\u0BA3\\\\u0BCD\\\\u0B9F\\\\u0BC1\\\\u0BAE\\\\u0BCD`:`\\\\u0BAE\\\\u0BBF\\\\u0B95 \\\\u0BAA\\\\u0BC6\\\\u0BB0\\\\u0BBF\\\\u0BAF\\\\u0BA4\\\\u0BC1: \\\\u0B8E\\\\u0BA4\\\\u0BBF\\\\u0BB0\\\\u0BCD\\\\u0BAA\\\\u0BBE\\\\u0BB0\\\\u0BCD\\\\u0B95\\\\u0BCD\\\\u0B95\\\\u0BAA\\\\u0BCD\\\\u0BAA\\\\u0B9F\\\\u0BCD\\\\u0B9F\\\\u0BA4\\\\u0BC1 ${t.origin??\\\"\\\\u0BAE\\\\u0BA4\\\\u0BBF\\\\u0BAA\\\\u0BCD\\\\u0BAA\\\\u0BC1\\\"} ${i}${t.maximum.toString()} \\\\u0B86\\\\u0B95 \\\\u0B87\\\\u0BB0\\\\u0BC1\\\\u0B95\\\\u0BCD\\\\u0B95 \\\\u0BB5\\\\u0BC7\\\\u0BA3\\\\u0BCD\\\\u0B9F\\\\u0BC1\\\\u0BAE\\\\u0BCD`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`\\\\u0BAE\\\\u0BBF\\\\u0B95\\\\u0B9A\\\\u0BCD \\\\u0B9A\\\\u0BBF\\\\u0BB1\\\\u0BBF\\\\u0BAF\\\\u0BA4\\\\u0BC1: \\\\u0B8E\\\\u0BA4\\\\u0BBF\\\\u0BB0\\\\u0BCD\\\\u0BAA\\\\u0BBE\\\\u0BB0\\\\u0BCD\\\\u0B95\\\\u0BCD\\\\u0B95\\\\u0BAA\\\\u0BCD\\\\u0BAA\\\\u0B9F\\\\u0BCD\\\\u0B9F\\\\u0BA4\\\\u0BC1 ${t.origin} ${i}${t.minimum.toString()} ${a.unit} \\\\u0B86\\\\u0B95 \\\\u0B87\\\\u0BB0\\\\u0BC1\\\\u0B95\\\\u0BCD\\\\u0B95 \\\\u0BB5\\\\u0BC7\\\\u0BA3\\\\u0BCD\\\\u0B9F\\\\u0BC1\\\\u0BAE\\\\u0BCD`:`\\\\u0BAE\\\\u0BBF\\\\u0B95\\\\u0B9A\\\\u0BCD \\\\u0B9A\\\\u0BBF\\\\u0BB1\\\\u0BBF\\\\u0BAF\\\\u0BA4\\\\u0BC1: \\\\u0B8E\\\\u0BA4\\\\u0BBF\\\\u0BB0\\\\u0BCD\\\\u0BAA\\\\u0BBE\\\\u0BB0\\\\u0BCD\\\\u0B95\\\\u0BCD\\\\u0B95\\\\u0BAA\\\\u0BCD\\\\u0BAA\\\\u0B9F\\\\u0BCD\\\\u0B9F\\\\u0BA4\\\\u0BC1 ${t.origin} ${i}${t.minimum.toString()} \\\\u0B86\\\\u0B95 \\\\u0B87\\\\u0BB0\\\\u0BC1\\\\u0B95\\\\u0BCD\\\\u0B95 \\\\u0BB5\\\\u0BC7\\\\u0BA3\\\\u0BCD\\\\u0B9F\\\\u0BC1\\\\u0BAE\\\\u0BCD`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`\\\\u0BA4\\\\u0BB5\\\\u0BB1\\\\u0BBE\\\\u0BA9 \\\\u0B9A\\\\u0BB0\\\\u0BAE\\\\u0BCD: \\\"${i.prefix}\\\" \\\\u0B87\\\\u0BB2\\\\u0BCD \\\\u0BA4\\\\u0BCA\\\\u0B9F\\\\u0B99\\\\u0BCD\\\\u0B95 \\\\u0BB5\\\\u0BC7\\\\u0BA3\\\\u0BCD\\\\u0B9F\\\\u0BC1\\\\u0BAE\\\\u0BCD`:i.format===\\\"ends_with\\\"?`\\\\u0BA4\\\\u0BB5\\\\u0BB1\\\\u0BBE\\\\u0BA9 \\\\u0B9A\\\\u0BB0\\\\u0BAE\\\\u0BCD: \\\"${i.suffix}\\\" \\\\u0B87\\\\u0BB2\\\\u0BCD \\\\u0BAE\\\\u0BC1\\\\u0B9F\\\\u0BBF\\\\u0BB5\\\\u0B9F\\\\u0BC8\\\\u0BAF \\\\u0BB5\\\\u0BC7\\\\u0BA3\\\\u0BCD\\\\u0B9F\\\\u0BC1\\\\u0BAE\\\\u0BCD`:i.format===\\\"includes\\\"?`\\\\u0BA4\\\\u0BB5\\\\u0BB1\\\\u0BBE\\\\u0BA9 \\\\u0B9A\\\\u0BB0\\\\u0BAE\\\\u0BCD: \\\"${i.includes}\\\" \\\\u0B90 \\\\u0B89\\\\u0BB3\\\\u0BCD\\\\u0BB3\\\\u0B9F\\\\u0B95\\\\u0BCD\\\\u0B95 \\\\u0BB5\\\\u0BC7\\\\u0BA3\\\\u0BCD\\\\u0B9F\\\\u0BC1\\\\u0BAE\\\\u0BCD`:i.format===\\\"regex\\\"?`\\\\u0BA4\\\\u0BB5\\\\u0BB1\\\\u0BBE\\\\u0BA9 \\\\u0B9A\\\\u0BB0\\\\u0BAE\\\\u0BCD: ${i.pattern} \\\\u0BAE\\\\u0BC1\\\\u0BB1\\\\u0BC8\\\\u0BAA\\\\u0BBE\\\\u0B9F\\\\u0BCD\\\\u0B9F\\\\u0BC1\\\\u0B9F\\\\u0BA9\\\\u0BCD \\\\u0BAA\\\\u0BCA\\\\u0BB0\\\\u0BC1\\\\u0BA8\\\\u0BCD\\\\u0BA4 \\\\u0BB5\\\\u0BC7\\\\u0BA3\\\\u0BCD\\\\u0B9F\\\\u0BC1\\\\u0BAE\\\\u0BCD`:`\\\\u0BA4\\\\u0BB5\\\\u0BB1\\\\u0BBE\\\\u0BA9 ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`\\\\u0BA4\\\\u0BB5\\\\u0BB1\\\\u0BBE\\\\u0BA9 \\\\u0B8E\\\\u0BA3\\\\u0BCD: ${t.divisor} \\\\u0B87\\\\u0BA9\\\\u0BCD \\\\u0BAA\\\\u0BB2\\\\u0BAE\\\\u0BBE\\\\u0B95 \\\\u0B87\\\\u0BB0\\\\u0BC1\\\\u0B95\\\\u0BCD\\\\u0B95 \\\\u0BB5\\\\u0BC7\\\\u0BA3\\\\u0BCD\\\\u0B9F\\\\u0BC1\\\\u0BAE\\\\u0BCD`;case\\\"unrecognized_keys\\\":return`\\\\u0B85\\\\u0B9F\\\\u0BC8\\\\u0BAF\\\\u0BBE\\\\u0BB3\\\\u0BAE\\\\u0BCD \\\\u0BA4\\\\u0BC6\\\\u0BB0\\\\u0BBF\\\\u0BAF\\\\u0BBE\\\\u0BA4 \\\\u0BB5\\\\u0BBF\\\\u0B9A\\\\u0BC8${t.keys.length>1?\\\"\\\\u0B95\\\\u0BB3\\\\u0BCD\\\":\\\"\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`${t.origin} \\\\u0B87\\\\u0BB2\\\\u0BCD \\\\u0BA4\\\\u0BB5\\\\u0BB1\\\\u0BBE\\\\u0BA9 \\\\u0BB5\\\\u0BBF\\\\u0B9A\\\\u0BC8`;case\\\"invalid_union\\\":return\\\"\\\\u0BA4\\\\u0BB5\\\\u0BB1\\\\u0BBE\\\\u0BA9 \\\\u0B89\\\\u0BB3\\\\u0BCD\\\\u0BB3\\\\u0BC0\\\\u0B9F\\\\u0BC1\\\";case\\\"invalid_element\\\":return`${t.origin} \\\\u0B87\\\\u0BB2\\\\u0BCD \\\\u0BA4\\\\u0BB5\\\\u0BB1\\\\u0BBE\\\\u0BA9 \\\\u0BAE\\\\u0BA4\\\\u0BBF\\\\u0BAA\\\\u0BCD\\\\u0BAA\\\\u0BC1`;default:return\\\"\\\\u0BA4\\\\u0BB5\\\\u0BB1\\\\u0BBE\\\\u0BA9 \\\\u0B89\\\\u0BB3\\\\u0BCD\\\\u0BB3\\\\u0BC0\\\\u0B9F\\\\u0BC1\\\"}}};function nc(){return{localeError:nd()}}var id=()=>{let e={string:{unit:\\\"\\\\u0E15\\\\u0E31\\\\u0E27\\\\u0E2D\\\\u0E31\\\\u0E01\\\\u0E29\\\\u0E23\\\",verb:\\\"\\\\u0E04\\\\u0E27\\\\u0E23\\\\u0E21\\\\u0E35\\\"},file:{unit:\\\"\\\\u0E44\\\\u0E1A\\\\u0E15\\\\u0E4C\\\",verb:\\\"\\\\u0E04\\\\u0E27\\\\u0E23\\\\u0E21\\\\u0E35\\\"},array:{unit:\\\"\\\\u0E23\\\\u0E32\\\\u0E22\\\\u0E01\\\\u0E32\\\\u0E23\\\",verb:\\\"\\\\u0E04\\\\u0E27\\\\u0E23\\\\u0E21\\\\u0E35\\\"},set:{unit:\\\"\\\\u0E23\\\\u0E32\\\\u0E22\\\\u0E01\\\\u0E32\\\\u0E23\\\",verb:\\\"\\\\u0E04\\\\u0E27\\\\u0E23\\\\u0E21\\\\u0E35\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"\\\\u0E44\\\\u0E21\\\\u0E48\\\\u0E43\\\\u0E0A\\\\u0E48\\\\u0E15\\\\u0E31\\\\u0E27\\\\u0E40\\\\u0E25\\\\u0E02 (NaN)\\\":\\\"\\\\u0E15\\\\u0E31\\\\u0E27\\\\u0E40\\\\u0E25\\\\u0E02\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"\\\\u0E2D\\\\u0E32\\\\u0E23\\\\u0E4C\\\\u0E40\\\\u0E23\\\\u0E22\\\\u0E4C (Array)\\\";if(t===null)return\\\"\\\\u0E44\\\\u0E21\\\\u0E48\\\\u0E21\\\\u0E35\\\\u0E04\\\\u0E48\\\\u0E32 (null)\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"\\\\u0E02\\\\u0E49\\\\u0E2D\\\\u0E21\\\\u0E39\\\\u0E25\\\\u0E17\\\\u0E35\\\\u0E48\\\\u0E1B\\\\u0E49\\\\u0E2D\\\\u0E19\\\",email:\\\"\\\\u0E17\\\\u0E35\\\\u0E48\\\\u0E2D\\\\u0E22\\\\u0E39\\\\u0E48\\\\u0E2D\\\\u0E35\\\\u0E40\\\\u0E21\\\\u0E25\\\",url:\\\"URL\\\",emoji:\\\"\\\\u0E2D\\\\u0E34\\\\u0E42\\\\u0E21\\\\u0E08\\\\u0E34\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"\\\\u0E27\\\\u0E31\\\\u0E19\\\\u0E17\\\\u0E35\\\\u0E48\\\\u0E40\\\\u0E27\\\\u0E25\\\\u0E32\\\\u0E41\\\\u0E1A\\\\u0E1A ISO\\\",date:\\\"\\\\u0E27\\\\u0E31\\\\u0E19\\\\u0E17\\\\u0E35\\\\u0E48\\\\u0E41\\\\u0E1A\\\\u0E1A ISO\\\",time:\\\"\\\\u0E40\\\\u0E27\\\\u0E25\\\\u0E32\\\\u0E41\\\\u0E1A\\\\u0E1A ISO\\\",duration:\\\"\\\\u0E0A\\\\u0E48\\\\u0E27\\\\u0E07\\\\u0E40\\\\u0E27\\\\u0E25\\\\u0E32\\\\u0E41\\\\u0E1A\\\\u0E1A ISO\\\",ipv4:\\\"\\\\u0E17\\\\u0E35\\\\u0E48\\\\u0E2D\\\\u0E22\\\\u0E39\\\\u0E48 IPv4\\\",ipv6:\\\"\\\\u0E17\\\\u0E35\\\\u0E48\\\\u0E2D\\\\u0E22\\\\u0E39\\\\u0E48 IPv6\\\",cidrv4:\\\"\\\\u0E0A\\\\u0E48\\\\u0E27\\\\u0E07 IP \\\\u0E41\\\\u0E1A\\\\u0E1A IPv4\\\",cidrv6:\\\"\\\\u0E0A\\\\u0E48\\\\u0E27\\\\u0E07 IP \\\\u0E41\\\\u0E1A\\\\u0E1A IPv6\\\",base64:\\\"\\\\u0E02\\\\u0E49\\\\u0E2D\\\\u0E04\\\\u0E27\\\\u0E32\\\\u0E21\\\\u0E41\\\\u0E1A\\\\u0E1A Base64\\\",base64url:\\\"\\\\u0E02\\\\u0E49\\\\u0E2D\\\\u0E04\\\\u0E27\\\\u0E32\\\\u0E21\\\\u0E41\\\\u0E1A\\\\u0E1A Base64 \\\\u0E2A\\\\u0E33\\\\u0E2B\\\\u0E23\\\\u0E31\\\\u0E1A URL\\\",json_string:\\\"\\\\u0E02\\\\u0E49\\\\u0E2D\\\\u0E04\\\\u0E27\\\\u0E32\\\\u0E21\\\\u0E41\\\\u0E1A\\\\u0E1A JSON\\\",e164:\\\"\\\\u0E40\\\\u0E1A\\\\u0E2D\\\\u0E23\\\\u0E4C\\\\u0E42\\\\u0E17\\\\u0E23\\\\u0E28\\\\u0E31\\\\u0E1E\\\\u0E17\\\\u0E4C\\\\u0E23\\\\u0E30\\\\u0E2B\\\\u0E27\\\\u0E48\\\\u0E32\\\\u0E07\\\\u0E1B\\\\u0E23\\\\u0E30\\\\u0E40\\\\u0E17\\\\u0E28 (E.164)\\\",jwt:\\\"\\\\u0E42\\\\u0E17\\\\u0E40\\\\u0E04\\\\u0E19 JWT\\\",template_literal:\\\"\\\\u0E02\\\\u0E49\\\\u0E2D\\\\u0E21\\\\u0E39\\\\u0E25\\\\u0E17\\\\u0E35\\\\u0E48\\\\u0E1B\\\\u0E49\\\\u0E2D\\\\u0E19\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\u0E1B\\\\u0E23\\\\u0E30\\\\u0E40\\\\u0E20\\\\u0E17\\\\u0E02\\\\u0E49\\\\u0E2D\\\\u0E21\\\\u0E39\\\\u0E25\\\\u0E44\\\\u0E21\\\\u0E48\\\\u0E16\\\\u0E39\\\\u0E01\\\\u0E15\\\\u0E49\\\\u0E2D\\\\u0E07: \\\\u0E04\\\\u0E27\\\\u0E23\\\\u0E40\\\\u0E1B\\\\u0E47\\\\u0E19 ${t.expected} \\\\u0E41\\\\u0E15\\\\u0E48\\\\u0E44\\\\u0E14\\\\u0E49\\\\u0E23\\\\u0E31\\\\u0E1A ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`\\\\u0E04\\\\u0E48\\\\u0E32\\\\u0E44\\\\u0E21\\\\u0E48\\\\u0E16\\\\u0E39\\\\u0E01\\\\u0E15\\\\u0E49\\\\u0E2D\\\\u0E07: \\\\u0E04\\\\u0E27\\\\u0E23\\\\u0E40\\\\u0E1B\\\\u0E47\\\\u0E19 ${p(t.values[0])}`:`\\\\u0E15\\\\u0E31\\\\u0E27\\\\u0E40\\\\u0E25\\\\u0E37\\\\u0E2D\\\\u0E01\\\\u0E44\\\\u0E21\\\\u0E48\\\\u0E16\\\\u0E39\\\\u0E01\\\\u0E15\\\\u0E49\\\\u0E2D\\\\u0E07: \\\\u0E04\\\\u0E27\\\\u0E23\\\\u0E40\\\\u0E1B\\\\u0E47\\\\u0E19\\\\u0E2B\\\\u0E19\\\\u0E36\\\\u0E48\\\\u0E07\\\\u0E43\\\\u0E19 ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"\\\\u0E44\\\\u0E21\\\\u0E48\\\\u0E40\\\\u0E01\\\\u0E34\\\\u0E19\\\":\\\"\\\\u0E19\\\\u0E49\\\\u0E2D\\\\u0E22\\\\u0E01\\\\u0E27\\\\u0E48\\\\u0E32\\\",a=r(t.origin);return a?`\\\\u0E40\\\\u0E01\\\\u0E34\\\\u0E19\\\\u0E01\\\\u0E33\\\\u0E2B\\\\u0E19\\\\u0E14: ${t.origin??\\\"\\\\u0E04\\\\u0E48\\\\u0E32\\\"} \\\\u0E04\\\\u0E27\\\\u0E23\\\\u0E21\\\\u0E35${i} ${t.maximum.toString()} ${a.unit??\\\"\\\\u0E23\\\\u0E32\\\\u0E22\\\\u0E01\\\\u0E32\\\\u0E23\\\"}`:`\\\\u0E40\\\\u0E01\\\\u0E34\\\\u0E19\\\\u0E01\\\\u0E33\\\\u0E2B\\\\u0E19\\\\u0E14: ${t.origin??\\\"\\\\u0E04\\\\u0E48\\\\u0E32\\\"} \\\\u0E04\\\\u0E27\\\\u0E23\\\\u0E21\\\\u0E35${i} ${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\"\\\\u0E2D\\\\u0E22\\\\u0E48\\\\u0E32\\\\u0E07\\\\u0E19\\\\u0E49\\\\u0E2D\\\\u0E22\\\":\\\"\\\\u0E21\\\\u0E32\\\\u0E01\\\\u0E01\\\\u0E27\\\\u0E48\\\\u0E32\\\",a=r(t.origin);return a?`\\\\u0E19\\\\u0E49\\\\u0E2D\\\\u0E22\\\\u0E01\\\\u0E27\\\\u0E48\\\\u0E32\\\\u0E01\\\\u0E33\\\\u0E2B\\\\u0E19\\\\u0E14: ${t.origin} \\\\u0E04\\\\u0E27\\\\u0E23\\\\u0E21\\\\u0E35${i} ${t.minimum.toString()} ${a.unit}`:`\\\\u0E19\\\\u0E49\\\\u0E2D\\\\u0E22\\\\u0E01\\\\u0E27\\\\u0E48\\\\u0E32\\\\u0E01\\\\u0E33\\\\u0E2B\\\\u0E19\\\\u0E14: ${t.origin} \\\\u0E04\\\\u0E27\\\\u0E23\\\\u0E21\\\\u0E35${i} ${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`\\\\u0E23\\\\u0E39\\\\u0E1B\\\\u0E41\\\\u0E1A\\\\u0E1A\\\\u0E44\\\\u0E21\\\\u0E48\\\\u0E16\\\\u0E39\\\\u0E01\\\\u0E15\\\\u0E49\\\\u0E2D\\\\u0E07: \\\\u0E02\\\\u0E49\\\\u0E2D\\\\u0E04\\\\u0E27\\\\u0E32\\\\u0E21\\\\u0E15\\\\u0E49\\\\u0E2D\\\\u0E07\\\\u0E02\\\\u0E36\\\\u0E49\\\\u0E19\\\\u0E15\\\\u0E49\\\\u0E19\\\\u0E14\\\\u0E49\\\\u0E27\\\\u0E22 \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`\\\\u0E23\\\\u0E39\\\\u0E1B\\\\u0E41\\\\u0E1A\\\\u0E1A\\\\u0E44\\\\u0E21\\\\u0E48\\\\u0E16\\\\u0E39\\\\u0E01\\\\u0E15\\\\u0E49\\\\u0E2D\\\\u0E07: \\\\u0E02\\\\u0E49\\\\u0E2D\\\\u0E04\\\\u0E27\\\\u0E32\\\\u0E21\\\\u0E15\\\\u0E49\\\\u0E2D\\\\u0E07\\\\u0E25\\\\u0E07\\\\u0E17\\\\u0E49\\\\u0E32\\\\u0E22\\\\u0E14\\\\u0E49\\\\u0E27\\\\u0E22 \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`\\\\u0E23\\\\u0E39\\\\u0E1B\\\\u0E41\\\\u0E1A\\\\u0E1A\\\\u0E44\\\\u0E21\\\\u0E48\\\\u0E16\\\\u0E39\\\\u0E01\\\\u0E15\\\\u0E49\\\\u0E2D\\\\u0E07: \\\\u0E02\\\\u0E49\\\\u0E2D\\\\u0E04\\\\u0E27\\\\u0E32\\\\u0E21\\\\u0E15\\\\u0E49\\\\u0E2D\\\\u0E07\\\\u0E21\\\\u0E35 \\\"${i.includes}\\\" \\\\u0E2D\\\\u0E22\\\\u0E39\\\\u0E48\\\\u0E43\\\\u0E19\\\\u0E02\\\\u0E49\\\\u0E2D\\\\u0E04\\\\u0E27\\\\u0E32\\\\u0E21`:i.format===\\\"regex\\\"?`\\\\u0E23\\\\u0E39\\\\u0E1B\\\\u0E41\\\\u0E1A\\\\u0E1A\\\\u0E44\\\\u0E21\\\\u0E48\\\\u0E16\\\\u0E39\\\\u0E01\\\\u0E15\\\\u0E49\\\\u0E2D\\\\u0E07: \\\\u0E15\\\\u0E49\\\\u0E2D\\\\u0E07\\\\u0E15\\\\u0E23\\\\u0E07\\\\u0E01\\\\u0E31\\\\u0E1A\\\\u0E23\\\\u0E39\\\\u0E1B\\\\u0E41\\\\u0E1A\\\\u0E1A\\\\u0E17\\\\u0E35\\\\u0E48\\\\u0E01\\\\u0E33\\\\u0E2B\\\\u0E19\\\\u0E14 ${i.pattern}`:`\\\\u0E23\\\\u0E39\\\\u0E1B\\\\u0E41\\\\u0E1A\\\\u0E1A\\\\u0E44\\\\u0E21\\\\u0E48\\\\u0E16\\\\u0E39\\\\u0E01\\\\u0E15\\\\u0E49\\\\u0E2D\\\\u0E07: ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`\\\\u0E15\\\\u0E31\\\\u0E27\\\\u0E40\\\\u0E25\\\\u0E02\\\\u0E44\\\\u0E21\\\\u0E48\\\\u0E16\\\\u0E39\\\\u0E01\\\\u0E15\\\\u0E49\\\\u0E2D\\\\u0E07: \\\\u0E15\\\\u0E49\\\\u0E2D\\\\u0E07\\\\u0E40\\\\u0E1B\\\\u0E47\\\\u0E19\\\\u0E08\\\\u0E33\\\\u0E19\\\\u0E27\\\\u0E19\\\\u0E17\\\\u0E35\\\\u0E48\\\\u0E2B\\\\u0E32\\\\u0E23\\\\u0E14\\\\u0E49\\\\u0E27\\\\u0E22 ${t.divisor} \\\\u0E44\\\\u0E14\\\\u0E49\\\\u0E25\\\\u0E07\\\\u0E15\\\\u0E31\\\\u0E27`;case\\\"unrecognized_keys\\\":return`\\\\u0E1E\\\\u0E1A\\\\u0E04\\\\u0E35\\\\u0E22\\\\u0E4C\\\\u0E17\\\\u0E35\\\\u0E48\\\\u0E44\\\\u0E21\\\\u0E48\\\\u0E23\\\\u0E39\\\\u0E49\\\\u0E08\\\\u0E31\\\\u0E01: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`\\\\u0E04\\\\u0E35\\\\u0E22\\\\u0E4C\\\\u0E44\\\\u0E21\\\\u0E48\\\\u0E16\\\\u0E39\\\\u0E01\\\\u0E15\\\\u0E49\\\\u0E2D\\\\u0E07\\\\u0E43\\\\u0E19 ${t.origin}`;case\\\"invalid_union\\\":return\\\"\\\\u0E02\\\\u0E49\\\\u0E2D\\\\u0E21\\\\u0E39\\\\u0E25\\\\u0E44\\\\u0E21\\\\u0E48\\\\u0E16\\\\u0E39\\\\u0E01\\\\u0E15\\\\u0E49\\\\u0E2D\\\\u0E07: \\\\u0E44\\\\u0E21\\\\u0E48\\\\u0E15\\\\u0E23\\\\u0E07\\\\u0E01\\\\u0E31\\\\u0E1A\\\\u0E23\\\\u0E39\\\\u0E1B\\\\u0E41\\\\u0E1A\\\\u0E1A\\\\u0E22\\\\u0E39\\\\u0E40\\\\u0E19\\\\u0E35\\\\u0E22\\\\u0E19\\\\u0E17\\\\u0E35\\\\u0E48\\\\u0E01\\\\u0E33\\\\u0E2B\\\\u0E19\\\\u0E14\\\\u0E44\\\\u0E27\\\\u0E49\\\";case\\\"invalid_element\\\":return`\\\\u0E02\\\\u0E49\\\\u0E2D\\\\u0E21\\\\u0E39\\\\u0E25\\\\u0E44\\\\u0E21\\\\u0E48\\\\u0E16\\\\u0E39\\\\u0E01\\\\u0E15\\\\u0E49\\\\u0E2D\\\\u0E07\\\\u0E43\\\\u0E19 ${t.origin}`;default:return\\\"\\\\u0E02\\\\u0E49\\\\u0E2D\\\\u0E21\\\\u0E39\\\\u0E25\\\\u0E44\\\\u0E21\\\\u0E48\\\\u0E16\\\\u0E39\\\\u0E01\\\\u0E15\\\\u0E49\\\\u0E2D\\\\u0E07\\\"}}};function ic(){return{localeError:id()}}var od=e=>{let r=typeof e;switch(r){case\\\"number\\\":return Number.isNaN(e)?\\\"NaN\\\":\\\"number\\\";case\\\"object\\\":{if(Array.isArray(e))return\\\"array\\\";if(e===null)return\\\"null\\\";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return r},ad=()=>{let e={string:{unit:\\\"karakter\\\",verb:\\\"olmal\\\\u0131\\\"},file:{unit:\\\"bayt\\\",verb:\\\"olmal\\\\u0131\\\"},array:{unit:\\\"\\\\xF6\\\\u011Fe\\\",verb:\\\"olmal\\\\u0131\\\"},set:{unit:\\\"\\\\xF6\\\\u011Fe\\\",verb:\\\"olmal\\\\u0131\\\"}};function r(o){return e[o]??null}let n={regex:\\\"girdi\\\",email:\\\"e-posta adresi\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO tarih ve saat\\\",date:\\\"ISO tarih\\\",time:\\\"ISO saat\\\",duration:\\\"ISO s\\\\xFCre\\\",ipv4:\\\"IPv4 adresi\\\",ipv6:\\\"IPv6 adresi\\\",cidrv4:\\\"IPv4 aral\\\\u0131\\\\u011F\\\\u0131\\\",cidrv6:\\\"IPv6 aral\\\\u0131\\\\u011F\\\\u0131\\\",base64:\\\"base64 ile \\\\u015Fifrelenmi\\\\u015F metin\\\",base64url:\\\"base64url ile \\\\u015Fifrelenmi\\\\u015F metin\\\",json_string:\\\"JSON dizesi\\\",e164:\\\"E.164 say\\\\u0131s\\\\u0131\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\u015Eablon dizesi\\\"};return o=>{switch(o.code){case\\\"invalid_type\\\":return`Ge\\\\xE7ersiz de\\\\u011Fer: beklenen ${o.expected}, al\\\\u0131nan ${od(o.input)}`;case\\\"invalid_value\\\":return o.values.length===1?`Ge\\\\xE7ersiz de\\\\u011Fer: beklenen ${p(o.values[0])}`:`Ge\\\\xE7ersiz se\\\\xE7enek: a\\\\u015Fa\\\\u011F\\\\u0131dakilerden biri olmal\\\\u0131: ${l(o.values,\\\"|\\\")}`;case\\\"too_big\\\":{let t=o.inclusive?\\\"<=\\\":\\\"<\\\",i=r(o.origin);return i?`\\\\xC7ok b\\\\xFCy\\\\xFCk: beklenen ${o.origin??\\\"de\\\\u011Fer\\\"} ${t}${o.maximum.toString()} ${i.unit??\\\"\\\\xF6\\\\u011Fe\\\"}`:`\\\\xC7ok b\\\\xFCy\\\\xFCk: beklenen ${o.origin??\\\"de\\\\u011Fer\\\"} ${t}${o.maximum.toString()}`}case\\\"too_small\\\":{let t=o.inclusive?\\\">=\\\":\\\">\\\",i=r(o.origin);return i?`\\\\xC7ok k\\\\xFC\\\\xE7\\\\xFCk: beklenen ${o.origin} ${t}${o.minimum.toString()} ${i.unit}`:`\\\\xC7ok k\\\\xFC\\\\xE7\\\\xFCk: beklenen ${o.origin} ${t}${o.minimum.toString()}`}case\\\"invalid_format\\\":{let t=o;return t.format===\\\"starts_with\\\"?`Ge\\\\xE7ersiz metin: \\\"${t.prefix}\\\" ile ba\\\\u015Flamal\\\\u0131`:t.format===\\\"ends_with\\\"?`Ge\\\\xE7ersiz metin: \\\"${t.suffix}\\\" ile bitmeli`:t.format===\\\"includes\\\"?`Ge\\\\xE7ersiz metin: \\\"${t.includes}\\\" i\\\\xE7ermeli`:t.format===\\\"regex\\\"?`Ge\\\\xE7ersiz metin: ${t.pattern} desenine uymal\\\\u0131`:`Ge\\\\xE7ersiz ${n[t.format]??o.format}`}case\\\"not_multiple_of\\\":return`Ge\\\\xE7ersiz say\\\\u0131: ${o.divisor} ile tam b\\\\xF6l\\\\xFCnebilmeli`;case\\\"unrecognized_keys\\\":return`Tan\\\\u0131nmayan anahtar${o.keys.length>1?\\\"lar\\\":\\\"\\\"}: ${l(o.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`${o.origin} i\\\\xE7inde ge\\\\xE7ersiz anahtar`;case\\\"invalid_union\\\":return\\\"Ge\\\\xE7ersiz de\\\\u011Fer\\\";case\\\"invalid_element\\\":return`${o.origin} i\\\\xE7inde ge\\\\xE7ersiz de\\\\u011Fer`;default:return\\\"Ge\\\\xE7ersiz de\\\\u011Fer\\\"}}};function oc(){return{localeError:ad()}}var ud=()=>{let e={string:{unit:\\\"\\\\u0441\\\\u0438\\\\u043C\\\\u0432\\\\u043E\\\\u043B\\\\u0456\\\\u0432\\\",verb:\\\"\\\\u043C\\\\u0430\\\\u0442\\\\u0438\\\\u043C\\\\u0435\\\"},file:{unit:\\\"\\\\u0431\\\\u0430\\\\u0439\\\\u0442\\\\u0456\\\\u0432\\\",verb:\\\"\\\\u043C\\\\u0430\\\\u0442\\\\u0438\\\\u043C\\\\u0435\\\"},array:{unit:\\\"\\\\u0435\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\\u0456\\\\u0432\\\",verb:\\\"\\\\u043C\\\\u0430\\\\u0442\\\\u0438\\\\u043C\\\\u0435\\\"},set:{unit:\\\"\\\\u0435\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\\u0456\\\\u0432\\\",verb:\\\"\\\\u043C\\\\u0430\\\\u0442\\\\u0438\\\\u043C\\\\u0435\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"\\\\u0447\\\\u0438\\\\u0441\\\\u043B\\\\u043E\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"\\\\u043C\\\\u0430\\\\u0441\\\\u0438\\\\u0432\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"\\\\u0432\\\\u0445\\\\u0456\\\\u0434\\\\u043D\\\\u0456 \\\\u0434\\\\u0430\\\\u043D\\\\u0456\\\",email:\\\"\\\\u0430\\\\u0434\\\\u0440\\\\u0435\\\\u0441\\\\u0430 \\\\u0435\\\\u043B\\\\u0435\\\\u043A\\\\u0442\\\\u0440\\\\u043E\\\\u043D\\\\u043D\\\\u043E\\\\u0457 \\\\u043F\\\\u043E\\\\u0448\\\\u0442\\\\u0438\\\",url:\\\"URL\\\",emoji:\\\"\\\\u0435\\\\u043C\\\\u043E\\\\u0434\\\\u0437\\\\u0456\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"\\\\u0434\\\\u0430\\\\u0442\\\\u0430 \\\\u0442\\\\u0430 \\\\u0447\\\\u0430\\\\u0441 ISO\\\",date:\\\"\\\\u0434\\\\u0430\\\\u0442\\\\u0430 ISO\\\",time:\\\"\\\\u0447\\\\u0430\\\\u0441 ISO\\\",duration:\\\"\\\\u0442\\\\u0440\\\\u0438\\\\u0432\\\\u0430\\\\u043B\\\\u0456\\\\u0441\\\\u0442\\\\u044C ISO\\\",ipv4:\\\"\\\\u0430\\\\u0434\\\\u0440\\\\u0435\\\\u0441\\\\u0430 IPv4\\\",ipv6:\\\"\\\\u0430\\\\u0434\\\\u0440\\\\u0435\\\\u0441\\\\u0430 IPv6\\\",cidrv4:\\\"\\\\u0434\\\\u0456\\\\u0430\\\\u043F\\\\u0430\\\\u0437\\\\u043E\\\\u043D IPv4\\\",cidrv6:\\\"\\\\u0434\\\\u0456\\\\u0430\\\\u043F\\\\u0430\\\\u0437\\\\u043E\\\\u043D IPv6\\\",base64:\\\"\\\\u0440\\\\u044F\\\\u0434\\\\u043E\\\\u043A \\\\u0443 \\\\u043A\\\\u043E\\\\u0434\\\\u0443\\\\u0432\\\\u0430\\\\u043D\\\\u043D\\\\u0456 base64\\\",base64url:\\\"\\\\u0440\\\\u044F\\\\u0434\\\\u043E\\\\u043A \\\\u0443 \\\\u043A\\\\u043E\\\\u0434\\\\u0443\\\\u0432\\\\u0430\\\\u043D\\\\u043D\\\\u0456 base64url\\\",json_string:\\\"\\\\u0440\\\\u044F\\\\u0434\\\\u043E\\\\u043A JSON\\\",e164:\\\"\\\\u043D\\\\u043E\\\\u043C\\\\u0435\\\\u0440 E.164\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\u0432\\\\u0445\\\\u0456\\\\u0434\\\\u043D\\\\u0456 \\\\u0434\\\\u0430\\\\u043D\\\\u0456\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\u041D\\\\u0435\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0438\\\\u043B\\\\u044C\\\\u043D\\\\u0456 \\\\u0432\\\\u0445\\\\u0456\\\\u0434\\\\u043D\\\\u0456 \\\\u0434\\\\u0430\\\\u043D\\\\u0456: \\\\u043E\\\\u0447\\\\u0456\\\\u043A\\\\u0443\\\\u0454\\\\u0442\\\\u044C\\\\u0441\\\\u044F ${t.expected}, \\\\u043E\\\\u0442\\\\u0440\\\\u0438\\\\u043C\\\\u0430\\\\u043D\\\\u043E ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`\\\\u041D\\\\u0435\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0438\\\\u043B\\\\u044C\\\\u043D\\\\u0456 \\\\u0432\\\\u0445\\\\u0456\\\\u0434\\\\u043D\\\\u0456 \\\\u0434\\\\u0430\\\\u043D\\\\u0456: \\\\u043E\\\\u0447\\\\u0456\\\\u043A\\\\u0443\\\\u0454\\\\u0442\\\\u044C\\\\u0441\\\\u044F ${p(t.values[0])}`:`\\\\u041D\\\\u0435\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0438\\\\u043B\\\\u044C\\\\u043D\\\\u0430 \\\\u043E\\\\u043F\\\\u0446\\\\u0456\\\\u044F: \\\\u043E\\\\u0447\\\\u0456\\\\u043A\\\\u0443\\\\u0454\\\\u0442\\\\u044C\\\\u0441\\\\u044F \\\\u043E\\\\u0434\\\\u043D\\\\u0435 \\\\u0437 ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`\\\\u0417\\\\u0430\\\\u043D\\\\u0430\\\\u0434\\\\u0442\\\\u043E \\\\u0432\\\\u0435\\\\u043B\\\\u0438\\\\u043A\\\\u0435: \\\\u043E\\\\u0447\\\\u0456\\\\u043A\\\\u0443\\\\u0454\\\\u0442\\\\u044C\\\\u0441\\\\u044F, \\\\u0449\\\\u043E ${t.origin??\\\"\\\\u0437\\\\u043D\\\\u0430\\\\u0447\\\\u0435\\\\u043D\\\\u043D\\\\u044F\\\"} ${a.verb} ${i}${t.maximum.toString()} ${a.unit??\\\"\\\\u0435\\\\u043B\\\\u0435\\\\u043C\\\\u0435\\\\u043D\\\\u0442\\\\u0456\\\\u0432\\\"}`:`\\\\u0417\\\\u0430\\\\u043D\\\\u0430\\\\u0434\\\\u0442\\\\u043E \\\\u0432\\\\u0435\\\\u043B\\\\u0438\\\\u043A\\\\u0435: \\\\u043E\\\\u0447\\\\u0456\\\\u043A\\\\u0443\\\\u0454\\\\u0442\\\\u044C\\\\u0441\\\\u044F, \\\\u0449\\\\u043E ${t.origin??\\\"\\\\u0437\\\\u043D\\\\u0430\\\\u0447\\\\u0435\\\\u043D\\\\u043D\\\\u044F\\\"} \\\\u0431\\\\u0443\\\\u0434\\\\u0435 ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`\\\\u0417\\\\u0430\\\\u043D\\\\u0430\\\\u0434\\\\u0442\\\\u043E \\\\u043C\\\\u0430\\\\u043B\\\\u0435: \\\\u043E\\\\u0447\\\\u0456\\\\u043A\\\\u0443\\\\u0454\\\\u0442\\\\u044C\\\\u0441\\\\u044F, \\\\u0449\\\\u043E ${t.origin} ${a.verb} ${i}${t.minimum.toString()} ${a.unit}`:`\\\\u0417\\\\u0430\\\\u043D\\\\u0430\\\\u0434\\\\u0442\\\\u043E \\\\u043C\\\\u0430\\\\u043B\\\\u0435: \\\\u043E\\\\u0447\\\\u0456\\\\u043A\\\\u0443\\\\u0454\\\\u0442\\\\u044C\\\\u0441\\\\u044F, \\\\u0449\\\\u043E ${t.origin} \\\\u0431\\\\u0443\\\\u0434\\\\u0435 ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`\\\\u041D\\\\u0435\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0438\\\\u043B\\\\u044C\\\\u043D\\\\u0438\\\\u0439 \\\\u0440\\\\u044F\\\\u0434\\\\u043E\\\\u043A: \\\\u043F\\\\u043E\\\\u0432\\\\u0438\\\\u043D\\\\u0435\\\\u043D \\\\u043F\\\\u043E\\\\u0447\\\\u0438\\\\u043D\\\\u0430\\\\u0442\\\\u0438\\\\u0441\\\\u044F \\\\u0437 \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`\\\\u041D\\\\u0435\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0438\\\\u043B\\\\u044C\\\\u043D\\\\u0438\\\\u0439 \\\\u0440\\\\u044F\\\\u0434\\\\u043E\\\\u043A: \\\\u043F\\\\u043E\\\\u0432\\\\u0438\\\\u043D\\\\u0435\\\\u043D \\\\u0437\\\\u0430\\\\u043A\\\\u0456\\\\u043D\\\\u0447\\\\u0443\\\\u0432\\\\u0430\\\\u0442\\\\u0438\\\\u0441\\\\u044F \\\\u043D\\\\u0430 \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`\\\\u041D\\\\u0435\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0438\\\\u043B\\\\u044C\\\\u043D\\\\u0438\\\\u0439 \\\\u0440\\\\u044F\\\\u0434\\\\u043E\\\\u043A: \\\\u043F\\\\u043E\\\\u0432\\\\u0438\\\\u043D\\\\u0435\\\\u043D \\\\u043C\\\\u0456\\\\u0441\\\\u0442\\\\u0438\\\\u0442\\\\u0438 \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`\\\\u041D\\\\u0435\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0438\\\\u043B\\\\u044C\\\\u043D\\\\u0438\\\\u0439 \\\\u0440\\\\u044F\\\\u0434\\\\u043E\\\\u043A: \\\\u043F\\\\u043E\\\\u0432\\\\u0438\\\\u043D\\\\u0435\\\\u043D \\\\u0432\\\\u0456\\\\u0434\\\\u043F\\\\u043E\\\\u0432\\\\u0456\\\\u0434\\\\u0430\\\\u0442\\\\u0438 \\\\u0448\\\\u0430\\\\u0431\\\\u043B\\\\u043E\\\\u043D\\\\u0443 ${i.pattern}`:`\\\\u041D\\\\u0435\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0438\\\\u043B\\\\u044C\\\\u043D\\\\u0438\\\\u0439 ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`\\\\u041D\\\\u0435\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0438\\\\u043B\\\\u044C\\\\u043D\\\\u0435 \\\\u0447\\\\u0438\\\\u0441\\\\u043B\\\\u043E: \\\\u043F\\\\u043E\\\\u0432\\\\u0438\\\\u043D\\\\u043D\\\\u043E \\\\u0431\\\\u0443\\\\u0442\\\\u0438 \\\\u043A\\\\u0440\\\\u0430\\\\u0442\\\\u043D\\\\u0438\\\\u043C ${t.divisor}`;case\\\"unrecognized_keys\\\":return`\\\\u041D\\\\u0435\\\\u0440\\\\u043E\\\\u0437\\\\u043F\\\\u0456\\\\u0437\\\\u043D\\\\u0430\\\\u043D\\\\u0438\\\\u0439 \\\\u043A\\\\u043B\\\\u044E\\\\u0447${t.keys.length>1?\\\"\\\\u0456\\\":\\\"\\\"}: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`\\\\u041D\\\\u0435\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0438\\\\u043B\\\\u044C\\\\u043D\\\\u0438\\\\u0439 \\\\u043A\\\\u043B\\\\u044E\\\\u0447 \\\\u0443 ${t.origin}`;case\\\"invalid_union\\\":return\\\"\\\\u041D\\\\u0435\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0438\\\\u043B\\\\u044C\\\\u043D\\\\u0456 \\\\u0432\\\\u0445\\\\u0456\\\\u0434\\\\u043D\\\\u0456 \\\\u0434\\\\u0430\\\\u043D\\\\u0456\\\";case\\\"invalid_element\\\":return`\\\\u041D\\\\u0435\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0438\\\\u043B\\\\u044C\\\\u043D\\\\u0435 \\\\u0437\\\\u043D\\\\u0430\\\\u0447\\\\u0435\\\\u043D\\\\u043D\\\\u044F \\\\u0443 ${t.origin}`;default:return\\\"\\\\u041D\\\\u0435\\\\u043F\\\\u0440\\\\u0430\\\\u0432\\\\u0438\\\\u043B\\\\u044C\\\\u043D\\\\u0456 \\\\u0432\\\\u0445\\\\u0456\\\\u0434\\\\u043D\\\\u0456 \\\\u0434\\\\u0430\\\\u043D\\\\u0456\\\"}}};function Yt(){return{localeError:ud()}}function ac(){return Yt()}var cd=()=>{let e={string:{unit:\\\"\\\\u062D\\\\u0631\\\\u0648\\\\u0641\\\",verb:\\\"\\\\u06C1\\\\u0648\\\\u0646\\\\u0627\\\"},file:{unit:\\\"\\\\u0628\\\\u0627\\\\u0626\\\\u0679\\\\u0633\\\",verb:\\\"\\\\u06C1\\\\u0648\\\\u0646\\\\u0627\\\"},array:{unit:\\\"\\\\u0622\\\\u0626\\\\u0679\\\\u0645\\\\u0632\\\",verb:\\\"\\\\u06C1\\\\u0648\\\\u0646\\\\u0627\\\"},set:{unit:\\\"\\\\u0622\\\\u0626\\\\u0679\\\\u0645\\\\u0632\\\",verb:\\\"\\\\u06C1\\\\u0648\\\\u0646\\\\u0627\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"\\\\u0646\\\\u0645\\\\u0628\\\\u0631\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"\\\\u0622\\\\u0631\\\\u06D2\\\";if(t===null)return\\\"\\\\u0646\\\\u0644\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"\\\\u0627\\\\u0646 \\\\u067E\\\\u0679\\\",email:\\\"\\\\u0627\\\\u06CC \\\\u0645\\\\u06CC\\\\u0644 \\\\u0627\\\\u06CC\\\\u0688\\\\u0631\\\\u06CC\\\\u0633\\\",url:\\\"\\\\u06CC\\\\u0648 \\\\u0622\\\\u0631 \\\\u0627\\\\u06CC\\\\u0644\\\",emoji:\\\"\\\\u0627\\\\u06CC\\\\u0645\\\\u0648\\\\u062C\\\\u06CC\\\",uuid:\\\"\\\\u06CC\\\\u0648 \\\\u06CC\\\\u0648 \\\\u0622\\\\u0626\\\\u06CC \\\\u0688\\\\u06CC\\\",uuidv4:\\\"\\\\u06CC\\\\u0648 \\\\u06CC\\\\u0648 \\\\u0622\\\\u0626\\\\u06CC \\\\u0688\\\\u06CC \\\\u0648\\\\u06CC 4\\\",uuidv6:\\\"\\\\u06CC\\\\u0648 \\\\u06CC\\\\u0648 \\\\u0622\\\\u0626\\\\u06CC \\\\u0688\\\\u06CC \\\\u0648\\\\u06CC 6\\\",nanoid:\\\"\\\\u0646\\\\u06CC\\\\u0646\\\\u0648 \\\\u0622\\\\u0626\\\\u06CC \\\\u0688\\\\u06CC\\\",guid:\\\"\\\\u062C\\\\u06CC \\\\u06CC\\\\u0648 \\\\u0622\\\\u0626\\\\u06CC \\\\u0688\\\\u06CC\\\",cuid:\\\"\\\\u0633\\\\u06CC \\\\u06CC\\\\u0648 \\\\u0622\\\\u0626\\\\u06CC \\\\u0688\\\\u06CC\\\",cuid2:\\\"\\\\u0633\\\\u06CC \\\\u06CC\\\\u0648 \\\\u0622\\\\u0626\\\\u06CC \\\\u0688\\\\u06CC 2\\\",ulid:\\\"\\\\u06CC\\\\u0648 \\\\u0627\\\\u06CC\\\\u0644 \\\\u0622\\\\u0626\\\\u06CC \\\\u0688\\\\u06CC\\\",xid:\\\"\\\\u0627\\\\u06CC\\\\u06A9\\\\u0633 \\\\u0622\\\\u0626\\\\u06CC \\\\u0688\\\\u06CC\\\",ksuid:\\\"\\\\u06A9\\\\u06D2 \\\\u0627\\\\u06CC\\\\u0633 \\\\u06CC\\\\u0648 \\\\u0622\\\\u0626\\\\u06CC \\\\u0688\\\\u06CC\\\",datetime:\\\"\\\\u0622\\\\u0626\\\\u06CC \\\\u0627\\\\u06CC\\\\u0633 \\\\u0627\\\\u0648 \\\\u0688\\\\u06CC\\\\u0679 \\\\u0679\\\\u0627\\\\u0626\\\\u0645\\\",date:\\\"\\\\u0622\\\\u0626\\\\u06CC \\\\u0627\\\\u06CC\\\\u0633 \\\\u0627\\\\u0648 \\\\u062A\\\\u0627\\\\u0631\\\\u06CC\\\\u062E\\\",time:\\\"\\\\u0622\\\\u0626\\\\u06CC \\\\u0627\\\\u06CC\\\\u0633 \\\\u0627\\\\u0648 \\\\u0648\\\\u0642\\\\u062A\\\",duration:\\\"\\\\u0622\\\\u0626\\\\u06CC \\\\u0627\\\\u06CC\\\\u0633 \\\\u0627\\\\u0648 \\\\u0645\\\\u062F\\\\u062A\\\",ipv4:\\\"\\\\u0622\\\\u0626\\\\u06CC \\\\u067E\\\\u06CC \\\\u0648\\\\u06CC 4 \\\\u0627\\\\u06CC\\\\u0688\\\\u0631\\\\u06CC\\\\u0633\\\",ipv6:\\\"\\\\u0622\\\\u0626\\\\u06CC \\\\u067E\\\\u06CC \\\\u0648\\\\u06CC 6 \\\\u0627\\\\u06CC\\\\u0688\\\\u0631\\\\u06CC\\\\u0633\\\",cidrv4:\\\"\\\\u0622\\\\u0626\\\\u06CC \\\\u067E\\\\u06CC \\\\u0648\\\\u06CC 4 \\\\u0631\\\\u06CC\\\\u0646\\\\u062C\\\",cidrv6:\\\"\\\\u0622\\\\u0626\\\\u06CC \\\\u067E\\\\u06CC \\\\u0648\\\\u06CC 6 \\\\u0631\\\\u06CC\\\\u0646\\\\u062C\\\",base64:\\\"\\\\u0628\\\\u06CC\\\\u0633 64 \\\\u0627\\\\u0646 \\\\u06A9\\\\u0648\\\\u0688\\\\u0688 \\\\u0633\\\\u0679\\\\u0631\\\\u0646\\\\u06AF\\\",base64url:\\\"\\\\u0628\\\\u06CC\\\\u0633 64 \\\\u06CC\\\\u0648 \\\\u0622\\\\u0631 \\\\u0627\\\\u06CC\\\\u0644 \\\\u0627\\\\u0646 \\\\u06A9\\\\u0648\\\\u0688\\\\u0688 \\\\u0633\\\\u0679\\\\u0631\\\\u0646\\\\u06AF\\\",json_string:\\\"\\\\u062C\\\\u06D2 \\\\u0627\\\\u06CC\\\\u0633 \\\\u0627\\\\u0648 \\\\u0627\\\\u06CC\\\\u0646 \\\\u0633\\\\u0679\\\\u0631\\\\u0646\\\\u06AF\\\",e164:\\\"\\\\u0627\\\\u06CC 164 \\\\u0646\\\\u0645\\\\u0628\\\\u0631\\\",jwt:\\\"\\\\u062C\\\\u06D2 \\\\u0688\\\\u0628\\\\u0644\\\\u06CC\\\\u0648 \\\\u0679\\\\u06CC\\\",template_literal:\\\"\\\\u0627\\\\u0646 \\\\u067E\\\\u0679\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\u063A\\\\u0644\\\\u0637 \\\\u0627\\\\u0646 \\\\u067E\\\\u0679: ${t.expected} \\\\u0645\\\\u062A\\\\u0648\\\\u0642\\\\u0639 \\\\u062A\\\\u06BE\\\\u0627\\\\u060C ${n(t.input)} \\\\u0645\\\\u0648\\\\u0635\\\\u0648\\\\u0644 \\\\u06C1\\\\u0648\\\\u0627`;case\\\"invalid_value\\\":return t.values.length===1?`\\\\u063A\\\\u0644\\\\u0637 \\\\u0627\\\\u0646 \\\\u067E\\\\u0679: ${p(t.values[0])} \\\\u0645\\\\u062A\\\\u0648\\\\u0642\\\\u0639 \\\\u062A\\\\u06BE\\\\u0627`:`\\\\u063A\\\\u0644\\\\u0637 \\\\u0622\\\\u067E\\\\u0634\\\\u0646: ${l(t.values,\\\"|\\\")} \\\\u0645\\\\u06CC\\\\u06BA \\\\u0633\\\\u06D2 \\\\u0627\\\\u06CC\\\\u06A9 \\\\u0645\\\\u062A\\\\u0648\\\\u0642\\\\u0639 \\\\u062A\\\\u06BE\\\\u0627`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`\\\\u0628\\\\u06C1\\\\u062A \\\\u0628\\\\u0691\\\\u0627: ${t.origin??\\\"\\\\u0648\\\\u06CC\\\\u0644\\\\u06CC\\\\u0648\\\"} \\\\u06A9\\\\u06D2 ${i}${t.maximum.toString()} ${a.unit??\\\"\\\\u0639\\\\u0646\\\\u0627\\\\u0635\\\\u0631\\\"} \\\\u06C1\\\\u0648\\\\u0646\\\\u06D2 \\\\u0645\\\\u062A\\\\u0648\\\\u0642\\\\u0639 \\\\u062A\\\\u06BE\\\\u06D2`:`\\\\u0628\\\\u06C1\\\\u062A \\\\u0628\\\\u0691\\\\u0627: ${t.origin??\\\"\\\\u0648\\\\u06CC\\\\u0644\\\\u06CC\\\\u0648\\\"} \\\\u06A9\\\\u0627 ${i}${t.maximum.toString()} \\\\u06C1\\\\u0648\\\\u0646\\\\u0627 \\\\u0645\\\\u062A\\\\u0648\\\\u0642\\\\u0639 \\\\u062A\\\\u06BE\\\\u0627`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`\\\\u0628\\\\u06C1\\\\u062A \\\\u0686\\\\u06BE\\\\u0648\\\\u0679\\\\u0627: ${t.origin} \\\\u06A9\\\\u06D2 ${i}${t.minimum.toString()} ${a.unit} \\\\u06C1\\\\u0648\\\\u0646\\\\u06D2 \\\\u0645\\\\u062A\\\\u0648\\\\u0642\\\\u0639 \\\\u062A\\\\u06BE\\\\u06D2`:`\\\\u0628\\\\u06C1\\\\u062A \\\\u0686\\\\u06BE\\\\u0648\\\\u0679\\\\u0627: ${t.origin} \\\\u06A9\\\\u0627 ${i}${t.minimum.toString()} \\\\u06C1\\\\u0648\\\\u0646\\\\u0627 \\\\u0645\\\\u062A\\\\u0648\\\\u0642\\\\u0639 \\\\u062A\\\\u06BE\\\\u0627`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`\\\\u063A\\\\u0644\\\\u0637 \\\\u0633\\\\u0679\\\\u0631\\\\u0646\\\\u06AF: \\\"${i.prefix}\\\" \\\\u0633\\\\u06D2 \\\\u0634\\\\u0631\\\\u0648\\\\u0639 \\\\u06C1\\\\u0648\\\\u0646\\\\u0627 \\\\u0686\\\\u0627\\\\u06C1\\\\u06CC\\\\u06D2`:i.format===\\\"ends_with\\\"?`\\\\u063A\\\\u0644\\\\u0637 \\\\u0633\\\\u0679\\\\u0631\\\\u0646\\\\u06AF: \\\"${i.suffix}\\\" \\\\u067E\\\\u0631 \\\\u062E\\\\u062A\\\\u0645 \\\\u06C1\\\\u0648\\\\u0646\\\\u0627 \\\\u0686\\\\u0627\\\\u06C1\\\\u06CC\\\\u06D2`:i.format===\\\"includes\\\"?`\\\\u063A\\\\u0644\\\\u0637 \\\\u0633\\\\u0679\\\\u0631\\\\u0646\\\\u06AF: \\\"${i.includes}\\\" \\\\u0634\\\\u0627\\\\u0645\\\\u0644 \\\\u06C1\\\\u0648\\\\u0646\\\\u0627 \\\\u0686\\\\u0627\\\\u06C1\\\\u06CC\\\\u06D2`:i.format===\\\"regex\\\"?`\\\\u063A\\\\u0644\\\\u0637 \\\\u0633\\\\u0679\\\\u0631\\\\u0646\\\\u06AF: \\\\u067E\\\\u06CC\\\\u0679\\\\u0631\\\\u0646 ${i.pattern} \\\\u0633\\\\u06D2 \\\\u0645\\\\u06CC\\\\u0686 \\\\u06C1\\\\u0648\\\\u0646\\\\u0627 \\\\u0686\\\\u0627\\\\u06C1\\\\u06CC\\\\u06D2`:`\\\\u063A\\\\u0644\\\\u0637 ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`\\\\u063A\\\\u0644\\\\u0637 \\\\u0646\\\\u0645\\\\u0628\\\\u0631: ${t.divisor} \\\\u06A9\\\\u0627 \\\\u0645\\\\u0636\\\\u0627\\\\u0639\\\\u0641 \\\\u06C1\\\\u0648\\\\u0646\\\\u0627 \\\\u0686\\\\u0627\\\\u06C1\\\\u06CC\\\\u06D2`;case\\\"unrecognized_keys\\\":return`\\\\u063A\\\\u06CC\\\\u0631 \\\\u062A\\\\u0633\\\\u0644\\\\u06CC\\\\u0645 \\\\u0634\\\\u062F\\\\u06C1 \\\\u06A9\\\\u06CC${t.keys.length>1?\\\"\\\\u0632\\\":\\\"\\\"}: ${l(t.keys,\\\"\\\\u060C \\\")}`;case\\\"invalid_key\\\":return`${t.origin} \\\\u0645\\\\u06CC\\\\u06BA \\\\u063A\\\\u0644\\\\u0637 \\\\u06A9\\\\u06CC`;case\\\"invalid_union\\\":return\\\"\\\\u063A\\\\u0644\\\\u0637 \\\\u0627\\\\u0646 \\\\u067E\\\\u0679\\\";case\\\"invalid_element\\\":return`${t.origin} \\\\u0645\\\\u06CC\\\\u06BA \\\\u063A\\\\u0644\\\\u0637 \\\\u0648\\\\u06CC\\\\u0644\\\\u06CC\\\\u0648`;default:return\\\"\\\\u063A\\\\u0644\\\\u0637 \\\\u0627\\\\u0646 \\\\u067E\\\\u0679\\\"}}};function uc(){return{localeError:cd()}}var sd=()=>{let e={string:{unit:\\\"k\\\\xFD t\\\\u1EF1\\\",verb:\\\"c\\\\xF3\\\"},file:{unit:\\\"byte\\\",verb:\\\"c\\\\xF3\\\"},array:{unit:\\\"ph\\\\u1EA7n t\\\\u1EED\\\",verb:\\\"c\\\\xF3\\\"},set:{unit:\\\"ph\\\\u1EA7n t\\\\u1EED\\\",verb:\\\"c\\\\xF3\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"s\\\\u1ED1\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"m\\\\u1EA3ng\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"\\\\u0111\\\\u1EA7u v\\\\xE0o\\\",email:\\\"\\\\u0111\\\\u1ECBa ch\\\\u1EC9 email\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ng\\\\xE0y gi\\\\u1EDD ISO\\\",date:\\\"ng\\\\xE0y ISO\\\",time:\\\"gi\\\\u1EDD ISO\\\",duration:\\\"kho\\\\u1EA3ng th\\\\u1EDDi gian ISO\\\",ipv4:\\\"\\\\u0111\\\\u1ECBa ch\\\\u1EC9 IPv4\\\",ipv6:\\\"\\\\u0111\\\\u1ECBa ch\\\\u1EC9 IPv6\\\",cidrv4:\\\"d\\\\u1EA3i IPv4\\\",cidrv6:\\\"d\\\\u1EA3i IPv6\\\",base64:\\\"chu\\\\u1ED7i m\\\\xE3 h\\\\xF3a base64\\\",base64url:\\\"chu\\\\u1ED7i m\\\\xE3 h\\\\xF3a base64url\\\",json_string:\\\"chu\\\\u1ED7i JSON\\\",e164:\\\"s\\\\u1ED1 E.164\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\u0111\\\\u1EA7u v\\\\xE0o\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\u0110\\\\u1EA7u v\\\\xE0o kh\\\\xF4ng h\\\\u1EE3p l\\\\u1EC7: mong \\\\u0111\\\\u1EE3i ${t.expected}, nh\\\\u1EADn \\\\u0111\\\\u01B0\\\\u1EE3c ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`\\\\u0110\\\\u1EA7u v\\\\xE0o kh\\\\xF4ng h\\\\u1EE3p l\\\\u1EC7: mong \\\\u0111\\\\u1EE3i ${p(t.values[0])}`:`T\\\\xF9y ch\\\\u1ECDn kh\\\\xF4ng h\\\\u1EE3p l\\\\u1EC7: mong \\\\u0111\\\\u1EE3i m\\\\u1ED9t trong c\\\\xE1c gi\\\\xE1 tr\\\\u1ECB ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`Qu\\\\xE1 l\\\\u1EDBn: mong \\\\u0111\\\\u1EE3i ${t.origin??\\\"gi\\\\xE1 tr\\\\u1ECB\\\"} ${a.verb} ${i}${t.maximum.toString()} ${a.unit??\\\"ph\\\\u1EA7n t\\\\u1EED\\\"}`:`Qu\\\\xE1 l\\\\u1EDBn: mong \\\\u0111\\\\u1EE3i ${t.origin??\\\"gi\\\\xE1 tr\\\\u1ECB\\\"} ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`Qu\\\\xE1 nh\\\\u1ECF: mong \\\\u0111\\\\u1EE3i ${t.origin} ${a.verb} ${i}${t.minimum.toString()} ${a.unit}`:`Qu\\\\xE1 nh\\\\u1ECF: mong \\\\u0111\\\\u1EE3i ${t.origin} ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`Chu\\\\u1ED7i kh\\\\xF4ng h\\\\u1EE3p l\\\\u1EC7: ph\\\\u1EA3i b\\\\u1EAFt \\\\u0111\\\\u1EA7u b\\\\u1EB1ng \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`Chu\\\\u1ED7i kh\\\\xF4ng h\\\\u1EE3p l\\\\u1EC7: ph\\\\u1EA3i k\\\\u1EBFt th\\\\xFAc b\\\\u1EB1ng \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`Chu\\\\u1ED7i kh\\\\xF4ng h\\\\u1EE3p l\\\\u1EC7: ph\\\\u1EA3i bao g\\\\u1ED3m \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`Chu\\\\u1ED7i kh\\\\xF4ng h\\\\u1EE3p l\\\\u1EC7: ph\\\\u1EA3i kh\\\\u1EDBp v\\\\u1EDBi m\\\\u1EABu ${i.pattern}`:`${o[i.format]??t.format} kh\\\\xF4ng h\\\\u1EE3p l\\\\u1EC7`}case\\\"not_multiple_of\\\":return`S\\\\u1ED1 kh\\\\xF4ng h\\\\u1EE3p l\\\\u1EC7: ph\\\\u1EA3i l\\\\xE0 b\\\\u1ED9i s\\\\u1ED1 c\\\\u1EE7a ${t.divisor}`;case\\\"unrecognized_keys\\\":return`Kh\\\\xF3a kh\\\\xF4ng \\\\u0111\\\\u01B0\\\\u1EE3c nh\\\\u1EADn d\\\\u1EA1ng: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`Kh\\\\xF3a kh\\\\xF4ng h\\\\u1EE3p l\\\\u1EC7 trong ${t.origin}`;case\\\"invalid_union\\\":return\\\"\\\\u0110\\\\u1EA7u v\\\\xE0o kh\\\\xF4ng h\\\\u1EE3p l\\\\u1EC7\\\";case\\\"invalid_element\\\":return`Gi\\\\xE1 tr\\\\u1ECB kh\\\\xF4ng h\\\\u1EE3p l\\\\u1EC7 trong ${t.origin}`;default:return\\\"\\\\u0110\\\\u1EA7u v\\\\xE0o kh\\\\xF4ng h\\\\u1EE3p l\\\\u1EC7\\\"}}};function cc(){return{localeError:sd()}}var ld=()=>{let e={string:{unit:\\\"\\\\u5B57\\\\u7B26\\\",verb:\\\"\\\\u5305\\\\u542B\\\"},file:{unit:\\\"\\\\u5B57\\\\u8282\\\",verb:\\\"\\\\u5305\\\\u542B\\\"},array:{unit:\\\"\\\\u9879\\\",verb:\\\"\\\\u5305\\\\u542B\\\"},set:{unit:\\\"\\\\u9879\\\",verb:\\\"\\\\u5305\\\\u542B\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"\\\\u975E\\\\u6570\\\\u5B57(NaN)\\\":\\\"\\\\u6570\\\\u5B57\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"\\\\u6570\\\\u7EC4\\\";if(t===null)return\\\"\\\\u7A7A\\\\u503C(null)\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"\\\\u8F93\\\\u5165\\\",email:\\\"\\\\u7535\\\\u5B50\\\\u90AE\\\\u4EF6\\\",url:\\\"URL\\\",emoji:\\\"\\\\u8868\\\\u60C5\\\\u7B26\\\\u53F7\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO\\\\u65E5\\\\u671F\\\\u65F6\\\\u95F4\\\",date:\\\"ISO\\\\u65E5\\\\u671F\\\",time:\\\"ISO\\\\u65F6\\\\u95F4\\\",duration:\\\"ISO\\\\u65F6\\\\u957F\\\",ipv4:\\\"IPv4\\\\u5730\\\\u5740\\\",ipv6:\\\"IPv6\\\\u5730\\\\u5740\\\",cidrv4:\\\"IPv4\\\\u7F51\\\\u6BB5\\\",cidrv6:\\\"IPv6\\\\u7F51\\\\u6BB5\\\",base64:\\\"base64\\\\u7F16\\\\u7801\\\\u5B57\\\\u7B26\\\\u4E32\\\",base64url:\\\"base64url\\\\u7F16\\\\u7801\\\\u5B57\\\\u7B26\\\\u4E32\\\",json_string:\\\"JSON\\\\u5B57\\\\u7B26\\\\u4E32\\\",e164:\\\"E.164\\\\u53F7\\\\u7801\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\u8F93\\\\u5165\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\u65E0\\\\u6548\\\\u8F93\\\\u5165\\\\uFF1A\\\\u671F\\\\u671B ${t.expected}\\\\uFF0C\\\\u5B9E\\\\u9645\\\\u63A5\\\\u6536 ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`\\\\u65E0\\\\u6548\\\\u8F93\\\\u5165\\\\uFF1A\\\\u671F\\\\u671B ${p(t.values[0])}`:`\\\\u65E0\\\\u6548\\\\u9009\\\\u9879\\\\uFF1A\\\\u671F\\\\u671B\\\\u4EE5\\\\u4E0B\\\\u4E4B\\\\u4E00 ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`\\\\u6570\\\\u503C\\\\u8FC7\\\\u5927\\\\uFF1A\\\\u671F\\\\u671B ${t.origin??\\\"\\\\u503C\\\"} ${i}${t.maximum.toString()} ${a.unit??\\\"\\\\u4E2A\\\\u5143\\\\u7D20\\\"}`:`\\\\u6570\\\\u503C\\\\u8FC7\\\\u5927\\\\uFF1A\\\\u671F\\\\u671B ${t.origin??\\\"\\\\u503C\\\"} ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`\\\\u6570\\\\u503C\\\\u8FC7\\\\u5C0F\\\\uFF1A\\\\u671F\\\\u671B ${t.origin} ${i}${t.minimum.toString()} ${a.unit}`:`\\\\u6570\\\\u503C\\\\u8FC7\\\\u5C0F\\\\uFF1A\\\\u671F\\\\u671B ${t.origin} ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`\\\\u65E0\\\\u6548\\\\u5B57\\\\u7B26\\\\u4E32\\\\uFF1A\\\\u5FC5\\\\u987B\\\\u4EE5 \\\"${i.prefix}\\\" \\\\u5F00\\\\u5934`:i.format===\\\"ends_with\\\"?`\\\\u65E0\\\\u6548\\\\u5B57\\\\u7B26\\\\u4E32\\\\uFF1A\\\\u5FC5\\\\u987B\\\\u4EE5 \\\"${i.suffix}\\\" \\\\u7ED3\\\\u5C3E`:i.format===\\\"includes\\\"?`\\\\u65E0\\\\u6548\\\\u5B57\\\\u7B26\\\\u4E32\\\\uFF1A\\\\u5FC5\\\\u987B\\\\u5305\\\\u542B \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`\\\\u65E0\\\\u6548\\\\u5B57\\\\u7B26\\\\u4E32\\\\uFF1A\\\\u5FC5\\\\u987B\\\\u6EE1\\\\u8DB3\\\\u6B63\\\\u5219\\\\u8868\\\\u8FBE\\\\u5F0F ${i.pattern}`:`\\\\u65E0\\\\u6548${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`\\\\u65E0\\\\u6548\\\\u6570\\\\u5B57\\\\uFF1A\\\\u5FC5\\\\u987B\\\\u662F ${t.divisor} \\\\u7684\\\\u500D\\\\u6570`;case\\\"unrecognized_keys\\\":return`\\\\u51FA\\\\u73B0\\\\u672A\\\\u77E5\\\\u7684\\\\u952E(key): ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`${t.origin} \\\\u4E2D\\\\u7684\\\\u952E(key)\\\\u65E0\\\\u6548`;case\\\"invalid_union\\\":return\\\"\\\\u65E0\\\\u6548\\\\u8F93\\\\u5165\\\";case\\\"invalid_element\\\":return`${t.origin} \\\\u4E2D\\\\u5305\\\\u542B\\\\u65E0\\\\u6548\\\\u503C(value)`;default:return\\\"\\\\u65E0\\\\u6548\\\\u8F93\\\\u5165\\\"}}};function sc(){return{localeError:ld()}}var dd=()=>{let e={string:{unit:\\\"\\\\u5B57\\\\u5143\\\",verb:\\\"\\\\u64C1\\\\u6709\\\"},file:{unit:\\\"\\\\u4F4D\\\\u5143\\\\u7D44\\\",verb:\\\"\\\\u64C1\\\\u6709\\\"},array:{unit:\\\"\\\\u9805\\\\u76EE\\\",verb:\\\"\\\\u64C1\\\\u6709\\\"},set:{unit:\\\"\\\\u9805\\\\u76EE\\\",verb:\\\"\\\\u64C1\\\\u6709\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"number\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"array\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"\\\\u8F38\\\\u5165\\\",email:\\\"\\\\u90F5\\\\u4EF6\\\\u5730\\\\u5740\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"ISO \\\\u65E5\\\\u671F\\\\u6642\\\\u9593\\\",date:\\\"ISO \\\\u65E5\\\\u671F\\\",time:\\\"ISO \\\\u6642\\\\u9593\\\",duration:\\\"ISO \\\\u671F\\\\u9593\\\",ipv4:\\\"IPv4 \\\\u4F4D\\\\u5740\\\",ipv6:\\\"IPv6 \\\\u4F4D\\\\u5740\\\",cidrv4:\\\"IPv4 \\\\u7BC4\\\\u570D\\\",cidrv6:\\\"IPv6 \\\\u7BC4\\\\u570D\\\",base64:\\\"base64 \\\\u7DE8\\\\u78BC\\\\u5B57\\\\u4E32\\\",base64url:\\\"base64url \\\\u7DE8\\\\u78BC\\\\u5B57\\\\u4E32\\\",json_string:\\\"JSON \\\\u5B57\\\\u4E32\\\",e164:\\\"E.164 \\\\u6578\\\\u503C\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\u8F38\\\\u5165\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\u7121\\\\u6548\\\\u7684\\\\u8F38\\\\u5165\\\\u503C\\\\uFF1A\\\\u9810\\\\u671F\\\\u70BA ${t.expected}\\\\uFF0C\\\\u4F46\\\\u6536\\\\u5230 ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`\\\\u7121\\\\u6548\\\\u7684\\\\u8F38\\\\u5165\\\\u503C\\\\uFF1A\\\\u9810\\\\u671F\\\\u70BA ${p(t.values[0])}`:`\\\\u7121\\\\u6548\\\\u7684\\\\u9078\\\\u9805\\\\uFF1A\\\\u9810\\\\u671F\\\\u70BA\\\\u4EE5\\\\u4E0B\\\\u5176\\\\u4E2D\\\\u4E4B\\\\u4E00 ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`\\\\u6578\\\\u503C\\\\u904E\\\\u5927\\\\uFF1A\\\\u9810\\\\u671F ${t.origin??\\\"\\\\u503C\\\"} \\\\u61C9\\\\u70BA ${i}${t.maximum.toString()} ${a.unit??\\\"\\\\u500B\\\\u5143\\\\u7D20\\\"}`:`\\\\u6578\\\\u503C\\\\u904E\\\\u5927\\\\uFF1A\\\\u9810\\\\u671F ${t.origin??\\\"\\\\u503C\\\"} \\\\u61C9\\\\u70BA ${i}${t.maximum.toString()}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`\\\\u6578\\\\u503C\\\\u904E\\\\u5C0F\\\\uFF1A\\\\u9810\\\\u671F ${t.origin} \\\\u61C9\\\\u70BA ${i}${t.minimum.toString()} ${a.unit}`:`\\\\u6578\\\\u503C\\\\u904E\\\\u5C0F\\\\uFF1A\\\\u9810\\\\u671F ${t.origin} \\\\u61C9\\\\u70BA ${i}${t.minimum.toString()}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`\\\\u7121\\\\u6548\\\\u7684\\\\u5B57\\\\u4E32\\\\uFF1A\\\\u5FC5\\\\u9808\\\\u4EE5 \\\"${i.prefix}\\\" \\\\u958B\\\\u982D`:i.format===\\\"ends_with\\\"?`\\\\u7121\\\\u6548\\\\u7684\\\\u5B57\\\\u4E32\\\\uFF1A\\\\u5FC5\\\\u9808\\\\u4EE5 \\\"${i.suffix}\\\" \\\\u7D50\\\\u5C3E`:i.format===\\\"includes\\\"?`\\\\u7121\\\\u6548\\\\u7684\\\\u5B57\\\\u4E32\\\\uFF1A\\\\u5FC5\\\\u9808\\\\u5305\\\\u542B \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`\\\\u7121\\\\u6548\\\\u7684\\\\u5B57\\\\u4E32\\\\uFF1A\\\\u5FC5\\\\u9808\\\\u7B26\\\\u5408\\\\u683C\\\\u5F0F ${i.pattern}`:`\\\\u7121\\\\u6548\\\\u7684 ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`\\\\u7121\\\\u6548\\\\u7684\\\\u6578\\\\u5B57\\\\uFF1A\\\\u5FC5\\\\u9808\\\\u70BA ${t.divisor} \\\\u7684\\\\u500D\\\\u6578`;case\\\"unrecognized_keys\\\":return`\\\\u7121\\\\u6CD5\\\\u8B58\\\\u5225\\\\u7684\\\\u9375\\\\u503C${t.keys.length>1?\\\"\\\\u5011\\\":\\\"\\\"}\\\\uFF1A${l(t.keys,\\\"\\\\u3001\\\")}`;case\\\"invalid_key\\\":return`${t.origin} \\\\u4E2D\\\\u6709\\\\u7121\\\\u6548\\\\u7684\\\\u9375\\\\u503C`;case\\\"invalid_union\\\":return\\\"\\\\u7121\\\\u6548\\\\u7684\\\\u8F38\\\\u5165\\\\u503C\\\";case\\\"invalid_element\\\":return`${t.origin} \\\\u4E2D\\\\u6709\\\\u7121\\\\u6548\\\\u7684\\\\u503C`;default:return\\\"\\\\u7121\\\\u6548\\\\u7684\\\\u8F38\\\\u5165\\\\u503C\\\"}}};function lc(){return{localeError:dd()}}var md=()=>{let e={string:{unit:\\\"\\\\xE0mi\\\",verb:\\\"n\\\\xED\\\"},file:{unit:\\\"bytes\\\",verb:\\\"n\\\\xED\\\"},array:{unit:\\\"nkan\\\",verb:\\\"n\\\\xED\\\"},set:{unit:\\\"nkan\\\",verb:\\\"n\\\\xED\\\"}};function r(t){return e[t]??null}let n=t=>{let i=typeof t;switch(i){case\\\"number\\\":return Number.isNaN(t)?\\\"NaN\\\":\\\"n\\\\u1ECD\\\\u0301mb\\\\xE0\\\";case\\\"object\\\":{if(Array.isArray(t))return\\\"akop\\\\u1ECD\\\";if(t===null)return\\\"null\\\";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return i},o={regex:\\\"\\\\u1EB9\\\\u0300r\\\\u1ECD \\\\xECb\\\\xE1w\\\\u1ECDl\\\\xE9\\\",email:\\\"\\\\xE0d\\\\xEDr\\\\u1EB9\\\\u0301s\\\\xEC \\\\xECm\\\\u1EB9\\\\u0301l\\\\xEC\\\",url:\\\"URL\\\",emoji:\\\"emoji\\\",uuid:\\\"UUID\\\",uuidv4:\\\"UUIDv4\\\",uuidv6:\\\"UUIDv6\\\",nanoid:\\\"nanoid\\\",guid:\\\"GUID\\\",cuid:\\\"cuid\\\",cuid2:\\\"cuid2\\\",ulid:\\\"ULID\\\",xid:\\\"XID\\\",ksuid:\\\"KSUID\\\",datetime:\\\"\\\\xE0k\\\\xF3k\\\\xF2 ISO\\\",date:\\\"\\\\u1ECDj\\\\u1ECD\\\\u0301 ISO\\\",time:\\\"\\\\xE0k\\\\xF3k\\\\xF2 ISO\\\",duration:\\\"\\\\xE0k\\\\xF3k\\\\xF2 t\\\\xF3 p\\\\xE9 ISO\\\",ipv4:\\\"\\\\xE0d\\\\xEDr\\\\u1EB9\\\\u0301s\\\\xEC IPv4\\\",ipv6:\\\"\\\\xE0d\\\\xEDr\\\\u1EB9\\\\u0301s\\\\xEC IPv6\\\",cidrv4:\\\"\\\\xE0gb\\\\xE8gb\\\\xE8 IPv4\\\",cidrv6:\\\"\\\\xE0gb\\\\xE8gb\\\\xE8 IPv6\\\",base64:\\\"\\\\u1ECD\\\\u0300r\\\\u1ECD\\\\u0300 t\\\\xED a k\\\\u1ECD\\\\u0301 n\\\\xED base64\\\",base64url:\\\"\\\\u1ECD\\\\u0300r\\\\u1ECD\\\\u0300 base64url\\\",json_string:\\\"\\\\u1ECD\\\\u0300r\\\\u1ECD\\\\u0300 JSON\\\",e164:\\\"n\\\\u1ECD\\\\u0301mb\\\\xE0 E.164\\\",jwt:\\\"JWT\\\",template_literal:\\\"\\\\u1EB9\\\\u0300r\\\\u1ECD \\\\xECb\\\\xE1w\\\\u1ECDl\\\\xE9\\\"};return t=>{switch(t.code){case\\\"invalid_type\\\":return`\\\\xCCb\\\\xE1w\\\\u1ECDl\\\\xE9 a\\\\u1E63\\\\xEC\\\\u1E63e: a n\\\\xED l\\\\xE1ti fi ${t.expected}, \\\\xE0m\\\\u1ECD\\\\u0300 a r\\\\xED ${n(t.input)}`;case\\\"invalid_value\\\":return t.values.length===1?`\\\\xCCb\\\\xE1w\\\\u1ECDl\\\\xE9 a\\\\u1E63\\\\xEC\\\\u1E63e: a n\\\\xED l\\\\xE1ti fi ${p(t.values[0])}`:`\\\\xC0\\\\u1E63\\\\xE0y\\\\xE0n a\\\\u1E63\\\\xEC\\\\u1E63e: yan \\\\u1ECD\\\\u0300kan l\\\\xE1ra ${l(t.values,\\\"|\\\")}`;case\\\"too_big\\\":{let i=t.inclusive?\\\"<=\\\":\\\"<\\\",a=r(t.origin);return a?`T\\\\xF3 p\\\\u1ECD\\\\u0300 j\\\\xF9: a n\\\\xED l\\\\xE1ti j\\\\u1EB9\\\\u0301 p\\\\xE9 ${t.origin??\\\"iye\\\"} ${a.verb} ${i}${t.maximum} ${a.unit}`:`T\\\\xF3 p\\\\u1ECD\\\\u0300 j\\\\xF9: a n\\\\xED l\\\\xE1ti j\\\\u1EB9\\\\u0301 ${i}${t.maximum}`}case\\\"too_small\\\":{let i=t.inclusive?\\\">=\\\":\\\">\\\",a=r(t.origin);return a?`K\\\\xE9r\\\\xE9 ju: a n\\\\xED l\\\\xE1ti j\\\\u1EB9\\\\u0301 p\\\\xE9 ${t.origin} ${a.verb} ${i}${t.minimum} ${a.unit}`:`K\\\\xE9r\\\\xE9 ju: a n\\\\xED l\\\\xE1ti j\\\\u1EB9\\\\u0301 ${i}${t.minimum}`}case\\\"invalid_format\\\":{let i=t;return i.format===\\\"starts_with\\\"?`\\\\u1ECC\\\\u0300r\\\\u1ECD\\\\u0300 a\\\\u1E63\\\\xEC\\\\u1E63e: gb\\\\u1ECD\\\\u0301d\\\\u1ECD\\\\u0300 b\\\\u1EB9\\\\u0300r\\\\u1EB9\\\\u0300 p\\\\u1EB9\\\\u0300l\\\\xFA \\\"${i.prefix}\\\"`:i.format===\\\"ends_with\\\"?`\\\\u1ECC\\\\u0300r\\\\u1ECD\\\\u0300 a\\\\u1E63\\\\xEC\\\\u1E63e: gb\\\\u1ECD\\\\u0301d\\\\u1ECD\\\\u0300 par\\\\xED p\\\\u1EB9\\\\u0300l\\\\xFA \\\"${i.suffix}\\\"`:i.format===\\\"includes\\\"?`\\\\u1ECC\\\\u0300r\\\\u1ECD\\\\u0300 a\\\\u1E63\\\\xEC\\\\u1E63e: gb\\\\u1ECD\\\\u0301d\\\\u1ECD\\\\u0300 n\\\\xED \\\"${i.includes}\\\"`:i.format===\\\"regex\\\"?`\\\\u1ECC\\\\u0300r\\\\u1ECD\\\\u0300 a\\\\u1E63\\\\xEC\\\\u1E63e: gb\\\\u1ECD\\\\u0301d\\\\u1ECD\\\\u0300 b\\\\xE1 \\\\xE0p\\\\u1EB9\\\\u1EB9r\\\\u1EB9 mu ${i.pattern}`:`A\\\\u1E63\\\\xEC\\\\u1E63e: ${o[i.format]??t.format}`}case\\\"not_multiple_of\\\":return`N\\\\u1ECD\\\\u0301mb\\\\xE0 a\\\\u1E63\\\\xEC\\\\u1E63e: gb\\\\u1ECD\\\\u0301d\\\\u1ECD\\\\u0300 j\\\\u1EB9\\\\u0301 \\\\xE8y\\\\xE0 p\\\\xEDp\\\\xEDn ti ${t.divisor}`;case\\\"unrecognized_keys\\\":return`B\\\\u1ECDt\\\\xECn\\\\xEC \\\\xE0\\\\xECm\\\\u1ECD\\\\u0300: ${l(t.keys,\\\", \\\")}`;case\\\"invalid_key\\\":return`B\\\\u1ECDt\\\\xECn\\\\xEC a\\\\u1E63\\\\xEC\\\\u1E63e n\\\\xEDn\\\\xFA ${t.origin}`;case\\\"invalid_union\\\":return\\\"\\\\xCCb\\\\xE1w\\\\u1ECDl\\\\xE9 a\\\\u1E63\\\\xEC\\\\u1E63e\\\";case\\\"invalid_element\\\":return`Iye a\\\\u1E63\\\\xEC\\\\u1E63e n\\\\xEDn\\\\xFA ${t.origin}`;default:return\\\"\\\\xCCb\\\\xE1w\\\\u1ECDl\\\\xE9 a\\\\u1E63\\\\xEC\\\\u1E63e\\\"}}};function dc(){return{localeError:md()}}var eo=Symbol(\\\"ZodOutput\\\"),to=Symbol(\\\"ZodInput\\\"),je=class{constructor(){this._map=new WeakMap,this._idmap=new Map}add(r,...n){let o=n[0];if(this._map.set(r,o),o&&typeof o==\\\"object\\\"&&\\\"id\\\"in o){if(this._idmap.has(o.id))throw new Error(`ID ${o.id} already exists in the registry`);this._idmap.set(o.id,r)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(r){let n=this._map.get(r);return n&&typeof n==\\\"object\\\"&&\\\"id\\\"in n&&this._idmap.delete(n.id),this._map.delete(r),this}get(r){let n=r._zod.parent;if(n){let o={...this.get(n)??{}};delete o.id;let t={...o,...this._map.get(r)};return Object.keys(t).length?t:void 0}return this._map.get(r)}has(r){return this._map.has(r)}};function Qt(){return new je}var q=Qt();function ro(e,r){return new e({type:\\\"string\\\",...v(r)})}function no(e,r){return new e({type:\\\"string\\\",coerce:!0,...v(r)})}function Ht(e,r){return new e({type:\\\"string\\\",format:\\\"email\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}function rt(e,r){return new e({type:\\\"string\\\",format:\\\"guid\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}function er(e,r){return new e({type:\\\"string\\\",format:\\\"uuid\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}function tr(e,r){return new e({type:\\\"string\\\",format:\\\"uuid\\\",check:\\\"string_format\\\",abort:!1,version:\\\"v4\\\",...v(r)})}function rr(e,r){return new e({type:\\\"string\\\",format:\\\"uuid\\\",check:\\\"string_format\\\",abort:!1,version:\\\"v6\\\",...v(r)})}function nr(e,r){return new e({type:\\\"string\\\",format:\\\"uuid\\\",check:\\\"string_format\\\",abort:!1,version:\\\"v7\\\",...v(r)})}function nt(e,r){return new e({type:\\\"string\\\",format:\\\"url\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}function ir(e,r){return new e({type:\\\"string\\\",format:\\\"emoji\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}function or(e,r){return new e({type:\\\"string\\\",format:\\\"nanoid\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}function ar(e,r){return new e({type:\\\"string\\\",format:\\\"cuid\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}function ur(e,r){return new e({type:\\\"string\\\",format:\\\"cuid2\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}function cr(e,r){return new e({type:\\\"string\\\",format:\\\"ulid\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}function sr(e,r){return new e({type:\\\"string\\\",format:\\\"xid\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}function lr(e,r){return new e({type:\\\"string\\\",format:\\\"ksuid\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}function dr(e,r){return new e({type:\\\"string\\\",format:\\\"ipv4\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}function mr(e,r){return new e({type:\\\"string\\\",format:\\\"ipv6\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}function fr(e,r){return new e({type:\\\"string\\\",format:\\\"cidrv4\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}function pr(e,r){return new e({type:\\\"string\\\",format:\\\"cidrv6\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}function gr(e,r){return new e({type:\\\"string\\\",format:\\\"base64\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}function vr(e,r){return new e({type:\\\"string\\\",format:\\\"base64url\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}function hr(e,r){return new e({type:\\\"string\\\",format:\\\"e164\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}function $r(e,r){return new e({type:\\\"string\\\",format:\\\"jwt\\\",check:\\\"string_format\\\",abort:!1,...v(r)})}var io={Any:null,Minute:-1,Second:0,Millisecond:3,Microsecond:6};function oo(e,r){return new e({type:\\\"string\\\",format:\\\"datetime\\\",check:\\\"string_format\\\",offset:!1,local:!1,precision:null,...v(r)})}function ao(e,r){return new e({type:\\\"string\\\",format:\\\"date\\\",check:\\\"string_format\\\",...v(r)})}function uo(e,r){return new e({type:\\\"string\\\",format:\\\"time\\\",check:\\\"string_format\\\",precision:null,...v(r)})}function co(e,r){return new e({type:\\\"string\\\",format:\\\"duration\\\",check:\\\"string_format\\\",...v(r)})}function so(e,r){return new e({type:\\\"number\\\",checks:[],...v(r)})}function lo(e,r){return new e({type:\\\"number\\\",coerce:!0,checks:[],...v(r)})}function mo(e,r){return new e({type:\\\"number\\\",check:\\\"number_format\\\",abort:!1,format:\\\"safeint\\\",...v(r)})}function fo(e,r){return new e({type:\\\"number\\\",check:\\\"number_format\\\",abort:!1,format:\\\"float32\\\",...v(r)})}function po(e,r){return new e({type:\\\"number\\\",check:\\\"number_format\\\",abort:!1,format:\\\"float64\\\",...v(r)})}function go(e,r){return new e({type:\\\"number\\\",check:\\\"number_format\\\",abort:!1,format:\\\"int32\\\",...v(r)})}function vo(e,r){return new e({type:\\\"number\\\",check:\\\"number_format\\\",abort:!1,format:\\\"uint32\\\",...v(r)})}function ho(e,r){return new e({type:\\\"boolean\\\",...v(r)})}function $o(e,r){return new e({type:\\\"boolean\\\",coerce:!0,...v(r)})}function bo(e,r){return new e({type:\\\"bigint\\\",...v(r)})}function _o(e,r){return new e({type:\\\"bigint\\\",coerce:!0,...v(r)})}function yo(e,r){return new e({type:\\\"bigint\\\",check:\\\"bigint_format\\\",abort:!1,format:\\\"int64\\\",...v(r)})}function xo(e,r){return new e({type:\\\"bigint\\\",check:\\\"bigint_format\\\",abort:!1,format:\\\"uint64\\\",...v(r)})}function ko(e,r){return new e({type:\\\"symbol\\\",...v(r)})}function zo(e,r){return new e({type:\\\"undefined\\\",...v(r)})}function Io(e,r){return new e({type:\\\"null\\\",...v(r)})}function wo(e){return new e({type:\\\"any\\\"})}function So(e){return new e({type:\\\"unknown\\\"})}function jo(e,r){return new e({type:\\\"never\\\",...v(r)})}function Oo(e,r){return new e({type:\\\"void\\\",...v(r)})}function Po(e,r){return new e({type:\\\"date\\\",...v(r)})}function Uo(e,r){return new e({type:\\\"date\\\",coerce:!0,...v(r)})}function No(e,r){return new e({type:\\\"nan\\\",...v(r)})}function H(e,r){return new Rt({check:\\\"less_than\\\",...v(r),value:e,inclusive:!1})}function G(e,r){return new Rt({check:\\\"less_than\\\",...v(r),value:e,inclusive:!0})}function ee(e,r){return new Lt({check:\\\"greater_than\\\",...v(r),value:e,inclusive:!1})}function C(e,r){return new Lt({check:\\\"greater_than\\\",...v(r),value:e,inclusive:!0})}function Zo(e){return ee(0,e)}function Do(e){return H(0,e)}function To(e){return G(0,e)}function Eo(e){return C(0,e)}function $e(e,r){return new Sn({check:\\\"multiple_of\\\",...v(r),value:e})}function Oe(e,r){return new Pn({check:\\\"max_size\\\",...v(r),maximum:e})}function be(e,r){return new Un({check:\\\"min_size\\\",...v(r),minimum:e})}function it(e,r){return new Nn({check:\\\"size_equals\\\",...v(r),size:e})}function Pe(e,r){return new Zn({check:\\\"max_length\\\",...v(r),maximum:e})}function le(e,r){return new Dn({check:\\\"min_length\\\",...v(r),minimum:e})}function Ue(e,r){return new Tn({check:\\\"length_equals\\\",...v(r),length:e})}function ot(e,r){return new En({check:\\\"string_format\\\",format:\\\"regex\\\",...v(r),pattern:e})}function at(e){return new An({check:\\\"string_format\\\",format:\\\"lowercase\\\",...v(e)})}function ut(e){return new Rn({check:\\\"string_format\\\",format:\\\"uppercase\\\",...v(e)})}function ct(e,r){return new Ln({check:\\\"string_format\\\",format:\\\"includes\\\",...v(r),includes:e})}function st(e,r){return new Cn({check:\\\"string_format\\\",format:\\\"starts_with\\\",...v(r),prefix:e})}function lt(e,r){return new Vn({check:\\\"string_format\\\",format:\\\"ends_with\\\",...v(r),suffix:e})}function Ao(e,r,n){return new Fn({check:\\\"property\\\",property:e,schema:r,...v(n)})}function dt(e,r){return new Jn({check:\\\"mime_type\\\",mime:e,...v(r)})}function te(e){return new Mn({check:\\\"overwrite\\\",tx:e})}function mt(e){return te(r=>r.normalize(e))}function ft(){return te(e=>e.trim())}function pt(){return te(e=>e.toLowerCase())}function gt(){return te(e=>e.toUpperCase())}function Ro(e,r,n){return new e({type:\\\"array\\\",element:r,...v(n)})}function fd(e,r,n){return new e({type:\\\"union\\\",options:r,...v(n)})}function pd(e,r,n,o){return new e({type:\\\"union\\\",options:n,discriminator:r,...v(o)})}function gd(e,r,n){return new e({type:\\\"intersection\\\",left:r,right:n})}function vd(e,r,n,o){let t=n instanceof x,i=t?o:n,a=t?n:null;return new e({type:\\\"tuple\\\",items:r,rest:a,...v(i)})}function hd(e,r,n,o){return new e({type:\\\"record\\\",keyType:r,valueType:n,...v(o)})}function $d(e,r,n,o){return new e({type:\\\"map\\\",keyType:r,valueType:n,...v(o)})}function bd(e,r,n){return new e({type:\\\"set\\\",valueType:r,...v(n)})}function _d(e,r,n){let o=Array.isArray(r)?Object.fromEntries(r.map(t=>[t,t])):r;return new e({type:\\\"enum\\\",entries:o,...v(n)})}function yd(e,r,n){return new e({type:\\\"enum\\\",entries:r,...v(n)})}function xd(e,r,n){return new e({type:\\\"literal\\\",values:Array.isArray(r)?r:[r],...v(n)})}function Lo(e,r){return new e({type:\\\"file\\\",...v(r)})}function kd(e,r){return new e({type:\\\"transform\\\",transform:r})}function zd(e,r){return new e({type:\\\"optional\\\",innerType:r})}function Id(e,r){return new e({type:\\\"nullable\\\",innerType:r})}function wd(e,r,n){return new e({type:\\\"default\\\",innerType:r,get defaultValue(){return typeof n==\\\"function\\\"?n():Fr(n)}})}function Sd(e,r,n){return new e({type:\\\"nonoptional\\\",innerType:r,...v(n)})}function jd(e,r){return new e({type:\\\"success\\\",innerType:r})}function Od(e,r,n){return new e({type:\\\"catch\\\",innerType:r,catchValue:typeof n==\\\"function\\\"?n:()=>n})}function Pd(e,r,n){return new e({type:\\\"pipe\\\",in:r,out:n})}function Ud(e,r){return new e({type:\\\"readonly\\\",innerType:r})}function Nd(e,r,n){return new e({type:\\\"template_literal\\\",parts:r,...v(n)})}function Zd(e,r){return new e({type:\\\"lazy\\\",getter:r})}function Dd(e,r){return new e({type:\\\"promise\\\",innerType:r})}function Co(e,r,n){let o=v(n);return o.abort??(o.abort=!0),new e({type:\\\"custom\\\",check:\\\"custom\\\",fn:r,...o})}function Vo(e,r,n){return new e({type:\\\"custom\\\",check:\\\"custom\\\",fn:r,...v(n)})}function Fo(e){let r=mc(n=>(n.addIssue=o=>{if(typeof o==\\\"string\\\")n.issues.push(xe(o,n.value,r._zod.def));else{let t=o;t.fatal&&(t.continue=!1),t.code??(t.code=\\\"custom\\\"),t.input??(t.input=n.value),t.inst??(t.inst=r),t.continue??(t.continue=!r._zod.def.abort),n.issues.push(xe(t))}},e(n.value,n)));return r}function mc(e,r){let n=new Z({check:\\\"custom\\\",...v(r)});return n._zod.check=e,n}function Jo(e,r){let n=v(r),o=n.truthy??[\\\"true\\\",\\\"1\\\",\\\"yes\\\",\\\"on\\\",\\\"y\\\",\\\"enabled\\\"],t=n.falsy??[\\\"false\\\",\\\"0\\\",\\\"no\\\",\\\"off\\\",\\\"n\\\",\\\"disabled\\\"];n.case!==\\\"sensitive\\\"&&(o=o.map($=>typeof $==\\\"string\\\"?$.toLowerCase():$),t=t.map($=>typeof $==\\\"string\\\"?$.toLowerCase():$));let i=new Set(o),a=new Set(t),u=e.Codec??Qe,s=e.Boolean??Ye,m=e.String??he,f=new m({type:\\\"string\\\",error:n.error}),g=new s({type:\\\"boolean\\\",error:n.error}),y=new u({type:\\\"pipe\\\",in:f,out:g,transform:($,d)=>{let b=$;return n.case!==\\\"sensitive\\\"&&(b=b.toLowerCase()),i.has(b)?!0:a.has(b)?!1:(d.issues.push({code:\\\"invalid_value\\\",expected:\\\"stringbool\\\",values:[...i,...a],input:d.value,inst:y,continue:!1}),{})},reverseTransform:($,d)=>$===!0?o[0]||\\\"true\\\":t[0]||\\\"false\\\",error:n.error});return y}function Ne(e,r,n,o={}){let t=v(o),i={...v(o),check:\\\"string_format\\\",type:\\\"string\\\",format:r,fn:typeof n==\\\"function\\\"?n:u=>n.test(u),...t};return n instanceof RegExp&&(i.pattern=n),new e(i)}var vt=class{constructor(r){this.counter=0,this.metadataRegistry=r?.metadata??q,this.target=r?.target??\\\"draft-2020-12\\\",this.unrepresentable=r?.unrepresentable??\\\"throw\\\",this.override=r?.override??(()=>{}),this.io=r?.io??\\\"output\\\",this.seen=new Map}process(r,n={path:[],schemaPath:[]}){var o;let t=r._zod.def,i={guid:\\\"uuid\\\",url:\\\"uri\\\",datetime:\\\"date-time\\\",json_string:\\\"json-string\\\",regex:\\\"\\\"},a=this.seen.get(r);if(a)return a.count++,n.schemaPath.includes(r)&&(a.cycle=n.path),a.schema;let u={schema:{},count:1,cycle:void 0,path:n.path};this.seen.set(r,u);let s=r._zod.toJSONSchema?.();if(s)u.schema=s;else{let g={...n,schemaPath:[...n.schemaPath,r],path:n.path},y=r._zod.parent;if(y)u.ref=y,this.process(y,g),this.seen.get(y).isParent=!0;else{let $=u.schema;switch(t.type){case\\\"string\\\":{let d=$;d.type=\\\"string\\\";let{minimum:b,maximum:_,format:S,patterns:w,contentEncoding:z}=r._zod.bag;if(typeof b==\\\"number\\\"&&(d.minLength=b),typeof _==\\\"number\\\"&&(d.maxLength=_),S&&(d.format=i[S]??S,d.format===\\\"\\\"&&delete d.format),z&&(d.contentEncoding=z),w&&w.size>0){let j=[...w];j.length===1?d.pattern=j[0].source:j.length>1&&(u.schema.allOf=[...j.map(A=>({...this.target===\\\"draft-7\\\"||this.target===\\\"draft-4\\\"||this.target===\\\"openapi-3.0\\\"?{type:\\\"string\\\"}:{},pattern:A.source}))])}break}case\\\"number\\\":{let d=$,{minimum:b,maximum:_,format:S,multipleOf:w,exclusiveMaximum:z,exclusiveMinimum:j}=r._zod.bag;typeof S==\\\"string\\\"&&S.includes(\\\"int\\\")?d.type=\\\"integer\\\":d.type=\\\"number\\\",typeof j==\\\"number\\\"&&(this.target===\\\"draft-4\\\"||this.target===\\\"openapi-3.0\\\"?(d.minimum=j,d.exclusiveMinimum=!0):d.exclusiveMinimum=j),typeof b==\\\"number\\\"&&(d.minimum=b,typeof j==\\\"number\\\"&&this.target!==\\\"draft-4\\\"&&(j>=b?delete d.minimum:delete d.exclusiveMinimum)),typeof z==\\\"number\\\"&&(this.target===\\\"draft-4\\\"||this.target===\\\"openapi-3.0\\\"?(d.maximum=z,d.exclusiveMaximum=!0):d.exclusiveMaximum=z),typeof _==\\\"number\\\"&&(d.maximum=_,typeof z==\\\"number\\\"&&this.target!==\\\"draft-4\\\"&&(z<=_?delete d.maximum:delete d.exclusiveMaximum)),typeof w==\\\"number\\\"&&(d.multipleOf=w);break}case\\\"boolean\\\":{let d=$;d.type=\\\"boolean\\\";break}case\\\"bigint\\\":{if(this.unrepresentable===\\\"throw\\\")throw new Error(\\\"BigInt cannot be represented in JSON Schema\\\");break}case\\\"symbol\\\":{if(this.unrepresentable===\\\"throw\\\")throw new Error(\\\"Symbols cannot be represented in JSON Schema\\\");break}case\\\"null\\\":{this.target===\\\"openapi-3.0\\\"?($.type=\\\"string\\\",$.nullable=!0,$.enum=[null]):$.type=\\\"null\\\";break}case\\\"any\\\":break;case\\\"unknown\\\":break;case\\\"undefined\\\":{if(this.unrepresentable===\\\"throw\\\")throw new Error(\\\"Undefined cannot be represented in JSON Schema\\\");break}case\\\"void\\\":{if(this.unrepresentable===\\\"throw\\\")throw new Error(\\\"Void cannot be represented in JSON Schema\\\");break}case\\\"never\\\":{$.not={};break}case\\\"date\\\":{if(this.unrepresentable===\\\"throw\\\")throw new Error(\\\"Date cannot be represented in JSON Schema\\\");break}case\\\"array\\\":{let d=$,{minimum:b,maximum:_}=r._zod.bag;typeof b==\\\"number\\\"&&(d.minItems=b),typeof _==\\\"number\\\"&&(d.maxItems=_),d.type=\\\"array\\\",d.items=this.process(t.element,{...g,path:[...g.path,\\\"items\\\"]});break}case\\\"object\\\":{let d=$;d.type=\\\"object\\\",d.properties={};let b=t.shape;for(let w in b)d.properties[w]=this.process(b[w],{...g,path:[...g.path,\\\"properties\\\",w]});let _=new Set(Object.keys(b)),S=new Set([..._].filter(w=>{let z=t.shape[w]._zod;return this.io===\\\"input\\\"?z.optin===void 0:z.optout===void 0}));S.size>0&&(d.required=Array.from(S)),t.catchall?._zod.def.type===\\\"never\\\"?d.additionalProperties=!1:t.catchall?t.catchall&&(d.additionalProperties=this.process(t.catchall,{...g,path:[...g.path,\\\"additionalProperties\\\"]})):this.io===\\\"output\\\"&&(d.additionalProperties=!1);break}case\\\"union\\\":{let d=$,b=t.options.map((_,S)=>this.process(_,{...g,path:[...g.path,\\\"anyOf\\\",S]}));d.anyOf=b;break}case\\\"intersection\\\":{let d=$,b=this.process(t.left,{...g,path:[...g.path,\\\"allOf\\\",0]}),_=this.process(t.right,{...g,path:[...g.path,\\\"allOf\\\",1]}),S=z=>\\\"allOf\\\"in z&&Object.keys(z).length===1,w=[...S(b)?b.allOf:[b],...S(_)?_.allOf:[_]];d.allOf=w;break}case\\\"tuple\\\":{let d=$;d.type=\\\"array\\\";let b=this.target===\\\"draft-2020-12\\\"?\\\"prefixItems\\\":\\\"items\\\",_=this.target===\\\"draft-2020-12\\\"||this.target===\\\"openapi-3.0\\\"?\\\"items\\\":\\\"additionalItems\\\",S=t.items.map((A,P)=>this.process(A,{...g,path:[...g.path,b,P]})),w=t.rest?this.process(t.rest,{...g,path:[...g.path,_,...this.target===\\\"openapi-3.0\\\"?[t.items.length]:[]]}):null;this.target===\\\"draft-2020-12\\\"?(d.prefixItems=S,w&&(d.items=w)):this.target===\\\"openapi-3.0\\\"?(d.items={anyOf:S},w&&d.items.anyOf.push(w),d.minItems=S.length,w||(d.maxItems=S.length)):(d.items=S,w&&(d.additionalItems=w));let{minimum:z,maximum:j}=r._zod.bag;typeof z==\\\"number\\\"&&(d.minItems=z),typeof j==\\\"number\\\"&&(d.maxItems=j);break}case\\\"record\\\":{let d=$;d.type=\\\"object\\\",(this.target===\\\"draft-7\\\"||this.target===\\\"draft-2020-12\\\")&&(d.propertyNames=this.process(t.keyType,{...g,path:[...g.path,\\\"propertyNames\\\"]})),d.additionalProperties=this.process(t.valueType,{...g,path:[...g.path,\\\"additionalProperties\\\"]});break}case\\\"map\\\":{if(this.unrepresentable===\\\"throw\\\")throw new Error(\\\"Map cannot be represented in JSON Schema\\\");break}case\\\"set\\\":{if(this.unrepresentable===\\\"throw\\\")throw new Error(\\\"Set cannot be represented in JSON Schema\\\");break}case\\\"enum\\\":{let d=$,b=Ce(t.entries);b.every(_=>typeof _==\\\"number\\\")&&(d.type=\\\"number\\\"),b.every(_=>typeof _==\\\"string\\\")&&(d.type=\\\"string\\\"),d.enum=b;break}case\\\"literal\\\":{let d=$,b=[];for(let _ of t.values)if(_===void 0){if(this.unrepresentable===\\\"throw\\\")throw new Error(\\\"Literal `undefined` cannot be represented in JSON Schema\\\")}else if(typeof _==\\\"bigint\\\"){if(this.unrepresentable===\\\"throw\\\")throw new Error(\\\"BigInt literals cannot be represented in JSON Schema\\\");b.push(Number(_))}else b.push(_);if(b.length!==0)if(b.length===1){let _=b[0];d.type=_===null?\\\"null\\\":typeof _,this.target===\\\"draft-4\\\"||this.target===\\\"openapi-3.0\\\"?d.enum=[_]:d.const=_}else b.every(_=>typeof _==\\\"number\\\")&&(d.type=\\\"number\\\"),b.every(_=>typeof _==\\\"string\\\")&&(d.type=\\\"string\\\"),b.every(_=>typeof _==\\\"boolean\\\")&&(d.type=\\\"string\\\"),b.every(_=>_===null)&&(d.type=\\\"null\\\"),d.enum=b;break}case\\\"file\\\":{let d=$,b={type:\\\"string\\\",format:\\\"binary\\\",contentEncoding:\\\"binary\\\"},{minimum:_,maximum:S,mime:w}=r._zod.bag;_!==void 0&&(b.minLength=_),S!==void 0&&(b.maxLength=S),w?w.length===1?(b.contentMediaType=w[0],Object.assign(d,b)):d.anyOf=w.map(z=>({...b,contentMediaType:z})):Object.assign(d,b);break}case\\\"transform\\\":{if(this.unrepresentable===\\\"throw\\\")throw new Error(\\\"Transforms cannot be represented in JSON Schema\\\");break}case\\\"nullable\\\":{let d=this.process(t.innerType,g);this.target===\\\"openapi-3.0\\\"?(u.ref=t.innerType,$.nullable=!0):$.anyOf=[d,{type:\\\"null\\\"}];break}case\\\"nonoptional\\\":{this.process(t.innerType,g),u.ref=t.innerType;break}case\\\"success\\\":{let d=$;d.type=\\\"boolean\\\";break}case\\\"default\\\":{this.process(t.innerType,g),u.ref=t.innerType,$.default=JSON.parse(JSON.stringify(t.defaultValue));break}case\\\"prefault\\\":{this.process(t.innerType,g),u.ref=t.innerType,this.io===\\\"input\\\"&&($._prefault=JSON.parse(JSON.stringify(t.defaultValue)));break}case\\\"catch\\\":{this.process(t.innerType,g),u.ref=t.innerType;let d;try{d=t.catchValue(void 0)}catch{throw new Error(\\\"Dynamic catch values are not supported in JSON Schema\\\")}$.default=d;break}case\\\"nan\\\":{if(this.unrepresentable===\\\"throw\\\")throw new Error(\\\"NaN cannot be represented in JSON Schema\\\");break}case\\\"template_literal\\\":{let d=$,b=r._zod.pattern;if(!b)throw new Error(\\\"Pattern not found in template literal\\\");d.type=\\\"string\\\",d.pattern=b.source;break}case\\\"pipe\\\":{let d=this.io===\\\"input\\\"?t.in._zod.def.type===\\\"transform\\\"?t.out:t.in:t.out;this.process(d,g),u.ref=d;break}case\\\"readonly\\\":{this.process(t.innerType,g),u.ref=t.innerType,$.readOnly=!0;break}case\\\"promise\\\":{this.process(t.innerType,g),u.ref=t.innerType;break}case\\\"optional\\\":{this.process(t.innerType,g),u.ref=t.innerType;break}case\\\"lazy\\\":{let d=r._zod.innerType;this.process(d,g),u.ref=d;break}case\\\"custom\\\":{if(this.unrepresentable===\\\"throw\\\")throw new Error(\\\"Custom types cannot be represented in JSON Schema\\\");break}case\\\"function\\\":{if(this.unrepresentable===\\\"throw\\\")throw new Error(\\\"Function types cannot be represented in JSON Schema\\\");break}default:}}}let m=this.metadataRegistry.get(r);return m&&Object.assign(u.schema,m),this.io===\\\"input\\\"&&T(r)&&(delete u.schema.examples,delete u.schema.default),this.io===\\\"input\\\"&&u.schema._prefault&&((o=u.schema).default??(o.default=u.schema._prefault)),delete u.schema._prefault,this.seen.get(r).schema}emit(r,n){let o={cycles:n?.cycles??\\\"ref\\\",reused:n?.reused??\\\"inline\\\",external:n?.external??void 0},t=this.seen.get(r);if(!t)throw new Error(\\\"Unprocessed schema. This is a bug in Zod.\\\");let i=f=>{let g=this.target===\\\"draft-2020-12\\\"?\\\"$defs\\\":\\\"definitions\\\";if(o.external){let b=o.external.registry.get(f[0])?.id,_=o.external.uri??(w=>w);if(b)return{ref:_(b)};let S=f[1].defId??f[1].schema.id??`schema${this.counter++}`;return f[1].defId=S,{defId:S,ref:`${_(\\\"__shared\\\")}#/${g}/${S}`}}if(f[1]===t)return{ref:\\\"#\\\"};let $=`#/${g}/`,d=f[1].schema.id??`__schema${this.counter++}`;return{defId:d,ref:$+d}},a=f=>{if(f[1].schema.$ref)return;let g=f[1],{ref:y,defId:$}=i(f);g.def={...g.schema},$&&(g.defId=$);let d=g.schema;for(let b in d)delete d[b];d.$ref=y};if(o.cycles===\\\"throw\\\")for(let f of this.seen.entries()){let g=f[1];if(g.cycle)throw new Error(`Cycle detected: #/${g.cycle?.join(\\\"/\\\")}/<root>\\n\\nSet the \\\\`cycles\\\\` parameter to \\\\`\\\"ref\\\"\\\\` to resolve cyclical schemas with defs.`)}for(let f of this.seen.entries()){let g=f[1];if(r===f[0]){a(f);continue}if(o.external){let $=o.external.registry.get(f[0])?.id;if(r!==f[0]&&$){a(f);continue}}if(this.metadataRegistry.get(f[0])?.id){a(f);continue}if(g.cycle){a(f);continue}if(g.count>1&&o.reused===\\\"ref\\\"){a(f);continue}}let u=(f,g)=>{let y=this.seen.get(f),$=y.def??y.schema,d={...$};if(y.ref===null)return;let b=y.ref;if(y.ref=null,b){u(b,g);let _=this.seen.get(b).schema;_.$ref&&(g.target===\\\"draft-7\\\"||g.target===\\\"draft-4\\\"||g.target===\\\"openapi-3.0\\\")?($.allOf=$.allOf??[],$.allOf.push(_)):(Object.assign($,_),Object.assign($,d))}y.isParent||this.override({zodSchema:f,jsonSchema:$,path:y.path??[]})};for(let f of[...this.seen.entries()].reverse())u(f[0],{target:this.target});let s={};if(this.target===\\\"draft-2020-12\\\"?s.$schema=\\\"https://json-schema.org/draft/2020-12/schema\\\":this.target===\\\"draft-7\\\"?s.$schema=\\\"http://json-schema.org/draft-07/schema#\\\":this.target===\\\"draft-4\\\"?s.$schema=\\\"http://json-schema.org/draft-04/schema#\\\":this.target===\\\"openapi-3.0\\\"||console.warn(`Invalid target: ${this.target}`),o.external?.uri){let f=o.external.registry.get(r)?.id;if(!f)throw new Error(\\\"Schema is missing an `id` property\\\");s.$id=o.external.uri(f)}Object.assign(s,t.def);let m=o.external?.defs??{};for(let f of this.seen.entries()){let g=f[1];g.def&&g.defId&&(m[g.defId]=g.def)}o.external||Object.keys(m).length>0&&(this.target===\\\"draft-2020-12\\\"?s.$defs=m:s.definitions=m);try{return JSON.parse(JSON.stringify(s))}catch{throw new Error(\\\"Error converting schema to JSON.\\\")}}};function Mo(e,r){if(e instanceof je){let o=new vt(r),t={};for(let u of e._idmap.entries()){let[s,m]=u;o.process(m)}let i={},a={registry:e,uri:r?.uri,defs:t};for(let u of e._idmap.entries()){let[s,m]=u;i[s]=o.emit(m,{...r,external:a})}if(Object.keys(t).length>0){let u=o.target===\\\"draft-2020-12\\\"?\\\"$defs\\\":\\\"definitions\\\";i.__shared={[u]:t}}return{schemas:i}}let n=new vt(r);return n.process(e),n.emit(e,r)}function T(e,r){let n=r??{seen:new Set};if(n.seen.has(e))return!1;n.seen.add(e);let t=e._zod.def;switch(t.type){case\\\"string\\\":case\\\"number\\\":case\\\"bigint\\\":case\\\"boolean\\\":case\\\"date\\\":case\\\"symbol\\\":case\\\"undefined\\\":case\\\"null\\\":case\\\"any\\\":case\\\"unknown\\\":case\\\"never\\\":case\\\"void\\\":case\\\"literal\\\":case\\\"enum\\\":case\\\"nan\\\":case\\\"file\\\":case\\\"template_literal\\\":return!1;case\\\"array\\\":return T(t.element,n);case\\\"object\\\":{for(let i in t.shape)if(T(t.shape[i],n))return!0;return!1}case\\\"union\\\":{for(let i of t.options)if(T(i,n))return!0;return!1}case\\\"intersection\\\":return T(t.left,n)||T(t.right,n);case\\\"tuple\\\":{for(let i of t.items)if(T(i,n))return!0;return!!(t.rest&&T(t.rest,n))}case\\\"record\\\":return T(t.keyType,n)||T(t.valueType,n);case\\\"map\\\":return T(t.keyType,n)||T(t.valueType,n);case\\\"set\\\":return T(t.valueType,n);case\\\"promise\\\":case\\\"optional\\\":case\\\"nonoptional\\\":case\\\"nullable\\\":case\\\"readonly\\\":return T(t.innerType,n);case\\\"lazy\\\":return T(t.getter(),n);case\\\"default\\\":return T(t.innerType,n);case\\\"prefault\\\":return T(t.innerType,n);case\\\"custom\\\":return!1;case\\\"transform\\\":return!0;case\\\"pipe\\\":return T(t.in,n)||T(t.out,n);case\\\"success\\\":return!1;case\\\"catch\\\":return!1;case\\\"function\\\":return!1;default:}throw new Error(`Unknown schema type: ${t.type}`)}var fc={};var kr={};pe(kr,{ZodISODate:()=>_r,ZodISODateTime:()=>br,ZodISODuration:()=>xr,ZodISOTime:()=>yr,date:()=>Ko,datetime:()=>Bo,duration:()=>Wo,time:()=>Go});var br=c(\\\"ZodISODateTime\\\",(e,r)=>{ii.init(e,r),N.init(e,r)});function Bo(e){return oo(br,e)}var _r=c(\\\"ZodISODate\\\",(e,r)=>{oi.init(e,r),N.init(e,r)});function Ko(e){return ao(_r,e)}var yr=c(\\\"ZodISOTime\\\",(e,r)=>{ai.init(e,r),N.init(e,r)});function Go(e){return uo(yr,e)}var xr=c(\\\"ZodISODuration\\\",(e,r)=>{ui.init(e,r),N.init(e,r)});function Wo(e){return co(xr,e)}var gc=(e,r)=>{Be.init(e,r),e.name=\\\"ZodError\\\",Object.defineProperties(e,{format:{value:n=>Ge(e,n)},flatten:{value:n=>Ke(e,n)},addIssue:{value:n=>{e.issues.push(n),e.message=JSON.stringify(e.issues,_e,2)}},addIssues:{value:n=>{e.issues.push(...n),e.message=JSON.stringify(e.issues,_e,2)}},isEmpty:{get(){return e.issues.length===0}}})},Ed=c(\\\"ZodError\\\",gc),V=c(\\\"ZodError\\\",gc,{Parent:Error});var Xo=ke(V),qo=ze(V),Yo=Ie(V),Qo=we(V),Ho=Ot(V),ea=Pt(V),ta=Ut(V),ra=Nt(V),na=Zt(V),ia=Dt(V),oa=Tt(V),aa=Et(V);var k=c(\\\"ZodType\\\",(e,r)=>(x.init(e,r),e.def=r,e.type=r.type,Object.defineProperty(e,\\\"_def\\\",{value:r}),e.check=(...n)=>e.clone(h.mergeDefs(r,{checks:[...r.checks??[],...n.map(o=>typeof o==\\\"function\\\"?{_zod:{check:o,def:{check:\\\"custom\\\"},onattach:[]}}:o)]})),e.clone=(n,o)=>R(e,n,o),e.brand=()=>e,e.register=(n,o)=>(n.add(e,o),e),e.parse=(n,o)=>Xo(e,n,o,{callee:e.parse}),e.safeParse=(n,o)=>Yo(e,n,o),e.parseAsync=async(n,o)=>qo(e,n,o,{callee:e.parseAsync}),e.safeParseAsync=async(n,o)=>Qo(e,n,o),e.spa=e.safeParseAsync,e.encode=(n,o)=>Ho(e,n,o),e.decode=(n,o)=>ea(e,n,o),e.encodeAsync=async(n,o)=>ta(e,n,o),e.decodeAsync=async(n,o)=>ra(e,n,o),e.safeEncode=(n,o)=>na(e,n,o),e.safeDecode=(n,o)=>ia(e,n,o),e.safeEncodeAsync=async(n,o)=>oa(e,n,o),e.safeDecodeAsync=async(n,o)=>aa(e,n,o),e.refine=(n,o)=>e.check(ts(n,o)),e.superRefine=n=>e.check(rs(n)),e.overwrite=n=>e.check(te(n)),e.optional=()=>Ir(e),e.nullable=()=>wr(e),e.nullish=()=>Ir(wr(e)),e.nonoptional=n=>Jc(e,n),e.array=()=>Pr(e),e.or=n=>Oa([e,n]),e.and=n=>Oc(e,n),e.transform=n=>Sr(e,Na(n)),e.default=n=>Cc(e,n),e.prefault=n=>Fc(e,n),e.catch=n=>Kc(e,n),e.pipe=n=>Sr(e,n),e.readonly=()=>Xc(e),e.describe=n=>{let o=e.clone();return q.add(o,{description:n}),o},Object.defineProperty(e,\\\"description\\\",{get(){return q.get(e)?.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return q.get(e);let o=e.clone();return q.add(o,n[0]),o},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),sa=c(\\\"_ZodString\\\",(e,r)=>{he.init(e,r),k.init(e,r);let n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...o)=>e.check(ot(...o)),e.includes=(...o)=>e.check(ct(...o)),e.startsWith=(...o)=>e.check(st(...o)),e.endsWith=(...o)=>e.check(lt(...o)),e.min=(...o)=>e.check(le(...o)),e.max=(...o)=>e.check(Pe(...o)),e.length=(...o)=>e.check(Ue(...o)),e.nonempty=(...o)=>e.check(le(1,...o)),e.lowercase=o=>e.check(at(o)),e.uppercase=o=>e.check(ut(o)),e.trim=()=>e.check(ft()),e.normalize=(...o)=>e.check(mt(...o)),e.toLowerCase=()=>e.check(pt()),e.toUpperCase=()=>e.check(gt())}),$t=c(\\\"ZodString\\\",(e,r)=>{he.init(e,r),sa.init(e,r),e.email=n=>e.check(Ht(la,n)),e.url=n=>e.check(nt(jr,n)),e.jwt=n=>e.check($r(Ia,n)),e.emoji=n=>e.check(ir(da,n)),e.guid=n=>e.check(rt(zr,n)),e.uuid=n=>e.check(er(ne,n)),e.uuidv4=n=>e.check(tr(ne,n)),e.uuidv6=n=>e.check(rr(ne,n)),e.uuidv7=n=>e.check(nr(ne,n)),e.nanoid=n=>e.check(or(ma,n)),e.guid=n=>e.check(rt(zr,n)),e.cuid=n=>e.check(ar(fa,n)),e.cuid2=n=>e.check(ur(pa,n)),e.ulid=n=>e.check(cr(ga,n)),e.base64=n=>e.check(gr(xa,n)),e.base64url=n=>e.check(vr(ka,n)),e.xid=n=>e.check(sr(va,n)),e.ksuid=n=>e.check(lr(ha,n)),e.ipv4=n=>e.check(dr($a,n)),e.ipv6=n=>e.check(mr(ba,n)),e.cidrv4=n=>e.check(fr(_a,n)),e.cidrv6=n=>e.check(pr(ya,n)),e.e164=n=>e.check(hr(za,n)),e.datetime=n=>e.check(Bo(n)),e.date=n=>e.check(Ko(n)),e.time=n=>e.check(Go(n)),e.duration=n=>e.check(Wo(n))});function ua(e){return ro($t,e)}var N=c(\\\"ZodStringFormat\\\",(e,r)=>{O.init(e,r),sa.init(e,r)}),la=c(\\\"ZodEmail\\\",(e,r)=>{Xn.init(e,r),N.init(e,r)});function Rd(e){return Ht(la,e)}var zr=c(\\\"ZodGUID\\\",(e,r)=>{Gn.init(e,r),N.init(e,r)});function Ld(e){return rt(zr,e)}var ne=c(\\\"ZodUUID\\\",(e,r)=>{Wn.init(e,r),N.init(e,r)});function Cd(e){return er(ne,e)}function Vd(e){return tr(ne,e)}function Fd(e){return rr(ne,e)}function Jd(e){return nr(ne,e)}var jr=c(\\\"ZodURL\\\",(e,r)=>{qn.init(e,r),N.init(e,r)});function Md(e){return nt(jr,e)}function Bd(e){return nt(jr,{protocol:/^https?$/,hostname:K.domain,...h.normalizeParams(e)})}var da=c(\\\"ZodEmoji\\\",(e,r)=>{Yn.init(e,r),N.init(e,r)});function Kd(e){return ir(da,e)}var ma=c(\\\"ZodNanoID\\\",(e,r)=>{Qn.init(e,r),N.init(e,r)});function Gd(e){return or(ma,e)}var fa=c(\\\"ZodCUID\\\",(e,r)=>{Hn.init(e,r),N.init(e,r)});function Wd(e){return ar(fa,e)}var pa=c(\\\"ZodCUID2\\\",(e,r)=>{ei.init(e,r),N.init(e,r)});function Xd(e){return ur(pa,e)}var ga=c(\\\"ZodULID\\\",(e,r)=>{ti.init(e,r),N.init(e,r)});function qd(e){return cr(ga,e)}var va=c(\\\"ZodXID\\\",(e,r)=>{ri.init(e,r),N.init(e,r)});function Yd(e){return sr(va,e)}var ha=c(\\\"ZodKSUID\\\",(e,r)=>{ni.init(e,r),N.init(e,r)});function Qd(e){return lr(ha,e)}var $a=c(\\\"ZodIPv4\\\",(e,r)=>{ci.init(e,r),N.init(e,r)});function Hd(e){return dr($a,e)}var ba=c(\\\"ZodIPv6\\\",(e,r)=>{si.init(e,r),N.init(e,r)});function em(e){return mr(ba,e)}var _a=c(\\\"ZodCIDRv4\\\",(e,r)=>{li.init(e,r),N.init(e,r)});function tm(e){return fr(_a,e)}var ya=c(\\\"ZodCIDRv6\\\",(e,r)=>{di.init(e,r),N.init(e,r)});function rm(e){return pr(ya,e)}var xa=c(\\\"ZodBase64\\\",(e,r)=>{fi.init(e,r),N.init(e,r)});function nm(e){return gr(xa,e)}var ka=c(\\\"ZodBase64URL\\\",(e,r)=>{pi.init(e,r),N.init(e,r)});function im(e){return vr(ka,e)}var za=c(\\\"ZodE164\\\",(e,r)=>{gi.init(e,r),N.init(e,r)});function om(e){return hr(za,e)}var Ia=c(\\\"ZodJWT\\\",(e,r)=>{vi.init(e,r),N.init(e,r)});function am(e){return $r(Ia,e)}var bt=c(\\\"ZodCustomStringFormat\\\",(e,r)=>{hi.init(e,r),N.init(e,r)});function um(e,r,n={}){return Ne(bt,e,r,n)}function cm(e){return Ne(bt,\\\"hostname\\\",K.hostname,e)}function sm(e){return Ne(bt,\\\"hex\\\",K.hex,e)}function lm(e,r){let n=r?.enc??\\\"hex\\\",o=`${e}_${n}`,t=K[o];if(!t)throw new Error(`Unrecognized hash format: ${o}`);return Ne(bt,o,t,r)}var _t=c(\\\"ZodNumber\\\",(e,r)=>{Bt.init(e,r),k.init(e,r),e.gt=(o,t)=>e.check(ee(o,t)),e.gte=(o,t)=>e.check(C(o,t)),e.min=(o,t)=>e.check(C(o,t)),e.lt=(o,t)=>e.check(H(o,t)),e.lte=(o,t)=>e.check(G(o,t)),e.max=(o,t)=>e.check(G(o,t)),e.int=o=>e.check(ca(o)),e.safe=o=>e.check(ca(o)),e.positive=o=>e.check(ee(0,o)),e.nonnegative=o=>e.check(C(0,o)),e.negative=o=>e.check(H(0,o)),e.nonpositive=o=>e.check(G(0,o)),e.multipleOf=(o,t)=>e.check($e(o,t)),e.step=(o,t)=>e.check($e(o,t)),e.finite=()=>e;let n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??\\\"\\\").includes(\\\"int\\\")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function vc(e){return so(_t,e)}var De=c(\\\"ZodNumberFormat\\\",(e,r)=>{$i.init(e,r),_t.init(e,r)});function ca(e){return mo(De,e)}function dm(e){return fo(De,e)}function mm(e){return po(De,e)}function fm(e){return go(De,e)}function pm(e){return vo(De,e)}var yt=c(\\\"ZodBoolean\\\",(e,r)=>{Ye.init(e,r),k.init(e,r)});function hc(e){return ho(yt,e)}var xt=c(\\\"ZodBigInt\\\",(e,r)=>{Kt.init(e,r),k.init(e,r),e.gte=(o,t)=>e.check(C(o,t)),e.min=(o,t)=>e.check(C(o,t)),e.gt=(o,t)=>e.check(ee(o,t)),e.gte=(o,t)=>e.check(C(o,t)),e.min=(o,t)=>e.check(C(o,t)),e.lt=(o,t)=>e.check(H(o,t)),e.lte=(o,t)=>e.check(G(o,t)),e.max=(o,t)=>e.check(G(o,t)),e.positive=o=>e.check(ee(BigInt(0),o)),e.negative=o=>e.check(H(BigInt(0),o)),e.nonpositive=o=>e.check(G(BigInt(0),o)),e.nonnegative=o=>e.check(C(BigInt(0),o)),e.multipleOf=(o,t)=>e.check($e(o,t));let n=e._zod.bag;e.minValue=n.minimum??null,e.maxValue=n.maximum??null,e.format=n.format??null});function gm(e){return bo(xt,e)}var wa=c(\\\"ZodBigIntFormat\\\",(e,r)=>{bi.init(e,r),xt.init(e,r)});function vm(e){return yo(wa,e)}function hm(e){return xo(wa,e)}var $c=c(\\\"ZodSymbol\\\",(e,r)=>{_i.init(e,r),k.init(e,r)});function $m(e){return ko($c,e)}var bc=c(\\\"ZodUndefined\\\",(e,r)=>{yi.init(e,r),k.init(e,r)});function bm(e){return zo(bc,e)}var _c=c(\\\"ZodNull\\\",(e,r)=>{xi.init(e,r),k.init(e,r)});function yc(e){return Io(_c,e)}var xc=c(\\\"ZodAny\\\",(e,r)=>{ki.init(e,r),k.init(e,r)});function _m(){return wo(xc)}var kc=c(\\\"ZodUnknown\\\",(e,r)=>{zi.init(e,r),k.init(e,r)});function Ze(){return So(kc)}var zc=c(\\\"ZodNever\\\",(e,r)=>{Ii.init(e,r),k.init(e,r)});function Sa(e){return jo(zc,e)}var Ic=c(\\\"ZodVoid\\\",(e,r)=>{wi.init(e,r),k.init(e,r)});function ym(e){return Oo(Ic,e)}var Or=c(\\\"ZodDate\\\",(e,r)=>{Si.init(e,r),k.init(e,r),e.min=(o,t)=>e.check(C(o,t)),e.max=(o,t)=>e.check(G(o,t));let n=e._zod.bag;e.minDate=n.minimum?new Date(n.minimum):null,e.maxDate=n.maximum?new Date(n.maximum):null});function xm(e){return Po(Or,e)}var wc=c(\\\"ZodArray\\\",(e,r)=>{ji.init(e,r),k.init(e,r),e.element=r.element,e.min=(n,o)=>e.check(le(n,o)),e.nonempty=n=>e.check(le(1,n)),e.max=(n,o)=>e.check(Pe(n,o)),e.length=(n,o)=>e.check(Ue(n,o)),e.unwrap=()=>e.element});function Pr(e,r){return Ro(wc,e,r)}function km(e){let r=e._zod.def.shape;return Ua(Object.keys(r))}var Ur=c(\\\"ZodObject\\\",(e,r)=>{Oi.init(e,r),k.init(e,r),h.defineLazy(e,\\\"shape\\\",()=>r.shape),e.keyof=()=>Ua(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:Ze()}),e.loose=()=>e.clone({...e._zod.def,catchall:Ze()}),e.strict=()=>e.clone({...e._zod.def,catchall:Sa()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>h.extend(e,n),e.safeExtend=n=>h.safeExtend(e,n),e.merge=n=>h.merge(e,n),e.pick=n=>h.pick(e,n),e.omit=n=>h.omit(e,n),e.partial=(...n)=>h.partial(Za,e,n[0]),e.required=(...n)=>h.required(Da,e,n[0])});function zm(e,r){let n={type:\\\"object\\\",shape:e??{},...h.normalizeParams(r)};return new Ur(n)}function Im(e,r){return new Ur({type:\\\"object\\\",shape:e,catchall:Sa(),...h.normalizeParams(r)})}function wm(e,r){return new Ur({type:\\\"object\\\",shape:e,catchall:Ze(),...h.normalizeParams(r)})}var ja=c(\\\"ZodUnion\\\",(e,r)=>{Gt.init(e,r),k.init(e,r),e.options=r.options});function Oa(e,r){return new ja({type:\\\"union\\\",options:e,...h.normalizeParams(r)})}var Sc=c(\\\"ZodDiscriminatedUnion\\\",(e,r)=>{ja.init(e,r),Pi.init(e,r)});function Sm(e,r,n){return new Sc({type:\\\"union\\\",options:r,discriminator:e,...h.normalizeParams(n)})}var jc=c(\\\"ZodIntersection\\\",(e,r)=>{Ui.init(e,r),k.init(e,r)});function Oc(e,r){return new jc({type:\\\"intersection\\\",left:e,right:r})}var Pc=c(\\\"ZodTuple\\\",(e,r)=>{Wt.init(e,r),k.init(e,r),e.rest=n=>e.clone({...e._zod.def,rest:n})});function Uc(e,r,n){let o=r instanceof x,t=o?n:r,i=o?r:null;return new Pc({type:\\\"tuple\\\",items:e,rest:i,...h.normalizeParams(t)})}var Pa=c(\\\"ZodRecord\\\",(e,r)=>{Ni.init(e,r),k.init(e,r),e.keyType=r.keyType,e.valueType=r.valueType});function Nc(e,r,n){return new Pa({type:\\\"record\\\",keyType:e,valueType:r,...h.normalizeParams(n)})}function jm(e,r,n){let o=R(e);return o._zod.values=void 0,new Pa({type:\\\"record\\\",keyType:o,valueType:r,...h.normalizeParams(n)})}var Zc=c(\\\"ZodMap\\\",(e,r)=>{Zi.init(e,r),k.init(e,r),e.keyType=r.keyType,e.valueType=r.valueType});function Om(e,r,n){return new Zc({type:\\\"map\\\",keyType:e,valueType:r,...h.normalizeParams(n)})}var Dc=c(\\\"ZodSet\\\",(e,r)=>{Di.init(e,r),k.init(e,r),e.min=(...n)=>e.check(be(...n)),e.nonempty=n=>e.check(be(1,n)),e.max=(...n)=>e.check(Oe(...n)),e.size=(...n)=>e.check(it(...n))});function Pm(e,r){return new Dc({type:\\\"set\\\",valueType:e,...h.normalizeParams(r)})}var ht=c(\\\"ZodEnum\\\",(e,r)=>{Ti.init(e,r),k.init(e,r),e.enum=r.entries,e.options=Object.values(r.entries);let n=new Set(Object.keys(r.entries));e.extract=(o,t)=>{let i={};for(let a of o)if(n.has(a))i[a]=r.entries[a];else throw new Error(`Key ${a} not found in enum`);return new ht({...r,checks:[],...h.normalizeParams(t),entries:i})},e.exclude=(o,t)=>{let i={...r.entries};for(let a of o)if(n.has(a))delete i[a];else throw new Error(`Key ${a} not found in enum`);return new ht({...r,checks:[],...h.normalizeParams(t),entries:i})}});function Ua(e,r){let n=Array.isArray(e)?Object.fromEntries(e.map(o=>[o,o])):e;return new ht({type:\\\"enum\\\",entries:n,...h.normalizeParams(r)})}function Um(e,r){return new ht({type:\\\"enum\\\",entries:e,...h.normalizeParams(r)})}var Tc=c(\\\"ZodLiteral\\\",(e,r)=>{Ei.init(e,r),k.init(e,r),e.values=new Set(r.values),Object.defineProperty(e,\\\"value\\\",{get(){if(r.values.length>1)throw new Error(\\\"This schema contains multiple valid literal values. Use `.values` instead.\\\");return r.values[0]}})});function Nm(e,r){return new Tc({type:\\\"literal\\\",values:Array.isArray(e)?e:[e],...h.normalizeParams(r)})}var Ec=c(\\\"ZodFile\\\",(e,r)=>{Ai.init(e,r),k.init(e,r),e.min=(n,o)=>e.check(be(n,o)),e.max=(n,o)=>e.check(Oe(n,o)),e.mime=(n,o)=>e.check(dt(Array.isArray(n)?n:[n],o))});function Zm(e){return Lo(Ec,e)}var Ac=c(\\\"ZodTransform\\\",(e,r)=>{Ri.init(e,r),k.init(e,r),e._zod.parse=(n,o)=>{if(o.direction===\\\"backward\\\")throw new ie(e.constructor.name);n.addIssue=i=>{if(typeof i==\\\"string\\\")n.issues.push(h.issue(i,n.value,r));else{let a=i;a.fatal&&(a.continue=!1),a.code??(a.code=\\\"custom\\\"),a.input??(a.input=n.value),a.inst??(a.inst=e),n.issues.push(h.issue(a))}};let t=r.transform(n.value,n);return t instanceof Promise?t.then(i=>(n.value=i,n)):(n.value=t,n)}});function Na(e){return new Ac({type:\\\"transform\\\",transform:e})}var Za=c(\\\"ZodOptional\\\",(e,r)=>{Li.init(e,r),k.init(e,r),e.unwrap=()=>e._zod.def.innerType});function Ir(e){return new Za({type:\\\"optional\\\",innerType:e})}var Rc=c(\\\"ZodNullable\\\",(e,r)=>{Ci.init(e,r),k.init(e,r),e.unwrap=()=>e._zod.def.innerType});function wr(e){return new Rc({type:\\\"nullable\\\",innerType:e})}function Dm(e){return Ir(wr(e))}var Lc=c(\\\"ZodDefault\\\",(e,r)=>{Vi.init(e,r),k.init(e,r),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function Cc(e,r){return new Lc({type:\\\"default\\\",innerType:e,get defaultValue(){return typeof r==\\\"function\\\"?r():h.shallowClone(r)}})}var Vc=c(\\\"ZodPrefault\\\",(e,r)=>{Fi.init(e,r),k.init(e,r),e.unwrap=()=>e._zod.def.innerType});function Fc(e,r){return new Vc({type:\\\"prefault\\\",innerType:e,get defaultValue(){return typeof r==\\\"function\\\"?r():h.shallowClone(r)}})}var Da=c(\\\"ZodNonOptional\\\",(e,r)=>{Ji.init(e,r),k.init(e,r),e.unwrap=()=>e._zod.def.innerType});function Jc(e,r){return new Da({type:\\\"nonoptional\\\",innerType:e,...h.normalizeParams(r)})}var Mc=c(\\\"ZodSuccess\\\",(e,r)=>{Mi.init(e,r),k.init(e,r),e.unwrap=()=>e._zod.def.innerType});function Tm(e){return new Mc({type:\\\"success\\\",innerType:e})}var Bc=c(\\\"ZodCatch\\\",(e,r)=>{Bi.init(e,r),k.init(e,r),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function Kc(e,r){return new Bc({type:\\\"catch\\\",innerType:e,catchValue:typeof r==\\\"function\\\"?r:()=>r})}var Gc=c(\\\"ZodNaN\\\",(e,r)=>{Ki.init(e,r),k.init(e,r)});function Em(e){return No(Gc,e)}var Ta=c(\\\"ZodPipe\\\",(e,r)=>{Gi.init(e,r),k.init(e,r),e.in=r.in,e.out=r.out});function Sr(e,r){return new Ta({type:\\\"pipe\\\",in:e,out:r})}var Ea=c(\\\"ZodCodec\\\",(e,r)=>{Ta.init(e,r),Qe.init(e,r)});function Am(e,r,n){return new Ea({type:\\\"pipe\\\",in:e,out:r,transform:n.decode,reverseTransform:n.encode})}var Wc=c(\\\"ZodReadonly\\\",(e,r)=>{Wi.init(e,r),k.init(e,r),e.unwrap=()=>e._zod.def.innerType});function Xc(e){return new Wc({type:\\\"readonly\\\",innerType:e})}var qc=c(\\\"ZodTemplateLiteral\\\",(e,r)=>{Xi.init(e,r),k.init(e,r)});function Rm(e,r){return new qc({type:\\\"template_literal\\\",parts:e,...h.normalizeParams(r)})}var Yc=c(\\\"ZodLazy\\\",(e,r)=>{Qi.init(e,r),k.init(e,r),e.unwrap=()=>e._zod.def.getter()});function Qc(e){return new Yc({type:\\\"lazy\\\",getter:e})}var Hc=c(\\\"ZodPromise\\\",(e,r)=>{Yi.init(e,r),k.init(e,r),e.unwrap=()=>e._zod.def.innerType});function Lm(e){return new Hc({type:\\\"promise\\\",innerType:e})}var es=c(\\\"ZodFunction\\\",(e,r)=>{qi.init(e,r),k.init(e,r)});function Cm(e){return new es({type:\\\"function\\\",input:Array.isArray(e?.input)?Uc(e?.input):e?.input??Pr(Ze()),output:e?.output??Ze()})}var Nr=c(\\\"ZodCustom\\\",(e,r)=>{Hi.init(e,r),k.init(e,r)});function Vm(e){let r=new Z({check:\\\"custom\\\"});return r._zod.check=e,r}function Fm(e,r){return Co(Nr,e??(()=>!0),r)}function ts(e,r={}){return Vo(Nr,e,r)}function rs(e){return Fo(e)}function Jm(e,r={error:`Input not instance of ${e.name}`}){let n=new Nr({type:\\\"custom\\\",check:\\\"custom\\\",fn:o=>o instanceof e,abort:!0,...h.normalizeParams(r)});return n._zod.bag.Class=e,n}var Mm=(...e)=>Jo({Codec:Ea,Boolean:yt,String:$t},...e);function Bm(e){let r=Qc(()=>Oa([ua(e),vc(),hc(),yc(),Pr(r),Nc(ua(),r)]));return r}function Km(e,r){return Sr(Na(e),r)}var Gm={invalid_type:\\\"invalid_type\\\",too_big:\\\"too_big\\\",too_small:\\\"too_small\\\",invalid_format:\\\"invalid_format\\\",not_multiple_of:\\\"not_multiple_of\\\",unrecognized_keys:\\\"unrecognized_keys\\\",invalid_union:\\\"invalid_union\\\",invalid_key:\\\"invalid_key\\\",invalid_element:\\\"invalid_element\\\",invalid_value:\\\"invalid_value\\\",custom:\\\"custom\\\"};function Wm(e){D({customError:e})}function Xm(){return D().customError}var Aa;Aa||(Aa={});var Ra={};pe(Ra,{bigint:()=>Hm,boolean:()=>Qm,date:()=>ef,number:()=>Ym,string:()=>qm});function qm(e){return no($t,e)}function Ym(e){return lo(_t,e)}function Qm(e){return $o(yt,e)}function Hm(e){return _o(xt,e)}function ef(e){return Uo(Or,e)}D(Xt());var rv=Te.union([Te.enum([\\\"low\\\",\\\"medium\\\",\\\"high\\\",\\\"always-visible\\\"]),Te.number()]);var Zr=5;var tf=9,de=200,Dr=10;function ns(e,r,n,o,t,i,a=\\\"-1\\\"){let u=1/0,s=1/0,m=-1/0,f=-1/0,g=new U(-Dr,0,5,n),y=new U(-Dr,0,r,5),$=new U(r-5,0,r+Dr,n),d=new U(0,n-5,r,n+Dr),b=rf(r,n,o,t,i),_=[g,y,$,d],S=new U(-de,-de,r+de*2,n+de*2);for(let P of e){let Y,Ee;for(let M=0;M<P.bboxes.length;M++){if(P.bboxes[M]==null||(Y=P.bboxes[M].boundingBox,Ee=P.bboxes[M].index,P.lockedToStrategyIndex!==-1&&Ee!==P.lockedToStrategyIndex))continue;let[kt,B,me,La]=Y,[fe,os,Ca,as]=[P.y-kt,P.y+B,P.x-me,P.x+La],Tr=Ca,Er=fe,Va=as-Ca,Fa=os-fe;u=Math.min(u,Tr)-de,s=Math.min(s,Er)-de,m=Math.max(m,Tr+Va)+de,f=Math.max(f,Er+Fa)+de,P.bboxes[M].boundingRect=new U(Tr,Er,Va,Fa)}}let w=new Ae(new U(u,s,m-u,f-s)),z={msgId:a,colliders:new Array(e.length),staticColliders:[],debug:[]},j=0;for(let P=0;P<e.length;P++){let Y=e[P];Y.bboxes?.[0]?.index===tf&&(z.staticColliders.push(Y.bboxes[0].boundingRect),w.insert(Y.bboxes[0].boundingRect),j++)}e=e.slice(j,e.length);let A;for(let P=0;P<e.length;P++)if(A=e[P],z.colliders[P]=[-1,0],A.enabledAndVisible){let[Y,Ee,M]=[1/0,-1,void 0];for(let{index:kt,boundingRect:B}of A.bboxes){if(B==null)continue;let me=[];if(me=w.queryRect(B).filter(fe=>B.intersects(fe)),A.shouldCollideWithScreenEdges&&_.forEach(fe=>{B.intersects(fe)&&me.push(fe)}),B.intersects(b)){z.colliders[P]=[-1,0,B];break}if(me.length<=Y&&(M=B,Ee=kt,Y=me.length),me.length===0){w.insert(B),z.colliders[P]=[kt,S.contains(B)?0:1,B];break}}A.rank===Zr&&M!=null&&(w.insert(M),z.colliders[P]=[Ee,S.contains(M)?0:1,M])}else z.colliders[P]=[-1,0];return z}function rf(e,r,n,o,t){switch(t){case\\\"top-left\\\":return new U(0,0,n,o);case\\\"top-right\\\":return new U(e-n,0,n,o);case\\\"bottom-left\\\":return new U(0,r-o,n,o);case\\\"bottom-right\\\":return new U(e-n,r-o,n,o);case\\\"center\\\":return new U((e-n)/2,(r-o)/2,n,o);case\\\"top\\\":return new U((e-n)/2,0,n,o);case\\\"bottom\\\":return new U((e-n)/2,r-o,n,o);case\\\"left\\\":return new U(0,(r-o)/2,n,o);case\\\"right\\\":return new U(e-n,(r-o)/2,n,o);default:return new U(0,r-o,n,o)}}function is(e){let r=e[0].map(n=>{let o=n[0].map(t=>({index:t[4],boundingBox:[t[0],t[1],t[2],t[3]]}));return{enabledAndVisible:n[1]===1,rank:n[2]===1?Zr:0,x:n[3],y:n[4],shouldCollideWithScreenEdges:n[5]===1,bboxes:o,lockedToStrategyIndex:n[6]}});return{msgId:\\\"-1\\\",totalWidth:e[3],totalHeight:e[2],watermarkWidth:e[4],watermarkHeight:e[5],watermarkPosition:e[6],colliders:r,devicePixelRatio:e[1]}}self.onmessage=e=>{let r=is(e.data);self.postMessage(ns(r.colliders,r.totalWidth,r.totalHeight,r.watermarkWidth,r.watermarkHeight,r.watermarkPosition,r.msgId))};})();\\n\";", "export * from './src';\n", "export { QuadTree } from './quad-tree';\nexport { Rectangle } from './rectangle';\n", "import { appendItems } from './utils';\nimport type { Point2D } from './types';\nimport { Rectangle } from './rectangle';\n\n/**\n * This is a QuadTree implementation that can be used to store rectangles\n * and query them based on their position.\n *\n * @template T - The type of data stored in the QuadTree.\n */\nexport class QuadTree<T = unknown> {\n\t/**\n\t * The top-left quadrant of this QuadTree.\n\t */\n\tpublic topLeft!: QuadTree<T>;\n\n\t/**\n\t * The top-right quadrant of this QuadTree.\n\t */\n\tpublic topRight!: QuadTree<T>;\n\n\t/**\n\t * The bottom-left quadrant of this QuadTree.\n\t */\n\tpublic bottomLeft!: QuadTree<T>;\n\n\t/**\n\t * The bottom-right quadrant of this QuadTree.\n\t */\n\tpublic bottomRight!: QuadTree<T>;\n\n\t/**\n\t * Whether this QuadTree has been subdivided.\n\t */\n\tpublic divided = false;\n\t/**\n\t * The boundary of this QuadTree.\n\t */\n\tpublic readonly boundary: Rectangle<T>;\n\n\t/**\n\t * The maximum number of objects a QuadTree node can hold before subdividing.\n\t */\n\tpublic capacity = 16;\n\n\t/**\n\t * The list of objects in this QuadTree node.\n\t */\n\tpublic readonly objects: Rectangle<T>[] = [];\n\n\t/**\n\t * The parent QuadTree node.\n\t */\n\tpublic readonly parent?: QuadTree<T>;\n\n\t/**\n\t * Creates an instance of QuadTree.\n\t *\n\t * @param {Rectangle<T>} boundary - The boundary of this QuadTree.\n\t * @param {QuadTree<T>} [parent] - The parent QuadTree node.\n\t */\n\tconstructor(boundary: Rectangle<T>, parent?: QuadTree<T>) {\n\t\tthis.parent = parent;\n\t\tthis.boundary = boundary;\n\t}\n\n\t/**\n\t * Gets the total number of objects in this QuadTree.\n\t *\n\t * @returns {number} The total number of objects.\n\t */\n\tpublic getSize(): number {\n\t\tif (!this.divided) {\n\t\t\treturn this.objects.length;\n\t\t} else {\n\t\t\treturn (\n\t\t\t\tthis.objects.length +\n\t\t\t\tthis.topLeft.getSize() +\n\t\t\t\tthis.topRight.getSize() +\n\t\t\t\tthis.bottomLeft.getSize() +\n\t\t\t\tthis.bottomRight.getSize()\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Subdivides this QuadTree into four quadrants.\n\t */\n\tpublic subdivide(): void {\n\t\tconst { x, y, w, h } = this.boundary;\n\n\t\tthis.topLeft = new QuadTree(new Rectangle(x, y, w / 2, h / 2), this);\n\t\tthis.topRight = new QuadTree(new Rectangle(x + w / 2, y, w / 2, h / 2), this);\n\t\tthis.bottomLeft = new QuadTree(new Rectangle(x, y + h / 2, w / 2, h / 2), this);\n\t\tthis.bottomRight = new QuadTree(new Rectangle(x + w / 2, y + h / 2, w / 2, h / 2), this);\n\t\tthis.divided = true;\n\t}\n\n\t/**\n\t * Queries this QuadTree for rectangles that intersect the given rectangle.\n\t *\n\t * @param {Rectangle} rectangle - The rectangle to query.\n\t * @returns {Rectangle<T>[]} The list of intersecting rectangles.\n\t */\n\tpublic queryRect(rectangle: Rectangle): Rectangle<T>[] {\n\t\tlet result: Rectangle<T>[] = [];\n\n\t\t// If rectangle is not overlapping this quadrant, return an empty array\n\t\tif (!this.boundary.intersects(rectangle)) {\n\t\t\treturn [];\n\t\t} else {\n\t\t\tresult.push(...this.objects);\n\t\t}\n\t\tif (this.divided) {\n\t\t\tappendItems(result, this.topLeft.queryRect(rectangle));\n\t\t\tappendItems(result, this.topRight.queryRect(rectangle));\n\t\t\tappendItems(result, this.bottomLeft.queryRect(rectangle));\n\t\t\tappendItems(result, this.bottomRight.queryRect(rectangle));\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Queries this QuadTree for rectangles that contain the given point.\n\t *\n\t * @param {Point2D} point - The point to query.\n\t * @returns {Rectangle<T>[]} The list of rectangles containing the point.\n\t */\n\tpublic queryPoint(point: Point2D): Rectangle<T>[] {\n\t\tconst result: Rectangle<T>[] = [];\n\n\t\t// If the target point is not inside of the rectangle, return an empty array\n\t\tif (!this.boundary.intersectsPoint(point)) {\n\t\t\treturn [];\n\t\t} else {\n\t\t\tresult.push(...this.objects);\n\t\t}\n\n\t\tif (this.divided) {\n\t\t\tappendItems(result, this.topLeft.queryPoint(point));\n\t\t\tappendItems(result, this.topRight.queryPoint(point));\n\t\t\tappendItems(result, this.bottomLeft.queryPoint(point));\n\t\t\tappendItems(result, this.bottomRight.queryPoint(point));\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Inserts a rectangle into this QuadTree.\n\t *\n\t * @param {Rectangle<T>} rectangle - The rectangle to insert.\n\t * @returns {boolean} Whether the rectangle was successfully inserted.\n\t */\n\tpublic insert(rectangle: Rectangle<T>): boolean {\n\t\t// The root quad tree can accept any rectangle that intersects with the boundary\n\t\t// while subdivisions only accept rectangles that fit entirely within them\n\t\tif (this.parent ? !this.boundary.contains(rectangle) : !this.boundary.intersects(rectangle)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Otherwise, let's see if we're at capacity\n\t\tif (this.objects.length < this.capacity) {\n\t\t\t// If we're good, push rectangle\n\t\t\tthis.objects.push(rectangle);\n\n\t\t\treturn true;\n\t\t} else {\n\t\t\t// Otherwise divide into 4 quadrants\n\t\t\tif (!this.divided) {\n\t\t\t\tthis.subdivide();\n\t\t\t}\n\t\t\t// Try inserting into each quadrant\n\t\t\tconst result =\n\t\t\t\tthis.topLeft.insert(rectangle) ||\n\t\t\t\tthis.topRight.insert(rectangle) ||\n\t\t\t\tthis.bottomLeft.insert(rectangle) ||\n\t\t\t\tthis.bottomRight.insert(rectangle);\n\n\t\t\t// If we can't (meaning it likely overlaps an edge of each quadrant)\n\t\t\tif (result === false) {\n\t\t\t\t// Just add it to the parent's objects list\n\t\t\t\tthis.objects.push(rectangle);\n\t\t\t}\n\n\t\t\t// Always return success here\n\t\t\treturn true;\n\t\t}\n\t}\n\n\t/**\n\t * Draws all objects in this QuadTree on the given canvas context.\n\t *\n\t * @param {CanvasRenderingContext2D} context - The canvas context to draw on.\n\t */\n\tpublic drawObjects(context: CanvasRenderingContext2D): void {\n\t\tthis.objects.forEach(o => o.draw(context));\n\t\tif (this.divided) {\n\t\t\tthis.topLeft.drawObjects(context);\n\t\t\tthis.topRight.drawObjects(context);\n\t\t\tthis.bottomLeft.drawObjects(context);\n\t\t\tthis.bottomRight.drawObjects(context);\n\t\t}\n\t}\n\n\t/**\n\t * Draws the boundary of this QuadTree on the given canvas context.\n\t *\n\t * @param {CanvasRenderingContext2D} context - The canvas context to draw on.\n\t */\n\tpublic draw(context: CanvasRenderingContext2D): void {\n\t\tcontext.rect(this.boundary.x, this.boundary.y, this.boundary.w, this.boundary.h);\n\t\tif (this.divided) {\n\t\t\tthis.topLeft.draw(context);\n\t\t\tthis.topRight.draw(context);\n\t\t\tthis.bottomLeft.draw(context);\n\t\t\tthis.bottomRight.draw(context);\n\t\t}\n\t\tcontext.strokeStyle = 'black';\n\t\tcontext.lineWidth = 4;\n\t\tcontext.stroke();\n\t}\n}\n", "export * from './contains';\nexport * from './intersectPoint';\nexport * from './intersects';\nexport * from './appendItems';\n", "import type { Rectangle } from '../rectangle';\n\n/**\n * Check if a rectangle contains another rectangle\n * @param rect1 {Rectangle}\n * @param rect2 {Rectangle}\n * @hidden\n */\nexport function contains(rect1: Rectangle, rect2: Rectangle) {\n\treturn (\n\t\trect2.x + rect2.w < rect1.x + rect1.w &&\n\t\trect2.x > rect1.x &&\n\t\trect2.y > rect1.y &&\n\t\trect2.y + rect2.h < rect1.y + rect1.h\n\t);\n}\n", "import type { Rectangle } from '../rectangle';\nimport type { Point2D } from '../types';\n\n/**\n * Check if a rectangle contains a point\n * @param rect1 {Rectangle}\n * @param point {Point2D}\n *\n * @hidden\n */\nexport function intersectPoint(rect1: Rectangle, point: Point2D) {\n\tconst [tx, ty] = point;\n\n\treturn tx >= rect1.x && tx <= rect1.x + rect1.w && ty >= rect1.y && ty <= rect1.y + rect1.h;\n}\n", "import type { Rectangle } from '../rectangle';\n\n/**\n * Check if two rectangles intersect\n * @param rect1 {Rectangle}\n * @param rect2 {Rectangle}\n */\nexport function intersects(rect1: Rectangle, rect2: Rectangle) {\n\tconst x1 = rect2.x;\n\tconst y1 = rect2.y;\n\tconst x2 = rect2.x + rect2.w;\n\tconst y2 = rect2.y + rect2.h;\n\tconst x3 = rect1.x;\n\tconst y3 = rect1.y;\n\tconst x4 = rect1.x + rect1.w;\n\tconst y4 = rect1.y + rect1.h;\n\n\treturn x1 < x4 && x3 < x2 && y1 < y4 && y3 < y2;\n}\n", "/**\n * Function pushes the items of the second array onto the first array (inplace).\n * @template T\n * @param {Array.<T>} arr1 - base array\n * @param {Array.<T>} arr2 - array which items will be pushed to arr1\n * @hidden\n */\nexport function appendItems<T>(arr1: T[], arr2: T[]) {\n\tfor (let i = 0; i < arr2.length; i++) {\n\t\tarr1.push(arr2[i]);\n\t}\n}\n", "import { intersectPoint, contains, intersects } from './utils';\nimport type { Point2D } from './types';\n\n/**\n * Class representing a rectangle.\n *\n * @template T - The type of user data stored in the rectangle.\n */\nexport class Rectangle<T = unknown> {\n\t/**\n\t * The x-coordinate of the rectangle.\n\t */\n\tpublic readonly x: number;\n\n\t/**\n\t * The y-coordinate of the rectangle.\n\t */\n\tpublic readonly y: number;\n\n\t/**\n\t * The width of the rectangle.\n\t */\n\tpublic readonly w: number;\n\n\t/**\n\t * The height of the rectangle.\n\t */\n\tpublic readonly h: number;\n\n\t/**\n\t * The user data associated with this rectangle.\n\t */\n\tuserData: T;\n\n\t/**\n\t * Creates an instance of Rectangle.\n\t *\n\t * @param {number} x - The x-coordinate of the rectangle.\n\t * @param {number} y - The y-coordinate of the rectangle.\n\t * @param {number} w - The width of the rectangle.\n\t * @param {number} h - The height of the rectangle.\n\t * @param {T} [userData] - The user data associated with this rectangle.\n\t */\n\tconstructor(x: number, y: number, w: number, h: number, userData?: T) {\n\t\tthis.userData = typeof userData === 'undefined' ? (null as T) : userData;\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.w = w;\n\t\tthis.h = h;\n\t}\n\n\t/**\n\t * Checks if this rectangle contains the given rectangle entirely.\n\t *\n\t * @param {Rectangle} rectangle - The rectangle to check.\n\t * @returns {boolean} Whether this rectangle contains the given rectangle.\n\t */\n\tpublic contains(rectangle: Rectangle<T>): boolean {\n\t\tif (rectangle === this) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn contains(this, rectangle);\n\t}\n\n\t/**\n\t * Checks if this rectangle intersects with the given rectangle.\n\t *\n\t * @param {Rectangle} rectangle - The rectangle to check.\n\t * @returns {boolean} Whether this rectangle intersects with the given rectangle.\n\t */\n\tpublic intersects(rectangle: Rectangle): boolean {\n\t\treturn intersects(this, rectangle);\n\t}\n\n\t/**\n\t * Checks if this rectangle intersects with the given point.\n\t *\n\t * @param {Point2D} point - The point to check.\n\t * @returns {boolean} Whether this rectangle intersects with the given point.\n\t */\n\tpublic intersectsPoint(point: Point2D): boolean {\n\t\treturn intersectPoint(this, point);\n\t}\n\n\t/**\n\t * Draws the rectangle on the given canvas context.\n\t *\n\t * @param {CanvasRenderingContext2D} context - The canvas context to draw on.\n\t */\n\tpublic draw(context: CanvasRenderingContext2D): void {\n\t\tcontext.fillStyle = `rgba(123,222,26, 0.8)`;\n\t\tcontext.fillRect(this.x, this.y, this.w, this.h);\n\t}\n}\n", "import { ALWAYS_VISIBLE_RANK_INDEX } from '../../utils/collision-ranking-tier';\nimport type { TSerializedCollider } from './collider-processor';\nimport type { PackedBBoxes, PackedCollider, PackedMessage, TMessage } from './system';\n\nexport function throttle(func, wait, options) {\n\tlet context;\n\tlet args;\n\tlet result;\n\tlet timeout = null;\n\tlet previous = 0;\n\tif (!options) options = {};\n\tlet later = function () {\n\t\tprevious = options.leading === false ? 0 : Date.now();\n\t\ttimeout = null;\n\t\tresult = func.apply(context, args);\n\t\tif (!timeout) context = args = null;\n\t};\n\n\treturn function () {\n\t\tlet now = Date.now();\n\t\tif (!previous && options.leading === false) previous = now;\n\t\tlet remaining = wait - (now - previous);\n\t\tcontext = globalThis;\n\t\t// eslint-disable-next-line\n\t\targs = arguments;\n\t\tif (remaining <= 0 || remaining > wait) {\n\t\t\tif (timeout) {\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\ttimeout = null;\n\t\t\t}\n\t\t\tprevious = now;\n\t\t\tresult = func.apply(context, args);\n\t\t\tif (!timeout) context = args = null;\n\t\t} else if (!timeout && options.trailing !== false) {\n\t\t\t// @ts-ignore\n\t\t\ttimeout = setTimeout(later, remaining);\n\t\t}\n\n\t\treturn result;\n\t};\n}\n\nexport function debounce(func, wait, immediate) {\n\tlet timeout;\n\n\treturn function () {\n\t\tlet context = globalThis;\n\t\t// eslint-disable-next-line\n\t\tlet args = arguments;\n\t\tlet later = function () {\n\t\t\ttimeout = null;\n\t\t\tif (!immediate) func.apply(context, args);\n\t\t};\n\t\tlet callNow = immediate && !timeout;\n\t\tclearTimeout(timeout);\n\t\ttimeout = setTimeout(later, wait);\n\t\tif (callNow) func.apply(context, args);\n\t};\n}\n\nexport function packCollider(collider: TSerializedCollider): PackedCollider {\n\tconst packedBBoxes: PackedBBoxes = collider.bboxes.map(bbox => [\n\t\tbbox.boundingBox[0],\n\t\tbbox.boundingBox[1],\n\t\tbbox.boundingBox[2],\n\t\tbbox.boundingBox[3],\n\t\tbbox.index,\n\t]);\n\n\treturn [\n\t\tpackedBBoxes,\n\t\tcollider.enabledAndVisible ? 1 : 0,\n\t\tcollider.rank === ALWAYS_VISIBLE_RANK_INDEX ? 1 : 0,\n\t\tcollider.x,\n\t\tcollider.y,\n\t\tcollider.visible && collider.bboxes.length === 1 ? 1 : 0,\n\t\tcollider.shouldCollideWithScreenEdges ? 1 : 0,\n\t];\n}\n\n// Function to pack the data\nexport function packMessage(message: TMessage): PackedMessage {\n\tconst packedColliders: PackedCollider[] = message.colliders.map(packCollider);\n\n\treturn [\n\t\tpackedColliders,\n\t\tmessage.devicePixelRatio,\n\t\tmessage.totalHeight,\n\t\tmessage.totalWidth,\n\t\tmessage.watermarkWidth,\n\t\tmessage.watermarkHeight,\n\t\tmessage.watermarkPosition,\n\t];\n}\n\nexport function unpackMessage(packedMessage: PackedMessage): TMessage {\n\tconst colliders: TSerializedCollider[] = packedMessage[0].map(packedCollider => {\n\t\tconst bboxes = packedCollider[0].map(bbox => ({\n\t\t\tindex: bbox[4],\n\t\t\tboundingBox: [bbox[0], bbox[1], bbox[2], bbox[3]] as [number, number, number, number],\n\t\t}));\n\n\t\treturn {\n\t\t\tenabledAndVisible: packedCollider[1] === 1,\n\t\t\trank: packedCollider[2] === 1 ? ALWAYS_VISIBLE_RANK_INDEX : 0,\n\t\t\tx: packedCollider[3],\n\t\t\ty: packedCollider[4],\n\t\t\tshouldCollideWithScreenEdges: packedCollider[5] === 1,\n\t\t\tbboxes: bboxes,\n\t\t\tlockedToStrategyIndex: packedCollider[6],\n\t\t};\n\t});\n\n\treturn {\n\t\tmsgId: '-1',\n\t\ttotalWidth: packedMessage[3],\n\t\ttotalHeight: packedMessage[2],\n\t\twatermarkWidth: packedMessage[4],\n\t\twatermarkHeight: packedMessage[5],\n\t\twatermarkPosition: packedMessage[6],\n\t\tcolliders: colliders,\n\t\tdevicePixelRatio: packedMessage[1],\n\t};\n}\n", "import { QuadTree, Rectangle } from '@packages/internal/quad-tree';\nimport { ALWAYS_VISIBLE_RANK_INDEX } from '../../utils/collision-ranking-tier';\nimport { type WatermarkPosition } from '../watermark/system';\n\nexport const STATIC_COLLIDER_INDEX = 9;\n\nexport type TSerializedCollider = {\n\trank: number;\n\tenabledAndVisible: boolean;\n\tx: number;\n\ty: number;\n\tbboxes: {\n\t\tindex: number;\n\t\tboundingBox: [number, number, number, number];\n\t\tboundingRect?: Rectangle;\n\t}[];\n\tshouldCollideWithScreenEdges?: boolean;\n\tlockedToStrategyIndex?: number;\n\tvisible?: boolean;\n};\n\nexport type TSerializedColliderResponse = [number, 1 | 0, Rectangle?];\n\nconst padding = 200;\nconst OFFSCREEN_COLLIDER_BUFFER = 10;\n\nexport function processColliders(\n\tcolliders: TSerializedCollider[],\n\ttotalWidth,\n\ttotalHeight,\n\twatermarkWidth,\n\twatermarkHeight,\n\twatermarkPosition,\n\tmsgId = '-1',\n) {\n\t// next we create a bounding box around all colliders' bounding boxes\n\tlet minX = Infinity;\n\tlet minY = Infinity;\n\tlet maxX = -Infinity;\n\tlet maxY = -Infinity;\n\n\tconst leftScreenBoundary = new Rectangle(-OFFSCREEN_COLLIDER_BUFFER, 0, 5, totalHeight);\n\tconst topScreenBoundary = new Rectangle(-OFFSCREEN_COLLIDER_BUFFER, 0, totalWidth, 5);\n\tconst rightScreenBoundary = new Rectangle(totalWidth - 5, 0, totalWidth + OFFSCREEN_COLLIDER_BUFFER, totalHeight);\n\tconst bottomScreenBoundary = new Rectangle(0, totalHeight - 5, totalWidth, totalHeight + OFFSCREEN_COLLIDER_BUFFER);\n\tconst watermarkBoundary = getWatermarkBoundary(\n\t\ttotalWidth,\n\t\ttotalHeight,\n\t\twatermarkWidth,\n\t\twatermarkHeight,\n\t\twatermarkPosition,\n\t);\n\n\tconst screenBoundColliders = [leftScreenBoundary, topScreenBoundary, rightScreenBoundary, bottomScreenBoundary];\n\n\tconst screenRectangle = new Rectangle(-padding, -padding, totalWidth + padding * 2, totalHeight + padding * 2);\n\n\tfor (const collider of colliders) {\n\t\tlet boundingBox;\n\t\tlet boundingIndex;\n\n\t\tfor (let i = 0; i < collider.bboxes.length; i++) {\n\t\t\tif (collider.bboxes[i] == null) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tboundingBox = collider.bboxes[i].boundingBox;\n\t\t\tboundingIndex = collider.bboxes[i].index;\n\t\t\tif (collider.lockedToStrategyIndex !== -1 && boundingIndex !== collider.lockedToStrategyIndex) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst [y1, y2, x1, x2] = boundingBox;\n\t\t\tconst [y11, y21, x11, x21] = [collider.y - y1, collider.y + y2, collider.x - x1, collider.x + x2];\n\t\t\tconst x = x11;\n\t\t\tconst y = y11;\n\t\t\tconst w = x21 - x11;\n\t\t\tconst h = y21 - y11;\n\t\t\tminX = Math.min(minX, x) - padding;\n\t\t\tminY = Math.min(minY, y) - padding;\n\t\t\tmaxX = Math.max(maxX, x + w) + padding;\n\t\t\tmaxY = Math.max(maxY, y + h) + padding;\n\t\t\tcollider.bboxes[i].boundingRect = new Rectangle(x, y, w, h);\n\t\t}\n\t}\n\n\t// create a quad tree with the bounding box\n\tconst qTree = new QuadTree(new Rectangle(minX, minY, maxX - minX, maxY - minY));\n\n\tconst result: {\n\t\tmsgId: string;\n\t\tcolliders: TSerializedColliderResponse[];\n\t\tstaticColliders: Rectangle[];\n\t\tdebug: { x: number; y: number; w: number; h: number }[];\n\t} = {\n\t\tmsgId: msgId,\n\t\tcolliders: new Array(colliders.length),\n\t\tstaticColliders: [],\n\t\tdebug: [],\n\t};\n\n\tlet staticColliderIndex = 0;\n\t// insert static colliders\n\tfor (let i = 0; i < colliders.length; i++) {\n\t\tconst collider = colliders[i];\n\t\tif (collider.bboxes?.[0]?.index === STATIC_COLLIDER_INDEX) {\n\t\t\tresult.staticColliders.push(collider.bboxes[0].boundingRect!);\n\t\t\tqTree.insert(collider.bboxes[0].boundingRect!);\n\t\t\tstaticColliderIndex++;\n\t\t}\n\t}\n\n\t// we now need to trim the static colliders from the colliders array, using the index\n\tcolliders = colliders.slice(staticColliderIndex, colliders.length);\n\n\tlet collider;\n\tfor (let idx = 0; idx < colliders.length; idx++) {\n\t\tcollider = colliders[idx];\n\t\tresult.colliders[idx] = [-1, 0];\n\t\tif (collider.enabledAndVisible) {\n\t\t\tlet [minIntersectionsForCollider, strategyIndex, rectangle]: [number, number, Rectangle | undefined] = [\n\t\t\t\tInfinity,\n\t\t\t\t-1,\n\t\t\t\tundefined,\n\t\t\t];\n\n\t\t\tfor (const { index, boundingRect: rect } of collider.bboxes) {\n\t\t\t\tif (rect == null) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tlet intersections: Rectangle[] = [];\n\t\t\t\tconst collisions = qTree.queryRect(rect);\n\t\t\t\tintersections = collisions.filter(c => rect.intersects(c));\n\n\t\t\t\tif (collider.shouldCollideWithScreenEdges) {\n\t\t\t\t\tscreenBoundColliders.forEach(c => {\n\t\t\t\t\t\tif (rect.intersects(c)) {\n\t\t\t\t\t\t\tintersections.push(c);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (rect.intersects(watermarkBoundary)) {\n\t\t\t\t\tresult.colliders[idx] = [-1, 0, rect];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// for colliders that we do want to insert, regardless of collisions,\n\t\t\t\t// such as floor change tooltips,\n\t\t\t\t// we find the strategy with the least number of collisions and pop it in there\n\t\t\t\tif (intersections.length <= minIntersectionsForCollider) {\n\t\t\t\t\trectangle = rect;\n\t\t\t\t\tstrategyIndex = index;\n\t\t\t\t\tminIntersectionsForCollider = intersections.length;\n\t\t\t\t}\n\n\t\t\t\tif (intersections.length === 0) {\n\t\t\t\t\tqTree.insert(rect);\n\t\t\t\t\tresult.colliders[idx] = [index, screenRectangle.contains(rect) ? 0 : 1, rect];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (collider.rank === ALWAYS_VISIBLE_RANK_INDEX && rectangle != null) {\n\t\t\t\tqTree.insert(rectangle);\n\t\t\t\tresult.colliders[idx] = [strategyIndex, screenRectangle.contains(rectangle) ? 0 : 1, rectangle];\n\t\t\t}\n\t\t} else {\n\t\t\tresult.colliders[idx] = [-1, 0];\n\t\t}\n\t}\n\n\treturn result;\n}\n\nexport function getWatermarkBoundary(\n\ttotalWidth: number,\n\ttotalHeight: number,\n\twatermarkWidth: number,\n\twatermarkHeight: number,\n\twatermarkPosition: WatermarkPosition,\n) {\n\tswitch (watermarkPosition) {\n\t\tcase 'top-left':\n\t\t\treturn new Rectangle(0, 0, watermarkWidth, watermarkHeight);\n\t\tcase 'top-right':\n\t\t\treturn new Rectangle(totalWidth - watermarkWidth, 0, watermarkWidth, watermarkHeight);\n\t\tcase 'bottom-left':\n\t\t\treturn new Rectangle(0, totalHeight - watermarkHeight, watermarkWidth, watermarkHeight);\n\t\tcase 'bottom-right':\n\t\t\treturn new Rectangle(totalWidth - watermarkWidth, totalHeight - watermarkHeight, watermarkWidth, watermarkHeight);\n\t\tcase 'center':\n\t\t\treturn new Rectangle(\n\t\t\t\t(totalWidth - watermarkWidth) / 2,\n\t\t\t\t(totalHeight - watermarkHeight) / 2,\n\t\t\t\twatermarkWidth,\n\t\t\t\twatermarkHeight,\n\t\t\t);\n\t\tcase 'top':\n\t\t\treturn new Rectangle((totalWidth - watermarkWidth) / 2, 0, watermarkWidth, watermarkHeight);\n\t\tcase 'bottom':\n\t\t\treturn new Rectangle(\n\t\t\t\t(totalWidth - watermarkWidth) / 2,\n\t\t\t\ttotalHeight - watermarkHeight,\n\t\t\t\twatermarkWidth,\n\t\t\t\twatermarkHeight,\n\t\t\t);\n\t\tcase 'left':\n\t\t\treturn new Rectangle(0, (totalHeight - watermarkHeight) / 2, watermarkWidth, watermarkHeight);\n\t\tcase 'right':\n\t\t\treturn new Rectangle(\n\t\t\t\ttotalWidth - watermarkWidth,\n\t\t\t\t(totalHeight - watermarkHeight) / 2,\n\t\t\t\twatermarkWidth,\n\t\t\t\twatermarkHeight,\n\t\t\t);\n\t\tdefault:\n\t\t\t// Fallback for unknown positions - should not happen with proper typing\n\t\t\treturn new Rectangle(0, totalHeight - watermarkHeight, watermarkWidth, watermarkHeight);\n\t}\n}\n", "import type { PackedMessage } from './system';\nimport { processColliders } from './collider-processor';\nimport { unpackMessage } from './utils';\n\nexport class SyncWorker {\n\tonerror: (e: any) => void = () => {};\n\tonmessage: (e: any) => void = () => {};\n\tpostMessage = (e: PackedMessage) => {\n\t\tconst unpacked = unpackMessage(e);\n\n\t\tthis.onmessage({\n\t\t\tdata: processColliders(\n\t\t\t\tunpacked.colliders,\n\t\t\t\tunpacked.totalWidth,\n\t\t\t\tunpacked.totalHeight,\n\t\t\t\tunpacked.watermarkWidth,\n\t\t\t\tunpacked.watermarkHeight,\n\t\t\t\tunpacked.watermarkPosition,\n\t\t\t\tunpacked.msgId,\n\t\t\t),\n\t\t});\n\t};\n\n\tterminate = () => {};\n}\n", "export { InteractionSystem } from './system';\n", "import type { PerspectiveCamera, Vector3, Object3D, Intersection, Object3DEventMap } from 'three';\nimport { Mesh, Raycaster, Scene, Vector2 } from 'three';\nimport type { Geometry2D } from '../../entities/geometry2d';\nimport { QuadTree, Rectangle } from '@packages/internal/quad-tree';\nimport type { Geometry3D } from '../../entities/geometry3d';\nimport { Geometry3DComponents } from '../../entities/geometry3d';\nimport { PubSub } from '../../../../packages/common/pubsub';\nimport type { EntityMesh } from '../../types';\nimport { Tap, TapsController } from './tap-controller';\nimport { MOUSE_CLICK_DISTANCE_THRESHOLD, MOUSE_CLICK_TIME_THRESHOLD, TAP_TIMEOUT } from './constants';\nimport type { All3DTypes, RendererState } from '../../renderer';\nimport '../../styles/interactions.scss';\nimport type { EntityBatchedMesh } from '../../components/mesh';\nimport type { GroupContainerObject3D } from '../../entities/group-container';\nimport { getUniqueIntersectedGroupContainers } from './utils';\nimport { RAYCAST_LAYERS } from '../../utils/constants';\nimport { arraysEqual } from '@packages/internal/common';\n\ntype InteractionPayload = {\n\tentity2D?: Geometry2D;\n\tentity3D?: Geometry3D;\n\tposition?: Vector3;\n\tgroupContainers?: GroupContainerObject3D[];\n\tpointerEvent: Pick<PointerEvent, 'button'>;\n};\ntype InteractionEvents = {\n\tclick: InteractionPayload;\n\thover: Omit<InteractionPayload, 'pointerEvent'>;\n\t'singletap-with-twofinger': PointerEvent;\n\t'doubletap-with-onefinger': PointerEvent;\n};\n\ntype CursorTypes = 'grabbing' | 'grab' | 'pointer';\ntype InteractionState = {\n\tdistanceFromMouseDown: number | undefined;\n\tisPanning: boolean;\n\tmouseDownStart:\n\t\t| {\n\t\t\t\ttime: number; // Date representation\n\t\t\t\ttimestamp: number; // performance.now representation\n\t\t\t\toffsetX: number; // container relative coordinates\n\t\t\t\toffsetY: number; // container relative coordinates\n\t\t  }\n\t\t| undefined;\n};\n\nexport type InteractionRequiredCoreStateProps = {\n\tgeometry2DIdsInScene: Set<Geometry2D['id']>;\n\tgeometry3DIdsInScene: Set<Geometry3D['id']>;\n}; // Local core state type for separation of concern. Structural typing will figure this out\n\n/**\n * TODO: touch support\n */\nexport class InteractionSystem extends PubSub<InteractionEvents> {\n\t// private debug = false;\n\traycaster = new Raycaster(); // exposed for testing\n\tprivate state = {\n\t\thovered3DEntity: undefined as Geometry3D | undefined,\n\t\thovered2DEntity: undefined as Geometry2D | undefined,\n\t\thovered3DContainers: undefined as GroupContainerObject3D[] | undefined,\n\t\tlastHover: undefined as Geometry3D | undefined,\n\t\tinteraction: {\n\t\t\tmouseDownStart: undefined,\n\t\t\tdistanceFromMouseDown: undefined,\n\t\t\tisPanning: false,\n\t\t} as InteractionState,\n\t};\n\n\tprivate coreState: RendererState;\n\tprivate camera: PerspectiveCamera;\n\tprivate worldPlane: Mesh;\n\t// exposed for testing conveniences\n\t_quadtree: QuadTree<{ entityId: Geometry2D['id'] }> = new QuadTree(new Rectangle(0, 0, 0, 0));\n\t// exposed for testing\n\t_container: HTMLCanvasElement;\n\tprivate lastPointerEvent?: PointerEvent;\n\tprivate cursor: CursorTypes = 'grab';\n\tprivate touchesCount = 0;\n\tprivate isUserInteracting: () => boolean;\n\tconstructor(\n\t\tcontainer: HTMLCanvasElement,\n\t\tcoreState: RendererState,\n\t\tcamera: PerspectiveCamera,\n\t\tworldPlane: Mesh,\n\t\tisUserInteracting: () => boolean,\n\t) {\n\t\tsuper();\n\t\tthis.isUserInteracting = isUserInteracting;\n\t\t// (window as any).debugInteraction = () => {\n\t\t// \tthis.enableDebug();\n\t\t// };\n\n\t\tthis.raycaster.layers.enableAll();\n\t\tthis.raycaster.layers.disable(RAYCAST_LAYERS.OUTLINES);\n\n\t\tthis.camera = camera;\n\t\tthis._container = container;\n\t\tthis.coreState = coreState;\n\t\tthis.worldPlane = worldPlane;\n\n\t\tthis._container.addEventListener('pointerdown', this.onPointerDown, false);\n\t\t// rAF is used to prevent multiple events firing on the same frame, makes a big difference on huge maps\n\t\tthis._container.addEventListener('pointermove', this.onPointerMoveRaf, false);\n\n\t\t// add class to control cursor\n\t\tthis._container.classList.add(`mappedin-interactive`);\n\t}\n\n\t// TODO: check for memory leak\n\tupdateQuadtree(takeIT: QuadTree<{ entityId: Geometry2D['id'] }>) {\n\t\tthis._quadtree = takeIT;\n\t}\n\n\t// this function is called when global hover color is changed\n\tsetHovered3DEntityInteractionComponentDirty() {\n\t\tif (this.state.hovered3DEntity) {\n\t\t\tconst interactionComponent = this.state.hovered3DEntity.components[Geometry3DComponents.Interaction];\n\t\t\tif (interactionComponent) {\n\t\t\t\tinteractionComponent.dirty = true;\n\t\t\t}\n\t\t}\n\t}\n\n\thasTouched = false;\n\n\t#animationFrame?: number = undefined;\n\n\tonPointerMoveRaf = (event: PointerEvent) => {\n\t\tthis.lastPointerEvent = event;\n\n\t\tif (this.#animationFrame) {\n\t\t\tcancelAnimationFrame(this.#animationFrame);\n\t\t}\n\n\t\tthis.#animationFrame = requestAnimationFrame(() => {\n\t\t\tthis.onPointerMove(event);\n\t\t});\n\t};\n\n\tprivate onPointerMove = (event: PointerEvent) => {\n\t\tevent.preventDefault();\n\t\tthis.updateInteractionStateIfPanning(event);\n\t\t// prevent intersect if camera isn't moving nor user is interacting\n\t\tif (event.pointerType !== 'touch' || (event.pointerType === undefined && this.hasTouched)) {\n\t\t\tthis.handleHover(event);\n\t\t}\n\n\t\tthis.handleCursor();\n\t};\n\n\ttapsControl = new TapsController();\n\n\tpublic getThreeDIntersectsFromXY(point: Vector2) {\n\t\tthis.raycaster.setFromCamera(point, this.camera);\n\t\tthis.raycaster.layers.enable(0);\n\n\t\tconst intersects = this.raycaster\n\t\t\t// needs recursive for paths that have multiple children\n\t\t\t.intersectObjects(this._hitBoxes.entities, true)\n\t\t\t.filter(i => i.object?.name === 'worldPlane' || i.object?.visible);\n\n\t\t// we need to shift the worldPlane to the end of the array, to support underground objects\n\t\t// this way we always test it last\n\t\tconst worldPlaneIndex = intersects.findIndex(i => i.object?.name === 'worldPlane');\n\t\tif (worldPlaneIndex !== -1) {\n\t\t\tintersects.push(intersects.splice(worldPlaneIndex, 1)[0]);\n\t\t}\n\n\t\treturn intersects;\n\t}\n\n\tpublic getGroupContainerIntersectsFromXY(point: Vector2) {\n\t\tconst intersects = this.getThreeDIntersectsFromXY(point);\n\n\t\tlet intersectedContainers;\n\t\tif (intersects != null && intersects.length > 0) {\n\t\t\tintersectedContainers = getUniqueIntersectedGroupContainers(intersects) as GroupContainerObject3D[];\n\t\t}\n\n\t\treturn intersectedContainers;\n\t}\n\n\tprivate onPointerDown = (event: PointerEvent) => {\n\t\tif (event.target !== this._container) return;\n\t\tthis._container.addEventListener('pointerup', this.onPointerUp, false);\n\t\tthis._container.addEventListener('pointercancel', this.onPointerUp, false);\n\n\t\t// update on pointerdown\n\t\tthis.state.interaction.mouseDownStart = {\n\t\t\ttime: Date.now(),\n\t\t\ttimestamp: event.timeStamp,\n\t\t\toffsetX: event.offsetX,\n\t\t\toffsetY: event.offsetY,\n\t\t};\n\n\t\tthis.lastPointerEvent = event;\n\t\tthis.state.interaction.distanceFromMouseDown = 0;\n\t\tthis.handleCursor();\n\t\tif (event.pointerType === 'touch') {\n\t\t\tthis.tapsControl.add(new Tap(event));\n\t\t\tthis.touchesCount = Math.max(0, this.touchesCount + 1);\n\t\t}\n\t};\n\n\tprivate clickTimeout = undefined as number | undefined;\n\tprivate onPointerUp = (event: PointerEvent) => {\n\t\tthis.tapsControl.discardOutsideOfWaitWindow(event.timeStamp);\n\t\tthis.lastPointerEvent = event;\n\t\tthis.touchesCount = Math.max(0, this.touchesCount - 1);\n\t\tif (this.touchesCount === 0) {\n\t\t\t// only discard these event when there are no more touches\n\t\t\tthis._container.removeEventListener('pointerup', this.onPointerUp, false);\n\t\t\tthis._container.removeEventListener('pointercancel', this.onPointerUp, false);\n\t\t}\n\t\tthis.updateInteractionStateIfPanning(event);\n\t\tconst { mouseDownStart } = this.state.interaction;\n\t\tif (!mouseDownStart || this.state.interaction.distanceFromMouseDown == null) {\n\t\t\treturn;\n\t\t}\n\t\tif (\n\t\t\tDate.now() < mouseDownStart.time + MOUSE_CLICK_TIME_THRESHOLD &&\n\t\t\t(this.tapsControl.isSingleTapWithTwoFingers ||\n\t\t\t\tthis.state.interaction.distanceFromMouseDown <= MOUSE_CLICK_DISTANCE_THRESHOLD)\n\t\t) {\n\t\t\tif (event.pointerType === 'touch') {\n\t\t\t\tif (this.tapsControl.isSingleTapWithTwoFingers) {\n\t\t\t\t\tthis.publish('singletap-with-twofinger', event);\n\t\t\t\t\tthis.flush();\n\t\t\t\t} else if (this.tapsControl.isSingleTapWithOneFinger && this.touchesCount === 0) {\n\t\t\t\t\tif (this.clickTimeout) clearTimeout(this.clickTimeout);\n\t\t\t\t\tthis.clickTimeout = window.setTimeout(() => {\n\t\t\t\t\t\tthis.handleClick(event);\n\t\t\t\t\t\tthis.flush();\n\t\t\t\t\t}, TAP_TIMEOUT);\n\t\t\t\t} else if (this.tapsControl.isDoubleTapWithOneFinger) {\n\t\t\t\t\tthis.publish('doubletap-with-onefinger', event);\n\t\t\t\t\tthis.flush();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.handleClick(event);\n\t\t\t}\n\t\t}\n\t\tthis.state.interaction.mouseDownStart = undefined;\n\t\tthis.state.interaction.distanceFromMouseDown = undefined;\n\t\tthis.state.interaction.isPanning = false;\n\t\tthis.handleCursor();\n\t};\n\n\tprivate flush() {\n\t\tthis.tapsControl.flush();\n\t\tif (this.clickTimeout != null) {\n\t\t\tclearTimeout(this.clickTimeout);\n\t\t\tthis.clickTimeout = undefined;\n\t\t}\n\t}\n\n\tpublic handleHover(e?: PointerEvent) {\n\t\tconst event = e || this.lastPointerEvent;\n\n\t\t// we want to ignore hover events when the user is interacting, as this causes jank for larger maps\n\t\t// and is unnecessary. We should only accept hover events when the camera is not being interacted with\n\t\tif (this.state.interaction.mouseDownStart || !event || this.isUserInteracting()) return;\n\t\tconst { entity3D, entity2D, position, groupContainers } = this.intersect(event);\n\t\tif (\n\t\t\tthis.detect3DEntityHover(entity3D) ||\n\t\t\tthis.detect2DEntityHover(entity2D) ||\n\t\t\tthis.detect3DContainerHover(groupContainers)\n\t\t) {\n\t\t\tthis.state.hovered3DEntity = entity3D;\n\t\t\tthis.state.lastHover = entity3D;\n\t\t\tthis.state.hovered2DEntity = entity2D;\n\t\t\tthis.state.hovered3DContainers = groupContainers;\n\n\t\t\tthis.publish('hover', {\n\t\t\t\tentity2D: this.state.hovered2DEntity,\n\t\t\t\tentity3D: this.state.hovered3DEntity,\n\t\t\t\tposition,\n\t\t\t\tgroupContainers,\n\t\t\t});\n\t\t}\n\t\tthis.handleCursor();\n\t}\n\n\t// ensure to be called at the end of pointer handlers\n\tprivate handleCursor() {\n\t\tconst intersected = !!(\n\t\t\t(this.state.hovered3DEntity && this.state.hovered3DEntity?.components[Geometry3DComponents.Interaction]) ||\n\t\t\tthis.state.hovered2DEntity\n\t\t);\n\t\tconst isMouseDown = !!this.state.interaction.mouseDownStart;\n\t\tconst isPanning = this.state.interaction.isPanning;\n\t\tconst cursor = processCursor(intersected, isPanning, isMouseDown);\n\t\tif (this.cursor === cursor) return;\n\t\tthis.cursor = cursor;\n\n\t\t// pseudo :active will handle grab/grabbing\n\t\t// but we need to handle hover pointer\n\t\tif (cursor === 'pointer') {\n\t\t\tthis._container.classList.add('mappedin-interaction-hover');\n\t\t} else {\n\t\t\tthis._container.classList.remove('mappedin-interaction-hover');\n\t\t}\n\t}\n\n\tprivate detect2DEntityHover(entity: Geometry2D | undefined): boolean {\n\t\tconst dirty = this.state.hovered2DEntity !== entity;\n\n\t\treturn dirty;\n\t}\n\n\tprivate handleClick(event: PointerEvent) {\n\t\tconst intersection = this.intersect(event);\n\t\tthis.publish('click', {\n\t\t\tentity2D: intersection.entity2D,\n\t\t\tentity3D: intersection.entity3D,\n\t\t\tposition: intersection.position,\n\t\t\tgroupContainers: intersection.groupContainers,\n\t\t\tpointerEvent: {\n\t\t\t\tbutton: event.button,\n\t\t\t},\n\t\t});\n\t}\n\n\tdirty3D = true;\n\n\tprivate cachedHitBoxes: {\n\t\tentities: (Object3D | EntityMesh<Geometry3D> | EntityBatchedMesh)[];\n\t} = {\n\t\tentities: [],\n\t};\n\tget _hitBoxes() {\n\t\tif (this.dirty3D) {\n\t\t\tthis.cachedHitBoxes.entities = [];\n\t\t\tlet e: All3DTypes | undefined;\n\t\t\tfor (let entityId of this.coreState.geometry3DIdsInScene) {\n\t\t\t\te = this.coreState.geometry3DMap.get(entityId);\n\t\t\t\tif (e?.type === 'geometry' || e?.type === 'model' || e?.type === 'path' || e?.type === 'custom-geometry') {\n\t\t\t\t\tif (\n\t\t\t\t\t\te.components[Geometry3DComponents.Mesh].mesh &&\n\t\t\t\t\t\t!this.cachedHitBoxes.entities.includes(e.components[Geometry3DComponents.Mesh].mesh)\n\t\t\t\t\t) {\n\t\t\t\t\t\tthis.cachedHitBoxes.entities.push(e.components[Geometry3DComponents.Mesh].mesh);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.dirty3D = false;\n\n\t\t\tthis.cachedHitBoxes.entities.push(this.worldPlane);\n\n\t\t\treturn this.cachedHitBoxes;\n\t\t}\n\n\t\treturn this.cachedHitBoxes;\n\t}\n\n\t// normalized device coordinates of pointer position\n\tprivate ndcPoint = new Vector2();\n\tprivate intersect(event: PointerEvent) {\n\t\t// Use offsetX/offsetY (element-relative) instead of clientX/clientY (viewport-relative)\n\t\t// to ensure accurate coordinates regardless of page scroll position.\n\t\tconst { offsetX, offsetY } = event;\n\t\t// 2D intersect\n\t\tconst point = [offsetX, offsetY] as [number, number];\n\t\tconst result = this._quadtree.queryPoint(point);\n\t\tconst [intersection] = result.filter(r => r.intersectsPoint(point));\n\n\t\tthis.ndcPoint.x = (offsetX / this._container.clientWidth) * 2 - 1;\n\t\tthis.ndcPoint.y = -(offsetY / this._container.clientHeight) * 2 + 1;\n\n\t\tconst intersects = this.getThreeDIntersectsFromXY(this.ndcPoint);\n\n\t\t// first, lets grab the position off any mesh that gets intersected first\n\t\tconst position = intersects[0]?.point;\n\n\t\t// Sort objects with depthTest=false to the front\n\t\tconst alwaysOnTopIntersects: Intersection<Object3D<Object3DEventMap>>[] = [];\n\t\tconst nonDepthTestIntersects: Intersection<Object3D<Object3DEventMap>>[] = [];\n\n\t\tconst filteredIntersects = intersects.filter(i => i.object.name !== 'worldPlane');\n\t\tfor (const intersect of filteredIntersects) {\n\t\t\tif (intersect.object instanceof Mesh && intersect.object.material.depthTest === false) {\n\t\t\t\talwaysOnTopIntersects.push(intersect);\n\t\t\t} else {\n\t\t\t\tnonDepthTestIntersects.push(intersect);\n\t\t\t}\n\t\t}\n\n\t\tconst firstHit = alwaysOnTopIntersects[0] ?? nonDepthTestIntersects[0] ?? undefined;\n\n\t\t// 3D geometry intersect\n\t\tlet entity: All3DTypes | undefined;\n\t\tlet intersected: All3DTypes | undefined;\n\n\t\t// grab first item and check if it's interactive\n\t\tif (firstHit != null) {\n\t\t\t// check for models\n\t\t\tentity = findModelParentEntity(firstHit.object, this.coreState.geometry3DMap);\n\t\t\tif (!entity) {\n\t\t\t\t// check for batched meshes\n\t\t\t\tconst instanceIndex = firstHit?.instanceId ?? firstHit?.batchId;\n\t\t\t\tentity =\n\t\t\t\t\tinstanceIndex != null && firstHit?.object.userData.entities\n\t\t\t\t\t\t? this.coreState.geometry3DMap.get(firstHit?.object.userData.entities[instanceIndex])\n\t\t\t\t\t\t: this.coreState.geometry3DMap.get(firstHit?.object.userData.entityId);\n\t\t\t}\n\n\t\t\t// ensure entity is interactive\n\t\t\tif (entity?.components[Geometry3DComponents.Interaction]) {\n\t\t\t\tintersected = entity;\n\t\t\t}\n\t\t}\n\n\t\t// intersect with group containers\n\t\tconst containerIntersects = getUniqueIntersectedGroupContainers(filteredIntersects) as GroupContainerObject3D[];\n\n\t\treturn {\n\t\t\tentity2D:\n\t\t\t\tintersection?.userData?.entityId === 'watermark'\n\t\t\t\t\t? ({ id: 'watermark' } as Geometry2D)\n\t\t\t\t\t: this.coreState.geometry2DMap.get(intersection?.userData.entityId),\n\t\t\tentity3D: intersected as Geometry3D | undefined,\n\t\t\tposition: position,\n\t\t\tgroupContainers: containerIntersects.length > 0 ? containerIntersects : undefined,\n\t\t};\n\t}\n\n\tprivate detect3DEntityHover(entity: Geometry3D | undefined): boolean {\n\t\tif (this.state.lastHover !== entity) {\n\t\t\tif (this.state.lastHover) {\n\t\t\t\tupdateHover(this.state.lastHover, false, this.coreState);\n\t\t\t}\n\t\t\tif (entity) {\n\t\t\t\tupdateHover(entity, true, this.coreState);\n\t\t\t}\n\t\t}\n\t\tconst dirty = this.state.hovered3DEntity !== entity;\n\n\t\treturn dirty;\n\t}\n\n\tprivate detect3DContainerHover(groupContainers: GroupContainerObject3D[] | undefined) {\n\t\tconst dirty = !arraysEqual(this.state.hovered3DContainers, groupContainers);\n\n\t\treturn dirty;\n\t}\n\n\t// update interaction state based on the poiner events\n\tprivate updateInteractionStateIfPanning(event: PointerEvent) {\n\t\tif (this.state.interaction.mouseDownStart) {\n\t\t\tthis.state.interaction.distanceFromMouseDown = Math.sqrt(\n\t\t\t\tMath.pow(event.offsetX - this.state.interaction.mouseDownStart.offsetX, 2) +\n\t\t\t\t\tMath.pow(event.offsetY - this.state.interaction.mouseDownStart.offsetY, 2),\n\t\t\t);\n\t\t\tif (\n\t\t\t\t!this.state.interaction.isPanning &&\n\t\t\t\tthis.state.interaction.distanceFromMouseDown > MOUSE_CLICK_DISTANCE_THRESHOLD\n\t\t\t) {\n\t\t\t\tthis.state.interaction.isPanning = true;\n\t\t\t}\n\t\t}\n\t}\n\n\t// ensure to be called after raycaster is set\n\tgetMouseRayIntersects() {\n\t\treturn this.raycaster.intersectObjects([this.worldPlane], false);\n\t}\n\n\tdestroy() {\n\t\tthis._container.removeEventListener('pointerdown', this.onPointerDown, false);\n\t\tthis._container.removeEventListener('pointermove', this.onPointerMoveRaf, false);\n\t\tthis._container.removeEventListener('pointerup', this.onPointerUp, false);\n\t\tthis._container.removeEventListener('pointercancel', this.onPointerUp, false);\n\t}\n\n\t// SECTION: DEBUG\n\tdebugPanel: HTMLDivElement | undefined;\n\tenableDebug() {\n\t\tconst panel = document.createElement('div');\n\t\tpanel.style.position = 'absolute';\n\t\tpanel.style.top = '0';\n\t\tpanel.style.right = '0';\n\t\tpanel.style.backgroundColor = 'white';\n\t\tpanel.style.padding = '10px';\n\t\tdocument.body.append(panel);\n\t\tpanel.id = 'interaction-debug-panel';\n\t\tthis.debugPanel = panel;\n\n\t\tthis.on('doubletap-with-onefinger', () => {\n\t\t\tthis.queueDebugMessage('doubletap-with-onefinger', '#ffadad');\n\t\t});\n\n\t\tthis.on('singletap-with-twofinger', () => {\n\t\t\tthis.queueDebugMessage('singletap-with-twofinger', '#ffd6a5');\n\t\t});\n\n\t\tthis.on('click', payload => {\n\t\t\tthis.queueDebugMessage(\n\t\t\t\t`CLICK \\n3D: ${payload.entity3D?.id} \\n2D: ${payload.entity2D?.id} \\nPos: ${payload.position\n\t\t\t\t\t?.toArray()\n\t\t\t\t\t.join(', ')}`,\n\t\t\t\t'#fdffb6',\n\t\t\t);\n\t\t});\n\t\tthis.on('hover', payload => {\n\t\t\tthis.queueDebugMessage(\n\t\t\t\t`HOVER \\n3D: ${payload.entity3D?.id} \\n2D: ${payload.entity2D?.id} \\nPos: ${payload.position\n\t\t\t\t\t?.toArray()\n\t\t\t\t\t.join(', ')}`,\n\t\t\t\t'#caffbf',\n\t\t\t);\n\t\t});\n\t}\n\n\t// expose for testing\n\tget _state() {\n\t\treturn this.state;\n\t}\n\n\tprivate queueDebugMessage(msg: string, color: string) {\n\t\tconst div = document.createElement('pre');\n\t\tdiv.style.maxWidth = '300px';\n\t\tdiv.style.transition = 'opacity 500ms cubic-bezier(0.4, 0, 0.2, 1)';\n\t\tdiv.style.backgroundColor = color;\n\t\tdiv.textContent = msg;\n\t\tthis.debugPanel?.prepend(div);\n\t\tsetTimeout(() => {\n\t\t\tdiv.style.opacity = '0';\n\t\t\tsetTimeout(() => {\n\t\t\t\tdiv.remove();\n\t\t\t}, 500);\n\t\t}, 2500);\n\t}\n\n\t/**\n\t * Get the current cursor type determined by the interaction.\n\t */\n\tgetCursor() {\n\t\treturn this.cursor;\n\t}\n}\n\nfunction updateHover(entity: Geometry3D, hover: boolean, coreState: RendererState) {\n\tconst interactionComponent = entity.components[Geometry3DComponents.Interaction];\n\t// If hover is true, we don't want to override it because this has been explicitly set via setState\n\tif (interactionComponent && interactionComponent.hover !== true) {\n\t\tinteractionComponent.hover = hover ? 'user-interaction' : false;\n\t\tinteractionComponent.dirty = true;\n\t}\n\t/**\n\t * Handles text mesh color update when polygon is hovered.\n\t * Note: styleComponent color and hoverColor states are set by developer. The final material color is determined by color, hovercolor, globalHoverColor and hoverByPolygon state\n\t */\n\tconst labelTextEntityId = entity.components[Geometry3DComponents.Mesh].textMesh?.userData.entityId;\n\tif (!labelTextEntityId) return;\n\tconst textEntity = coreState.geometry3DMap.get(labelTextEntityId);\n\tif (textEntity?.type === 'text3d') {\n\t\ttextEntity.components[Geometry3DComponents.Style].hoverByPolygon = hover;\n\t\ttextEntity.components[Geometry3DComponents.Style].dirty = true;\n\t}\n}\n\nfunction processCursor(intersected: boolean, isPanning: boolean, isMouseDown: boolean): CursorTypes {\n\tif (isPanning) return 'grabbing';\n\tif (intersected) return 'pointer';\n\tif (isMouseDown) return 'grabbing';\n\n\treturn 'grab';\n}\n\n// export for testing\nexport function findModelParent(object: Object3D) {\n\tlet itr = object;\n\n\twhile (itr?.parent) {\n\t\tif (itr instanceof Scene) {\n\t\t\treturn;\n\t\t}\n\t\tif (itr.userData.isSingleModel) {\n\t\t\treturn itr;\n\t\t}\n\t\titr = itr.parent;\n\t}\n\n\treturn undefined;\n}\n\nfunction findModelParentEntity(object: Object3D, map: RendererState['geometry3DMap']) {\n\tconst found = findModelParent(object);\n\tif (!found) return;\n\tconst geometryGroup = map.get(found.userData.entityId);\n\n\treturn geometryGroup;\n}\n", "import { TAP_TIMEOUT, TWO_FINGER_TAP_THRESHOLD } from './constants';\n\nexport enum TapType {\n\tonefinger,\n\ttwofinger,\n}\nexport class Tap {\n\ttype: TapType;\n\tevent: PointerEvent;\n\tconstructor(event: PointerEvent) {\n\t\tthis.type = TapType.onefinger;\n\t\tthis.event = event;\n\t}\n\tget timestamp() {\n\t\treturn this.event.timeStamp;\n\t}\n}\n\nexport class TapsController {\n\tprivate taps: Tap[] = [];\n\n\tadd(tap: Tap) {\n\t\tif (this.lastPointerDown && tap.timestamp - this.lastPointerDown.timestamp < TWO_FINGER_TAP_THRESHOLD) {\n\t\t\tthis.lastPointerDown.type = TapType.twofinger;\n\t\t} else {\n\t\t\tthis.taps.push(tap);\n\t\t}\n\t}\n\n\tget lastPointerDown() {\n\t\treturn this.taps.length >= 1 ? this.taps[this.taps.length - 1] : undefined;\n\t}\n\n\tget isSingleTapWithTwoFingers() {\n\t\treturn this.isSingleTap && this.lastPointerDown?.type === TapType.twofinger;\n\t}\n\n\tget isSingleTapWithOneFinger() {\n\t\treturn this.isSingleTap && this.lastPointerDown?.type === TapType.onefinger;\n\t}\n\n\tget isDoubleTapWithOneFinger() {\n\t\treturn this.isDoubleTap && this.taps[0]?.type === TapType.onefinger && this.taps[1]?.type === TapType.onefinger;\n\t}\n\n\tget isSingleTap() {\n\t\treturn this.taps.length === 1;\n\t}\n\n\tget isDoubleTap() {\n\t\treturn this.taps.length === 2;\n\t}\n\n\tdiscardOutsideOfWaitWindow(timestamp: number) {\n\t\tthis.taps = this.taps.filter(t => {\n\t\t\treturn timestamp - t.timestamp < TAP_TIMEOUT;\n\t\t});\n\t}\n\n\tflush() {\n\t\tthis.taps = [];\n\t}\n\n\t// exposed for testing purpose\n\tget _taps() {\n\t\treturn this.taps;\n\t}\n\n\tdestroy() {\n\t\tthis.flush();\n\t}\n}\n", "export const TWO_FINGER_TAP_THRESHOLD = 50;\nexport const MOUSE_CLICK_TIME_THRESHOLD = 300;\nexport const MOUSE_CLICK_DISTANCE_THRESHOLD = 15;\nexport const ZOOM_IN_RATIO = 1.5;\nexport const ZOOM_IN_DURATION = 250;\nexport const TAP_TIMEOUT = 300;\n", "import type { Intersection, Object3D } from 'three';\nimport { GroupContainerComponents, GroupContainerObject3D } from '../../entities/group-container';\n\n/** Takes an array of raycast intersects and traverses the parents to determine the intersected group-containers */\nexport function getUniqueIntersectedGroupContainers(intersects: Intersection<Object3D>[]): GroupContainerObject3D[] {\n\tconst groupContainers = new Set<GroupContainerObject3D>();\n\tfor (const intersect of intersects) {\n\t\tlet object = intersect.object;\n\n\t\twhile (\n\t\t\tobject.visible &&\n\t\t\tobject.parent &&\n\t\t\tobject.parent.visible === true &&\n\t\t\t!groupContainers.has(object.parent as GroupContainerObject3D)\n\t\t) {\n\t\t\tobject = object.parent;\n\n\t\t\tif (\n\t\t\t\tobject instanceof GroupContainerObject3D &&\n\t\t\t\tobject.type === 'group-container' &&\n\t\t\t\tobject.visible &&\n\t\t\t\tobject.components[GroupContainerComponents.Interaction]\n\t\t\t) {\n\t\t\t\tgroupContainers.add(object);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn Array.from(groupContainers);\n}\n", "export { ExporterSystem, type GLTFExportOptions } from './exporter';\n", "import type { Quaternion, Object3D, BufferAttribute } from 'three';\nimport {\n\tVector3,\n\tEuler,\n\tScene,\n\tDoubleSide,\n\tBatchedMesh,\n\tDirectionalLight,\n\tMeshStandardMaterial,\n\tMeshBasicMaterial,\n\tLineSegments,\n\tMesh,\n\tBox3,\n\tColor,\n\tBufferGeometry,\n} from 'three';\nimport * as BufferGeometryUtils from 'three/examples/jsm/utils/BufferGeometryUtils.js';\nimport type { RendererState } from '../../renderer';\nimport type { Geometry3DTypes } from '../../entities';\nimport { Geometry3D, Geometry3DComponents } from '../../entities';\nimport { ModelStyleComponnet, StyleComponent, Text3DStyleComponent } from '../../components/styles';\n\nexport type GLTFExportOptions = {\n\tonlyVisible?: boolean;\n\tbinary?: boolean;\n\tscale?: number;\n\tlight?: boolean;\n};\n\n/**\n * Class for exporting a three.js scene as a GLTF file.\n */\nexport class ExporterSystem {\n\t#glTFExporter: any = null;\n\n\t#state: RendererState;\n\n\t/**\n\t * @hidden\n\t */\n\tconstructor(state: RendererState) {\n\t\tthis.#state = state;\n\t\tthis.#state.entityScene = state.entityScene;\n\t\tthis.#state.geometry3DMap = state.geometry3DMap;\n\t}\n\n\t/**\n\t * Exports the current scene as a GLTF file.\n\t * @param {GLTFExportOptions} userOptions - User-defined options for exporting.\n\t * @returns {Promise<Blob>} - A promise that resolves to a Blob containing the GLTF data.\n\t */\n\tgetCurrentSceneGLTF = async (userOptions: GLTFExportOptions): Promise<Blob> => {\n\t\tconst options: Required<GLTFExportOptions> = {\n\t\t\tonlyVisible: true,\n\t\t\tbinary: true,\n\t\t\tlight: true,\n\t\t\tscale: 1,\n\t\t\t...userOptions,\n\t\t};\n\n\t\tconst gltfExporter = await this.#getGLTFExporter();\n\t\tconst newScene = this.#getExportedScene(options);\n\n\t\tconst gltf = await gltfExporter.parseAsync(newScene, {\n\t\t\ttrs: false,\n\t\t\tmaxTextureSize: Infinity,\n\t\t\tonlyVisible: options.onlyVisible,\n\t\t\tbinary: options.binary,\n\t\t\tscale: options.scale,\n\t\t});\n\n\t\tlet blob: Blob;\n\t\tif (gltf instanceof ArrayBuffer) {\n\t\t\tblob = new Blob([gltf], { type: 'application/octet-stream' });\n\t\t} else {\n\t\t\tconst output = JSON.stringify(gltf, null, 2);\n\t\t\tblob = new Blob([output], { type: 'text/plain' });\n\t\t}\n\n\t\treturn blob;\n\t};\n\n\t/**\n\t * Creates a new scene with the current scene's objects, new light, and converts all the coordinates from XYZ to XZY.\n\t * @param {GLTFExportOptions} options - The options for exporting the scene.\n\t * @returns {Scene | null} - The new scene with transformed coordinates.\n\t * @hidden\n\t */\n\t#getExportedScene = (options: Required<GLTFExportOptions>): Scene => {\n\t\tconst { scale, light, onlyVisible } = options;\n\t\tconst newScene = new Scene();\n\n\t\tconst bbox = new Box3().setFromObject(this.#state.entityScene);\n\n\t\tthis.#processObject3D(this.#state.entityScene, newScene, onlyVisible);\n\n\t\tif (light) {\n\t\t\tconst directionalLight = new DirectionalLight(0xffffff, 0.3 * Math.PI);\n\t\t\tdirectionalLight.position.set(0, Math.max(bbox.max.x, bbox.max.y) * scale * 0.5, bbox.max.y * scale * 4);\n\t\t\tdirectionalLight.lookAt(0, 0, -1);\n\t\t\tdirectionalLight.target.position.set(0, 0, -1);\n\t\t\tdirectionalLight.add(directionalLight.target);\n\n\t\t\tnewScene.add(directionalLight);\n\t\t}\n\n\t\treturn newScene;\n\t};\n\n\t/**\n\t * Loads the GLTF exporter module if it is not already loaded.\n\t * @returns {Promise<any>} - The GLTF exporter instance.\n\t * @hidden\n\t */\n\tasync #getGLTFExporter() {\n\t\tif (!this.#glTFExporter) {\n\t\t\tconst { GLTFExporter } = await import('three/examples/jsm/exporters/GLTFExporter.js');\n\t\t\tthis.#glTFExporter = new GLTFExporter();\n\t\t}\n\n\t\treturn this.#glTFExporter;\n\t}\n\n\t/**\n\t * Processes the venue object and its children to convert their properties.\n\t * @param {Object3D} object - The object to process.\n\t * @param {Scene} newScene - The new scene to add the processed object to.\n\t * @param {boolean} onlyVisible - Whether to process only visible objects.\n\t * @hidden\n\t */\n\t#processObject3D = (object: Object3D, newScene: Scene, onlyVisible: boolean) => {\n\t\tif ((object as Mesh).material) {\n\t\t\tif (object instanceof BatchedMesh) {\n\t\t\t\tthis.#processBatchedMesh(object).forEach(mesh => newScene.add(mesh));\n\t\t\t} else if (object instanceof LineSegments) {\n\t\t\t\tnewScene.add(this.#processLineSegments(object));\n\t\t\t}\n\t\t}\n\t\tobject.children.forEach(child => {\n\t\t\tif (!onlyVisible || child.visible) {\n\t\t\t\tthis.#processObject3D(child, newScene, onlyVisible);\n\t\t\t}\n\t\t});\n\t};\n\n\t#createStandardMaterial = (color: string, opacity: number, transparent: boolean): MeshStandardMaterial => {\n\t\tconst newMaterial = new MeshStandardMaterial({ color: new Color(color), metalness: 0 });\n\t\tnewMaterial.opacity = opacity;\n\t\tnewMaterial.transparent = transparent;\n\n\t\treturn newMaterial;\n\t};\n\n\t/**\n\t * Processes batched mesh and converts its properties.\n\t * @param {BatchedMesh} batchedMesh - The batched mesh to process.\n\t * @returns {Mesh} - The merged mesh.\n\t * @hidden\n\t */\n\t#processBatchedMesh(batchedMesh: BatchedMesh): Mesh[] {\n\t\tconst result: Mesh[] = [];\n\t\tconst entityIDs: string[] = batchedMesh.userData?.entities ? Object.values(batchedMesh.userData?.entities) : [];\n\t\tconst entities = entityIDs.map(id => this.#state.geometry3DMap.get(id));\n\t\tconst colorMap = new Map<string, Geometry3DTypes[]>();\n\n\t\tentities.forEach(entity => {\n\t\t\tif (!entity || !(entity instanceof Geometry3D)) return;\n\t\t\tconst style = entity.components[Geometry3DComponents.Style];\n\t\t\tconst interaction = entity.components[Geometry3DComponents.Interaction];\n\n\t\t\tif (\n\t\t\t\t!style.visible ||\n\t\t\t\t(style instanceof StyleComponent && style.opacity === 0) ||\n\t\t\t\tstyle instanceof Text3DStyleComponent ||\n\t\t\t\tstyle instanceof ModelStyleComponnet\n\t\t\t)\n\t\t\t\treturn;\n\n\t\t\tconst color = interaction?.hover ? style.hoverColor || this.#state.hoverColor : style.color;\n\t\t\tconst key = `${color}-${style.opacity}-${Number(style.visible)}`;\n\n\t\t\tif (!colorMap.has(key)) {\n\t\t\t\tcolorMap.set(key, []);\n\t\t\t}\n\n\t\t\tcolorMap.get(key)?.push(entity);\n\t\t});\n\n\t\tcolorMap.forEach((entities, key) => {\n\t\t\tconst [color, opacity, visible] = key.split('-');\n\t\t\tconst geometries = entities.reduce((acc, entity) => {\n\t\t\t\tif (entity.type === 'custom-geometry') {\n\t\t\t\t\treturn acc;\n\t\t\t\t}\n\t\t\t\tconst mesh = entity.components[Geometry3DComponents.Mesh];\n\n\t\t\t\tif ('geometry' in mesh && mesh.geometry instanceof BufferGeometry) {\n\t\t\t\t\tacc.push(mesh.geometry);\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, [] as BufferGeometry[]);\n\n\t\t\tconst material = this.#createStandardMaterial(color, Number(opacity), batchedMesh.material.transparent);\n\t\t\tconst mergedGeometry = BufferGeometryUtils.mergeGeometries(geometries, true);\n\t\t\tconst mergedMesh = new Mesh(mergedGeometry, material);\n\n\t\t\tmergedMesh.position.copy(batchedMesh.position);\n\t\t\tmergedMesh.rotation.copy(batchedMesh.rotation);\n\t\t\tmergedMesh.scale.copy(batchedMesh.scale);\n\t\t\tmergedMesh.visible = Boolean(visible);\n\n\t\t\tthis.#convertObjectProperties(\n\t\t\t\tmergedMesh.position,\n\t\t\t\tmergedMesh.scale,\n\t\t\t\tmergedMesh.rotation as Euler,\n\t\t\t\tmergedMesh.quaternion,\n\t\t\t);\n\t\t\tresult.push(this.#convertGeometry(mergedMesh));\n\t\t});\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Processes line segments and converts its properties.\n\t * @param {LineSegments} mesh - The line segments to process.\n\t * @returns {Mesh} - The merged mesh.\n\t * @hidden\n\t */\n\t#processLineSegments(mesh: LineSegments): Mesh {\n\t\tconst geometry = mesh.geometry.clone();\n\t\tconst material = mesh.material as MeshBasicMaterial;\n\t\tconst newMaterial = new MeshBasicMaterial({ color: material.color, side: DoubleSide });\n\t\tnewMaterial.opacity = material.opacity;\n\t\tnewMaterial.transparent = material.transparent;\n\n\t\tconst clone = new LineSegments(geometry, newMaterial);\n\t\tclone.position.copy(mesh.position);\n\t\tclone.rotation.copy(mesh.rotation);\n\t\tclone.scale.copy(mesh.scale);\n\t\tclone.visible = mesh.visible;\n\n\t\treturn this.#convertGeometry(clone) as Mesh;\n\t}\n\n\t/**\n\t * Converts the geometry of an object to switch from XYZ to XZY coordinate system.\n\t * @param object - The object to convert.\n\t * @hidden\n\t */\n\t#convertGeometry = object => {\n\t\tconst { geometry, material, position, rotation, quaternion, scale } = object;\n\t\tif (!geometry?.isBufferGeometry) return object;\n\n\t\tconst positionAttribute = geometry.attributes.position;\n\t\tconst normalAttribute = geometry.attributes.normal;\n\t\tconst uvAttribute = geometry.attributes.uv;\n\n\t\tthis.#convertAttributes(positionAttribute, normalAttribute);\n\t\tthis.#convertObjectProperties(position, scale, rotation, quaternion);\n\n\t\tif (uvAttribute) {\n\t\t\tthis.#convertUVs(uvAttribute);\n\t\t}\n\n\t\tif (material?.map && geometry.type === 'PlaneGeometry') {\n\t\t\tobject.side = DoubleSide;\n\t\t}\n\n\t\treturn object;\n\t};\n\n\t/**\n\t * Converts position and normal attributes of a geometry.\n\t * @param {BufferAttribute} positionAttribute - The position attribute to convert.\n\t * @param {BufferAttribute} normalAttribute - The normal attribute to convert.\n\t * @hidden\n\t */\n\t#convertAttributes = (positionAttribute: BufferAttribute, normalAttribute: BufferAttribute): void => {\n\t\tconst vertex = new Vector3();\n\t\tconst normal = new Vector3();\n\n\t\tfor (let i = 0; i < positionAttribute.count; i++) {\n\t\t\tvertex.fromBufferAttribute(positionAttribute, i);\n\t\t\tthis.#convertVector(vertex);\n\t\t\tpositionAttribute.setXYZ(i, vertex.x, vertex.y, vertex.z);\n\n\t\t\tif (normalAttribute) {\n\t\t\t\tnormal.fromBufferAttribute(normalAttribute, i);\n\t\t\t\tthis.#convertVector(normal);\n\t\t\t\tnormalAttribute.setXYZ(i, normal.x, normal.y, normal.z);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Converts a vector from XYZ to XZY coordinate system.\n\t * @param {Vector3} vector - The vector to convert.\n\t * @hidden\n\t */\n\t#convertVector = (vector: Vector3): void => {\n\t\tconst tempY = vector.y;\n\t\tvector.y = vector.z;\n\t\tvector.z = -tempY;\n\t};\n\n\t/**\n\t * Converts the position, scale, and rotation properties of an object.\n\t * @param {Vector3} position - The position to convert.\n\t * @param {Vector3} scale - The scale to convert.\n\t * @param {Euler} rotation - The rotation to convert.\n\t * @param {Quaternion} quaternion - The quaternion to convert.\n\t * @hidden\n\t */\n\t#convertObjectProperties = (position: Vector3, scale: Vector3, rotation: Euler, quaternion: Quaternion): void => {\n\t\tconst tempPosY = position.y;\n\t\tposition.y = position.z;\n\t\tposition.z = -tempPosY;\n\n\t\tconst tempScaleY = scale.y;\n\t\tscale.y = scale.z;\n\t\tscale.z = tempScaleY;\n\n\t\tif (rotation instanceof Euler) {\n\t\t\trotation.order = 'YXZ'; // Ensure the rotation order is set\n\t\t\trotation.set(rotation.x, rotation.y, rotation.z, rotation.order);\n\t\t} else {\n\t\t\tconst tempQuatY = quaternion.y;\n\t\t\tquaternion.set(quaternion.x, quaternion.z, -tempQuatY, quaternion.w);\n\t\t}\n\t};\n\n\t/**\n\t * Converts the UV attributes of a geometry.\n\t * @param {BufferAttribute} uvAttribute - The UV attribute to convert.\n\t * @hidden\n\t */\n\t#convertUVs = (uvAttribute: BufferAttribute): void => {\n\t\tfor (let i = 0; i < uvAttribute.count; i++) {\n\t\t\tconst u = uvAttribute.getX(i);\n\t\t\tconst v = uvAttribute.getY(i);\n\t\t\tuvAttribute.setXY(i, u, v);\n\t\t}\n\t};\n\n\t/**\n\t * Cleans up resources used by the ExporterSystem.\n\t */\n\tdestroy(): void {\n\t\tthis.#glTFExporter = null;\n\t}\n}\n", "import { Euler, InstancedMesh, MathUtils, Matrix4, Quaternion, Vector3 } from 'three';\nimport type { BufferGeometry, Mesh } from 'three';\nimport type { EntityTypes, RendererState } from '../../renderer';\nimport { Geometry3DComponents, Geometry3D, Geometry3DObject3D } from '../../entities/geometry3d';\nimport { batchGeometries, darkenColorForOutline, updateUVsLegacy } from './utils';\nimport { MeshComponent, type MeshComponentProperties } from '../../components/mesh';\nimport { StyleComponent } from '../../components/styles/style';\nimport { renderPolygonGeometry } from '../../geometry/polygons';\nimport { renderMultiPolygonGeometry } from '../../geometry/multi-polygon';\nimport { renderLineStringGeometry } from '../../geometry/line-string';\nimport { renderMultiLineStringGeometry } from '../../geometry/multi-line-string';\nimport type { Feature, LineString, MultiLineString, MultiPolygon, Point, Polygon } from 'geojson';\nimport type { LineStyle, ModelProperties, PaintStyle } from '../../types';\nimport { ModelComponent } from '../../components/model';\nimport { GeometryGroupObject3D } from '../../entities/geometry-group';\nimport type { ModelGeometry3D } from '../../entities';\nimport { Logger, PubSub } from '@packages/internal/common';\nimport type { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\nimport type { ModelStyle } from '../../components/styles';\nimport { ModelStyleComponnet, DEFAULT_ROTATION, DEFAULT_SCALE } from '../../components/styles';\nimport { applyModelGeometryStyle } from '../draw/utils';\nimport { OutlineComponent } from '../../components/outline';\nimport { FocusableComponent } from '../../components/focusable';\nimport { TextureComponent } from '../../components/texture';\n\nfunction generateIndex(style: any) {\n\tconst { color, opacity, topColor, texture, topTexture } = style;\n\n\treturn `${color}${opacity}${topColor || ''}${texture || ''}${topTexture || ''}`;\n}\n\nexport class MeshCreationAndOptimizationSystem extends PubSub<{\n\t'model-loaded': void;\n\t'geometry-2d-added': void;\n\t'geometry-group-added': void;\n}> {\n\tstate: RendererState;\n\tconvertTo3DMapPosition: any;\n\tloader?: GLTFLoader;\n\tconstructor(state: RendererState, convertTo3DMapPosition) {\n\t\tsuper();\n\n\t\tthis.state = state;\n\t\tthis.convertTo3DMapPosition = convertTo3DMapPosition;\n\t}\n\n\tasync getGLTFLoader() {\n\t\tif (this.loader) {\n\t\t\treturn this.loader;\n\t\t}\n\t\tconst { GLTFLoader } = await import('three/examples/jsm/loaders/GLTFLoader.js');\n\t\tthis.loader = new GLTFLoader();\n\n\t\treturn this.loader;\n\t}\n\n\tcreateEntityFromFeature(\n\t\tid: string | number,\n\t\tfeature: Feature<Polygon | LineString | MultiPolygon, MeshComponentProperties>,\n\t\tstyle?: (LineStyle | PaintStyle) & { focusable?: boolean },\n\t) {\n\t\tconst meshComponent = new MeshComponent(feature);\n\n\t\t// Handle bevel merging: style.bevel takes precedence over feature.properties.bevel\n\t\t// Only relevant for PaintStyle (polygons), not LineStyle\n\t\tconst featureBevel = feature?.properties?.bevel;\n\t\tconst styleBevel = style && 'bevel' in style ? style.bevel : undefined;\n\t\tlet mergedBevel;\n\n\t\tif (styleBevel) {\n\t\t\t// Style bevel takes precedence - merge/override feature bevel\n\t\t\tmergedBevel = { ...featureBevel, ...styleBevel };\n\t\t} else if (featureBevel) {\n\t\t\t// Use feature bevel as-is\n\t\t\tmergedBevel = featureBevel;\n\t\t}\n\n\t\tconst entity = new Geometry3D(\n\t\t\tmeshComponent,\n\t\t\tnew StyleComponent({ ...style, url: feature.properties?.image?.path, bevel: mergedBevel }),\n\t\t);\n\t\tif (style?.outline) {\n\t\t\tentity.components[Geometry3DComponents.Outline] = new OutlineComponent(darkenColorForOutline(style.color));\n\t\t}\n\t\tif (style?.focusable) {\n\t\t\tentity.components[Geometry3DComponents.Focusable] = new FocusableComponent();\n\t\t}\n\t\tif (\n\t\t\tfeature.properties?.textures != null &&\n\t\t\tArray.isArray(feature.properties.textures) &&\n\t\t\tfeature.properties.textures.length > 0\n\t\t) {\n\t\t\tentity.components[Geometry3DComponents.TextureComponent] = new TextureComponent(\n\t\t\t\tfeature.properties.textures.find(t => t.face === 'side'),\n\t\t\t\tfeature.properties.textures.find(t => t.face === 'top'),\n\t\t\t);\n\t\t} else if (\n\t\t\t(style != null && 'texture' in style && style.texture != null) ||\n\t\t\t(style != null && 'topTexture' in style && style.topTexture != null)\n\t\t) {\n\t\t\tentity.components[Geometry3DComponents.TextureComponent] = new TextureComponent(style.texture, style.topTexture);\n\t\t}\n\t\t// @ts-ignore\n\t\tentity.id = id;\n\n\t\treturn entity;\n\t}\n\n\tcreateModelFromFeature(\n\t\tid: string | number,\n\t\tfeature: Feature<Point, ModelProperties>,\n\t\tstyle?: Partial<ModelStyle>,\n\t): ModelGeometry3D {\n\t\tconst meshComponent = new ModelComponent(feature);\n\t\tlet initStyle = { ...style };\n\t\tif (feature.properties.verticalOffset != null) {\n\t\t\tinitStyle.verticalOffset = feature.properties.verticalOffset;\n\t\t}\n\t\tif (feature.properties.rotation != null) {\n\t\t\tinitStyle.rotation = feature.properties.rotation;\n\t\t}\n\t\tif (feature.properties.scale != null) {\n\t\t\tinitStyle.scale = feature.properties.scale;\n\t\t}\n\t\tconst modelStyle = new ModelStyleComponnet(initStyle);\n\t\tconst entity = new Geometry3D(meshComponent, modelStyle);\n\t\tentity.id = id;\n\n\t\treturn entity;\n\t}\n\n\tpopulateEntityMesh(entity: Geometry3D, geometry: BufferGeometry) {\n\t\tconst meshComponent = entity.components[Geometry3DComponents.Mesh] as MeshComponent;\n\t\tmeshComponent.geometry = geometry;\n\t\tmeshComponent.batchedProps = {\n\t\t\trange: {\n\t\t\t\tstart: 0,\n\t\t\t\tcount: Infinity,\n\t\t\t\tindexCount: Infinity,\n\t\t\t\tindexStart: 0,\n\t\t\t\tvertexCount: Infinity,\n\t\t\t\tvertexStart: 0,\n\t\t\t\treservedVertexCount: Infinity,\n\t\t\t\treservedIndexCount: Infinity,\n\t\t\t},\n\t\t\tgeometryId: -1,\n\t\t\tpositionCount: geometry.attributes.position.count,\n\t\t};\n\t\tmeshComponent.currentHeight = entity.components[Geometry3DComponents.Style].height;\n\t\tmeshComponent.dirty = false;\n\t}\n\n\tasync populateModelGroup(entities: Set<string | number>, url: string, tree: GeometryGroupObject3D) {\n\t\tconst matrix = new Matrix4();\n\t\tconst rotation = new Euler();\n\t\tconst quaternion = new Quaternion();\n\t\tconst scale = new Vector3();\n\t\tconst object = new Geometry3DObject3D();\n\n\t\tconst loader = await this.getGLTFLoader();\n\t\t/**\n\t\t * NOTE: we are moving towards no instancing for now when dealing with single model or loading inline url. This is to supports backwards compat for handling an array of models\n\t\t * See: https://mappedin.atlassian.net/wiki/spaces/SDK/pages/597983234/3D+Asset+Library#Deprecating-FeatureCollection-Support-when-Adding-Model\n\t\t * TODO: caching models\n\t\t */\n\t\tconst promise = new Promise<void>(resolve => {\n\t\t\tconst processGLTF = (gltf: any) => {\n\t\t\t\tif ('entities3D' in tree.userData) {\n\t\t\t\t\tif (tree.userData.entities3D.size > 1) {\n\t\t\t\t\t\tgltf.scene.traverse(child => {\n\t\t\t\t\t\t\tconst gltfChild = child as Mesh;\n\t\t\t\t\t\t\tif ('isMesh' in gltfChild && gltfChild.isMesh === true) {\n\t\t\t\t\t\t\t\tconst mesh = new InstancedMesh(gltfChild.geometry, gltfChild.material, entities.size);\n\t\t\t\t\t\t\t\tmesh.userData = {\n\t\t\t\t\t\t\t\t\tentities: {},\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tobject.add(mesh);\n\t\t\t\t\t\t\t\ttree.add(object);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tgltf.scene.traverse(child => {\n\t\t\t\t\t\t\tif ('isMesh' in child && child.isMesh === true) {\n\t\t\t\t\t\t\t\t// reset any transformations applied to the mesh\n\t\t\t\t\t\t\t\tchild.position.set(0, 0, 0);\n\t\t\t\t\t\t\t\tchild.rotation.set(0, 0, 0);\n\t\t\t\t\t\t\t\tchild.scale.set(1, 1, 1);\n\t\t\t\t\t\t\t\tchild.updateMatrix();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tobject.add(gltf.scene);\n\t\t\t\t\t\ttree.add(object);\n\t\t\t\t\t\tobject.userData.isSingleModel = true;\n\t\t\t\t\t\tobject.userData.entityId = entities.values().next().value as any;\n\t\t\t\t\t\tobject.userData.type = 'model';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\t// Check if url is raw GLTF JSON text or a data URL containing JSON\n\t\t\tconst isRawGLTF =\n\t\t\t\turl.trimStart().startsWith('{') || (url.startsWith('data:') && url.includes('application/json'));\n\n\t\t\tif (isRawGLTF) {\n\t\t\t\tconst gltfText = url.startsWith('data:')\n\t\t\t\t\t? atob(url.split(',')[1]) // Extract base64 content from data URL\n\t\t\t\t\t: url;\n\t\t\t\tloader.parse(gltfText, '', processGLTF);\n\t\t\t} else {\n\t\t\t\t// load the model from the url\n\t\t\t\tloader.load(url, processGLTF);\n\t\t\t}\n\t\t});\n\t\tthis.optimizePromise.push(\n\t\t\tpromise.then(() => {\n\t\t\t\tlet idx = 0;\n\n\t\t\t\tlet entity: EntityTypes | undefined;\n\t\t\t\tfor (const entityId of entities.values()) {\n\t\t\t\t\tentity = this.state.geometry3DMap.get(entityId);\n\t\t\t\t\tif (!entity || entity?.type !== 'model') {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tconst modelComponent = entity.components[Geometry3DComponents.Mesh];\n\t\t\t\t\tconst styleComponent = entity.components[Geometry3DComponents.Style];\n\n\t\t\t\t\tconst feature = entity.components[Geometry3DComponents.Mesh].feature;\n\t\t\t\t\tmodelComponent.mesh = object;\n\t\t\t\t\tmodelComponent.instanceIndex = idx;\n\t\t\t\t\tapplyModelGeometryStyle(entity);\n\t\t\t\t\tentity.components[Geometry3DComponents.Style].dirty = false;\n\t\t\t\t\tconst { x, y } = this.convertTo3DMapPosition(\n\t\t\t\t\t\tfeature.geometry.coordinates[1],\n\t\t\t\t\t\tfeature.geometry.coordinates[0],\n\t\t\t\t\t\t0,\n\t\t\t\t\t);\n\t\t\t\t\tmodelComponent.position.set(x, y, modelComponent.altitude);\n\t\t\t\t\trotation.set(\n\t\t\t\t\t\tMathUtils.degToRad(styleComponent.rotation?.[0] ?? DEFAULT_ROTATION[0]),\n\t\t\t\t\t\tMathUtils.degToRad(styleComponent.rotation?.[1] ?? DEFAULT_ROTATION[1]),\n\t\t\t\t\t\tMathUtils.degToRad(styleComponent.rotation?.[2] ?? DEFAULT_ROTATION[2]),\n\t\t\t\t\t);\n\t\t\t\t\tscale.set(\n\t\t\t\t\t\tstyleComponent.scale?.[0] ?? DEFAULT_SCALE[0],\n\t\t\t\t\t\tstyleComponent.scale?.[1] ?? DEFAULT_SCALE[1],\n\t\t\t\t\t\tstyleComponent.scale?.[2] ?? DEFAULT_SCALE[2],\n\t\t\t\t\t);\n\t\t\t\t\tquaternion.setFromEuler(rotation);\n\t\t\t\t\tmatrix.compose(modelComponent.position, quaternion, scale);\n\t\t\t\t\tobject.children.forEach(child => {\n\t\t\t\t\t\tif (!entity || entity?.type !== 'model' || !(child instanceof InstancedMesh)) return;\n\t\t\t\t\t\tchild.setMatrixAt(idx, matrix);\n\t\t\t\t\t\tchild.userData.entities[idx] = entity.id;\n\t\t\t\t\t});\n\t\t\t\t\t// TODO: consolidate models to use frustum culled instancing\n\t\t\t\t\tif (modelComponent.mesh.userData.isSingleModel) {\n\t\t\t\t\t\tmodelComponent.mesh.matrix.copy(matrix);\n\t\t\t\t\t\tmodelComponent.mesh.matrix.decompose(\n\t\t\t\t\t\t\tmodelComponent.mesh.position,\n\t\t\t\t\t\t\tmodelComponent.mesh.quaternion,\n\t\t\t\t\t\t\tmodelComponent.mesh.scale,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tidx++;\n\t\t\t\t}\n\t\t\t\tthis.publish('model-loaded');\n\t\t\t}),\n\t\t);\n\n\t\treturn object;\n\t}\n\n\tpopulateEntityGroup(entities: Set<string | number>) {\n\t\tlet mesh: BufferGeometry;\n\t\tlet feature: Feature<Polygon | LineString | MultiPolygon | MultiLineString>;\n\t\tlet style: any;\n\t\tlet entity: Geometry3D;\n\t\tfor (const entityId of entities.values()) {\n\t\t\tentity = this.state.geometry3DMap.get(entityId) as Geometry3D;\n\t\t\tif (entity.components[Geometry3DComponents.Mesh] instanceof MeshComponent) {\n\t\t\t\tfeature = entity.components[Geometry3DComponents.Mesh].feature;\n\t\t\t\tstyle = entity.components[Geometry3DComponents.Style];\n\t\t\t\tif (feature.geometry.type === 'Polygon') {\n\t\t\t\t\tmesh = renderPolygonGeometry(\n\t\t\t\t\t\tfeature as Feature<Polygon, any>,\n\t\t\t\t\t\tthis.convertTo3DMapPosition,\n\t\t\t\t\t\tstyle as PaintStyle,\n\t\t\t\t\t);\n\t\t\t\t\tif (feature.properties?.textures && feature.properties.textures.length > 0) {\n\t\t\t\t\t\tupdateUVsLegacy(mesh, feature.properties.textures, this.state.naturalBearing, this.convertTo3DMapPosition);\n\t\t\t\t\t}\n\t\t\t\t\tthis.populateEntityMesh(entity, mesh);\n\t\t\t\t} else if (feature.geometry.type === 'MultiPolygon') {\n\t\t\t\t\tmesh = renderMultiPolygonGeometry(\n\t\t\t\t\t\tfeature as Feature<MultiPolygon, any>,\n\t\t\t\t\t\tthis.convertTo3DMapPosition,\n\t\t\t\t\t\tstyle as PaintStyle,\n\t\t\t\t\t);\n\t\t\t\t\tthis.populateEntityMesh(entity, mesh);\n\t\t\t\t} else if (feature.geometry.type === 'LineString') {\n\t\t\t\t\tmesh = renderLineStringGeometry(\n\t\t\t\t\t\tfeature as Feature<LineString, any>,\n\t\t\t\t\t\tthis.convertTo3DMapPosition,\n\t\t\t\t\t\tstyle as unknown as LineStyle,\n\t\t\t\t\t);\n\t\t\t\t\tthis.populateEntityMesh(entity, mesh);\n\t\t\t\t} else if (feature.geometry.type === 'MultiLineString') {\n\t\t\t\t\tmesh = renderMultiLineStringGeometry(\n\t\t\t\t\t\tfeature as Feature<MultiLineString, any>,\n\t\t\t\t\t\tthis.convertTo3DMapPosition,\n\t\t\t\t\t\tstyle as unknown as LineStyle,\n\t\t\t\t\t);\n\t\t\t\t\tthis.populateEntityMesh(entity, mesh);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn entities;\n\t}\n\n\tprivate optimizePromise: Promise<void>[] = [];\n\n\tupdate() {\n\t\tfor (const entityId of this.state.geometryGroupIdsToLoad.values()) {\n\t\t\tconst entity = this.state.geometry3DMap.get(entityId);\n\t\t\tif (entity instanceof GeometryGroupObject3D && entity.userData.dirty) {\n\t\t\t\tif (!entity.userData.modelURL) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthis.populateEntityGroup(entity.userData.entities3D);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tLogger.warn(e);\n\t\t\t\t\t}\n\t\t\t\t} else if (entity.userData.modelURL) {\n\t\t\t\t\tthis.populateModelGroup(entity.userData.entities3D, entity.userData.modelURL, entity);\n\t\t\t\t\tentity.userData.dirty = false;\n\t\t\t\t}\n\n\t\t\t\tlet childEntity: EntityTypes | undefined;\n\t\t\t\tconst index: {\n\t\t\t\t\t[id: string]: {\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\tcolor: string;\n\t\t\t\t\t\t\topacity?: number;\n\t\t\t\t\t\t};\n\t\t\t\t\t\tentities: Geometry3D[];\n\t\t\t\t\t};\n\t\t\t\t} = {};\n\n\t\t\t\tfor (const entityId of entity.userData.entities3D.values()) {\n\t\t\t\t\tchildEntity = this.state.geometry3DMap.get(entityId);\n\t\t\t\t\tconst component = childEntity?.components[Geometry3DComponents.Mesh];\n\t\t\t\t\tif (childEntity?.type === 'geometry') {\n\t\t\t\t\t\tconst style = childEntity.components[Geometry3DComponents.Style];\n\t\t\t\t\t\tconst indexString = generateIndex(style);\n\t\t\t\t\t\tif (index[indexString] === undefined) {\n\t\t\t\t\t\t\tindex[indexString] = {\n\t\t\t\t\t\t\t\tstyle: style,\n\t\t\t\t\t\t\t\tentities: [],\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tindex[indexString].entities.push(childEntity);\n\t\t\t\t\t} else if (component && 'mesh' in component && component.mesh && component.mesh?.parent !== entity) {\n\t\t\t\t\t\tentity.add(component.mesh);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (const indexString in index) {\n\t\t\t\t\tconst mesh = batchGeometries(index[indexString].entities, index[indexString].style);\n\t\t\t\t\tentity.add(mesh);\n\t\t\t\t}\n\n\t\t\t\t// process any attached 2D entities that need to be added to the 3D entity\n\t\t\t\tfor (const entityId of entity.userData.entities3D.values()) {\n\t\t\t\t\tchildEntity = this.state.geometry3DMap.get(entityId) as Geometry3D;\n\n\t\t\t\t\tif (childEntity != null && childEntity.entities2D.size > 0) {\n\t\t\t\t\t\tfor (const entity2D of childEntity.entities2D.values()) {\n\t\t\t\t\t\t\tif (entity2D) {\n\t\t\t\t\t\t\t\t(childEntity as Geometry3D).attach(entity2D);\n\t\t\t\t\t\t\t\tthis.publish('geometry-2d-added');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.publish('geometry-group-added');\n\n\t\t\t\tentity.userData.dirty = false;\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n}\n", "import { Shape, Path, ExtrudeGeometry, type Vector2 } from 'three';\nimport type { Feature, Polygon } from 'geojson';\nimport type { PaintStyle } from '../types';\nimport ClipperLib from '@packages/internal/clipper-lib/ClipperLib';\nimport type { PolygonFeatureProperties } from '@packages/internal/mvf-utils';\nimport * as BufferGeometryUtils from 'three/examples/jsm/utils/BufferGeometryUtils.js';\nimport { createExtrudeSettings } from '../utils/constants';\n\nconst DEFAULT_COLOR = 'gray';\nconst DEFAULT_HEIGHT = 0.1;\nconst OFFSET_QUALITY = 100;\n\nconst offsetter = new ClipperLib.ClipperOffset();\n\nfunction offset(vertices: Vector2[], offset: number): Vector2[][] {\n\toffsetter.Clear();\n\toffset /= 2;\n\tconst paths = vertices.map(v => ({ X: v.x * OFFSET_QUALITY, Y: v.y * OFFSET_QUALITY }));\n\n\toffsetter.AddPath(paths, ClipperLib.JoinType.jtMiter, ClipperLib.EndType.etClosedPolygon);\n\tconst offsettedPaths = new ClipperLib.Paths();\n\n\toffsetter.Execute(offsettedPaths, offset * OFFSET_QUALITY);\n\tif (offsettedPaths.length) {\n\t\tconst newPaths = offsettedPaths.map(p =>\n\t\t\tp.map(v => ({\n\t\t\t\tx: v.X / OFFSET_QUALITY,\n\t\t\t\ty: v.Y / OFFSET_QUALITY,\n\t\t\t})),\n\t\t);\n\n\t\treturn newPaths;\n\t}\n\n\treturn [vertices];\n}\n\nexport function renderPolygonGeometry(\n\tfeature: Feature<Polygon, PolygonFeatureProperties<any>>,\n\tconvertTo3DMapPosition,\n\tstyle?: PaintStyle,\n) {\n\tlet { color = DEFAULT_COLOR, opacity = 1, altitude = 0, height = DEFAULT_HEIGHT } = style || {};\n\tif (Array.isArray(opacity)) {\n\t\topacity = 1;\n\t}\n\n\tconst boundingBox = {\n\t\tmin: { x: Infinity, y: Infinity, z: altitude },\n\t\tmax: { x: -Infinity, y: -Infinity, z: height + altitude },\n\t\tcenter: { x: 0, y: 0, z: (height + altitude) / 2 },\n\t};\n\n\tconst cartesianCoordinates = feature.geometry.coordinates[0].map(coordinate => {\n\t\tconst coord = convertTo3DMapPosition(coordinate[1], coordinate[0]);\n\t\tboundingBox.min.x = Math.min(boundingBox.min.x, coord.x);\n\t\tboundingBox.min.y = Math.min(boundingBox.min.y, coord.y);\n\t\tboundingBox.max.x = Math.max(boundingBox.max.x, coord.x);\n\t\tboundingBox.max.y = Math.max(boundingBox.max.y, coord.y);\n\n\t\treturn coord;\n\t});\n\n\tlet clippedCoordinates = cartesianCoordinates;\n\n\t/**\n\t * If a polygon has enterprise edge offsets / infills we use clipper to offset the polygon.\n\t * Otherwise, two polygons will occupy the same space and the map will render with tons of z-fighting.\n\t *\n\t * Additionally, if the polygon has an image attached we use clipper with an offset of 0.\n\t * This replicates V5 behaviour & many such polygons have bad vertex data\n\t * because they're expecting to be offset in the renderer.\n\t */\n\tif (\n\t\t(feature.properties?.style?.edgeOffset != null && feature.properties.style.edgeOffset !== 0) ||\n\t\tfeature.properties?.image != null\n\t) {\n\t\tclippedCoordinates = offset(clippedCoordinates, feature.properties?.style?.edgeOffset || 0);\n\t} else {\n\t\tclippedCoordinates = [clippedCoordinates];\n\t}\n\n\tconst geometries: ExtrudeGeometry[] = [];\n\n\tfor (const polygon of clippedCoordinates) {\n\t\tconst shape = new Shape();\n\n\t\tshape.moveTo(polygon[0].x, polygon[0].y);\n\t\tpolygon.slice(1).forEach(coord => shape.lineTo(coord.x, coord.y));\n\t\tshape.lineTo(polygon[0].x, polygon[0].y);\n\t\tconst holes = feature.geometry.coordinates.slice(1);\n\n\t\tshape.holes = holes.map(hole => {\n\t\t\tconst cartesianCoordinates = hole.map(coordinate => {\n\t\t\t\treturn convertTo3DMapPosition(coordinate[1], coordinate[0]);\n\t\t\t});\n\t\t\tconst path = new Path();\n\t\t\tpath.moveTo(cartesianCoordinates[0].x, cartesianCoordinates[0].y);\n\t\t\tcartesianCoordinates.slice(1).forEach(coord => path.lineTo(coord.x, coord.y));\n\t\t\tpath.lineTo(cartesianCoordinates[0].x, cartesianCoordinates[0].y);\n\n\t\t\treturn path;\n\t\t});\n\n\t\t// Use StyleComponent bevel as single source of truth\n\t\tconst extrudeSettings = createExtrudeSettings(style?.bevel, height);\n\n\t\tconst geometry = new ExtrudeGeometry(shape, extrudeSettings);\n\n\t\tgeometry.userData = {\n\t\t\tstyle: {\n\t\t\t\tcolor,\n\t\t\t\topacity,\n\t\t\t},\n\t\t\tusedBevelSettings: extrudeSettings,\n\t\t};\n\n\t\tgeometries.push(geometry);\n\t}\n\n\tif (geometries.length === 1) {\n\t\treturn geometries[0];\n\t}\n\n\tconst mergedGeometry = BufferGeometryUtils.mergeGeometries(geometries);\n\n\t// Dispose individual geometries after merging to prevent memory leaks\n\tgeometries.forEach(geometry => geometry.dispose());\n\n\t// For merged geometries, use the settings from the first geometry\n\tconst extrudeSettings = createExtrudeSettings(style?.bevel, height);\n\tmergedGeometry.userData = {\n\t\tstyle: {\n\t\t\tcolor,\n\t\t\topacity,\n\t\t},\n\t\tusedBevelSettings: extrudeSettings,\n\t\t_split: true,\n\t};\n\n\treturn mergedGeometry;\n}\n", "import { Shape, Path, ExtrudeGeometry } from 'three';\nimport type { Feature, MultiPolygon } from 'geojson';\nimport type { PaintStyle } from '../types';\nimport * as BufferGeometryUtils from 'three/examples/jsm/utils/BufferGeometryUtils.js';\nimport { createExtrudeSettings } from '../utils/constants';\n\nconst DEFAULT_COLOR = 'gray';\nconst DEFAULT_HEIGHT = 0.1;\n\nexport function renderMultiPolygonGeometry(\n\tfeature: Feature<MultiPolygon, any>,\n\tconvertTo3DMapPosition,\n\tstyle?: PaintStyle,\n) {\n\tlet { color = DEFAULT_COLOR, opacity = 1, altitude = 0, height = DEFAULT_HEIGHT } = style || {};\n\tif (Array.isArray(opacity)) {\n\t\topacity = 1;\n\t}\n\n\tconst boundingBox = {\n\t\tmin: { x: Infinity, y: Infinity, z: altitude },\n\t\tmax: { x: -Infinity, y: -Infinity, z: height + altitude },\n\t};\n\n\t// Use StyleComponent bevel as single source of truth\n\tconst extrudeSettings = createExtrudeSettings(style?.bevel, height);\n\n\tconst geometries: ExtrudeGeometry[] = [];\n\n\tfeature.geometry.coordinates.forEach(coordinates => {\n\t\tconst shape = new Shape();\n\t\tconst cartesianCoordinates = coordinates[0].map(coordinate => {\n\t\t\tconst coord = convertTo3DMapPosition(coordinate[1], coordinate[0]);\n\t\t\tboundingBox.min.x = Math.min(boundingBox.min.x, coord.x);\n\t\t\tboundingBox.min.y = Math.min(boundingBox.min.y, coord.y);\n\t\t\tboundingBox.max.x = Math.max(boundingBox.max.x, coord.x);\n\t\t\tboundingBox.max.y = Math.max(boundingBox.max.y, coord.y);\n\n\t\t\treturn coord;\n\t\t});\n\n\t\tshape.moveTo(cartesianCoordinates[0].x, cartesianCoordinates[0].y);\n\t\tcartesianCoordinates.slice(1).forEach(coord => shape.lineTo(coord.x, coord.y));\n\t\tshape.lineTo(cartesianCoordinates[0].x, cartesianCoordinates[0].y);\n\t\tconst holes = coordinates.slice(1);\n\n\t\tshape.holes = holes.map(hole => {\n\t\t\tconst cartesianCoordinates = hole.map(coordinate => {\n\t\t\t\treturn convertTo3DMapPosition(coordinate[1], coordinate[0]);\n\t\t\t});\n\t\t\tconst path = new Path();\n\t\t\tpath.moveTo(cartesianCoordinates[0].x, cartesianCoordinates[0].y);\n\t\t\tcartesianCoordinates.slice(1).forEach(coord => path.lineTo(coord.x, coord.y));\n\t\t\tpath.lineTo(cartesianCoordinates[0].x, cartesianCoordinates[0].y);\n\n\t\t\treturn path;\n\t\t});\n\t\tconst geometry = new ExtrudeGeometry(shape, extrudeSettings);\n\t\tgeometries.push(geometry);\n\t});\n\n\tconst geometry = BufferGeometryUtils.mergeGeometries(geometries);\n\n\t// Dispose individual geometries after merging to prevent memory leaks\n\tgeometries.forEach(geom => geom.dispose());\n\n\tgeometry.translate(0, 0, altitude || 0);\n\n\tgeometry.userData = {\n\t\tstyle: {\n\t\t\tcolor,\n\t\t\topacity,\n\t\t},\n\t\tusedBevelSettings: extrudeSettings,\n\t};\n\n\treturn geometry;\n}\n", "import { ExtrudeGeometry, Path, Shape } from 'three';\nimport ClipperLib from '@packages/internal/clipper-lib/ClipperLib';\nimport * as BufferGeometryUtils from 'three/examples/jsm/utils/BufferGeometryUtils.js';\nimport type { Feature, MultiLineString } from 'geojson';\n\nconst QUALITY = 100;\nconst DEFAULT_WALL_WIDTH = 0.22;\nconst DEFAULT_WALL_HEIGHT = 0.01;\n\nexport function renderMultiLineStringGeometry(\n\tfeature: Feature<MultiLineString, any>,\n\tconvertTo3DMapPosition,\n\tstyle: any = {},\n) {\n\tconst { width = DEFAULT_WALL_WIDTH, height = DEFAULT_WALL_HEIGHT, color = 'gray', opacity = 1, altitude = 0 } = style;\n\n\tconst boundingBox = {\n\t\tmin: { x: Infinity, y: Infinity, z: altitude },\n\t\tmax: { x: -Infinity, y: -Infinity, z: altitude + height },\n\t};\n\n\tconst extrudeSettings = {\n\t\tbevelEnabled: false,\n\t\tdepth: height,\n\t};\n\n\tlet offsetter = new ClipperLib.ClipperOffset();\n\n\tconst cartesianCoordinates = feature.geometry.coordinates.map(coordinate => {\n\t\treturn coordinate.map(coordinate => {\n\t\t\treturn convertTo3DMapPosition(coordinate[1], coordinate[0]);\n\t\t});\n\t});\n\n\toffsetter.AddPaths(\n\t\tcartesianCoordinates.map(v => v.map(c => ({ X: c.x * QUALITY, Y: c.y * QUALITY }))),\n\t\tClipperLib.JoinType.jsMiter,\n\t\tClipperLib.EndType.etOpenRound,\n\t);\n\tlet polygons = new ClipperLib.PolyTree();\n\n\toffsetter.Execute(polygons, (width / 2) * QUALITY);\n\tconst geometries: ExtrudeGeometry[] = [];\n\n\tfor (const polygon of polygons.m_AllPolys) {\n\t\tconst shape = new Shape();\n\t\tif (polygon.IsHole()) {\n\t\t\tcontinue;\n\t\t}\n\t\tboundingBox.min.x = Math.min(boundingBox.min.x, polygon.m_polygon[0].X);\n\t\tboundingBox.min.y = Math.min(boundingBox.min.y, polygon.m_polygon[0].Y);\n\t\tboundingBox.max.x = Math.max(boundingBox.max.x, polygon.m_polygon[0].X);\n\t\tboundingBox.max.y = Math.max(boundingBox.max.y, polygon.m_polygon[0].Y);\n\t\tconst coords = polygon.m_polygon;\n\t\tshape.moveTo(coords[0].X / QUALITY, coords[0].Y / QUALITY);\n\t\tcoords.slice(1).forEach(coord => shape.lineTo(coord.X / QUALITY, coord.Y / QUALITY));\n\t\tshape.lineTo(coords[0].X / QUALITY, coords[0].Y / QUALITY);\n\n\t\tshape.holes = polygon.m_Childs.map(h => {\n\t\t\tconst path = new Path();\n\t\t\tconst coords = h.m_polygon;\n\t\t\tpath.moveTo(coords[0].X / QUALITY, coords[0].Y / QUALITY);\n\t\t\tcoords.slice(1).forEach(coord => path.lineTo(coord.X / QUALITY, coord.Y / QUALITY));\n\t\t\tpath.lineTo(coords[0].X / QUALITY, coords[0].Y / QUALITY);\n\n\t\t\treturn path;\n\t\t});\n\n\t\tgeometries.push(new ExtrudeGeometry(shape, extrudeSettings));\n\t}\n\n\tconst geometry = BufferGeometryUtils.mergeGeometries(geometries);\n\tgeometry.translate(0, 0, altitude || 0);\n\n\tgeometry.userData = {\n\t\tstyle: {\n\t\t\tcolor,\n\t\t\topacity,\n\t\t},\n\t};\n\n\toffsetter.Clear();\n\n\treturn geometry;\n}\n", "import type { Group, LineSegments, Material, Object3D, Plane } from 'three';\nimport { Color, InstancedMesh, MathUtils, Mesh, Vector3 } from 'three';\nimport type { BatchedStandardMaterial } from '../systems/mesh-creation-and-optimization/batched-material';\nimport type { Position, EntityId, ModelProperties, ModelGroupStyle } from '../types';\nimport type { Feature, FeatureCollection, Point } from 'geojson';\nimport type { Geometry3DObject3D } from '../entities/geometry3d';\nimport type { GeometryGroupState } from '../entities/geometry-group';\nimport { geoJSONPoint } from '../utils/schema-validation';\nimport { z } from 'zod';\nimport type { ModelStyle } from './styles';\nimport { interpolate } from '@packages/internal/common';\nimport { RENDER_LAYERS } from '../utils/constants';\n\n/**\n * State representing a Model, typically loaded via a URL\n */\nexport type ModelState = {\n\treadonly id: string;\n\treadonly type: 'model';\n\t/**\n\t * The parent container of the marker\n\t */\n\treadonly parent?: EntityId<GeometryGroupState> | string | number;\n\t/**\n\t * The position of the model in [lon, lat]\n\t */\n\treadonly position: Position;\n\t/**\n\t * Whether the model is interactive, which means it can be hovered over and clicked on.\n\t *\n\t * @example\n\t * ```javascript\n\t * \trenderer.on('click', ({ geometry }) => {});\n\t * ```\n\t */\n\tinteractive: boolean;\n} & Partial<Omit<ModelStyle, 'rotation' | 'scale'>> &\n\tPick<ModelStyle, 'rotation' | 'scale'>;\n\n/**\n * initialize model state\n * @interface\n */\nexport type InitializeModelState = Omit<Partial<ModelState>, 'id' | 'type' | 'parent' | 'position'>;\n\n/**\n * updatable model state\n * @interface\n */\nexport type UpdateModelState = Omit<InitializeModelState, 'url'> & {\n\tposition?: Position;\n};\n\nexport const modelPropertiesSchema = z.object({\n\trotation: z.array(z.number()).length(3).optional(), // Optional array of 3 numbers\n\taltitude: z.number().optional(), // Optional number\n\tscale: z.array(z.number()).length(3).optional(), // Optional array of 3 numbers\n\tinteractive: z.boolean().optional(), // Optional boolean\n\tverticalOffset: z.number().optional(),\n\tid: z.union([z.number(), z.string()]).optional(), // Assuming `idTest` is a custom validator, using `z.any()` as placeholder\n});\n\nexport const featureSchema = z.object({\n\ttype: z.enum(['Feature']), // Required string must be 'Feature'\n\tgeometry: geoJSONPoint, // Required geoJSONPoint schema\n\tproperties: modelPropertiesSchema, // Required modelPropertiesSchema\n});\n\nexport const addModelFeatureSchema = z.object({\n\ttype: z.enum(['FeatureCollection']), // Required string must be 'FeatureCollection'\n\tfeatures: z.array(featureSchema), // Required array of featureSchema\n});\n\nexport const MaterialStyleSchema = z.object({\n\tcolor: z.string(),\n});\n\nexport const modelGroupStyleSchema = z.object({\n\turl: z.string(), // Required string\n\tcolor: z.string().optional(), // Optional string\n\topacity: z.number().optional(), // Optional number\n\tmaterial: z.record(z.string(), MaterialStyleSchema).optional(), // Optional record of string and MaterialStyleSchema\n});\n\nexport function validateModelGroup(\n\tid: string | number,\n\tgeometry: FeatureCollection<Point, ModelProperties>,\n\tstyle: Partial<ModelGroupStyle>,\n) {\n\tz.union([z.number(), z.string()]).parse(id);\n\taddModelFeatureSchema.parse(geometry);\n\tmodelGroupStyleSchema.parse(style);\n}\n\nexport class ModelComponent {\n\t// Pointer to mesh for this component, which is either the mesh itself or a merged geometry mesh if this component was optimized\n\t// It can also be a GLTF Scene when loaded inline. see: https://mappedin.atlassian.net/wiki/spaces/SDK/pages/597983234/3D+Asset+Library#Deprecating-FeatureCollection-Support-when-Adding-Model\n\tmesh?: Geometry3DObject3D | Group;\n\treadonly type = 'model';\n\n\tpositionDirty = true;\n\n\t// Pointer to outline mesh for this component, again, either the outline mesh itself or a merged geometry mesh\n\toutline?: LineSegments;\n\n\tgeometry?: Object3D;\n\tmaterial?: BatchedStandardMaterial;\n\tfeature: Feature<Point, ModelProperties>;\n\n\tinstanceIndex?: number = -1;\n\n\tconstructor(feature: Feature<Point, ModelProperties>) {\n\t\tthis.feature = feature;\n\t}\n\n\t#visible = true;\n\tget visible() {\n\t\t// Return the mesh's visible state if it exists, otherwise return the stored value\n\t\treturn this.mesh?.visible ?? this.#visible;\n\t}\n\n\tset visible(value: boolean) {\n\t\tthis.#visible = value;\n\t\tif (this.mesh) {\n\t\t\tthis.mesh.visible = value;\n\t\t}\n\t}\n\n\tsetOpacity() {\n\t\t// TODO: implement\n\t}\n\n\tcolor: Color = new Color();\n\tsetColor() {\n\t\t// TODO: implement\n\t}\n\n\tclippingPlane?: Plane;\n\n\tposition = new Vector3();\n\n\t#altitude = 0;\n\tget altitude() {\n\t\treturn this.#altitude;\n\t}\n\n\tset altitude(value) {\n\t\tif (!this.mesh) {\n\t\t\treturn;\n\t\t}\n\t\tthis.mesh.position.z = value;\n\t\tthis.#altitude = value;\n\t}\n\n\tgetRotation() {\n\t\treturn this.mesh ? [this.mesh.rotation.x, this.mesh.rotation.y, this.mesh.rotation.z] : undefined;\n\t}\n\tsetRotation(value: [number, number, number]) {\n\t\tif (!this.mesh) return;\n\t\tthis.mesh.rotation.set(MathUtils.degToRad(value[0]), MathUtils.degToRad(value[1]), MathUtils.degToRad(value[2]));\n\t}\n\n\tgetScale() {\n\t\treturn this.mesh ? [this.mesh.scale.x, this.mesh.scale.y, this.mesh.scale.z] : undefined;\n\t}\n\tsetScale(value: [number, number, number]) {\n\t\tif (!this.mesh) return;\n\t\tthis.mesh.scale.set(value[0], value[1], value[2]);\n\t}\n\t#opacity = 1;\n\tget opacity() {\n\t\treturn this.#opacity;\n\t}\n\n\tset opacity(value) {\n\t\tif (!this.mesh) return;\n\t\tif (this.mesh.children[0] instanceof InstancedMesh) {\n\t\t\tfor (const child of this.mesh.children) {\n\t\t\t\tif (child instanceof InstancedMesh) {\n\t\t\t\t\t// if the instance already has opacity, we want to interpolate from that value, and not from 1\n\t\t\t\t\tif (child.userData?.originalOpacity === undefined) {\n\t\t\t\t\t\tchild.userData.originalOpacity = child.material.opacity;\n\t\t\t\t\t}\n\t\t\t\t\tconst targetOpacity = interpolate(value, 0, child.userData?.originalOpacity, 0, 1);\n\t\t\t\t\tchild.material.opacity = targetOpacity;\n\t\t\t\t\tchild.material.transparent = targetOpacity < 1;\n\t\t\t\t\tchild.material.needsUpdate = true;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.mesh?.traverse(child => {\n\t\t\t\tif (child instanceof Mesh && child.material) {\n\t\t\t\t\tif (Array.isArray(child.material)) {\n\t\t\t\t\t\tchild.material.forEach(material => {\n\t\t\t\t\t\t\tupdateMaterialOpacity(material, value);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tupdateMaterialOpacity(child.material, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tthis.#opacity = value;\n\t}\n\n\t#renderOrder = RENDER_LAYERS.GEOMETRY;\n\tget renderOrder() {\n\t\treturn this.#renderOrder;\n\t}\n\tset renderOrder(value: number) {\n\t\tif (!this.mesh || value === this.#renderOrder) return;\n\n\t\tthis.#renderOrder = value;\n\t\tif (this.mesh.children[0] instanceof InstancedMesh) {\n\t\t\t// Set render order on the parent mesh for instanced meshes\n\t\t\tthis.mesh.renderOrder = value;\n\t\t\tfor (const child of this.mesh.children) {\n\t\t\t\tif (child instanceof InstancedMesh) {\n\t\t\t\t\tchild.material.depthWrite = !this.#visibleThroughGeometry;\n\t\t\t\t\tchild.material.depthTest = !this.#visibleThroughGeometry;\n\t\t\t\t\tchild.material.needsUpdate = true;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.mesh?.traverse(child => {\n\t\t\t\tif (child instanceof Mesh && child.material) {\n\t\t\t\t\tchild.renderOrder = value;\n\t\t\t\t\tif (Array.isArray(child.material)) {\n\t\t\t\t\t\tchild.material.forEach(material => {\n\t\t\t\t\t\t\tmaterial.depthWrite = !this.#visibleThroughGeometry;\n\t\t\t\t\t\t\tmaterial.depthTest = !this.#visibleThroughGeometry;\n\t\t\t\t\t\t\tmaterial.needsUpdate = true;\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchild.material.depthWrite = !this.#visibleThroughGeometry;\n\t\t\t\t\t\tchild.material.depthTest = !this.#visibleThroughGeometry;\n\t\t\t\t\t\tchild.material.needsUpdate = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t#visibleThroughGeometry = false;\n\tget visibleThroughGeometry() {\n\t\treturn this.#visibleThroughGeometry;\n\t}\n\tset visibleThroughGeometry(value: boolean) {\n\t\tthis.#visibleThroughGeometry = value;\n\t\t// The actual render order assignment is handled by the RenderOrderSystem\n\t}\n}\n\nfunction updateMaterialOpacity(material: Material, opacity: number) {\n\tif (material.opacity === opacity) {\n\t\treturn;\n\t}\n\tif (opacity === 1) {\n\t\tmaterial.opacity = 1;\n\t\tmaterial.transparent = false;\n\t} else {\n\t\tmaterial.opacity = opacity;\n\t\tmaterial.transparent = true;\n\t}\n\tmaterial.needsUpdate = true;\n}\n", "import { z } from 'zod';\n\nexport const geoJSONPoint = z.object({\n\ttype: z.enum(['Point']), // Required enum with 'Point'\n\tcoordinates: z.array(z.number()).min(2).max(3), // Required array of numbers with 2 or 3 elements\n});\n", "import type { Vector3 } from 'three';\nimport { FrontSide, BackSide, Mesh, DoubleSide } from 'three';\nimport type { ModelGeometry3D } from '../../entities';\nimport { Geometry3DComponents } from '../../entities';\nimport type { MaterialSide, ModelStyle } from '../../components/styles';\nimport type { Position } from '../../renderer';\nimport { MeshComponent } from '../../components/mesh';\nimport type { BatchedStandardMaterial } from '../mesh-creation-and-optimization/batched-material';\nimport type { CustomGeometryComponent } from '../../components/custom';\n\nexport function applyModelGeometryStyle(model: ModelGeometry3D) {\n\tconst modelComp = model.components[Geometry3DComponents.Mesh];\n\tconst styleComponent = model.components[Geometry3DComponents.Style];\n\tif (styleComponent.opacity != null && styleComponent.opacity !== modelComp.opacity) {\n\t\tmodelComp.opacity = styleComponent.opacity;\n\t}\n\tconst materialStyle = styleComponent.material;\n\tconst color = styleComponent.color;\n\tif (materialStyle || color) {\n\t\tconst materialState = consolidateColorAndMaterial(color, materialStyle);\n\t\tmodelComp.mesh?.traverse(child => {\n\t\t\tif (child instanceof Mesh && child.material) {\n\t\t\t\tif (Array.isArray(child.material)) {\n\t\t\t\t\tchild.material.forEach(material => {\n\t\t\t\t\t\tif (materialState[material.name]) {\n\t\t\t\t\t\t\tmaterial.color.set(materialState[material.name].color);\n\t\t\t\t\t\t\t// Disable vertex colors when material-specific colors are provided\n\t\t\t\t\t\t\tmaterial.vertexColors = false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmaterial.color.set(color);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tif (materialState[child.material.name]) {\n\t\t\t\t\t\tchild.material.color.set(materialState[child.material.name].color);\n\t\t\t\t\t\t// Disable vertex colors when material-specific colors are provided\n\t\t\t\t\t\tchild.material.vertexColors = false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchild.material.color.set(color);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tconst meshPositionZOffset = modelComp.feature.geometry.coordinates[2] ?? 0;\n\tconst targetAltitude = styleComponent.verticalOffset + meshPositionZOffset;\n\tif (modelComp.altitude !== targetAltitude) {\n\t\tmodelComp.altitude = targetAltitude;\n\t}\n\n\tif (styleComponent.visible !== modelComp.visible) {\n\t\tmodelComp.visible = styleComponent.visible;\n\t}\n\tif (styleComponent.rotation) {\n\t\tmodelComp.setRotation(styleComponent.rotation);\n\t}\n\tif (styleComponent.scale) {\n\t\tmodelComp.setScale(styleComponent.scale);\n\t}\n\tif (styleComponent.visibleThroughGeometry !== modelComp.visibleThroughGeometry) {\n\t\tmodelComp.visibleThroughGeometry = styleComponent.visibleThroughGeometry;\n\t}\n}\n\n/**\n * consolidates the color update and material\n * color updates\n * @param color\n * @param materialOverwrite\n * @returns\n */\nexport function consolidateColorAndMaterial(\n\tcolor?: string,\n\tmaterialOverwrite?: ModelStyle['material'],\n): ModelStyle['material'] {\n\tconst update: ModelStyle['material'] = {};\n\n\t// Apply material-specific colors first (these take precedence)\n\tif (materialOverwrite) {\n\t\tfor (const name in materialOverwrite) {\n\t\t\tif (materialOverwrite[name].color) {\n\t\t\t\tupdate[name] = { color: materialOverwrite[name].color };\n\t\t\t}\n\t\t}\n\t}\n\n\t// Apply general color to default materials only if no material-specific color was provided\n\tif (color) {\n\t\tconst defaultMaterials = ['Default', 'Fabric', 'Mpdn_Logo', 'CouchLogo'];\n\t\tfor (const materialName of defaultMaterials) {\n\t\t\tif (!update[materialName]) {\n\t\t\t\tupdate[materialName] = { color };\n\t\t\t}\n\t\t}\n\t}\n\n\treturn update;\n}\n\nexport function applyModelPosition(model: ModelGeometry3D, convertTo3DMapPosition: (position: Position) => Vector3) {\n\tconst modelComp = model.components[Geometry3DComponents.Mesh];\n\tconst styleComponent = model.components[Geometry3DComponents.Style];\n\tconst verticalOffset = styleComponent.verticalOffset ?? 0;\n\tconst position = modelComp.feature.geometry.coordinates.slice() as Position;\n\tposition[2] = (position[2] ?? 0) + verticalOffset;\n\tif (modelComp.mesh) {\n\t\tmodelComp.mesh.position.copy(convertTo3DMapPosition(position));\n\t} else {\n\t\tmodelComp.position.copy(convertTo3DMapPosition(position));\n\t}\n}\n\nexport function getMaterial(meshComponent: MeshComponent | CustomGeometryComponent) {\n\tif (meshComponent instanceof MeshComponent) {\n\t\treturn meshComponent.material as BatchedStandardMaterial;\n\t}\n\treturn null;\n}\n\nexport function getMaterialSide(material: BatchedStandardMaterial) {\n\treturn material.side === BackSide ? 'back' : material.side === FrontSide ? 'front' : 'double';\n}\n\nexport function setMaterialSide(material: BatchedStandardMaterial, side: MaterialSide) {\n\tmaterial.side = side === 'back' ? BackSide : side === 'front' ? FrontSide : DoubleSide;\n}\n", "import type { RendererState } from '../../renderer';\nimport { MarkerComponent } from '../../components/marker';\nimport { Geometry2DComponents } from '../../entities/geometry2d';\nimport type { Entity2DHTMLDivElementContainer } from '../../types';\n\nexport class DOMVisibilitySystem {\n\tstate: RendererState;\n\tdirty = true;\n\tdomTree: Entity2DHTMLDivElementContainer;\n\tconstructor(state: RendererState, domTree: Entity2DHTMLDivElementContainer) {\n\t\tthis.state = state;\n\t\tthis.domTree = domTree;\n\t}\n\n\tupdate() {\n\t\tif (this.dirty) {\n\t\t\tlet entity;\n\n\t\t\tfor (const child of Array.from(this.domTree.children)) {\n\t\t\t\tentity = this.state.geometry2DMap.get(child.userData.entityId);\n\t\t\t\tif (entity) {\n\t\t\t\t\tconst component = entity.components[Geometry2DComponents.UI];\n\t\t\t\t\tif (\n\t\t\t\t\t\t!component.enabled ||\n\t\t\t\t\t\t!component.visible ||\n\t\t\t\t\t\t!this.state.geometry2DIdsInScene.has(child.userData.entityId)\n\t\t\t\t\t) {\n\t\t\t\t\t\tthis.domTree.removeChild(child);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.domTree.removeChild(child);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const entityId of this.state.geometry2DIdsInScene) {\n\t\t\t\tentity = this.state.geometry2DMap.get(entityId);\n\t\t\t\tif (entity) {\n\t\t\t\t\tconst component = entity.components[Geometry2DComponents.UI];\n\t\t\t\t\tif (component instanceof MarkerComponent) {\n\t\t\t\t\t\tif (component.enabled && component.markerContainer && !this.domTree.contains(component.markerContainer)) {\n\t\t\t\t\t\t\t// @TODO: remove in favor of attribute\n\t\t\t\t\t\t\tcomponent.markerContainer.userData = {\n\t\t\t\t\t\t\t\tentityId: entity.id,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tthis.domTree.appendChild(component.markerContainer);\n\t\t\t\t\t\t\tcomponent.updateDimensions();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.dirty = false;\n\t\t}\n\t}\n}\n", "import type { Vector2, Vector3 } from 'three';\nimport type { RendererState } from '../../renderer';\nimport { type Geometry2D, Geometry2DComponents } from '../../entities/geometry2d';\nimport { Geometry3D, Geometry3DComponents } from '../../entities';\nimport { type StyleComponent } from '../../components/styles/index';\nimport type LabelComponent from '../../components/label';\nimport type { MarkerComponent } from '../../components/marker';\n\nexport class TwoDProjectionSystem {\n\tstate: RendererState;\n\tproject: (projection: Vector2, position: Vector3) => void;\n\tconstructor(state: RendererState, project: (projection: Vector2, position: Vector3) => void) {\n\t\tthis.state = state;\n\t\tthis.project = project;\n\t}\n\n\tupdate() {\n\t\tlet entity: Geometry2D;\n\t\tlet height = 0;\n\t\tlet altitude = 0;\n\t\tlet attachedEntityStyle: StyleComponent;\n\t\tlet component: LabelComponent | MarkerComponent;\n\t\tfor (const entityId of this.state.geometry2DIdsInScene) {\n\t\t\tentity = this.state.geometry2DMap.get(entityId) as Geometry2D;\n\t\t\tif (entity) {\n\t\t\t\tcomponent = entity.components[Geometry2DComponents.UI];\n\t\t\t\t// find the geometry3D that this is attached to\n\t\t\t\tconst attachedEntity = entity.attachedTo ? this.state.geometry3DMap.get(entity.attachedTo) : undefined;\n\t\t\t\t// if the entity is a geometry3D, then we can use the style of the entity to set the height, opacity, and visible of the 2D entity\n\t\t\t\tif (attachedEntity instanceof Geometry3D) {\n\t\t\t\t\tif (this.state.geometry3DIdsInScene.has(attachedEntity.id)) {\n\t\t\t\t\t\tattachedEntityStyle = attachedEntity.components[Geometry3DComponents.Style] as StyleComponent;\n\t\t\t\t\t\tcomponent = entity.components[Geometry2DComponents.UI];\n\t\t\t\t\t\tif (attachedEntityStyle.dirty || entity.components[Geometry2DComponents.UI].attachedDirty) {\n\t\t\t\t\t\t\theight = attachedEntityStyle.height;\n\t\t\t\t\t\t\taltitude = attachedEntityStyle.altitude;\n\t\t\t\t\t\t\tentity.setAltitude(height + altitude);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// attached entity is in the scene, but it could be hidden\n\t\t\t\t\t\tconst shouldBeVisible = attachedEntityStyle.visible;\n\t\t\t\t\t\tif (component.visible !== shouldBeVisible) {\n\t\t\t\t\t\t\tcomponent.visible = shouldBeVisible;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (component.visible === true) {\n\t\t\t\t\t\t// attached entity is not in the scene, hide the attached 2D entity\n\t\t\t\t\t\tcomponent.visible = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.project(entity.components[Geometry2DComponents.UI].projection, entity.position);\n\t\t\t\tentity.components[Geometry2DComponents.UI].attachedDirty = false;\n\t\t\t}\n\t\t}\n\t}\n}\n", "import type { RendererState, TransformImageRequest } from '../../renderer';\nimport { shaveText } from '@packages/internal/shave-text';\nimport { cyrb53, shouldDisableOffscreenCanvas } from '../../utils';\nimport LabelComponent from '../../components/label';\nimport { Geometry2DComponents } from '../../entities/geometry2d';\nimport { createImage } from './utils';\nimport { interpolateMulti, Logger, PubSub, round } from '@packages/internal/common';\nimport {\n\tINACTIVE_PIN_SIZE_NO_ICON,\n\tPIN_SHADOW_BLUR,\n\tPIN_SHADOW_OFFSET,\n\tPIN_STROKE_SIZE,\n\tPINVISIBILITY,\n\tTEXTALIGN,\n\tTEXT_STROKE_SIZE,\n} from './constants';\n\nexport class TwoDDrawSystem extends PubSub<{ 'img:loaded': undefined }> {\n\t// does a complete redraw of the 2d scene\n\tdirty = false;\n\tstate: RendererState;\n\tcolliderContext: CanvasRenderingContext2D;\n\tcolliderCanvas: HTMLCanvasElement;\n\ttransformRequestFunc?: TransformImageRequest;\n\tconstructor(state: RendererState, colliderCanvas: HTMLCanvasElement, transformImageRequest?: TransformImageRequest) {\n\t\tsuper();\n\t\tthis.state = state;\n\t\tthis.colliderCanvas = colliderCanvas;\n\t\t// new WebGL2D(colliderCanvas);\n\t\tthis.colliderContext = colliderCanvas.getContext('2d')!;\n\t\tthis.transformRequestFunc = transformImageRequest;\n\t}\n\n\ttransformRequest = async (url: string) => {\n\t\tif (this.transformRequestFunc) {\n\t\t\treturn await this.transformRequestFunc(url);\n\t\t}\n\n\t\treturn { url };\n\t};\n\n\tpinCache: {\n\t\t[key in number]: [HTMLCanvasElement | OffscreenCanvas, HTMLCanvasElement | OffscreenCanvas];\n\t} = {};\n\n\t/** Stores the loaded images ready to be drawn. */\n\timageCache: {\n\t\t[key in number]: HTMLImageElement | ImageBitmap;\n\t} = {};\n\n\t/** Stores the promises for each image fetch. */\n\timagePromiseCache: {\n\t\t[key in number]: Promise<HTMLImageElement | ImageBitmap>;\n\t} = {};\n\n\timageDimensionsCache: {\n\t\t[key in number]: { width: number; height: number };\n\t} = {};\n\n\ttextCache: {\n\t\t// component id\n\t\t[key in string]: {\n\t\t\tleft?: OffscreenCanvas | HTMLCanvasElement;\n\t\t\tcenter?: OffscreenCanvas | HTMLCanvasElement;\n\t\t\tright?: OffscreenCanvas | HTMLCanvasElement;\n\t\t};\n\t} = {};\n\n\tupdate = (zoomLevel: number) => {\n\t\tconst pixelRatio = this.state.pixelRatio;\n\n\t\tthis.colliderContext.clearRect(0, 0, this.colliderCanvas.width, this.colliderCanvas.height);\n\t\tlet labelCacheId: string;\n\t\tlet foregroundColor: { active: string; inactive: string };\n\t\tlet backgroundColor: { active: string; inactive: string };\n\t\tlet pinSize: number;\n\t\tlet iconVisible: boolean | number | undefined;\n\t\tlet component: LabelComponent;\n\n\t\tlet entity;\n\n\t\tfor (const entityId of this.state.geometry2DIdsInScene) {\n\t\t\tentity = this.state.geometry2DMap.get(entityId);\n\t\t\tif (entity == null) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tcomponent = entity.components[Geometry2DComponents.UI];\n\n\t\t\tif (component instanceof LabelComponent && !entity.disposed) {\n\t\t\t\ticonVisible = component.appearance.iconVisible;\n\t\t\t\tif (component.appearance.icon != null && iconVisible != null) {\n\t\t\t\t\t// Determine if icon should be visible based on type\n\t\t\t\t\tconst shouldBeVisible = typeof iconVisible === 'boolean' ? iconVisible : zoomLevel >= iconVisible;\n\n\t\t\t\t\tif (shouldBeVisible !== component.iconVisible) {\n\t\t\t\t\t\t// If the icon visibility changed the components size recalculation and re-drawing\n\t\t\t\t\t\tcomponent.iconVisible = shouldBeVisible;\n\t\t\t\t\t\tcomponent.dirty = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (component.dirty || this.dirty) {\n\t\t\t\t\t// If the component is dirty, we need to update the zoom proportion and calculate the pin size.\n\t\t\t\t\t// All the following logic relies on the pin size being up to date.\n\t\t\t\t\tcomponent.calculatePinSize();\n\t\t\t\t}\n\n\t\t\t\tforegroundColor = { active: component.appearance.pinColor, inactive: component.appearance.pinColorInactive };\n\t\t\t\tbackgroundColor = {\n\t\t\t\t\tactive: component.appearance.pinOutlineColor,\n\t\t\t\t\tinactive: component.appearance.pinOutlineColorInactive,\n\t\t\t\t};\n\t\t\t\t// Round the pin size to 2 decimal places to avoid cache misses\n\t\t\t\tpinSize = round(component.pinSize, 2);\n\t\t\t\tlabelCacheId = `${foregroundColor.active}-${foregroundColor.inactive}-${backgroundColor.active}-${backgroundColor.inactive}-${pinSize}-${component.iconVisible}`;\n\n\t\t\t\tcomponent.labelCacheId = labelCacheId;\n\n\t\t\t\tif (!this.pinCache[labelCacheId] || this.dirty) {\n\t\t\t\t\tthis.prepare(component, labelCacheId, this.colliderContext);\n\t\t\t\t\tcomponent.dirty = true;\n\t\t\t\t}\n\n\t\t\t\tif ((component.appearance.icon && (!component.imageHash || component.pinDirty)) || this.dirty) {\n\t\t\t\t\tthis.cacheImage(component);\n\t\t\t\t}\n\n\t\t\t\tif (this.textCache[component.id] == null || component.textDirty || this.dirty) {\n\t\t\t\t\tcomponent.dirty = true;\n\t\t\t\t\tthis.textCache[component.id] = {};\n\n\t\t\t\t\tconst { textDrawFn, width, height } = this.processText(\n\t\t\t\t\t\tcomponent.text,\n\t\t\t\t\t\tcomponent.appearance.textSize,\n\t\t\t\t\t\tcomponent.appearance.maxWidth,\n\t\t\t\t\t\tcomponent.appearance.maxLines,\n\t\t\t\t\t\tcomponent.appearance.lineHeight,\n\t\t\t\t\t);\n\t\t\t\t\t[TEXTALIGN.LEFT, TEXTALIGN.CENTER, TEXTALIGN.RIGHT].forEach((textAlign: TEXTALIGN) => {\n\t\t\t\t\t\tthis.textCache[component.id][textAlign] = this.textToCanvas(\n\t\t\t\t\t\t\ttextDrawFn,\n\t\t\t\t\t\t\tcomponent.appearance.textSize,\n\t\t\t\t\t\t\ttextAlign,\n\t\t\t\t\t\t\twidth,\n\t\t\t\t\t\t\theight,\n\t\t\t\t\t\t\tcomponent.appearance.textColor,\n\t\t\t\t\t\t\tcomponent.appearance.textOutlineColor,\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t\tcomponent.dimensions = {\n\t\t\t\t\t\twidth: Math.ceil(width / pixelRatio),\n\t\t\t\t\t\theight: Math.ceil(height / pixelRatio),\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// had to move this logic here, because the icon scale will affect collisons even when a label was hidden\n\t\t\t\t// otherwise it causes overlap\n\t\t\t\t// [TODO]: redo the whole dirty logic as it keeps breaking\n\t\t\t\tlet iconScale = 1;\n\n\t\t\t\tif (component.appearance.iconScale) {\n\t\t\t\t\tif (typeof component.appearance.iconScale === 'number') {\n\t\t\t\t\t\ticonScale = component.appearance.iconScale;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst { on, input, output, easing } = component.appearance.iconScale;\n\t\t\t\t\t\tif (on === 'zoom-level') {\n\t\t\t\t\t\t\ticonScale = interpolateMulti(zoomLevel, input, output, easing ?? 'linear');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tLogger.warn(`Unsupported interpolation property: ${on}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcomponent.recomputeCurrentStrategy(component.iconVisible ? iconScale : 1);\n\n\t\t\t\tif (\n\t\t\t\t\tcomponent.canShow &&\n\t\t\t\t\tcomponent.visible &&\n\t\t\t\t\t(component.enabled || component.visibilityNeedsUpdate !== false)\n\t\t\t\t) {\n\t\t\t\t\tthis.draw(component, labelCacheId, this.colliderContext);\n\t\t\t\t}\n\n\t\t\t\tcomponent.textDirty = false;\n\t\t\t\tcomponent.pinDirty = false;\n\t\t\t}\n\t\t}\n\t\tthis.dirty = false;\n\t};\n\n\tprocessText = (text: string, size: number, maxWidth: number, maxLines: number, lineHeight: number) => {\n\t\tconst pixelRatio = this.state.pixelRatio;\n\t\tconst {\n\t\t\tdraw,\n\t\t\tmaxWidth: width,\n\t\t\tmaxHeight: height,\n\t\t} = shaveText({ text, size, pixelRatio, maxWidth, maxLines, lineHeight });\n\n\t\treturn {\n\t\t\ttextDrawFn: draw,\n\t\t\twidth: width + TEXT_STROKE_SIZE * pixelRatio * 2,\n\t\t\theight: height + TEXT_STROKE_SIZE * pixelRatio * 2,\n\t\t};\n\t};\n\n\ttextToCanvas = (\n\t\ttextDrawFn: (ctx: CanvasRenderingContext2D, x: number, y: number) => void,\n\t\tsize: number,\n\t\ttextAlign: TEXTALIGN,\n\t\twidth: number,\n\t\theight: number,\n\t\tforegroundColor: string,\n\t\tbackgroundColor: string,\n\t) => {\n\t\tconst pixelRatio = this.state.pixelRatio;\n\t\tlet cacheCanvas;\n\t\tconst bboxWidth = width;\n\t\tconst bboxHeight = height;\n\n\t\t/**\n\t\t * In order to ensure the integrated intel GPU render text correctly, we need `willReadFrequently` flag. However, only Firefox browser <OffscreenCanvas /> implementated this flag, so we should fallback to using regular canvas for the problematic GPUs.\n\t\t * See: https://mappedin.atlassian.net/browse/SDKS-1488\n\t\t */\n\t\tif (window.OffscreenCanvas != null && !shouldDisableOffscreenCanvas()) {\n\t\t\tcacheCanvas = new OffscreenCanvas(bboxWidth, bboxHeight);\n\t\t} else {\n\t\t\tcacheCanvas = document.createElement('canvas');\n\t\t\tcacheCanvas.width = bboxWidth;\n\t\t\tcacheCanvas.height = bboxHeight;\n\t\t\tcacheCanvas.style.width = bboxWidth + 'px';\n\t\t\tcacheCanvas.style.height = bboxHeight + 'px';\n\t\t}\n\n\t\t/**\n\t\t * Enable `willReadFrequently` to hint to the browser that this canvas will be read from frequently. This achieves two goals:\n\t\t * 1. It improves read performance by sacrificing write performance. This trade off is fine for us since we don't rerender the canvas at all.\n\t\t * 2. It fixes an issue with some Intel GPU rendering canvas2D being distorted. see: https://mappedin.atlassian.net/browse/SDKS-1488\n\t\t */\n\t\tconst ctx: CanvasRenderingContext2D = cacheCanvas.getContext('2d', { willReadFrequently: true });\n\t\tif (!ctx) return;\n\n\t\tconst strokeSize = TEXT_STROKE_SIZE * pixelRatio;\n\n\t\tctx.textAlign = textAlign as CanvasTextAlign;\n\t\tctx.font = `bold ${size * pixelRatio}px 'InterUI-Regular', Helvetica Neue, Arial, sans-serif`;\n\t\t// these two lines fix text bleeding issues in W's\n\t\tctx.textBaseline = 'middle';\n\t\tctx.lineJoin = 'miter';\n\t\tctx.miterLimit = 2;\n\t\tctx.strokeStyle = 'white';\n\t\tctx.lineWidth = strokeSize;\n\t\t// DEBUG\n\t\t// ctx.fillStyle = 'rgba(255, 0, 0, 0.5)';\n\t\t// ctx.fillRect(0, 0, bboxWidth, bboxHeight);\n\t\t// END DEBUG\n\t\tctx.fillStyle = foregroundColor;\n\t\tctx.strokeStyle = backgroundColor;\n\n\t\tconst xOffset =\n\t\t\ttextAlign === TEXTALIGN.LEFT\n\t\t\t\t? // Even when text is left-aligned, make sure to add a small buffer for the stroke\n\t\t\t\t  strokeSize / 2\n\t\t\t\t: textAlign === TEXTALIGN.CENTER\n\t\t\t\t? bboxWidth / 2\n\t\t\t\t: bboxWidth - strokeSize / 2;\n\n\t\ttextDrawFn(ctx, xOffset, (bboxHeight + strokeSize / 2) / 2);\n\n\t\treturn cacheCanvas;\n\t};\n\n\tcacheImage = (label: LabelComponent) => {\n\t\tif (!label.appearance.icon) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst imageHash = cyrb53(label.appearance.icon);\n\t\t// index promises by imageHash, which ensures we only process each image once\n\t\t// the promise is resolved when the image has been processed\n\t\tif (!this.imagePromiseCache[imageHash]) {\n\t\t\t// Load images asynchronously. We do this so we can fetch and append a new sas token if needed.\n\t\t\tthis.imagePromiseCache[imageHash] = new Promise(resolve => {\n\t\t\t\tthis.transformRequest(label.appearance.icon!).then(res => {\n\t\t\t\t\tconst img = createImage(res.url);\n\t\t\t\t\timg.onload = () => {\n\t\t\t\t\t\tthis.imageCache[imageHash] = img;\n\t\t\t\t\t\tthis.publish('img:loaded');\n\t\t\t\t\t\tresolve(img);\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t// Once the image is loaded, set the label as dirty so its size will be recalculated\n\t\tif (label.imageHash !== imageHash) {\n\t\t\tlabel.imageHash = imageHash;\n\t\t\tthis.imagePromiseCache[imageHash].then(() => {\n\t\t\t\tlabel.dirty = true;\n\t\t\t});\n\t\t}\n\t};\n\n\tcreatePinCanvas = (\n\t\tlabel: LabelComponent,\n\t\tpinSize: number,\n\t\tbackgroundColor: string,\n\t\tforegroundColor: string,\n\t\tmaxIconScale = 1,\n\t) => {\n\t\tlet cacheCanvas: OffscreenCanvas | HTMLCanvasElement;\n\t\tconst pixelRatio = this.state.pixelRatio;\n\n\t\t// we need to create a canvas which will contain the PIN, along with it's shadow\n\t\t// so it needs to be bigger than the pin\n\n\t\t// let's scale the canvas size by the maxIconScale so it doesn't get blurry when the icon is scaled up\n\t\tconst canvasSize = label.totalPinSize * 2 * pixelRatio * maxIconScale;\n\n\t\tif (window.OffscreenCanvas != null) {\n\t\t\tcacheCanvas = new OffscreenCanvas(canvasSize, canvasSize);\n\t\t} else {\n\t\t\tcacheCanvas = document.createElement('canvas');\n\t\t\tcacheCanvas.width = canvasSize;\n\t\t\tcacheCanvas.height = canvasSize;\n\t\t\tcacheCanvas.style.width = canvasSize / pixelRatio + 'px';\n\t\t\tcacheCanvas.style.height = canvasSize / pixelRatio + 'px';\n\t\t}\n\t\tconst cacheCanvasContext = cacheCanvas.getContext('2d') as\n\t\t\t| OffscreenCanvasRenderingContext2D\n\t\t\t| CanvasRenderingContext2D;\n\n\t\tcacheCanvasContext.shadowColor = `rgba(0,0,0,0.3)`;\n\t\tcacheCanvasContext.shadowOffsetY = PIN_SHADOW_OFFSET * pixelRatio;\n\t\tcacheCanvasContext.shadowBlur = PIN_SHADOW_BLUR * pixelRatio;\n\t\tcacheCanvasContext.beginPath();\n\n\t\t// draw the pin starting in the center of the canvas\n\t\tcacheCanvasContext.arc(\n\t\t\tcanvasSize / 2,\n\t\t\tcanvasSize / 2,\n\t\t\t// use dotSize + an offset to make the bottom layer bigger\n\t\t\t(pinSize / 2 + (PIN_STROKE_SIZE * pixelRatio) / 2) * maxIconScale,\n\t\t\t0,\n\t\t\t2 * Math.PI,\n\t\t);\n\n\t\tcacheCanvasContext.fillStyle = backgroundColor;\n\t\tcacheCanvasContext.fill();\n\n\t\tcacheCanvasContext.beginPath();\n\t\tcacheCanvasContext.arc(canvasSize / 2, canvasSize / 2, (pinSize / 2) * maxIconScale, 0, 2 * Math.PI);\n\n\t\tcacheCanvasContext.shadowColor = 'transparent';\n\t\tcacheCanvasContext.fillStyle = foregroundColor;\n\t\tcacheCanvasContext.fill();\n\n\t\treturn cacheCanvas;\n\t};\n\n\tprepare = (label: LabelComponent, labelCacheId: string, context: CanvasRenderingContext2D) => {\n\t\tconst pixelRatio = this.state.pixelRatio;\n\t\tcontext.lineWidth = 4 * pixelRatio;\n\t\tconst scales =\n\t\t\ttypeof label.appearance.iconScale === 'number'\n\t\t\t\t? [label.appearance.iconScale]\n\t\t\t\t: label.appearance.iconScale == null\n\t\t\t\t? []\n\t\t\t\t: label.appearance.iconScale.output;\n\t\tconst maxScale = scales.length > 0 ? Math.max(...scales) : undefined;\n\t\t// cache the active dot, with background and foreground color\n\t\tconst activeContext = this.createPinCanvas(\n\t\t\tlabel,\n\t\t\tlabel.pinSize,\n\t\t\tlabel.appearance.pinOutlineColor,\n\t\t\tlabel.appearance.pinColor,\n\t\t\tmaxScale,\n\t\t);\n\n\t\t// cache the inactive dot, with background and foreground color\n\t\tconst inactiveContext = this.createPinCanvas(\n\t\t\tlabel,\n\t\t\tINACTIVE_PIN_SIZE_NO_ICON * pixelRatio,\n\t\t\tlabel.appearance.pinOutlineColorInactive,\n\t\t\tlabel.appearance.pinColorInactive,\n\t\t\tmaxScale,\n\t\t);\n\n\t\tthis.pinCache[labelCacheId] = [activeContext, inactiveContext];\n\t};\n\n\tdraw(label: LabelComponent, labelCacheId: string, context: CanvasRenderingContext2D) {\n\t\t// if we're not visible, don't draw the label at all\n\t\tif (!label.canShow || !label.visible) {\n\t\t\treturn;\n\t\t}\n\n\t\tcontext.save();\n\t\tcontext.globalAlpha = label.currentOpacity;\n\n\t\tconst pixelRatio = this.state.pixelRatio;\n\n\t\tconst dpX = label.projection.x * pixelRatio;\n\t\tconst dpY = label.projection.y * pixelRatio;\n\n\t\t// generate a cache id using colors and size\n\t\tconst imageToDraw =\n\t\t\tlabel.style.pinVisibility === PINVISIBILITY.ACTIVE\n\t\t\t\t? this.pinCache[labelCacheId][0]\n\t\t\t\t: this.pinCache[labelCacheId][1];\n\n\t\t// For inactive/hidden pins, use fixed size since they don't scale\n\t\t// For active pins, use scaled size for proper zoom/icon scaling\n\t\tconst drawSize =\n\t\t\tlabel.style.pinVisibility === PINVISIBILITY.ACTIVE\n\t\t\t\t? label.scaledPinSize * pixelRatio\n\t\t\t\t: label.totalPinSize * pixelRatio;\n\n\t\t// If the pin is hidden, skip drawing.\n\t\t// Image should only draw if it's active\n\t\tif (label.style.pinVisibility !== PINVISIBILITY.HIDDEN) {\n\t\t\tcontext.drawImage(imageToDraw, dpX - drawSize, dpY - drawSize, drawSize * 2, drawSize * 2);\n\t\t}\n\n\t\tif (\n\t\t\tlabel.appearance.icon &&\n\t\t\tlabel.iconVisible &&\n\t\t\tlabel.imageHash &&\n\t\t\tlabel.appearance.iconSize &&\n\t\t\tthis.imageCache[label.imageHash!] &&\n\t\t\tlabel.style.pinVisibility === PINVISIBILITY.ACTIVE\n\t\t) {\n\t\t\tconst img = this.imageCache[label.imageHash];\n\t\t\tconst circleDiameter = (label.scaledPinSize - label.scaledIconPadding) * pixelRatio;\n\t\t\tconst iconFit = label.appearance.iconFit;\n\n\t\t\t// iconFit === 'fill'. Does not maintain aspect ratio, fills circle\n\t\t\tlet scaledWidth = circleDiameter;\n\t\t\tlet scaledHeight = circleDiameter;\n\n\t\t\tconst iconFitCache = `${label.imageHash!}_${iconFit}`;\n\t\t\tif (this.imageDimensionsCache[iconFitCache]) {\n\t\t\t\tscaledWidth = this.imageDimensionsCache[iconFitCache].width;\n\t\t\t\tscaledHeight = this.imageDimensionsCache[iconFitCache].height;\n\t\t\t} else {\n\t\t\t\tconst imgWidth = img.width * pixelRatio;\n\t\t\t\tconst imgHeight = img.height * pixelRatio;\n\n\t\t\t\t// Maintains aspect ratio, scaled down\n\t\t\t\tif (iconFit === 'contain') {\n\t\t\t\t\tconst imgDiagonal = Math.sqrt(imgWidth ** 2 + imgHeight ** 2);\n\t\t\t\t\tconst scale = circleDiameter / imgDiagonal;\n\t\t\t\t\tscaledWidth = imgWidth * scale;\n\t\t\t\t\tscaledHeight = imgHeight * scale;\n\t\t\t\t}\n\n\t\t\t\t// Maintains aspect ratio, fills circle\n\t\t\t\tif (iconFit === 'cover') {\n\t\t\t\t\tconst scaleByWidth = circleDiameter / imgWidth;\n\t\t\t\t\tconst scaleByHeight = circleDiameter / imgHeight;\n\t\t\t\t\tconst scale = Math.max(scaleByWidth, scaleByHeight);\n\t\t\t\t\tscaledWidth = imgWidth * scale;\n\t\t\t\t\tscaledHeight = imgHeight * scale;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcontext.save();\n\t\t\tcontext.beginPath();\n\t\t\tcontext.arc(dpX, dpY, circleDiameter / 2, 0, 2 * Math.PI);\n\t\t\tcontext.closePath();\n\t\t\tif (label?.appearance?.iconOverflow !== 'visible') context.clip();\n\t\t\tcontext.drawImage(img, dpX - scaledWidth / 2, dpY - scaledHeight / 2, scaledWidth, scaledHeight);\n\t\t\tcontext.restore();\n\t\t}\n\n\t\t// draw text\n\t\tif (\n\t\t\tlabel.style.textLabelVisible &&\n\t\t\tlabel.style.textAlign != null &&\n\t\t\tlabel.style.left != null &&\n\t\t\tlabel.style.top != null\n\t\t) {\n\t\t\tcontext.drawImage(\n\t\t\t\tthis.textCache[label.id][label.style.textAlign] as CanvasImageSource,\n\t\t\t\tdpX + label.style.left * pixelRatio,\n\t\t\t\tdpY + label.style.top * pixelRatio,\n\t\t\t);\n\t\t}\n\n\t\tcontext.restore();\n\t}\n}\n", "export * from './shave-text';\n", "export type TDrawFn = (ctx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D, x: number, y: number) => void;\n\ntype TShave = (options: {\n\ttext: string;\n\tsize: number;\n\tmaxWidth: number;\n\tpixelRatio: number;\n\tmaxLines?: number;\n\tlineHeight?: number;\n\toptions?: {\n\t\tstrokeText: boolean;\n\t};\n}) => // maxHeight: number\n{\n\tmaxWidth: number;\n\tmaxHeight: number;\n\tlines: number;\n\tdraw: TDrawFn;\n};\n\nexport const getMeasureCanvas = (function createMeasureCanvasContext() {\n\tlet measureCanvas: HTMLCanvasElement | undefined;\n\tlet measureCanvasContext: CanvasRenderingContext2D | undefined | null;\n\n\treturn (pixelRatio: number) => {\n\t\tif (!measureCanvasContext || !measureCanvasContext) {\n\t\t\tmeasureCanvas = document.createElement('canvas');\n\t\t\tmeasureCanvas.width = 500 * pixelRatio;\n\t\t\tmeasureCanvas.height = 500 * pixelRatio;\n\t\t\tmeasureCanvas.style.width = '500px';\n\t\t\tmeasureCanvas.style.height = '500px';\n\t\t\tmeasureCanvasContext = measureCanvas.getContext('2d');\n\t\t}\n\t\tif (!measureCanvasContext) {\n\t\t\tthrow new Error('Could not get 2D context');\n\t\t}\n\n\t\treturn {\n\t\t\tmeasureCanvas,\n\t\t\tmeasureCanvasContext,\n\t\t};\n\t};\n})();\n\nexport const shaveText: TShave = ({\n\ttext,\n\tsize,\n\tmaxWidth,\n\tpixelRatio,\n\tmaxLines = 2,\n\tlineHeight = 1.2,\n\toptions = { strokeText: true },\n}) => {\n\tconst font = `bold ${size * pixelRatio}px 'InterUI-Regular', Helvetica Neue, Arial, sans-serif`;\n\n\tconst { measureCanvasContext } = getMeasureCanvas(pixelRatio);\n\n\tmeasureCanvasContext.font = font;\n\n\tconst lines: string[] = [];\n\n\tconst words: string[] = text.split(' ');\n\tlet linePtr = 0;\n\tlet wordPtr = 0;\n\n\tlet maxTextWidth = 0;\n\t// go through each word\n\n\twhile (wordPtr < words.length) {\n\t\tconst word = words[wordPtr];\n\n\t\t// if we exceed the allowed number of lines, append ... and quit\n\t\tif (linePtr === maxLines && linePtr > 0) {\n\t\t\tlines[linePtr - 1] += '...';\n\t\t\tbreak;\n\t\t}\n\n\t\t// if the current line is empty, append the current word\n\t\tif (lines[linePtr] == null) {\n\t\t\tlines[linePtr] = word;\n\t\t\twordPtr++;\n\t\t}\n\n\t\tif (words.length === 1) {\n\t\t\tlines[linePtr] = word;\n\t\t\tbreak;\n\t\t}\n\n\t\t// if we have no more words, quit\n\t\tif (words[wordPtr] == null) {\n\t\t\tbreak;\n\t\t}\n\n\t\t// see if what's currently on this line plus the next word fits within maxWidth bounds\n\t\tconst { width } = measureCanvasContext.measureText(lines[linePtr] + ' ' + words[wordPtr]);\n\n\t\tif (width <= maxWidth * pixelRatio) {\n\t\t\t// if it does, append the word to the current line\n\t\t\tlines[linePtr] += ' ' + words[wordPtr];\n\t\t\twordPtr++;\n\t\t} else {\n\t\t\t// otherwise, move on to the next line\n\t\t\tlinePtr++;\n\t\t}\n\t}\n\n\t// find the widest line\n\tlines.forEach(l => {\n\t\tconst { width } = measureCanvasContext.measureText(l);\n\n\t\tmaxTextWidth = Math.max(width, maxTextWidth);\n\t});\n\n\tconst lineHeightPx = size * pixelRatio * lineHeight;\n\n\tconst maxHeight = lines.length * lineHeightPx;\n\n\tconst result = {\n\t\tmaxWidth: maxTextWidth,\n\t\tmaxHeight,\n\t\tlines: lines.length,\n\t\tdraw: (context, x, y) => {\n\t\t\t// TODO: cleanup at some point and implement more than 2 lines of shave\n\t\t\t// The idea here is to vertically center single line or double line text,\n\t\t\t// With single line text, we render it at 0, 0\n\t\t\t// and two lines, each line gets rendered lineHeight away from the next, while maintaing vertical center to Y\n\t\t\tif (lines.length === 1) {\n\t\t\t\tif (options.strokeText) {\n\t\t\t\t\tcontext.strokeText(lines[0], x, y);\n\t\t\t\t}\n\t\t\t\tcontext.fillText(lines[0], x, y);\n\t\t\t} else {\n\t\t\t\tif (options.strokeText) {\n\t\t\t\t\tcontext.strokeText(lines[0], x, y - lineHeightPx / 2);\n\t\t\t\t\tcontext.strokeText(lines[1], x, y + lineHeightPx / 2);\n\t\t\t\t}\n\t\t\t\tcontext.fillText(lines[0], x, y - lineHeightPx / 2);\n\t\t\t\tcontext.fillText(lines[1], x, y + lineHeightPx / 2);\n\t\t\t}\n\t\t},\n\t};\n\n\treturn result;\n};\n", "export function createImage(icon: string) {\n\tconst img = new Image();\n\tif (icon) {\n\t\t// This regex detects SVG content by looking for an <svg> tag anywhere in the string.\n\t\t// - <svg: Matches the opening SVG tag\n\t\t// - [\\s\\S]*: Matches any character including newlines\n\t\t// - >: Matches the closing bracket of the tag\n\t\t// - i flag: Makes the match case-insensitive\n\t\t// This pattern will match SVGs even when they have XML declarations or comments before the SVG tag.\n\t\tconst isInlineSvg = /<svg[\\s\\S]*>/i.test(icon);\n\t\tif (isInlineSvg) {\n\t\t\timg.src = `data:image/svg+xml;base64,${btoa(icon)}`;\n\t\t} else {\n\t\t\timg.src = icon;\n\t\t}\n\t}\n\n\treturn img;\n}\n", "import { Geometry3DComponents, type Geometry3D } from '../../entities/geometry3d';\nimport { MeshComponent } from '../../components/mesh';\nimport type { EntityTypes, Position, RendererState } from '../../renderer';\nimport type { InteractionComponent } from '../../components/interaction';\nimport type { Vector3 } from 'three';\nimport { DEFAULT_TEXT_STYLE } from '../../components/styles';\nimport type { Text3DStyleComponent } from '../../components/styles';\nimport { applyModelGeometryStyle, applyModelPosition, getMaterial, getMaterialSide, setMaterialSide } from './utils';\nimport { getGroupContainerOpacity } from '../../utils';\nimport { TextureComponent } from '../../components/texture';\n\nfunction processColor(entity: Geometry3D, globalHoverColor: string) {\n\tconst interactionComponent = entity.components[Geometry3DComponents.Interaction];\n\tconst styleComponent = entity.components[Geometry3DComponents.Style];\n\n\t// if we have a hover, return that\n\tif (interactionComponent?.hover) {\n\t\treturn [styleComponent.hoverColor || globalHoverColor, styleComponent.hoverColor || globalHoverColor];\n\t}\n\n\treturn [styleComponent.color, styleComponent.topColor || styleComponent.color];\n}\n\nexport class DrawSystem {\n\tstate: RendererState;\n\tconvertTo3DMapPosition: (position: Position) => Vector3;\n\tconstructor(state: RendererState, convertTo3DMapPosition: (position: Position) => Vector3) {\n\t\tthis.convertTo3DMapPosition = convertTo3DMapPosition;\n\t\tthis.state = state;\n\t}\n\n\tdetermineTextureVisiblity(\n\t\tmeshComponent: MeshComponent,\n\t\ttextureComponent: TextureComponent,\n\t\tinteractionComponent?: InteractionComponent,\n\t) {\n\t\tconst material = getMaterial(meshComponent);\n\t\tif (material?.texture != null || material?.topTexture != null) {\n\t\t\tif (interactionComponent?.hover && material.texturesVisible) {\n\t\t\t\tmaterial.hideTextures(meshComponent.instanceIndex);\n\t\t\t} else if (!material.texturesVisible) {\n\t\t\t\tmaterial.showTextures(meshComponent.instanceIndex);\n\t\t\t}\n\n\t\t\tif (textureComponent.texture == null) {\n\t\t\t\tmaterial.removeSideTexture(meshComponent.instanceIndex);\n\t\t\t}\n\n\t\t\tif (textureComponent.topTexture == null) {\n\t\t\t\tmaterial.removeTopTexture(meshComponent.instanceIndex);\n\t\t\t}\n\t\t}\n\t}\n\n\tupdate() {\n\t\tlet component: EntityTypes['components'][0];\n\t\tlet interactionComponent: InteractionComponent | undefined;\n\t\tlet entity: EntityTypes | undefined;\n\t\tfor (const entityId of this.state.geometry3DIdsInScene) {\n\t\t\tentity = this.state.geometry3DMap.get(entityId);\n\n\t\t\tif (\n\t\t\t\tentity &&\n\t\t\t\t(entity.type === 'geometry' || entity.type === 'custom-geometry') &&\n\t\t\t\t(entity.components[Geometry3DComponents.Style]?.dirty ||\n\t\t\t\t\tentity.components[Geometry3DComponents.Interaction]?.dirty)\n\t\t\t) {\n\t\t\t\tconst component = entity.components[Geometry3DComponents.Mesh];\n\t\t\t\tconst styleComponent = entity.components[Geometry3DComponents.Style];\n\t\t\t\tinteractionComponent = entity.components[Geometry3DComponents.Interaction];\n\t\t\t\tconst color = processColor(entity as Geometry3D, this.state.hoverColor);\n\t\t\t\tcomponent.setColor(color[0], color[1]);\n\t\t\t\tconst material = getMaterial(component);\n\t\t\t\tif (styleComponent.visible !== component.visible) {\n\t\t\t\t\tcomponent.visible = styleComponent.visible;\n\t\t\t\t\tif (component instanceof MeshComponent && component.textMesh) {\n\t\t\t\t\t\tconst textEntity = this.state.geometry3DMap.get(component.textMesh.userData.entityId);\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\ttextEntity?.type === 'text3d' &&\n\t\t\t\t\t\t\ttextEntity.components[Geometry3DComponents.Mesh].polygonEntityId != null\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t// should be setting the .visible on mesh instead of setting the style componnets since this is where the effect happens\n\t\t\t\t\t\t\ttextEntity.components[Geometry3DComponents.Mesh].visible = styleComponent.visible;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (styleComponent.altitude !== component.altitude) {\n\t\t\t\t\tcomponent.altitude = styleComponent.altitude;\n\t\t\t\t}\n\t\t\t\tconst opacity = styleComponent.opacity * getGroupContainerOpacity(entity);\n\t\t\t\tif (opacity !== component.opacity) {\n\t\t\t\t\tcomponent.opacity = opacity;\n\t\t\t\t}\n\t\t\t\tif (styleComponent.renderOrder !== component.renderOrder) {\n\t\t\t\t\tcomponent.renderOrder = styleComponent.renderOrder;\n\t\t\t\t}\n\t\t\t\tif (material && styleComponent.side !== getMaterialSide(material)) {\n\t\t\t\t\tsetMaterialSide(material, styleComponent.side);\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\tcomponent instanceof MeshComponent &&\n\t\t\t\t\tstyleComponent.shading != null &&\n\t\t\t\t\t(styleComponent.shading?.start !== getMaterial(component)?.getGradientShading().start ||\n\t\t\t\t\t\tstyleComponent.shading?.end !== getMaterial(component)?.getGradientShading().end ||\n\t\t\t\t\t\tstyleComponent.shading?.intensity !== getMaterial(component)?.getGradientShading().intensity)\n\t\t\t\t) {\n\t\t\t\t\tgetMaterial(component)?.setGradientShading(\n\t\t\t\t\t\tstyleComponent.shading?.start ?? 0,\n\t\t\t\t\t\tstyleComponent.shading?.end ?? 0,\n\t\t\t\t\t\tstyleComponent.shading?.intensity ?? 0,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tstyleComponent.dirty = false;\n\n\t\t\t\tif (component instanceof MeshComponent) {\n\t\t\t\t\tconst textureComponent = entity.components[Geometry3DComponents.TextureComponent];\n\t\t\t\t\tif (textureComponent instanceof TextureComponent) {\n\t\t\t\t\t\tthis.determineTextureVisiblity(component, textureComponent, interactionComponent);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (entity.components[Geometry3DComponents.Interaction]) {\n\t\t\t\t\tentity.components[Geometry3DComponents.Interaction].dirty = false;\n\t\t\t\t}\n\t\t\t} else if (entity?.type === 'model') {\n\t\t\t\tif (entity.components[Geometry3DComponents.Style].dirty) {\n\t\t\t\t\tapplyModelGeometryStyle(entity);\n\t\t\t\t\tentity.components[Geometry3DComponents.Style].dirty = false;\n\t\t\t\t}\n\t\t\t\tif (entity.components[Geometry3DComponents.Mesh].positionDirty) {\n\t\t\t\t\tapplyModelPosition(entity, this.convertTo3DMapPosition);\n\t\t\t\t\tentity.components[Geometry3DComponents.Mesh].positionDirty = false;\n\t\t\t\t}\n\t\t\t} else if (entity?.type === 'image' && entity.components[Geometry3DComponents.Style]?.dirty) {\n\t\t\t\tcomponent = entity.components[Geometry3DComponents.Mesh];\n\t\t\t\tconst styleComp = entity.components[Geometry3DComponents.Style];\n\t\t\t\tif (styleComp.visible !== component.visible) {\n\t\t\t\t\tcomponent.visible = styleComp.visible;\n\t\t\t\t}\n\t\t\t\tstyleComp.dirty = false;\n\t\t\t} else if (\n\t\t\t\tentity?.type === 'text3d' &&\n\t\t\t\tentity.components[Geometry3DComponents.Style]?.dirty &&\n\t\t\t\tentity.components[Geometry3DComponents.Mesh].polygonEntityId != null\n\t\t\t) {\n\t\t\t\tcomponent = entity.components[Geometry3DComponents.Mesh];\n\t\t\t\tconst styleComp = entity.components[Geometry3DComponents.Style] as Text3DStyleComponent;\n\t\t\t\tif (styleComp.visible != null && styleComp.visible !== component.visible) {\n\t\t\t\t\tcomponent.visible = styleComp.visible;\n\t\t\t\t}\n\t\t\t\tconst { textMesh } = component;\n\t\t\t\tif (textMesh) {\n\t\t\t\t\tObject.assign(textMesh, styleComp.getState());\n\t\t\t\t\t// NOTE: prioritize hoverColor if exists, fallback to globalHoverColor\n\t\t\t\t\tconst hoverColor = styleComp.hoverColor ?? this.state.text3dHoverColor;\n\t\t\t\t\ttextMesh.color = styleComp.hoverByPolygon ? hoverColor : styleComp.color ?? DEFAULT_TEXT_STYLE.color;\n\t\t\t\t\ttextMesh.outlineColor = styleComp.hoverByPolygon\n\t\t\t\t\t\t? hoverColor\n\t\t\t\t\t\t: styleComp.outlineColor ?? DEFAULT_TEXT_STYLE.outlineColor;\n\t\t\t\t\ttextMesh.strokeColor = styleComp.hoverByPolygon\n\t\t\t\t\t\t? hoverColor\n\t\t\t\t\t\t: styleComp.strokeColor ?? DEFAULT_TEXT_STYLE.strokeColor;\n\t\t\t\t}\n\t\t\t\tstyleComp.dirty = false;\n\t\t\t}\n\t\t}\n\t}\n}\n", "import type { RendererState } from '../../renderer';\nimport { PubSub } from '../../../../packages/common/pubsub';\nimport LabelComponent from '../../components/label';\nimport { Geometry2DComponents } from '../../entities/geometry2d';\nimport { easeIn, interpolate, linearEase } from '@packages/internal/common';\n\nexport class TwoDVisibilitySystem extends PubSub<{\n\t'draw:2d': undefined;\n\t'animate:2d': undefined;\n}> {\n\tstate: RendererState;\n\tconstructor(state: RendererState) {\n\t\tsuper();\n\t\tthis.state = state;\n\t\tthis.playAnimations = this._playAnimations;\n\t}\n\n\tanimating: Map<LabelComponent, [number, number]> = new Map();\n\tisAnimating = false;\n\tstartTime = -1;\n\tshowDuration = 300;\n\thideDuration = 250;\n\n\tupdate = () => {\n\t\tthis.animating.clear();\n\t\tlet entity;\n\t\tlet component;\n\t\tfor (const entityId of this.state.geometry2DIdsInScene) {\n\t\t\tentity = this.state.geometry2DMap.get(entityId);\n\t\t\tif (entity) {\n\t\t\t\tcomponent = entity.components[Geometry2DComponents.UI];\n\t\t\t\tif (component instanceof LabelComponent) {\n\t\t\t\t\tif (component.visibilityNeedsUpdate === 'show') {\n\t\t\t\t\t\tcomponent.canShow = true;\n\t\t\t\t\t\tthis.animating.set(component, [component.currentOpacity, component.appearance.opacity ?? 1]);\n\t\t\t\t\t} else if (component.visibilityNeedsUpdate === 'hide') {\n\t\t\t\t\t\tthis.animating.set(component, [component.currentOpacity, 0]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.startTime = performance.now();\n\t\tthis.publish('animate:2d');\n\t};\n\n\tplayAnimations: () => void;\n\t_playAnimations() {\n\t\tconst frameTime = performance.now();\n\t\tfor (let [component, [startingOpacity, endOpacity]] of this.animating.entries()) {\n\t\t\tconst duration = endOpacity === 1 ? this.showDuration : this.hideDuration;\n\t\t\tconst percentComplete = (frameTime - this.startTime) / duration;\n\n\t\t\tcomponent.currentOpacity = interpolate(\n\t\t\t\tpercentComplete,\n\t\t\t\t0,\n\t\t\t\t1,\n\t\t\t\tstartingOpacity,\n\t\t\t\tendOpacity,\n\t\t\t\tendOpacity === 0 ? linearEase : easeIn,\n\t\t\t);\n\n\t\t\tif (frameTime - this.startTime >= duration) {\n\t\t\t\tif (endOpacity === 1) {\n\t\t\t\t\tcomponent.canShow = true;\n\t\t\t\t} else if (endOpacity === 0) {\n\t\t\t\t\tcomponent.canShow = false;\n\t\t\t\t}\n\t\t\t\tcomponent.visibilityNeedsUpdate = false;\n\t\t\t\tthis.animating.delete(component);\n\t\t\t}\n\t\t}\n\n\t\tthis.publish('draw:2d');\n\t\tif (this.animating.size > 0) {\n\t\t\tthis.publish('animate:2d');\n\t\t}\n\t}\n}\n", "import type { Camera, PerspectiveCamera, Scene } from 'three';\nimport type { RendererState, Systems } from '../../renderer';\nimport type RendererCore from '../../renderer';\nimport type { Renderer } from '../../services/renderer';\nimport { populateGeometry3DIdsInScene, populateGeometry2DIdsInScene } from '../../utils';\nimport { PubSub } from '@packages/internal/common';\n\nexport class RenderSystem extends PubSub<{\n\t'measure-canvas': undefined;\n\t'pre-render': undefined;\n\t'post-render': undefined;\n\t'camera-state-change': undefined;\n}> {\n\tprivate state: RendererState;\n\tprivate renderer: Renderer;\n\tprivate mode: RendererCore['mode'];\n\tprivate scene: Scene;\n\tprivate cameraObject: PerspectiveCamera;\n\tprivate viewCamera: Camera;\n\tprivate systems: Systems;\n\tconstructor(\n\t\trenderer: Renderer,\n\t\tstate: RendererState,\n\t\tmode: RendererCore['mode'],\n\t\tscene: Scene,\n\t\tcameraObject: PerspectiveCamera,\n\t\tviewCamera: Camera,\n\t\tsystems: Systems,\n\t) {\n\t\tsuper();\n\t\tthis.renderer = renderer;\n\t\tthis.state = state;\n\t\tthis.mode = mode;\n\t\tthis.scene = scene;\n\t\tthis.cameraObject = cameraObject;\n\t\tthis.viewCamera = viewCamera;\n\t\tthis.systems = systems;\n\t\tthis.systems.collisionSystem.on('visibility-changed', this.updateEntities2D);\n\t\tthis.systems.twoDVisiblitySystem.on('draw:2d', this.drawEntities2D);\n\t\tthis.systems.twoDVisiblitySystem.on('animate:2d', this.animate2D);\n\t\tthis.systems.cameraSystem.on('pan-start', () => (this.needs2DRecompute = false));\n\t\tthis.systems.cameraSystem.on('zoom-start', () => (this.needs2DRecompute = false));\n\t\tthis.systems.cameraSystem.on('zoom-end', () => (this.needs2DRecompute = true));\n\t\tthis.systems.cameraSystem.on('rotate-start', () => (this.needs2DRecompute = false));\n\t\tthis.systems.cameraSystem.on('rotate-end', () => (this.needs2DRecompute = true));\n\t}\n\n\t// we want colliders to find a new strategy if this is true\n\t// otherwise, they will use the same strategy as the previous frame\n\t// adding to stability when panning, and in the middle of a zoom/rotate\n\tneeds2DRecompute = false;\n\n\ttwoDdirty = true;\n\tthreeDdirty = true;\n\n\tprivate frameId: number | null = null;\n\tprivate twoDFrameId: number | null = null;\n\tprivate animationFrameId: number | null = null;\n\tprivate nextFrame: number | null = null;\n\n\tupdate = (sync = false) => {\n\t\tif (this.renderer?.renderer == null) {\n\t\t\treturn Promise.resolve() as Promise<any>;\n\t\t}\n\n\t\tif (sync) {\n\t\t\t/**\n\t\t\t * Perform a synchronous render\n\t\t\t * First, update the camera and projections\n\t\t\t * Next, paint\n\t\t\t */\n\t\t\tconst promise = this.commitRenderState();\n\t\t\tthis.paint();\n\n\t\t\treturn promise;\n\t\t} else {\n\t\t\tif (this.frameId) {\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\n\t\t\treturn new Promise<void>((res, rej) => {\n\t\t\t\t/**\n\t\t\t\t * Perform an asynchronous render\n\t\t\t\t * First, update the camera and projections\n\t\t\t\t * Next, paint\n\t\t\t\t */\n\t\t\t\tthis.frameId = requestAnimationFrame(() => {\n\t\t\t\t\tif (this.renderer?.renderer == null) {\n\t\t\t\t\t\treturn res();\n\t\t\t\t\t}\n\t\t\t\t\tif (this.mode === 'standalone') {\n\t\t\t\t\t\treturn this.commitRenderState()\n\t\t\t\t\t\t\t?.then(() => {\n\t\t\t\t\t\t\t\tthis.paint();\n\t\t\t\t\t\t\t\tres();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\t\t\trej(error);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn res();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t};\n\n\t/**\n\t * Paint to screen\n\t */\n\tprivate paint() {\n\t\tif (!this.renderer?.renderer) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.mode === 'standalone') {\n\t\t\tthis.renderer.clear();\n\t\t}\n\n\t\tthis.renderer.render(\n\t\t\tthis.scene,\n\t\t\tthis.state.useStandaloneCamera || this.mode === 'standalone' ? this.cameraObject : this.viewCamera,\n\t\t);\n\t}\n\n\t/**\n\t * Play 2D animations in a frame\n\t */\n\tprivate animate2D = () => {\n\t\tthis.animationFrameId = requestAnimationFrame(() => {\n\t\t\tthis.animationFrameId = null;\n\t\t\tthis.systems.twoDVisiblitySystem.playAnimations();\n\t\t});\n\t};\n\n\t/**\n\t * Draw 2D entities in a frame\n\t */\n\tprivate drawEntities2D = () => {\n\t\tif (this.twoDFrameId) {\n\t\t\treturn;\n\t\t}\n\t\tthis.twoDFrameId = requestAnimationFrame(() => {\n\t\t\tthis.twoDFrameId = null;\n\t\t\tthis.systems.twoDDrawSystem.update(this.systems.cameraSystem.getZoomLevel());\n\t\t});\n\t};\n\n\t/**\n\t * Update 2D entities to determine which ones are visible, and these are to be processed in the next frame\n\t */\n\tprivate updateEntities2D = () => {\n\t\tif (this.twoDFrameId) {\n\t\t\tcancelAnimationFrame(this.twoDFrameId);\n\t\t\tthis.twoDFrameId = null;\n\t\t}\n\t\tthis.twoDFrameId = requestAnimationFrame(() => {\n\t\t\tthis.twoDFrameId = null;\n\t\t\t// The watermark should insert itself into the quad tree before the collision system updates\n\t\t\tthis.systems.watermarkSystem.insertIntoQuadTree(this.systems.collisionSystem.interactiveCollidersQTree);\n\t\t\tthis.systems.interactionSystem.updateQuadtree(this.systems.collisionSystem.interactiveCollidersQTree);\n\t\t\tthis.systems.twoDVisiblitySystem.update();\n\t\t\tthis.systems.twoDDrawSystem.update(this.systems.cameraSystem.getZoomLevel());\n\t\t\tthis.systems.domDrawSystem.update(this.systems.cameraSystem.isUserInteracting());\n\t\t});\n\t};\n\n\tprivate commitRenderState = () => {\n\t\ttry {\n\t\t\tconst promises: Promise<any>[] = [];\n\t\t\tthis.frameId = null;\n\t\t\tthis.publish('pre-render');\n\n\t\t\tthis.state.internalTweenGroup.update();\n\t\t\tthis.state.externalTweenGroup.update();\n\n\t\t\tif (this.mode === 'outdoors-interleaved' || this.mode === 'standalone') {\n\t\t\t\tthis.systems.cameraSystem.update();\n\t\t\t}\n\n\t\t\t// this.scene.updateMatrixWorld();\n\n\t\t\tif (this.state.shouldMeasureCanvas) {\n\t\t\t\tthis.state.shouldMeasureCanvas = false;\n\t\t\t\tthis.publish('measure-canvas');\n\t\t\t}\n\n\t\t\tif (this.twoDdirty) {\n\t\t\t\tthis.state.geometry2DIdsInScene.clear();\n\t\t\t\tpopulateGeometry2DIdsInScene(this.state.entityScene, this.state.geometry2DIdsInScene);\n\t\t\t\tthis.systems.domVisiblitySystem.dirty = true;\n\t\t\t\tthis.systems.collisionSystem.collidersDirty = true;\n\t\t\t\tthis.systems.domMutationSystem.dirty = true;\n\t\t\t\tthis.systems.panBoundsSystem.dirty = true;\n\t\t\t\tthis.twoDdirty = false;\n\t\t\t}\n\n\t\t\tif (this.threeDdirty) {\n\t\t\t\tthis.state.geometry3DIdsInScene.clear();\n\t\t\t\tthis.state.geometryGroupIdsToLoad.clear();\n\t\t\t\tpopulateGeometry3DIdsInScene(\n\t\t\t\t\tthis.state.entityScene,\n\t\t\t\t\tthis.state.geometry3DIdsInScene,\n\t\t\t\t\tthis.state.geometryGroupIdsToLoad,\n\t\t\t\t);\n\t\t\t\tthis.threeDdirty = false;\n\t\t\t\tthis.systems.interactionSystem.dirty3D = true;\n\t\t\t\tthis.systems.panBoundsSystem.dirty = true;\n\t\t\t\tthis.systems.outlineInterpolationSystem.geometries3DDirty = true;\n\t\t\t\tthis.systems.geometryInFocusSystem.focusablesDirty = true;\n\t\t\t}\n\n\t\t\t// Leaving this as it needs more work, so it doesn't slip through the cracks\n\t\t\t// /**\n\t\t\t//  * [PERF] Since MapLibre does a bunch of renders as the tiles pop-in, we need to make sure that we're not re-rendering\n\t\t\t//  * anything if the camera hasn't moved, and the 2D/3D entities haven't changed\n\t\t\t//  */\n\t\t\t// if (false && !this.twoDdirty && !this.threeDdirty && this.core.cameraSystem.dirty === false) {\n\t\t\t// \treturn;\n\t\t\t// }\n\n\t\t\tconst meshOptimizePromise = this.systems.meshOptimizationSystem.update();\n\t\t\tif (meshOptimizePromise) {\n\t\t\t\tpromises.push(meshOptimizePromise);\n\t\t\t}\n\t\t\tthis.systems.borderSystem.update();\n\t\t\tthis.systems.meshModificationSystem.update();\n\t\t\tthis.systems.meshDetachmentSystem.update();\n\t\t\tthis.systems.renderOrderSystem.update();\n\t\t\tthis.systems.clippingPlaneSystem.update();\n\t\t\tthis.systems.imageSystem.update(this.systems.cameraSystem.getRotation());\n\t\t\tpromises.push(this.systems.text3DSystem.update(this.systems.cameraSystem.getRotation()));\n\t\t\tthis.systems.customGeometrySystem.update();\n\n\t\t\tthis.systems.panBoundsSystem.update();\n\t\t\tthis.systems.geometryInFocusSystem.update(\n\t\t\t\tthis.systems.cameraSystem.isCameraMoving(),\n\t\t\t\tthis.systems.cameraSystem.lastCameraStoppedMovingTime(),\n\t\t\t);\n\n\t\t\tthis.systems.outlineInterpolationSystem.update(\n\t\t\t\tthis.systems.cameraSystem.getZoomLevel(),\n\t\t\t\tthis.systems.cameraSystem.zoomDirty,\n\t\t\t);\n\n\t\t\tthis.systems.pathSystem.update(\n\t\t\t\tthis.systems.cameraSystem.minZoomAltitude,\n\t\t\t\tthis.systems.cameraSystem.maxZoomAltitude,\n\t\t\t\tthis.systems.cameraSystem.getZoomAltitude(),\n\t\t\t);\n\t\t\tthis.systems.cameraSystem.postRender();\n\n\t\t\tthis.systems.domVisiblitySystem.update();\n\t\t\tthis.systems.domMutationSystem.update();\n\t\t\tthis.systems.twoDProjectionSystem.update();\n\t\t\tthis.systems.occlusion2DSystem.update();\n\t\t\tthis.systems.twoDDrawSystem.update(this.systems.cameraSystem.getZoomLevel());\n\t\t\tthis.systems.domDrawSystem.update(this.systems.cameraSystem.isUserInteracting());\n\t\t\tthis.systems.watermarkSystem.update();\n\n\t\t\tconst needs2DRecompute = this.needs2DRecompute;\n\t\t\t// a double rAf guarantees that this will be called in the next frame\n\t\t\t// looks bad, but actually legit\n\t\t\tthis.nextFrame = requestAnimationFrame(() => {\n\t\t\t\tthis.systems.collisionSystem.update(\n\t\t\t\t\tthis.systems.watermarkSystem.width,\n\t\t\t\t\tthis.systems.watermarkSystem.height,\n\t\t\t\t\tthis.systems.watermarkSystem.options.position,\n\t\t\t\t\t!needs2DRecompute,\n\t\t\t\t\tthis.systems.imageSystem.currentImageScreenBBoxes,\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tthis.systems.textureSystem.update();\n\t\t\tthis.systems.drawSystem.update();\n\t\t\tthis.systems.geometryDisposalSystem.update();\n\n\t\t\tthis.systems.cameraSystem.dirty = false;\n\t\t\tthis.systems.cameraSystem.zoomDirty = false;\n\t\t\tthis.systems.cameraSystem.rotationDirty = false;\n\n\t\t\t// Fire camera-state-change event if camera state is dirty\n\t\t\tif (this.systems.cameraSystem.stateDirty) {\n\t\t\t\tthis.publish('camera-state-change');\n\t\t\t\tthis.systems.cameraSystem.stateDirty = false;\n\t\t\t}\n\n\t\t\tthis.publish('post-render');\n\n\t\t\t// reset so that we don't recompute colliders the next frame until a camera change sets this true again.\n\t\t\tthis.needs2DRecompute = false;\n\n\t\t\treturn Promise.all(promises);\n\t\t} catch (e) {\n\t\t\treturn Promise.reject(e);\n\t\t}\n\t};\n\n\tdestroy() {\n\t\tif (this.frameId) {\n\t\t\tcancelAnimationFrame(this.frameId);\n\t\t}\n\t\tif (this.twoDFrameId) {\n\t\t\tcancelAnimationFrame(this.twoDFrameId);\n\t\t}\n\t\tif (this.animationFrameId) {\n\t\t\tcancelAnimationFrame(this.animationFrameId);\n\t\t}\n\t\tif (this.nextFrame) {\n\t\t\tcancelAnimationFrame(this.nextFrame);\n\t\t}\n\t\tthis.state.geometry2DIdsInScene.clear();\n\t\tthis.state.geometry3DIdsInScene.clear();\n\t\tthis.systems.domVisiblitySystem.dirty = true;\n\t\tthis.systems.collisionSystem.collidersDirty = true;\n\t\tthis.update();\n\t\tthis.systems.collisionSystem.off('visibility-changed', this.updateEntities2D);\n\t\tthis.systems.twoDVisiblitySystem.off('draw:2d', this.drawEntities2D);\n\t\tthis.systems.twoDVisiblitySystem.off('animate:2d', this.animate2D);\n\t}\n}\n", "import { Vector3 } from 'three';\nimport type { BufferGeometry, LineSegments } from 'three';\nimport type { EntityId, Interpolation, Position } from '../types';\nimport type { PathMaterial, PatMeshContainer } from '../entities/geometry3d';\nimport { Geometry3DObject3D } from '../entities/geometry3d';\nimport type { FeatureCollection, Point } from 'geojson';\nimport type { GroupContainerState } from '../entities/group-container';\nimport { z } from 'zod';\nimport { geoJSONPoint } from '../utils/schema-validation';\n\nexport type PathProperties = {\n\t/**\n\t * The parentId of the point. The point will be anchored to the altitude of this parent group container.\n\t */\n\tparentId?: EntityId<GroupContainerState> | string | null;\n};\n\n/**\n * Updatable path state\n * @interface\n */\nexport type PathUpdateState = Omit<Partial<PathState>, 'id' | 'type'>;\n\n/**\n * State representing a Path\n */\nexport type PathState = {\n\treadonly id: string | number;\n\treadonly type: 'path';\n\t/**\n\t * The position of the path in [lon, lat]\n\t */\n\treadonly position: Position;\n\t/**\n\t * How much the path hovers above the floor plane in meters.\n\t */\n\tverticalOffset?: number;\n\t/**\n\t * Whether the path is visible.\n\t */\n\tvisible: boolean;\n\t/**\n\t * Whether the path is interactive, which means it can be hovered over and clicked on.\n\t *\n\t * @example\n\t * ```javascript\n\t * \trenderer.on('click', ({ geometry }) => {});\n\t * ```\n\t */\n\tinteractive?: boolean;\n\t/**\n\t * The fraction of the path that has been drawn. This can be used to animate the drawing of the path.\n\t * Note: use values between 0 and 1.\n\t */\n\tcompleteFraction: number;\n\n\t/**\n\t * The color of the path.\n\t */\n\tcolor: string;\n\t/**\n\t * The accent color of the path. When arrows are visible, it is applied to them\n\t */\n\taccentColor: string;\n\t/**\n\t * Display Arrows on Path to indicate direction\n\t */\n\tdisplayArrowsOnPath: boolean;\n\t/**\n\t * Arrows on path should animate to indicate direction\n\t */\n\tanimateArrowsOnPath: boolean;\n\t/**\n\t * The width of the path in meters. Can be a number or an {@link Interpolation}.\n\t */\n\twidth: number | Interpolation<'zoom-level', number[]>;\n\t/**\n\t * The fraction of the path that should be highlighted. This can be used to animate the highlight.\n\t * @default 0\n\t */\n\thighlightStartFraction: number;\n\thighlightEndFraction: number;\n\thighlightColor: string;\n\thighlightWidthMultiplier: number;\n\thighlightCompleteFraction: number;\n};\n\nexport type AddPathOptions = {\n\t/**\n\t * Whether the Path should be clickable.\n\t * @default false\n\t */\n\tinteractive?: boolean;\n\t/**\n\t * @internal\n\t */\n\tid?: string | number;\n\t/**\n\t * The width of the path.\n\t *\n\t * @default Interpolation { on: 'zoom-level', input: [17, 22], output: [0.8, 0.4] }\n\t */\n\twidth?: number | Interpolation<'zoom-level', number[]>;\n\t/**\n\t * The color of the path.\n\t */\n\tcolor?: string;\n\t/**\n\t * The accent color of the path. When arrows are visible, it is applied to them\n\t */\n\taccentColor?: string;\n\t/**\n\t * Display Arrows on Path to indicate direction\n\t */\n\tdisplayArrowsOnPath?: boolean;\n\t/**\n\t * Arrows on path should animate to indicate direction\n\t */\n\tanimateArrowsOnPath?: boolean;\n\t/**\n\t * Whether the path should be visible through geometry.\n\t */\n\tvisibleThroughGeometry?: boolean;\n\t/**\n\t * Whether the path should be dashed.\n\t */\n\tdashed?: boolean;\n\t/**\n\t * How much the path hovers above the floor plane in meters.\n\t */\n\tverticalOffset?: number;\n\t/**\n\t * The fraction of the path that should be highlighted. This can be used to animate the highlight.\n\t * @default 0\n\t */\n\thighlightStartFraction?: number;\n\thighlightEndFraction?: number;\n\thighlightColor?: string;\n\thighlightWidthMultiplier?: number;\n\thighlightCompleteFraction?: number;\n};\n\nexport const addPathOptionsSchema = z.object({\n\tinteractive: z.boolean().optional(),\n\tid: z.string().optional(),\n\twidth: z\n\t\t.union([\n\t\t\tz.number(),\n\t\t\tz.object({\n\t\t\t\ton: z.literal('zoom-level').optional(),\n\t\t\t\tinput: z.array(z.number()).nonempty(),\n\t\t\t\toutput: z.array(z.number()).nonempty(),\n\t\t\t\teasing: z.string().optional(),\n\t\t\t}),\n\t\t])\n\t\t.optional(),\n\taccentColor: z.string().optional(),\n\tdisplayArrowsOnPath: z.boolean().optional(),\n\tanimateArrowsOnPath: z.boolean().optional(),\n\tvisibleThroughGeometry: z.boolean().optional(),\n\tdashed: z.boolean().optional(),\n});\n\nexport const featureSchema = z.object({\n\ttype: z.enum(['Feature']),\n\tgeometry: geoJSONPoint,\n\tproperties: z.object({\n\t\tparentId: z.any().optional(),\n\t}),\n});\n\nexport function validatePath(geometry: FeatureCollection<Point, PathProperties>, options: AddPathOptions) {\n\tconst geometrySchema = z.object({\n\t\tfeatures: z.array(featureSchema),\n\t});\n\n\tgeometrySchema.parse(geometry);\n\taddPathOptionsSchema.parse(options);\n}\n\nexport class PathComponent {\n\treadonly type = 'path';\n\tmesh = new Geometry3DObject3D() as PatMeshContainer;\n\tmaterial?: PathMaterial;\n\tgeometry?: BufferGeometry;\n\toutline?: LineSegments;\n\tfeature: FeatureCollection<Point, PathProperties>;\n\toptions: AddPathOptions;\n\twidth: number | Interpolation<'zoom-level', number[]> = {\n\t\ton: 'zoom-level',\n\t\tinput: [17, 22],\n\t\toutput: [0.8, 0.4],\n\t};\n\tbreakpoint = 0;\n\t// Cache conversion from mercator zoom to altitude, only relevant if width is an interpolation\n\taltitudeBreakpoints?: number[];\n\taccentColor = 'blue';\n\tcompleteFraction = 1.0;\n\taltitudeAdjustment = 1;\n\tdisplayArrowsOnPath = false;\n\tanimateArrowsOnPath = false;\n\tvisibleThroughGeometry = false;\n\n\thighlightStartFraction = 0.0;\n\thighlightEndFraction = 0.0;\n\thighlightCompleteFraction = 1.0;\n\thighlightWidthMultiplier = 1.1;\n\thighlightColor = 'red';\n\n\tdashed = false;\n\t/**\n\t * If the path is vertical it will be rebuilt whenever altitudeDirty = true. This will be set during the first render of the path.\n\t */\n\tisVertical = false;\n\tdirty = true;\n\tmaterialDirty = true;\n\tconstructor(feature: FeatureCollection<Point, PathProperties>, options?: AddPathOptions) {\n\t\tthis.feature = feature;\n\t\tthis.options = options || {};\n\t\tthis.width = options?.width ?? this.width;\n\t\tthis.accentColor = options?.accentColor ?? this.accentColor;\n\t\tthis.displayArrowsOnPath = options?.displayArrowsOnPath ?? this.displayArrowsOnPath;\n\t\tthis.animateArrowsOnPath = options?.animateArrowsOnPath ?? this.animateArrowsOnPath;\n\t\tthis.visibleThroughGeometry = options?.visibleThroughGeometry ?? this.visibleThroughGeometry;\n\t\tthis.dashed = options?.dashed ?? this.dashed;\n\t}\n\n\tsetColor() {}\n\tsetOpacity() {}\n\n\tset visible(visible: boolean) {\n\t\tif (this.mesh) {\n\t\t\tthis.mesh.visible = visible;\n\t\t}\n\t}\n\n\tget visible() {\n\t\treturn this.mesh ? this.mesh.visible : false;\n\t}\n\n\tposition = new Vector3();\n\n\t// This seems to be unused in favor of style.altitude\n\t// TODO: Why is this here?\n\t#altitude = 0;\n\tget altitude() {\n\t\treturn this.#altitude;\n\t}\n\n\tset altitude(value) {\n\t\tif (this.mesh) {\n\t\t\tthis.mesh.position.z = value;\n\t\t\tthis.#altitude = value;\n\t\t}\n\t}\n\n\tset complete(value: number) {\n\t\tif (this.material) {\n\t\t\tthis.material.uniforms.complete.value = value;\n\t\t\tthis.material.needsUpdate = true;\n\t\t}\n\t}\n}\n", "export { CameraSystem } from './system';\nexport type { AnimateCameraTarget, PanBounds } from './types';\nexport * as CAMERA_CONSTANTS from './constants';\n", "import type { PerspectiveCamera, Scene, Intersection, WebGLRenderer } from 'three';\n\nimport {\n\tObject3D,\n\tEuler,\n\tMOUSE,\n\tPlaneGeometry,\n\tMatrix4,\n\tMeshBasicMaterial,\n\tMesh,\n\tRaycaster,\n\tVector2,\n\tVector3,\n\tClock,\n\tBox3,\n\tMathUtils,\n\tInstancedMesh,\n\tBoxGeometry,\n} from 'three';\nimport { Easing, Tween } from '@tweenjs/tween.js';\n\n// TODO Replace with the local version\nimport { cartesianToGeographic, geographicToCartesian, getProjectionScaleFactor } from '../../utils';\nimport { debounce } from '../../utils/async';\nimport { PubSub } from '../../../../packages/common/pubsub';\n\nimport { differenceBetweenAngles, getScrollDelta, getTouchPos, TouchAnchor, InputSet } from './helpers';\nimport * as CAMERA_CONSTANTS from './constants';\n\nimport type {\n\tAnimateCameraTarget,\n\tCameraControlsOptions,\n\tCameraControlsCoords,\n\tCameraControlsTouch,\n\tCameraControlsTweenPoint,\n\tCameraFocusOnOptions,\n\tPanBounds,\n} from './types';\nimport type { InsetPadding, RendererState } from '../../renderer';\nimport { DEFAULT_MIN_ZOOM_LEVEL } from './constants';\nimport { destroyObject3D } from '../../utils/object3d-destroy';\nimport { EARTH_RADIUS_M } from '@packages/internal/common/constants';\nimport { shortestTweenRotation } from '@packages/internal/common';\n\nconst DEBUG_CAMERA_PLANE = false;\nconst DEBUG_FOCUS_ON = false;\n\nexport enum CameraControlsState {\n\tNONE = -1,\n\tROTATE = 0,\n\tDOLLY = 1,\n\tPAN = 2,\n\tWHEEL_ZOOM = 3,\n\tTOUCH_TILT = 4,\n\tTOUCH_DOLLY = 5,\n\tTOUCH_PAN = 6,\n\tMULTI = 7,\n\tPEDESTAL = 8,\n\tTOUCH_PEDESTAL = 9,\n}\n\nenum CameraControlsViewState {\n\tSINGLE_FLOOR = 'single_floor',\n\tMULTI_FLOOR = 'multi_floor',\n}\n\ntype CameraEventName = (typeof CAMERA_CONSTANTS.EVENTS)[number];\n\ntype SpecificCameraEvents = {\n\t'multi-start': { zooming: boolean; rotating: boolean; tilting: boolean };\n\t'multi-end': { zooming: boolean; rotating: boolean; tilting: boolean };\n\t'multi-cancel': { zooming: boolean; rotating: boolean; tilting: boolean };\n\t'pedestal-change': {\n\t\tpedestal: number;\n\t\tscrolledToTop?: boolean;\n\t\tscrolledToBottom?: boolean;\n\t\tscrollPercent?: number;\n\t};\n};\n\nexport type CameraSystemState = {\n\tcenter: [number, number];\n\tzoomLevel: number;\n\tminZoomLevel: number;\n\tmaxZoomLevel: number;\n\tpitch: number;\n\tminPitch: number;\n\tmaxPitch: number;\n\tbearing: number;\n\televation: number;\n};\n\ntype CameraEvents = {\n\t[Event in CameraEventName]: Event extends keyof SpecificCameraEvents ? SpecificCameraEvents[Event] : undefined;\n};\n\n/**\n * The advanced, manual camera controls.\n * This class will let you do things like change the min/max zoom, tilt, and pan, attach to camera events, and move/animate the camera to specifc points.\n *\n * The camera works by setting an anchor point on the scene at ground level and pointing the camera at it.\n * The camera will always be pointed directly at the anchor point.\n */\nclass CameraSystem extends PubSub<CameraEvents> {\n\tpublic dirty = false;\n\tpublic zoomDirty = false;\n\tpublic rotationDirty = false;\n\tpublic panDirty = false;\n\tpublic stateDirty = false;\n\n\t#defaultMinZoomLevel = DEFAULT_MIN_ZOOM_LEVEL;\n\n\t/**\n\t * Factor that controls how fast zooming in and out happens in response to mouse wheel events\n\t *\n\t * @property zoomSpeed {Float}\n\t * @default 5.0\n\t */\n\tpublic zoomSpeed = 5.0;\n\n\t/**\n\t * Factor to multiple mouse movement by to get tilt/rotation.\n\t *\n\t * @property rotateSpeed {Float}\n\t * @default 100\n\t */\n\tpublic rotateSpeed = 100;\n\n\t/**\n\t * Disable or re-enable user input.\n\t *\n\t * @property enabled {Boolean}\n\t * @default true\n\t */\n\tpublic enabled = true;\n\n\t/**\n\t * Disable or re-enable user zoom.\n\t *\n\t * @property enableZoom {Boolean}\n\t * @default true\n\t */\n\tpublic enableZoom = true;\n\n\t/**\n\t * Disable or re-enable user pan.\n\t *\n\t * @property enablePan {Boolean}\n\t * @default true\n\t */\n\tpublic enablePan = true;\n\n\t/**\n\t * Disable or re-enable user pedestal.\n\t *\n\t * @property enablePedestal {Boolean}\n\t * @default false\n\t */\n\tpublic enablePedestal = false;\n\n\t/**\n\t * Max amount to allow scrolling maps down\n\t * (In Z-axis units, at the origin, down is positive)\n\t *\n\t * @property maxPedestal {Number}\n\t * @default Infinity\n\t */\n\tpublic maxPedestal = Infinity;\n\n\t/**\n\t * Max amount to allow scrolling maps up\n\t * (In Z-axis units, at the origin, up is negative)\n\t *\n\t * @property minPedestal {Number}\n\t * @default 0\n\t */\n\tpublic minPedestal = 0;\n\n\t/**\n\t * Disable or re-enable user tilt/rotation.\n\t *\n\t * @property enableRotate {Boolean}\n\t * @default true\n\t */\n\tpublic enableRotate = true;\n\n\t/**\n\t * This is actually the minium distance the camera can get from it's anchor on the ground. May be worth changing if your map has very tall buildings to avoid the camera clipping through them.\n\t *\n\t * @property minZoomAltitude {Number}\n\t * @default 0\n\t */\n\tpublic minZoomAltitude = 0;\n\n\t/**\n\t * Maximum distance the camera can get from it's anchor on the ground. Setting this too high will result in parts of the map falling out of the camera's clipping plane and disappearing.\n\t *\n\t * @property maxZoomAltitude {Number}\n\t * @default Infinity\n\t */\n\tpublic maxZoomAltitude = Infinity;\n\n\t/**\n\t * How far the camera can zoom in towards the ground.\n\t *\n\t * This is equivalent to the minZoomAltitude property in mercator zoom level units.\n\t * @default 0\n\t */\n\tpublic get maxZoomLevel() {\n\t\treturn this.convertAltitudeToZoomLevel(this.minZoomAltitude);\n\t}\n\n\t/**\n\t * Sets distance the camera can zoom in towards the ground.\n\t * @default Infinity\n\t */\n\tpublic setMaxZoomLevel(zoomLevel: number) {\n\t\tthis.minZoomAltitude = this.convertZoomLevelToAltitude(zoomLevel);\n\t\tthis.stateDirty = true;\n\t}\n\n\t/**\n\t * The default minimum zoom level of the camera in mercator zoom levels.\n\t */\n\tget defaultMinZoomLevel() {\n\t\treturn this.#defaultMinZoomLevel;\n\t}\n\n\t/**\n\t * How far the camera can zoom out away from the ground.\n\t *\n\t * This is equivalent to the maxZoomAltitude property in mercator zoom level units.\n\t */\n\tpublic get minZoomLevel() {\n\t\treturn this.convertAltitudeToZoomLevel(this.maxZoomAltitude);\n\t}\n\n\t/**\n\t * Sets distance the camera can zoom away from the ground.\n\t */\n\tpublic setMinZoomLevel(zoomLevel: number) {\n\t\tthis.maxZoomAltitude = this.convertZoomLevelToAltitude(zoomLevel);\n\t\tthis.stateDirty = true;\n\t}\n\n\t/**\n\t * ignoreZoomLimits; use with caution for special effects\n\t * @default false\n\t */\n\tpublic ignoreZoomLimits = false;\n\n\t/**\n\t * Multiplier for min and max zoom, for convenience.\n\t *\n\t * @hidden\n\t * @property zoomFactor {Number}\n\t * @default 1\n\t */\n\tpublic zoomFactor = 1;\n\n\t/**\n\t * Constrains the camera from panning to far away from the scene. It's set automatically based on the size of the map.\n\t * If you want to change anything, you probably want to change the margin property, which is the factor the min and max in\n\t * each dimension are multiplied by to give the true bounds. For example, on a truely huge venue a 1.25 margin could get you\n\t * way out into space when zoomed in.\n\t *\n\t * @property panBounds {Object}\n\t @property panBounds.min {Object} An x, y pair representing the bounds of one corner of the map.\n\t @property panBounds.max {Object} An x, y pair representing the bounds of the other corner of the map.\n\t */\n\tpublic panBounds: PanBounds = {\n\t\tmin: new Vector3(Infinity, Infinity),\n\t\tmax: new Vector3(-Infinity, -Infinity),\n\t\tcenter: new Vector3(0, 0, 0),\n\t\tradius: Infinity,\n\t};\n\n\t/**\n\t * Minium camera tilt, in radians. If it's anything other than 0, you won't be able to look at the venue from the top down perspective.\n\t *\n\t * @property minTilt {Number}\n\t * @default 0.0\n\t */\n\tpublic minTilt = 0.0;\n\n\t/**\n\t * Minium camera tilt, in radians. If you set it too high, the camera will be able to tilt down through the geometery of the scene, which will produce clipping issues.\n\t *\n\t * @property maxTilt {Number}\n\t * @default 1.2\n\t */\n\tpublic maxTilt = 1.2;\n\n\t/**\n\t * If you would really prefer to pan with the right mouse button and tilt/rotate with the left, you can swap the values here to achieve that.\n\t *\n\t * @property MOUSE_BUTTONS {Object}\n\t * @hidden\n\t @property mouseButtons.ORBIT=MOUSE.RIGHT {MOUSE} The button to use for tilt/rotation. Defaults to `MOUSE.RIGHT`.\n\t @property mouseButtons.ZOOM=MOUSE.MIDDLE {MOUSE} The button to use for zoom behaviour. Don't change\n\t @property mouseButtons.PAN=MOUSE.LEFT {MOUSE} The button to use for panning the camera. Defaults to `MOUSE.LEFT`.\n\t */\n\tprivate readonly MOUSE_BUTTONS = {\n\t\tORBIT: MOUSE.RIGHT,\n\t\tZOOM: MOUSE.MIDDLE,\n\t\tPAN: MOUSE.LEFT,\n\t};\n\tprivate readonly camera: PerspectiveCamera;\n\tprivate readonly scene: Scene;\n\tprivate readonly renderer: WebGLRenderer;\n\tprivate readonly elevation: Object3D;\n\tprivate readonly orbit: Object3D;\n\tprivate readonly cameraPlane: Mesh;\n\tprivate readonly raycaster = new Raycaster();\n\tprivate readonly rendererState: RendererState;\n\n\tprivate readonly options: CameraControlsOptions;\n\n\tpublic state: CameraControlsState = CameraControlsState.NONE;\n\tprivate intersection?: Intersection<Object3D>;\n\tprivate viewState: CameraControlsViewState | null = null;\n\tprivate tweens = new Map<\n\t\tTween,\n\t\t{ cancelledCallback: ((...args: any[]) => void) | undefined; interruptible: boolean }\n\t>();\n\tprivate clock = new Clock(true);\n\tprivate coords: CameraControlsCoords = {\n\t\tmouse: new Vector2(),\n\t\trotateStart: new Vector2(),\n\t\trotateEnd: new Vector2(),\n\t\trotateDelta: new Vector2(),\n\t\tpanStart: new Vector3(),\n\t\tpanCameraStart: new Vector3(),\n\t\tpanEnd: new Vector3(),\n\t\tpanDelta: new Vector3(),\n\t\tinitialShiftPos: new Vector2(),\n\t\tinitialPedestal: 0,\n\t\tfloorAnchor: new Vector3(),\n\t};\n\n\tprivate touch: CameraControlsTouch = {\n\t\torigin: { offsetLeft: 0, offsetTop: 0 },\n\t\ttouches: [],\n\t\tanchor1: null,\n\t\tanchor2: null,\n\t\tinputs: null,\n\t};\n\n\tprivate scrollTimer: null | number = null;\n\tprivate lastWheelTime = 0;\n\tprivate resetZoom = false; // Indicates whether to reset the camera position and zoom level when panning while mouse zooming\n\tprivate zoomStart: number;\n\tprivate pedestalScaleFactor = 1;\n\n\tprivate isUserZooming = false;\n\t// If true, the controls will not be limited by min and max values.\n\tprivate stayInsideBounds = true;\n\tprivate userInteracting = false;\n\tprivate cameraMoving = false;\n\tprivate lastCameraMoveTime = Date.now();\n\n\tconstructor(\n\t\tcamera: PerspectiveCamera,\n\t\tscene: Scene,\n\t\trenderer: WebGLRenderer,\n\t\trendererState: RendererState,\n\t\toptions: CameraControlsOptions,\n\t) {\n\t\tsuper();\n\n\t\tthis.camera = camera;\n\t\tthis.renderer = renderer;\n\t\tthis.rendererState = rendererState;\n\t\tthis.scene = scene;\n\t\tthis.options = options;\n\t\tthis.elevation = camera.parent!;\n\t\tthis.orbit = this.elevation.parent!;\n\t\tthis.cameraPlane = this.createCameraPlane();\n\t\tthis.zoomStart = camera.position.z;\n\n\t\tif (options.mode !== 'outdoors-overlay') {\n\t\t\tthis.addEventListeners();\n\t\t}\n\t}\n\n\t/**\n\t * The amount the camera is shifted up/down\n\t * (corresponds to scroll amount in multifloor mode)\n\t * 100% == camera is as far up as it will go\n\t * 0% == camera is as far down as it will go\n\t */\n\tget scrollPercent(): number {\n\t\tconst min = this.minPedestal;\n\t\tconst max = this.maxPedestal;\n\t\tlet pedestal = this.getPedestal();\n\t\tpedestal = Math.min(pedestal, max);\n\t\tpedestal = Math.max(pedestal, min);\n\t\tconst offset = pedestal - min;\n\t\tconst portion = offset / (max - min);\n\n\t\treturn portion * 100;\n\t}\n\n\t/**\n\t * Returns current field of view(FOV) in degrees\n\t */\n\tget fov(): number {\n\t\treturn this.camera.fov;\n\t}\n\n\t/**\n\t * Returns whether the maps are scrolled to bottom\n\t */\n\tget scrolledToBottom(): boolean {\n\t\treturn this.minPedestal === 0 || Math.floor(this.getPedestal()) <= this.minPedestal;\n\t}\n\n\t/**\n\t * Returns whether the maps are scrolled to top\n\t */\n\tget scrolledToTop(): boolean {\n\t\treturn this.maxPedestal === 0 || Math.ceil(this.getPedestal()) >= this.maxPedestal;\n\t}\n\n\t/**\n\t * The camera's current center in [longitude, latitude] degrees.\n\t */\n\tget center(): [number, number] {\n\t\tconst v = this.getPosition();\n\n\t\tconst { lat, lon } = cartesianToGeographic(\n\t\t\tthis.rendererState.center?.[1] ?? 0,\n\t\t\tthis.rendererState.center?.[0] ?? 0,\n\t\t\tv.x,\n\t\t\tv.y,\n\t\t);\n\n\t\treturn [lon, lat];\n\t}\n\n\t/**\n\t * @param center The center in [longitude, latitude] degrees.\n\t */\n\tsetCenter(longitude: number, latitude: number) {\n\t\tconst { x, y } = geographicToCartesian(\n\t\t\tthis.rendererState.center?.[1] ?? 0,\n\t\t\tthis.rendererState.center?.[0] ?? 0,\n\t\t\tlatitude,\n\t\t\tlongitude,\n\t\t);\n\n\t\tthis.setPosition(x, y);\n\t}\n\n\t/**\n\t * @hidden\n\t */\n\tpublic raycastToFloor = (pos: Vector2): Vector3 => {\n\t\tthis.raycaster.setFromCamera(pos, this.camera);\n\n\t\tlet intersection = this.raycaster.intersectObject(this.cameraPlane, false)[0];\n\t\tif (intersection) {\n\t\t\treturn intersection.point;\n\t\t} else {\n\t\t\treturn new Vector3();\n\t\t}\n\t};\n\n\t/**\n\t * Returns true if the the user is currently manipulating the camera.\n\t *\n\t * @return {Boolean} True if the user is currently manipulating the camera, false otherwise.\n\t */\n\tpublic isUserInteracting = (): boolean => {\n\t\treturn this.userInteracting;\n\t};\n\n\t/**\n\t * Returns the current camera position.\n\t *\n\t * @return {Object} An {x, y} object of the current camera postion.\n\t */\n\tpublic getPosition = (): Vector3 => {\n\t\treturn new Vector3(this.orbit.position.x, this.orbit.position.y, this.orbit.position.z);\n\t};\n\n\t/**\n\t * Returns the current camera pedestal zoom level.\n\t */\n\tpublic getPedestal = (): number => {\n\t\treturn this.orbit.position.z;\n\t};\n\n\t/**\n\t * Pans the camera right and down from the current position\n\t *\n\t * @param right {Number} The units to move right. Negative will pan left. This is in relation to the global coordinate system, not the current camera rotation.\n\t * @param down {Number} The units to move down. Negative will pan up. This is in relation to the global coordinate system, not the current camera rotation.\n\t */\n\tpublic pan = (right: number, down: number) => {\n\t\tif (isNaN(right) || isNaN(down)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setPosition(this.orbit.position.x + right, this.orbit.position.y + down);\n\t\tthis.publish('position-updated');\n\t};\n\n\t/**\n\t * Anything we need to do after we render the camera, like update anchors for the mouse/touch controls.\n\t *\n\t * @hidden\n\t */\n\tpublic postRender = () => {\n\t\tif (this.state === CameraControlsState.PAN || this.state === CameraControlsState.TOUCH_PAN) {\n\t\t\tthis.raycaster.setFromCamera(this.coords.mouse, this.camera);\n\t\t\tthis.intersection = this.raycaster.intersectObject(this.cameraPlane, false)[0];\n\t\t\tif (this.intersection) {\n\t\t\t\tthis.coords.panStart.set(this.intersection.point.x, this.intersection.point.y, 0);\n\t\t\t\tthis.coords.panCameraStart.set(this.orbit.position.x, this.orbit.position.y, 0);\n\t\t\t}\n\t\t}\n\n\t\tif (this.state === CameraControlsState.WHEEL_ZOOM && this.resetZoom) {\n\t\t\tthis.resetZoom = false;\n\t\t\tthis.zoomStart = this.getZoomAltitude();\n\t\t\tthis.coords.floorAnchor = this.raycastToFloor(this.coords.mouse);\n\t\t\tthis.coords.panCameraStart.set(this.orbit.position.x, this.orbit.position.y, 0);\n\t\t}\n\n\t\tif (this.state === CameraControlsState.MULTI && this.isAnimating === false) {\n\t\t\tthis.state = CameraControlsState.NONE;\n\t\t\tthis.publish('multi-end');\n\t\t}\n\t};\n\n\t/**\n\t * Returns true if the camera is currently animating.\n\t * @return {Boolean} True if the camera is animating, false otherwise.\n\t */\n\tpublic get isAnimating() {\n\t\treturn this.rendererState.internalTweenGroup.getAll().some(value => (value as any).cameraAnimation);\n\t}\n\n\t/**\n\t * Returns true if the camera is currently moving (it's animating, the user is manipulating it).\n\t *\n\t * @return {Boolean} True if the camera is moving, false otherwise.\n\t */\n\tpublic isCameraMoving = (): boolean => {\n\t\treturn this.cameraMoving;\n\t};\n\n\t/**\n\t * Returns the most recent time the camera stopped moving.\n\t *\n\t * @returns {Number} The time in ms the camera stopped moving.\n\t */\n\tpublic lastCameraStoppedMovingTime = (): number => {\n\t\treturn this.lastCameraMoveTime;\n\t};\n\n\t/**\n\t * Sets the camera anchor to a specifc x/y positon, in the global reference frame. 0,0 will be roughly the middle of the map, and panBounds holds the min/max points.\n\t *\n\t * @param x {Number} The x position to move the camera to. +x will take you right, from the default camera rotation of 0.\n\t * @param y {Number} The y position to move the camera to. +y will take you down (towards the viewer) in the default camera rotation of 0.\n\t */\n\tpublic setPosition = (x: number, y: number) => {\n\t\tif (x === undefined || y === undefined || isNaN(x) || isNaN(y)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.state === CameraControlsState.NONE) {\n\t\t\tthis.publish('pan-start');\n\t\t}\n\n\t\tthis.updateCameraPosition(x, y);\n\n\t\tthis.publish('position-updated');\n\n\t\tthis.publish('change');\n\t\tif (this.state === CameraControlsState.NONE) {\n\t\t\tthis.publish('pan-end');\n\t\t}\n\t\tthis.dirty = true;\n\t\tthis.stateDirty = true;\n\t};\n\n\tprivate updateCameraPosition = (x: number, y: number) => {\n\t\tconst dx = x - this.panBounds.center.x;\n\t\tconst dy = y - this.panBounds.center.y;\n\t\tconst targetDistanceFromBounds = Math.sqrt(dx * dx + dy * dy);\n\t\tif (this.stayInsideBounds && targetDistanceFromBounds > this.panBounds.radius) {\n\t\t\tconst angle = Math.atan2(dy, dx);\n\t\t\tconst target = {\n\t\t\t\tx: Math.cos(angle) * this.panBounds.radius + this.panBounds.center.x,\n\t\t\t\ty: Math.sin(angle) * this.panBounds.radius + this.panBounds.center.y,\n\t\t\t};\n\t\t\tthis.orbit.position.x = target.x;\n\t\t\tthis.orbit.position.y = target.y;\n\t\t} else {\n\t\t\tthis.orbit.position.x = x;\n\t\t\tthis.orbit.position.y = y;\n\t\t}\n\t};\n\n\t/**\n\t * Tilts the camera up or down by some number of radians. Bounded by minTilt and maxTilt.\n\t *\n\t * @param radians {Number} Number of radians to increase or decrease the current tilt by.\n\t */\n\tpublic tilt = (radians: number) => {\n\t\tif (isNaN(radians)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.state === CameraControlsState.NONE) {\n\t\t\tthis.publish('rotate-start');\n\t\t}\n\t\tconst newTilt = this.stayInsideBounds\n\t\t\t? Math.max(Math.min(radians + this.getTilt(), this.maxTilt), this.minTilt)\n\t\t\t: radians + this.getTilt();\n\t\tif (newTilt !== this.elevation.rotation.x) {\n\t\t\tthis.elevation.rotation.x = newTilt;\n\t\t\tthis.publish('tilt-updated');\n\t\t}\n\t\tthis.publish('change');\n\n\t\tif (this.state === CameraControlsState.NONE) {\n\t\t\tthis.publish('rotate-end');\n\t\t}\n\t\tthis.stateDirty = true;\n\t};\n\n\t/**\n\t * Zooms the camera in on the center of the current view.\n\t *\n\t * @param duration {Number} The duration of the zoom animation, in ms.\n\t * @param curve {Function} The easing function to use for the zoom animation.\n\t * @param callback {Function} A callback that will be executed when the zoom animation is done.\n\t */\n\tpublic zoomIn = (duration: number, curve: (n: number) => number, callback: (...args) => void) => {\n\t\tlet zoom = this.getZoomAltitude();\n\t\tthis.animateCamera(\n\t\t\t{\n\t\t\t\tzoom: zoom / 1.5,\n\t\t\t},\n\t\t\tduration,\n\t\t\tcurve,\n\t\t\tcallback,\n\t\t);\n\t};\n\n\t/**\n\t * Zooms the camera out from the center of the current view.\n\t *\n\t * @param duration\n\t * @param curve\n\t * @param callback\n\t */\n\tpublic zoomOut = (duration: number, curve: (n: number) => number, callback: (...args) => void) => {\n\t\tlet zoom = this.getZoomAltitude();\n\t\tthis.animateCamera(\n\t\t\t{\n\t\t\t\tzoom: zoom * 1.5,\n\t\t\t},\n\t\t\tduration,\n\t\t\tcurve,\n\t\t\tcallback,\n\t\t);\n\t};\n\n\t/**\n\t * Returns the current camera rotation.\n\t *\n\t * @return {Number} The current rotation of the camera, in radians.\n\t */\n\tpublic getRotation = (): number => {\n\t\t// return rotation normalized to 0-360\n\t\treturn (-this.orbit.rotation.z + Math.PI * 2) % (Math.PI * 2);\n\t};\n\n\t/**\n\t * Cancel animation- for the new API\n\t */\n\tpublic cancelAnimation = () => {\n\t\tconst tweensArray = Array.from(this.tweens.keys());\n\t\tif (tweensArray.length < 1) {\n\t\t\treturn;\n\t\t}\n\t\tlet lastTween: Tween = tweensArray[tweensArray.length - 1];\n\t\t// Make sure to emit an event if we are cancelling a tween\n\t\tif ((lastTween as any).state === CameraControlsState.MULTI) {\n\t\t\tthis.publish('multi-cancel', {\n\t\t\t\tzooming: true,\n\t\t\t\trotating: true,\n\t\t\t\ttilting: true,\n\t\t\t});\n\t\t}\n\t\tthis.completeTween(lastTween);\n\t};\n\n\t/**\n\t * Animates the camera from it's current position to the state specified in target. You only\n\t * need to specify the properties you actually want to change.\n\t *\n\t * You can also specify a duration, animation curve, and a callback for when it's done.\n\t *\n\t * @param target {Object} A list of optional parameters you can set that represent the camera state.\n\t @param [target.position] {Object} An {x, y, z} object representing the position to move to.\n\t @param [target.zoom] {Number} The zoom level to end at.\n\t @param [target.tilt] {Number} The tilt to end at, in radians.\n\t @param [target.rotation] {Number} The rotation to end at, in radians.\n\t @param [target.doNotAutoStart=false] {Boolean} Set this to true if you want to start the tween yourself.\n\t * @param [duration] {Number} The duration to animate the camera for, in ms.\n\t * @param [curve] {Mappedin.Easing} The animation curve to use for the animation.\n\t * @param [callback] {Function} A callback that will be executed when the animation is done.\n\t * @param [options] {Object} An Options object\n\t * @param [options.interruptible=true] {Boolean} Determines if this animation must complete before any new animations start\n\t it will cancel and omit any previous animations. Set to \"chain\" to chain instead\n\t *\n\t * @return {Mappedin.Tween} The tween being used, if you want to do anything to control it manually. Do not overide it's events.\n\t */\n\tpublic animateCamera = (\n\t\ttarget: AnimateCameraTarget,\n\t\tduration: number,\n\t\tcurve?: (n: number) => number,\n\t\tcallback?: (...args) => void,\n\t\tcancelledCallback?: (...args) => void,\n\t\toptions?: { interruptible?: boolean },\n\t): Promise<void> => {\n\t\tconst _options = { interruptible: true, ...options };\n\t\tlet tweenStart: CameraControlsTweenPoint = {};\n\t\tlet tweenEnd: CameraControlsTweenPoint = {};\n\n\t\tlet position = this.getPosition();\n\n\t\tif (target.position != null) {\n\t\t\tif (target.position.x !== undefined) {\n\t\t\t\ttweenStart.x = position.x;\n\t\t\t\ttweenEnd.x = target.position.x;\n\t\t\t}\n\t\t\tif (target.position.y !== undefined) {\n\t\t\t\ttweenStart.y = position.y;\n\t\t\t\ttweenEnd.y = target.position.y;\n\t\t\t}\n\t\t\tif (target.position.z !== undefined) {\n\t\t\t\ttweenStart.z = position.z;\n\t\t\t\ttweenEnd.z = target.position.z;\n\t\t\t}\n\t\t}\n\n\t\tif (target.zoom !== undefined) {\n\t\t\ttweenStart.zoom = this.stayInsideBounds\n\t\t\t\t? Math.min(Math.max(this.getZoomAltitude(), this.getZoomScaledMin()), this.getZoomScaledMax())\n\t\t\t\t: this.getZoomAltitude();\n\t\t\tif (this.viewState === CameraControlsViewState.MULTI_FLOOR || !this.stayInsideBounds) {\n\t\t\t\ttweenEnd.zoom = target.zoom;\n\t\t\t} else {\n\t\t\t\ttweenEnd.zoom = Math.min(Math.max(target.zoom, this.getZoomScaledMin()), this.getZoomScaledMax());\n\t\t\t}\n\t\t}\n\n\t\tif (target.rotation !== undefined) {\n\t\t\tconst { start, end } = shortestTweenRotation(this.getRotation(), target.rotation);\n\t\t\ttweenStart.rotation = start;\n\t\t\ttweenEnd.rotation = end;\n\t\t}\n\n\t\tif (target.tilt !== undefined) {\n\t\t\ttweenStart.tilt = this.getTilt();\n\t\t\tif (this.viewState === CameraControlsViewState.MULTI_FLOOR || !this.stayInsideBounds) {\n\t\t\t\ttweenEnd.tilt = target.tilt;\n\t\t\t} else {\n\t\t\t\ttweenEnd.tilt = Math.max(Math.min(target.tilt, this.maxTilt), this.minTilt);\n\t\t\t}\n\t\t}\n\n\t\tconst zooming = tweenStart.zoom !== tweenEnd.zoom;\n\t\tconst rotating = tweenStart.rotation !== tweenEnd.rotation;\n\t\tconst tilting = tweenStart.tilt !== tweenEnd.tilt;\n\n\t\tlet tween = new Tween(tweenStart)\n\t\t\t.to(tweenEnd, process.env.TESTING ? 0 : duration)\n\t\t\t.onUpdate(between => {\n\t\t\t\tthis.setMulti(\n\t\t\t\t\t{\n\t\t\t\t\t\tx: between.x,\n\t\t\t\t\t\ty: between.y,\n\t\t\t\t\t\tz: between.z,\n\t\t\t\t\t},\n\t\t\t\t\tbetween.zoom,\n\t\t\t\t\tbetween.rotation,\n\t\t\t\t\tbetween.tilt,\n\t\t\t\t);\n\t\t\t})\n\t\t\t.onComplete(() => {\n\t\t\t\tthis.completeTween(tween);\n\t\t\t\tthis.publish('multi-end', {\n\t\t\t\t\tzooming,\n\t\t\t\t\trotating,\n\t\t\t\t\ttilting,\n\t\t\t\t});\n\t\t\t\tif (callback) {\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.onStart(() => {\n\t\t\t\tif (this.state !== CameraControlsState.MULTI) {\n\t\t\t\t\tthis.state = CameraControlsState.MULTI;\n\t\t\t\t\t(tween as any).state = CameraControlsState.MULTI;\n\t\t\t\t\tthis.publish('multi-start', {\n\t\t\t\t\t\tzooming,\n\t\t\t\t\t\trotating,\n\t\t\t\t\t\ttilting,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis.publish('change');\n\t\t\t});\n\t\tthis.rendererState.internalTweenGroup.add(tween);\n\n\t\t// check for ongoing tweens\n\t\tconst tweensArray = Array.from(this.tweens.entries());\n\t\tlet lastTween = tweensArray[tweensArray.length - 1];\n\n\t\tlet wait = false;\n\n\t\tif (lastTween != null) {\n\t\t\t// if the last tween can be interrupted\n\t\t\tif (lastTween[1].interruptible) {\n\t\t\t\t// cancel it to play this one\n\t\t\t\tif (typeof lastTween[1].cancelledCallback === 'function') {\n\t\t\t\t\tlastTween[1].cancelledCallback();\n\t\t\t\t}\n\t\t\t\t// and finally remove the last tween\n\t\t\t\tthis.completeTween(lastTween[0]);\n\t\t\t} else {\n\t\t\t\t// otherwise chain this tween\n\t\t\t\twait = true;\n\t\t\t\tlastTween[0].chain(tween);\n\t\t\t}\n\t\t}\n\n\t\tthis.tweens.set(tween, { cancelledCallback, interruptible: _options.interruptible });\n\n\t\tif (curve) {\n\t\t\ttween.easing(curve);\n\t\t} else {\n\t\t\ttween.easing(Easing.Quadratic.In);\n\t\t}\n\n\t\tif (!target.doNotAutoStart && !wait) {\n\t\t\ttween.start();\n\t\t\tthis.publish('change');\n\t\t}\n\n\t\t(tween as any).cameraAnimation = true;\n\n\t\t// TODO: this should resolve when the tween completes\n\t\t// @ts-expect-error\n\t\treturn tween;\n\t};\n\n\t/**\n\t * Allows you to set any of the Camera's position, zoom, rotation and tilt at once, with one function.\n\t *\n\t * @param [position] {Object} an {x, y, z} object representing the new position.\n\t * @param [zoom] {Number} The new zoom distance.\n\t * @param [rotation] {Number} The new rotation, in radians.\n\t * @param [tilt] {Number} The new tilt, in radians.\n\t */\n\tpublic setMulti = (\n\t\tposition?: { x?: number; y?: number; z?: number },\n\t\tzoom?: number,\n\t\trotation?: number,\n\t\ttilt?: number,\n\t\tpublishChangeEvent = true,\n\t) => {\n\t\tif (this.state === CameraControlsState.NONE) {\n\t\t\tthis.publish('multi-start');\n\t\t}\n\n\t\tlet positionUpdated = false;\n\n\t\tif (position != null) {\n\t\t\tif (position.x !== undefined && !isNaN(position.x) && position.y !== undefined && !isNaN(position.y)) {\n\t\t\t\tthis.updateCameraPosition(position.x, position.y);\n\t\t\t\tpositionUpdated = true;\n\t\t\t}\n\n\t\t\tif (position.z !== undefined && !isNaN(position.z)) {\n\t\t\t\tthis.setPedestal(position.z, true, false); // Don't emit camera-state-change here, setMulti will emit it\n\t\t\t\tpositionUpdated = true;\n\t\t\t}\n\t\t}\n\t\tif (positionUpdated) {\n\t\t\tthis.publish('position-updated');\n\t\t}\n\n\t\tconst payload = { zooming: false, tilting: Boolean(zoom), rotating: false };\n\n\t\tif (zoom !== undefined && !isNaN(zoom)) {\n\t\t\tconst targetZoom = this.stayInsideBounds\n\t\t\t\t? Math.min(Math.max(zoom, this.getZoomScaledMin()), this.getZoomScaledMax())\n\t\t\t\t: zoom;\n\n\t\t\tif (targetZoom !== this.camera.position.z) {\n\t\t\t\tpayload.zooming = true;\n\t\t\t\tthis.camera.position.z = targetZoom;\n\t\t\t\tthis.publish('zoom-updated');\n\t\t\t\tthis.zoomDirty = true;\n\n\t\t\t\t// adjust camera near / far to prevent Z-fighting when extremely zoomed out\n\t\t\t\t// this is only likely to happen in multifloor views, when FOV is reduced\n\n\t\t\t\tif (this.viewState === CameraControlsViewState.MULTI_FLOOR) {\n\t\t\t\t\tif (zoom > CAMERA_CONSTANTS.CLIPPING_RADIUS) {\n\t\t\t\t\t\tthis.camera.near = zoom - CAMERA_CONSTANTS.CLIPPING_RADIUS;\n\t\t\t\t\t\tthis.camera.far = zoom + CAMERA_CONSTANTS.CLIPPING_RADIUS;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.camera.near = zoom / CAMERA_CONSTANTS.ZRANGE;\n\t\t\t\t\tthis.camera.far = zoom * CAMERA_CONSTANTS.ZRANGE;\n\t\t\t\t}\n\t\t\t\tthis.camera.updateProjectionMatrix();\n\t\t\t}\n\t\t}\n\n\t\tif (rotation !== undefined && !isNaN(rotation)) {\n\t\t\tif (rotation !== this.getRotation()) {\n\t\t\t\tpayload.rotating = true;\n\t\t\t\tthis.orbit.rotation.z = -rotation;\n\t\t\t\tthis.publish('rotation-updated');\n\t\t\t}\n\t\t}\n\n\t\tif (tilt !== undefined && !isNaN(tilt)) {\n\t\t\tconst newTilt = this.stayInsideBounds ? Math.max(Math.min(tilt, this.maxTilt), this.minTilt) : tilt;\n\t\t\tif (newTilt !== this.elevation.rotation.x) {\n\t\t\t\tpayload.tilting = true;\n\t\t\t\tthis.elevation.rotation.x = newTilt;\n\t\t\t\tthis.publish('tilt-updated');\n\t\t\t}\n\t\t}\n\n\t\tif (publishChangeEvent) {\n\t\t\tthis.publish('change');\n\t\t}\n\n\t\tif (this.state === CameraControlsState.NONE) {\n\t\t\tthis.publish('multi-end', payload);\n\t\t}\n\n\t\tthis.stateDirty = true;\n\t};\n\n\t/**\n\t * Returns the actual zoom minimum based on real-world distance.\n\t *\n\t * @return {Number} The actual zoom minimum in map units.\n\t */\n\tpublic getZoomScaledMin = (): number => {\n\t\treturn this.minZoomAltitude * this.zoomFactor;\n\t};\n\n\t/**\n\t * Returns the actual zoom maximum based on visible map size.\n\t *\n\t * @return {Number} The actual zoom maximum in map units.\n\t */\n\tpublic getZoomScaledMax = (): number => {\n\t\tlet min = this.minZoomAltitude * this.zoomFactor;\n\n\t\treturn Math.max(this.maxZoomAltitude, min);\n\t};\n\n\t/**\n\t * Sets the rotation to a specific orientation, clockwise in radians. Mostly useful to orient the map a certain way for a physical directory.\n\t *\n\t * @param radians {Number} Absolute rotation to set the camera to, in radians. 0 in the starting point.\n\t * @param silent {Boolean} Whether to avoid emitting events\n\t */\n\tpublic setRotation = (radians: number, silent?: boolean) => {\n\t\tif (isNaN(radians)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.state === CameraControlsState.NONE && !silent) {\n\t\t\tthis.publish('rotate-start');\n\t\t}\n\n\t\t// Negate the value to rotate clockwise instead of threejs counterclockwise rotation\n\t\tconst newRotation = -(radians % CAMERA_CONSTANTS.TWO_PI);\n\t\tif (newRotation !== this.orbit.rotation.z) {\n\t\t\tthis.orbit.rotation.z = newRotation;\n\t\t\tif (!silent) {\n\t\t\t\tthis.publish('rotation-updated');\n\t\t\t}\n\t\t}\n\t\tif (!silent) {\n\t\t\tthis.publish('change');\n\t\t}\n\n\t\tif (this.state === CameraControlsState.NONE && !silent) {\n\t\t\tthis.publish('rotate-end');\n\t\t}\n\n\t\tthis.dirty = true;\n\t\tthis.rotationDirty = true;\n\t\tif (!silent) {\n\t\t\tthis.stateDirty = true;\n\t\t}\n\t};\n\n\t/**\n\t * Sets the camera to be a certain distance from the anchor point, along it's tilt and rotation.\n\t * Keeps it inside minZoom and maxZoom.\n\t *\n\t * @param zoom {Number} The distance to set the camera to.\n\t */\n\tpublic setZoomAltitude = (zoom: number) => {\n\t\tif (isNaN(zoom)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.state === CameraControlsState.NONE) {\n\t\t\tthis.publish('zoom-start');\n\t\t}\n\n\t\tlet z = this.stayInsideBounds ? Math.min(Math.max(zoom, this.getZoomScaledMin()), this.getZoomScaledMax()) : zoom;\n\n\t\tif (z !== this.camera.position.z) {\n\t\t\tthis.camera.position.z = z;\n\t\t\tthis.publish('zoom-updated');\n\t\t\tthis.zoomDirty = true;\n\t\t}\n\n\t\tthis.camera.near = z / CAMERA_CONSTANTS.ZRANGE;\n\t\tthis.camera.far = z * CAMERA_CONSTANTS.ZRANGE;\n\t\tthis.camera.updateProjectionMatrix();\n\n\t\tthis.publish('change');\n\n\t\tif (this.state === CameraControlsState.NONE) {\n\t\t\tthis.publish('zoom-end');\n\t\t}\n\n\t\tthis.dirty = true;\n\t\tthis.stateDirty = true;\n\t};\n\n\t/**\n\t * Set the camera's zoom level in mercator zoom level units.\n\t */\n\tpublic setZoomLevel = (zoomLevel: number) => {\n\t\tthis.setZoomAltitude(this.convertZoomLevelToAltitude(zoomLevel));\n\t};\n\n\t/**\n\t * Returns the current camera zoom\n\t *\n\t * @return {Number} The distance of the camera from the anchor.\n\t */\n\tpublic getZoomAltitude = (): number => {\n\t\treturn this.camera.position.z;\n\t};\n\n\t/**\n\t * Current camera zoom in mercator zoom level units.\n\t */\n\tpublic getZoomLevel = (): number => {\n\t\treturn this.convertAltitudeToZoomLevel(this.getZoomAltitude());\n\t};\n\n\t/**\n\t * Sets the tilt to a specific level, in radians. 0 is top down. Bounded by minTilt and maxTilt.\n\t *\n\t * @param radians {Number} Tilt to set the camera to, in radians.\n\t * @param silent {Boolean} Whether to avoid emitting events.\n\t */\n\tpublic setTilt = (radians: number, silent?: boolean) => {\n\t\tif (isNaN(radians)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.state === CameraControlsState.NONE && !silent) {\n\t\t\tthis.publish('rotate-start');\n\t\t}\n\t\tconst newTilt = this.stayInsideBounds ? Math.max(Math.min(radians, this.maxTilt), this.minTilt) : radians;\n\t\tif (newTilt !== this.elevation.rotation.x) {\n\t\t\tthis.elevation.rotation.x = newTilt;\n\t\t\tif (!silent) {\n\t\t\t\tthis.publish('tilt-updated');\n\t\t\t}\n\t\t}\n\t\tif (!silent) {\n\t\t\tthis.publish('change');\n\t\t}\n\n\t\tif (this.state === CameraControlsState.NONE && !silent) {\n\t\t\tthis.publish('rotate-end');\n\t\t}\n\n\t\tthis.dirty = true;\n\t\tif (!silent) {\n\t\t\tthis.stateDirty = true;\n\t\t}\n\t};\n\n\t/**\n\t * Returns the current camera tilt\n\t *\n\t * @return {Number} The current tilt of the camera, in radians.\n\t */\n\tpublic getTilt = (): number => {\n\t\treturn this.elevation.rotation.x;\n\t};\n\n\t/**\n\t * @param elevation {number}\n\t * @hidden\n\t */\n\tpublic setCameraPlaneElevation = (elevation: number) => {\n\t\tthis.cameraPlane.position.z = elevation;\n\t};\n\n\t/**\n\t * Moves the camera towards or away from the camera by a set amount. Positive will zoom in (bringing the distance closer to 0).\n\t *\n\t * @param zoom {Number} The distance to increase or decrease the zoom.\n\t */\n\tpublic zoom = (zoomDelta: number) => {\n\t\tif (isNaN(zoomDelta)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.state === CameraControlsState.NONE) {\n\t\t\tthis.publish('zoom-start');\n\t\t}\n\n\t\tlet newZoom = this.getZoomAltitude() - zoomDelta;\n\t\tthis.camera.position.z = this.stayInsideBounds\n\t\t\t? Math.min(Math.max(newZoom, this.minZoomAltitude * this.zoomFactor), this.maxZoomAltitude * this.zoomFactor)\n\t\t\t: newZoom;\n\t\tthis.publish('zoom-updated');\n\t\tthis.zoomDirty = true;\n\t\tthis.publish('change');\n\n\t\tif (this.state === CameraControlsState.NONE) {\n\t\t\tthis.publish('zoom-end');\n\t\t}\n\t\tthis.stateDirty = true;\n\t};\n\n\t/**\n\t * Returns the current projection scale factor.\n\t * @param FOV {number} Field of view\n\t * @param canvasHeight {number} Height of the canvas\n\t * @param zoom{number} Zoom level\n\t */\n\tpublic getProjectionScaleFactor = (FOV: number, canvasHeight: number, zoom: number): number => {\n\t\treturn getProjectionScaleFactor(FOV, canvasHeight, zoom);\n\t};\n\n\t/**\n\t * Should probably be \"pre-render\". Anything we need to do before rendering the scene.\n\t *\n\t * @hidden\n\t */\n\tpublic update = () => {\n\t\tthis.orbit.updateMatrixWorld();\n\t\tif (\n\t\t\tthis.lastWheelTime > 0 &&\n\t\t\tthis.state === CameraControlsState.WHEEL_ZOOM &&\n\t\t\tthis.clock.getElapsedTime() - this.lastWheelTime > 0.2\n\t\t) {\n\t\t\tthis.lastWheelTime = 0;\n\t\t\tthis.state = CameraControlsState.NONE;\n\t\t\tthis.publish('zoom-end');\n\n\t\t\tthis.removeMouseMoveEventListeners();\n\t\t}\n\t};\n\n\tpublic setPedestal = (z: number, emitEvent = false, emitCameraStateChanged = true) => {\n\t\tif (typeof z === 'number' && !isNaN(z)) {\n\t\t\tthis.orbit.position.z = z;\n\t\t\tif (emitEvent) {\n\t\t\t\tthis.publishPedestalChangeEvent(z);\n\t\t\t\tthis.publish('pedestal-change', { pedestal: z });\n\t\t\t}\n\t\t\tthis.publish('change');\n\n\t\t\tthis.dirty = true;\n\t\t\tif (emitCameraStateChanged) {\n\t\t\t\tthis.stateDirty = true;\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Disposes of the camera and all of it's events.\n\t *\n\t * @hidden\n\t */\n\tpublic dispose = () => {\n\t\tfor (let eventName of CAMERA_CONSTANTS.EVENTS) {\n\t\t\tif (eventName.endsWith('start')) {\n\t\t\t\tthis.off(eventName, this.setCameraMoving);\n\t\t\t\tif (eventName.startsWith('user')) {\n\t\t\t\t\tthis.off(eventName, this.setUserInteracting);\n\t\t\t\t}\n\t\t\t} else if (eventName.endsWith('end') || eventName.endsWith('cancel')) {\n\t\t\t\tthis.off(eventName, this.unsetCameraMoving);\n\t\t\t\tif (eventName.startsWith('user')) {\n\t\t\t\t\tthis.off(eventName, this.unsetUserInteracting);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.removeEventListeners();\n\t\tthis.scene.remove(this.cameraPlane);\n\t\tthis.destroy();\n\t};\n\n\tprivate createCameraPlane = () => {\n\t\tconst size = DEBUG_CAMERA_PLANE ? 2000 : 10000000000;\n\t\tconst segments = DEBUG_CAMERA_PLANE ? 100 : 1;\n\t\tlet planeGeometry = new PlaneGeometry(size, size, segments, segments); // Should set this to be the map bounds later\n\t\tlet cameraPlaneMaterial = new MeshBasicMaterial({\n\t\t\tcolor: 0x000000,\n\t\t\twireframe: DEBUG_CAMERA_PLANE,\n\t\t\tvisible: DEBUG_CAMERA_PLANE,\n\t\t});\n\t\tconst cameraPlane = new Mesh(planeGeometry, cameraPlaneMaterial);\n\n\t\tthis.scene.add(cameraPlane);\n\n\t\treturn cameraPlane;\n\t};\n\n\tprivate addEventListeners = () => {\n\t\tconst { domElement } = this.renderer;\n\t\tfor (let eventName of CAMERA_CONSTANTS.EVENTS) {\n\t\t\tif (eventName.endsWith('start')) {\n\t\t\t\tthis.on(eventName, this.setCameraMoving);\n\t\t\t\tif (eventName.startsWith('user')) {\n\t\t\t\t\tthis.on(eventName, this.setUserInteracting);\n\t\t\t\t}\n\t\t\t} else if (eventName.endsWith('end') || eventName.endsWith('cancel')) {\n\t\t\t\tthis.on(eventName, this.unsetCameraMoving);\n\t\t\t\tif (eventName.startsWith('user')) {\n\t\t\t\t\tthis.on(eventName, this.unsetUserInteracting);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdomElement.addEventListener('contextmenu', this.onContextMenu, false);\n\t\tdomElement.addEventListener('mousedown', this.onMouseDown, false);\n\t\tdomElement.addEventListener('wheel', this.onMouseWheel, { passive: false });\n\n\t\tdomElement.addEventListener('touchstart', this.onTouchStart, false);\n\t\tdomElement.addEventListener('touchend', this.onTouchEnd, false);\n\t\tdomElement.addEventListener('touchmove', this.onTouchMove, false);\n\t};\n\n\tprivate addMouseEventListeners = () => {\n\t\tthis.addMouseMoveEventListeners();\n\t\twindow.addEventListener('mouseup', this.onMouseUp, false);\n\t\twindow.addEventListener('mouseout', this.onMouseUp, false);\n\t};\n\n\tprivate addMouseMoveEventListeners = () => {\n\t\tthis.renderer.domElement.addEventListener('mousemove', this.onMouseMove, false);\n\t};\n\n\tprivate removeMouseMoveEventListeners = () => {\n\t\tthis.renderer.domElement.removeEventListener('mousemove', this.onMouseMove, false);\n\t};\n\n\tprivate removeEventListeners = () => {\n\t\tconst { domElement } = this.renderer;\n\n\t\tdomElement.removeEventListener('contextmenu', this.onContextMenu, false);\n\t\tdomElement.removeEventListener('mousedown', this.onMouseDown, false);\n\t\tdomElement.removeEventListener('wheel', this.onMouseWheel, false);\n\n\t\tdomElement.removeEventListener('touchstart', this.onTouchStart, false);\n\t\tdomElement.removeEventListener('touchend', this.onTouchEnd, false);\n\t\tdomElement.removeEventListener('touchmove', this.onTouchMove, false);\n\n\t\tdomElement.removeEventListener('mousemove', this.onMouseMove, false);\n\t\twindow.removeEventListener('mouseup', this.onMouseUp, false);\n\t\twindow.removeEventListener('mouseout', this.onMouseUp, false);\n\t};\n\n\tprivate removeMouseUpEventListeners = () => {\n\t\tthis.renderer.domElement.removeEventListener('mousemove', this.onMouseMove, false);\n\t\twindow.removeEventListener('mouseup', this.onMouseUp, false);\n\t\twindow.removeEventListener('mouseout', this.onMouseUp, false);\n\t};\n\n\tprivate onContextMenu = (event: MouseEvent) => {\n\t\tevent.preventDefault();\n\t};\n\n\tprivate onMouseUp = () => {\n\t\tif (this.enabled === false) return;\n\n\t\tthis.removeMouseUpEventListeners();\n\n\t\tswitch (this.state) {\n\t\t\tcase CameraControlsState.PAN:\n\t\t\t\tthis.publish('pan-end');\n\t\t\t\tthis.publish('user-pan-end');\n\t\t\t\tbreak;\n\t\t\tcase CameraControlsState.DOLLY:\n\t\t\t\tthis.publish('zoom-end');\n\t\t\t\tthis.publish('user-dolly-end');\n\t\t\t\tbreak;\n\t\t\tcase CameraControlsState.ROTATE:\n\t\t\t\tthis.publish('rotate-end');\n\t\t\t\tthis.publish('user-rotate-end');\n\t\t\t\tbreak;\n\t\t\tcase CameraControlsState.PEDESTAL:\n\t\t\t\tthis.publish('pedestal-end');\n\t\t\t\tthis.publish('user-pedestal-end');\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.state = CameraControlsState.NONE;\n\t\tthis.panDirty = false;\n\t};\n\n\tprivate onMouseMove = (event: MouseEvent) => {\n\t\tif (this.enabled === false) return;\n\t\tevent.preventDefault();\n\t\tthis.mouseToScene(event);\n\n\t\tif (this.state === CameraControlsState.ROTATE) {\n\t\t\tif (this.enableRotate === false) return;\n\n\t\t\tthis.handleMouseMoveRotate(event);\n\t\t} else if (this.state === CameraControlsState.PAN) {\n\t\t\tif (this.enablePan === false) return;\n\n\t\t\tthis.handleMouseMovePan();\n\t\t} else if (this.state === CameraControlsState.WHEEL_ZOOM) {\n\t\t\tthis.resetZoom = true;\n\t\t\tthis.state = CameraControlsState.NONE;\n\t\t} else if (this.state === CameraControlsState.PEDESTAL) {\n\t\t\tthis.handleMouseMovePedestal(event);\n\t\t}\n\t};\n\n\tprivate onTouchStart = (event: TouchEvent) => {\n\t\tif (this.enabled === false) return;\n\n\t\tthis.updateTouchOrigin();\n\t\tthis.touchToScene(event);\n\t\tswitch (event.touches.length) {\n\t\t\tcase 1: // one-fingered touch: pan/pedestal\n\t\t\t\t// note - they are mutually exclusive as they use the same event\n\t\t\t\t// pedestal takes precedence\n\t\t\t\tif (this.enablePedestal) {\n\t\t\t\t\tthis.handleTouchStartPedestal(event);\n\t\t\t\t\tthis.state = CameraControlsState.TOUCH_PEDESTAL;\n\t\t\t\t} else if (this.enablePan) {\n\t\t\t\t\tthis.handleTouchStartPan(event);\n\t\t\t\t\tthis.state = CameraControlsState.TOUCH_PAN;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 2: // two-fingered touch: dolly/tilt\n\t\t\t\tthis.touch.inputs = new InputSet(this.touch.touches[0], this.touch.touches[1]);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthis.state = CameraControlsState.NONE;\n\t\t}\n\n\t\tif (this.state !== CameraControlsState.NONE) {\n\t\t\t// Probably don't need to do anything\n\t\t}\n\t};\n\n\tprivate onTouchMove = (event: TouchEvent) => {\n\t\tif (this.enabled === false) return;\n\n\t\tthis.touchToScene(event);\n\t\tswitch (event.touches.length) {\n\t\t\tcase 2: // two-fingered touch: dolly/tilt\n\t\t\t\t// Two finger touch should prevent default behavior\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tconst prevFirst = { ...this.touch.inputs!.first };\n\t\t\t\tconst prevSecond = { ...this.touch.inputs!.second };\n\t\t\t\tconst first = new Vector2(this.touch.touches[0].x, this.touch.touches[0].y);\n\t\t\t\tconst second = new Vector2(this.touch.touches[1].x, this.touch.touches[1].y);\n\t\t\t\tthis.touch.inputs!.update(this.touch.touches[0], this.touch.touches[1]);\n\n\t\t\t\tif (this.enableRotate && this.state === CameraControlsState.TOUCH_TILT) {\n\t\t\t\t\tthis.handleTouchMoveTilt(event);\n\t\t\t\t} else if (this.state === CameraControlsState.TOUCH_DOLLY) {\n\t\t\t\t\tthis.handleTouchMoveDolly();\n\t\t\t\t} else if (\n\t\t\t\t\t(this.state as CameraControlsState) !== CameraControlsState.TOUCH_DOLLY &&\n\t\t\t\t\tthis.touch.inputs!.totalDistance > 0.05\n\t\t\t\t) {\n\t\t\t\t\tconst movingUp = prevFirst.y < first.y && prevSecond.y < second.y;\n\t\t\t\t\tconst movingDown = prevFirst.y > first.y && prevSecond.y > second.y;\n\n\t\t\t\t\tif (this.enableRotate && this.state !== CameraControlsState.TOUCH_TILT && (movingDown || movingUp)) {\n\t\t\t\t\t\tthis.handleTouchStartTilt(event);\n\t\t\t\t\t\tthis.state = CameraControlsState.TOUCH_TILT;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.handleTouchStartDolly();\n\t\t\t\t\t\tthis.state = CameraControlsState.TOUCH_DOLLY;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 1: // one-fingered touch: pan/pedestal\n\t\t\t\t// One finger touch should only prevent default behavior if pan is enabled\n\t\t\t\tif (this.enablePedestal || this.enablePan) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t}\n\t\t\t\tif (this.enablePedestal && this.state === CameraControlsState.TOUCH_PEDESTAL) {\n\t\t\t\t\tthis.handleTouchMovePedestal(event);\n\t\t\t\t} else if (this.enablePan && this.state === CameraControlsState.TOUCH_PAN) {\n\t\t\t\t\tthis.handleTouchMovePan(event);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthis.state = CameraControlsState.NONE;\n\t\t}\n\t};\n\n\tprivate onTouchEnd = (event: TouchEvent) => {\n\t\tif (this.enabled === false) return;\n\n\t\tthis.handleTouchEnd();\n\n\t\tswitch (this.state) {\n\t\t\tcase CameraControlsState.PAN:\n\t\t\tcase CameraControlsState.TOUCH_PAN:\n\t\t\t\tthis.publish('user-pan-end');\n\t\t\t\tbreak;\n\t\t\tcase CameraControlsState.TOUCH_TILT:\n\t\t\t\tthis.publish('pan-end');\n\t\t\t\tthis.publish('user-tilt-end');\n\t\t\t\tbreak;\n\t\t\tcase CameraControlsState.DOLLY:\n\t\t\tcase CameraControlsState.TOUCH_DOLLY:\n\t\t\t\tthis.publish('zoom-end');\n\t\t\t\tthis.publish('user-dolly-end');\n\t\t\t\tbreak;\n\t\t\tcase CameraControlsState.ROTATE:\n\t\t\t\tthis.publish('rotate-end');\n\t\t\t\tthis.publish('user-rotate-end');\n\t\t\t\tbreak;\n\t\t\tcase CameraControlsState.PEDESTAL:\n\t\t\tcase CameraControlsState.TOUCH_PEDESTAL:\n\t\t\t\tthis.publish('pedestal-end');\n\t\t\t\tthis.publish('user-pedestal-end');\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (event.touches.length) {\n\t\t\t// user is still interacting, determine the new touch state\n\t\t\tthis.onTouchStart(event);\n\t\t} else {\n\t\t\tthis.state = CameraControlsState.NONE;\n\t\t}\n\t};\n\n\tprivate handleTouchMovePan = (event: TouchEvent | MouseEvent) => {\n\t\tconst vectorToCast = Object.hasOwn(event, 'x')\n\t\t\t? new Vector2((event as MouseEvent).x, (event as MouseEvent).y)\n\t\t\t: this.touch.touches[0];\n\t\t// Not sure why we do need event.x here but let's keep it for now\n\t\tlet pos = this.raycastToFloor(vectorToCast);\n\t\tthis.coords.panEnd.set(pos.x, pos.y, 0);\n\n\t\tthis.coords.panDelta.subVectors(this.coords.panEnd, this.coords.panStart);\n\n\t\tthis.setPosition(\n\t\t\tthis.coords.panCameraStart.x - this.coords.panDelta.x,\n\t\t\tthis.coords.panCameraStart.y - this.coords.panDelta.y,\n\t\t);\n\n\t\tthis.publish('change');\n\t\tthis.panDirty = true;\n\t};\n\n\tprivate handleTouchStartDolly = () => {\n\t\tlet dx = this.touch.touches[0].x - this.touch.touches[1].x;\n\t\tlet dy = this.touch.touches[0].y - this.touch.touches[1].y;\n\t\tthis.zoomStart = this.getZoomAltitude();\n\t\tlet pos = new Vector2(this.touch.touches[0].x - dx / 2, this.touch.touches[0].y - dy / 2);\n\t\tthis.coords.floorAnchor = this.raycastToFloor(pos);\n\n\t\tthis.orbit.updateMatrixWorld();\n\n\t\tthis.touch.anchor1 = new TouchAnchor(this.touch.touches[0], this.camera, this.cameraPlane);\n\n\t\tthis.touch.anchor2 = new TouchAnchor(this.touch.touches[1], this.camera, this.cameraPlane);\n\n\t\tthis.coords.panCameraStart.set(this.orbit.position.x, this.orbit.position.y, 0);\n\n\t\tthis.publish('user-dolly-start');\n\t\tthis.publish('zoom-start');\n\t\tthis.publish('multi-start');\n\t};\n\n\tprivate handleMouseMovePan = () => {\n\t\tlet pos = this.raycastToFloor(this.coords.mouse);\n\t\tthis.coords.panEnd.set(pos.x, pos.y, 0);\n\n\t\tthis.coords.panDelta.subVectors(this.coords.panEnd, this.coords.panStart);\n\t\tthis.setPosition(\n\t\t\tthis.coords.panCameraStart.x - this.coords.panDelta.x,\n\t\t\tthis.coords.panCameraStart.y - this.coords.panDelta.y,\n\t\t);\n\n\t\tthis.publish('change');\n\t\tthis.panDirty = true;\n\t};\n\n\tprivate handleTouchStartTilt = (event: TouchEvent) => {\n\t\tthis.coords.rotateStart.set(event.touches[1].clientX, event.touches[1].clientY);\n\t\tthis.publish('user-tilt-start');\n\t\tthis.publish('rotate-start');\n\t};\n\n\tprivate handleTouchMovePedestal = (event: TouchEvent) => {\n\t\tthis.handleMouseMovePedestal(event.touches[0]);\n\t};\n\n\tprivate handleTouchMoveTilt = (event: TouchEvent) => {\n\t\tthis.coords.rotateEnd.set(event.touches[1].clientX, event.touches[1].clientY);\n\t\tthis.coords.rotateDelta.subVectors(this.coords.rotateEnd, this.coords.rotateStart);\n\n\t\tthis.setTilt(this.getTilt() - this.coords.rotateDelta.y / this.rotateSpeed);\n\n\t\tthis.coords.rotateStart.copy(this.coords.rotateEnd);\n\t};\n\n\tprivate handleTouchMoveDolly = () => {\n\t\tconst first = this.touch.inputs!.first;\n\t\tconst second = this.touch.inputs!.second;\n\n\t\tthis.touch.anchor1!.viewCoordinate = { x: first.x, y: first.y };\n\t\tthis.touch.anchor2!.viewCoordinate = { x: second.x, y: second.y };\n\n\t\tlet newMatrix = this.makeTransformFromTouchAnchors(this.touch.anchor1!, this.touch.anchor2!);\n\t\tif (newMatrix) {\n\t\t\tthis.setCameraFromTransformMatrix(newMatrix);\n\t\t}\n\n\t\tthis.orbit.updateMatrixWorld();\n\t\tthis.touch.anchor1!.updateAnchorState(this.camera, first);\n\t\tthis.touch.anchor2!.updateAnchorState(this.camera, second);\n\t};\n\n\tprivate handleTouchEnd = () => {\n\t\tif (this.state === CameraControlsState.TOUCH_TILT || this.state === CameraControlsState.TOUCH_DOLLY) {\n\t\t\tthis.publish('multi-end');\n\t\t} else if (this.state === CameraControlsState.TOUCH_PAN) {\n\t\t\tthis.publish('pan-end');\n\t\t}\n\t\tthis.panDirty = false;\n\t};\n\n\tprivate handleTouchStartPan = (event: TouchEvent | MouseEvent) => {\n\t\tconst vectorToCast = Object.hasOwn(event, 'x')\n\t\t\t? new Vector2((event as MouseEvent).x, (event as MouseEvent).y)\n\t\t\t: this.touch.touches[0];\n\t\t// Not sure why we do need event.x here but let's keep it for now\n\t\tlet pos = this.raycastToFloor(vectorToCast);\n\n\t\tthis.coords.panStart.set(pos.x, pos.y, 0);\n\t\tthis.coords.panCameraStart.set(this.orbit.position.x, this.orbit.position.y, 0);\n\n\t\tthis.publish('user-pan-start');\n\t\tthis.publish('pan-start');\n\t};\n\n\tprivate handleTouchStartPedestal = (event: TouchEvent) => {\n\t\tthis.handleMouseDownPedestal(event.touches[0]);\n\t};\n\n\tprivate onMouseDown = (event: MouseEvent) => {\n\t\tif (this.enabled === false) return;\n\t\tthis.mouseToScene(event);\n\t\tevent.preventDefault();\n\n\t\tif (this.state === CameraControlsState.WHEEL_ZOOM) {\n\t\t\tthis.publish('zoom-end');\n\t\t}\n\n\t\tif (event.button === this.MOUSE_BUTTONS.ORBIT) {\n\t\t\tif (this.enableRotate === false) return;\n\n\t\t\tthis.handleMouseDownRotate(event);\n\n\t\t\tthis.state = CameraControlsState.ROTATE;\n\t\t} else if (event.button === this.MOUSE_BUTTONS.PAN) {\n\t\t\tif (this.enablePan) {\n\t\t\t\tthis.handleMouseDownPan();\n\t\t\t\tthis.state = CameraControlsState.PAN;\n\t\t\t} else if (this.enablePedestal) {\n\t\t\t\tthis.handleMouseDownPedestal(event);\n\t\t\t\tthis.state = CameraControlsState.PEDESTAL;\n\t\t\t}\n\t\t}\n\n\t\tif (this.state !== CameraControlsState.NONE) {\n\t\t\tthis.addMouseEventListeners();\n\t\t}\n\t};\n\n\tprivate onMouseWheel = (event: WheelEvent) => {\n\t\tif (\n\t\t\tthis.enabled === false ||\n\t\t\tthis.enableZoom === false ||\n\t\t\t(this.state !== CameraControlsState.NONE && this.state !== CameraControlsState.WHEEL_ZOOM)\n\t\t)\n\t\t\treturn;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tthis.mouseToScene(event);\n\n\t\tif (this.canScrollZoom(event)) {\n\t\t\tthis.lastWheelTime = this.clock.getElapsedTime();\n\t\t\tthis.publishUserZoomEvent();\n\t\t}\n\t\tif (this.state !== CameraControlsState.WHEEL_ZOOM && this.canScrollZoom(event)) {\n\t\t\tthis.addMouseMoveEventListeners();\n\t\t\tthis.state = CameraControlsState.WHEEL_ZOOM;\n\t\t\tthis.zoomStart = this.getZoomAltitude();\n\t\t\tthis.coords.floorAnchor = this.raycastToFloor(this.coords.mouse);\n\t\t\tthis.coords.panCameraStart.set(this.orbit.position.x, this.orbit.position.y, 0);\n\n\t\t\tthis.publish('zoom-start');\n\t\t}\n\t\tif (this.scrollTimer != null) {\n\t\t\tclearTimeout(this.scrollTimer);\n\t\t}\n\n\t\tthis.scrollTimer = setTimeout(() => {\n\t\t\tthis.publish('zoom-end');\n\t\t}, 50) as unknown as number;\n\n\t\tthis.handleMouseWheel(event);\n\t};\n\n\tprivate handleMouseWheel = (event: WheelEvent) => {\n\t\tthis.publish('zoom-start');\n\n\t\tif (!this.canScrollZoom(event)) {\n\t\t\tif (this.lastWheelTime > 0) {\n\t\t\t\tthis.publish('zoom-end');\n\t\t\t}\n\t\t\tthis.lastWheelTime = 0;\n\t\t\tthis.state = CameraControlsState.NONE;\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet currentZoom = this.getZoomAltitude();\n\n\t\tlet zoom =\n\t\t\tcurrentZoom - ((getScrollDelta(event) * currentZoom) / CAMERA_CONSTANTS.WHEEL_ZOOM_MULTIPLIER) * this.zoomSpeed;\n\t\tthis.setZoomAltitude(zoom);\n\n\t\tif (this.enablePan) {\n\t\t\tlet zoomPercent = zoom / this.zoomStart;\n\n\t\t\tthis.coords.panDelta\n\t\t\t\t.subVectors(this.coords.floorAnchor, this.coords.panCameraStart)\n\t\t\t\t.multiplyScalar(1 - zoomPercent);\n\n\t\t\tthis.setPosition(\n\t\t\t\tthis.coords.panCameraStart.x + this.coords.panDelta.x,\n\t\t\t\tthis.coords.panCameraStart.y + this.coords.panDelta.y,\n\t\t\t);\n\t\t}\n\n\t\tthis.publish('change');\n\t};\n\n\t/*\n\tSet the rotation, position and zoom of the camera system from a matrix\n\trepresenting the desired world transform of the camera's point.\n\t*/\n\tprivate setCameraFromTransformMatrix = transform => {\n\t\tthis.orbit.updateMatrixWorld();\n\n\t\tlet newAngle = new Euler();\n\t\tnewAngle.setFromRotationMatrix(transform, 'ZYX');\n\n\t\tlet zoom = (transform.elements[14] - this.cameraPlane.position.z) / Math.cos(newAngle.x);\n\t\tlet rotation = newAngle.z;\n\n\t\tlet vectorToGround = new Vector3(0, 0, 1);\n\t\tvectorToGround.applyEuler(newAngle);\n\t\tvectorToGround.setLength(zoom);\n\n\t\tlet groundPosition = new Vector3();\n\t\tgroundPosition.setFromMatrixPosition(transform);\n\t\tgroundPosition.sub(vectorToGround);\n\n\t\tif (this.enablePan) {\n\t\t\tthis.setPosition(groundPosition.x, groundPosition.y);\n\t\t}\n\t\tif (this.enableZoom) {\n\t\t\tthis.setZoomAltitude(zoom);\n\t\t}\n\t\tif (this.enableRotate) {\n\t\t\t// Since setRotation expects clockwise from North we need to invert the rotation from our matrix\n\t\t\tthis.setRotation(-rotation);\n\t\t}\n\t};\n\n\t/*\n\tFrom two touch anchors, determine a world-transform matrix for the camera\n\tthat will keep those anchors attached to the same world position.\n\n\tPorted from iOS camera controls' move function.\n\tTODO: Document this better; see CE-750.\n\t*/\n\tprivate makeTransformFromTouchAnchors = (touchAnchor1: TouchAnchor, touchAnchor2: TouchAnchor) => {\n\t\tthis.orbit.updateMatrixWorld();\n\t\tthis.camera.updateProjectionMatrix();\n\n\t\tlet p = this.camera.projectionMatrix.clone();\n\n\t\tlet w1 = touchAnchor1.worldCoordinate;\n\t\tlet w2 = touchAnchor2.worldCoordinate;\n\n\t\tlet nw1 = touchAnchor1.reUnproject();\n\t\tlet nw2 = touchAnchor2.reUnproject();\n\n\t\tif (!nw1 || !nw2 || !w1 || !w2) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet s1 = touchAnchor1.viewCoordinate;\n\t\tlet s2 = touchAnchor2.viewCoordinate;\n\n\t\tlet xd1 = w2.x - w1.x;\n\t\tlet yd1 = w2.y - w1.y;\n\t\tlet angle1 = Math.atan2(yd1, xd1);\n\n\t\tlet xd2 = nw2.x - nw1.x;\n\t\tlet yd2 = nw2.y - nw1.y;\n\t\tlet angle2 = Math.atan2(yd2, xd2);\n\n\t\tlet zAngleDelta = differenceBetweenAngles(angle1, angle2);\n\n\t\tlet yawAdjustment = new Matrix4();\n\t\tyawAdjustment.makeRotationZ(-zAngleDelta);\n\t\tlet t = yawAdjustment.clone();\n\t\tt.multiply(touchAnchor1.snapHolderMatrix);\n\n\t\t// Matrix subscript helper\n\t\tlet m = (o, a, b) => o.elements[(a - 1) * 4 + b - 1];\n\n\t\tlet x1 = m(p, 1, 1) * m(t, 1, 1) - s1.x * m(p, 3, 4) * m(t, 3, 1);\n\t\tlet y1 = m(p, 1, 1) * m(t, 1, 2) - s1.x * m(p, 3, 4) * m(t, 3, 2);\n\t\tlet z1 = m(p, 1, 1) * m(t, 1, 3) - s1.x * m(p, 3, 4) * m(t, 3, 3);\n\t\tlet c1 = w1.x * x1 + w1.y * y1 + w1.z * z1;\n\n\t\tlet x2 = m(p, 2, 2) * m(t, 2, 1) - s1.y * m(p, 3, 4) * m(t, 3, 1);\n\t\tlet y2 = m(p, 2, 2) * m(t, 2, 2) - s1.y * m(p, 3, 4) * m(t, 3, 2);\n\t\tlet z2 = m(p, 2, 2) * m(t, 2, 3) - s1.y * m(p, 3, 4) * m(t, 3, 3);\n\t\tlet c2 = w1.x * x2 + w1.y * y2 + w1.z * z2;\n\n\t\tlet x3 = m(p, 1, 1) * m(t, 1, 1) - s2.x * m(p, 3, 4) * m(t, 3, 1);\n\t\tlet y3 = m(p, 1, 1) * m(t, 1, 2) - s2.x * m(p, 3, 4) * m(t, 3, 2);\n\t\tlet z3 = m(p, 1, 1) * m(t, 1, 3) - s2.x * m(p, 3, 4) * m(t, 3, 3);\n\t\tlet c3 = w2.x * x3 + w2.y * y3 + w2.z * z3;\n\n\t\tlet xb = m(p, 2, 2) * m(t, 2, 1) - s2.y * m(p, 3, 4) * m(t, 3, 1);\n\t\tlet yb = m(p, 2, 2) * m(t, 2, 2) - s2.y * m(p, 3, 4) * m(t, 3, 2);\n\t\tlet zb = m(p, 2, 2) * m(t, 2, 3) - s2.y * m(p, 3, 4) * m(t, 3, 3);\n\t\tlet cb = w2.x * xb + w2.y * yb + w2.z * zb;\n\n\t\tlet dx1 = Math.abs(x3 - x1);\n\t\tlet dy1 = Math.abs(y3 - y1);\n\t\tlet dz1 = Math.abs(z3 - z1);\n\t\tlet dx2 = Math.abs(x3 - x2);\n\t\tlet dy2 = Math.abs(y3 - y2);\n\t\tlet dz2 = Math.abs(z3 - z2);\n\n\t\tlet dx3 = Math.abs(xb - x1);\n\t\tlet dy3 = Math.abs(yb - y1);\n\t\tlet dz3 = Math.abs(zb - z1);\n\t\tlet dx4 = Math.abs(xb - x2);\n\t\tlet dy4 = Math.abs(yb - y2);\n\t\tlet dz4 = Math.abs(zb - z2);\n\n\t\tlet min1 = Math.min(dx1 + dy1 + dz1, dx2 + dy2 + dz2);\n\t\tlet min2 = Math.min(dx3 + dy3 + dz3, dx4 + dy4 + dz4);\n\n\t\tif (min1 < min2) {\n\t\t\tx3 = xb;\n\t\t\ty3 = yb;\n\t\t\tz3 = zb;\n\t\t\tc3 = cb;\n\t\t}\n\n\t\tlet x4 = x2 * z1 - x1 * z2;\n\t\tlet y4 = y2 * z1 - y1 * z2;\n\t\tlet c4 = c2 * z1 - c1 * z2;\n\n\t\tlet x5 = x3 * z2 - x2 * z3;\n\t\tlet y5 = y3 * z2 - y2 * z3;\n\t\tlet c5 = c3 * z2 - c2 * z3;\n\n\t\tlet x = (c5 * y4 - c4 * y5) / (x5 * y4 - x4 * y5);\n\t\tlet y = (c5 * x4 - c4 * x5) / (y5 * x4 - y4 * x5);\n\n\t\tlet y6 = y2 * x1 - y1 * x2;\n\t\tlet z6 = z2 * x1 - z1 * x2;\n\t\tlet c6 = c2 * x1 - c1 * x2;\n\n\t\tlet y7 = y3 * x2 - y2 * x3;\n\t\tlet z7 = z3 * x2 - z2 * x3;\n\t\tlet c7 = c3 * x2 - c2 * x3;\n\n\t\tlet z = (c7 * y6 - c6 * y7) / (z7 * y6 - z6 * y7);\n\n\t\tlet finalTransformMatrix = t.clone();\n\t\tfinalTransformMatrix.elements[12] = x;\n\t\tfinalTransformMatrix.elements[13] = y;\n\t\tfinalTransformMatrix.elements[14] = z;\n\t\tif (z > 0) {\n\t\t\treturn finalTransformMatrix;\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t};\n\n\tprivate updateTouchOrigin = () => {\n\t\tlet touchOriginElement = this.renderer.domElement;\n\t\tthis.touch.origin.offsetLeft = touchOriginElement.getBoundingClientRect().left;\n\t\tthis.touch.origin.offsetTop = touchOriginElement.getBoundingClientRect().top;\n\t};\n\n\tprivate touchToScene = (event: TouchEvent) => {\n\t\tthis.touch.touches = [];\n\t\tfor (let i = 0, iLen = event.touches.length; i < iLen; i++) {\n\t\t\tlet touch = event.touches[i];\n\t\t\tlet pos = getTouchPos(touch, this.touch.origin);\n\t\t\tthis.touch.touches.push(\n\t\t\t\tnew Vector2(\n\t\t\t\t\t(pos.x / this.renderer.domElement.width) * this.rendererState.pixelRatio * 2 - 1,\n\t\t\t\t\t-((pos.y / this.renderer.domElement.height) * this.rendererState.pixelRatio) * 2 + 1,\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\t\tthis.coords.mouse = this.touch.touches[0];\n\t};\n\n\tprivate canScrollZoom = (event: MouseEvent | WheelEvent) => {\n\t\tlet delta = getScrollDelta(event);\n\n\t\tlet currentZoom = this.getZoomAltitude();\n\n\t\treturn !(\n\t\t\t(delta < 0 && currentZoom === this.getZoomScaledMax()) ||\n\t\t\t(delta > 0 && currentZoom === this.getZoomScaledMin())\n\t\t);\n\t};\n\n\tprivate mouseToScene = (event: MouseEvent | WheelEvent) => {\n\t\tlet pos = this.getMousePos(event);\n\t\tthis.coords.mouse.x = (pos.x / this.renderer.domElement.width) * this.rendererState.pixelRatio * 2 - 1;\n\t\tthis.coords.mouse.y = -((pos.y / this.renderer.domElement.height) * this.rendererState.pixelRatio) * 2 + 1;\n\n\t\treturn this.coords.mouse;\n\t};\n\n\tprivate getMousePos = (event: MouseEvent | WheelEvent) => {\n\t\treturn {\n\t\t\tx: event.offsetX,\n\t\t\ty: event.offsetY,\n\t\t};\n\t};\n\n\tprivate handleMouseDownRotate = (event: MouseEvent) => {\n\t\tthis.coords.rotateStart.set(event.clientX, event.clientY);\n\t\tthis.publish('rotate-start');\n\t\tthis.publish('user-rotate-start');\n\t};\n\n\tprivate handleMouseDownPan = () => {\n\t\tlet pos = this.raycastToFloor(this.coords.mouse);\n\n\t\tthis.coords.panStart.set(pos.x, pos.y, 0);\n\t\tthis.coords.panCameraStart.set(this.orbit.position.x, this.orbit.position.y, 0);\n\t\tthis.publish('pan-start');\n\t\tthis.publish('user-pan-start');\n\t};\n\n\tprivate handleMouseDownPedestal = (event: Touch | MouseEvent) => {\n\t\tconst pos = new Vector2(event.clientX, event.clientY);\n\t\tthis.coords.initialShiftPos = pos;\n\t\tthis.coords.initialPedestal = this.getPedestal();\n\t\tthis.pedestalScaleFactor = getProjectionScaleFactor(\n\t\t\tthis.camera.fov,\n\t\t\tthis.renderer.domElement.clientHeight,\n\t\t\tthis.getZoomAltitude(),\n\t\t);\n\t\tthis.publish('pedestal-start');\n\t\tthis.publish('user-pedestal-start');\n\t};\n\n\tprivate handleMouseMovePedestal = (event: Touch | MouseEvent) => {\n\t\tconst pos = { x: event.clientX, y: event.clientY };\n\t\tlet newZ = this.coords.initialPedestal + this.pedestalScaleFactor * (pos.y - this.coords.initialShiftPos.y);\n\n\t\t// clamp to min/max\n\t\tif (this.stayInsideBounds) {\n\t\t\tif (newZ < this.minPedestal) {\n\t\t\t\tnewZ = Math.max(newZ, this.minPedestal);\n\t\t\t} else if (newZ > this.maxPedestal) {\n\t\t\t\tnewZ = Math.min(newZ, this.maxPedestal);\n\t\t\t}\n\t\t}\n\n\t\tif (newZ === this.getPedestal()) {\n\t\t\treturn;\n\t\t}\n\t\tthis.setPedestal(newZ, true);\n\t};\n\n\tprivate handleMouseMoveRotate = (event: MouseEvent) => {\n\t\tthis.coords.rotateEnd.set(event.clientX, event.clientY);\n\t\tthis.coords.rotateDelta.subVectors(this.coords.rotateEnd, this.coords.rotateStart);\n\n\t\tthis.setRotation(this.getRotation() + this.coords.rotateDelta.x / this.rotateSpeed);\n\t\tthis.setTilt(this.getTilt() - this.coords.rotateDelta.y / this.rotateSpeed);\n\n\t\tthis.coords.rotateStart.copy(this.coords.rotateEnd);\n\n\t\tthis.publish('change');\n\t};\n\n\tprivate publishUserZoomDebounced = debounce(() => {\n\t\t// publish user zoom end\n\t\tthis.isUserZooming = false;\n\t\tthis.publish('user-zoom-end');\n\t}, 250);\n\n\tprivate publishUserZoomEvent = () => {\n\t\tif (this.isUserZooming) {\n\t\t\tthis.publishUserZoomDebounced();\n\t\t} else {\n\t\t\tthis.publish('user-zoom-start');\n\t\t\tthis.isUserZooming = true;\n\t\t\tthis.publishUserZoomDebounced();\n\t\t}\n\t};\n\n\tprivate setCameraMoving = () => {\n\t\tthis.cameraMoving = true;\n\t};\n\n\tprivate unsetCameraMoving = () => {\n\t\tthis.cameraMoving = false;\n\t\tthis.lastCameraMoveTime = Date.now();\n\t};\n\n\tprivate setUserInteracting = () => {\n\t\tthis.userInteracting = true;\n\t};\n\n\tprivate unsetUserInteracting = () => {\n\t\tthis.userInteracting = false;\n\t};\n\n\tprivate publishPedestalChangeEvent = (newZ: number) => {\n\t\tthis.publish('pedestal-change', {\n\t\t\tpedestal: newZ,\n\t\t\tscrolledToTop: this.scrolledToTop,\n\t\t\tscrolledToBottom: this.scrolledToBottom,\n\t\t\tscrollPercent: this.scrollPercent,\n\t\t});\n\t};\n\n\t/**\n\t * Converts the altitude to the mercator zoom level.\n\t * @param altitude {number} The altitude in meters.\n\t */\n\tconvertAltitudeToZoomLevel = (altitude: number): number => {\n\t\t// [Anzor] OK, so it's not technically altitude, because we return the camera Z distance\n\t\t// but this should do for now\n\t\tconst [, lat] = this.center;\n\n\t\tconst metersPerPixel = this.computeMetersPerPixelFromAltitude(altitude);\n\t\tconst mapPixelWidthAtZoom = (Math.cos(MathUtils.degToRad(lat)) * 2 * Math.PI * EARTH_RADIUS_M) / metersPerPixel;\n\n\t\tconst zoomLevel = MathUtils.clamp(\n\t\t\tMath.log2(mapPixelWidthAtZoom / CAMERA_CONSTANTS.MAPLIBRE_TILE_SIZE),\n\t\t\tCAMERA_CONSTANTS.MIN_MERCATOR_ZOOM_LEVEL,\n\t\t\tCAMERA_CONSTANTS.MAX_MERCATOR_ZOOM_LEVEL,\n\t\t);\n\n\t\treturn zoomLevel;\n\t};\n\n\t/**\n\t * Converts a mercator zoom level to an altitude in meters.\n\t * @param zoomLevel{number} The mercator zoom level\n\t */\n\tconvertZoomLevelToAltitude = (zoomLevel: number) => {\n\t\tconst metersTall = this.computeMetersPerPixelFromZoomLevel(zoomLevel) * this.options.canvasHeight;\n\n\t\tconst altitude = metersTall / 2 / Math.tan(MathUtils.degToRad(this.camera.fov) / 2);\n\n\t\treturn altitude;\n\t};\n\n\tprivate completeTween = (tween: Tween) => {\n\t\tif (tween.isPlaying()) {\n\t\t\ttween.stop();\n\t\t}\n\t\tthis.rendererState.internalTweenGroup.remove(tween);\n\t\tthis.tweens.delete(tween);\n\t};\n\n\tstatic CAMERA_FRAME_PADDING_SIDES = ['top', 'bottom', 'left', 'right'] as const;\n\n\tdebugContainer = new Object3D();\n\n\tgetCameraFrameForCoordinates(pointCloud: Vector3[], options: CameraFocusOnOptions & { padding: InsetPadding }) {\n\t\tconst minZoom = options.minZoom !== undefined ? options.minZoom : this.minZoomAltitude;\n\t\tconst maxZoom = options.maxZoom !== undefined ? options.maxZoom : this.maxZoomAltitude;\n\n\t\tconst canvasWidth = this.options.canvasWidth;\n\t\tconst canvasHeight = this.options.canvasHeight;\n\n\t\tconst currentRotation = this.getRotation();\n\t\tconst currentTilt = this.getTilt();\n\t\tconst position = this.getPosition();\n\n\t\tthis.setRotation(options.rotation ?? currentRotation, true);\n\t\tthis.setTilt(options.tilt ?? currentTilt, true);\n\n\t\tconst frame = getCameraFrameForPoints(pointCloud, {\n\t\t\tcanvasWidth,\n\t\t\tcanvasHeight,\n\t\t\tpaddingOption: options.padding,\n\t\t\tverticalPadding: options.verticalPadding,\n\t\t\tminZoom,\n\t\t\tmaxZoom,\n\t\t\tposition,\n\t\t\tcamera: this.camera,\n\t\t\torbit: this.orbit,\n\t\t});\n\n\t\tthis.setRotation(currentRotation, true);\n\t\tthis.setTilt(currentTilt, true);\n\n\t\treturn {\n\t\t\tcenter: frame.position,\n\t\t\tzoomLevel: this.convertAltitudeToZoomLevel(frame.zoom),\n\t\t};\n\t}\n\n\tfocusOn(pointCloud: Vector3[], options: CameraFocusOnOptions & { padding: InsetPadding }) {\n\t\tif (DEBUG_FOCUS_ON) {\n\t\t\tif (this.debugContainer) {\n\t\t\t\tdestroyObject3D(this.debugContainer);\n\t\t\t}\n\n\t\t\t// Create instanced mesh for all points\n\t\t\tconst geometry = new BoxGeometry(4, 4, 4);\n\t\t\tconst material = new MeshBasicMaterial({ color: 0x00ff00, depthTest: false });\n\t\t\tconst instancedMesh = new InstancedMesh(geometry, material, pointCloud.length);\n\n\t\t\t// Set position for each instance\n\t\t\tconst matrix = new Matrix4();\n\t\t\tpointCloud.forEach((point, index) => {\n\t\t\t\tmatrix.setPosition(point);\n\t\t\t\tinstancedMesh.setMatrixAt(index, matrix);\n\t\t\t});\n\n\t\t\tinstancedMesh.instanceMatrix.needsUpdate = true;\n\t\t\tthis.debugContainer.add(instancedMesh);\n\t\t\tthis.scene.add(this.debugContainer);\n\t\t}\n\n\t\tconst curve = options.curve;\n\t\tconst callback = options.callback;\n\t\tconst cancelledCallback = options.cancelledCallback;\n\n\t\tconst minZoom = options.minZoom !== undefined ? options.minZoom : this.minZoomAltitude;\n\t\tconst maxZoom = options.maxZoom !== undefined ? options.maxZoom : this.maxZoomAltitude;\n\n\t\tconst canvasWidth = this.options.canvasWidth;\n\t\tconst canvasHeight = this.options.canvasHeight;\n\n\t\tlet duration;\n\t\tif (options.duration !== undefined) {\n\t\t\tduration = options.duration;\n\t\t} else if (process.env.TESTING === 'true') {\n\t\t\tduration = 0;\n\t\t} else {\n\t\t\tduration = CAMERA_CONSTANTS.DEFAULT_ANIMATION_DURATION;\n\t\t}\n\n\t\tconst padding = options.padding;\n\t\tconst currentRotaion = this.getRotation();\n\t\tconst currentTilt = this.getTilt();\n\n\t\tif (options.rotation != null) {\n\t\t\tthis.setRotation(options.rotation);\n\t\t}\n\t\tif (options.tilt != null) {\n\t\t\tthis.setTilt(options.tilt);\n\t\t}\n\n\t\tconst frame = getCameraFrameForPoints(pointCloud, {\n\t\t\tcanvasHeight,\n\t\t\tpaddingOption: padding,\n\t\t\tcanvasWidth,\n\t\t\tminZoom,\n\t\t\tmaxZoom,\n\t\t\tcamera: this.camera,\n\t\t\torbit: this.orbit,\n\t\t\tposition: this.getPosition(),\n\t\t\tverticalPadding: options.verticalPadding,\n\t\t});\n\n\t\tthis.setRotation(currentRotaion);\n\t\tthis.setTilt(currentTilt);\n\n\t\tthis.animateCamera(\n\t\t\t{\n\t\t\t\tposition: frame.position,\n\t\t\t\ttilt: options.tilt,\n\t\t\t\trotation: options.rotation,\n\t\t\t\tzoom: frame.zoom,\n\t\t\t},\n\t\t\tduration,\n\t\t\tcurve,\n\t\t\tcallback,\n\t\t\tcancelledCallback,\n\t\t\toptions,\n\t\t);\n\t}\n\n\tresize(canvasWidth: number, canvasHeight: number) {\n\t\tthis.options.canvasWidth = canvasWidth;\n\t\tthis.options.canvasHeight = canvasHeight;\n\t}\n\n\tcomputeMetersPerPixelFromZoomLevel(zoomLevel: number) {\n\t\tconst [, lat] = this.center;\n\n\t\tconst constrainedZoom = MathUtils.clamp(\n\t\t\tzoomLevel,\n\t\t\tCAMERA_CONSTANTS.MIN_MERCATOR_ZOOM_LEVEL,\n\t\t\tCAMERA_CONSTANTS.MAX_MERCATOR_ZOOM_LEVEL,\n\t\t);\n\n\t\tconst constrainedScale = Math.pow(2, constrainedZoom);\n\t\tconst constrainedLatitude = MathUtils.clamp(lat, CAMERA_CONSTANTS.MIN_LAT, CAMERA_CONSTANTS.MAX_LAT);\n\t\tconst worldSize = constrainedScale * CAMERA_CONSTANTS.MAPLIBRE_TILE_SIZE;\n\n\t\treturn (Math.cos(MathUtils.degToRad(constrainedLatitude)) * Math.PI * 2 * EARTH_RADIUS_M) / worldSize;\n\t}\n\n\tcomputeMetersPerPixelFromAltitude(altitude: number) {\n\t\tconst metersTall = altitude * 2 * Math.tan(MathUtils.degToRad(this.camera.fov) / 2);\n\t\treturn metersTall / this.options.canvasHeight;\n\t}\n\n\tgetCurrentMetersPerPixel() {\n\t\treturn this.computeMetersPerPixelFromAltitude(this.getZoomAltitude());\n\t}\n}\nexport { CameraSystem };\n\nexport function getCameraFrameForPoints(\n\tpointCloud: Vector3[],\n\t{\n\t\tcanvasWidth,\n\t\torbit,\n\t\tpaddingOption,\n\t\tverticalPadding = 0,\n\t\tcanvasHeight,\n\t\tminZoom,\n\t\tmaxZoom,\n\t\tcamera,\n\t\tposition,\n\t}: {\n\t\tpaddingOption: InsetPadding;\n\t\tcanvasWidth: number;\n\t\tcanvasHeight: number;\n\t\tminZoom: number;\n\t\tmaxZoom: number;\n\t\torbit: Object3D;\n\t\tcamera: PerspectiveCamera;\n\t\tposition: Vector3;\n\t\tverticalPadding?: number;\n\t},\n): { position: Vector3; zoom: number } {\n\tconst results = {\n\t\tzoom: minZoom,\n\t\tposition,\n\t};\n\n\tif (pointCloud.length === 0) {\n\t\treturn results;\n\t}\n\n\tfor (let side of CameraSystem.CAMERA_FRAME_PADDING_SIDES) {\n\t\tif (typeof paddingOption[side] !== 'number') {\n\t\t\tpaddingOption[side] = 0;\n\t\t}\n\t}\n\n\tconst padding: InsetPadding =\n\t\tpaddingOption.type === 'portion'\n\t\t\t? {\n\t\t\t\t\ttop: paddingOption.top * canvasHeight,\n\t\t\t\t\tbottom: paddingOption.bottom * canvasHeight,\n\t\t\t\t\tleft: paddingOption.left * canvasWidth,\n\t\t\t\t\tright: paddingOption.right * canvasWidth,\n\t\t\t\t\ttype: 'pixel',\n\t\t\t  }\n\t\t\t: paddingOption;\n\n\tif (padding.left + padding.right >= canvasWidth || padding.top + padding.bottom >= canvasHeight) {\n\t\treturn results;\n\t}\n\n\torbit.updateMatrixWorld();\n\tconst camMatrixWorldInverse = camera.matrixWorldInverse;\n\tlet halfFOV = (camera.fov * (Math.PI / 180)) / 2;\n\tlet yFov = halfFOV;\n\tlet xFov_OLD = Math.atan(Math.tan(halfFOV) * (canvasWidth / canvasHeight));\n\tlet xFov = xFov_OLD;\n\n\tlet min = new Vector3(Infinity, Infinity, Infinity);\n\tlet max = new Vector3(-Infinity, -Infinity, -Infinity);\n\n\tlet originalBbox = new Box3();\n\n\tconst point = new Vector3();\n\tfor (let i = 0, iLen = pointCloud.length; i < iLen; i++) {\n\t\tpoint.copy(pointCloud[i]);\n\t\toriginalBbox.expandByPoint(point);\n\t\tpoint.applyMatrix4(camMatrixWorldInverse);\n\t\tmin.min(point);\n\t\tmax.max(point);\n\n\t\tpoint.copy(pointCloud[i]);\n\t\tpoint.z -= verticalPadding;\n\t\tpoint.applyMatrix4(camMatrixWorldInverse);\n\t\tmin.min(point);\n\t\tmax.max(point);\n\n\t\tpoint.copy(pointCloud[i]);\n\t\tpoint.z += verticalPadding;\n\t\tpoint.applyMatrix4(camMatrixWorldInverse);\n\t\tmin.min(point);\n\t\tmax.max(point);\n\t}\n\n\tlet originalBoundsWidth = max.x - min.x;\n\tlet originalBoundsHeight = max.y - min.y;\n\n\tlet containmentWidth = canvasWidth - padding.left - padding.right;\n\tlet containmentHeight = canvasHeight - padding.top - padding.bottom;\n\n\tlet originalBoundsCenterX = (max.x + min.x) / 2;\n\tlet originalBoundsCenterY = (max.y + min.y) / 2;\n\n\tlet widthRatio = originalBoundsWidth / containmentWidth;\n\tlet heightRatio = originalBoundsHeight / containmentHeight;\n\n\tlet minZoomDistance = minZoom;\n\tlet maxZoomDistance = maxZoom;\n\n\tlet minBoundsWidth = minZoomDistance * Math.tan(xFov) * 2;\n\tlet maxBoundsWidth = maxZoomDistance * Math.tan(xFov) * 2;\n\tlet minimumScaleRatio = minBoundsWidth / canvasWidth;\n\tlet maximumScaleRatio = maxBoundsWidth / canvasWidth;\n\n\tlet scaleRatio = Math.max(widthRatio, heightRatio);\n\n\tscaleRatio = MathUtils.clamp(scaleRatio, minimumScaleRatio, maximumScaleRatio);\n\n\tlet paddedBoundsWidth = containmentWidth * scaleRatio;\n\tlet paddedBoundsHeight = containmentHeight * scaleRatio;\n\n\tlet boundsForScreen = {\n\t\tmin: {\n\t\t\tx: originalBoundsCenterX - paddedBoundsWidth / 2 - padding.left * scaleRatio,\n\t\t\ty: originalBoundsCenterY - paddedBoundsHeight / 2 - padding.bottom * scaleRatio,\n\t\t},\n\t\tmax: {\n\t\t\tx: originalBoundsCenterX + paddedBoundsWidth / 2 + padding.right * scaleRatio,\n\t\t\ty: originalBoundsCenterY + paddedBoundsHeight / 2 + padding.top * scaleRatio,\n\t\t},\n\t};\n\n\tlet centerX = (boundsForScreen.min.x + boundsForScreen.max.x) / 2;\n\tlet centerY = (boundsForScreen.min.y + boundsForScreen.max.y) / 2;\n\n\tconst center = originalBbox.getCenter(new Vector3());\n\n\tlet deltaX = Math.abs(centerX - boundsForScreen.min.x);\n\tlet deltaY = Math.abs(centerY - boundsForScreen.min.y);\n\n\tlet distanceX = deltaX / Math.tan(xFov);\n\tlet distanceY = deltaY / Math.tan(yFov);\n\n\tlet cameraTarget = new Vector3();\n\n\tcameraTarget.set(centerX, centerY, max.z + Math.max(distanceX, distanceY));\n\tcameraTarget.applyMatrix4(camera.matrixWorld);\n\n\tlet cameraAnchor = new Vector3();\n\tcameraAnchor.set(centerX, centerY, max.z);\n\tcameraAnchor.applyMatrix4(camera.matrixWorld);\n\n\t// Calculate the direction vector between the two points\n\tlet direction = new Vector3().subVectors(cameraAnchor, cameraTarget);\n\n\t// Calculate the distance between pointA and the z plane\n\tlet distanceToZPlane = (center.z - cameraTarget.z) / direction.z;\n\n\t// Calculate the next point in line where pointA intersects the z plane\n\tlet nextPoint = new Vector3().copy(cameraTarget).add(direction.clone().multiplyScalar(distanceToZPlane));\n\n\tcameraAnchor.set(nextPoint.x, nextPoint.y, nextPoint.z);\n\n\tcameraTarget.sub(cameraAnchor);\n\n\treturn {\n\t\tposition: nextPoint,\n\t\tzoom: cameraTarget.length(),\n\t};\n}\n", "/**\n * The Ease class provides a collection of easing functions for use with tween.js.\n */\nvar Easing = Object.freeze({\n    Linear: Object.freeze({\n        None: function (amount) {\n            return amount;\n        },\n        In: function (amount) {\n            return amount;\n        },\n        Out: function (amount) {\n            return amount;\n        },\n        InOut: function (amount) {\n            return amount;\n        },\n    }),\n    Quadratic: Object.freeze({\n        In: function (amount) {\n            return amount * amount;\n        },\n        Out: function (amount) {\n            return amount * (2 - amount);\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount;\n            }\n            return -0.5 * (--amount * (amount - 2) - 1);\n        },\n    }),\n    Cubic: Object.freeze({\n        In: function (amount) {\n            return amount * amount * amount;\n        },\n        Out: function (amount) {\n            return --amount * amount * amount + 1;\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount * amount;\n            }\n            return 0.5 * ((amount -= 2) * amount * amount + 2);\n        },\n    }),\n    Quartic: Object.freeze({\n        In: function (amount) {\n            return amount * amount * amount * amount;\n        },\n        Out: function (amount) {\n            return 1 - --amount * amount * amount * amount;\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount * amount * amount;\n            }\n            return -0.5 * ((amount -= 2) * amount * amount * amount - 2);\n        },\n    }),\n    Quintic: Object.freeze({\n        In: function (amount) {\n            return amount * amount * amount * amount * amount;\n        },\n        Out: function (amount) {\n            return --amount * amount * amount * amount * amount + 1;\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount * amount * amount * amount;\n            }\n            return 0.5 * ((amount -= 2) * amount * amount * amount * amount + 2);\n        },\n    }),\n    Sinusoidal: Object.freeze({\n        In: function (amount) {\n            return 1 - Math.sin(((1.0 - amount) * Math.PI) / 2);\n        },\n        Out: function (amount) {\n            return Math.sin((amount * Math.PI) / 2);\n        },\n        InOut: function (amount) {\n            return 0.5 * (1 - Math.sin(Math.PI * (0.5 - amount)));\n        },\n    }),\n    Exponential: Object.freeze({\n        In: function (amount) {\n            return amount === 0 ? 0 : Math.pow(1024, amount - 1);\n        },\n        Out: function (amount) {\n            return amount === 1 ? 1 : 1 - Math.pow(2, -10 * amount);\n        },\n        InOut: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            if ((amount *= 2) < 1) {\n                return 0.5 * Math.pow(1024, amount - 1);\n            }\n            return 0.5 * (-Math.pow(2, -10 * (amount - 1)) + 2);\n        },\n    }),\n    Circular: Object.freeze({\n        In: function (amount) {\n            return 1 - Math.sqrt(1 - amount * amount);\n        },\n        Out: function (amount) {\n            return Math.sqrt(1 - --amount * amount);\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return -0.5 * (Math.sqrt(1 - amount * amount) - 1);\n            }\n            return 0.5 * (Math.sqrt(1 - (amount -= 2) * amount) + 1);\n        },\n    }),\n    Elastic: Object.freeze({\n        In: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            return -Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\n        },\n        Out: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            return Math.pow(2, -10 * amount) * Math.sin((amount - 0.1) * 5 * Math.PI) + 1;\n        },\n        InOut: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            amount *= 2;\n            if (amount < 1) {\n                return -0.5 * Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\n            }\n            return 0.5 * Math.pow(2, -10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI) + 1;\n        },\n    }),\n    Back: Object.freeze({\n        In: function (amount) {\n            var s = 1.70158;\n            return amount === 1 ? 1 : amount * amount * ((s + 1) * amount - s);\n        },\n        Out: function (amount) {\n            var s = 1.70158;\n            return amount === 0 ? 0 : --amount * amount * ((s + 1) * amount + s) + 1;\n        },\n        InOut: function (amount) {\n            var s = 1.70158 * 1.525;\n            if ((amount *= 2) < 1) {\n                return 0.5 * (amount * amount * ((s + 1) * amount - s));\n            }\n            return 0.5 * ((amount -= 2) * amount * ((s + 1) * amount + s) + 2);\n        },\n    }),\n    Bounce: Object.freeze({\n        In: function (amount) {\n            return 1 - Easing.Bounce.Out(1 - amount);\n        },\n        Out: function (amount) {\n            if (amount < 1 / 2.75) {\n                return 7.5625 * amount * amount;\n            }\n            else if (amount < 2 / 2.75) {\n                return 7.5625 * (amount -= 1.5 / 2.75) * amount + 0.75;\n            }\n            else if (amount < 2.5 / 2.75) {\n                return 7.5625 * (amount -= 2.25 / 2.75) * amount + 0.9375;\n            }\n            else {\n                return 7.5625 * (amount -= 2.625 / 2.75) * amount + 0.984375;\n            }\n        },\n        InOut: function (amount) {\n            if (amount < 0.5) {\n                return Easing.Bounce.In(amount * 2) * 0.5;\n            }\n            return Easing.Bounce.Out(amount * 2 - 1) * 0.5 + 0.5;\n        },\n    }),\n    generatePow: function (power) {\n        if (power === void 0) { power = 4; }\n        power = power < Number.EPSILON ? Number.EPSILON : power;\n        power = power > 10000 ? 10000 : power;\n        return {\n            In: function (amount) {\n                return Math.pow(amount, power);\n            },\n            Out: function (amount) {\n                return 1 - Math.pow((1 - amount), power);\n            },\n            InOut: function (amount) {\n                if (amount < 0.5) {\n                    return Math.pow((amount * 2), power) / 2;\n                }\n                return (1 - Math.pow((2 - amount * 2), power)) / 2 + 0.5;\n            },\n        };\n    },\n});\n\nvar now = function () { return performance.now(); };\n\n/**\n * Controlling groups of tweens\n *\n * Using the TWEEN singleton to manage your tweens can cause issues in large apps with many components.\n * In these cases, you may want to create your own smaller groups of tween\n */\nvar Group = /** @class */ (function () {\n    function Group() {\n        var tweens = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            tweens[_i] = arguments[_i];\n        }\n        this._tweens = {};\n        this._tweensAddedDuringUpdate = {};\n        this.add.apply(this, tweens);\n    }\n    Group.prototype.getAll = function () {\n        var _this = this;\n        return Object.keys(this._tweens).map(function (tweenId) { return _this._tweens[tweenId]; });\n    };\n    Group.prototype.removeAll = function () {\n        this._tweens = {};\n    };\n    Group.prototype.add = function () {\n        var _a;\n        var tweens = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            tweens[_i] = arguments[_i];\n        }\n        for (var _b = 0, tweens_1 = tweens; _b < tweens_1.length; _b++) {\n            var tween = tweens_1[_b];\n            // Remove from any other group first, a tween can only be in one group at a time.\n            // @ts-expect-error library internal access\n            (_a = tween._group) === null || _a === void 0 ? void 0 : _a.remove(tween);\n            // @ts-expect-error library internal access\n            tween._group = this;\n            this._tweens[tween.getId()] = tween;\n            this._tweensAddedDuringUpdate[tween.getId()] = tween;\n        }\n    };\n    Group.prototype.remove = function () {\n        var tweens = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            tweens[_i] = arguments[_i];\n        }\n        for (var _a = 0, tweens_2 = tweens; _a < tweens_2.length; _a++) {\n            var tween = tweens_2[_a];\n            // @ts-expect-error library internal access\n            tween._group = undefined;\n            delete this._tweens[tween.getId()];\n            delete this._tweensAddedDuringUpdate[tween.getId()];\n        }\n    };\n    /** Return true if all tweens in the group are not paused or playing. */\n    Group.prototype.allStopped = function () {\n        return this.getAll().every(function (tween) { return !tween.isPlaying(); });\n    };\n    Group.prototype.update = function (time, preserve) {\n        if (time === void 0) { time = now(); }\n        if (preserve === void 0) { preserve = true; }\n        var tweenIds = Object.keys(this._tweens);\n        if (tweenIds.length === 0)\n            return;\n        // Tweens are updated in \"batches\". If you add a new tween during an\n        // update, then the new tween will be updated in the next batch.\n        // If you remove a tween during an update, it may or may not be updated.\n        // However, if the removed tween was added during the current batch,\n        // then it will not be updated.\n        while (tweenIds.length > 0) {\n            this._tweensAddedDuringUpdate = {};\n            for (var i = 0; i < tweenIds.length; i++) {\n                var tween = this._tweens[tweenIds[i]];\n                var autoStart = !preserve;\n                if (tween && tween.update(time, autoStart) === false && !preserve)\n                    this.remove(tween);\n            }\n            tweenIds = Object.keys(this._tweensAddedDuringUpdate);\n        }\n    };\n    return Group;\n}());\n\n/**\n *\n */\nvar Interpolation = {\n    Linear: function (v, k) {\n        var m = v.length - 1;\n        var f = m * k;\n        var i = Math.floor(f);\n        var fn = Interpolation.Utils.Linear;\n        if (k < 0) {\n            return fn(v[0], v[1], f);\n        }\n        if (k > 1) {\n            return fn(v[m], v[m - 1], m - f);\n        }\n        return fn(v[i], v[i + 1 > m ? m : i + 1], f - i);\n    },\n    Bezier: function (v, k) {\n        var b = 0;\n        var n = v.length - 1;\n        var pw = Math.pow;\n        var bn = Interpolation.Utils.Bernstein;\n        for (var i = 0; i <= n; i++) {\n            b += pw(1 - k, n - i) * pw(k, i) * v[i] * bn(n, i);\n        }\n        return b;\n    },\n    CatmullRom: function (v, k) {\n        var m = v.length - 1;\n        var f = m * k;\n        var i = Math.floor(f);\n        var fn = Interpolation.Utils.CatmullRom;\n        if (v[0] === v[m]) {\n            if (k < 0) {\n                i = Math.floor((f = m * (1 + k)));\n            }\n            return fn(v[(i - 1 + m) % m], v[i], v[(i + 1) % m], v[(i + 2) % m], f - i);\n        }\n        else {\n            if (k < 0) {\n                return v[0] - (fn(v[0], v[0], v[1], v[1], -f) - v[0]);\n            }\n            if (k > 1) {\n                return v[m] - (fn(v[m], v[m], v[m - 1], v[m - 1], f - m) - v[m]);\n            }\n            return fn(v[i ? i - 1 : 0], v[i], v[m < i + 1 ? m : i + 1], v[m < i + 2 ? m : i + 2], f - i);\n        }\n    },\n    Utils: {\n        Linear: function (p0, p1, t) {\n            return (p1 - p0) * t + p0;\n        },\n        Bernstein: function (n, i) {\n            var fc = Interpolation.Utils.Factorial;\n            return fc(n) / fc(i) / fc(n - i);\n        },\n        Factorial: (function () {\n            var a = [1];\n            return function (n) {\n                var s = 1;\n                if (a[n]) {\n                    return a[n];\n                }\n                for (var i = n; i > 1; i--) {\n                    s *= i;\n                }\n                a[n] = s;\n                return s;\n            };\n        })(),\n        CatmullRom: function (p0, p1, p2, p3, t) {\n            var v0 = (p2 - p0) * 0.5;\n            var v1 = (p3 - p1) * 0.5;\n            var t2 = t * t;\n            var t3 = t * t2;\n            return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\n        },\n    },\n};\n\n/**\n * Utils\n */\nvar Sequence = /** @class */ (function () {\n    function Sequence() {\n    }\n    Sequence.nextId = function () {\n        return Sequence._nextId++;\n    };\n    Sequence._nextId = 0;\n    return Sequence;\n}());\n\nvar mainGroup = new Group();\n\n/**\n * Tween.js - Licensed under the MIT license\n * https://github.com/tweenjs/tween.js\n * ----------------------------------------------\n *\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\n * Thank you all, you're awesome!\n */\nvar Tween = /** @class */ (function () {\n    function Tween(object, group) {\n        this._isPaused = false;\n        this._pauseStart = 0;\n        this._valuesStart = {};\n        this._valuesEnd = {};\n        this._valuesStartRepeat = {};\n        this._duration = 1000;\n        this._isDynamic = false;\n        this._initialRepeat = 0;\n        this._repeat = 0;\n        this._yoyo = false;\n        this._isPlaying = false;\n        this._reversed = false;\n        this._delayTime = 0;\n        this._startTime = 0;\n        this._easingFunction = Easing.Linear.None;\n        this._interpolationFunction = Interpolation.Linear;\n        // eslint-disable-next-line\n        this._chainedTweens = [];\n        this._onStartCallbackFired = false;\n        this._onEveryStartCallbackFired = false;\n        this._id = Sequence.nextId();\n        this._isChainStopped = false;\n        this._propertiesAreSetUp = false;\n        this._goToEnd = false;\n        this._object = object;\n        if (typeof group === 'object') {\n            this._group = group;\n            group.add(this);\n        }\n        // Use \"true\" to restore old behavior (will be removed in future release).\n        else if (group === true) {\n            this._group = mainGroup;\n            mainGroup.add(this);\n        }\n    }\n    Tween.prototype.getId = function () {\n        return this._id;\n    };\n    Tween.prototype.isPlaying = function () {\n        return this._isPlaying;\n    };\n    Tween.prototype.isPaused = function () {\n        return this._isPaused;\n    };\n    Tween.prototype.getDuration = function () {\n        return this._duration;\n    };\n    Tween.prototype.to = function (target, duration) {\n        if (duration === void 0) { duration = 1000; }\n        if (this._isPlaying)\n            throw new Error('Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.');\n        this._valuesEnd = target;\n        this._propertiesAreSetUp = false;\n        this._duration = duration < 0 ? 0 : duration;\n        return this;\n    };\n    Tween.prototype.duration = function (duration) {\n        if (duration === void 0) { duration = 1000; }\n        this._duration = duration < 0 ? 0 : duration;\n        return this;\n    };\n    Tween.prototype.dynamic = function (dynamic) {\n        if (dynamic === void 0) { dynamic = false; }\n        this._isDynamic = dynamic;\n        return this;\n    };\n    Tween.prototype.start = function (time, overrideStartingValues) {\n        if (time === void 0) { time = now(); }\n        if (overrideStartingValues === void 0) { overrideStartingValues = false; }\n        if (this._isPlaying) {\n            return this;\n        }\n        this._repeat = this._initialRepeat;\n        if (this._reversed) {\n            // If we were reversed (f.e. using the yoyo feature) then we need to\n            // flip the tween direction back to forward.\n            this._reversed = false;\n            for (var property in this._valuesStartRepeat) {\n                this._swapEndStartRepeatValues(property);\n                this._valuesStart[property] = this._valuesStartRepeat[property];\n            }\n        }\n        this._isPlaying = true;\n        this._isPaused = false;\n        this._onStartCallbackFired = false;\n        this._onEveryStartCallbackFired = false;\n        this._isChainStopped = false;\n        this._startTime = time;\n        this._startTime += this._delayTime;\n        if (!this._propertiesAreSetUp || overrideStartingValues) {\n            this._propertiesAreSetUp = true;\n            // If dynamic is not enabled, clone the end values instead of using the passed-in end values.\n            if (!this._isDynamic) {\n                var tmp = {};\n                for (var prop in this._valuesEnd)\n                    tmp[prop] = this._valuesEnd[prop];\n                this._valuesEnd = tmp;\n            }\n            this._setupProperties(this._object, this._valuesStart, this._valuesEnd, this._valuesStartRepeat, overrideStartingValues);\n        }\n        return this;\n    };\n    Tween.prototype.startFromCurrentValues = function (time) {\n        return this.start(time, true);\n    };\n    Tween.prototype._setupProperties = function (_object, _valuesStart, _valuesEnd, _valuesStartRepeat, overrideStartingValues) {\n        for (var property in _valuesEnd) {\n            var startValue = _object[property];\n            var startValueIsArray = Array.isArray(startValue);\n            var propType = startValueIsArray ? 'array' : typeof startValue;\n            var isInterpolationList = !startValueIsArray && Array.isArray(_valuesEnd[property]);\n            // If `to()` specifies a property that doesn't exist in the source object,\n            // we should not set that property in the object\n            if (propType === 'undefined' || propType === 'function') {\n                continue;\n            }\n            // Check if an Array was provided as property value\n            if (isInterpolationList) {\n                var endValues = _valuesEnd[property];\n                if (endValues.length === 0) {\n                    continue;\n                }\n                // Handle an array of relative values.\n                // Creates a local copy of the Array with the start value at the front\n                var temp = [startValue];\n                for (var i = 0, l = endValues.length; i < l; i += 1) {\n                    var value = this._handleRelativeValue(startValue, endValues[i]);\n                    if (isNaN(value)) {\n                        isInterpolationList = false;\n                        console.warn('Found invalid interpolation list. Skipping.');\n                        break;\n                    }\n                    temp.push(value);\n                }\n                if (isInterpolationList) {\n                    // if (_valuesStart[property] === undefined) { // handle end values only the first time. NOT NEEDED? setupProperties is now guarded by _propertiesAreSetUp.\n                    _valuesEnd[property] = temp;\n                    // }\n                }\n            }\n            // handle the deepness of the values\n            if ((propType === 'object' || startValueIsArray) && startValue && !isInterpolationList) {\n                _valuesStart[property] = startValueIsArray ? [] : {};\n                var nestedObject = startValue;\n                for (var prop in nestedObject) {\n                    _valuesStart[property][prop] = nestedObject[prop];\n                }\n                // TODO? repeat nested values? And yoyo? And array values?\n                _valuesStartRepeat[property] = startValueIsArray ? [] : {};\n                var endValues = _valuesEnd[property];\n                // If dynamic is not enabled, clone the end values instead of using the passed-in end values.\n                if (!this._isDynamic) {\n                    var tmp = {};\n                    for (var prop in endValues)\n                        tmp[prop] = endValues[prop];\n                    _valuesEnd[property] = endValues = tmp;\n                }\n                this._setupProperties(nestedObject, _valuesStart[property], endValues, _valuesStartRepeat[property], overrideStartingValues);\n            }\n            else {\n                // Save the starting value, but only once unless override is requested.\n                if (typeof _valuesStart[property] === 'undefined' || overrideStartingValues) {\n                    _valuesStart[property] = startValue;\n                }\n                if (!startValueIsArray) {\n                    // eslint-disable-next-line\n                    // @ts-ignore FIXME?\n                    _valuesStart[property] *= 1.0; // Ensures we're using numbers, not strings\n                }\n                if (isInterpolationList) {\n                    // eslint-disable-next-line\n                    // @ts-ignore FIXME?\n                    _valuesStartRepeat[property] = _valuesEnd[property].slice().reverse();\n                }\n                else {\n                    _valuesStartRepeat[property] = _valuesStart[property] || 0;\n                }\n            }\n        }\n    };\n    Tween.prototype.stop = function () {\n        if (!this._isChainStopped) {\n            this._isChainStopped = true;\n            this.stopChainedTweens();\n        }\n        if (!this._isPlaying) {\n            return this;\n        }\n        this._isPlaying = false;\n        this._isPaused = false;\n        if (this._onStopCallback) {\n            this._onStopCallback(this._object);\n        }\n        return this;\n    };\n    Tween.prototype.end = function () {\n        this._goToEnd = true;\n        this.update(this._startTime + this._duration);\n        return this;\n    };\n    Tween.prototype.pause = function (time) {\n        if (time === void 0) { time = now(); }\n        if (this._isPaused || !this._isPlaying) {\n            return this;\n        }\n        this._isPaused = true;\n        this._pauseStart = time;\n        return this;\n    };\n    Tween.prototype.resume = function (time) {\n        if (time === void 0) { time = now(); }\n        if (!this._isPaused || !this._isPlaying) {\n            return this;\n        }\n        this._isPaused = false;\n        this._startTime += time - this._pauseStart;\n        this._pauseStart = 0;\n        return this;\n    };\n    Tween.prototype.stopChainedTweens = function () {\n        for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\n            this._chainedTweens[i].stop();\n        }\n        return this;\n    };\n    Tween.prototype.group = function (group) {\n        if (!group) {\n            console.warn('tween.group() without args has been removed, use group.add(tween) instead.');\n            return this;\n        }\n        group.add(this);\n        return this;\n    };\n    /**\n     * Removes the tween from whichever group it is in.\n     */\n    Tween.prototype.remove = function () {\n        var _a;\n        (_a = this._group) === null || _a === void 0 ? void 0 : _a.remove(this);\n        return this;\n    };\n    Tween.prototype.delay = function (amount) {\n        if (amount === void 0) { amount = 0; }\n        this._delayTime = amount;\n        return this;\n    };\n    Tween.prototype.repeat = function (times) {\n        if (times === void 0) { times = 0; }\n        this._initialRepeat = times;\n        this._repeat = times;\n        return this;\n    };\n    Tween.prototype.repeatDelay = function (amount) {\n        this._repeatDelayTime = amount;\n        return this;\n    };\n    Tween.prototype.yoyo = function (yoyo) {\n        if (yoyo === void 0) { yoyo = false; }\n        this._yoyo = yoyo;\n        return this;\n    };\n    Tween.prototype.easing = function (easingFunction) {\n        if (easingFunction === void 0) { easingFunction = Easing.Linear.None; }\n        this._easingFunction = easingFunction;\n        return this;\n    };\n    Tween.prototype.interpolation = function (interpolationFunction) {\n        if (interpolationFunction === void 0) { interpolationFunction = Interpolation.Linear; }\n        this._interpolationFunction = interpolationFunction;\n        return this;\n    };\n    // eslint-disable-next-line\n    Tween.prototype.chain = function () {\n        var tweens = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            tweens[_i] = arguments[_i];\n        }\n        this._chainedTweens = tweens;\n        return this;\n    };\n    Tween.prototype.onStart = function (callback) {\n        this._onStartCallback = callback;\n        return this;\n    };\n    Tween.prototype.onEveryStart = function (callback) {\n        this._onEveryStartCallback = callback;\n        return this;\n    };\n    Tween.prototype.onUpdate = function (callback) {\n        this._onUpdateCallback = callback;\n        return this;\n    };\n    Tween.prototype.onRepeat = function (callback) {\n        this._onRepeatCallback = callback;\n        return this;\n    };\n    Tween.prototype.onComplete = function (callback) {\n        this._onCompleteCallback = callback;\n        return this;\n    };\n    Tween.prototype.onStop = function (callback) {\n        this._onStopCallback = callback;\n        return this;\n    };\n    /**\n     * @returns true if the tween is still playing after the update, false\n     * otherwise (calling update on a paused tween still returns true because\n     * it is still playing, just paused).\n     *\n     * @param autoStart - When true, calling update will implicitly call start()\n     * as well. Note, if you stop() or end() the tween, but are still calling\n     * update(), it will start again!\n     */\n    Tween.prototype.update = function (time, autoStart) {\n        var _this = this;\n        var _a;\n        if (time === void 0) { time = now(); }\n        if (autoStart === void 0) { autoStart = Tween.autoStartOnUpdate; }\n        if (this._isPaused)\n            return true;\n        var property;\n        if (!this._goToEnd && !this._isPlaying) {\n            if (autoStart)\n                this.start(time, true);\n            else\n                return false;\n        }\n        this._goToEnd = false;\n        if (time < this._startTime) {\n            return true;\n        }\n        if (this._onStartCallbackFired === false) {\n            if (this._onStartCallback) {\n                this._onStartCallback(this._object);\n            }\n            this._onStartCallbackFired = true;\n        }\n        if (this._onEveryStartCallbackFired === false) {\n            if (this._onEveryStartCallback) {\n                this._onEveryStartCallback(this._object);\n            }\n            this._onEveryStartCallbackFired = true;\n        }\n        var elapsedTime = time - this._startTime;\n        var durationAndDelay = this._duration + ((_a = this._repeatDelayTime) !== null && _a !== void 0 ? _a : this._delayTime);\n        var totalTime = this._duration + this._repeat * durationAndDelay;\n        var calculateElapsedPortion = function () {\n            if (_this._duration === 0)\n                return 1;\n            if (elapsedTime > totalTime) {\n                return 1;\n            }\n            var timesRepeated = Math.trunc(elapsedTime / durationAndDelay);\n            var timeIntoCurrentRepeat = elapsedTime - timesRepeated * durationAndDelay;\n            // TODO use %?\n            // const timeIntoCurrentRepeat = elapsedTime % durationAndDelay\n            var portion = Math.min(timeIntoCurrentRepeat / _this._duration, 1);\n            if (portion === 0 && elapsedTime === _this._duration) {\n                return 1;\n            }\n            return portion;\n        };\n        var elapsed = calculateElapsedPortion();\n        var value = this._easingFunction(elapsed);\n        // properties transformations\n        this._updateProperties(this._object, this._valuesStart, this._valuesEnd, value);\n        if (this._onUpdateCallback) {\n            this._onUpdateCallback(this._object, elapsed);\n        }\n        if (this._duration === 0 || elapsedTime >= this._duration) {\n            if (this._repeat > 0) {\n                var completeCount = Math.min(Math.trunc((elapsedTime - this._duration) / durationAndDelay) + 1, this._repeat);\n                if (isFinite(this._repeat)) {\n                    this._repeat -= completeCount;\n                }\n                // Reassign starting values, restart by making startTime = now\n                for (property in this._valuesStartRepeat) {\n                    if (!this._yoyo && typeof this._valuesEnd[property] === 'string') {\n                        this._valuesStartRepeat[property] =\n                            // eslint-disable-next-line\n                            // @ts-ignore FIXME?\n                            this._valuesStartRepeat[property] + parseFloat(this._valuesEnd[property]);\n                    }\n                    if (this._yoyo) {\n                        this._swapEndStartRepeatValues(property);\n                    }\n                    this._valuesStart[property] = this._valuesStartRepeat[property];\n                }\n                if (this._yoyo) {\n                    this._reversed = !this._reversed;\n                }\n                this._startTime += durationAndDelay * completeCount;\n                if (this._onRepeatCallback) {\n                    this._onRepeatCallback(this._object);\n                }\n                this._onEveryStartCallbackFired = false;\n                return true;\n            }\n            else {\n                if (this._onCompleteCallback) {\n                    this._onCompleteCallback(this._object);\n                }\n                for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\n                    // Make the chained tweens start exactly at the time they should,\n                    // even if the `update()` method was called way past the duration of the tween\n                    this._chainedTweens[i].start(this._startTime + this._duration, false);\n                }\n                this._isPlaying = false;\n                return false;\n            }\n        }\n        return true;\n    };\n    Tween.prototype._updateProperties = function (_object, _valuesStart, _valuesEnd, value) {\n        for (var property in _valuesEnd) {\n            // Don't update properties that do not exist in the source object\n            if (_valuesStart[property] === undefined) {\n                continue;\n            }\n            var start = _valuesStart[property] || 0;\n            var end = _valuesEnd[property];\n            var startIsArray = Array.isArray(_object[property]);\n            var endIsArray = Array.isArray(end);\n            var isInterpolationList = !startIsArray && endIsArray;\n            if (isInterpolationList) {\n                _object[property] = this._interpolationFunction(end, value);\n            }\n            else if (typeof end === 'object' && end) {\n                // eslint-disable-next-line\n                // @ts-ignore FIXME?\n                this._updateProperties(_object[property], start, end, value);\n            }\n            else {\n                // Parses relative end values with start as base (e.g.: +10, -3)\n                end = this._handleRelativeValue(start, end);\n                // Protect against non numeric properties.\n                if (typeof end === 'number') {\n                    // eslint-disable-next-line\n                    // @ts-ignore FIXME?\n                    _object[property] = start + (end - start) * value;\n                }\n            }\n        }\n    };\n    Tween.prototype._handleRelativeValue = function (start, end) {\n        if (typeof end !== 'string') {\n            return end;\n        }\n        if (end.charAt(0) === '+' || end.charAt(0) === '-') {\n            return start + parseFloat(end);\n        }\n        return parseFloat(end);\n    };\n    Tween.prototype._swapEndStartRepeatValues = function (property) {\n        var tmp = this._valuesStartRepeat[property];\n        var endValue = this._valuesEnd[property];\n        if (typeof endValue === 'string') {\n            this._valuesStartRepeat[property] = this._valuesStartRepeat[property] + parseFloat(endValue);\n        }\n        else {\n            this._valuesStartRepeat[property] = this._valuesEnd[property];\n        }\n        this._valuesEnd[property] = tmp;\n    };\n    Tween.autoStartOnUpdate = false;\n    return Tween;\n}());\n\nvar VERSION = '25.0.0';\n\n/**\n * Tween.js - Licensed under the MIT license\n * https://github.com/tweenjs/tween.js\n * ----------------------------------------------\n *\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\n * Thank you all, you're awesome!\n */\nvar nextId = Sequence.nextId;\n/**\n * Controlling groups of tweens\n *\n * Using the TWEEN singleton to manage your tweens can cause issues in large apps with many components.\n * In these cases, you may want to create your own smaller groups of tweens.\n */\nvar TWEEN = mainGroup;\n// This is the best way to export things in a way that's compatible with both ES\n// Modules and CommonJS, without build hacks, and so as not to break the\n// existing API.\n// https://github.com/rollup/rollup/issues/1961#issuecomment-423037881\n/**\n * @deprecated The global TWEEN Group will be removed in a following major\n * release. To migrate, create a `new Group()` instead of using `TWEEN` as a\n * group.\n *\n * Old code:\n *\n * ```js\n * import * as TWEEN from '@tweenjs/tween.js'\n *\n * //...\n *\n * const tween = new TWEEN.Tween(obj)\n * const tween2 = new TWEEN.Tween(obj2)\n *\n * //...\n *\n * requestAnimationFrame(function loop(time) {\n *   TWEEN.update(time)\n *   requestAnimationFrame(loop)\n * })\n * ```\n *\n * New code:\n *\n * ```js\n * import {Tween, Group} from '@tweenjs/tween.js'\n *\n * //...\n *\n * const tween = new Tween(obj)\n * const tween2 = new TWEEN.Tween(obj2)\n *\n * //...\n *\n * const group = new Group()\n * group.add(tween)\n * group.add(tween2)\n *\n * //...\n *\n * requestAnimationFrame(function loop(time) {\n *   group.update(time)\n *   requestAnimationFrame(loop)\n * })\n * ```\n */\nvar getAll = TWEEN.getAll.bind(TWEEN);\n/**\n * @deprecated The global TWEEN Group will be removed in a following major\n * release. To migrate, create a `new Group()` instead of using `TWEEN` as a\n * group.\n *\n * Old code:\n *\n * ```js\n * import * as TWEEN from '@tweenjs/tween.js'\n *\n * //...\n *\n * const tween = new TWEEN.Tween(obj)\n * const tween2 = new TWEEN.Tween(obj2)\n *\n * //...\n *\n * requestAnimationFrame(function loop(time) {\n *   TWEEN.update(time)\n *   requestAnimationFrame(loop)\n * })\n * ```\n *\n * New code:\n *\n * ```js\n * import {Tween, Group} from '@tweenjs/tween.js'\n *\n * //...\n *\n * const tween = new Tween(obj)\n * const tween2 = new TWEEN.Tween(obj2)\n *\n * //...\n *\n * const group = new Group()\n * group.add(tween)\n * group.add(tween2)\n *\n * //...\n *\n * requestAnimationFrame(function loop(time) {\n *   group.update(time)\n *   requestAnimationFrame(loop)\n * })\n * ```\n */\nvar removeAll = TWEEN.removeAll.bind(TWEEN);\n/**\n * @deprecated The global TWEEN Group will be removed in a following major\n * release. To migrate, create a `new Group()` instead of using `TWEEN` as a\n * group.\n *\n * Old code:\n *\n * ```js\n * import * as TWEEN from '@tweenjs/tween.js'\n *\n * //...\n *\n * const tween = new TWEEN.Tween(obj)\n * const tween2 = new TWEEN.Tween(obj2)\n *\n * //...\n *\n * requestAnimationFrame(function loop(time) {\n *   TWEEN.update(time)\n *   requestAnimationFrame(loop)\n * })\n * ```\n *\n * New code:\n *\n * ```js\n * import {Tween, Group} from '@tweenjs/tween.js'\n *\n * //...\n *\n * const tween = new Tween(obj)\n * const tween2 = new TWEEN.Tween(obj2)\n *\n * //...\n *\n * const group = new Group()\n * group.add(tween)\n * group.add(tween2)\n *\n * //...\n *\n * requestAnimationFrame(function loop(time) {\n *   group.update(time)\n *   requestAnimationFrame(loop)\n * })\n * ```\n */\nvar add = TWEEN.add.bind(TWEEN);\n/**\n * @deprecated The global TWEEN Group will be removed in a following major\n * release. To migrate, create a `new Group()` instead of using `TWEEN` as a\n * group.\n *\n * Old code:\n *\n * ```js\n * import * as TWEEN from '@tweenjs/tween.js'\n *\n * //...\n *\n * const tween = new TWEEN.Tween(obj)\n * const tween2 = new TWEEN.Tween(obj2)\n *\n * //...\n *\n * requestAnimationFrame(function loop(time) {\n *   TWEEN.update(time)\n *   requestAnimationFrame(loop)\n * })\n * ```\n *\n * New code:\n *\n * ```js\n * import {Tween, Group} from '@tweenjs/tween.js'\n *\n * //...\n *\n * const tween = new Tween(obj)\n * const tween2 = new TWEEN.Tween(obj2)\n *\n * //...\n *\n * const group = new Group()\n * group.add(tween)\n * group.add(tween2)\n *\n * //...\n *\n * requestAnimationFrame(function loop(time) {\n *   group.update(time)\n *   requestAnimationFrame(loop)\n * })\n * ```\n */\nvar remove = TWEEN.remove.bind(TWEEN);\n/**\n * @deprecated The global TWEEN Group will be removed in a following major\n * release. To migrate, create a `new Group()` instead of using `TWEEN` as a\n * group.\n *\n * Old code:\n *\n * ```js\n * import * as TWEEN from '@tweenjs/tween.js'\n *\n * //...\n *\n * const tween = new TWEEN.Tween(obj)\n * const tween2 = new TWEEN.Tween(obj2)\n *\n * //...\n *\n * requestAnimationFrame(function loop(time) {\n *   TWEEN.update(time)\n *   requestAnimationFrame(loop)\n * })\n * ```\n *\n * New code:\n *\n * ```js\n * import {Tween, Group} from '@tweenjs/tween.js'\n *\n * //...\n *\n * const tween = new Tween(obj)\n * const tween2 = new TWEEN.Tween(obj2)\n *\n * //...\n *\n * const group = new Group()\n * group.add(tween)\n * group.add(tween2)\n *\n * //...\n *\n * requestAnimationFrame(function loop(time) {\n *   group.update(time)\n *   requestAnimationFrame(loop)\n * })\n * ```\n */\nvar update = TWEEN.update.bind(TWEEN);\nvar exports = {\n    Easing: Easing,\n    Group: Group,\n    Interpolation: Interpolation,\n    now: now,\n    Sequence: Sequence,\n    nextId: nextId,\n    Tween: Tween,\n    VERSION: VERSION,\n    /**\n     * @deprecated The global TWEEN Group will be removed in a following major\n     * release. To migrate, create a `new Group()` instead of using `TWEEN` as a\n     * group.\n     *\n     * Old code:\n     *\n     * ```js\n     * import * as TWEEN from '@tweenjs/tween.js'\n     *\n     * //...\n     *\n     * const tween = new TWEEN.Tween(obj)\n     * const tween2 = new TWEEN.Tween(obj2)\n     *\n     * //...\n     *\n     * requestAnimationFrame(function loop(time) {\n     *   TWEEN.update(time)\n     *   requestAnimationFrame(loop)\n     * })\n     * ```\n     *\n     * New code:\n     *\n     * ```js\n     * import {Tween, Group} from '@tweenjs/tween.js'\n     *\n     * //...\n     *\n     * const tween = new Tween(obj)\n     * const tween2 = new TWEEN.Tween(obj2)\n     *\n     * //...\n     *\n     * const group = new Group()\n     * group.add(tween)\n     * group.add(tween2)\n     *\n     * //...\n     *\n     * requestAnimationFrame(function loop(time) {\n     *   group.update(time)\n     *   requestAnimationFrame(loop)\n     * })\n     * ```\n     */\n    getAll: getAll,\n    /**\n     * @deprecated The global TWEEN Group will be removed in a following major\n     * release. To migrate, create a `new Group()` instead of using `TWEEN` as a\n     * group.\n     *\n     * Old code:\n     *\n     * ```js\n     * import * as TWEEN from '@tweenjs/tween.js'\n     *\n     * //...\n     *\n     * const tween = new TWEEN.Tween(obj)\n     * const tween2 = new TWEEN.Tween(obj2)\n     *\n     * //...\n     *\n     * requestAnimationFrame(function loop(time) {\n     *   TWEEN.update(time)\n     *   requestAnimationFrame(loop)\n     * })\n     * ```\n     *\n     * New code:\n     *\n     * ```js\n     * import {Tween, Group} from '@tweenjs/tween.js'\n     *\n     * //...\n     *\n     * const tween = new Tween(obj)\n     * const tween2 = new TWEEN.Tween(obj2)\n     *\n     * //...\n     *\n     * const group = new Group()\n     * group.add(tween)\n     * group.add(tween2)\n     *\n     * //...\n     *\n     * requestAnimationFrame(function loop(time) {\n     *   group.update(time)\n     *   requestAnimationFrame(loop)\n     * })\n     * ```\n     */\n    removeAll: removeAll,\n    /**\n     * @deprecated The global TWEEN Group will be removed in a following major\n     * release. To migrate, create a `new Group()` instead of using `TWEEN` as a\n     * group.\n     *\n     * Old code:\n     *\n     * ```js\n     * import * as TWEEN from '@tweenjs/tween.js'\n     *\n     * //...\n     *\n     * const tween = new TWEEN.Tween(obj)\n     * const tween2 = new TWEEN.Tween(obj2)\n     *\n     * //...\n     *\n     * requestAnimationFrame(function loop(time) {\n     *   TWEEN.update(time)\n     *   requestAnimationFrame(loop)\n     * })\n     * ```\n     *\n     * New code:\n     *\n     * ```js\n     * import {Tween, Group} from '@tweenjs/tween.js'\n     *\n     * //...\n     *\n     * const tween = new Tween(obj)\n     * const tween2 = new TWEEN.Tween(obj2)\n     *\n     * //...\n     *\n     * const group = new Group()\n     * group.add(tween)\n     * group.add(tween2)\n     *\n     * //...\n     *\n     * requestAnimationFrame(function loop(time) {\n     *   group.update(time)\n     *   requestAnimationFrame(loop)\n     * })\n     * ```\n     */\n    add: add,\n    /**\n     * @deprecated The global TWEEN Group will be removed in a following major\n     * release. To migrate, create a `new Group()` instead of using `TWEEN` as a\n     * group.\n     *\n     * Old code:\n     *\n     * ```js\n     * import * as TWEEN from '@tweenjs/tween.js'\n     *\n     * //...\n     *\n     * const tween = new TWEEN.Tween(obj)\n     * const tween2 = new TWEEN.Tween(obj2)\n     *\n     * //...\n     *\n     * requestAnimationFrame(function loop(time) {\n     *   TWEEN.update(time)\n     *   requestAnimationFrame(loop)\n     * })\n     * ```\n     *\n     * New code:\n     *\n     * ```js\n     * import {Tween, Group} from '@tweenjs/tween.js'\n     *\n     * //...\n     *\n     * const tween = new Tween(obj)\n     * const tween2 = new TWEEN.Tween(obj2)\n     *\n     * //...\n     *\n     * const group = new Group()\n     * group.add(tween)\n     * group.add(tween2)\n     *\n     * //...\n     *\n     * requestAnimationFrame(function loop(time) {\n     *   group.update(time)\n     *   requestAnimationFrame(loop)\n     * })\n     * ```\n     */\n    remove: remove,\n    /**\n     * @deprecated The global TWEEN Group will be removed in a following major\n     * release. To migrate, create a `new Group()` instead of using `TWEEN` as a\n     * group.\n     *\n     * Old code:\n     *\n     * ```js\n     * import * as TWEEN from '@tweenjs/tween.js'\n     *\n     * //...\n     *\n     * const tween = new TWEEN.Tween(obj)\n     * const tween2 = new TWEEN.Tween(obj2)\n     *\n     * //...\n     *\n     * requestAnimationFrame(function loop(time) {\n     *   TWEEN.update(time)\n     *   requestAnimationFrame(loop)\n     * })\n     * ```\n     *\n     * New code:\n     *\n     * ```js\n     * import {Tween, Group} from '@tweenjs/tween.js'\n     *\n     * //...\n     *\n     * const tween = new Tween(obj)\n     * const tween2 = new TWEEN.Tween(obj2)\n     *\n     * //...\n     *\n     * const group = new Group()\n     * group.add(tween)\n     * group.add(tween2)\n     *\n     * //...\n     *\n     * requestAnimationFrame(function loop(time) {\n     *   group.update(time)\n     *   requestAnimationFrame(loop)\n     * })\n     * ```\n     */\n    update: update,\n};\n\nexport { Easing, Group, Interpolation, Sequence, Tween, VERSION, add, exports as default, getAll, nextId, now, remove, removeAll, update };\n", "export * from './input-set';\nexport * from './touch-anchor';\nexport * from './utils';\n", "import type { Vector2 } from 'three';\nimport { distance, average, angle } from './utils';\n\nclass InputSet {\n\tinput1: Vector2;\n\tinput2: Vector2;\n\tlastAngle: number;\n\tlastDistance: number;\n\ttotalDistance: number;\n\tfirst: Vector2;\n\tsecond: Vector2;\n\n\tconstructor(input1: Vector2, input2: Vector2) {\n\t\tthis.input1 = input1;\n\t\tthis.input2 = input2;\n\n\t\tthis.lastAngle = angle(input1, input2);\n\t\tthis.lastDistance = distance(input1, input2);\n\t\tthis.totalDistance = 0;\n\n\t\tthis.first = input1;\n\t\tthis.second = input2;\n\t}\n\n\tupdate(input1: Vector2, input2: Vector2): void {\n\t\tconst newDistance = distance(input1, input2);\n\n\t\tthis.input1 = input1;\n\t\tthis.input2 = input2;\n\n\t\tconst newAngle = angle(input1, input2);\n\t\tthis.lastAngle = newAngle;\n\t\tthis.lastDistance = newDistance;\n\t\tthis.totalDistance += (distance(this.first, input1) + distance(this.second, input2)) / 2;\n\n\t\tthis.first = average(this.first, input1);\n\t\tthis.second = average(this.second, input2);\n\t}\n}\n\nexport { InputSet };\n", "import { Vector2 } from 'three';\nexport const differenceBetweenAngles = (a: number, b: number): number => {\n\treturn ((b - a + Math.PI) % (Math.PI * 2)) + ((Math.PI * 2) % (Math.PI * 2)) - Math.PI;\n};\n\nexport const getTouchPos = (touch: Touch, origin: { offsetLeft: number; offsetTop: number }): Vector2 => {\n\treturn new Vector2(touch.clientX - origin.offsetLeft, touch.clientY - origin.offsetTop);\n};\n\nexport const angle = (first: Vector2, second: Vector2): number => {\n\treturn Math.atan2(second.y - first.y, second.x - first.x);\n};\n\nexport const distance = (first: Vector2, second: Vector2): number => {\n\treturn Math.sqrt((second.y - first.y) ** 2 + (second.x - first.x) ** 2);\n};\n\nexport const average = (first: Vector2, second: Vector2): Vector2 => {\n\treturn new Vector2((first.x + second.x) / 2, (first.y + second.y) / 2);\n};\n\nexport const getScrollDelta = (event: MouseEvent | WheelEvent): number => {\n\tlet delta = 0;\n\t// the wheelDelta property isn't defined in the MouseEvent interface, it's deprecated\n\tconst { wheelDelta, detail } = event as any;\n\n\tif (wheelDelta !== undefined) {\n\t\tdelta = wheelDelta;\n\t} else if (detail !== undefined) {\n\t\tdelta = -detail;\n\t}\n\n\treturn delta;\n};\n", "import type { Vector3, Camera, Object3D, Matrix4 } from 'three';\nimport { Vector2, Raycaster } from 'three';\n\n/**\n * Represents a touch event anchored to a point along the z=0 plane.\n */\nclass TouchAnchor {\n\ttouch: Vector2;\n\tcamera: Camera;\n\tcameraPlane: Object3D;\n\tviewCoordinate: { x: number; y: number };\n\tsnapHolderMatrix: Matrix4;\n\tsnapCamera: Camera;\n\tcameraPosition?: Vector3;\n\traycaster?: Raycaster;\n\tworldCoordinate?: Vector3 | null;\n\tsnapshotted = false;\n\n\tconstructor(touch: Vector2, camera: Camera, cameraPlane: Object3D) {\n\t\tthis.touch = touch;\n\t\tthis.camera = camera;\n\t\tthis.cameraPlane = cameraPlane;\n\t\tthis.viewCoordinate = { x: touch.x, y: touch.y };\n\t\tthis.camera.updateMatrixWorld();\n\t\tthis.camera.updateMatrix();\n\t\tthis.snapHolderMatrix = this.camera.matrixWorld.clone();\n\t\tthis.snapCamera = this.camera.clone();\n\t\tthis.snapshotCameraState();\n\t}\n\n\t/**\n\t * Calculate and set the world position of this touch anchor.\n\t */\n\tsnapshotCameraState() {\n\t\tthis.camera.updateMatrix();\n\t\tthis.camera.updateMatrixWorld();\n\n\t\tthis.cameraPosition = this.camera.position.clone();\n\n\t\tconst coordinateVector = new Vector2(this.viewCoordinate.x, this.viewCoordinate.y);\n\t\tthis.raycaster = this.raycaster || new Raycaster();\n\t\tthis.raycaster.setFromCamera(coordinateVector, this.snapCamera);\n\n\t\tconst point = this.raycaster.intersectObject(this.cameraPlane, true);\n\t\tthis.worldCoordinate = point && point.length > 0 ? point[0].point : null;\n\n\t\tthis.snapshotted = true;\n\t}\n\n\t/**\n\t * Update anchor state with a new camera and coordinate.\n\t */\n\tupdateAnchorState(camera: Camera, coord: { x: number; y: number }) {\n\t\tthis.camera = camera;\n\t\tthis.snapCamera = camera.clone();\n\t\tthis.snapHolderMatrix = camera.matrixWorld.clone();\n\t\tthis.updateViewCoordinate(coord);\n\t\tthis.snapshotCameraState();\n\t}\n\n\t/**\n\t * Set the current screen touch coordinate for this anchor.\n\t */\n\tupdateViewCoordinate(coord: { x: number; y: number }) {\n\t\tthis.viewCoordinate = { x: coord.x, y: coord.y };\n\t}\n\n\t/**\n\t * Find the world position for the current touch position using the original camera matrices.\n\t */\n\treUnproject(): Vector3 | undefined {\n\t\tconst coordinateVector = new Vector2(this.viewCoordinate.x, this.viewCoordinate.y);\n\n\t\tthis.raycaster?.setFromCamera(coordinateVector, this.snapCamera);\n\t\tconst intersection = this.raycaster?.intersectObject(this.cameraPlane, true)[0];\n\n\t\treturn intersection ? intersection.point : undefined;\n\t}\n}\n\nexport { TouchAnchor };\n", "// These two are from MapLibre GL JS, for consistency\nexport const MAPLIBRE_TILE_SIZE = 512;\nexport const MIN_LAT = -85.051129;\nexport const MAX_LAT = 85.051129;\nexport const CLIPPING_RADIUS = 10000;\nexport const CONTROL_OPTIONS = { chain: 'chain', cancel: 'cancel' };\nexport const TWO_PI = Math.PI * 2;\nexport const ZRANGE = 100;\nexport const WHEEL_ZOOM_MULTIPLIER = 10000;\nexport const MIN_MERCATOR_ZOOM_LEVEL = 0;\nexport const MAX_MERCATOR_ZOOM_LEVEL = 24;\nexport const BLOCK_MERCATOR_ZOOM_LEVEL = 17;\nexport const ROOM_MERCATOR_ZOOM_LEVEL = 20;\nexport const DEFAULT_ANIMATION_DURATION = 200;\nexport const EVENTS = [\n\t'change', // Fired whenever the camera changes.\n\t'pan-start', // Fired when the camera starts panning.\n\t'pan-end', // Fired when the camera finishes panning.\n\t'rotate-start', // Fired when the camera starts rotating.\n\t'rotate-end', // Fired when the camera stops rotating.\n\t'zoom-start', // Fired when the camera starts zooming.\n\t'zoom-end', // Fired when the camera finishes zooming.\n\t'multi-start', // Fired when the camera starts animating or you called setMulti. It means any one or more of pan, tilt, rotate, and zoom could be changing. The individual pan/tilt/rotate/zoom events will NOT be fired.\n\t'multi-end', // Fired when the camera stops animating, or has finished the setMulti call.\n\t'multi-cancel', // Fired when the camera animation was cancelled.\n\t'pedestal-start', // Assuming conversion for consistency\n\t'pedestal-change', // Assuming conversion for consistency\n\t'pedestal-end', // Assuming conversion for consistency\n\t'user-pan-start', // User-initiated pan start event.\n\t'user-pedestal-start', // User-initiated pedestal start event.\n\t'user-rotate-start', // User-initiated rotate start event.\n\t'user-dolly-start', // User-initiated dolly start event.\n\t'user-zoom-start', // User-initiated zoom start event.\n\t'user-tilt-start', // User-initiated tilt start event.\n\t'user-pan-end', // User-initiated pan end event.\n\t'user-pedestal-end', // User-initiated pedestal end event.\n\t'user-rotate-end', // User-initiated rotate end event.\n\t'user-dolly-end', // User-initiated dolly end event.\n\t'user-zoom-end', // User-initiated zoom end event.\n\t'user-tilt-end', // User-initiated tilt end event.\n\t'position-updated', // Fired when the position has been updated.\n\t'zoom-updated', // Fired when the zoom level has been updated.\n\t'tilt-updated', // Fired when the tilt angle has been updated.\n\t'rotation-updated', // Fired when the rotation angle has been updated.\n] as const;\n\nexport const DEFAULT_ZOOM_LEVEL = 18;\nexport const DEFAULT_MIN_ZOOM_LEVEL = 12;\nexport const DEFAULT_MAX_ZOOM_LEVEL = 22;\nexport const DEFAULT_PITCH = 0;\nexport const DEFAULT_BEARING = 0;\n", "import type { RendererState } from '../../renderer';\nimport type { MarkerComponent } from '../../components/marker';\nimport type { Geometry2D } from '../../entities/geometry2d';\nimport { Geometry2DComponents } from '../../entities/geometry2d';\nimport type LabelComponent from '../../components/label';\nimport { Vector3 } from 'three';\n\nexport const ANIMATION_DURATION = 300;\n\nexport class DOMDrawSystem {\n\tstate: RendererState;\n\tconstructor(state: RendererState) {\n\t\tthis.state = state;\n\t}\n\n\t#colliderWorldPosition = new Vector3();\n\t#cameraWorldPosition = new Vector3();\n\n\tupdate(isUserInteracting: boolean) {\n\t\tlet entity: Geometry2D | undefined;\n\t\tlet component: MarkerComponent | LabelComponent | undefined;\n\n\t\tthis.state.cameraObject.getWorldPosition(this.#cameraWorldPosition);\n\t\tfor (const entityId of this.state.geometry2DIdsInScene) {\n\t\t\tentity = this.state.geometry2DMap.get(entityId);\n\t\t\tif (entity) {\n\t\t\t\tcomponent = entity.components[Geometry2DComponents.UI];\n\n\t\t\t\tif (component && 'containerEl' in component && component.markerContainer != null) {\n\t\t\t\t\tif (component.visibilityNeedsUpdate !== false) {\n\t\t\t\t\t\tif (component.visibilityNeedsUpdate === 'show') {\n\t\t\t\t\t\t\tcomponent.canShow = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcomponent.canShow = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// [PERF]: Ensure that we only update the DOM if the component is visible or if it is animating\n\t\t\t\t\tif (\n\t\t\t\t\t\t((component.canShow && component.visible === true) || component.animation?.pending === true) &&\n\t\t\t\t\t\t!component.offscreen\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (component.options.zIndex != null) {\n\t\t\t\t\t\t\tcomponent.markerContainer.style.transform = `translate3D(${component.projection.x}px, ${component.projection.y}px, ${component.options.zIndex}px)`;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tentity.object3d.getWorldPosition(this.#colliderWorldPosition);\n\t\t\t\t\t\t\tconst distanceFromCamera = this.#cameraWorldPosition.distanceTo(this.#colliderWorldPosition);\n\t\t\t\t\t\t\tcomponent.markerContainer.style.transform = `translate3D(${component.projection.x}px, ${\n\t\t\t\t\t\t\t\tcomponent.projection.y\n\t\t\t\t\t\t\t}px, ${-distanceFromCamera}px)`;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (component.canShow === true && component.visible === true) {\n\t\t\t\t\t\tcomponent.markerContainer.style.pointerEvents = isUserInteracting ? 'none' : component.pointerEvents;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcomponent.markerContainer.style.pointerEvents = 'none';\n\t\t\t\t\t}\n\n\t\t\t\t\t// prevent showing the marker if it hasn't picked a placement on its way get shown only\n\t\t\t\t\tif (\n\t\t\t\t\t\tcomponent.currentStrategyIndex === -1 &&\n\t\t\t\t\t\tcomponent.visible &&\n\t\t\t\t\t\tcomponent.visibilityNeedsUpdate === 'show'\n\t\t\t\t\t) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (component.visibilityNeedsUpdate !== false && !component.offscreen) {\n\t\t\t\t\t\tif (component.visibilityNeedsUpdate === 'show') {\n\t\t\t\t\t\t\tcomponent.markerContainer.style.opacity = '0';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (component.animation) {\n\t\t\t\t\t\t\tcomponent.animation.cancel();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// setup animation\n\t\t\t\t\t\tcomponent.animation = component.markerContainer.animate(\n\t\t\t\t\t\t\t[{ opacity: component.canShow && component.visible ? '1' : '0' }],\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tduration: ANIMATION_DURATION,\n\t\t\t\t\t\t\t\teasing: 'ease-in-out',\n\t\t\t\t\t\t\t\tfill: 'forwards',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tcomponent.visibilityNeedsUpdate = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n", "import { PubSub } from '@packages/internal/common';\nimport { MarkerComponent } from '../../components/marker';\nimport { Geometry2DComponents } from '../../entities';\nimport type { Geometry2D } from '../../entities';\nimport type { RendererState } from '../../renderer';\nimport type { Entity2DHTMLDivElementContainer } from '../../types';\n\nexport class DOMResizeSystem extends PubSub<{\n\t'dimensions-update': void;\n}> {\n\tstate: RendererState;\n\tdirty = true;\n\tdomTree: Entity2DHTMLDivElementContainer;\n\tobservers: Map<string | number, ResizeObserver> = new Map();\n\tconstructor(state: RendererState, domTree: Entity2DHTMLDivElementContainer) {\n\t\tsuper();\n\t\tthis.state = state;\n\t\tthis.domTree = domTree;\n\t}\n\n\tsetupObserver() {\n\t\tif (this.observers) {\n\t\t\tfor (const resizeObserver of this.observers.values()) {\n\t\t\t\tresizeObserver.disconnect();\n\t\t\t}\n\t\t\tthis.observers.clear();\n\t\t}\n\t\tlet entity: Geometry2D;\n\t\tlet component: MarkerComponent;\n\t\tfor (const child of this.domTree.children) {\n\t\t\tconst id = child.getAttribute('data-marker-id');\n\t\t\tif (id != null) {\n\t\t\t\tentity = this.state.geometry2DMap.get(id) as Geometry2D;\n\t\t\t\tcomponent = entity.components[Geometry2DComponents.UI] as MarkerComponent; // implied by getAttribut\n\t\t\t\tif (component.options?.dynamicResize) {\n\t\t\t\t\tconst resizeObserver = new ResizeObserver(this.updateDimensions);\n\t\t\t\t\tresizeObserver.observe(component.containerEl); // observing the container el instead of the marker el to avoid pin (::before) pasudo element triggering mutation.\n\t\t\t\t\tthis.observers.set(child.userData.entityId, resizeObserver);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateDimensions = (mutations: ResizeObserverEntry[]) => {\n\t\tmutations.forEach(mutation => {\n\t\t\tconst target = mutation.target as HTMLElement;\n\t\t\tconst id = target.parentElement?.getAttribute('data-marker-id'); // since we are observing the containerEl so we need to access to the markerContainerEl for marker id\n\t\t\tif (id) {\n\t\t\t\tconst entity = this.state.geometry2DMap.get(id);\n\t\t\t\tconst component = entity?.components[Geometry2DComponents.UI];\n\t\t\t\tif (entity && component instanceof MarkerComponent) {\n\t\t\t\t\tcomponent.updateDimensions(mutation.contentRect.width, mutation.contentRect.height);\n\t\t\t\t\tcomponent.collisionDirty = true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.publish('dimensions-update');\n\t};\n\n\tupdate() {\n\t\tif (this.dirty) {\n\t\t\tthis.setupObserver();\n\t\t\tthis.dirty = false;\n\t\t}\n\t}\n\n\tdestroy() {\n\t\tfor (const resizeObserver of this.observers.values()) {\n\t\t\tresizeObserver.disconnect();\n\t\t}\n\t\tthis.observers.clear();\n\t}\n}\n", "import { Box3, MathUtils, Vector3 } from 'three';\nimport type { RendererCore } from '.';\nimport type { Position as GeoJSONPosition } from 'geojson';\nimport type { InsetPadding, Position, All3DTypes } from '../src/types';\nimport { Easing, type Tween } from '@tweenjs/tween.js';\nimport type { InsetPaddingOption, RendererState, Systems } from './renderer';\nimport { type LngLatBoundsLike } from '@packages/internal/outdoor-context-v5';\nimport { clampWithWarning, Logger, type EasingCurve } from '@packages/internal/common';\nimport { CAMERA_CONSTANTS } from './systems/camera';\nimport { DEFAULT_INSET_PADDING } from './utils/constants';\nimport { getVerticesOfEntity } from './utils/ecs';\nimport { GroupContainerObject3D } from './entities/group-container';\n\n// the default values, but also the valid range\nconst defaultMinPitch = 0;\nconst defaultMaxPitch = 90;\n\nconst DEBUG_FOCUSON_BOUNDS = process.env.NODE_ENV === 'test' ? false : false;\n\nexport type AnimationOptions = {\n\tduration?: number;\n\teasing?: EasingCurve;\n};\n\nexport type AnimateElevationOptions = AnimationOptions & {\n\tinterruptible?: boolean;\n};\n\nexport type FocusOnOptions = AnimationOptions & {\n\tbearing?: number;\n\tpitch?: number;\n\tpadding?: InsetPaddingOption;\n\tminZoomLevel?: number;\n\tmaxZoomLevel?: number;\n\tinterruptible?: boolean;\n\tverticalPadding?: number;\n};\n\nexport type AnimateToOptions = AnimationOptions & {\n\tcenter?: Position;\n\tzoomLevel?: number;\n\tbearing?: number;\n\tpitch?: number;\n\televation?: number;\n\tinterruptible?: boolean;\n};\n\nexport const ANIMATION_TWEENS = {\n\tlinear: Easing.Linear.None,\n\t'ease-in': Easing.Quadratic.In,\n\t'ease-out': Easing.Quadratic.Out,\n\t'ease-in-out': Easing.Quadratic.InOut,\n};\n\n/**\n * Fixes the issue with underground floors disappearing when viewed from above (in meters)\n */\nconst MAX_UNDERGROUND_DEPTH = -50;\n\nexport class Camera {\n\t#core: RendererCore;\n\t#systems: Systems;\n\t#state: RendererState;\n\t/**\n\t * @internal\n\t */\n\tconstructor(core: RendererCore, systems: Systems, state: RendererState) {\n\t\tthis.#core = core;\n\t\tthis.#systems = systems;\n\t\tthis.#state = state;\n\t\tif (this.#core.map) {\n\t\t\tthis.#core.map.transform.setMinElevationForCurrentTile(MAX_UNDERGROUND_DEPTH);\n\t\t}\n\t\tthis.#systems.cameraSystem.on('pedestal-change', ({ pedestal: elevation }) => {\n\t\t\tthis.#systems.cameraSystem.setCameraPlaneElevation(elevation);\n\t\t});\n\t}\n\n\t/**\n\t * The camera's current center in [longitude, latitude] degrees.\n\t */\n\tget center() {\n\t\tif (this.#core.mode === 'outdoors-overlay' && this.#core.map) {\n\t\t\treturn this.#core.map.getCenter?.().toArray() as Position;\n\t\t}\n\n\t\treturn this.#systems.cameraSystem.center;\n\t}\n\n\t/**\n\t * @param center The center in [longitude, latitude] degrees.\n\t */\n\tsetCenter(center: Position) {\n\t\tif (this.#core.mode === 'outdoors-overlay' && this.#core.map) {\n\t\t\tthis.#core.map?.setCenter(center as [number, number]);\n\t\t\tthis.#systems.interactionSystem.handleHover();\n\n\t\t\treturn;\n\t\t}\n\t\tthis.#systems.cameraSystem.setCenter(center[0], center[1]);\n\t\tthis.#systems.interactionSystem.handleHover();\n\t}\n\n\t/**\n\t * Current camera zoom in mercator zoom level units.\n\t */\n\tget zoomLevel() {\n\t\tif (this.#core.mode === 'outdoors-overlay' && this.#core.map) {\n\t\t\treturn this.#core.map?.getZoom();\n\t\t}\n\n\t\treturn this.#systems.cameraSystem.getZoomLevel();\n\t}\n\n\t/**\n\t * Set the camera's zoom level in mercator zoom level units.\n\t */\n\tsetZoomLevel(zoomLevel: number) {\n\t\tif (this.#core.mode === 'outdoors-overlay' && this.#core.map) {\n\t\t\tthis.#core.map?.setZoom(zoomLevel);\n\t\t}\n\n\t\tthis.#systems.cameraSystem.setZoomLevel(\n\t\t\tclampWithWarning(\n\t\t\t\tzoomLevel,\n\t\t\t\tthis.minZoomLevel,\n\t\t\t\tthis.maxZoomLevel,\n\t\t\t\t'zoomLevel was clamped to minZoomLevel/maxZoomLevel bounds. Use mapView.Camera.setMinZoomLevel() and mapView.Camera.setMaxZoomLevel() to adjust limits.',\n\t\t\t),\n\t\t);\n\t}\n\n\tgetState() {\n\t\treturn {\n\t\t\tzoomLevel: this.zoomLevel,\n\t\t\tminZoomLevel: this.minZoomLevel,\n\t\t\tmaxZoomLevel: this.maxZoomLevel,\n\t\t\tminPitch: this.minPitch,\n\t\t\tmaxPitch: this.maxPitch,\n\t\t\tautoMinZoomLevel: this.autoMinZoomLevel,\n\t\t\tpanMode: this.panMode,\n\t\t\tscreenOffsets: this.insetsPadding,\n\t\t\tcenter: this.center as [number, number],\n\t\t\tbearing: this.bearing,\n\t\t\tpitch: this.pitch,\n\t\t\televation: this.elevation,\n\t\t};\n\t}\n\n\t/**\n\t * Whether the camera is animating.\n\t */\n\tget isAnimating() {\n\t\treturn this.#systems.cameraSystem.isAnimating;\n\t}\n\n\t/**\n\t * Cancel the last animation.\n\t */\n\tcancelAnimation() {\n\t\tthis.#systems.cameraSystem.cancelAnimation();\n\t}\n\n\t/**\n\t * How far the camera can zoom in towards the ground\n\t */\n\tget maxZoomLevel() {\n\t\treturn this.#systems.cameraSystem.maxZoomLevel;\n\t}\n\n\t/**\n\t * How far the camera can zoom out away from the ground\n\t */\n\tget minZoomLevel() {\n\t\treturn this.#systems.cameraSystem.minZoomLevel;\n\t}\n\n\t/**\n\t * Toggle the mode of the camera to automatically set the minimum zoom level based on the size of the scene.\n\t * It will be automatically disabled when the minimum zoom level is set manually.\n\t * @param value The new value for the auto min zoom level mode.\n\t */\n\tsetAutoMinZoomLevel(value: boolean) {\n\t\tthis.#systems.panBoundsSystem.autoMinZoomLevel = value;\n\t\tif (value) {\n\t\t\tthis.#systems.panBoundsSystem.dirty = true;\n\t\t\tthis.#systems.panBoundsSystem.update();\n\t\t}\n\t}\n\n\t/**\n\t * The mode of the camera to automatically set the minimum zoom level based on the size of the scene.\n\t */\n\tget autoMinZoomLevel() {\n\t\treturn this.#systems.panBoundsSystem.autoMinZoomLevel;\n\t}\n\n\t/**\n\t * How far out the camera can zoom\n\t *\n\t * @param zoomLevel  The minimum zoom level in mercator zoom level units.\n\t * @default 0\n\t */\n\tsetMinZoomLevel(zoomLevel: number, disableAutoMinZoomLevel = false) {\n\t\tif (disableAutoMinZoomLevel) this.setAutoMinZoomLevel(false);\n\n\t\tconst targetMinZoom = clampWithWarning(\n\t\t\tzoomLevel,\n\t\t\tCAMERA_CONSTANTS.MIN_MERCATOR_ZOOM_LEVEL,\n\t\t\tthis.maxZoomLevel,\n\t\t\t`setMinZoomLevel was clamped. minZoomLevel must be between ${CAMERA_CONSTANTS.MIN_MERCATOR_ZOOM_LEVEL} and maxZoomLevel.`,\n\t\t);\n\t\tthis.#systems.cameraSystem.setMinZoomLevel(targetMinZoom);\n\t\t// make sure that we snap to the nearest zoom level if zoom level is below the new min zoom level\n\t\tif (this.zoomLevel < targetMinZoom) {\n\t\t\tthis.setZoomLevel(targetMinZoom);\n\t\t}\n\t\tthis.#core.map?.setMinZoom(targetMinZoom);\n\t}\n\n\t/**\n\t * How far in the camera can zoom\n\t *\n\t * @param zoomLevel The maximum zoom level in mercator zoom level units.\n\t * @default Infinity\n\t */\n\tsetMaxZoomLevel(zoomLevel: number) {\n\t\tconst targetMaxZoom = clampWithWarning(\n\t\t\tzoomLevel,\n\t\t\tthis.minZoomLevel,\n\t\t\tCAMERA_CONSTANTS.MAX_MERCATOR_ZOOM_LEVEL,\n\t\t\t`setMaxZoomLevel was clamped. maxZoomLevel must be between minZoomLevel and ${CAMERA_CONSTANTS.MAX_MERCATOR_ZOOM_LEVEL}.`,\n\t\t);\n\t\tthis.#systems.cameraSystem.setMaxZoomLevel(targetMaxZoom);\n\t\t// make sure that we snap to the nearest zoom level if zoom level is above the new max zoom level\n\t\tif (this.zoomLevel > targetMaxZoom) {\n\t\t\tthis.setZoomLevel(targetMaxZoom);\n\t\t}\n\t\tthis.#core.map?.setMaxZoom(targetMaxZoom);\n\t}\n\n\t/**\n\t * The maximum pitch in degrees.\n\t */\n\tget maxPitch() {\n\t\tif (this.#core.mode === 'outdoors-overlay' && this.#core.map) {\n\t\t\treturn this.#core.map?.getMaxPitch?.();\n\t\t}\n\n\t\treturn MathUtils.radToDeg(this.#systems.cameraSystem.maxTilt);\n\t}\n\n\t/**\n\t * The minimum pitch in degrees.\n\t */\n\tget minPitch() {\n\t\tif (this.#core.mode === 'outdoors-overlay' && this.#core.map) {\n\t\t\treturn this.#core.map?.getMinPitch?.();\n\t\t}\n\n\t\treturn MathUtils.radToDeg(this.#systems.cameraSystem.minTilt);\n\t}\n\n\t/**\n\t * @param pitch The minimum pitch in degrees.\n\t */\n\tsetMinPitch(pitch: number) {\n\t\tconst targetMinPitch = Math.max(defaultMinPitch, pitch);\n\t\tthis.#core.map?.setMinPitch(targetMinPitch);\n\t\tthis.#systems.cameraSystem.minTilt = MathUtils.degToRad(targetMinPitch);\n\t}\n\n\t/**\n\t * @param pitch The maximum pitch in degrees.\n\t */\n\tsetMaxPitch(pitch: number) {\n\t\tconst targetMaxPitch = Math.min(defaultMaxPitch, pitch);\n\t\tthis.#core.map?.setMaxPitch(targetMaxPitch);\n\t\tthis.#systems.cameraSystem.maxTilt = MathUtils.degToRad(targetMaxPitch);\n\t}\n\n\t/**\n\t * The camera's current clockwise rotation in degrees from north.\n\t */\n\tget bearing() {\n\t\tif (this.#core.mode === 'outdoors-overlay' && this.#core.map) {\n\t\t\treturn this.#core.map?.getBearing();\n\t\t}\n\n\t\treturn MathUtils.radToDeg(this.#systems.cameraSystem.getRotation());\n\t}\n\n\t/**\n\t * @param bearing The bearing in degrees from north.\n\t */\n\tsetBearing(bearing: number) {\n\t\tif (this.#core.mode === 'outdoors-overlay' && this.#core.map) {\n\t\t\tthis.#core.map?.setBearing(bearing);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#systems.cameraSystem.setRotation(MathUtils.degToRad(bearing));\n\t}\n\n\t/**\n\t * The camera's current pitch in degrees.\n\t */\n\tget pitch() {\n\t\tif (this.#core.mode === 'outdoors-overlay' && this.#core.map) {\n\t\t\treturn this.#core.map?.getPitch();\n\t\t}\n\n\t\treturn MathUtils.radToDeg(this.#systems.cameraSystem.getTilt());\n\t}\n\n\t/**\n\t *\n\t * @param pitch The pitch in degrees.\n\t */\n\tsetPitch(pitch: number) {\n\t\tif (this.#core.mode === 'outdoors-overlay' && this.#core.map) {\n\t\t\tthis.#core.map?.setPitch(pitch);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#systems.cameraSystem.setTilt(\n\t\t\tMathUtils.degToRad(\n\t\t\t\tclampWithWarning(\n\t\t\t\t\tpitch,\n\t\t\t\t\tthis.minPitch,\n\t\t\t\t\tthis.maxPitch,\n\t\t\t\t\t'pitch was clamped to minPitch/maxPitch bounds. Use mapView.Camera.setMinPitch() and mapView.Camera.setMaxPitch() to adjust limits.',\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t}\n\n\t/**\n\t * The camera's current elevation in meters from the ground.\n\t */\n\tget elevation() {\n\t\treturn this.#systems.cameraSystem.getPedestal();\n\t}\n\n\t/**\n\t * @param elevation The elevation in meters.\n\t */\n\tsetElevation(elevation: number) {\n\t\tthis.#systems.cameraSystem.setPedestal(elevation, true);\n\t}\n\n\t#elevationAnimation?: Tween;\n\n\t/**\n\t * Animate the camera's elevation to a new value.\n\t * @param elevation The new elevation in meters.\n\t * @param options The animation options.\n\t */\n\tanimateElevation(elevation: number, options?: AnimateElevationOptions) {\n\t\tif (this.#elevationAnimation) {\n\t\t\tthis.#elevationAnimation.stop();\n\t\t}\n\n\t\treturn new Promise<void>(resolve => {\n\t\t\tthis.#systems.cameraSystem.animateCamera(\n\t\t\t\t{\n\t\t\t\t\t// Only animate the z position, allowing the user to pan while the camera moves vertically\n\t\t\t\t\tposition: { z: elevation },\n\t\t\t\t},\n\t\t\t\toptions?.duration || 300,\n\t\t\t\tANIMATION_TWEENS[options?.easing || 'ease-in-out'],\n\t\t\t\tresolve,\n\t\t\t\tresolve,\n\t\t\t\t{\n\t\t\t\t\tinterruptible: options?.interruptible ?? true,\n\t\t\t\t},\n\t\t\t);\n\t\t});\n\t}\n\n\t/**\n\t * The padding around the edges of the map when focusing on a set of coordinates.\n\t */\n\tget insetsPadding() {\n\t\treturn this.#state.insetsPadding;\n\t}\n\n\t/**\n\t * The camera's current pan mode.\n\t */\n\tget panMode() {\n\t\treturn this.#systems.cameraSystem.enablePan === false && this.#systems.cameraSystem.enablePedestal === true\n\t\t\t? ('elevation' as const)\n\t\t\t: ('default' as const);\n\t}\n\n\t/**\n\t * Set the camera's pan mode. 'elevation' moves the camera up and down, while 'default' allows the camera to pan along the ground.\n\t */\n\tsetPanMode(panMode: 'default' | 'elevation') {\n\t\tif (panMode !== 'default' && panMode !== 'elevation') {\n\t\t\tthrow new Error('Invalid pan mode');\n\t\t}\n\t\tif (panMode === this.panMode) {\n\t\t\treturn;\n\t\t}\n\t\tif (panMode === 'default') {\n\t\t\tthis.#systems.cameraSystem.enablePan = true;\n\t\t\tthis.#systems.cameraSystem.enablePedestal = false;\n\t\t} else {\n\t\t\tthis.#systems.cameraSystem.enablePan = false;\n\t\t\tthis.#systems.cameraSystem.enablePedestal = true;\n\t\t}\n\t}\n\n\t/**\n\t *\n\t * @param padding The padding around the edges of the map when focusing on a set of coordinates (in screen pixels).\n\t */\n\tsetInsetPadding(padding: Partial<InsetPadding>) {\n\t\tthis.#state.insetsPadding = Object.assign({}, this.#state.insetsPadding, padding);\n\t}\n\n\tanimateTo(options: AnimateToOptions) {\n\t\tif (this.#core.mode === 'outdoors-overlay' && this.#core.map) {\n\t\t\tthis.#core.map?.flyTo({\n\t\t\t\tcenter: (options.center ?? this.center) as [number, number],\n\t\t\t\tzoom: options.zoomLevel ?? this.zoomLevel,\n\t\t\t\tbearing: options.bearing ?? this.bearing,\n\t\t\t\tpitch: options.pitch ?? this.pitch,\n\t\t\t\tduration: options.duration ?? 600,\n\t\t\t\t// TODO: add easing\n\t\t\t\t// easing: options.easing,\n\t\t\t});\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst position = options.center\n\t\t\t? this.#core.convertTo3DMapPosition(options.center[1], options.center[0], options.center[2] || this.elevation)\n\t\t\t: undefined;\n\t\tconst zoom =\n\t\t\toptions.zoomLevel !== undefined\n\t\t\t\t? this.#systems.cameraSystem.convertZoomLevelToAltitude(\n\t\t\t\t\t\tclampWithWarning(\n\t\t\t\t\t\t\toptions.zoomLevel,\n\t\t\t\t\t\t\tthis.minZoomLevel,\n\t\t\t\t\t\t\tthis.maxZoomLevel,\n\t\t\t\t\t\t\t'zoomLevel was clamped to minZoomLevel/maxZoomLevel bounds. Use mapView.Camera.setMinZoomLevel() and mapView.Camera.setMaxZoomLevel() to adjust limits.',\n\t\t\t\t\t\t),\n\t\t\t\t  )\n\t\t\t\t: undefined;\n\t\tconst rotation = options.bearing !== undefined ? MathUtils.degToRad(options.bearing) : undefined;\n\t\tconst tilt =\n\t\t\toptions.pitch !== undefined\n\t\t\t\t? MathUtils.degToRad(\n\t\t\t\t\t\tclampWithWarning(\n\t\t\t\t\t\t\toptions.pitch,\n\t\t\t\t\t\t\tthis.minPitch,\n\t\t\t\t\t\t\tthis.maxPitch,\n\t\t\t\t\t\t\t'pitch was clamped to minPitch/maxPitch bounds. Use mapView.Camera.setMinPitch() and mapView.Camera.setMaxPitch() to adjust limits.',\n\t\t\t\t\t\t),\n\t\t\t\t  )\n\t\t\t\t: undefined;\n\n\t\treturn new Promise<void>(resolve => {\n\t\t\tthis.#systems.cameraSystem.animateCamera(\n\t\t\t\t{ position, zoom, rotation, tilt },\n\t\t\t\toptions.duration || 0,\n\t\t\t\tANIMATION_TWEENS[options.easing || 'ease-in-out'],\n\t\t\t\t() => {\n\t\t\t\t\tthis.#systems.interactionSystem.handleHover();\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t\tresolve,\n\t\t\t\t{\n\t\t\t\t\tinterruptible: options?.interruptible ?? true,\n\t\t\t\t},\n\t\t\t);\n\t\t});\n\t}\n\n\tgetCameraFrameForCoordinates(coordinates: (GeoJSONPosition | Position | string)[], options?: FocusOnOptions) {\n\t\tconst _options = this.#convertToLegacy(options || {}, () => Promise.resolve());\n\n\t\tconst { pointCloud } = processTargets(coordinates, this.#core, this.#state.geometry3DMap);\n\t\tif (pointCloud.length === 0) {\n\t\t\tLogger.error('No valid coordinates found in targets:', coordinates);\n\n\t\t\treturn {\n\t\t\t\tcenter: this.center,\n\t\t\t\tzoomLevel: this.zoomLevel,\n\t\t\t};\n\t\t}\n\n\t\tconst { center, zoomLevel } = this.#systems.cameraSystem.getCameraFrameForCoordinates(pointCloud, _options);\n\n\t\treturn {\n\t\t\tcenter: this.#core.convert3DMapPositionToCoordinate(center),\n\t\t\tzoomLevel: zoomLevel,\n\t\t};\n\t}\n\n\t#convertToLegacy(options: FocusOnOptions, resolve: (value: void | PromiseLike<void>) => void) {\n\t\treturn {\n\t\t\tminZoom:\n\t\t\t\toptions?.maxZoomLevel === undefined\n\t\t\t\t\t? undefined\n\t\t\t\t\t: this.#systems.cameraSystem.convertZoomLevelToAltitude(\n\t\t\t\t\t\t\tclampWithWarning(\n\t\t\t\t\t\t\t\toptions.maxZoomLevel,\n\t\t\t\t\t\t\t\tthis.minZoomLevel,\n\t\t\t\t\t\t\t\tthis.maxZoomLevel,\n\t\t\t\t\t\t\t\t'maxZoomLevel was clamped to minZoomLevel/maxZoomLevel bounds. Use mapView.Camera.setMaxZoomLevel() to adjust limits.',\n\t\t\t\t\t\t\t),\n\t\t\t\t\t  ),\n\t\t\tmaxZoom:\n\t\t\t\toptions?.minZoomLevel === undefined\n\t\t\t\t\t? undefined\n\t\t\t\t\t: this.#systems.cameraSystem.convertZoomLevelToAltitude(\n\t\t\t\t\t\t\tclampWithWarning(\n\t\t\t\t\t\t\t\toptions.minZoomLevel,\n\t\t\t\t\t\t\t\tthis.minZoomLevel,\n\t\t\t\t\t\t\t\tthis.maxZoomLevel,\n\t\t\t\t\t\t\t\t'minZoomLevel was clamped to minZoomLevel/maxZoomLevel bounds. Use mapView.Camera.setMinZoomLevel() to adjust limits.',\n\t\t\t\t\t\t\t),\n\t\t\t\t\t  ),\n\n\t\t\tpadding: options?.padding ? Object.assign({}, DEFAULT_INSET_PADDING, options?.padding) : this.insetsPadding,\n\t\t\tcurve: ANIMATION_TWEENS[options?.easing || 'ease-in-out'],\n\t\t\trotation: options?.bearing === undefined ? undefined : MathUtils.degToRad(options.bearing),\n\t\t\ttilt:\n\t\t\t\toptions?.pitch !== undefined\n\t\t\t\t\t? MathUtils.degToRad(\n\t\t\t\t\t\t\tclampWithWarning(\n\t\t\t\t\t\t\t\toptions.pitch,\n\t\t\t\t\t\t\t\tthis.minPitch,\n\t\t\t\t\t\t\t\tthis.maxPitch,\n\t\t\t\t\t\t\t\t'pitch was clamped to minPitch/maxPitch bounds. Use mapView.Camera.setMinPitch() and mapView.Camera.setMaxPitch() to adjust limits.',\n\t\t\t\t\t\t\t),\n\t\t\t\t\t  )\n\t\t\t\t\t: undefined,\n\t\t\tduration: options?.duration,\n\t\t\tcallback: () => {\n\t\t\t\tthis.#systems.interactionSystem.handleHover();\n\t\t\t\tresolve();\n\t\t\t},\n\t\t\tcancelledCallback: resolve,\n\t\t\tinterruptible: options?.interruptible ?? true,\n\t\t\tverticalPadding: options?.verticalPadding,\n\t\t};\n\t}\n\n\t/**\n\t *  Focuses the camera on a set of coordinates, with optional animation\n\t *\n\t * @param target list of [longitude, latitude, altitude?] points\n\t * @param options {FocusOnOptions}\n\t * @returns Promise<void>\n\t */\n\tfocusOn(target: (GeoJSONPosition | Position | string)[], options?: FocusOnOptions) {\n\t\tconst { pointCloud, geoBounds, firstPosition } = processTargets(target, this.#core, this.#state.geometry3DMap);\n\t\tif (pointCloud.length === 0) {\n\t\t\tLogger.error('No valid coordinates found in targets:', target);\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tif (this.#core.mode === 'outdoors-overlay' && this.#core.map) {\n\t\t\tif (pointCloud.length === 1 && firstPosition) {\n\t\t\t\tthis.#core.map?.flyTo({\n\t\t\t\t\tcenter: [firstPosition[0], firstPosition[1]],\n\t\t\t\t\tduration: options?.duration || this.#core.map.getBearing(),\n\t\t\t\t\tanimate: true,\n\t\t\t\t\t// padding: options?.padding,\n\t\t\t\t\tbearing: options?.bearing === undefined ? this.#core.map.getBearing() : options?.bearing,\n\t\t\t\t\tpitch: options?.pitch === undefined ? this.#core.map.getPitch() : options?.pitch,\n\t\t\t\t\tzoom: options?.maxZoomLevel || this.#core.map.getMaxZoom(),\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (DEBUG_FOCUSON_BOUNDS) {\n\t\t\t\t\tdrawBounds(this.#core, geoBounds);\n\t\t\t\t}\n\n\t\t\t\t// FIXME: bring back animation\n\t\t\t\tthis.#core.map?.fitBounds(geoBounds, {\n\t\t\t\t\tduration: options?.duration ?? CAMERA_CONSTANTS.DEFAULT_ANIMATION_DURATION,\n\t\t\t\t\tbearing: options?.bearing === undefined ? this.#core.map.getBearing() : options?.bearing,\n\t\t\t\t\tpitch: options?.pitch === undefined ? this.#core.map.getPitch() : options?.pitch,\n\t\t\t\t\tmaxZoom: options?.maxZoomLevel ?? this.#core.map.getMaxZoom(),\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.#systems.interactionSystem.handleHover();\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise<void>(resolve => {\n\t\t\tthis.#systems.cameraSystem.focusOn(pointCloud, this.#convertToLegacy(options || {}, resolve));\n\t\t});\n\t}\n}\n\nfunction updateBounds(bounds: LngLatBoundsLike, coord: Position | GeoJSONPosition) {\n\tbounds[0] = Math.min(bounds[0], coord[0]);\n\tbounds[1] = Math.min(bounds[1], coord[1]);\n\tbounds[2] = Math.max(bounds[2], coord[0]);\n\tbounds[3] = Math.max(bounds[3], coord[1]);\n}\n\nexport function processTargets(\n\ttargets: (GeoJSONPosition | Position | string)[],\n\tcore: RendererCore,\n\tgeometry3DMap: Map<string | number, All3DTypes>,\n): { pointCloud: Vector3[]; geoBounds: LngLatBoundsLike; firstPosition: (Position | GeoJSONPosition) | null } {\n\tconst pointCloud: Vector3[] = [];\n\tconst geoBounds: LngLatBoundsLike = [Infinity, Infinity, -Infinity, -Infinity];\n\tlet firstPosition: (Position | GeoJSONPosition) | null = null;\n\n\t// Early validation of input\n\tif (!targets || !Array.isArray(targets) || targets.length === 0) {\n\t\treturn { pointCloud, geoBounds, firstPosition };\n\t}\n\n\t// Check if render state is dirty\n\tconst renderSystem = core.getSystems().renderSystem;\n\n\tfor (const coord of targets) {\n\t\tif (typeof coord === 'string') {\n\t\t\t// we only need a render for non coordinate targets\n\t\t\tif (renderSystem.threeDdirty || renderSystem.twoDdirty) {\n\t\t\t\tcore.renderSync();\n\t\t\t}\n\t\t\tconst entity = geometry3DMap.get(coord);\n\t\t\tif (!entity) {\n\t\t\t\tLogger.error('Entity not found with id:', coord);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst boundingBox = new Box3();\n\t\t\tgetVerticesOfEntity(\n\t\t\t\tcore,\n\t\t\t\t'userData' in entity ? entity.userData.entityId ?? entity.id : entity.id,\n\t\t\t\tpointCloud,\n\t\t\t\tboundingBox,\n\t\t\t\tentity instanceof GroupContainerObject3D ? entity.position.z : undefined,\n\t\t\t);\n\t\t\tconst min = core.convert3DMapPositionToCoordinate(boundingBox.min);\n\t\t\tconst max = core.convert3DMapPositionToCoordinate(boundingBox.max);\n\t\t\tupdateBounds(geoBounds, min);\n\t\t\tupdateBounds(geoBounds, max);\n\t\t\tif (!firstPosition) {\n\t\t\t\tfirstPosition = core.convert3DMapPositionToCoordinate(boundingBox.getCenter(new Vector3()));\n\t\t\t}\n\t\t} else {\n\t\t\tpointCloud.push(core.convertTo3DMapPosition(coord[1], coord[0], coord[2] || 0));\n\t\t\tupdateBounds(geoBounds, coord);\n\t\t\tif (!firstPosition) {\n\t\t\t\tfirstPosition = coord;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn { pointCloud, geoBounds, firstPosition };\n}\n\nfunction drawBounds(core: RendererCore, geoBounds: LngLatBoundsLike) {\n\t// Draw bounds on the map for debugging\n\tconst boundsCoordinates = [\n\t\t[geoBounds[0], geoBounds[1]], // Southwest corner\n\t\t[geoBounds[0], geoBounds[3]], // Northwest corner\n\t\t[geoBounds[2], geoBounds[3]], // Northeast corner\n\t\t[geoBounds[2], geoBounds[1]], // Southeast corner\n\t\t[geoBounds[0], geoBounds[1]], // Back to Southwest to close the polygon\n\t];\n\n\t// Remove previous bounds layer if it exists\n\tif (core.map?.getLayer('bounds-outline')) {\n\t\tcore.map.removeLayer('bounds-outline');\n\t}\n\tif (core.map?.getSource('bounds-source')) {\n\t\tcore.map.removeSource('bounds-source');\n\t}\n\n\t// Add the bounds as a source and layer\n\tcore.map?.addSource('bounds-source', {\n\t\ttype: 'geojson',\n\t\tdata: {\n\t\t\ttype: 'Feature',\n\t\t\tproperties: {},\n\t\t\tgeometry: {\n\t\t\t\ttype: 'LineString',\n\t\t\t\tcoordinates: boundsCoordinates,\n\t\t\t},\n\t\t},\n\t});\n\n\tcore.map?.addLayer({\n\t\tid: 'bounds-outline',\n\t\ttype: 'line',\n\t\tsource: 'bounds-source',\n\t\tlayout: {},\n\t\tpaint: {\n\t\t\t'line-color': '#FF0000',\n\t\t\t'line-width': 2,\n\t\t\t'line-opacity': 0.8,\n\t\t},\n\t});\n}\n", "import type { PerspectiveCamera } from 'three';\nimport { BoxGeometry, Mesh, MeshBasicMaterial, PlaneGeometry, ShaderMaterial, Vector4 } from 'three';\nimport WatermarkVertexShader from './watermark-vertex.glsl';\nimport WatermarkFragmentShader from './watermark-fragment.glsl';\nimport { PubSub } from '@packages/internal/common';\nimport type { Geometry2D } from '../../entities';\nimport type { QuadTree } from '@packages/internal/quad-tree';\nimport { Rectangle } from '@packages/internal/quad-tree';\nimport {\n\tWATERMARK_LOGO_ASPECT_RATIO,\n\tWATERMARK_ICON_DEFAULT_WIDTH,\n\tWATERMARK_ICON_MIN_WIDTH,\n\tWATERMARK_LOGO_DEFAULT_WIDTH,\n\tWATERMARK_LOGO_MIN_WIDTH,\n\tWATERMARK_ICON_ASPECT_RATIO,\n} from './constants';\nimport type { RendererState } from '../../renderer';\nimport { getLogoIcon } from './logos';\nimport { TextureLoader } from '../../utils/texture-loader';\nimport { destroyObject3D } from '../../utils/object3d-destroy';\n\nconst DEBUG = false;\n\nexport type WatermarkPosition =\n\t| 'top-left'\n\t| 'top-right'\n\t| 'bottom-left'\n\t| 'bottom-right'\n\t| 'center'\n\t| 'top'\n\t| 'bottom'\n\t| 'left'\n\t| 'right';\n\nexport type WatermarkOptions = {\n\t/**\n\t * Padding in pixels. Can be a number or an object with top, right, bottom, and left properties.\n\t * @default 16\n\t */\n\tpadding?: number | { top?: number; right?: number; bottom?: number; left?: number };\n\t/**\n\t * Position of the watermark on the screen.\n\t * @default 'bottom-left'\n\t */\n\tposition?: WatermarkPosition;\n\t/**\n\t * Show only the Mappedin icon without text.\n\t * @default false\n\t */\n\ticonOnly?: boolean;\n\t/**\n\t * Color of the watermark.\n\t * @default 'dark'\n\t */\n\tcolor?: 'light' | 'dark';\n\t/**\n\t * Scale of the watermark between 0.5 and 1.5.\n\t * @default 1\n\t */\n\tscale?: number;\n\t/**\n\t * Callback when the watermark is clicked.\n\t * @hidden\n\t */\n\tonClick?: () => void;\n\t/**\n\t * Whether the watermark is interactive.\n\t * @default true\n\t */\n\tinteractive?: boolean;\n\t/**\n\t * Whether the watermark should be visible.\n\t * @hidden\n\t * @default true\n\t */\n\tvisible?: boolean;\n};\n\nexport type WatermarkUpdateOptions = Omit<WatermarkOptions, 'onClick' | 'visible'> & {\n\t/** Show the Mappedin watermark. */\n\tvisible?: boolean;\n\t/** Set the interactivity of the watermark. */\n\tinteractive?: boolean;\n};\n\nexport class WatermarkSystem extends PubSub<{\n\t'texture-loaded': void;\n}> {\n\t#options: Required<WatermarkOptions> = {\n\t\tpadding: 16,\n\t\tscale: 1,\n\t\ticonOnly: false,\n\t\tposition: 'bottom-left',\n\t\tcolor: 'dark',\n\t\tonClick: () => {\n\t\t\tif (window != null) {\n\t\t\t\twindow.open('https://www.mappedin.com');\n\t\t\t}\n\t\t},\n\t\tinteractive: true,\n\t\tvisible: true,\n\t};\n\t#rendererState: RendererState;\n\t#cameraObject: PerspectiveCamera;\n\t#mesh?: Mesh;\n\t#material?: ShaderMaterial = undefined;\n\t#collider?: Rectangle<{ entityId: 'watermark' }> = undefined;\n\t#width = 0;\n\t#height = 0;\n\tdirty = true;\n\n\tprivate get color() {\n\t\treturn this.#options.color === 'light' ? 'white' : '#293136';\n\t}\n\n\tprivate get iconName() {\n\t\treturn this.#options.iconOnly ? 'icon' : 'horizontal';\n\t}\n\n\tprivate get minWidth() {\n\t\treturn this.#options.iconOnly ? WATERMARK_ICON_MIN_WIDTH : WATERMARK_LOGO_MIN_WIDTH;\n\t}\n\n\tprivate get defaultWidth() {\n\t\treturn this.#options.iconOnly ? WATERMARK_ICON_DEFAULT_WIDTH : WATERMARK_LOGO_DEFAULT_WIDTH;\n\t}\n\n\tprivate get aspectRatio() {\n\t\treturn this.#options.iconOnly ? WATERMARK_ICON_ASPECT_RATIO : WATERMARK_LOGO_ASPECT_RATIO;\n\t}\n\n\tget options(): Required<WatermarkOptions> {\n\t\treturn { ...this.#options };\n\t}\n\n\tset options(options: WatermarkUpdateOptions) {\n\t\tthis.#options = {\n\t\t\tpadding: options.padding || this.#options.padding,\n\t\t\tposition: options.position || this.#options.position,\n\t\t\ticonOnly: options.iconOnly || this.#options.iconOnly,\n\t\t\tcolor: options.color || this.#options.color,\n\t\t\tscale: options.scale || this.#options.scale,\n\t\t\tonClick: this.#options.onClick,\n\t\t\tinteractive: options.interactive ?? this.#options.interactive,\n\t\t\tvisible: options.visible ?? this.#options.visible,\n\t\t};\n\t}\n\n\tget icon() {\n\t\treturn getLogoIcon(\n\t\t\tthis.iconName,\n\t\t\tthis.color,\n\t\t\tthis.#width * this.#rendererState.pixelRatio,\n\t\t\tthis.#height * this.#rendererState.pixelRatio,\n\t\t);\n\t}\n\n\tconstructor(cameraObject: PerspectiveCamera, rendererState: RendererState, options?: Partial<WatermarkOptions>) {\n\t\tsuper();\n\n\t\tif (options) {\n\t\t\t// Assign options but fallback to defaults if undefined\n\t\t\tObject.entries(options).forEach(([key, value]) => {\n\t\t\t\tif (value !== undefined) {\n\t\t\t\t\t(this.#options as any)[key] = value;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tthis.#cameraObject = cameraObject;\n\t\tthis.#rendererState = rendererState;\n\t}\n\n\tprivate setSize(w: number, h: number) {\n\t\tif (!this.#material) return;\n\t\tthis.#material.uniforms.uSize.value.x = w;\n\t\tthis.#material.uniforms.uSize.value.y = h;\n\t}\n\n\tprivate setXY(x: number, y: number) {\n\t\tif (!this.#material) return;\n\t\tthis.#material.uniforms.uSize.value.w = x;\n\t\tthis.#material.uniforms.uSize.value.z = y;\n\t}\n\n\tget width() {\n\t\treturn this.#width;\n\t}\n\n\tget height() {\n\t\treturn this.#height;\n\t}\n\n\tgetPositionAlignedOffset(width: number, height: number) {\n\t\tconst offsets: Record<\n\t\t\tWatermarkPosition,\n\t\t\t{\n\t\t\t\tx: number;\n\t\t\t\ty: number;\n\t\t\t}\n\t\t> = {\n\t\t\t'top-left': { x: 0, y: 0 },\n\t\t\t'top-right': { x: -width, y: 0 },\n\t\t\t'bottom-left': { x: 0, y: -height },\n\t\t\t'bottom-right': { x: -width, y: -height },\n\t\t\tcenter: { x: -(width / 2), y: -(height / 2) },\n\t\t\ttop: { x: -(width / 2), y: 0 },\n\t\t\tbottom: { x: -(width / 2), y: -height },\n\t\t\tleft: { x: 0, y: -(height / 2) },\n\t\t\tright: { x: -width, y: -(height / 2) },\n\t\t};\n\n\t\treturn offsets[this.#options.position];\n\t}\n\n\tgetPositionAlignedCanvasCoordinates = (canvasWidth: number, canvasHeight: number) => {\n\t\tconst coords: Record<\n\t\t\tWatermarkPosition,\n\t\t\t{\n\t\t\t\tx: number;\n\t\t\t\ty: number;\n\t\t\t}\n\t\t> = {\n\t\t\t'top-left': { x: 0, y: 0 },\n\t\t\t'top-right': { x: canvasWidth, y: 0 },\n\t\t\t'bottom-left': { x: 0, y: canvasHeight },\n\t\t\t'bottom-right': { x: canvasWidth, y: canvasHeight },\n\t\t\tcenter: { x: canvasWidth / 2, y: canvasHeight / 2 },\n\t\t\ttop: { x: canvasWidth / 2, y: 0 },\n\t\t\tbottom: { x: canvasWidth / 2, y: canvasHeight },\n\t\t\tleft: { x: 0, y: canvasHeight / 2 },\n\t\t\tright: { x: canvasWidth, y: canvasHeight / 2 },\n\t\t};\n\n\t\treturn coords[this.#options.position];\n\t};\n\n\tgetPositionAlignedPadding = () => {\n\t\tconst padding = this.#options.padding;\n\t\tif (typeof padding === 'number') {\n\t\t\tconst alignedPaddings: Record<\n\t\t\t\tWatermarkPosition,\n\t\t\t\t{\n\t\t\t\t\tx: number;\n\t\t\t\t\ty: number;\n\t\t\t\t}\n\t\t\t> = {\n\t\t\t\t'top-left': { x: padding, y: padding },\n\t\t\t\t'top-right': { x: -padding, y: padding },\n\t\t\t\t'bottom-left': { x: padding, y: -padding },\n\t\t\t\t'bottom-right': { x: -padding, y: -padding },\n\t\t\t\tcenter: { x: 0, y: 0 },\n\t\t\t\ttop: { x: 0, y: padding },\n\t\t\t\tbottom: { x: 0, y: -padding },\n\t\t\t\tleft: { x: padding, y: 0 },\n\t\t\t\tright: { x: -padding, y: 0 },\n\t\t\t};\n\n\t\t\treturn alignedPaddings[this.#options.position];\n\t\t}\n\n\t\tconst paddings = {\n\t\t\ttop: padding['top'] ?? 0,\n\t\t\tright: padding['right'] ?? 0,\n\t\t\tbottom: padding['bottom'] ?? 0,\n\t\t\tleft: padding['left'] ?? 0,\n\t\t};\n\n\t\treturn { x: paddings['left'] - paddings['right'], y: paddings['top'] - paddings['bottom'] };\n\t};\n\n\tinsertIntoQuadTree(quadTree: QuadTree<{ entityId: Geometry2D['id'] }>) {\n\t\tif (this.#collider != null && typeof this.#options.onClick === 'function' && this.#options.interactive) {\n\t\t\tquadTree.insert(this.#collider);\n\t\t}\n\t}\n\n\tresize(canvasWidth: number, canvasHeight: number) {\n\t\tif (this.#options.visible !== true) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Get the canvas start position and padding based on watermark position option\n\t\tconst canvasPosition = this.getPositionAlignedCanvasCoordinates(canvasWidth, canvasHeight);\n\t\tconst padding = this.getPositionAlignedPadding();\n\t\t// Get the height/width offset based on watermark size\n\t\tconst offset = this.getPositionAlignedOffset(this.#width, this.#height);\n\n\t\t// Keep the watermark within the canvas bounds\n\t\tconst x = Math.min(canvasWidth - this.#width, Math.max(0, canvasPosition.x + padding.x + offset.x));\n\t\tconst y = Math.min(canvasHeight - this.#height, Math.max(0, canvasPosition.y + padding.y + offset.y));\n\n\t\t// Update the texture\n\t\tthis.setSize(this.#width / canvasWidth, this.#height / canvasHeight);\n\t\tthis.setXY(x / canvasWidth, y / canvasHeight);\n\n\t\tthis.#collider = new Rectangle(x, y, this.#width, this.#height, {\n\t\t\tentityId: 'watermark',\n\t\t});\n\t}\n\n\tupdate() {\n\t\tif (!this.dirty) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#options.visible === true) {\n\t\t\t/**\n\t\t\t * We want to avoid the developer hiding our watermark so we clamp the width minimum to some visible size,\n\t\t\t * and maximum to the canvas width. It may warn and shrink the watermark if the canvas is too small.\n\t\t\t */\n\t\t\tthis.#width = Math.min(\n\t\t\t\tthis.#rendererState.canvasWidth,\n\t\t\t\tMath.max(this.minWidth, this.defaultWidth * this.#options.scale),\n\t\t\t);\n\t\t\tthis.#height = this.#width / this.aspectRatio;\n\n\t\t\tTextureLoader.getLoader().load(`data:image/svg+xml;base64,${btoa(this.icon)}`, imageData => {\n\t\t\t\tthis.#material = new ShaderMaterial({\n\t\t\t\t\tuniforms: {\n\t\t\t\t\t\tuTexture: { value: imageData },\n\t\t\t\t\t\tuSize: { value: new Vector4(0, 0, 0, 0) }, // x, y, w, h\n\t\t\t\t\t\tuOpacity: { value: 0.7 },\n\t\t\t\t\t},\n\t\t\t\t\tvertexShader: WatermarkVertexShader,\n\t\t\t\t\tfragmentShader: WatermarkFragmentShader,\n\t\t\t\t\tdepthWrite: false,\n\t\t\t\t\tdepthTest: false,\n\t\t\t\t\tdefines: { debug: DEBUG },\n\t\t\t\t\twireframe: DEBUG,\n\t\t\t\t\ttransparent: true,\n\t\t\t\t\tvisible: true,\n\t\t\t\t});\n\n\t\t\t\tif (!this.#mesh) {\n\t\t\t\t\tconst planeGeometry = new PlaneGeometry(2, 2, 1, 1);\n\t\t\t\t\tthis.#mesh = new Mesh(planeGeometry, this.#material);\n\t\t\t\t\tthis.#mesh.position.set(0, 0, -1);\n\t\t\t\t\tthis.#mesh.frustumCulled = false;\n\t\t\t\t\t// We want the mesh to be rendered the last with depthWrite and depthTest disabled\n\t\t\t\t\t// It allows the watermark to be rendered on top of everything else\n\t\t\t\t\tthis.#mesh.renderOrder = 999;\n\t\t\t\t\t// HACK: Add a transparent box so that the watermark doesn't disappear when the camera\n\t\t\t\t\t// moves away from any geometry in the scene. Actual reason for this happening is unknown\n\t\t\t\t\t// but likely to do with interleaved rendering with mapLibre\n\t\t\t\t\tconst box = new BoxGeometry(1, 1, 1);\n\t\t\t\t\tconst mesh = new Mesh(\n\t\t\t\t\t\tbox,\n\t\t\t\t\t\tnew MeshBasicMaterial({ transparent: true, opacity: 0, depthTest: false, depthWrite: false }),\n\t\t\t\t\t);\n\t\t\t\t\tmesh.frustumCulled = false;\n\t\t\t\t\tmesh.layers.set(1);\n\t\t\t\t\tthis.#mesh.add(mesh);\n\t\t\t\t\tthis.#cameraObject.add(this.#mesh);\n\t\t\t\t} else {\n\t\t\t\t\tthis.#mesh.visible = true;\n\t\t\t\t\tthis.#mesh.material = this.#material;\n\t\t\t\t\tthis.#mesh.material.needsUpdate = true;\n\t\t\t\t}\n\t\t\t\tthis.resize(this.#rendererState.canvasWidth, this.#rendererState.canvasHeight);\n\t\t\t\tthis.publish('texture-loaded');\n\t\t\t});\n\t\t} else {\n\t\t\tif (this.#mesh) {\n\t\t\t\tthis.#mesh.visible = false;\n\t\t\t}\n\t\t}\n\n\t\tthis.dirty = false;\n\t}\n\n\tdestroy() {\n\t\tif (this.#mesh) {\n\t\t\tthis.#cameraObject.remove(this.#mesh);\n\t\t\tdestroyObject3D(this.#mesh);\n\t\t}\n\t\tthis.#mesh = undefined;\n\t\tif (this.#material) {\n\t\t\tthis.#material.dispose();\n\t\t}\n\t\tthis.#material = undefined;\n\t\tthis.#collider = undefined;\n\t}\n}\n", "export default `uniform vec4 uSize;\nvarying vec2 vUv;\nvoid main() {\n  vUv = uv;\n  // Scale the position by the size of the quad\n  // and shift to top left corner for 0,0\n\tvec2 transformed = position.xy * uSize.xy - vec2(1.0, -1.0);\n  // Apply width .x and height .y of image\n  transformed += vec2(uSize.x, -uSize.y);\n  // Apply left .w and top .z offset\n  transformed += vec2(uSize.w, -uSize.z) * 2.0;\n  gl_Position = vec4(transformed, 1.0, 1.0);\n}`", "export default `varying vec2 vUv;\nuniform sampler2D uTexture;\nuniform float uOpacity;\nvoid main() {\n  #ifndef debug\n  vec4 texture = texture2D(uTexture, vUv);\n  gl_FragColor = vec4(texture.rgb, texture.a * uOpacity);\n  #else\n  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n  #endif\n}`", "export const WATERMARK_LOGO_MIN_WIDTH = 75;\nexport const WATERMARK_LOGO_DEFAULT_WIDTH = 150;\nexport const WATERMARK_LOGO_ASPECT_RATIO = 206 / 48;\n\nexport const WATERMARK_ICON_MIN_WIDTH = 15;\nexport const WATERMARK_ICON_DEFAULT_WIDTH = 25;\nexport const WATERMARK_ICON_ASPECT_RATIO = 43 / 60;\n", "const ICON_NAMES = ['horizontal', 'icon'] as const;\n\nconst ICONS = new Map([\n\t[\n\t\tICON_NAMES[0],\n\t\t`<svg viewBox=\"0 0 206 48\">\n      <path d=\"M27.2678 14.2261H22.3187C21.0695 14.2261 20.4695 14.7801 20.4695 15.9852V31.142L10.3966 15.5591C9.69665 14.4784 9.2475 14.2773 7.8475 14.2261H2.97462C1.67462 14.2261 1.07631 14.7801 1.07631 15.9852V44.7665C1.07631 45.9716 1.67462 46.5256 2.97462 46.5256H7.92377C9.22207 46.5256 9.82207 45.9716 9.82207 44.7665V29.6847L19.9441 45.1926C20.695 46.3244 21.095 46.5256 22.4933 46.5256H27.2933C28.5916 46.5256 29.1916 45.9716 29.1916 44.7665V15.9852C29.1407 14.7801 28.5424 14.2261 27.2678 14.2261Z\"/>\n      <path d=\"M5.44915 10.9602C8.45863 10.9602 10.8983 8.50669 10.8983 5.48011C10.8983 2.45353 8.45863 0 5.44915 0C2.43967 0 0 2.45353 0 5.48011C0 8.50669 2.43967 10.9602 5.44915 10.9602Z\"/>\n      <path d=\"M61.7899 25.0449C63.2306 23.1903 65.078 22.2051 67.556 22.2051C72.0526 22.2051 74.7611 25.3347 74.7611 29.4511V39.2489C74.8187 39.7125 74.5306 39.9443 74.0695 39.9443H72.5136C72.0526 39.9443 71.7645 39.7125 71.8221 39.2489V29.5091C71.8221 27.1909 69.9187 25.2187 67.4984 25.2187C65.1339 25.2187 63.2323 27.1329 63.2323 29.2773V39.2489C63.2899 39.7125 63.0018 39.9443 62.5407 39.9443H60.9831C60.5221 39.9443 60.2916 39.7125 60.2916 39.2489V29.4511C60.2916 27.1329 58.3899 25.2187 56.0255 25.2187C53.7204 25.2187 51.7594 27.075 51.7594 29.2773V39.3068C51.817 39.7705 51.5289 40.0023 51.0102 40.0023H49.5119C49.0509 40.0023 48.7628 39.7705 48.7628 39.3068V23.25C48.7051 22.7864 48.9933 22.4966 49.5119 22.4966H50.9526C51.356 22.4966 51.5289 22.6704 51.5289 23.0182V24.2352C52.7407 22.9602 54.239 22.2648 56.0255 22.2648C58.4475 22.2068 60.3492 23.192 61.7899 25.0466V25.0449ZM77.1255 31.2477C77.1255 26.3216 81.1018 22.2051 86.1187 22.2051C88.539 22.2051 90.6136 23.1903 92.3441 25.1608V23.1903C92.3441 22.7267 92.5746 22.5528 93.0357 22.5528H94.4187C94.8797 22.5528 95.1102 22.7847 95.1102 23.3062V39.3648C95.1102 39.8284 94.8797 40.0602 94.4187 40.0602H93.0357C92.5746 40.0602 92.3441 39.8284 92.3441 39.4227V37.4523C90.6712 39.3648 88.5967 40.35 86.1746 40.35C81.1018 40.2341 77.1238 36.1773 77.1238 31.2477H77.1255ZM92.1136 31.2477C92.1136 27.8284 89.4611 25.2187 86.0594 25.2187C82.7746 25.2187 80.1221 27.8864 80.1221 31.2477C80.1221 34.6687 82.7746 37.2784 86.1187 37.2784C86.9062 37.2789 87.6861 37.1232 88.4138 36.8202C89.1414 36.5173 89.8026 36.0731 90.3593 35.513C90.9161 34.9528 91.3577 34.2878 91.6587 33.556C91.9597 32.8241 92.1143 32.0397 92.1136 31.2477ZM100.992 37.3943V46.3807C101.049 46.8443 100.761 47.1341 100.298 47.1341H98.7424C98.2814 47.1341 97.9933 46.9023 97.9933 46.3807V23.1903C97.9933 22.7267 98.2238 22.4369 98.7424 22.4369H100.183C100.646 22.379 100.934 22.6687 100.934 23.0744V24.9869C102.605 23.0744 104.68 22.1472 107.044 22.1472C112.002 22.1472 116.037 26.2619 116.037 31.1898C116.037 36.1176 112.059 40.2341 107.044 40.2341C104.622 40.2341 102.603 39.3068 100.992 37.3943ZM106.987 25.2187C103.7 25.2187 101.049 27.8864 101.049 31.2477C101.049 34.6687 103.7 37.2784 107.044 37.2784C110.446 37.2784 113.039 34.6108 113.039 31.2477C113.039 27.8864 110.388 25.2187 106.987 25.2187ZM121.11 37.3943V46.3807C121.168 46.8443 120.88 47.1341 120.419 47.1341H118.861C118.4 47.1341 118.112 46.9023 118.112 46.3807V23.1903C118.112 22.7267 118.342 22.4369 118.861 22.4369H120.302C120.764 22.379 121.053 22.6687 121.053 23.0744V24.9869C122.724 23.0744 124.798 22.1472 127.163 22.1472C132.12 22.1472 136.156 26.2619 136.156 31.1898C136.156 36.1176 132.178 40.2341 127.163 40.2341C124.742 40.2341 122.781 39.3068 121.11 37.3943ZM127.105 25.2187C123.819 25.2187 121.168 27.8864 121.168 31.2477C121.168 34.6687 123.819 37.2784 127.163 37.2784C130.564 37.2784 133.158 34.6108 133.158 31.2477C133.158 27.8864 130.507 25.2187 127.107 25.2187H127.105ZM153.97 32.3506H141.054C141.342 35.2483 143.995 37.4523 147.164 37.4523C148.893 37.4523 150.393 37.0466 151.719 36.0597C152.007 35.8858 152.295 35.7699 152.353 35.7699C152.583 35.7699 152.756 35.8858 152.929 36.1773L153.505 37.1625C153.622 37.3364 153.68 37.4523 153.68 37.5682C153.68 37.8 153.507 38.0318 153.103 38.3216C151.258 39.5966 149.183 40.292 146.992 40.292C141.688 40.292 137.883 36.3511 137.883 31.2477C137.883 26.204 141.803 22.2051 146.703 22.2051C151.546 22.2051 154.717 25.7983 154.717 31.0176C154.717 31.5972 154.717 32.3506 153.968 32.3506H153.97ZM141.056 30.0324H151.72C151.432 26.8432 149.473 24.929 146.648 24.929C145.241 24.8904 143.875 25.3995 142.833 26.3501C141.791 27.3007 141.154 28.6194 141.056 30.0307V30.0324ZM156.332 31.2477C156.332 26.3216 160.31 22.2051 165.326 22.2051C167.748 22.2051 169.707 23.1324 171.32 25.0449V16.2324C171.263 15.7687 171.551 15.479 172.012 15.479H173.57C174.031 15.479 174.319 15.7108 174.319 16.2324V39.3068C174.319 39.7705 174.088 40.0023 173.57 40.0023H172.129C171.666 40.0602 171.378 39.7705 171.378 39.3648V37.3943C169.649 39.3068 167.632 40.292 165.268 40.292C160.31 40.2341 156.332 36.1773 156.332 31.2477ZM171.264 31.2477C171.264 27.8284 168.612 25.2187 165.21 25.2187C161.924 25.2187 159.273 27.8864 159.273 31.2477C159.273 34.6687 161.924 37.2784 165.268 37.2784C166.057 37.2838 166.839 37.1316 167.569 36.8304C168.299 36.5292 168.962 36.0852 169.52 35.5241C170.077 34.963 170.519 34.296 170.818 33.5619C171.117 32.8277 171.268 32.0411 171.263 31.2477H171.264ZM177.72 19.0739C177.715 18.8594 177.754 18.646 177.833 18.4468C177.912 18.2476 178.031 18.0667 178.182 17.915C178.333 17.7633 178.512 17.6439 178.71 17.5642C178.909 17.4845 179.121 17.446 179.334 17.4511C179.546 17.4507 179.756 17.4923 179.952 17.5737C180.148 17.6551 180.326 17.7746 180.476 17.9254C180.626 18.0762 180.745 18.2553 180.826 18.4523C180.907 18.6494 180.948 18.8606 180.948 19.0739C180.953 19.2884 180.914 19.5017 180.835 19.7009C180.756 19.9001 180.637 20.081 180.486 20.2327C180.335 20.3845 180.156 20.5038 179.957 20.5835C179.759 20.6633 179.547 20.7017 179.334 20.6966C178.412 20.7545 177.72 20.0591 177.72 19.0739ZM177.836 39.2489V23.1903C177.836 22.7267 178.066 22.4369 178.527 22.4369H180.083C180.544 22.4369 180.832 22.6687 180.775 23.1903V39.2489C180.832 39.7125 180.544 39.9443 180.083 39.9443H178.527C178.066 39.9443 177.836 39.7125 177.836 39.2489ZM186.944 23.0165V24.1756C188.212 22.8426 189.71 22.2051 191.497 22.2051C195.937 22.2051 198.646 25.2767 198.646 29.3932V39.2489C198.703 39.7125 198.415 39.9443 197.954 39.9443H196.398C195.936 39.9443 195.705 39.7125 195.705 39.2489V29.4511C195.705 27.1329 193.803 25.2187 191.439 25.2187C189.134 25.2187 187.175 27.075 187.175 29.2773V39.3068C187.232 39.7705 186.944 40.0023 186.424 40.0023H184.868C184.407 40.0023 184.119 39.7705 184.119 39.3068V23.1903C184.061 22.7267 184.349 22.4949 184.868 22.4949H186.309C186.712 22.4949 186.944 22.6687 186.944 23.0165Z\"/>\n      <path d=\"M204 40C205.115 40 206 39.0857 206 38V37.9886C206 36.9029 205.126 36 204 36C202.885 36 202 36.9143 202 38V38.0114C202 39.0971 202.874 40 204 40ZM204 39.7829C202.989 39.7829 202.23 38.9829 202.23 38.0114V38C202.23 37.0286 203 36.2171 204 36.2171C205.011 36.2171 205.77 37.0171 205.77 37.9886V38C205.77 38.9714 205 39.7829 204 39.7829ZM203.218 38.9714H203.609V38.2743H204.034L204.517 38.9714H204.989L204.448 38.2057C204.724 38.1257 204.92 37.92 204.92 37.5886C204.92 37.1657 204.586 36.9486 204.138 36.9486H203.218V38.9714ZM203.609 37.9543V37.2914H204.103C204.368 37.2914 204.517 37.4057 204.517 37.6229C204.517 37.8171 204.368 37.9543 204.103 37.9543H203.609Z\"/>\n    </svg>`,\n\t],\n\t[\n\t\tICON_NAMES[1],\n\t\t`<svg viewBox=\"0 0 43 60\">\n      <path d=\"M14.0291 7.06645C14.0291 10.9691 10.8885 14.1329 7.01453 14.1329C3.14051 14.1329 0 10.9691 0 7.06645C0 3.16376 3.14051 0 7.01453 0C10.8885 0 14.0291 3.16376 14.0291 7.06645Z\"/>\n      <path d=\"M28.7335 18.3468H35.1045C36.7455 18.3468 37.5178 19.0599 37.5821 20.6158V57.7309C37.5821 59.2868 36.8099 60 35.1367 60H28.9588C27.1569 60 26.642 59.7406 25.6767 58.282L12.6452 38.282V57.7309C12.6452 59.2868 11.8729 60 10.1997 60H3.82873C2.15554 60 1.3833 59.2868 1.3833 57.7309V20.6158C1.3833 19.0599 2.15554 18.3468 3.82873 18.3468H10.1032C11.9051 18.4116 12.4843 18.671 13.3852 20.0648L26.3524 40.162V20.6158C26.3524 19.0599 27.1247 18.3468 28.7335 18.3468Z\"/>\n      <path d=\"M41.5 60C42.3362 60 43 59.3143 43 58.5V58.4914C43 57.6771 42.3448 57 41.5 57C40.6638 57 40 57.6857 40 58.5V58.5086C40 59.3229 40.6552 60 41.5 60ZM41.5 59.8371C40.7414 59.8371 40.1724 59.2371 40.1724 58.5086V58.5C40.1724 57.7714 40.75 57.1629 41.5 57.1629C42.2586 57.1629 42.8276 57.7629 42.8276 58.4914V58.5C42.8276 59.2286 42.25 59.8371 41.5 59.8371ZM40.9138 59.2286H41.2069V58.7057H41.5259L41.8879 59.2286H42.2414L41.8362 58.6543C42.0431 58.5943 42.1897 58.44 42.1897 58.1914C42.1897 57.8743 41.9397 57.7114 41.6034 57.7114H40.9138V59.2286ZM41.2069 58.4657V57.9686H41.5776C41.7759 57.9686 41.8879 58.0543 41.8879 58.2171C41.8879 58.3629 41.7759 58.4657 41.5776 58.4657H41.2069Z\"/>\n    </svg>`,\n\t],\n]);\n\nconst regex = /<svg([^>]*)>/g;\nexport function getLogoIcon(\n\ticonName: (typeof ICON_NAMES)[number],\n\tcolor: string,\n\twidth: number,\n\theight: number,\n): string {\n\tconst icon = ICONS.get(iconName);\n\tif (!icon) {\n\t\treturn '';\n\t}\n\n\treturn icon.replace(\n\t\tregex,\n\t\t`<svg$1 width=\"${width}\" height=\"${height}\" xmlns=\"http://www.w3.org/2000/svg\" style=\"fill: ${color};\">`,\n\t);\n}\n\nexport default ICONS;\n", "import type { Texture } from 'three';\nimport { TextureLoader as TextureLoaderThree } from 'three';\n\nclass TextureLoaderSingleton {\n\tprivate static instance: TextureLoaderSingleton;\n\tpublic loader: TextureLoaderThree;\n\n\tprivate constructor() {\n\t\tthis.loader = new TextureLoaderThree();\n\t}\n\n\tpublic static getInstance(): TextureLoaderSingleton {\n\t\tif (!TextureLoaderSingleton.instance) {\n\t\t\tTextureLoaderSingleton.instance = new TextureLoaderSingleton();\n\t\t}\n\n\t\treturn TextureLoaderSingleton.instance;\n\t}\n\n\tpublic getLoader(): TextureLoaderThree {\n\t\treturn this.loader;\n\t}\n\n\tpublic load(url: string) {\n\t\treturn new Promise<Texture>((resolve, reject) => {\n\t\t\tthis.loader.load(url, resolve, undefined, reject);\n\t\t});\n\t}\n}\n\nconst TextureLoader = TextureLoaderSingleton.getInstance();\n\nexport { TextureLoader };\n", "import { Box3, BoxGeometry, Mesh, MeshBasicMaterial, Object3D, Scene, Sphere, SphereGeometry, Vector3 } from 'three';\nimport type { CameraSystem } from '../camera';\nimport type { RendererState } from '../../renderer';\nimport { PubSub } from '@packages/internal/common';\n\n// 100 meters margin around any geometry in the scene\nconst PAN_BOUNDS_MARGIN = 100;\nconst DEBUG = false;\n\nexport class PanBoundsSystem extends PubSub<{\n\tupdate: void;\n}> {\n\tprivate currentTotalBoundingBox?: Box3;\n\tprivate state: RendererState;\n\tprivate cameraSystem: CameraSystem;\n\tprivate debugMesh: Object3D | null = null;\n\tdirty = true;\n\tautoMinZoomLevel = true;\n\n\tconstructor(state: RendererState, cameraSystem: CameraSystem) {\n\t\tsuper();\n\t\tthis.state = state;\n\t\tthis.cameraSystem = cameraSystem;\n\t}\n\n\t/**\n\t * Recomputes the pan bounds based on the current 2D and 3D entities in the scene\n\t * This is only additive, meaning removing entities will not shrink the pan bounds\n\t */\n\tupdate() {\n\t\tif (this.dirty) {\n\t\t\tif (this.currentTotalBoundingBox == null) {\n\t\t\t\tthis.currentTotalBoundingBox = new Box3();\n\t\t\t\tif (this.state.entityScene.children.length === 0) {\n\t\t\t\t\t// expand from center point outwards when scene is empty\n\t\t\t\t\tthis.currentTotalBoundingBox.setFromCenterAndSize(\n\t\t\t\t\t\tnew Vector3(0, 0, 0),\n\t\t\t\t\t\tnew Vector3(PAN_BOUNDS_MARGIN * 2, PAN_BOUNDS_MARGIN * 2, 0),\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\t// otherwise use rendered geometry\n\t\t\t\t\tthis.currentTotalBoundingBox.setFromObject(this.state.entityScene);\n\t\t\t\t\tthis.currentTotalBoundingBox.expandByScalar(PAN_BOUNDS_MARGIN);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// @TODO: speed this up by keeping track of the bounding box as objects are added to the scene\n\t\t\tconst box = new Box3().setFromObject(this.state.entityScene);\n\t\t\tthis.currentTotalBoundingBox.union(box);\n\t\t\tconst boxSize = box.getSize(new Vector3());\n\t\t\tconst maxDimention = Math.max(boxSize.x, boxSize.y, boxSize.z);\n\n\t\t\t// make sure we take 2D entities into account when computing the pan bounds\n\t\t\tfor (let entity of this.state.geometry2DMap.values()) {\n\t\t\t\tif (entity.positionDirty === true) {\n\t\t\t\t\tthis.currentTotalBoundingBox.expandByPoint(entity.position);\n\t\t\t\t\tentity.positionDirty = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * We want expand bounds relative to the size of the map instead of hardcoded 100 meters.\n\t\t\t * Otherwise, user can't zoom out in larger maps.\n\t\t\t */\n\t\t\tconst radius = expandedByPaddingBox\n\t\t\t\t.copy(this.currentTotalBoundingBox)\n\t\t\t\t.expandByScalar(Math.max(maxDimention, PAN_BOUNDS_MARGIN))\n\t\t\t\t.getBoundingSphere(expandedByPaddingSphere).radius;\n\n\t\t\tthis.cameraSystem.panBounds = {\n\t\t\t\tcenter: this.currentTotalBoundingBox.getCenter(new Vector3()),\n\t\t\t\tmin: expandedByPaddingBox.min,\n\t\t\t\tmax: expandedByPaddingBox.max,\n\t\t\t\tradius,\n\t\t\t};\n\t\t\tthis.publish('update');\n\n\t\t\tthis.cameraSystem.dirty = true;\n\t\t\tthis.dirty = false;\n\n\t\t\tif (DEBUG && this.state.entityScene.parent instanceof Scene) {\n\t\t\t\tif (this.debugMesh) {\n\t\t\t\t\tthis.state.entityScene.parent.remove(this.debugMesh);\n\t\t\t\t\tthis.debugMesh = null;\n\t\t\t\t}\n\n\t\t\t\tthis.debugMesh = new Object3D();\n\n\t\t\t\tthis.debugMesh.add(\n\t\t\t\t\tnew Mesh(\n\t\t\t\t\t\tnew SphereGeometry(this.cameraSystem.panBounds.radius),\n\t\t\t\t\t\tnew MeshBasicMaterial({ color: 0xff0000, transparent: true, opacity: 0.2 }),\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t\tthis.debugMesh.position.copy(this.cameraSystem.panBounds.center);\n\t\t\t\tthis.state.entityScene.parent.add(this.debugMesh);\n\n\t\t\t\t// Create a visualization of the bounding box\n\t\t\t\tconst size = new Vector3();\n\t\t\t\texpandedByPaddingBox.getSize(size);\n\t\t\t\tconst boxGeometry = new BoxGeometry(size.x, size.y, size.z);\n\t\t\t\tconst boxMaterial = new MeshBasicMaterial({\n\t\t\t\t\tcolor: 0x00ff00,\n\t\t\t\t\twireframe: true,\n\t\t\t\t\ttransparent: true,\n\t\t\t\t\topacity: 0.5,\n\t\t\t\t});\n\t\t\t\tconst box = new Mesh(boxGeometry, boxMaterial);\n\t\t\t\tbox.position.copy(this.currentTotalBoundingBox.getCenter(new Vector3()));\n\t\t\t\tthis.debugMesh.add(box);\n\t\t\t}\n\t\t}\n\t}\n}\n\nconst expandedByPaddingBox = new Box3();\nconst expandedByPaddingSphere = new Sphere();\n", "import type { Map } from '../../../../packages/outdoor-context-v5';\nimport '../../styles/html-controls.scss';\n\nconst MAPPEDIN_ATTRIBUTION = '\u00A9 Mappedin';\nconst FEEDBACK_LINK = 'https://info.mappedin.com/feedback';\n\n/**\n * All possible control anchor positions.\n */\nexport const ATTRIBUTION_POSITIONS = ['top-left', 'top-right', 'bottom-left', 'bottom-right'] as const;\n/**\n * The threshold at which the attribution control will switch between compact and full mode.\n */\nconst MAX_COMPACT_CANVAS_WIDTH = 640;\n\nconst getAttributionButtonIcon =\n\t() => `<svg xmlns='http://www.w3.org/2000/svg' width='15' height='15' fill-rule='evenodd' viewBox='0 0 20 20'>\n\t\t\t\t\t\t<circle cx='10' cy='10' r='5.9' style='fill:rgba(255,255,255,1);'/>\n\t\t\t\t\t\t<path style='fill:rgba(0,0,0,0.7);' d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/>\n\t\t\t\t\t</svg>`;\n\nexport type AttributionPosition = (typeof ATTRIBUTION_POSITIONS)[number];\n\nexport type AttributionControlOptions = {\n\tcustom?: string[];\n\tposition?: AttributionPosition;\n\tfeedback?: boolean;\n};\n\nconst DEFAULT_ATTRIB_OPTIONS = {\n\tcustom: [],\n\tposition: 'bottom-right',\n\tfeedback: true,\n} satisfies AttributionControlOptions;\n\nexport type HTMLControlsSystemOptions = {\n\toutdoorEnabled?: boolean;\n};\n\nexport class HTMLControlsSystem {\n\tcontrolContainerEl: HTMLDivElement;\n\tcontrolPositions: Record<AttributionPosition, HTMLDivElement>;\n\tcompact: boolean | undefined = undefined;\n\t#outdoorEnabled: boolean;\n\n\tattribContainerEl?: HTMLDetailsElement;\n\tattribInnerEl?: HTMLDivElement;\n\tattribButtonEl?: HTMLElement;\n\tfeedbackLinkEl?: HTMLAnchorElement;\n\tattribHTML = MAPPEDIN_ATTRIBUTION;\n\tcustomAttributions: string[] = [];\n\n\tconstructor(container: HTMLElement, options: HTMLControlsSystemOptions = {}) {\n\t\tthis.#outdoorEnabled = !!options.outdoorEnabled;\n\t\tthis.controlContainerEl = document.createElement('div');\n\t\tthis.controlContainerEl.classList.add('mappedin-control-container');\n\t\tcontainer.appendChild(this.controlContainerEl);\n\t\tthis.controlPositions = ATTRIBUTION_POSITIONS.reduce((a, v) => {\n\t\t\tconst el = document.createElement('div');\n\t\t\tel.classList.add(`mappedin-ctrl-${v}`);\n\t\t\tthis.controlContainerEl.appendChild(el);\n\t\t\ta[v] = el;\n\n\t\t\treturn a;\n\t\t}, {} as Record<AttributionPosition, HTMLDivElement>);\n\t}\n\n\taddAttributionControl(options: AttributionControlOptions = DEFAULT_ATTRIB_OPTIONS) {\n\t\tconst position =\n\t\t\toptions.position && ATTRIBUTION_POSITIONS.includes(options.position)\n\t\t\t\t? options.position\n\t\t\t\t: DEFAULT_ATTRIB_OPTIONS.position;\n\t\tthis.attribContainerEl = document.createElement('details');\n\t\tthis.attribContainerEl.classList.add('mappedin-ctrl-attrib', `mappedin-ctrl-attrib-${position}`);\n\t\tthis.attribContainerEl.open = true;\n\t\tthis.attribContainerEl.ariaLabel = 'Attribution';\n\t\tthis.controlPositions[position].appendChild(this.attribContainerEl);\n\n\t\tthis.attribButtonEl = document.createElement('summary');\n\t\tthis.attribButtonEl.addEventListener('click', this.toggleAttribution);\n\t\tthis.attribButtonEl.classList.add('mappedin-ctrl-attrib-button');\n\t\tthis.attribButtonEl.title = 'Toggle attribution';\n\t\tthis.attribButtonEl.ariaLabel = 'Toggle attribution';\n\t\tthis.attribButtonEl.tabIndex = 0; // Tab index here so you can open and close the attribution control with the keyboard\n\t\tthis.attribButtonEl.innerHTML = getAttributionButtonIcon();\n\t\tthis.attribContainerEl.appendChild(this.attribButtonEl);\n\n\t\tthis.attribInnerEl = document.createElement('div');\n\t\tthis.attribInnerEl.classList.add('mappedin-ctrl-attrib-inner');\n\t\t// Set initial attribution based on outdoor state\n\t\tthis.attribHTML = this.#outdoorEnabled ? MAPPEDIN_ATTRIBUTION : '';\n\t\tthis.attribInnerEl.innerHTML = this.attribHTML;\n\t\tthis.attribContainerEl.appendChild(this.attribInnerEl);\n\n\t\tconst feedback = options.feedback ?? DEFAULT_ATTRIB_OPTIONS.feedback;\n\t\tif (feedback) {\n\t\t\tthis.feedbackLinkEl = document.createElement('a');\n\t\t\tthis.feedbackLinkEl.href = FEEDBACK_LINK;\n\t\t\tthis.feedbackLinkEl.target = '_blank';\n\t\t\tthis.feedbackLinkEl.rel = 'noopener';\n\t\t\tthis.feedbackLinkEl.textContent = 'Provide Feedback';\n\t\t\tthis.feedbackLinkEl.classList.add('mappedin-ctrl-attrib-inner');\n\t\t\tthis.feedbackLinkEl.classList.add('mappedin-ctrl-attrib-inner-bold');\n\t\t\tthis.attribContainerEl.appendChild(this.feedbackLinkEl);\n\t\t}\n\n\t\tif (options.custom) {\n\t\t\tthis.customAttributions = options.custom;\n\t\t}\n\t\tthis.updateAttributionDisplay();\n\t}\n\n\ttoggleAttribution = (e: MouseEvent) => {\n\t\tif (this.attribContainerEl == null) return;\n\t\te.preventDefault();\n\t\tif (this.attribContainerEl.classList.contains('mappedin-compact')) {\n\t\t\tif (this.attribContainerEl.classList.contains('mappedin-compact-show')) {\n\t\t\t\tthis.attribContainerEl.removeAttribute('open');\n\t\t\t\tthis.attribContainerEl.classList.remove('mappedin-compact-show');\n\t\t\t} else {\n\t\t\t\tthis.attribContainerEl.classList.add('mappedin-compact-show');\n\t\t\t\tthis.attribContainerEl.setAttribute('open', '');\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Updates the attribution based on sources in the map style.\n\t */\n\tprivate updateAttribution(map: Map) {\n\t\tif (!map.style) {\n\t\t\t// map style has not loaded yet\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.attribInnerEl || !this.attribContainerEl) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet attributions: string[] = this.#outdoorEnabled ? [MAPPEDIN_ATTRIBUTION] : [];\n\n\t\tconst sourceCaches = map.style.sourceCaches;\n\t\tfor (const id in sourceCaches) {\n\t\t\tconst sourceCache = sourceCaches[id];\n\n\t\t\tif (sourceCache.used || sourceCache.usedForTerrain) {\n\t\t\t\tconst source = sourceCache.getSource();\n\t\t\t\tif (source.attribution && attributions.indexOf(source.attribution) < 0) {\n\t\t\t\t\tattributions.push(source.attribution);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// remove any entries that are whitespace\n\t\tattributions = attributions.filter(e => String(e).trim());\n\n\t\t// remove any entries that are substrings of another entry.\n\t\tattributions = attributions.filter((attrib, i) => {\n\t\t\tfor (let j = i + 1; j < attributions.length; j++) {\n\t\t\t\tif (attributions[j].indexOf(attrib) >= 0) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\n\t\t// Store updated attributions for merging\n\t\tthis.attribHTML = attributions.join(' ');\n\n\t\t// Update attribution display with map and custom attributions\n\t\tthis.updateAttributionDisplay();\n\t}\n\n\t/**\n\t * Combines custom and map attributions and updates the display.\n\t */\n\tprivate updateAttributionDisplay() {\n\t\tconst combinedAttributions = [...new Set([this.attribHTML, ...this.customAttributions])].filter(Boolean).join(' ');\n\t\tif (this.attribInnerEl) {\n\t\t\tthis.attribInnerEl.innerHTML = combinedAttributions;\n\t\t}\n\t}\n\n\tprivate resizeAttribution(canvasWidth: number) {\n\t\tif (!this.attribContainerEl) {\n\t\t\treturn;\n\t\t}\n\t\t// if canvas is small the compact button will appear\n\t\tif (canvasWidth <= MAX_COMPACT_CANVAS_WIDTH || this.compact) {\n\t\t\tif (this.compact === false) {\n\t\t\t\tthis.attribContainerEl.setAttribute('open', '');\n\t\t\t} else if (\n\t\t\t\t!this.attribContainerEl.classList.contains('mappedin-compact') &&\n\t\t\t\t!this.attribContainerEl.classList.contains('mappedin-attrib-empty')\n\t\t\t) {\n\t\t\t\tthis.attribContainerEl.setAttribute('open', '');\n\t\t\t\tthis.attribContainerEl.classList.add('mappedin-compact', 'mappedin-compact-show');\n\t\t\t}\n\t\t} else {\n\t\t\tthis.attribContainerEl.setAttribute('open', '');\n\t\t\tif (this.attribContainerEl.classList.contains('mappedin-compact')) {\n\t\t\t\tthis.attribContainerEl.classList.remove('mappedin-compact', 'mappedin-compact-show');\n\t\t\t}\n\t\t}\n\t}\n\n\tdestroyAttributionControl() {\n\t\tif (this.attribButtonEl) {\n\t\t\tthis.attribButtonEl.removeEventListener('click', this.toggleAttribution);\n\t\t}\n\n\t\tif (this.attribContainerEl) {\n\t\t\tthis.attribContainerEl.remove();\n\t\t\tthis.attribContainerEl = undefined;\n\t\t\tthis.attribInnerEl = undefined;\n\t\t\tthis.attribButtonEl = undefined;\n\t\t}\n\t}\n\n\tresize(canvasWidth: number) {\n\t\tthis.resizeAttribution(canvasWidth);\n\t}\n\n\t/**\n\t * This should fire when Maplibre data changes.\n\t */\n\tupdateData(map: Map) {\n\t\tthis.updateAttribution(map);\n\t}\n\n\tdestroy() {\n\t\tthis.destroyAttributionControl();\n\t\tthis.controlContainerEl.remove();\n\t\tthis.compact = undefined;\n\t}\n}\n", "import { Color, type Object3D, type LineSegments } from 'three';\nimport type { EntityId, Position } from '../types';\nimport type { Feature, Point } from 'geojson';\nimport { Geometry3DObject3D } from '../entities/geometry3d';\nimport type { GroupContainerState } from '../entities/group-container';\n\n/**\n * Represents the state of a custom shape.\n */\nexport type ShapeState = {\n\t/**\n\t * The unique identifier of the shape.\n\t */\n\treadonly id: string;\n\n\t/**\n\t * The type of the shape, which is always 'custom-geometry'.\n\t */\n\treadonly type: 'custom-geometry';\n\n\t/**\n\t * The position of the geometry in [longitude, latitude].\n\t */\n\treadonly position: Position;\n\n\t/**\n\t * Whether the geometry is visible.\n\t */\n\tvisible?: boolean;\n\n\t/**\n\t * The altitude of the geometry, in meters.\n\t */\n\taltitude?: number;\n\n\t/**\n\t * The color of the shape.\n\t */\n\tcolor: string;\n\n\t/**\n\t * The opacity of the shape.\n\t */\n\topacity: number;\n\n\t/**\n\t * The parent container of the geometry.\n\t */\n\treadonly parent: EntityId<GroupContainerState> | string | number;\n\n\t/**\n\t * Whether the geometry is interactive.\n\t */\n\tinteractive?: boolean;\n};\n\nexport type CustomGeometryBuilder = {\n\t/**\n\t * A setup function that is called once when the geometry is created\n\t */\n\tsetup: (object: Object3D) => void;\n\t/**\n\t *  An update function that is called every render frame.\n\t *\n\t *  Note: do not create new objects in this function, and only update the object's children\n\t *  Note 2: calling `render` or `setState` in this method will result in a render loop, so avoid if possible\n\t */\n\tupdate: (object: Object3D) => void;\n};\n\nexport class CustomGeometryComponent {\n\t// Pointer to mesh for this component, which is either the mesh itself or a merged geometry mesh\n\t// if this component was optimized\n\tmesh: Geometry3DObject3D;\n\treadonly type = 'custom-geometry';\n\tdirty = true;\n\n\tfeature: Feature<Point>;\n\tbuilder: CustomGeometryBuilder;\n\toutline?: LineSegments;\n\n\tconstructor(feature: Feature<Point>, builder: CustomGeometryBuilder) {\n\t\tthis.mesh = new Geometry3DObject3D();\n\t\tthis.feature = feature;\n\t\tthis.builder = builder;\n\t}\n\n\tget visible() {\n\t\treturn this.mesh.visible;\n\t}\n\n\tset visible(value) {\n\t\tthis.mesh.visible = value;\n\t}\n\n\t#opacity = 1;\n\tset opacity(value: number) {\n\t\t// TODO: implement\n\t\tthis.#opacity = value;\n\t}\n\tget opacity() {\n\t\treturn this.#opacity;\n\t}\n\n\tcolor: Color = new Color();\n\tsetColor(color: string) {\n\t\t// TODO: implement\n\t\tthis.color.set(color);\n\t}\n\n\tget position() {\n\t\treturn this.mesh?.position;\n\t}\n\n\t#altitude = 0;\n\tget altitude() {\n\t\treturn this.#altitude;\n\t}\n\tset altitude(value) {\n\t\tif (!this.mesh) {\n\t\t\treturn;\n\t\t}\n\t\tthis.mesh.position.z = value;\n\t\tthis.#altitude = value;\n\t}\n\n\tget renderOrder() {\n\t\treturn this.mesh ? this.mesh.renderOrder : 0;\n\t}\n\n\tset renderOrder(value: number) {\n\t\tif (this.mesh) {\n\t\t\tthis.mesh.renderOrder = value;\n\t\t}\n\t}\n}\n", "import type { RendererCore } from '../..';\nimport type { CustomGeometryComponent } from '../../components/custom';\nimport type { StyleComponent } from '../../components/styles/style';\nimport { Geometry3DComponents } from '../../entities';\nimport type { RendererState } from '../../renderer';\n\n/**\n * System that renders and updates custom geometry entities. For every custom geometry entity, this calls the builder's\n * setup method once (when it is visible) and then the update method every frame.\n */\nexport class CustomGeometrySystem {\n\tprivate state: RendererState;\n\tprivate convertTo3DMapPosition: RendererCore['convertTo3DMapPosition'];\n\n\tconstructor(state: RendererState, convertTo3DMapPosition: RendererCore['convertTo3DMapPosition']) {\n\t\tthis.state = state;\n\t\tthis.convertTo3DMapPosition = convertTo3DMapPosition;\n\t}\n\n\tupdate() {\n\t\tlet component: CustomGeometryComponent;\n\t\tlet style: StyleComponent;\n\t\tfor (const entityId of this.state.geometry3DIdsInScene) {\n\t\t\tconst entity = this.state.geometry3DMap.get(entityId);\n\t\t\tif (entity?.type === 'custom-geometry') {\n\t\t\t\tcomponent = entity.components[Geometry3DComponents.Mesh] as CustomGeometryComponent;\n\t\t\t\tstyle = entity.components[Geometry3DComponents.Style] as StyleComponent;\n\t\t\t\t// first, build\n\t\t\t\tif (component.dirty && style.visible !== false) {\n\t\t\t\t\tcomponent.position.copy(\n\t\t\t\t\t\tthis.convertTo3DMapPosition(\n\t\t\t\t\t\t\tcomponent.feature.geometry.coordinates[1],\n\t\t\t\t\t\t\tcomponent.feature.geometry.coordinates[0],\n\t\t\t\t\t\t\tstyle.altitude,\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t\tcomponent.builder.setup(component.mesh);\n\t\t\t\t\tcomponent.mesh.traverse(child => {\n\t\t\t\t\t\tchild.userData = {\n\t\t\t\t\t\t\t...child.userData, // preserve userData if specified by user. this is used by bluedot to keep track floorId\n\t\t\t\t\t\t\tentityId,\n\t\t\t\t\t\t\ttype: 'custom-geometry',\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\t\t\t\t\tcomponent.dirty = false;\n\t\t\t\t}\n\t\t\t\t// next, update\n\t\t\t\tif (style.visible !== false) {\n\t\t\t\t\tcomponent.builder.update(component.mesh);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n", "import { Geometry3D, Geometry3DComponents } from '../../entities';\nimport type { All3DTypes, RendererState } from '../../renderer';\nimport { getGroupContainerOpacity } from '../../utils';\nimport { OUTLINE_MAX_ZOOM_LEVEL, OUTLINE_MIN_ZOOM_LEVEL } from './constants';\nimport { BufferAttribute, EdgesGeometry, FrontSide, LineSegments, Color } from 'three';\nimport { MeshComponent } from '../../components/mesh';\nimport { GeometryGroupObject3D } from '../../entities/geometry-group';\nimport { mergeGeometries } from 'three/examples/jsm/utils/BufferGeometryUtils.js';\nimport type { OutlineComponent } from '../../components/outline';\nimport { hasOutline, needsOutline, updateBufferGeometryHeight } from './utils';\nimport { extractBufferGeometryFromBatchedGeometry } from '../mesh-detachment/utils';\nimport { interpolate, PubSub } from '@packages/internal/common';\nimport { OutlineLineMaterial } from './outline-material';\nimport { IdleQueue } from '../../utils/idle-queue';\n\nconst GEOMETRY_OUTLINE_THRESHOLD = 80;\n\n// we should be able to use buffer attributes to control each individual spaces' outline color and opacity by storing them in the buffer\n// instead of detaching them.\n\nexport class OutlineInterpolationSystem extends PubSub<{\n\t'needs-render': void;\n}> {\n\tprivate rendererState: RendererState;\n\t/**\n\t * Set to true when we need to update the outline opacity of all entities, regardless of zoom level.\n\t */\n\toutlineOpacitiesDirty = true;\n\n\t/**\n\t * Use IdleQueue to ensure the thread isn't blocked by building outlines\n\t * @internal for unit tests only\n\t */\n\tuseIdleFramesOnly = true;\n\n\t/*\n\t * set when geometries in the scene have changed, so we don't loop through all the geometries every render\n\t */\n\t#geometries3DDirty = true;\n\n\tget geometries3DDirty() {\n\t\treturn this.#geometries3DDirty;\n\t}\n\n\tset geometries3DDirty(value: boolean) {\n\t\tthis.#geometries3DDirty = value;\n\t}\n\n\t#lastOpacity = -Infinity;\n\n\t/**\n\t * Allow the building of outlines to occur when we have idle frames, so it doesn't impact initial load times\n\t */\n\tidleBuildQueue = new IdleQueue();\n\n\t/**\n\t * Based on perf testing computing bounding sphere can take a very long time,\n\t * and we only need it for frustum checking, which can wait a little, so putting it into its own idle frame queue\n\t */\n\tidleComputeBoundingSphereQueue = new IdleQueue();\n\n\tconstructor(rendererState: RendererState) {\n\t\tsuper();\n\t\tthis.rendererState = rendererState;\n\t\t/**\n\t\t * Since the building of geometries is async, we need one more render to ensure the outline styles get applied\n\t\t * This is called when the queue is empty\n\t\t */\n\t\tthis.idleBuildQueue.onComplete(this.#publishRender);\n\t}\n\n\t#mergedGeometries = new Map<GeometryGroupObject3D, [boolean, Geometry3D[]]>();\n\n\t#material = new OutlineLineMaterial({\n\t\tvertexColors: true,\n\t\tlinewidth: 1,\n\t\ttransparent: true,\n\t\topacity: 1.0,\n\t\tside: FrontSide,\n\t});\n\n\tbuildOutlines(geometryGroupEntity: GeometryGroupObject3D) {\n\t\tconst edgeGeometries: [OutlineComponent, EdgesGeometry][] = [];\n\t\tfor (const childEntityId of geometryGroupEntity.userData.entities3D.values()) {\n\t\t\tconst childGeometry3DEntity = this.rendererState.geometry3DMap.get(childEntityId);\n\n\t\t\tif (\n\t\t\t\tchildGeometry3DEntity instanceof Geometry3D &&\n\t\t\t\tchildGeometry3DEntity.type === 'geometry' &&\n\t\t\t\tchildGeometry3DEntity.components[Geometry3DComponents.Outline] &&\n\t\t\t\tchildGeometry3DEntity.components[Geometry3DComponents.Outline].dirty === true &&\n\t\t\t\tchildGeometry3DEntity.components[Geometry3DComponents.Mesh].material != null\n\t\t\t) {\n\t\t\t\tlet geometry = childGeometry3DEntity.components[Geometry3DComponents.Mesh].geometry;\n\t\t\t\tlet needsDisposal = false;\n\t\t\t\tif (!geometry) {\n\t\t\t\t\tgeometry = extractBufferGeometryFromBatchedGeometry(\n\t\t\t\t\t\tchildGeometry3DEntity.components[Geometry3DComponents.Mesh],\n\t\t\t\t\t);\n\t\t\t\t\tneedsDisposal = true;\n\t\t\t\t}\n\n\t\t\t\tconst style = childGeometry3DEntity.components[Geometry3DComponents.Style];\n\t\t\t\tedgeGeometries.push([\n\t\t\t\t\tchildGeometry3DEntity.components[Geometry3DComponents.Outline],\n\t\t\t\t\t// The default 80-degree threshold is designed for sharp edges in simple extruded shapes. Beveled geometries have smooth transitions with angles much smaller than 80 degrees, so they need a lower threshold to detect edges properly.\n\t\t\t\t\tnew EdgesGeometry(geometry, style.bevel?.enabled ? 1 : GEOMETRY_OUTLINE_THRESHOLD), //\n\t\t\t\t]);\n\n\t\t\t\tif (needsDisposal) {\n\t\t\t\t\tgeometry?.dispose();\n\t\t\t\t\tgeometry = undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (edgeGeometries.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\t// merge individual outlines into single draw call\n\t\tconst mergedGeometry = mergeGeometries(\n\t\t\tedgeGeometries.map(e => e[1]),\n\t\t\tfalse,\n\t\t);\n\n\t\tif (mergedGeometry == null) {\n\t\t\treturn;\n\t\t}\n\n\t\t// create buffers for updates\n\t\tconst edgePositions = mergedGeometry.getAttribute('position');\n\t\tconst edgeColors = new Float32Array(edgePositions.count * 4);\n\t\tconst colorBuffer = new BufferAttribute(edgeColors, 4);\n\t\tmergedGeometry.setAttribute('color', colorBuffer);\n\n\t\tconst edgeVisibility = new Uint8Array(edgePositions.count);\n\t\tedgeVisibility.fill(0); // Start with everything hidden\n\t\tconst visibilityBuffer = new BufferAttribute(edgeVisibility, 1, false);\n\t\tmergedGeometry.setAttribute('visibility', visibilityBuffer);\n\n\t\t// Calculate ranges based on the original edge geometries\n\t\tlet currentStart = 0;\n\t\tfor (let i = 0; i < edgeGeometries.length; i++) {\n\t\t\tconst [outlineComponent, individualGeometry] = edgeGeometries[i];\n\t\t\tconst vertexCount = individualGeometry.getAttribute('position').count;\n\n\t\t\toutlineComponent.edgeColors = colorBuffer;\n\t\t\toutlineComponent.edgeVisibility = visibilityBuffer;\n\t\t\toutlineComponent.geometry = mergedGeometry;\n\n\t\t\toutlineComponent.ranges = {\n\t\t\t\tcount: vertexCount,\n\t\t\t\tstart: currentStart,\n\t\t\t};\n\n\t\t\tcurrentStart += vertexCount;\n\t\t\t// dispose of the individual geometry as we don't need it anymore\n\t\t\tindividualGeometry.dispose();\n\t\t}\n\n\t\tconst outline = new LineSegments(mergedGeometry, this.#material);\n\t\toutline.userData.isOutline = true;\n\t\tgeometryGroupEntity.add(outline);\n\t}\n\n\t/**\n\t * Update the outline color of all entities with an outline component.\n\t * @param zoomLevel - The current zoom level.\n\t * @param isCameraZoomDirty - Whether the zoom level has changed since the last update. If this is true, the system will update if zoomLevel falls between range.\n\t */\n\tupdate(zoomLevel: number, isCameraZoomDirty = true) {\n\t\tlet geometryGroupEntity: All3DTypes | undefined;\n\t\tif (this.geometries3DDirty) {\n\t\t\tfor (const entityId of this.rendererState.geometry3DIdsInScene) {\n\t\t\t\tconst geometryGroupEntity = this.rendererState.geometry3DMap.get(entityId);\n\t\t\t\tif (\n\t\t\t\t\tgeometryGroupEntity instanceof GeometryGroupObject3D &&\n\t\t\t\t\tneedsOutline(geometryGroupEntity, this.rendererState) &&\n\t\t\t\t\t!hasOutline(geometryGroupEntity) &&\n\t\t\t\t\tgeometryGroupEntity.userData.entities3D.size > 0\n\t\t\t\t) {\n\t\t\t\t\tif (this.useIdleFramesOnly) {\n\t\t\t\t\t\tthis.idleBuildQueue.add(() => this.buildOutlines(geometryGroupEntity));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.buildOutlines(geometryGroupEntity);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.#geometries3DDirty = false;\n\t\t\tthis.outlineOpacitiesDirty = true;\n\t\t}\n\n\t\t// update color and height\n\t\tfor (const entityId of this.rendererState.geometry3DIdsInScene) {\n\t\t\tconst entity = this.rendererState.geometry3DMap.get(entityId);\n\n\t\t\tif (\n\t\t\t\tentity instanceof Geometry3D &&\n\t\t\t\tentity.type === 'geometry' &&\n\t\t\t\tentity.components[Geometry3DComponents.Outline] &&\n\t\t\t\tentity.components[Geometry3DComponents.Outline].dirty === true &&\n\t\t\t\tentity.components[Geometry3DComponents.Mesh].material != null &&\n\t\t\t\tentity.parentObject3D instanceof GeometryGroupObject3D\n\t\t\t) {\n\t\t\t\tconst outlineMergedGeometry = entity.components[Geometry3DComponents.Outline].geometry;\n\t\t\t\tif (!outlineMergedGeometry) continue;\n\n\t\t\t\tconst outlineComponent = entity.components[Geometry3DComponents.Outline];\n\t\t\t\tif (!outlineComponent) continue;\n\n\t\t\t\tconst visible = outlineComponent.enabled && entity.components[Geometry3DComponents.Style].visible;\n\t\t\t\tif (outlineComponent.visible !== visible) {\n\t\t\t\t\toutlineComponent.visible = visible;\n\t\t\t\t}\n\n\t\t\t\tif (!outlineComponent.visible) continue;\n\n\t\t\t\tconst edgeColors = outlineComponent.edgeColors;\n\t\t\t\tif (!edgeColors) continue;\n\n\t\t\t\tif (!outlineComponent.ranges) continue;\n\n\t\t\t\tconst color = new Color(outlineComponent.color);\n\n\t\t\t\tfor (let i = 0; i < outlineComponent.ranges!.count; i++) {\n\t\t\t\t\tconst vertexIndex = outlineComponent.ranges!.start + i;\n\t\t\t\t\tedgeColors.setXYZ(vertexIndex, color.r, color.g, color.b);\n\t\t\t\t}\n\n\t\t\t\t// let's update the height of the outline\n\t\t\t\tconst height = entity.components[Geometry3DComponents.Style].height;\n\n\t\t\t\tconst altitude = entity.components[Geometry3DComponents.Style].altitude;\n\n\t\t\t\t// updateBufferGeometryHeight logic was designed for simple extruded shapes with flat tops and bottoms. It flattens geometry to just two Z-levels (altitude and altitude+height), which destroys the intermediate Z-values that create the beveled profile.\n\t\t\t\tconst hasBevel = entity.components[Geometry3DComponents.Style]?.bevel?.enabled;\n\t\t\t\tif (!hasBevel) {\n\t\t\t\t\tupdateBufferGeometryHeight(outlineMergedGeometry, outlineComponent.ranges, height, altitude);\n\t\t\t\t}\n\n\t\t\t\toutlineMergedGeometry.attributes.color.needsUpdate = true;\n\n\t\t\t\t// Recompute bounding sphere after modifying positions for proper frustum culling\n\t\t\t\tthis.idleComputeBoundingSphereQueue.add(() => outlineMergedGeometry.computeBoundingSphere());\n\t\t\t\toutlineComponent.dirty = false;\n\t\t\t}\n\t\t}\n\n\t\tconst outlineOpacity = isCameraZoomDirty\n\t\t\t? interpolate(zoomLevel, OUTLINE_MIN_ZOOM_LEVEL, OUTLINE_MAX_ZOOM_LEVEL, 0, 1)\n\t\t\t: this.#lastOpacity;\n\n\t\tif (outlineOpacity !== this.#lastOpacity || this.outlineOpacitiesDirty) {\n\t\t\tif (this.rendererState.geometry3DIdsInScene.size > 0) {\n\t\t\t\tfor (const entityId of this.rendererState.geometry3DIdsInScene) {\n\t\t\t\t\tgeometryGroupEntity = this.rendererState.geometry3DMap.get(entityId);\n\t\t\t\t\tif (\n\t\t\t\t\t\tgeometryGroupEntity?.type === 'geometry' &&\n\t\t\t\t\t\tgeometryGroupEntity.components[Geometry3DComponents.Mesh] instanceof MeshComponent\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst outline = geometryGroupEntity.components[Geometry3DComponents.Outline];\n\t\t\t\t\t\tif (outline && outline.edgeColors && outline.geometry && outline.visible) {\n\t\t\t\t\t\t\tconst targetOpacity = Math.min(\n\t\t\t\t\t\t\t\toutlineOpacity,\n\t\t\t\t\t\t\t\tgeometryGroupEntity.components[Geometry3DComponents.Style].opacity *\n\t\t\t\t\t\t\t\t\tgetGroupContainerOpacity(geometryGroupEntity),\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif (outline.currentOpacity !== targetOpacity) {\n\t\t\t\t\t\t\t\tfor (let i = 0; i < outline.ranges!.count; i++) {\n\t\t\t\t\t\t\t\t\tconst vertexIndex = outline.ranges!.start + i;\n\t\t\t\t\t\t\t\t\toutline.edgeColors.setW(vertexIndex, targetOpacity);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\toutline.geometry.attributes.color.needsUpdate = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.#lastOpacity = outlineOpacity;\n\t\tthis.#geometries3DDirty = false;\n\t\tthis.outlineOpacitiesDirty = false;\n\t}\n\n\t#publishRender = () => {\n\t\tthis.publish('needs-render');\n\t};\n\n\tdestroy() {\n\t\tthis.#mergedGeometries.clear();\n\t\tthis.idleBuildQueue.clearAll();\n\t\tthis.idleComputeBoundingSphereQueue.clearAll();\n\t}\n}\n", "import type { BufferGeometry } from 'three';\nimport type { GeometryGroupObject3D } from '../../entities/geometry-group';\nimport type { RendererState } from '../../renderer';\nimport { Geometry3DComponents } from '../../entities';\n\nexport function hasOutline(entity: GeometryGroupObject3D) {\n\treturn entity.children.some(child => child.userData.isOutline);\n}\n\nexport function findOutline(entity: GeometryGroupObject3D) {\n\treturn entity.children.find(child => child.userData.isOutline);\n}\n\n// TODO: in the future if we want to turn outlines on and off per object, we need to fix this\nexport function needsOutline(entity: GeometryGroupObject3D, state: RendererState) {\n\tconst firstChildId = entity.userData.entities3D.values().next().value;\n\tif (!firstChildId) return false;\n\treturn state.geometry3DMap.get(firstChildId)?.components[Geometry3DComponents.Outline] !== undefined;\n}\n\nexport function updateBufferGeometryHeight(\n\tbufferGeometry: BufferGeometry,\n\tranges: { start: number; count: number },\n\theight: number,\n\taltitude: number,\n) {\n\tconst positionAttribute = bufferGeometry.getAttribute('position');\n\tconst positions = positionAttribute.array;\n\t// Find the maximum Z value in this entity's range\n\tlet maxZ = -Infinity;\n\tfor (let i = 0; i < ranges.count; i++) {\n\t\tconst vertexIndex = ranges.start + i;\n\t\tconst baseIndex = vertexIndex * 3;\n\t\tconst z = positions[baseIndex + 2];\n\t\tmaxZ = Math.max(maxZ, z);\n\t}\n\n\t// For each vertex in this entity's range\n\tfor (let i = 0; i < ranges.count; i++) {\n\t\tconst vertexIndex = ranges.start + i;\n\t\tconst baseIndex = vertexIndex * 3;\n\t\tconst z = positions[baseIndex + 2];\n\n\t\t// If this vertex is at the maximum Z, it's a top vertex\n\t\tif (Math.abs(z - maxZ) < 0.0001) {\n\t\t\t// make sure the outline is at least 2mm above the bottom of the geometry so we can use the top calculation\n\t\t\tpositions[baseIndex + 2] = Math.max(height + altitude, 0.0002 + altitude);\n\t\t} else {\n\t\t\t// Apply altitude to all other vertices\n\t\t\tpositions[baseIndex + 2] = altitude;\n\t\t}\n\t}\n\n\tbufferGeometry.attributes.position.needsUpdate = true;\n}\n", "import { BufferAttribute, BufferGeometry } from 'three';\nimport type { Matrix4 } from 'three';\nimport type { EntityBatchedMesh, MeshComponent } from '../../components/mesh';\n\n/**\n * Extract the buffer geometry from the batched geometry.\n * @param meshComponent - The mesh component to extract the buffer geometry from.\n * @returns The buffer geometry.\n */\nexport function extractBufferGeometryFromBatchedGeometry(meshComponent: MeshComponent) {\n\tconst bufferGeometry = new BufferGeometry();\n\tconst originalGeometry = meshComponent.mesh?.geometry;\n\n\tif (!originalGeometry || !meshComponent.batchedProps?.range) {\n\t\treturn;\n\t}\n\n\tconst range = meshComponent.batchedProps.range;\n\tconst start = range.start;\n\tconst count = range.count;\n\n\t// Extract position attribute\n\tconst originalPosition = originalGeometry.getAttribute('position');\n\tif (originalPosition) {\n\t\tconst extractedPositions = new Float32Array(count * 3);\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tconst sourceIndex = start + i;\n\t\t\textractedPositions[i * 3] = originalPosition.array[sourceIndex * 3];\n\t\t\textractedPositions[i * 3 + 1] = originalPosition.array[sourceIndex * 3 + 1];\n\t\t\textractedPositions[i * 3 + 2] = originalPosition.array[sourceIndex * 3 + 2];\n\t\t}\n\t\tbufferGeometry.setAttribute('position', new BufferAttribute(extractedPositions, 3));\n\t}\n\n\t// Extract normal attribute if it exists\n\tconst originalNormal = originalGeometry.getAttribute('normal');\n\tif (originalNormal) {\n\t\tconst extractedNormals = new Float32Array(count * 3);\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tconst sourceIndex = start + i;\n\t\t\textractedNormals[i * 3] = originalNormal.array[sourceIndex * 3];\n\t\t\textractedNormals[i * 3 + 1] = originalNormal.array[sourceIndex * 3 + 1];\n\t\t\textractedNormals[i * 3 + 2] = originalNormal.array[sourceIndex * 3 + 2];\n\t\t}\n\t\tbufferGeometry.setAttribute('normal', new BufferAttribute(extractedNormals, 3));\n\t}\n\n\t// Extract UV attribute if it exists\n\tconst originalUV = originalGeometry.getAttribute('uv');\n\tif (originalUV) {\n\t\tconst extractedUVs = new Float32Array(count * 2);\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tconst sourceIndex = start + i;\n\t\t\textractedUVs[i * 2] = originalUV.array[sourceIndex * 2];\n\t\t\textractedUVs[i * 2 + 1] = originalUV.array[sourceIndex * 2 + 1];\n\t\t}\n\t\tbufferGeometry.setAttribute('uv', new BufferAttribute(extractedUVs, 2));\n\t}\n\n\t// Extract index if it exists\n\tif (originalGeometry.index) {\n\t\tconst originalIndex = originalGeometry.index;\n\t\tconst extractedIndices = new Uint32Array(count);\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\textractedIndices[i] = originalIndex.array[start + i];\n\t\t}\n\t\tbufferGeometry.setIndex(new BufferAttribute(extractedIndices, 1));\n\t}\n\n\treturn bufferGeometry;\n}\n\n/**\n * Transfer the geometry from the old batched mesh to the new batched mesh.\n * @param meshComponent - The mesh component to transfer the geometry from.\n * @param newBatchedMesh - The new batched mesh to transfer the geometry to.\n * @returns The instance of the new batched mesh.\n */\nexport function transferGeometryToNewBatchedMesh(\n\tmeshComponent: MeshComponent,\n\tnewBatchedMesh: EntityBatchedMesh,\n\tmatrix: Matrix4,\n) {\n\t// extract buffer geometry out of the batched mesh\n\tconst bufferGeometry = extractBufferGeometryFromBatchedGeometry(meshComponent);\n\tif (!bufferGeometry || !meshComponent.mesh) {\n\t\treturn;\n\t}\n\n\t// preserve the instance matrix\n\tmeshComponent.mesh.getMatrixAt(meshComponent.instanceIndex, matrix);\n\n\t// let's remove the instance from the old batched mesh\n\tmeshComponent.mesh.deleteInstance(meshComponent.instanceIndex);\n\tmeshComponent.mesh.optimize();\n\n\t// add the geometry to the new batched mesh\n\tconst instance = newBatchedMesh.addGeometry(bufferGeometry);\n\tnewBatchedMesh.addInstance(instance);\n\n\t// apply the mesh's matrix to the new instance\n\tnewBatchedMesh.setMatrixAt(instance, matrix);\n\n\t// get the geometry id and range of the new batched mesh\n\tconst geometryId = newBatchedMesh.getGeometryIdAt(instance);\n\tconst range = newBatchedMesh.getGeometryRangeAt(geometryId);\n\tif (range && meshComponent.batchedProps) {\n\t\tmeshComponent.batchedProps.range = range;\n\t}\n\n\t// and now dispose of the geometry to free up memory\n\tbufferGeometry.dispose();\n\n\treturn instance;\n}\n", "import { LineBasicMaterial } from 'three';\nimport vertexShader from './outline-vertex.glsl';\nimport fragmentShader from './outline-fragment.glsl';\n\n/**\n * Custom LineBasicMaterial that supports per-vertex visibility and opacity.\n */\nexport class OutlineLineMaterial extends LineBasicMaterial {\n\tconstructor(parameters?: any) {\n\t\tsuper(parameters);\n\n\t\tthis.onBeforeCompile = shader => {\n\t\t\tshader.vertexShader = vertexShader;\n\t\t\tshader.fragmentShader = fragmentShader;\n\t\t};\n\t}\n}\n", "export default `// Modified from https://github.com/mrdoob/three.js/blob/dev/src/renderers/shaders/ShaderLib/linedashed.glsl.js\nuniform float scale;\nattribute float lineDistance;\n\nvarying float vLineDistance;\nattribute float visibility;\nvarying vec4 v_color;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\tvLineDistance = scale * lineDistance;\n\tv_color = color;\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n    if (visibility < 0.5) {\n        gl_Position = vec4(-2.0, -2.0, -2.0, 1.0);\n    }\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}`", "export default `// Modified from https://github.com/mrdoob/three.js/blob/dev/src/renderers/shaders/ShaderLib/linedashed.glsl.js\nuniform vec3 diffuse;\nuniform float opacity;\n\nuniform float dashSize;\nuniform float totalSize;\n\nvarying float vLineDistance;\nvarying vec4 v_color;\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\n\t\tdiscard;\n\n\t}\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\n\toutgoingLight = diffuseColor.rgb; // simple shader\n\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n\t// Discard alpha lower than 0.01 to avoid opacity fighting\n    if (v_color.a <= 0.01) { \n\t\tdiscard;\n\t}\n}\n`", "const FORCE_IDLE_CALLBACK_TIMEOUT = 3000;\n// Minimum time buffer (in ms) required before starting the next callback\n// This prevents starting expensive operations when we're almost out of idle time\nconst MIN_TIME_REMAINING = 2;\n\n/**\n * A queue that processes callbacks during browser idle time.\n * Supports tracking queue size and running callbacks when all jobs complete.\n */\nexport class IdleQueue {\n\t#queue: (() => void)[] = [];\n\t#isProcessing = false;\n\t#onCompleteCallback?: () => void;\n\t#currentCallbackId?: number;\n\n\t/**\n\t * Returns the current number of pending jobs in the queue\n\t */\n\tget size(): number {\n\t\treturn this.#queue.length;\n\t}\n\n\t/**\n\t * Adds a callback to the queue.\n\t * The queue will process callbacks during idle time to avoid blocking the main thread.\n\t * @param callback - The callback to execute during idle time\n\t */\n\tadd(callback: () => void): void {\n\t\tthis.#queue.push(callback);\n\n\t\t// Only start processing if we're not already processing\n\t\tif (!this.#isProcessing) {\n\t\t\tthis.#processQueue();\n\t\t}\n\t}\n\n\t/**\n\t * Sets a callback to run when all jobs in the queue have completed.\n\t * This callback will be invoked after the last job finishes processing.\n\t * @param callback - The callback to execute when queue is empty\n\t */\n\tonComplete(callback: () => void): void {\n\t\tthis.#onCompleteCallback = callback;\n\t}\n\n\t/**\n\t * Clears the completion callback\n\t */\n\tclearOnComplete(): void {\n\t\tthis.#onCompleteCallback = undefined;\n\t}\n\n\t/**\n\t * Processes items from the queue during idle time\n\t */\n\t#processQueue(): void {\n\t\tthis.#isProcessing = true;\n\t\tthis.#currentCallbackId = requestIdleCallback(\n\t\t\tdeadline => {\n\t\t\t\tlet processedCount = 0;\n\t\t\t\t// Process items while we have sufficient idle time remaining\n\t\t\t\t// We require MIN_TIME_REMAINING to avoid starting expensive operations when almost out of time\n\t\t\t\twhile (this.#queue.length > 0 && deadline.timeRemaining() > MIN_TIME_REMAINING) {\n\t\t\t\t\tconst callback = this.#queue.shift();\n\t\t\t\t\tif (callback) {\n\t\t\t\t\t\tcallback();\n\t\t\t\t\t\tprocessedCount++;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If we didn't process any jobs due to insufficient idle time,\n\t\t\t\t// process at least one job to ensure progress and prevent infinite rescheduling\n\t\t\t\t// Only do this when there's truly no idle time (< MIN_TIME_REMAINING)\n\t\t\t\t// This handles both real timeouts and polyfill cases where didTimeout is always false\n\t\t\t\tif (processedCount === 0 && this.#queue.length > 0 && deadline.timeRemaining() < MIN_TIME_REMAINING) {\n\t\t\t\t\tconst callback = this.#queue.shift();\n\t\t\t\t\tif (callback) {\n\t\t\t\t\t\tcallback();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Clear the callback ID since this callback has finished\n\t\t\t\tthis.#currentCallbackId = undefined;\n\n\t\t\t\t// Reschedule if there are still items in the queue\n\t\t\t\tif (this.#queue.length > 0) {\n\t\t\t\t\tthis.#processQueue();\n\t\t\t\t} else {\n\t\t\t\t\t// Queue is empty, mark as not processing and invoke completion callback\n\t\t\t\t\tthis.#isProcessing = false;\n\t\t\t\t\tif (this.#onCompleteCallback) {\n\t\t\t\t\t\tthis.#onCompleteCallback();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t{ timeout: FORCE_IDLE_CALLBACK_TIMEOUT },\n\t\t);\n\t}\n\n\t/**\n\t * Clears all pending jobs and the completion callback.\n\t * Cancels any in-progress idle callback.\n\t * Useful when resetting the queue completely.\n\t */\n\tclearAll(): void {\n\t\tthis.#queue = [];\n\t\tthis.#isProcessing = false;\n\t\tthis.#onCompleteCallback = undefined;\n\t\tif (this.#currentCallbackId !== undefined) {\n\t\t\tcancelIdleCallback(this.#currentCallbackId);\n\t\t\tthis.#currentCallbackId = undefined;\n\t\t}\n\t}\n}\n", "import type { All3DTypes, ImagePlacementOptions, RendererState } from '../../renderer';\nimport { Geometry3DComponents } from '../../entities';\nimport type { MeshComponent } from '../../components/mesh';\nimport {\n\tAxesHelper,\n\tDoubleSide,\n\tFrustum,\n\tMathUtils,\n\tMesh,\n\tMeshLambertMaterial,\n\tPlaneGeometry,\n\tSphereGeometry,\n\tSRGBColorSpace,\n\tVector2,\n\tVector3,\n\ttype Texture,\n\tMatrix4,\n} from 'three';\nimport { TextureLoader } from '../../utils/texture-loader';\nimport type { RendererCore } from '../..';\nimport type { StyleComponent } from '../../components/styles/style';\nimport { PubSub, round } from '@packages/internal/common';\nimport { EntityMesh, type ImageComponent } from '../../components/image';\nimport type { Position as GeoJsonPosition } from 'geojson';\nimport type { Rectangle } from '../../utils/largest-interior-rectangle';\nimport { findLargestInteriorRectangle } from '../../utils/largest-interior-rectangle';\nimport { Rectangle as QuadTreeRectangle } from '@packages/internal/quad-tree';\nimport { RENDER_LAYERS } from '../../utils/constants';\nconst TWO_PI = Math.PI * 2;\nconst HALF_PI = Math.PI / 2;\nconst ONE_AND_A_HALF_PI = Math.PI * 1.5;\nconst ROUNDED_HALF_PI = round(HALF_PI, 2);\nconst ROUNDED_ONE_AND_A_HALF_PI = round(ONE_AND_A_HALF_PI, 2);\nexport const DEFAULT_VERTICAL_OFFSET = 0.01;\n\nconst SHOW_DEBUG_IMAGE_CONTAINERS = false;\n\nexport class ImageSystem extends PubSub<{\n\t'image-loaded': void;\n}> {\n\tprivate rendererState: RendererState;\n\tprivate convertTo3DMapPosition: RendererCore['convertTo3DMapPosition'];\n\tprivate projectToScreen: (projectVector: Vector2, position: Vector3) => void;\n\tprivate initialBearing = 0;\n\tprivate naturalBearing = 0;\n\tprivate imagePlacementOptions: ImagePlacementOptions;\n\tprivate cameraFrustum = new Frustum();\n\tconstructor(\n\t\trendererState: RendererState,\n\t\tconvertTo3DMapPosition: RendererCore['convertTo3DMapPosition'],\n\t\tprojectToScreen: (projectVector: Vector2, position: Vector3) => void,\n\t\tinitialBearing = 0,\n\t\tnaturalBearing = 0,\n\t\timagePlacementOptions: ImagePlacementOptions = {},\n\t) {\n\t\tsuper();\n\t\tthis.rendererState = rendererState;\n\t\tthis.convertTo3DMapPosition = convertTo3DMapPosition;\n\t\tthis.projectToScreen = projectToScreen;\n\t\tthis.initialBearing = initialBearing;\n\t\tthis.naturalBearing = naturalBearing;\n\t\tthis.imagePlacementOptions = imagePlacementOptions;\n\t}\n\n\tprivate createImageMesh(\n\t\tentityId: string | number,\n\t\turl: string,\n\t\tpolygonImage: { width: number; height: number; rotation?: number; position?: GeoJsonPosition },\n\t\tverticalOffset = 0,\n\t\tposition: GeoJsonPosition,\n\t\tpolygonPoints: { x: number; y: number }[],\n\t) {\n\t\tconst originalRectangle: Rectangle = {\n\t\t\twidth: polygonImage.width,\n\t\t\theight: polygonImage.height,\n\t\t\tcenter: this.convertTo3DMapPosition(position),\n\t\t\trotation: polygonImage.rotation ?? 0,\n\t\t};\n\n\t\tconst imagePlacementMode = this.imagePlacementOptions.mode ?? 'default';\n\n\t\tconst rectangle = (() => {\n\t\t\tswitch (imagePlacementMode) {\n\t\t\t\tcase 'fit-nearest-90':\n\t\t\t\t\t// Calculate the bearing difference and normalize to 0-180, so we can see if it's close to 90 degrees\n\t\t\t\t\tlet bearingDiff = (this.initialBearing - this.naturalBearing + 360) % 180;\n\t\t\t\t\tif (bearingDiff >= 45 && bearingDiff <= 135) {\n\t\t\t\t\t\treturn findLargestInteriorRectangle(\n\t\t\t\t\t\t\toriginalRectangle,\n\t\t\t\t\t\t\tpolygonPoints,\n\t\t\t\t\t\t\toriginalRectangle.rotation + 90,\n\t\t\t\t\t\t\tthis.imagePlacementOptions,\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn originalRectangle;\n\t\t\t\t\t}\n\t\t\t\tcase 'fit-initial-bearing':\n\t\t\t\t\treturn findLargestInteriorRectangle(\n\t\t\t\t\t\toriginalRectangle,\n\t\t\t\t\t\tpolygonPoints,\n\t\t\t\t\t\tthis.initialBearing,\n\t\t\t\t\t\tthis.imagePlacementOptions,\n\t\t\t\t\t);\n\t\t\t\tcase 'default':\n\t\t\t\tcase 'none':\n\t\t\t\tdefault:\n\t\t\t\t\treturn originalRectangle;\n\t\t\t}\n\t\t})();\n\n\t\tif (SHOW_DEBUG_IMAGE_CONTAINERS && rectangle.polygonCenter) {\n\t\t\tconst debugCenter = new Mesh(new SphereGeometry(1), new MeshLambertMaterial({ color: 0x00ff00 }));\n\t\t\tdebugCenter.position.set(rectangle.polygonCenter.x, rectangle.polygonCenter.y, verticalOffset);\n\t\t\tthis.rendererState.entityScene.add(debugCenter);\n\t\t}\n\n\t\tconst material = new MeshLambertMaterial({\n\t\t\ttransparent: true,\n\t\t\t/**\n\t\t\t * Disable writing to depth buffer by default. This avoids discarding pixels that are further from the camera but rendered later.\n\t\t\t * In Three.js, the rendering order is sorted by distance to the camera, ensuring that farther items are rendered first. This prevents them\n\t\t\t * from being discarded by the depth buffer. However, this default approach does not account for cases where two meshes clip through each other.\n\t\t\t * Leaving depthWrite disabled helps handle these scenarios more effectively. When changing this property later ensure to test this scenario to get the best result.\n\t\t\t * Generally, it's recommended to disable depthWrite when rendering 2D planes that should always appear on top of other objects.\n\t\t\t */\n\t\t\tdepthWrite: false,\n\t\t\tside: DoubleSide,\n\t\t});\n\n\t\tconst geo = new PlaneGeometry(rectangle.width, rectangle.height);\n\t\tconst imageMesh = new EntityMesh(geo);\n\t\timageMesh.visible = false;\n\t\timageMesh.renderOrder = RENDER_LAYERS.IMAGE_MESH;\n\n\t\tthis.getOrDownloadImage(url)?.then(texture => {\n\t\t\tmaterial.map = texture;\n\t\t\tmaterial.needsUpdate = true;\n\t\t\tmaterial.map.colorSpace = SRGBColorSpace;\n\t\t\timageMesh.visible = true;\n\t\t\tthis.publish('image-loaded');\n\t\t});\n\n\t\timageMesh.userData.entityId = entityId;\n\t\timageMesh.material = material;\n\n\t\tif (SHOW_DEBUG_IMAGE_CONTAINERS) {\n\t\t\tconst containerMesh = new Mesh(\n\t\t\t\tnew PlaneGeometry(polygonImage.width, polygonImage.height),\n\t\t\t\tnew MeshLambertMaterial({ color: 'gray' }),\n\t\t\t);\n\t\t\timageMesh.add(containerMesh);\n\t\t\tconst axisHelper = new AxesHelper();\n\t\t\timageMesh.add(axisHelper);\n\t\t\taxisHelper.scale.set(10, 10, 10);\n\t\t}\n\n\t\t// Use rectangle center instead of original position\n\t\timageMesh.position.set(rectangle.center.x, rectangle.center.y, verticalOffset + DEFAULT_VERTICAL_OFFSET);\n\n\t\t// Apply rotation, ensuring it's in the range 0 - 2pi\n\t\timageMesh.rotation.z = (-MathUtils.degToRad(rectangle.rotation) + TWO_PI) % TWO_PI;\n\n\t\treturn imageMesh;\n\t}\n\n\tprivate getOrDownloadImage(url: string) {\n\t\tif (this.imageLoadingCache.has(url)) {\n\t\t\treturn this.imageLoadingCache.get(url)?.promise;\n\t\t} else {\n\t\t\tconst promise = new Promise<Texture>(resolve => {\n\t\t\t\tTextureLoader.getLoader().load(url, texture => {\n\t\t\t\t\tconst state = this.imageLoadingCache.get(url);\n\t\t\t\t\tif (state && !state.loaded) {\n\t\t\t\t\t\tstate.loaded = true;\n\t\t\t\t\t}\n\t\t\t\t\tresolve(texture);\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis.imageLoadingCache.set(url, { loaded: false, promise });\n\n\t\t\treturn promise;\n\t\t}\n\t}\n\n\t/**\n\t * We need to track the loaded state separately from the promise since we can't check\n\t * the resolution state of a promise after it settles. This allows components to check\n\t * if an image has finished loading without having to await the promise.\n\t */\n\timageLoadingCache = new Map<string, { loaded: boolean; promise: Promise<Texture> }>();\n\n\tprivate flipIfNeeded(meshComponent: MeshComponent | ImageComponent, cameraRotationRadians: number) {\n\t\tif (meshComponent.imageMesh == null) return;\n\n\t\t// Negate camera rotation to match our coordinate system\n\t\tconst normalizedCameraRotation = -cameraRotationRadians;\n\t\tconst imageRotation = meshComponent.imageMesh.rotation.z;\n\n\t\t// Calculate relative angle between image and camera\n\t\tconst angle = round((imageRotation - normalizedCameraRotation + TWO_PI) % TWO_PI, 2);\n\n\t\t// Round the angles to avoid floating point precision issues\n\t\tif (angle > ROUNDED_HALF_PI && angle < ROUNDED_ONE_AND_A_HALF_PI) {\n\t\t\tmeshComponent.imageMesh.rotation.z = (imageRotation + Math.PI) % TWO_PI;\n\t\t}\n\t}\n\n\tcurrentImageScreenBBoxes: QuadTreeRectangle[] = [];\n\n\tprivate viewProjectionMatrix = new Matrix4();\n\n\tupdate(cameraRotationRadians: number) {\n\t\tthis.currentImageScreenBBoxes = [];\n\t\tthis.viewProjectionMatrix\n\t\t\t.identity()\n\t\t\t.multiply(this.rendererState.cameraObject.projectionMatrix)\n\t\t\t.multiply(this.rendererState.cameraObject.matrixWorldInverse);\n\t\tthis.cameraFrustum.setFromProjectionMatrix(this.viewProjectionMatrix);\n\n\t\tlet entity: All3DTypes | undefined;\n\t\tlet meshComponent: MeshComponent | ImageComponent | undefined;\n\t\tlet styleComponent: StyleComponent | undefined;\n\t\tfor (let entityId of this.rendererState.geometry3DIdsInScene) {\n\t\t\tentity = this.rendererState.geometry3DMap.get(entityId);\n\n\t\t\tif (entity?.type === 'image') {\n\t\t\t\tmeshComponent = entity.components[Geometry3DComponents.Mesh] as ImageComponent;\n\t\t\t\tstyleComponent = entity.components[Geometry3DComponents.Style] as StyleComponent;\n\t\t\t\tif (styleComponent.url && meshComponent.imageMesh == null) {\n\t\t\t\t\t// Convert coordinates to {x, y} points\n\t\t\t\t\tconst point = this.convertTo3DMapPosition(meshComponent.feature.geometry.coordinates);\n\t\t\t\t\tconst pos = { x: point.x, y: point.y };\n\n\t\t\t\t\tmeshComponent.imageMesh = this.createImageMesh(\n\t\t\t\t\t\tentity.id,\n\t\t\t\t\t\tstyleComponent.url,\n\t\t\t\t\t\tmeshComponent.feature.properties,\n\t\t\t\t\t\tmeshComponent.feature.properties.verticalOffset,\n\t\t\t\t\t\tmeshComponent.feature.geometry.coordinates,\n\t\t\t\t\t\t[pos],\n\t\t\t\t\t);\n\t\t\t\t\tmeshComponent.mesh.add(meshComponent.imageMesh);\n\t\t\t\t\tmeshComponent.position.copy(meshComponent.imageMesh.position);\n\t\t\t\t}\n\n\t\t\t\tif (meshComponent.imageMesh) {\n\t\t\t\t\t// now rotate so it tries to face the camera\n\t\t\t\t\tif (styleComponent.flipImageToFaceCamera) {\n\t\t\t\t\t\tthis.flipIfNeeded(meshComponent, cameraRotationRadians);\n\t\t\t\t\t}\n\t\t\t\t\tif (meshComponent.imageMesh.material instanceof MeshLambertMaterial && styleComponent.dirty) {\n\t\t\t\t\t\tmeshComponent.imageMesh.material.opacity = styleComponent.opacity;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (entity?.type === 'geometry') {\n\t\t\t\tmeshComponent = entity.components[Geometry3DComponents.Mesh] as MeshComponent;\n\t\t\t\tstyleComponent = entity.components[Geometry3DComponents.Style] as StyleComponent;\n\n\t\t\t\tif (\n\t\t\t\t\tstyleComponent.showImage &&\n\t\t\t\t\tmeshComponent.feature.properties?.image &&\n\t\t\t\t\tmeshComponent.imageMesh == null &&\n\t\t\t\t\tmeshComponent.visible &&\n\t\t\t\t\tmeshComponent.mesh != null &&\n\t\t\t\t\tmeshComponent.mesh.parent != null &&\n\t\t\t\t\tmeshComponent.feature.properties?.image.position != null &&\n\t\t\t\t\tmeshComponent.feature.geometry.coordinates != null &&\n\t\t\t\t\tmeshComponent.feature.geometry.coordinates.length > 0\n\t\t\t\t) {\n\t\t\t\t\t// Convert coordinates to {x, y} points\n\t\t\t\t\tconst points = meshComponent.feature.geometry.coordinates[0].map(coord => {\n\t\t\t\t\t\tconst pos = this.convertTo3DMapPosition(coord);\n\n\t\t\t\t\t\treturn { x: pos.x, y: pos.y };\n\t\t\t\t\t});\n\n\t\t\t\t\tconst mesh = this.createImageMesh(\n\t\t\t\t\t\tentityId,\n\t\t\t\t\t\tmeshComponent.feature.properties?.image.path,\n\t\t\t\t\t\tmeshComponent.feature.properties?.image,\n\t\t\t\t\t\tstyleComponent.height,\n\t\t\t\t\t\tmeshComponent.feature.properties?.image.position,\n\t\t\t\t\t\tpoints,\n\t\t\t\t\t);\n\t\t\t\t\tmeshComponent.mesh.parent.add(mesh);\n\t\t\t\t\tmeshComponent.imageMesh = mesh;\n\t\t\t\t}\n\n\t\t\t\tif (meshComponent.imageMesh) {\n\t\t\t\t\tif (!meshComponent.visible) {\n\t\t\t\t\t\tmeshComponent.imageMesh.visible = false;\n\t\t\t\t\t} else if (styleComponent.showImage && !meshComponent.imageMesh.visible) {\n\t\t\t\t\t\tif (styleComponent.url) {\n\t\t\t\t\t\t\tconst state = this.imageLoadingCache.get(styleComponent.url);\n\t\t\t\t\t\t\tif (state && state.loaded) {\n\t\t\t\t\t\t\t\tmeshComponent.imageMesh.visible = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmeshComponent.imageMesh.visible = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (!styleComponent.showImage && meshComponent.imageMesh.visible) {\n\t\t\t\t\t\tmeshComponent.imageMesh.visible = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// now rotate so it tries to face the camera\n\t\t\t\t\tif (styleComponent.flipImageToFaceCamera) {\n\t\t\t\t\t\tthis.flipIfNeeded(meshComponent, cameraRotationRadians);\n\t\t\t\t\t}\n\t\t\t\t\tif (styleComponent.enableImageCollisions === true) {\n\t\t\t\t\t\tthis.updateImageScreenBBoxes(meshComponent);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tupdateImageScreenBBoxes(meshComponent: MeshComponent | ImageComponent) {\n\t\tif (meshComponent.imageMesh == null) return;\n\t\t// let's project the bounding box onto the screen and store as polygon\n\t\tconst bbox = meshComponent.imageMesh.geometry.boundingBox;\n\t\tif (bbox != null) {\n\t\t\tconst worldPosition = new Vector3();\n\t\t\tmeshComponent.imageMesh.getWorldPosition(worldPosition);\n\t\t\t// cheap check to see if the image is in the camera frustum\n\t\t\tif (!this.cameraFrustum.containsPoint(worldPosition)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst centerScreen = new Vector2();\n\t\t\tthis.projectToScreen(centerScreen, worldPosition);\n\n\t\t\t// Get all 8 corners of the bounding box in local space\n\t\t\tconst corners = [\n\t\t\t\tnew Vector3(bbox.min.x, bbox.min.y, bbox.min.z),\n\t\t\t\tnew Vector3(bbox.max.x, bbox.min.y, bbox.min.z),\n\t\t\t\tnew Vector3(bbox.min.x, bbox.max.y, bbox.min.z),\n\t\t\t\tnew Vector3(bbox.max.x, bbox.max.y, bbox.min.z),\n\t\t\t\tnew Vector3(bbox.min.x, bbox.min.y, bbox.max.z),\n\t\t\t\tnew Vector3(bbox.max.x, bbox.min.y, bbox.max.z),\n\t\t\t\tnew Vector3(bbox.min.x, bbox.max.y, bbox.max.z),\n\t\t\t\tnew Vector3(bbox.max.x, bbox.max.y, bbox.max.z),\n\t\t\t];\n\n\t\t\t// Transform all corners to world space and project to screen\n\t\t\tconst screenCorners: Vector2[] = [];\n\t\t\tfor (const corner of corners) {\n\t\t\t\tconst worldCorner = corner.clone().applyMatrix4(meshComponent.imageMesh.matrixWorld);\n\t\t\t\tconst screenCorner = new Vector2();\n\t\t\t\tthis.projectToScreen(screenCorner, worldCorner);\n\t\t\t\tscreenCorners.push(screenCorner);\n\t\t\t}\n\n\t\t\t// Find the actual screen bounds by taking min/max of all projected corners\n\t\t\tlet minX = Infinity;\n\t\t\tlet minY = Infinity;\n\t\t\tlet maxX = -Infinity;\n\t\t\tlet maxY = -Infinity;\n\t\t\tfor (const screenCorner of screenCorners) {\n\t\t\t\tminX = Math.min(minX, screenCorner.x);\n\t\t\t\tminY = Math.min(minY, screenCorner.y);\n\t\t\t\tmaxX = Math.max(maxX, screenCorner.x);\n\t\t\t\tmaxY = Math.max(maxY, screenCorner.y);\n\t\t\t}\n\n\t\t\tconst rectangle = new QuadTreeRectangle(centerScreen.x, centerScreen.y, maxX - minX, maxY - minY);\n\t\t\tthis.currentImageScreenBBoxes.push(rectangle);\n\t\t}\n\t}\n}\n", "import type { LineSegments, PlaneGeometry, MeshLambertMaterial } from 'three';\nimport { Vector3, Mesh } from 'three';\nimport type { Position } from '../types';\nimport type { Feature, Point } from 'geojson';\nimport { Geometry3DObject3D } from '../entities/geometry3d';\nimport { geoJSONPoint } from '../utils/schema-validation';\nimport { z } from 'zod';\n\nexport class EntityMesh extends Mesh {\n\tuserData: {\n\t\tentityId: string | number;\n\t} = {\n\t\tentityId: '',\n\t};\n}\n\nexport type ImageStyle = {\n\t/**\n\t * Attempt to keep the image facing the camera as much as possible\n\t */\n\tflipImageToFaceCamera?: boolean;\n\t/**\n\t * url of the image\n\t */\n\turl: string;\n};\n\nexport type ImageProperties = {\n\twidth: number;\n\theight: number;\n\trotation?: number;\n\tverticalOffset?: number;\n};\n\nexport const addImageFeatureStyleSchema = z.object({\n\tflipImageToFaceCamera: z.boolean().optional(), // Optional boolean\n\turl: z.string(), // Required string\n});\n\nexport const addImageFeatureSchema = z.object({\n\ttype: z.enum(['Feature']), // Required enum with 'Feature'\n\tproperties: z.object({\n\t\twidth: z.number(), // Required number\n\t\theight: z.number(), // Required number\n\t\trotation: z.number().min(0).max(360).optional(), // Optional number with min and max\n\t\tverticalOffset: z.number().optional(), // Optional number\n\t}),\n\tgeometry: geoJSONPoint, // Assuming geoJSONPoint would be another Zod schema for validation\n});\n\nexport function validateImage(id: string | number, feature: Feature<Point, ImageProperties>, style: ImageStyle) {\n\tz.union([z.number(), z.string()]).parse(id);\n\taddImageFeatureSchema.parse(feature);\n\taddImageFeatureStyleSchema.parse(style);\n}\n\n/**\n * State representing an Image\n */\nexport type ImageState = {\n\treadonly id: string | number;\n\treadonly type: 'image';\n\t/**\n\t * The position of the image in [lon, lat]\n\t */\n\treadonly position: Position;\n\t/**\n\t * The offset of the image in the z direction\n\t */\n\treadonly verticalOffset: number;\n\t/**\n\t * Whether the image is visible\n\t */\n\tvisible: boolean;\n\twidth: number;\n\theight: number;\n\trotation: number;\n\t/**\n\t * Attempt to keep the image facing the camera as much as possible\n\t */\n\tflipImageToFaceCamera: boolean;\n\t/**\n\t * The opacity of the image\n\t */\n\topacity: number;\n};\n\nexport class ImageComponent {\n\t// Pointer to mesh for this component, which is either the mesh itself or a merged geometry mesh\n\t// if this component was optimized\n\tmesh = new Geometry3DObject3D();\n\timageMesh?: EntityMesh;\n\n\t// Pointer to outline mesh for this component, again, either the outline mesh itself or a merged geometry mesh\n\toutline?: LineSegments;\n\n\treadonly type = 'image';\n\n\tinstanceIndex = -1;\n\tgeometry?: PlaneGeometry;\n\tmaterial?: MeshLambertMaterial;\n\tfeature: Feature<Point, ImageProperties>;\n\n\tconstructor(feature: Feature<Point, ImageProperties>) {\n\t\tthis.feature = feature;\n\t}\n\n\tget visible() {\n\t\treturn this.mesh?.visible ?? false;\n\t}\n\n\tset visible(visible: boolean) {\n\t\tif (this.mesh) {\n\t\t\tthis.mesh.visible = visible;\n\t\t}\n\t}\n\n\tposition = new Vector3();\n}\n", "import { toRadians } from '../../../packages/common/utils';\n\nexport interface Point {\n\tx: number;\n\ty: number;\n}\n\nexport interface Rectangle {\n\tcenter: Point;\n\twidth: number;\n\theight: number;\n\trotation: number;\n\tpolygonCenter?: Point;\n}\n\n/**\n * Rotates a point around the origin by the given angle in radians\n */\nexport function rotatePoint(point: Point, angleRad: number): Point {\n\treturn {\n\t\tx: point.x * Math.cos(angleRad) - point.y * Math.sin(angleRad),\n\t\ty: point.x * Math.sin(angleRad) + point.y * Math.cos(angleRad),\n\t};\n}\n\n/**\n * Rotates all points in an array by the given angle in radians\n */\nexport function rotatePoints(points: Point[], angleRad: number): Point[] {\n\treturn points.map(p => rotatePoint(p, angleRad));\n}\n\n/**\n * Calculates the bounding box of an array of points\n */\nexport function getBounds(points: Point[]) {\n\tlet minX = Infinity;\n\tlet minY = Infinity;\n\tlet maxX = -Infinity;\n\tlet maxY = -Infinity;\n\tfor (const p of points) {\n\t\tminX = Math.min(minX, p.x);\n\t\tminY = Math.min(minY, p.y);\n\t\tmaxX = Math.max(maxX, p.x);\n\t\tmaxY = Math.max(maxY, p.y);\n\t}\n\n\treturn { minX, minY, maxX, maxY };\n}\n\n/**\n * Checks if a point is inside a polygon using ray casting algorithm\n */\nexport function pointInPolygon(point: Point, polygon: Point[]): boolean {\n\tlet inside = false;\n\tfor (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {\n\t\tconst xi = polygon[i].x;\n\t\tconst yi = polygon[i].y;\n\t\tconst xj = polygon[j].x;\n\t\tconst yj = polygon[j].y;\n\n\t\tconst intersect = yi > point.y !== yj > point.y && point.x < ((xj - xi) * (point.y - yi)) / (yj - yi) + xi;\n\t\tif (intersect) inside = !inside;\n\t}\n\n\treturn inside;\n}\n\n/**\n * Checks if a rectangle of the given dimensions is valid within the grid\n */\nexport function isValidRectangle(grid: number[][], x: number, y: number, width: number, height: number): boolean {\n\tfor (let dy = 0; dy < height; dy++) {\n\t\tfor (let dx = 0; dx < width; dx++) {\n\t\t\tif (grid[y + dy][x + dx] !== 1) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn true;\n}\n\n/**\n * Calculates grid dimensions that maintain a specific aspect ratio\n */\nexport function calculateGridDimensions(bounds: ReturnType<typeof getBounds>, aspectRatio: number, gridSize: number) {\n\tconst boxWidth = bounds.maxX - bounds.minX;\n\tconst boxHeight = bounds.maxY - bounds.minY;\n\n\tlet dx: number;\n\tlet dy: number;\n\tlet gridBounds = { ...bounds };\n\n\tif (boxWidth / boxHeight > aspectRatio) {\n\t\t// Box is wider than needed\n\t\tdy = boxHeight / gridSize;\n\t\tdx = dy * aspectRatio;\n\t\t// Center the grid horizontally\n\t\tgridBounds.minX += (boxWidth - dx * gridSize) / 2;\n\t} else {\n\t\t// Box is taller than needed\n\t\tdx = boxWidth / gridSize;\n\t\tdy = dx / aspectRatio;\n\t\t// Center the grid vertically\n\t\tgridBounds.minY += (boxHeight - dy * gridSize) / 2;\n\t}\n\n\treturn { dx, dy, gridBounds };\n}\n\n/**\n * Creates a grid and marks points inside the polygon\n */\nexport function createAndFillGrid(\n\trotatedPoints: Point[],\n\tbounds: ReturnType<typeof getBounds>,\n\tgridSize: number,\n\tdx: number,\n\tdy: number,\n): number[][] {\n\tconst grid = Array(gridSize)\n\t\t.fill(0)\n\t\t.map(() => Array(gridSize).fill(0));\n\n\tfor (let y = 0; y < gridSize; y++) {\n\t\tfor (let x = 0; x < gridSize; x++) {\n\t\t\tconst testPoint = { x: bounds.minX + x * dx, y: bounds.minY + y * dy };\n\t\t\tif (pointInPolygon(testPoint, rotatedPoints)) {\n\t\t\t\tgrid[y][x] = 1;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn grid;\n}\n\n/**\n * Calculates the maximum rectangle size possible at each grid point\n */\nexport function calculateRectSizes(grid: number[][], gridSize: number): number[][] {\n\tconst rectSizes = Array(gridSize)\n\t\t.fill(0)\n\t\t.map(() => Array(gridSize).fill(0));\n\n\tfor (let y = 0; y < gridSize; y++) {\n\t\tfor (let x = 0; x < gridSize; x++) {\n\t\t\tif (grid[y][x] === 1) {\n\t\t\t\t// Find largest rectangle containing this point\n\t\t\t\tlet maxSize = 0;\n\t\t\t\tfor (let size = 1; size <= Math.min(gridSize - x, gridSize - y); size++) {\n\t\t\t\t\tif (!isValidRectangle(grid, x, y, size, size)) break;\n\t\t\t\t\tmaxSize = size;\n\t\t\t\t}\n\t\t\t\trectSizes[y][x] = maxSize;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn rectSizes;\n}\n\n/**\n * Calculates the weighted center of the polygon\n */\nexport function calculatePolygonCenter(\n\tgrid: number[][],\n\trectSizes: number[][],\n\tbounds: ReturnType<typeof getBounds>,\n\tgridSize: number,\n\tdx: number,\n\tdy: number,\n): Point {\n\tlet totalWeight = 0;\n\tlet weightedSumX = 0;\n\tlet weightedSumY = 0;\n\n\tfor (let y = 0; y < gridSize; y++) {\n\t\tfor (let x = 0; x < gridSize; x++) {\n\t\t\tif (grid[y][x] === 1) {\n\t\t\t\tconst weight = Math.pow(rectSizes[y][x], 2); // Square the size for more emphasis on larger areas\n\t\t\t\tconst px = bounds.minX + x * dx;\n\t\t\t\tconst py = bounds.minY + y * dy;\n\n\t\t\t\ttotalWeight += weight;\n\t\t\t\tweightedSumX += px * weight;\n\t\t\t\tweightedSumY += py * weight;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn { x: weightedSumX / totalWeight, y: weightedSumY / totalWeight };\n}\n\n/**\n * Finds the best rectangle based on area and center proximity\n */\nexport function findBestRectangle(\n\tgrid: number[][],\n\tgridBounds: ReturnType<typeof getBounds>,\n\tdx: number,\n\tdy: number,\n\tpolygonCenter: Point,\n\tcenterWeight: number,\n\tbuffer: number,\n): Omit<Rectangle, 'rotation'> | null {\n\tlet maxScore = -Infinity;\n\tlet bestRect: Omit<Rectangle, 'rotation'> | null = null;\n\n\tconst gridSize = grid.length;\n\n\t// Calculate maximum possible distance for normalization\n\tconst maxDistance = Math.sqrt(\n\t\tMath.pow(gridBounds.maxX - gridBounds.minX, 2) + Math.pow(gridBounds.maxY - gridBounds.minY, 2),\n\t);\n\n\tfor (let y = 0; y < gridSize; y++) {\n\t\tfor (let x = 0; x < gridSize; x++) {\n\t\t\tif (grid[y][x] === 1) {\n\t\t\t\tfor (let w = 1; w <= gridSize - x; w++) {\n\t\t\t\t\tconst h = w; // Height will maintain aspect ratio due to dx/dy scaling\n\t\t\t\t\tif (h > gridSize - y) continue;\n\n\t\t\t\t\tif (isValidRectangle(grid, x, y, w, h)) {\n\t\t\t\t\t\tconst area = w * h;\n\t\t\t\t\t\tconst centerX = gridBounds.minX + (x + w / 2) * dx;\n\t\t\t\t\t\tconst centerY = gridBounds.minY + (y + h / 2) * dy;\n\t\t\t\t\t\tconst centerPoint = { x: centerX, y: centerY };\n\n\t\t\t\t\t\t// Calculate distance from polygon center\n\t\t\t\t\t\tconst distanceFromCenter = Math.sqrt(\n\t\t\t\t\t\t\tMath.pow(centerPoint.x - polygonCenter.x, 2) + Math.pow(centerPoint.y - polygonCenter.y, 2),\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\t// Normalize distance (0 to 1)\n\t\t\t\t\t\tconst normalizedDistance = distanceFromCenter / maxDistance;\n\n\t\t\t\t\t\t// Keep the original scoring formula that worked well for rectangular shapes\n\t\t\t\t\t\tconst score = area * (1 - centerWeight) - normalizedDistance * centerWeight * area;\n\n\t\t\t\t\t\tif (score > maxScore) {\n\t\t\t\t\t\t\tmaxScore = score;\n\n\t\t\t\t\t\t\tbestRect = {\n\t\t\t\t\t\t\t\tcenter: centerPoint,\n\t\t\t\t\t\t\t\twidth: w * dx * buffer,\n\t\t\t\t\t\t\t\theight: w * dy * buffer,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn bestRect;\n}\n\n/**\n * Finds the largest interior rectangle within a polygon that maintains a given aspect ratio,\n * with a preference for more centered positions.\n */\nexport function findLargestInteriorRectangle(\n\toriginalRect: Rectangle,\n\tpoints: Point[],\n\tpreferredRotation: number,\n\toptions: {\n\t\tscaleFactor?: number;\n\t\tcenterPriority?: number;\n\t\tresolution?: number;\n\t\tminimumSizeRatio?: number;\n\t} = {},\n): Rectangle & { polygonCenter?: Point } {\n\tconst { scaleFactor = 0.9, centerPriority = 0.5, resolution = 100, minimumSizeRatio = 0.5 } = options;\n\n\tconst rotationRad = toRadians(preferredRotation);\n\tconst aspectRatio = originalRect.width / originalRect.height;\n\n\t// Rotate points\n\tconst rotatedPoints = rotatePoints(points, rotationRad);\n\n\t// Find bounding box\n\tconst bounds = getBounds(rotatedPoints);\n\n\t// Calculate grid dimensions maintaining aspect ratio\n\tconst { dx, dy, gridBounds } = calculateGridDimensions(bounds, aspectRatio, resolution);\n\n\t// Create and fill the grid\n\tconst grid = createAndFillGrid(rotatedPoints, gridBounds, resolution, dx, dy);\n\n\t// Calculate maximum rectangle sizes at each point\n\tconst rectSizes = calculateRectSizes(grid, resolution);\n\n\t// Calculate the weighted center of the polygon\n\tconst polygonCenter = calculatePolygonCenter(grid, rectSizes, gridBounds, resolution, dx, dy);\n\n\t// Find the best rectangle\n\tconst bestRect = findBestRectangle(grid, gridBounds, dx, dy, polygonCenter, centerPriority, scaleFactor);\n\n\t// Check if the calculated rectangle is too small compared to what could fit\n\tif (\n\t\t!bestRect ||\n\t\tbestRect.width < originalRect.width * minimumSizeRatio ||\n\t\tbestRect.height < originalRect.height * minimumSizeRatio\n\t) {\n\t\treturn originalRect;\n\t}\n\n\treturn {\n\t\t...bestRect,\n\t\tcenter: rotatePoint(bestRect.center, -rotationRad),\n\t\trotation: preferredRotation,\n\t\tpolygonCenter: rotatePoint(polygonCenter, -rotationRad),\n\t};\n}\n", "import { PubSub } from '@packages/internal/common';\nimport type { All3DTypes, RendererState } from '../../renderer';\nimport { MeshComponent } from '../../components/mesh';\nimport { Geometry3DComponents } from '../../entities';\nimport { Box3, BoxGeometry, Mesh, MeshBasicMaterial, type PerspectiveCamera, Raycaster, Vector2 } from 'three';\nimport { GroupContainerComponents } from '../../entities/group-container';\nimport { FocusableComponent } from '../../components/focusable';\nimport { destroyObject3D } from '../../utils/object3d-destroy';\n\n/**\n * This is the window after a camera move where geometry-in-focus can be updated. After this window, we assume\n * the camera has settled, and further renders will not change geometry-in-focus until the next camera move.\n * Otherwise, every render will update geometry-in-focus, even if the camera is not moving, and re-trigger\n * dynamic focus on the current floor stack.\n */\nconst CAMERA_MOVE_BUFFER_THRESHOLD_MS = 250;\n\nexport class GeometryInFocusSystem extends PubSub<{\n\t/**\n\t * Returns the list of entities that are likely in focus, sorted by the weight of the raycast.\n\t */\n\t'geometry-in-focus': string[];\n}> {\n\tcameraDirty = true;\n\tfocusablesDirty = true;\n\tprivate state: RendererState;\n\tprivate camera: PerspectiveCamera;\n\tprivate debugEl: HTMLElement | null = null;\n\tprivate raycasters: [Raycaster, cameraCoordinate: Vector2, weight: number][] = [];\n\tprivate collisions: Map<string, number> = new Map();\n\tprivate focusableEntities: Set<Mesh> = new Set();\n\tprivate debugRaycasters = false;\n\n\tconstructor(state: RendererState, camera: PerspectiveCamera) {\n\t\tsuper();\n\t\tthis.state = state;\n\t\tthis.camera = camera;\n\t\tthis.buildRaycasters();\n\t}\n\n\tresize() {\n\t\tthis.buildRaycasters();\n\t}\n\n\t/**\n\t * Build 5 raycasters, one for the center of the screen, and one for each corner of the screen.\n\t * the center one has the highest weight, and the corners have the lowest weight.\n\t * this allows us to detect focus closer to the center of the screen more easily.\n\t */\n\tprivate buildRaycasters() {\n\t\tif (this.debugEl) {\n\t\t\tthis.debugEl.remove();\n\t\t}\n\t\tconst center = new Vector2(this.state.canvasWidth / 2, this.state.canvasHeight / 2);\n\t\tconst topLeft = new Vector2(center.x / 1.2, center.y / 1.2);\n\t\tconst topRight = new Vector2(center.x + (center.x - topLeft.x), topLeft.y);\n\t\tconst bottomLeft = new Vector2(topLeft.x, center.y + (center.y - topLeft.y));\n\t\tconst bottomRight = new Vector2(topRight.x, bottomLeft.y);\n\t\tconst centerTop = new Vector2(center.x, center.y / 1.5);\n\t\tconst centerBottom = new Vector2(center.x, center.y + (center.y - centerTop.y));\n\n\t\tthis.debugEl = document.createElement('div');\n\t\tObject.assign(this.debugEl.style, {\n\t\t\tposition: 'absolute',\n\t\t\ttop: '0',\n\t\t\tleft: '0',\n\t\t\twidth: '100%',\n\t\t\theight: '100%',\n\t\t\tpointerEvents: 'none',\n\t\t});\n\t\tdocument.body.append(this.debugEl);\n\n\t\tthis.raycasters = [center, centerTop, centerBottom, topLeft, topRight, bottomLeft, bottomRight].map(\n\t\t\t(coordXY, idx) => {\n\t\t\t\tif (this.debugRaycasters) {\n\t\t\t\t\tconst el = document.createElement('div');\n\t\t\t\t\tel.style.position = 'absolute';\n\t\t\t\t\tel.style.top = coordXY.y + 'px';\n\t\t\t\t\tel.style.left = coordXY.x + 'px';\n\t\t\t\t\tel.style.width = '10px';\n\t\t\t\t\tel.style.height = '10px';\n\t\t\t\t\tel.style.backgroundColor = 'red';\n\t\t\t\t\tthis.debugEl!.append(el);\n\t\t\t\t}\n\n\t\t\t\tconst _x = (coordXY.x / this.state.canvasWidth) * 2 - 1;\n\t\t\t\tconst _y = -(coordXY.y / this.state.canvasHeight) * 2 + 1;\n\t\t\t\tconst coordinateVector = new Vector2(_x, _y);\n\t\t\t\tconst raycaster = new Raycaster();\n\t\t\t\traycaster.setFromCamera(coordinateVector, this.camera);\n\n\t\t\t\treturn [raycaster, coordinateVector, idx === 0 ? 10 : idx < 7 ? 2 : 1];\n\t\t\t},\n\t\t);\n\t}\n\n\tprivate updateFocusableEntities() {\n\t\tthis.focusableEntities.clear();\n\t\tlet meshComponent: All3DTypes['components'][Geometry3DComponents.Mesh];\n\t\tlet focusableComponent: All3DTypes['components'][Geometry3DComponents.Focusable];\n\t\tlet entity: All3DTypes | undefined;\n\t\tfor (const entityId of this.state.geometry3DIdsInScene) {\n\t\t\tentity = this.state.geometry3DMap.get(entityId);\n\t\t\tif (entity == null) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (\n\t\t\t\tentity.type === 'group-container' &&\n\t\t\t\tentity.components[GroupContainerComponents.Focusable] !== undefined &&\n\t\t\t\tentity.components[GroupContainerComponents.Focusable] instanceof FocusableComponent\n\t\t\t) {\n\t\t\t\tfocusableComponent = entity.components[GroupContainerComponents.Focusable];\n\t\t\t\tif (focusableComponent.dirty === true || focusableComponent.focusMesh == null) {\n\t\t\t\t\t// For group containers that are focusable let's create a mesh of the bounding box\n\n\t\t\t\t\tif (focusableComponent.focusMesh) {\n\t\t\t\t\t\t// destroy the focusMesh\n\t\t\t\t\t\tdestroyObject3D(focusableComponent.focusMesh);\n\t\t\t\t\t}\n\t\t\t\t\tconst box = new Box3();\n\n\t\t\t\t\tbox.setFromObject(entity);\n\n\t\t\t\t\t// Validate bounding box dimensions\n\t\t\t\t\tconst width = box.max.x - box.min.x;\n\t\t\t\t\tconst height = box.max.y - box.min.y;\n\t\t\t\t\tconst depth = box.max.z - box.min.z;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\t!isFinite(width) ||\n\t\t\t\t\t\t!isFinite(height) ||\n\t\t\t\t\t\t!isFinite(depth) ||\n\t\t\t\t\t\tisNaN(width) ||\n\t\t\t\t\t\tisNaN(height) ||\n\t\t\t\t\t\tisNaN(depth) ||\n\t\t\t\t\t\twidth <= 0 ||\n\t\t\t\t\t\theight <= 0 ||\n\t\t\t\t\t\tdepth <= 0\n\t\t\t\t\t) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst geometry = new BoxGeometry(width, height, depth);\n\t\t\t\t\tconst matProperties: any = {\n\t\t\t\t\t\ttransparent: true,\n\t\t\t\t\t\topacity: this.debugRaycasters ? 1 : 0,\n\t\t\t\t\t\tvisible: this.debugRaycasters,\n\t\t\t\t\t};\n\t\t\t\t\tif (this.debugRaycasters) {\n\t\t\t\t\t\tconst colors = ['red', 'green', 'blue', 'yellow', 'purple', 'orange', 'pink', 'brown', 'gray', 'black'];\n\t\t\t\t\t\tmatProperties.color = colors[Math.floor(Math.random() * colors.length)];\n\t\t\t\t\t}\n\t\t\t\t\tconst material = new MeshBasicMaterial(matProperties);\n\t\t\t\t\tconst focusMesh = new Mesh(geometry, material);\n\t\t\t\t\tfocusMesh.position.set((box.min.x + box.max.x) / 2, (box.min.y + box.max.y) / 2, 0);\n\t\t\t\t\tfocusMesh.userData = {\n\t\t\t\t\t\tentityId: entity.userData.entityId,\n\t\t\t\t\t};\n\t\t\t\t\tfocusableComponent.focusMesh = focusMesh;\n\t\t\t\t\tentity.add(focusMesh);\n\t\t\t\t\tentity.components[GroupContainerComponents.Focusable].dirty = false;\n\t\t\t\t}\n\t\t\t\tthis.focusableEntities.add(focusableComponent.focusMesh);\n\t\t\t} else if (\n\t\t\t\tentity.type === 'geometry' &&\n\t\t\t\tentity.components[Geometry3DComponents.Focusable] &&\n\t\t\t\tentity.components[Geometry3DComponents.Focusable] instanceof FocusableComponent\n\t\t\t) {\n\t\t\t\tmeshComponent = entity.components[Geometry3DComponents.Mesh];\n\t\t\t\tfocusableComponent = entity.components[Geometry3DComponents.Focusable];\n\t\t\t\tif (\n\t\t\t\t\tmeshComponent instanceof MeshComponent &&\n\t\t\t\t\tmeshComponent.geometry != null &&\n\t\t\t\t\t(focusableComponent.dirty === true || focusableComponent.focusMesh == null)\n\t\t\t\t) {\n\t\t\t\t\t// batched geometry behaves differently than regular geometry, and we are not able to raycast against it when it's invisible, which causes issues for dynamic focus\n\t\t\t\t\t// so let's create a focus mesh that can be used for focus detection\n\t\t\t\t\tif (focusableComponent.focusMesh == null) {\n\t\t\t\t\t\tconst focusMesh = new Mesh(meshComponent.geometry);\n\t\t\t\t\t\tfocusMesh.userData = {\n\t\t\t\t\t\t\tentityId: entity.id,\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfocusableComponent.focusMesh = focusMesh;\n\t\t\t\t\t}\n\t\t\t\t\tthis.focusableEntities.add(focusableComponent.focusMesh);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.focusablesDirty = false;\n\t}\n\n\t#animationFrame?: number = undefined;\n\n\tupdate = (cameraIsMoving = false, cameraStoppedMovingTime = Date.now()) => {\n\t\tif (this.focusablesDirty) {\n\t\t\tthis.updateFocusableEntities();\n\t\t}\n\n\t\tif (cameraIsMoving) return;\n\n\t\tif (Date.now() - cameraStoppedMovingTime > CAMERA_MOVE_BUFFER_THRESHOLD_MS) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#animationFrame) {\n\t\t\tcancelAnimationFrame(this.#animationFrame);\n\t\t}\n\n\t\tthis.#animationFrame = requestAnimationFrame(() => {\n\t\t\tthis.updateRaf();\n\t\t});\n\t};\n\n\tupdateRaf() {\n\t\tif (this.focusableEntities.size === 0) {\n\t\t\tthis.publish('geometry-in-focus', []);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.cameraDirty) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.raycast();\n\t}\n\n\traycast() {\n\t\tthis.collisions.clear();\n\n\t\tfor (const [raycaster, coordinateVector] of this.raycasters) {\n\t\t\traycaster.setFromCamera(coordinateVector, this.camera);\n\t\t}\n\n\t\t// raycast against all focusable entities, and accumulate the weight of each raycast per entity\n\t\tfor (const [raycaster, _, weight] of this.raycasters) {\n\t\t\tconst cols = raycaster.intersectObjects(Array.from(this.focusableEntities.values()));\n\t\t\tcols.forEach(collision => {\n\t\t\t\tif (collision?.object != null && 'isMesh' in collision.object && collision?.object.isMesh) {\n\t\t\t\t\tconst entityId = collision.object.userData.entityId;\n\t\t\t\t\tconst currentWeight = this.collisions.get(entityId) ?? 0;\n\t\t\t\t\tthis.collisions.set(entityId, currentWeight + weight);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// sort the entities by weight, the most likely to be in focus is first\n\t\tconst sortedEntities = Array.from(this.collisions, ([entityId, weight]) => ({ entityId, weight }))\n\t\t\t.sort((a, b) => b.weight - a.weight)\n\t\t\t.map(({ entityId }) => entityId);\n\n\t\tthis.publish('geometry-in-focus', sortedEntities);\n\n\t\tthis.cameraDirty = false;\n\t}\n\n\tshowRaycasters() {\n\t\tthis.debugRaycasters = true;\n\t\tthis.buildRaycasters();\n\t}\n\n\thideRaycasters() {\n\t\tthis.debugRaycasters = false;\n\t\tthis.buildRaycasters();\n\t}\n\n\tdestroy() {\n\t\tif (this.#animationFrame) {\n\t\t\tcancelAnimationFrame(this.#animationFrame);\n\t\t}\n\t\tif (this.debugEl) {\n\t\t\tthis.debugEl.remove();\n\t\t}\n\t\tthis.collisions.clear();\n\t\tthis.focusableEntities.clear();\n\t\tthis.raycasters = [];\n\t}\n}\n", "import {\n\ttype LegacyFilterSpecification,\n\ttype Map,\n\ttype MapStyleDataEvent,\n\tPoint,\n} from '@packages/internal/outdoor-context-v5';\nimport { type BBox, type Position as GeoJSONPosition } from 'geojson';\nimport { multiPolygon, polygon } from '@turf/helpers';\nimport booleanIntersects from '@turf/boolean-intersects';\nimport { IdleQueue } from '../../utils/idle-queue';\n\n// there's no reliable way to know when maplibre tiles have all come in, so we'll give up after a set amount of time\n// so we stop trying to hide layers after a set amount of time\nconst TRYING_TIMEOUT_MS = 5000;\n\nconst DEBUG_CONTAINER_ID = 'outdoor-system-debug-container';\n\n// Set to true to see the debug container used to query tileset features\nconst DEBUG = false;\n\nexport class OutdoorLayers {\n\t#dirty = true;\n\t#map?: Map;\n\tidleQueue = new IdleQueue();\n\t#stylesheetId = '';\n\t#userHiddenLayers: Set<string> = new Set();\n\t#hiddenLayersInStyle: Set<string> = new Set();\n\t#bbox?: BBox;\n\t#polygons?: GeoJSON.Feature<GeoJSON.Polygon | GeoJSON.MultiPolygon, any>[];\n\t#timer: NodeJS.Timeout | null = null;\n\t#loaded = false;\n\n\t#getScreenPoints = (bbox: BBox): [Point, Point] => {\n\t\tif (!this.#map) {\n\t\t\tthrow new Error('Map not initialized');\n\t\t}\n\n\t\t/**\n\t\t * We want to take the bbox and produce a screen aligned rectangle fully containing the bbox. The bbox will likely\n\t\t * not be aligned to the screen, so we project each corner onto the screen and find the box that fully contains\n\t\t * each corner.\n\t\t */\n\t\tconst bboxPoints: [number, number][] = [\n\t\t\t[bbox[0], bbox[1]],\n\t\t\t[bbox[2], bbox[1]],\n\t\t\t[bbox[2], bbox[3]],\n\t\t\t[bbox[0], bbox[3]],\n\t\t];\n\t\tconst screenPoints = bboxPoints.map(point => this.#map!.project(point));\n\t\tconst maxX = Math.max(...screenPoints.map(p => p.x));\n\t\tconst minX = Math.min(...screenPoints.map(p => p.x));\n\t\tconst maxY = Math.max(...screenPoints.map(p => p.y));\n\t\tconst minY = Math.min(...screenPoints.map(p => p.y));\n\n\t\treturn [new Point(minX, minY), new Point(maxX, maxY)];\n\t};\n\n\t#stopTrying = () => {\n\t\tif (this.#timer) {\n\t\t\tclearTimeout(this.#timer);\n\t\t\tthis.#timer = null;\n\t\t\tthis.#dirty = false;\n\t\t}\n\t};\n\n\t#startTrying = () => {\n\t\tif (this.#timer) {\n\t\t\tclearTimeout(this.#timer);\n\t\t\tthis.#timer = null;\n\t\t}\n\t\tthis.#timer = setTimeout(() => {\n\t\t\tthis.#stopTrying();\n\t\t}, TRYING_TIMEOUT_MS);\n\t};\n\n\thideLayersIntersectingPolygons(\n\t\tbbox: BBox,\n\t\tpolygons: GeoJSON.Feature<GeoJSON.Polygon | GeoJSON.MultiPolygon, any>[],\n\t\tlayers: string[],\n\t) {\n\t\tif (this.#timer) {\n\t\t\tclearTimeout(this.#timer);\n\t\t}\n\t\tthis.#startTrying();\n\n\t\tthis.#bbox = bbox;\n\t\tthis.#polygons = polygons.reduce<GeoJSON.Feature<GeoJSON.Polygon | GeoJSON.MultiPolygon, any>[]>((acc, p) => {\n\t\t\tif (p.geometry.type === 'Polygon') {\n\t\t\t\tconst poly = polygon(p.geometry.coordinates as GeoJSONPosition[][]);\n\t\t\t\tacc.push(poly);\n\t\t\t} else if (p.geometry.type === 'MultiPolygon') {\n\t\t\t\tacc.push(...p.geometry.coordinates.map(c => polygon(c as GeoJSONPosition[][])));\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, []);\n\n\t\tfor (let layerId of layers) {\n\t\t\tthis.#userHiddenLayers.add(layerId);\n\t\t}\n\t\tthis.#dirty = true;\n\t\tthis.#filterStylesInMap();\n\t\tthis.#handleRender();\n\t}\n\n\tconstructor(map?: Map) {\n\t\tif (map) {\n\t\t\tthis.#map = map;\n\t\t\tthis.#map.on('styledata', this.#handleStyleChange);\n\t\t\tthis.#map.on('render', this.#handleRender);\n\t\t\tthis.#loaded = this.#map.loaded();\n\t\t\tthis.#map.on('load', () => {\n\t\t\t\tthis.#loaded = true;\n\t\t\t});\n\t\t}\n\n\t\tif (DEBUG) {\n\t\t\tthis.#addDebugContainer();\n\t\t}\n\t}\n\n\t#filterStylesInMap() {\n\t\tthis.#hiddenLayersInStyle = new Set();\n\t\tif (this.#map) {\n\t\t\tfor (let layerId of this.#userHiddenLayers) {\n\t\t\t\tif (this.#map.getLayer(layerId)) {\n\t\t\t\t\tthis.#hiddenLayersInStyle.add(layerId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#handleRender = async () => {\n\t\tif (DEBUG) {\n\t\t\tif (this.#bbox) {\n\t\t\t\tconst points = this.#getScreenPoints(this.#bbox);\n\t\t\t\tthis.#updateDebugBBox(points);\n\t\t\t}\n\t\t}\n\n\t\tif (!this.#map || !this.#loaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#dirty) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#hiddenLayersInStyle || this.#hiddenLayersInStyle.size === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#running) {\n\t\t\tthis.#cancelJobs();\n\t\t}\n\n\t\tif (this.#bbox && this.#polygons) {\n\t\t\tconst points = this.#getScreenPoints(this.#bbox);\n\t\t\tconst features = this.#map.queryRenderedFeatures(points, {\n\t\t\t\tlayers: Array.from(this.#hiddenLayersInStyle),\n\t\t\t});\n\n\t\t\t// TODO: one issue remaning where a second render will trigger a second set of jobs,\n\t\t\t// some of which were already processed. Wish we had a more predictable way to know when all tiles are loaded.\n\t\t\t// I won't blow up this PR with this, but it's a TODO to fix.\n\t\t\tif (features.length > 0) {\n\t\t\t\t/**\n\t\t\t\t * First, push the final job that will run. This job consumes the current filter expression and updates\n\t\t\t\t * the layer filters. This job must run last, because it will override any previously set filters.\n\t\t\t\t */\n\t\t\t\tthis.idleQueue.onComplete(() => {\n\t\t\t\t\tif (this.#expr.length > 0) {\n\t\t\t\t\t\tthis.#hiddenLayersInStyle.forEach(layer => {\n\t\t\t\t\t\t\tthis.#map?.setFilter(layer, ['all', ...this.#expr]);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.#dirty = false;\n\t\t\t\t\t}\n\t\t\t\t\tthis.#expr = [];\n\t\t\t\t});\n\n\t\t\t\tfor (const feature of features) {\n\t\t\t\t\tthis.idleQueue.add(() => {\n\t\t\t\t\t\tif (feature.geometry != null && 'coordinates' in feature.geometry) {\n\t\t\t\t\t\t\tif (this.#polygons == null) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tlet poly: GeoJSON.Feature<GeoJSON.Polygon | GeoJSON.MultiPolygon, any> | undefined;\n\n\t\t\t\t\t\t\tif (feature.geometry.type === 'Polygon') {\n\t\t\t\t\t\t\t\tpoly = polygon(feature.geometry.coordinates);\n\t\t\t\t\t\t\t} else if (feature.geometry.type === 'MultiPolygon') {\n\t\t\t\t\t\t\t\tpoly = multiPolygon(feature.geometry.coordinates);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (!poly) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfor (const p of this.#polygons) {\n\t\t\t\t\t\t\t\tconst intersection = booleanIntersects(p, poly);\n\n\t\t\t\t\t\t\t\tif (intersection) {\n\t\t\t\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\t\t\t\tthis.#expr.push(['!=', ['id'], feature.id] as LegacyFilterSpecification);\n\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t#expr: LegacyFilterSpecification[] = [];\n\n\tget #running() {\n\t\treturn this.idleQueue.size !== 0;\n\t}\n\n\t#cancelJobs = () => {\n\t\tthis.idleQueue.clearAll();\n\t};\n\n\t#handleStyleChange = (e: MapStyleDataEvent) => {\n\t\tif (this.#map && e && e.dataType === 'style' && e.type === 'styledata' && this.#userHiddenLayers.size > 0) {\n\t\t\t// @ts-ignore - e.style.stylesheet does not exist in the type\n\t\t\t// if we can find the id we'll use it, otherwise assume it has changed\n\t\t\tconst newStylesheetId = e?.style?.stylesheet?.id;\n\t\t\tif (!newStylesheetId || newStylesheetId !== this.#stylesheetId) {\n\t\t\t\tthis.#stylesheetId = newStylesheetId;\n\t\t\t\tthis.#filterStylesInMap();\n\t\t\t\tthis.#dirty = true;\n\t\t\t}\n\t\t}\n\t};\n\n\t#addDebugContainer() {\n\t\tif (document.getElementById(DEBUG_CONTAINER_ID)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#map) {\n\t\t\tconst container = document.createElement('div');\n\t\t\tcontainer.id = DEBUG_CONTAINER_ID;\n\t\t\tcontainer.style.position = 'absolute';\n\t\t\tcontainer.style.top = '0';\n\t\t\tcontainer.style.left = '0';\n\t\t\tcontainer.style.bottom = '0';\n\t\t\tcontainer.style.right = '0';\n\t\t\tcontainer.style.pointerEvents = 'none';\n\t\t\tcontainer.style.zIndex = '1000';\n\t\t\tthis.#map.getContainer().appendChild(container);\n\t\t}\n\t}\n\n\t#updateDebugBBox(bbox: [Point, Point]) {\n\t\tconst container = document.getElementById(DEBUG_CONTAINER_ID);\n\t\tif (!container) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet el = document.getElementById('bbox');\n\t\tif (el == null) {\n\t\t\tel = document.createElement('div');\n\t\t\tel.id = 'bbox';\n\t\t\tel.style.position = 'absolute';\n\t\t\tcontainer.appendChild(el);\n\t\t}\n\n\t\tconst topLeftPoint = [Math.min(bbox[0].x, bbox[1].x), Math.min(bbox[0].y, bbox[1].y)];\n\t\tconst bottomRightPoint = [Math.max(bbox[0].x, bbox[1].x), Math.max(bbox[0].y, bbox[1].y)];\n\n\t\tel.style.top = topLeftPoint[1] + 'px';\n\t\tel.style.left = topLeftPoint[0] + 'px';\n\t\tel.style.width = bottomRightPoint[0] - topLeftPoint[0] + 'px';\n\t\tel.style.height = bottomRightPoint[1] - topLeftPoint[1] + 'px';\n\t\tel.style.border = `2px solid ${this.#dirty ? 'red' : 'blue'}`;\n\t}\n\n\tdestroy() {\n\t\tif (this.#map) {\n\t\t\tthis.#map.off('styledata', this.#handleStyleChange);\n\t\t\tthis.#map.off('render', this.#handleRender);\n\t\t}\n\t\tthis.idleQueue.clearAll();\n\t}\n}\n", "import booleanDisjoint from \"@turf/boolean-disjoint\";\nimport { flattenEach } from \"@turf/meta\";\n/**\n * Boolean-intersects returns (TRUE) two geometries intersect.\n *\n * @name booleanIntersects\n * @param {Geometry|Feature<any>} feature1 GeoJSON Feature or Geometry\n * @param {Geometry|Feature<any>} feature2 GeoJSON Feature or Geometry\n * @returns {boolean} true/false\n * @example\n * var point = turf.point([2, 2]);\n * var line = turf.lineString([[1, 1], [1, 2], [1, 3], [1, 4]]);\n *\n * turf.booleanIntersects(line, point);\n * //=true\n */\nexport default function booleanIntersects(feature1, feature2) {\n    var bool = false;\n    flattenEach(feature1, function (flatten1) {\n        flattenEach(feature2, function (flatten2) {\n            if (bool === true) {\n                return true;\n            }\n            bool = !booleanDisjoint(flatten1.geometry, flatten2.geometry);\n        });\n    });\n    return bool;\n}\n", "import booleanPointInPolygon from \"@turf/boolean-point-in-polygon\";\nimport lineIntersect from \"@turf/line-intersect\";\nimport { flattenEach } from \"@turf/meta\";\nimport polygonToLine from \"@turf/polygon-to-line\";\n/**\n * Boolean-disjoint returns (TRUE) if the intersection of the two geometries is an empty set.\n *\n * @name booleanDisjoint\n * @param {Geometry|Feature<any>} feature1 GeoJSON Feature or Geometry\n * @param {Geometry|Feature<any>} feature2 GeoJSON Feature or Geometry\n * @returns {boolean} true/false\n * @example\n * var point = turf.point([2, 2]);\n * var line = turf.lineString([[1, 1], [1, 2], [1, 3], [1, 4]]);\n *\n * turf.booleanDisjoint(line, point);\n * //=true\n */\nfunction booleanDisjoint(feature1, feature2) {\n    var bool = true;\n    flattenEach(feature1, function (flatten1) {\n        flattenEach(feature2, function (flatten2) {\n            if (bool === false) {\n                return false;\n            }\n            bool = disjoint(flatten1.geometry, flatten2.geometry);\n        });\n    });\n    return bool;\n}\n/**\n * Disjoint operation for simple Geometries (Point/LineString/Polygon)\n *\n * @private\n * @param {Geometry<any>} geom1 GeoJSON Geometry\n * @param {Geometry<any>} geom2 GeoJSON Geometry\n * @returns {boolean} true/false\n */\nfunction disjoint(geom1, geom2) {\n    switch (geom1.type) {\n        case \"Point\":\n            switch (geom2.type) {\n                case \"Point\":\n                    return !compareCoords(geom1.coordinates, geom2.coordinates);\n                case \"LineString\":\n                    return !isPointOnLine(geom2, geom1);\n                case \"Polygon\":\n                    return !booleanPointInPolygon(geom1, geom2);\n            }\n            /* istanbul ignore next */\n            break;\n        case \"LineString\":\n            switch (geom2.type) {\n                case \"Point\":\n                    return !isPointOnLine(geom1, geom2);\n                case \"LineString\":\n                    return !isLineOnLine(geom1, geom2);\n                case \"Polygon\":\n                    return !isLineInPoly(geom2, geom1);\n            }\n            /* istanbul ignore next */\n            break;\n        case \"Polygon\":\n            switch (geom2.type) {\n                case \"Point\":\n                    return !booleanPointInPolygon(geom2, geom1);\n                case \"LineString\":\n                    return !isLineInPoly(geom1, geom2);\n                case \"Polygon\":\n                    return !isPolyInPoly(geom2, geom1);\n            }\n    }\n    return false;\n}\n// http://stackoverflow.com/a/11908158/1979085\nfunction isPointOnLine(lineString, pt) {\n    for (var i = 0; i < lineString.coordinates.length - 1; i++) {\n        if (isPointOnLineSegment(lineString.coordinates[i], lineString.coordinates[i + 1], pt.coordinates)) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction isLineOnLine(lineString1, lineString2) {\n    var doLinesIntersect = lineIntersect(lineString1, lineString2);\n    if (doLinesIntersect.features.length > 0) {\n        return true;\n    }\n    return false;\n}\nfunction isLineInPoly(polygon, lineString) {\n    for (var _i = 0, _a = lineString.coordinates; _i < _a.length; _i++) {\n        var coord = _a[_i];\n        if (booleanPointInPolygon(coord, polygon)) {\n            return true;\n        }\n    }\n    var doLinesIntersect = lineIntersect(lineString, polygonToLine(polygon));\n    if (doLinesIntersect.features.length > 0) {\n        return true;\n    }\n    return false;\n}\n/**\n * Is Polygon (geom1) in Polygon (geom2)\n * Only takes into account outer rings\n * See http://stackoverflow.com/a/4833823/1979085\n *\n * @private\n * @param {Geometry|Feature<Polygon>} feature1 Polygon1\n * @param {Geometry|Feature<Polygon>} feature2 Polygon2\n * @returns {boolean} true/false\n */\nfunction isPolyInPoly(feature1, feature2) {\n    for (var _i = 0, _a = feature1.coordinates[0]; _i < _a.length; _i++) {\n        var coord1 = _a[_i];\n        if (booleanPointInPolygon(coord1, feature2)) {\n            return true;\n        }\n    }\n    for (var _b = 0, _c = feature2.coordinates[0]; _b < _c.length; _b++) {\n        var coord2 = _c[_b];\n        if (booleanPointInPolygon(coord2, feature1)) {\n            return true;\n        }\n    }\n    var doLinesIntersect = lineIntersect(polygonToLine(feature1), polygonToLine(feature2));\n    if (doLinesIntersect.features.length > 0) {\n        return true;\n    }\n    return false;\n}\nfunction isPointOnLineSegment(lineSegmentStart, lineSegmentEnd, pt) {\n    var dxc = pt[0] - lineSegmentStart[0];\n    var dyc = pt[1] - lineSegmentStart[1];\n    var dxl = lineSegmentEnd[0] - lineSegmentStart[0];\n    var dyl = lineSegmentEnd[1] - lineSegmentStart[1];\n    var cross = dxc * dyl - dyc * dxl;\n    if (cross !== 0) {\n        return false;\n    }\n    if (Math.abs(dxl) >= Math.abs(dyl)) {\n        if (dxl > 0) {\n            return lineSegmentStart[0] <= pt[0] && pt[0] <= lineSegmentEnd[0];\n        }\n        else {\n            return lineSegmentEnd[0] <= pt[0] && pt[0] <= lineSegmentStart[0];\n        }\n    }\n    else if (dyl > 0) {\n        return lineSegmentStart[1] <= pt[1] && pt[1] <= lineSegmentEnd[1];\n    }\n    else {\n        return lineSegmentEnd[1] <= pt[1] && pt[1] <= lineSegmentStart[1];\n    }\n}\n/**\n * compareCoords\n *\n * @private\n * @param {Position} pair1 point [x,y]\n * @param {Position} pair2 point [x,y]\n * @returns {boolean} true/false if coord pairs match\n */\nfunction compareCoords(pair1, pair2) {\n    return pair1[0] === pair2[0] && pair1[1] === pair2[1];\n}\nexport default booleanDisjoint;\n", "import { featureCollection, lineString, multiLineString } from \"@turf/helpers\";\nimport { getGeom } from \"@turf/invariant\";\n/**\n * Converts a {@link Polygon} to {@link LineString|(Multi)LineString} or {@link MultiPolygon} to a\n * {@link FeatureCollection} of {@link LineString|(Multi)LineString}.\n *\n * @name polygonToLine\n * @param {Feature<Polygon|MultiPolygon>} poly Feature to convert\n * @param {Object} [options={}] Optional parameters\n * @param {Object} [options.properties={}] translates GeoJSON properties to Feature\n * @returns {FeatureCollection|Feature<LineString|MultiLinestring>} converted (Multi)Polygon to (Multi)LineString\n * @example\n * var poly = turf.polygon([[[125, -30], [145, -30], [145, -20], [125, -20], [125, -30]]]);\n *\n * var line = turf.polygonToLine(poly);\n *\n * //addToMap\n * var addToMap = [line];\n */\nexport default function (poly, options) {\n    if (options === void 0) { options = {}; }\n    var geom = getGeom(poly);\n    if (!options.properties && poly.type === \"Feature\") {\n        options.properties = poly.properties;\n    }\n    switch (geom.type) {\n        case \"Polygon\":\n            return polygonToLine(geom, options);\n        case \"MultiPolygon\":\n            return multiPolygonToLine(geom, options);\n        default:\n            throw new Error(\"invalid poly\");\n    }\n}\n/**\n * @private\n */\nexport function polygonToLine(poly, options) {\n    if (options === void 0) { options = {}; }\n    var geom = getGeom(poly);\n    var coords = geom.coordinates;\n    var properties = options.properties\n        ? options.properties\n        : poly.type === \"Feature\"\n            ? poly.properties\n            : {};\n    return coordsToLine(coords, properties);\n}\n/**\n * @private\n */\nexport function multiPolygonToLine(multiPoly, options) {\n    if (options === void 0) { options = {}; }\n    var geom = getGeom(multiPoly);\n    var coords = geom.coordinates;\n    var properties = options.properties\n        ? options.properties\n        : multiPoly.type === \"Feature\"\n            ? multiPoly.properties\n            : {};\n    var lines = [];\n    coords.forEach(function (coord) {\n        lines.push(coordsToLine(coord, properties));\n    });\n    return featureCollection(lines);\n}\n/**\n * @private\n */\nexport function coordsToLine(coords, properties) {\n    if (coords.length > 1) {\n        return multiLineString(coords, properties);\n    }\n    return lineString(coords[0], properties);\n}\n", "export { PathSystem } from './system';\n", "import { Geometry3DComponents } from '../../entities';\nimport type { EntityTypes, RendererState } from '../../renderer';\nimport type { RendererCore } from '../..';\nimport { buildPath } from './utils';\nimport { destroyObject3D } from '../../utils/object3d-destroy';\nimport { getInterpolationBreakpoint, Logger, PubSub } from '@packages/internal/common';\nimport type { ShaderMaterial, Vector3 } from 'three';\nimport type { GroupContainerObject3D } from '../../entities/group-container';\nimport { PathComponent } from '../../components/path';\nimport type { CameraSystem } from '../camera';\nimport { coordinatesEqual } from '../../utils';\n\nconst VERTICAL_THRESHOLD_METERS = 0.5;\n\n/**\n * A system for drawing and controlling the visual state of paths\n */\nexport class PathSystem extends PubSub<{\n\t'animate:path': undefined;\n}> {\n\tprivate rendererState: RendererState;\n\tverticalDistanceDirty = true;\n\n\tconvertTo3DMapPosition: RendererCore['convertTo3DMapPosition'];\n\tgetParentContainer: RendererCore['getParentContainer'];\n\tconvertZoomLevelToAltitude: CameraSystem['convertZoomLevelToAltitude'];\n\tconstructor(\n\t\trendererState: RendererState,\n\t\tconvertTo3DMapPosition: RendererCore['convertTo3DMapPosition'],\n\t\tgetParentContainer: RendererCore['getParentContainer'],\n\t\tconvertZoomLevelToAltitude: CameraSystem['convertZoomLevelToAltitude'],\n\t) {\n\t\tsuper();\n\t\tthis.rendererState = rendererState;\n\t\tthis.convertTo3DMapPosition = convertTo3DMapPosition;\n\t\tthis.getParentContainer = getParentContainer;\n\t\tthis.convertZoomLevelToAltitude = convertZoomLevelToAltitude;\n\t}\n\n\tupdate(minZoomAltitude: number, maxZoomAltitude: number, currentZoomAltitude: number) {\n\t\tlet entity: EntityTypes | undefined;\n\t\tlet shouldAnimate = false;\n\t\t// this is run once per geometry group, to generate an path from geojson points\n\t\tfor (const entityId of this.rendererState.geometry3DIdsInScene) {\n\t\t\tentity = this.rendererState.geometry3DMap.get(entityId);\n\t\t\tif (entity && entity.type === 'path' && entity.components[Geometry3DComponents.Mesh].type === 'path') {\n\t\t\t\tconst component = entity.components[Geometry3DComponents.Mesh];\n\t\t\t\tconst style = entity.components[Geometry3DComponents.Style];\n\t\t\t\tconst componentVerticalDistanceDirty = component.isVertical && this.verticalDistanceDirty;\n\n\t\t\t\tif (!(component instanceof PathComponent)) continue;\n\n\t\t\t\tlet points: Vector3[] = [];\n\n\t\t\t\tif (component.dirty || style.dirty || componentVerticalDistanceDirty) {\n\t\t\t\t\tif (component.mesh.parent != null) {\n\t\t\t\t\t\tfor (let i = component.mesh.children.length - 1; i >= 0; i--) {\n\t\t\t\t\t\t\tdestroyObject3D(component.mesh.children[0]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// vertical paths must have two points with parentIds\n\t\t\t\t\tif (\n\t\t\t\t\t\tcomponent.feature.features.length === 2 &&\n\t\t\t\t\t\tcomponent.feature.features[0].properties.parentId &&\n\t\t\t\t\t\tcomponent.feature.features[1].properties.parentId\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst fromGeoJSONPoint = component.feature.features[0];\n\t\t\t\t\t\tconst toGeoJSONPoint = component.feature.features[component.feature.features.length - 1];\n\t\t\t\t\t\tlet fromParent: GroupContainerObject3D | undefined;\n\t\t\t\t\t\tlet toParent: GroupContainerObject3D | undefined;\n\t\t\t\t\t\tlet fromAltitude = fromGeoJSONPoint.geometry.coordinates[2] || 0;\n\t\t\t\t\t\tlet toAltitude = toGeoJSONPoint.geometry.coordinates[2] || 0;\n\n\t\t\t\t\t\tif (fromGeoJSONPoint.properties.parentId) {\n\t\t\t\t\t\t\tfromParent = this.getParentContainer(\n\t\t\t\t\t\t\t\tfromGeoJSONPoint.properties.parentId,\n\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t) as GroupContainerObject3D;\n\t\t\t\t\t\t\tif (fromParent != null && fromParent.altitude != null) {\n\t\t\t\t\t\t\t\tfromAltitude += fromParent.altitude;\n\t\t\t\t\t\t\t\tcomponent.isVertical = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (toGeoJSONPoint.properties.parentId) {\n\t\t\t\t\t\t\ttoParent = this.getParentContainer(toGeoJSONPoint.properties.parentId, true) as GroupContainerObject3D;\n\t\t\t\t\t\t\tif (toParent != null && toParent.altitude != null) {\n\t\t\t\t\t\t\t\ttoAltitude += toParent.altitude;\n\t\t\t\t\t\t\t\tcomponent.isVertical = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst fromPosition = this.convertTo3DMapPosition(\n\t\t\t\t\t\t\tfromGeoJSONPoint.geometry.coordinates[1],\n\t\t\t\t\t\t\tfromGeoJSONPoint.geometry.coordinates[0],\n\t\t\t\t\t\t\tfromAltitude,\n\t\t\t\t\t\t)!;\n\n\t\t\t\t\t\tconst toPosition = this.convertTo3DMapPosition(\n\t\t\t\t\t\t\ttoGeoJSONPoint.geometry.coordinates[1],\n\t\t\t\t\t\t\ttoGeoJSONPoint.geometry.coordinates[0],\n\t\t\t\t\t\t\ttoAltitude,\n\t\t\t\t\t\t)!;\n\n\t\t\t\t\t\tconst verticalDistance = Math.abs(fromPosition.z - toPosition.z);\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tverticalDistance > VERTICAL_THRESHOLD_METERS &&\n\t\t\t\t\t\t\tfromParent != null &&\n\t\t\t\t\t\t\tfromParent.visible &&\n\t\t\t\t\t\t\ttoParent != null &&\n\t\t\t\t\t\t\ttoParent.visible\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tpoints = [fromPosition, toPosition];\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// otherwise we have a multi-point horizontal path\n\t\t\t\t\t\tconst geojsonPoints = component.feature.features;\n\n\t\t\t\t\t\tfor (let i = 0; i < geojsonPoints.length; i++) {\n\t\t\t\t\t\t\t// skip coordinates that are the same as the previous one\n\t\t\t\t\t\t\t// this can happen in v6-compat when converting from v5 path to v6\n\t\t\t\t\t\t\t// and it will cause the TubeGeometry to implode\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\ti === 0 ||\n\t\t\t\t\t\t\t\t!coordinatesEqual(geojsonPoints[i].geometry.coordinates, geojsonPoints[i - 1].geometry.coordinates)\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tconst convertedPoint = this.convertTo3DMapPosition(\n\t\t\t\t\t\t\t\t\tgeojsonPoints[i].geometry.coordinates[1],\n\t\t\t\t\t\t\t\t\tgeojsonPoints[i].geometry.coordinates[0],\n\t\t\t\t\t\t\t\t\tgeojsonPoints[i].geometry.coordinates[2] || 0,\n\t\t\t\t\t\t\t\t)!;\n\t\t\t\t\t\t\t\tpoints.push(convertedPoint);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (points.length > 1) {\n\t\t\t\t\t\tconst { mesh, material, center } = buildPath(points, component, {\n\t\t\t\t\t\t\tcolor: style.color,\n\t\t\t\t\t\t\taltitude: style.altitude,\n\t\t\t\t\t\t\tisVertical: component.isVertical,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tcomponent.mesh = mesh;\n\t\t\t\t\t\tcomponent.material = material;\n\t\t\t\t\t\tcomponent.position = center;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (component.dirty) {\n\t\t\t\t\t\tif (typeof component.width === 'object' && component.width.on === 'zoom-level') {\n\t\t\t\t\t\t\tcomponent.altitudeBreakpoints = component.width.input.map(zoomLevel =>\n\t\t\t\t\t\t\t\tthis.convertZoomLevelToAltitude(zoomLevel),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcomponent.dirty = false;\n\t\t\t\t}\n\n\t\t\t\tif (style.dirty) {\n\t\t\t\t\tcomponent.mesh.children.forEach(child => {\n\t\t\t\t\t\tif (child.name === 'stencil') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tchild.material.uniforms.color.value.set(style.color);\n\t\t\t\t\t\tchild.material.visible = style.visible;\n\t\t\t\t\t\tchild.material.needsUpdate = true;\n\t\t\t\t\t});\n\t\t\t\t\tcomponent.mesh.position.z = style.altitude;\n\t\t\t\t\tstyle.dirty = false;\n\t\t\t\t}\n\n\t\t\t\tif (component.material) {\n\t\t\t\t\tcomponent.mesh.children.forEach(child => {\n\t\t\t\t\t\tconst uniforms = child.material.uniforms;\n\t\t\t\t\t\tif (child.name === 'stencil') {\n\t\t\t\t\t\t\tif (component.materialDirty) {\n\t\t\t\t\t\t\t\tupdateHighlightPathUniforms(component, child.material);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// these have to happen every frame\n\t\t\t\t\t\tif (typeof component.width === 'object' && component.width.on === 'zoom-level') {\n\t\t\t\t\t\t\tif (component.altitudeBreakpoints && component.altitudeBreakpoints.length > 2) {\n\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t * Ben Liu, 2025-07-17:\n\t\t\t\t\t\t\t\t *\n\t\t\t\t\t\t\t\t * For some reason, adding extra interpolations causes the path with the jump absuptly. I suspect it has\n\t\t\t\t\t\t\t\t * something to do with creating the path geometry with an initial set of breakpoints and then changing the\n\t\t\t\t\t\t\t\t * breakpoints later, but I'm not totally sure.\n\t\t\t\t\t\t\t\t *\n\t\t\t\t\t\t\t\t * For now, I don't think many people will want multiple breakpoints for the path, and we need to change the\n\t\t\t\t\t\t\t\t * API before stabilizing V6, so I'm going to leave this warning.\n\t\t\t\t\t\t\t\t *\n\t\t\t\t\t\t\t\t * TODO: Figure out why this isn't working.\n\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\tLogger.warn(\n\t\t\t\t\t\t\t\t\t`Path width interpolation does not yet support more than 2 breakpoints! This will be added in a future version. Path width will only use the first two breakpoints.`,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst breakpoint = getInterpolationBreakpoint(\n\t\t\t\t\t\t\t\tcurrentZoomAltitude,\n\t\t\t\t\t\t\t\tcomponent.altitudeBreakpoints?.slice(0, 2) ?? [minZoomAltitude, maxZoomAltitude],\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tcomponent.breakpoint = breakpoint;\n\n\t\t\t\t\t\t\tuniforms.nearZoom.value = component.altitudeBreakpoints?.[breakpoint] ?? minZoomAltitude;\n\t\t\t\t\t\t\tuniforms.farZoom.value = component.altitudeBreakpoints?.[breakpoint + 1] ?? maxZoomAltitude;\n\t\t\t\t\t\t\tuniforms.nearRadius.value = Number(component.width.output[breakpoint]) / 2;\n\t\t\t\t\t\t\tuniforms.farRadius.value =\n\t\t\t\t\t\t\t\tNumber(component.width.output[breakpoint + 1] ?? component.width.output[breakpoint]) / 2;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// If the width is static, it only needs to be updated when the state changes\n\t\t\t\t\t\t\t// See below\n\t\t\t\t\t\t}\n\t\t\t\t\t\tuniforms.cameraParameters.value.x = currentZoomAltitude;\n\t\t\t\t\t\t// and these only when we make a change to the path state\n\t\t\t\t\t\tif (component.materialDirty) {\n\t\t\t\t\t\t\tuniforms.displayArrowsOnPath.value = component.displayArrowsOnPath;\n\t\t\t\t\t\t\tuniforms.pulseColor.value.set(component.accentColor);\n\t\t\t\t\t\t\tuniforms.complete.value = component.completeFraction;\n\t\t\t\t\t\t\tupdateHighlightPathUniforms(component, child.material);\n\n\t\t\t\t\t\t\tif (typeof component.width === 'number') {\n\t\t\t\t\t\t\t\tuniforms.nearZoom.value = minZoomAltitude;\n\t\t\t\t\t\t\t\tuniforms.farZoom.value = maxZoomAltitude;\n\t\t\t\t\t\t\t\tuniforms.nearRadius.value = Number(component.width) / 2;\n\t\t\t\t\t\t\t\tuniforms.farRadius.value = Number(component.width) / 2;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// If the width is an interpolation, we potentially need to update the uniforms every frame\n\t\t\t\t\t\t\t\t// See above\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (component.displayArrowsOnPath && component.animateArrowsOnPath) {\n\t\t\t\t\t\tcomponent.mesh.children.forEach(child => {\n\t\t\t\t\t\t\tif (child.name === 'stencil') {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tchild.material.uniforms.arrowAnimationTimer.value = performance.now() / 3000;\n\t\t\t\t\t\t\tchild.material.needsUpdate = true;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tshouldAnimate = true;\n\t\t\t\t\t}\n\t\t\t\t\tcomponent.materialDirty = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.verticalDistanceDirty = false;\n\t\tif (shouldAnimate) {\n\t\t\tthis.publish('animate:path');\n\t\t}\n\t}\n}\n\nfunction updateHighlightPathUniforms(component: PathComponent, material: ShaderMaterial) {\n\tconst uniforms = material.uniforms;\n\tuniforms.highlightCompleteFraction.value = component.highlightCompleteFraction;\n\tuniforms.highlightStartFraction.value = component.highlightStartFraction;\n\tuniforms.highlightEndFraction.value = component.highlightEndFraction;\n\tuniforms.highlightWidthMultiplier.value = component.highlightWidthMultiplier;\n\tuniforms.highlightColor.value.set(component.highlightColor);\n}\n", "import {\n\tAlwaysStencilFunc,\n\tBox3,\n\tBufferAttribute,\n\tCatmullRomCurve3,\n\tColor,\n\tKeepStencilOp,\n\tMesh,\n\tNotEqualStencilFunc,\n\tRepeatWrapping,\n\tReplaceStencilOp,\n\tSRGBColorSpace,\n\tShaderMaterial,\n\tTexture,\n\tTextureLoader,\n\tTubeGeometry,\n\tVector2,\n\tVector3,\n} from 'three';\n// @ts-ignore\nimport PathVertexShader from '../../shaders/Path.Vertex.glsl';\n// @ts-ignore\nimport PathFragmentShader from '../../shaders/Path.Fragment.glsl';\nimport StencilFragmentShader from '../../shaders/Path.Stencil.Fragment.glsl';\n\n// @ts-ignore\nimport arrow from '../../icons/mappedin-icon_arrow.png';\n\nimport type { PathComponent } from '../../components/path';\nimport type { PathMaterial, PathUniforms } from '../../entities/geometry3d';\nimport { RENDER_LAYERS } from '../../utils/constants';\n\nconst textureLoader = new TextureLoader();\n\ntype BuildPathOptions = Partial<{\n\tcolor: string;\n\taltitude: number;\n\tisVertical: boolean;\n}>;\n\nexport function buildPath(points: Vector3[], component: PathComponent, options: BuildPathOptions) {\n\tconst {\n\t\tbreakpoint,\n\t\twidth,\n\t\taccentColor: pulseColor,\n\t\tcompleteFraction,\n\t\tisVertical,\n\t\tvisibleThroughGeometry,\n\t\tdashed,\n\t\thighlightCompleteFraction,\n\t\thighlightStartFraction,\n\t\thighlightEndFraction,\n\t\thighlightColor,\n\t\thighlightWidthMultiplier,\n\t} = component;\n\tconst { color } = options;\n\n\t/*\n    Default near radius of 0.2 meters for finer control near the camera.\n    Chosen to be less than half the average doorway width (0.85 meters)\n    to ensure the path can navigate through doorways on the zoom levels close to nearZoom.\n    */\n\tconst animateDrawing = true;\n\t/*\n    Default far radius of 0.4 meters for a wider view as the path extends\n    farther from the camera. This value is approximately half the average\n    doorway width, providing a comfortable margin for the zoom levels close to farZoom.\n    */\n\tconst nearZoom = 0;\n\tconst farZoom = Infinity;\n\tconst displayArrowsOnPath = component.displayArrowsOnPath;\n\tconst showPulse = true;\n\tconst showArrow = displayArrowsOnPath;\n\tconst nearRadius = typeof width === 'object' ? Number(width.output[breakpoint]) / 2 : width / 2;\n\tconst farRadius =\n\t\ttypeof width === 'object' ? Number(width.output[breakpoint + 1] ?? width.output[breakpoint]) / 2 : width / 2;\n\n\tconst pathZ = (options.altitude ?? 0) + ALTITUDE_ADJUSTMENT;\n\t// Compute the total length of the path.\n\tlet pathLength = 0;\n\n\tpoints[0].z += pathZ;\n\tfor (let i = 1; i < points.length; ++i) {\n\t\tpoints[i].z += pathZ;\n\t\tconst dx = points[i].x - points[i - 1].x;\n\t\tconst dz = points[i].z - points[i - 1].z;\n\t\tif (isVertical) {\n\t\t\t// If the path is a connection path, we ignore slope toward and\n\t\t\t// away from the camera, as this would merely compress the arrow\n\t\t\t// texture visually.\n\t\t\tpathLength += Math.sqrt(dx * dx + dz * dz);\n\t\t} else {\n\t\t\tconst dy = points[i].y - points[i - 1].y;\n\t\t\tpathLength += Math.sqrt(dx * dx + dy * dy + dz * dz);\n\t\t}\n\t}\n\n\tif (!isVertical) {\n\t\tconst firstPoint = points[0];\n\t\tconst lastPoint = points[points.length - 1];\n\n\t\t// 0.01 is subtracted to point end cap downward\n\t\tpoints.push(lastPoint.clone().setZ(lastPoint.z - 0.01));\n\t\tpoints.unshift(firstPoint.clone().setZ(firstPoint.z - 0.01));\n\t}\n\n\tlet arrowTexture = new Texture();\n\tif (showArrow) {\n\t\tarrowTexture = textureLoader.load(arrow);\n\t\tarrowTexture.colorSpace = SRGBColorSpace;\n\t}\n\tconst colorThree = new Color(color);\n\tconst pulseColorThree = new Color(pulseColor);\n\n\tconst uniforms = {\n\t\tvertexes: {\n\t\t\ttype: 'f',\n\t\t\tvalue: 1.0,\n\t\t},\n\t\tresolution: {\n\t\t\ttype: 'v2',\n\t\t\tvalue: new Vector2(1.0, 1.0),\n\t\t},\n\t\tcameraParameters: {\n\t\t\ttype: 'v2',\n\t\t\tvalue: new Vector2(nearZoom, 0),\n\t\t},\n\t\tcomplete: {\n\t\t\ttype: 'f',\n\t\t\tvalue: animateDrawing ? 0.0 : 1.0,\n\t\t},\n\t\tcolor: {\n\t\t\ttype: 'c',\n\t\t\tvalue: colorThree,\n\t\t},\n\t\tpathLength: {\n\t\t\ttype: 'f',\n\t\t\tvalue: pathLength,\n\t\t},\n\t\tnearRadius: {\n\t\t\ttype: 'f',\n\t\t\tvalue: nearRadius,\n\t\t},\n\t\tfarRadius: {\n\t\t\ttype: 'f',\n\t\t\tvalue: farRadius,\n\t\t},\n\t\tnearZoom: {\n\t\t\ttype: 'f',\n\t\t\tvalue: nearZoom,\n\t\t},\n\t\tfarZoom: {\n\t\t\ttype: 'f',\n\t\t\tvalue: farZoom,\n\t\t},\n\t\tpulseColor: {\n\t\t\ttype: 'c',\n\t\t\tvalue: pulseColorThree,\n\t\t},\n\t\tpulse: {\n\t\t\ttype: 'f',\n\t\t\tvalue: 0.0,\n\t\t},\n\t\tpulseLength: {\n\t\t\ttype: 'f',\n\t\t\tvalue: 0.075,\n\t\t},\n\t\tpathIsVertical: {\n\t\t\ttype: 'b',\n\t\t\tvalue: isVertical,\n\t\t},\n\t\tarrowAnimationTimer: {\n\t\t\ttype: 'f',\n\t\t\tvalue: 0.0,\n\t\t},\n\t\tarrowTexture: {\n\t\t\ttype: 't',\n\t\t\tvalue: arrowTexture,\n\t\t},\n\t\tdisplayArrowsOnPath: {\n\t\t\ttype: 'b',\n\t\t\tvalue: displayArrowsOnPath,\n\t\t},\n\t\tshowPulse: {\n\t\t\ttype: 'b',\n\t\t\tvalue: showPulse,\n\t\t},\n\t\topacityMultiplier: {\n\t\t\ttype: 'f',\n\t\t\tvalue: 1.0,\n\t\t},\n\t\tdashed: {\n\t\t\ttype: 'b',\n\t\t\tvalue: dashed,\n\t\t},\n\t\thighlightCompleteFraction: {\n\t\t\ttype: 'f',\n\t\t\tvalue: highlightCompleteFraction,\n\t\t},\n\t\thighlightStartFraction: {\n\t\t\ttype: 'f',\n\t\t\tvalue: highlightStartFraction,\n\t\t},\n\t\thighlightEndFraction: {\n\t\t\ttype: 'f',\n\t\t\tvalue: highlightEndFraction,\n\t\t},\n\t\thighlightColor: {\n\t\t\ttype: 'c',\n\t\t\tvalue: new Color(highlightColor),\n\t\t},\n\t\thighlightWidthMultiplier: {\n\t\t\ttype: 'f',\n\t\t\tvalue: highlightWidthMultiplier,\n\t\t},\n\t} satisfies PathUniforms;\n\n\tconst pathCurve: any = new CatmullRomCurve3(points);\n\n\tpathCurve.curveType = 'catmullrom';\n\tpathCurve.tension = 0.0;\n\n\tconst TUBULAR_SEGMENTS_PER_UNIT_LENGTH = 30;\n\tconst RADIAL_SEGMENTS = 8;\n\n\tconst tubularSegments = TUBULAR_SEGMENTS_PER_UNIT_LENGTH * points.length;\n\tconst geometry = new TubeGeometry(pathCurve, tubularSegments, nearRadius, RADIAL_SEGMENTS, false);\n\n\tconst vertexIndex = new Float32Array(geometry.attributes.position.count);\n\tfor (let i = points.length; i < vertexIndex.length; i++) {\n\t\tvertexIndex[i] = i;\n\t}\n\tgeometry.setAttribute('vertexIndex', new BufferAttribute(vertexIndex, 1));\n\n\t// An attribute that contains a value from 0.0 up to 1.0 depending on\n\t// whether the vertex is at the beginning or the end of the path.\n\tconst pathDistance = new Float32Array(geometry.attributes.position.count);\n\tconst pathDistanceAttribute = new BufferAttribute(pathDistance, 1);\n\tfor (let i = 0; i <= tubularSegments; i++) {\n\t\t// Take careful note of the <= here -- threejs generates an\n\t\t// extra vertex per segment...\n\t\tfor (let j = 0; j <= RADIAL_SEGMENTS; ++j) {\n\t\t\tpathDistanceAttribute.setX(i * (RADIAL_SEGMENTS + 1) + j, i / tubularSegments);\n\t\t}\n\t}\n\tgeometry.setAttribute('pathDistance', pathDistanceAttribute);\n\n\t// An attribute that contains the tangent vector for the path at the\n\t// current point. This vector will point \"forward\" along the path at\n\t// any point.\n\tconst pathTangents = new Float32Array(geometry.attributes.normal.count * 3);\n\tconst pathTangentAttribute = new BufferAttribute(pathTangents, 3);\n\tfor (let i = 0; i < tubularSegments; i++) {\n\t\tconst tangent = geometry.tangents[i];\n\t\tfor (let j = 0; j <= RADIAL_SEGMENTS; ++j) {\n\t\t\tpathTangentAttribute.setXYZ(i * (RADIAL_SEGMENTS + 1) + j, tangent.x, tangent.y, tangent.z);\n\t\t}\n\t}\n\tgeometry.setAttribute('pathTangent', pathTangentAttribute);\n\n\t// An attribute that points toward the \"top\" of the path, which is a\n\t// vector that's perpendicular to the path and points as closely to the\n\t// positive z-axis as possible (for normal paths; for connection paths,\n\t// the \"front\" is used, which is the negative y-axis.)\n\tconst pathNormals = new Float32Array(geometry.attributes.normal.count * 3);\n\tconst pathNormalAttribute = new BufferAttribute(pathNormals, 3);\n\tfor (let i = 0; i < tubularSegments; i++) {\n\t\t// N = normalize(U - T(T dot U))\n\t\tconst tangent = geometry.tangents[i];\n\t\tvar normalX;\n\t\tvar normalY;\n\t\tvar normalZ;\n\n\t\tif (isVertical) {\n\t\t\t// U = (0, -1, 0)\n\t\t\tnormalX = tangent.x * tangent.y;\n\t\t\tnormalY = -1 + tangent.y * tangent.y;\n\t\t\tnormalZ = tangent.z * tangent.y;\n\t\t} else {\n\t\t\t// U = (0, 0, 1)\n\t\t\tnormalX = -tangent.x * tangent.z;\n\t\t\tnormalY = -tangent.y * tangent.z;\n\t\t\tnormalZ = 1 - tangent.z * tangent.z;\n\t\t}\n\n\t\tlet normalR = Math.sqrt(normalX * normalX + normalY * normalY + normalZ * normalZ);\n\t\t/**\n\t\t * Guard against NaNs produced by producing normalized tangents.\n\t\t * There may be some issues with the above normal calculations\n\t\t * that we don't fully understand but this guard works for now.\n\t\t */\n\t\tif (normalR === 0) {\n\t\t\tnormalR = 1;\n\t\t}\n\t\tconst unitNormalX = normalX / normalR;\n\t\tconst unitNormalY = normalY / normalR;\n\t\tconst unitNormalZ = normalZ / normalR;\n\t\tfor (let j = 0; j <= RADIAL_SEGMENTS; ++j) {\n\t\t\tpathNormalAttribute.setXYZ(i * (RADIAL_SEGMENTS + 1) + j, unitNormalX, unitNormalY, unitNormalZ);\n\t\t}\n\t}\n\tgeometry.setAttribute('pathNormal', pathNormalAttribute);\n\n\t// Sweet shader material\n\tconst material = new ShaderMaterial({\n\t\tuniforms: uniforms,\n\t\tvertexShader: PathVertexShader,\n\t\tfragmentShader: PathFragmentShader,\n\t}) as PathMaterial;\n\n\tmaterial.transparent = true;\n\tmaterial.alphaTest = 0.5;\n\n\tuniforms.resolution.value.x = 1.0; // width\n\tuniforms.resolution.value.y = 1.0; // height\n\n\tuniforms.vertexes.value = vertexIndex.length;\n\tuniforms.arrowTexture.value.wrapS = RepeatWrapping;\n\tuniforms.arrowTexture.value.wrapT = RepeatWrapping;\n\tuniforms.arrowTexture.value.anisotropy = 16;\n\n\tconst pathObject = new Mesh(geometry, material);\n\tconst xRayObject = pathObject.clone();\n\tconst xRayUniforms = {\n\t\t...uniforms,\n\t\topacityMultiplier: {\n\t\t\ttype: 'f',\n\t\t\tvalue: 0.25,\n\t\t},\n\t\tpathIsVertical: {\n\t\t\ttype: 'b',\n\t\t\tvalue: isVertical,\n\t\t},\n\t};\n\n\txRayUniforms.complete.value = 1.0;\n\n\txRayObject.material = new ShaderMaterial({\n\t\tuniforms: xRayUniforms,\n\t\tvertexShader: PathVertexShader,\n\t\tfragmentShader: PathFragmentShader,\n\t}) as PathMaterial;\n\txRayObject.material.transparent = true;\n\txRayObject.material.alphaTest = 0.5;\n\txRayObject.material.depthWrite = false;\n\txRayObject.material.depthTest = false;\n\n\txRayUniforms.resolution.value.x = 1.0; // width\n\txRayUniforms.resolution.value.y = 1.0; // height\n\n\txRayUniforms.vertexes.value = vertexIndex.length;\n\txRayUniforms.arrowTexture.value.wrapS = RepeatWrapping;\n\txRayUniforms.arrowTexture.value.wrapT = RepeatWrapping;\n\txRayUniforms.arrowTexture.value.anisotropy = 16;\n\n\txRayUniforms.complete.value = completeFraction;\n\n\tpathObject.userData = xRayObject.userData = component.mesh.userData;\n\n\tconst mesh = component.mesh;\n\n\tif (!visibleThroughGeometry) {\n\t\tconst stencilMaterial = new ShaderMaterial({\n\t\t\tuniforms: uniforms,\n\t\t\t// we need the same vertex shader as the path shader so the path is flattened the same way\n\t\t\tvertexShader: PathVertexShader,\n\t\t\tfragmentShader: StencilFragmentShader,\n\t\t}) as PathMaterial;\n\t\t// create a stencil mesh that will be used to mask any visible through geometry paths\n\t\tconst stencilMesh = new Mesh(geometry, stencilMaterial);\n\t\tstencilMesh.name = 'stencil';\n\t\tstencilMesh.material.colorWrite = false;\n\t\tstencilMesh.material.stencilWrite = true;\n\t\tstencilMesh.material.stencilRef = 1;\n\t\tstencilMesh.material.stencilFunc = AlwaysStencilFunc;\n\t\tstencilMesh.material.stencilZPass = ReplaceStencilOp;\n\t\tstencilMesh.material.stencilZFail = ReplaceStencilOp;\n\t\tstencilMesh.material.stencilFail = ReplaceStencilOp;\n\t\tstencilMesh.material.depthWrite = false;\n\t\tstencilMesh.material.depthTest = false;\n\n\t\tstencilMesh.userData = component.mesh.userData;\n\n\t\tmesh.add(stencilMesh);\n\t\tmesh.add(xRayObject);\n\t\t/**\n\t\t * Note: the render order ensures that the regular path is rendered above the xray path, always, preventing transparency fighting at\n\t\t * different camera angles. We don't care about the x-ray being under regular path, because we only need it in places where the regular path is occluded by geometry.\n\t\t * This issue shows up when rendering multiple paths above each other (step by step directions path segment highlight)\n\t\t */\n\t\t// make sure xray is rendered first\n\t\txRayObject.renderOrder = 0;\n\t\t// make sure path is rendered last\n\t\tpathObject.renderOrder = 1;\n\t}\n\n\tmesh.add(pathObject);\n\n\tif (isVertical) {\n\t\t// ensure we can move the object back to the original position\n\t\t// after centring its geometry which is required for billboarding\n\t\tconst boundingBox = new Box3().setFromObject(pathObject);\n\t\tconst center = new Vector3();\n\t\tboundingBox.getCenter(center);\n\n\t\tmesh.children.forEach(child => {\n\t\t\tchild.geometry.center();\n\t\t\tchild.position.copy(center);\n\t\t});\n\t}\n\n\t// always show path on top of everything else, without opacity (xray)\n\tif (visibleThroughGeometry) {\n\t\t// read 1 from stencil buffer to hide any pixels covered by the stencil mesh above\n\t\tpathObject.material.stencilWrite = true;\n\t\tpathObject.material.stencilRef = 1;\n\t\tpathObject.material.stencilFunc = NotEqualStencilFunc;\n\t\tpathObject.material.stencilZPass = KeepStencilOp;\n\t\tpathObject.material.stencilZFail = KeepStencilOp;\n\t\tpathObject.material.stencilFail = KeepStencilOp;\n\t\tpathObject.material.needsUpdate = true;\n\t\tpathObject.layers.disableAll();\n\t\tpathObject.layers.enable(RENDER_LAYERS.ALWAYS_ON_TOP_PATHS);\n\t}\n\n\tgeometry.computeBoundingBox();\n\tconst center = new Vector3();\n\tgeometry.boundingBox!.getCenter(center);\n\n\treturn { mesh, material, center };\n}\n\n// This adjustment separates xray path from path.\n// TODO: Fix this properly without a hard coded offset value\nconst ALTITUDE_ADJUSTMENT = 0.15;\n", "export default `attribute float pathDistance;\nattribute vec3 pathNormal;\nattribute vec3 pathTangent;\n\n\nuniform vec2 uvScale;\nuniform float vertexes;\nuniform float complete;\nuniform float nearRadius;\nuniform float farRadius;\nuniform float nearZoom;\nuniform float farZoom;\nuniform float pulse;\nuniform float pulseLength;\nuniform bool pathIsVertical;\nuniform bool displayArrowsOnPath;\nuniform vec2 cameraParameters;\n\nvarying float zoomLevel;\nvarying float radius;\nvarying vec2 fragTexcoord;\nvarying float fragTopTextureU;\nvarying float fragPathDistance;\n\nuniform float highlightStartFraction;\nuniform float highlightEndFraction;\nuniform float highlightCompleteFraction;\nuniform float highlightWidthMultiplier;\nuniform vec3 highlightColor;\n\nfloat flattenFactor = 0.0;\n// Map the x value from the range [xMin, xMax] to the range [yMin, yMax] using\n// linear interpolation/extrapolation.\n//\n// This performs a pure linear mapping y = mx + b where\n// 'm = (yMax - yMin) / (xMax - xMin)',\n// 'b = -xMin * (yMax - yMin) / (xMax - xMin) + yMin'.\nfloat remap(float x, float xMin, float xMax, float yMin, float yMax) {\n\treturn (x - xMin) / (xMax - xMin) * (yMax - yMin) + yMin;\n}\n\n// Map the x value from [xMin, xMax] to the range [yMin, yMax] using linear\n// interpolation, clamping result values outside [yMin, yMax].\nfloat clampRemap(float x, float xMin, float xMax, float yMin, float yMax) {\n\treturn clamp(remap(x, xMin, xMax, yMin, yMax), yMin, yMax);\n}\n\nvoid main() {\n\tfragPathDistance = pathDistance;\n\n\t// We can get an origin point for the cross-section of the path by\n\t// subtracting the surface normal times the radius, since the surface normal\n\t// points strictly away from the centre.\n\tvec3 origin = position - nearRadius * normal;\n\t\n\t// Inflate the path along its surface normal to increase its radius from\n\t// 'nearRadius' to 'farRadius' when the camera is at 'farZoom'.\n\tvec3 adjustedPosition = position;\n\tzoomLevel = clampRemap(cameraParameters.x, nearZoom, farZoom, 0.0, 1.0);\n\n\t// expansion factor uses the zoom level to increase/decrease the radius\n\t// for fixed widths, this number is ZERO\n\tfloat expansionFactor = (farRadius - nearRadius) * zoomLevel;\n\n\tadjustedPosition += normal * expansionFactor;\n\n\n\t// TODO: optimize by removing branching\n\tbool isHighlighted = fragPathDistance >= highlightStartFraction && fragPathDistance <= (highlightEndFraction * highlightCompleteFraction);\n\t// adjust the color based on the highlight but only if the fragment is within the highlight start and end\n\tif (isHighlighted) {\n\t\t// we have to subtract 1., don't ask why\n\t\tadjustedPosition += normal * (highlightWidthMultiplier - 1.) / 2.;\n\t}\n\t\n\n\t// Determine how far the path extends \"up\" or \"down\" in the direction of the\n\t// path normal.\n\tfloat height = dot(adjustedPosition - origin, pathNormal);\n\n\t// For horizontal paths, flatten the bottom half entirely so that it's flat\n\t// against the floor. This makes the path look nicer when it's\n\t// semitransparent behind opaque geometry, so you don't see it\n\t// peeking through. For vertical paths, preserve the full tube geometry.\n\tif (!pathIsVertical) {\n\t\tfloat desiredHeight = max(height, 0.0);\n\t\tdesiredHeight = desiredHeight * flattenFactor;\n\t\tfloat flattenMagnitude = height - desiredHeight;\n\t\tadjustedPosition = adjustedPosition - pathNormal * flattenMagnitude;\n\t}\n\n\t// Transform the vertices into NDC.\n\tvec4 mvPosition = modelViewMatrix * vec4(adjustedPosition, 1.0);\n\tgl_Position = projectionMatrix * mvPosition;\n\n\tfragTexcoord = uv;\n\n\t// Compute a texture coordinate for mapping the arrow texture to the path.\n\t// We don't want to use the u-value that Three.js provides, because the\n\t// path may end up twisting arbitrarily -- but we want the arrow texture to\n\t// always be on the top of the path.\n\tvec3 bitangent = cross(normal, pathTangent);\n\tfragTopTextureU = -dot(bitangent, pathNormal) * 0.5 + 0.5;\n\t// adjust the color based on the highlight but only if the fragment is within the highlight start and end\n\tif (isHighlighted) {\n\t\t// TODO: fix scaling\n\t\tfragTopTextureU = -dot(bitangent, pathNormal * highlightWidthMultiplier) * 0.5 + 0.5;\n\t}\n\n\tradius = mix(nearRadius, farRadius, zoomLevel);\n}\n`", "export default `#define ARROW_FADING_POINT 0.15\n\nuniform float complete;\nuniform float nearRadius;\nuniform float farRadius;\nuniform vec2 resolution;\nuniform vec2 cameraParameters;\nuniform vec3 color;\nuniform float pathLength;\nuniform bool showPulse;\nuniform vec3 pulseColor;\nuniform float pulse;\nuniform float pulseLength;\nuniform bool pathIsVertical;\nuniform bool displayArrowsOnPath;\nuniform float arrowAnimationTimer;\nuniform float opacityMultiplier;\nuniform bool dashed;\nuniform sampler2D arrowTexture;\n\nvarying float zoomLevel;\nvarying float radius;\nvarying vec2 fragTexcoord;\nvarying float fragTopTextureU;\nvarying float fragPathDistance;\n\n\nuniform float highlightStartFraction;\nuniform float highlightEndFraction;\nuniform float highlightCompleteFraction;\nuniform vec3 highlightColor;\n\n// How long the arrow should be, as a factor of pathRadius. Since we've\n// mostly flattened the top of the path, values near 2.0 (the diameter)\n// will probably look best.\nconst float arrowLength = 2.0;\n\n// How much of a relative margin the arrow texture should have inside the\n// area laid out for it. Useful to pull the arrow away from the edges of the\n// path, which slope down.\nconst float arrowMargin = 0.1;\n\n// How many arrow-lengths of space should be between arrows on a short path.\nconst float arrowSpacingOnShortPath = 6.0;\n\n// How many arrow-lengths of space should be between arrows on a long path.\nconst float arrowSpacingOnLongPath = 7.5;\n\n// How long a path must be to be considered \"long\", as a factor of\n// the path radius.\nconst float longPathLength = 200.;\n\n// How long a path must be to be considered \"short\", as a factor of the\n// path radius.\nconst float shortPathLength = 75.;\n\n// How much of the path's length the fade-in should comprise when going from\n// zero opacity to full opacity.\nconst float completeLength = 0.1;\n\n// Map the x value from the range [xMin, xMax] to the range [yMin, yMax] using\n// linear interpolation/extrapolation.\n//\n// This performs a pure linear mapping 'y = mx + b' where\n// 'm = (yMax - yMin) / (xMax - xMin)',\n// 'b = -xMin * (yMax - yMin) / (xMax - xMin) + yMin'.\nfloat remap(float x, float xMin, float xMax, float yMin, float yMax) {\n\treturn (x - xMin) / (xMax - xMin) * (yMax - yMin) + yMin;\n}\n\n// Map the x value from [xMin, xMax] to the range [yMin, yMax] using linear\n// interpolation, clamping result values outside [yMin, yMax].\nfloat clampRemap(float x, float xMin, float xMax, float yMin, float yMax) {\n\treturn clamp(remap(x, xMin, xMax, yMin, yMax), yMin, yMax);\n}\n\nvoid main(void) {\n\t// Compute the opacity of the path based on the distance from the current\n\t// fragment to the 'complete' value as it varies from 0.0 to 1.0.\n\t// Fragments that are at the 'complete' value or past it will be fully\n\t// transparent, while fragments that are at 'complete - completeLength'\n\t// or before it will be fully opaque. However, we adjust the 'complete'\n\t// value here so that it overshoots by one full 'completeLength', so that\n\t// the entire path will be opaque when the 'complete' value is at 1.0.\n\tfloat completeLocation = complete * (1.0 + completeLength);\n\tfloat completeAmount = clampRemap(\n\t\tfragPathDistance,\n\t\tcompleteLocation - completeLength,\n\t\tcompleteLocation,\n\t\t0.0,\n\t\t1.0\n\t);\n\tfloat opacity = 1.0 - smoothstep(0.0, 1.0, completeAmount);\n\n\t// 2020/01/09 Terence Dickson\n\t// When we render the background and overlay for the mapbox outdoor context\n\t// behind everything else in single-buffer rendering, the fact that the path\n\t// writes to the depth buffer means that the background and overlay will not\n\t// be drawn behind the path even when the path is still fading in. The effect\n\t// is subtle and is only visible in single-buffer rendering so this quick fix\n\t// prevents writes to the depth buffer for zero opacity fragments, which gets\n\t// rid of the most visually-offensive ghosting.\n\tif (opacity <= 0.0) {\n\t\tdiscard;\n\t}\n\n\t// Push in the texture coordinates so that they ramp up\n\t// at 'arrowMargin' instead of at zero; this remapping looks somewhat\n\t// like this:\n\t// 1 ^        ___\n\t//   |       /\n\t//   |      /\n\t//   |     /\n\t//   |    /\n\t//   |___/\n\t// 0 +---------->\n\t//   0   ^      1\n\t//       arrowMargin\n\t// Making the arrows narrower on the path.\n\tfloat u = fragTopTextureU;\n\tu = clamp(\n\t\tu * (1. / (1. - arrowMargin * 2.)) - (1. / (1. - arrowMargin * 2.) - 1.) / 2.,\n\t\t0.0,\n\t\t1.0\n\t);\n\n\tfloat arrowSpacing = clampRemap(\n\t\tpathLength,\n\t\tshortPathLength * radius,\n\t\tlongPathLength * radius,\n\t\tarrowSpacingOnShortPath,\n\t\tarrowSpacingOnLongPath\n\t);\n\n\t// Reduce the spacing between arrows when the camera zooms out, as increasing\n\t// the path radius will increase the arrow size and thus be able to fit\n\t// fewer arrows on in total, and this secondary movement of the arrows\n\t// \"zooming off\" the end of the path is unpleasant\n\tfloat expandAmount = mix(1.0, farRadius / nearRadius, zoomLevel);\n\tfloat effectiveArrowSpacing =\n\t\tarrowSpacing * 1.0 / expandAmount +\n\t\tarrowMargin * 2.0;\n\n\tfloat effectiveArrowLength = arrowLength * radius * (1. - arrowMargin * 2.0);\n\n\t// Adjust the slope of the vertical texture coordinate so that it goes\n\t// from 0 to 1 along the length of the arrow plus the spacing between\n\t// arrows, and adjust its x-intercept so that one arrow moves to the\n\t// exact position of the next arrow as 'arrowAnimationTimer' goes\n\t// from 0 to 1\n\tfloat v = (\n\t\tfragTexcoord.x * (pathLength / effectiveArrowLength)\n\t\t- arrowAnimationTimer * (1. + effectiveArrowSpacing)\n\t);\n\n\t// Compute a \"looping sawtooth\" wave for determining the vertical texture\n\t// coordinates of the arrow texture, roughly as follows:\n\t// 3 ^              /\n\t//   |          ___/\n\t// 2 |         /\n\t//   |     ___/\n\t// 1 |    /\n\t//   |___/\n\t// 0 +--------------->\n\t//   0   ^ ^\n\t//   ^   |_|\n\t//   |   effectiveArrowLength\n\t//   |___|\n\t//   effectiveArrowSpacing\n\t//\n\t// This is effectively equivalent to this sort of sawtooth wave:\n\t//   ^\n\t// 1 |    /    /    /\n\t//   |___/ ___/ ___/\n\t// 0 +--------------->\n\t//\n\t// Causing the image of the arrow to repeat, with dead space (the bottom\n\t// edge of the texture stretched out) between the arrows at the provided\n\t// spacing. The reason why the \"looping\" design is preferred is because\n\t// it takes advantage of WebGL's 'GL_REPEAT' texture wrapping behaviour\n\t// to avoid the discontinuity that can end up causing visual artifacts.\n\tif (mod(v, (1. + effectiveArrowSpacing)) < 1.) {\n\t\tv = v - effectiveArrowSpacing * floor(v / (1. + effectiveArrowSpacing));\n\t} else {\n\t\tv = ceil(v / (1. + effectiveArrowSpacing));\n\t}\n\n\t// Use the r-component of the texture to determine whether the arrow covers\n\t// this fragment or not\n\tvec2 sampleTexcoord = vec2(u, v);\n\tfloat arrowAmount = 0.0;\n\tvec3 secondColor = pulseColor;\n\n\tvec3 finalColor = color;\n\n\n\t\n\t// adjust the color based on the highlight but only if the fragment is within the highlight start and end\n\t// [Anzor] I added 0.005 to make the highlight transition a little smoother when the width multiplier is too high\n\tif (fragPathDistance >= highlightStartFraction - 0.005 && fragPathDistance <= (highlightEndFraction * highlightCompleteFraction)) {\n\t\tfinalColor = highlightColor;\n\t}\n\n\n\tif (displayArrowsOnPath) {\n\t\tarrowAmount = texture2D(arrowTexture, sampleTexcoord).r;\n\t\tfloat delta = 1.0 - abs(fragPathDistance * 2.0 - 1.0);\n\t\tsecondColor = mix(finalColor, pulseColor, 1.0 - smoothstep(ARROW_FADING_POINT, 0.0, delta));\n\t}\n\n\tif (dashed) {\n\t\tfloat dashLength = 0.1; // Adjust this value to change the dash length\n\t\tfloat gapLength = 0.1; // Adjust this value to change the gap length\n\t\tfloat totalLength = dashLength + gapLength;\n\t\tfloat numSegments = ceil(1.0 / totalLength);\n\t\tfloat adjustedTotalLength = 1.0 / numSegments;\n\t\tfloat adjustedDashLength = adjustedTotalLength * (dashLength / (dashLength + gapLength));\n\t\tfloat pattern = mod(fragPathDistance, adjustedTotalLength);\n\t\topacity = pattern < adjustedDashLength ? 1.0 : 0.0;\n\t}\n\n\n\n\tif (showPulse) {\n\t\t// Add the pulse color to the path by determining how far the current fragment\n\t\t// is from 'pulse'\n\t\tfloat pulseLocation = remap(\n\t\tpulse,\n\t\t0.0,\n\t\t1.0,\n\t\t-pulseLength,\n\t\t1.0 + pulseLength\n\t\t);\n\t\tfloat pulseDistance = smoothstep(\n\t\t0.0,\n\t\tpulseLength,\n\t\tabs(fragPathDistance - pulseLocation)\n\t\t);\n\n\t\t// Blend the pulse color to the path based on how close this fragment is to\n\t\t// the 'pulse' value and whether it's covered by an arrow -- but if it's\n\t\t// covered by *both*, then we go back to using the regular path color\n\t\t// (making arrows look like \"holes\" when they're overlapping the pulse.)\n\t\tfloat pulseLevel = abs(1.0 - pulseDistance - arrowAmount);\n\n\t\t\n\t\tgl_FragColor = vec4(mix(finalColor, secondColor, pulseLevel), opacity * opacityMultiplier);\n\t} else if (displayArrowsOnPath) {\n\t\tgl_FragColor = vec4(mix(finalColor, pulseColor, arrowAmount), opacity * opacityMultiplier);\n\t} else {\n\t\t\n\t\tgl_FragColor = vec4(finalColor, opacity * opacityMultiplier);\n\t}\n\t#include <colorspace_fragment>\n}\n`", "export default `uniform float complete;\nuniform float nearRadius;\nuniform float farRadius;\nvarying float fragPathDistance;\nconst float completeLength = 0.1;\n\n// Map the x value from the range [xMin, xMax] to the range [yMin, yMax] using\n// linear interpolation/extrapolation.\n//\n// This performs a pure linear mapping 'y = mx + b' where\n// 'm = (yMax - yMin) / (xMax - xMin)',\n// 'b = -xMin * (yMax - yMin) / (xMax - xMin) + yMin'.\nfloat remap(float x, float xMin, float xMax, float yMin, float yMax) {\n\treturn (x - xMin) / (xMax - xMin) * (yMax - yMin) + yMin;\n}\n\n// Map the x value from [xMin, xMax] to the range [yMin, yMax] using linear\n// interpolation, clamping result values outside [yMin, yMax].\nfloat clampRemap(float x, float xMin, float xMax, float yMin, float yMax) {\n\treturn clamp(remap(x, xMin, xMax, yMin, yMax), yMin, yMax);\n}\n\nvoid main(void) {\n\t// this ensures that the stencil mask moves along with the path above it, to avoid the progress bar effect\n\tfloat completeLocation = complete * (1.0 + completeLength);\n\tfloat completeAmount = clampRemap(\n\t\tfragPathDistance,\n\t\tcompleteLocation - completeLength,\n\t\tcompleteLocation,\n\t\t0.0,\n\t\t1.0\n\t);\n\tfloat opacity = 1.0 - smoothstep(0.0, 1.0, completeAmount);\n\n\t// 2020/01/09 Terence Dickson\n\t// When we render the background and overlay for the mapbox outdoor context\n\t// behind everything else in single-buffer rendering, the fact that the path\n\t// writes to the depth buffer means that the background and overlay will not\n\t// be drawn behind the path even when the path is still fading in. The effect\n\t// is subtle and is only visible in single-buffer rendering so this quick fix\n\t// prevents writes to the depth buffer for zero opacity fragments, which gets\n\t// rid of the most visually-offensive ghosting.\n\tif (opacity <= 0.0) {\n\t\tdiscard;\n\t}\n\n\tgl_FragColor = vec4(0.0, 1.0, 0.0, opacity);\n}`", "import { type All3DTypes, type RendererState } from '../../renderer';\nimport { Geometry3D, Geometry3DComponents } from '../../entities';\nimport { EntityBatchedMesh, MeshComponent } from '../../components/mesh';\nimport { GeometryGroupObject3D } from '../../entities/geometry-group';\nimport { StyleComponent } from '../../components/styles/style';\nimport { Color, DoubleSide, Matrix4 } from 'three';\nimport { BatchedStandardMaterial } from '../mesh-creation-and-optimization/batched-material';\nimport { getGroupContainerOpacity } from '../../utils';\nimport { transferGeometryToNewBatchedMesh } from './utils';\n\n/**\n * This system is responsible for updating the opacity of the mesh, which results in the mesh\n * being detached from the parent's optimized geometry group and rendered as a separate mesh.\n */\nexport class MeshDetachmentSystem {\n\trendererState: RendererState;\n\tdirty = false;\n\tconstructor(rendererState: RendererState) {\n\t\tthis.rendererState = rendererState;\n\t}\n\n\t#meshComponentBeingProcessed?: MeshComponent;\n\t#geometryGroupBeingProcessed?: GeometryGroupObject3D;\n\t#styleComponentBeingProcessed?: StyleComponent;\n\t#processingMatrix = new Matrix4();\n\n\tupdateOne(geometry: All3DTypes | undefined) {\n\t\tif (geometry instanceof Geometry3D) {\n\t\t\tif (\n\t\t\t\tgeometry.components[Geometry3DComponents.Mesh] instanceof MeshComponent &&\n\t\t\t\tgeometry.components[Geometry3DComponents.Style] instanceof StyleComponent &&\n\t\t\t\tgeometry.parentObject3D instanceof GeometryGroupObject3D\n\t\t\t) {\n\t\t\t\tthis.#meshComponentBeingProcessed = geometry.components[Geometry3DComponents.Mesh];\n\t\t\t\tthis.#styleComponentBeingProcessed = geometry.components[Geometry3DComponents.Style];\n\n\t\t\t\tif (\n\t\t\t\t\t!this.#meshComponentBeingProcessed.detached &&\n\t\t\t\t\tthis.#meshComponentBeingProcessed.shouldDetach &&\n\t\t\t\t\tthis.#meshComponentBeingProcessed.mesh != null &&\n\t\t\t\t\tthis.#meshComponentBeingProcessed.material != null &&\n\t\t\t\t\tthis.#meshComponentBeingProcessed.batchedProps != null\n\t\t\t\t) {\n\t\t\t\t\tthis.#geometryGroupBeingProcessed = geometry.parentObject3D;\n\t\t\t\t\tthis.#meshComponentBeingProcessed.visible = false;\n\t\t\t\t\tconst color = new Color(this.#styleComponentBeingProcessed.color);\n\t\t\t\t\tconst opacity = this.#styleComponentBeingProcessed.opacity * getGroupContainerOpacity(geometry);\n\n\t\t\t\t\t// TODO: a bigger change but we should be able to use a regular Mesh and MeshLambertMaterial for these\n\t\t\t\t\t// This isn't a huge deal as we're creating batched material and mesh only for one geometry but there's probably\n\t\t\t\t\t// some overhead that could be avoided\n\t\t\t\t\tconst newMaterial = new BatchedStandardMaterial(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcolor,\n\t\t\t\t\t\t\tside: DoubleSide,\n\t\t\t\t\t\t\topacity: opacity ?? 1,\n\t\t\t\t\t\t\ttransparent: opacity !== undefined ? opacity < 1 : false,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t1,\n\t\t\t\t\t\tthis.#meshComponentBeingProcessed.material.repeatYFactor,\n\t\t\t\t\t);\n\n\t\t\t\t\tconst newMesh = new EntityBatchedMesh(\n\t\t\t\t\t\t1,\n\t\t\t\t\t\tthis.#meshComponentBeingProcessed.batchedProps.positionCount,\n\t\t\t\t\t\t0,\n\t\t\t\t\t\tnewMaterial,\n\t\t\t\t\t);\n\n\t\t\t\t\tconst instance = transferGeometryToNewBatchedMesh(\n\t\t\t\t\t\tthis.#meshComponentBeingProcessed,\n\t\t\t\t\t\tnewMesh,\n\t\t\t\t\t\tthis.#processingMatrix,\n\t\t\t\t\t);\n\n\t\t\t\t\tif (instance == null) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// this is needed for interaction system to work\n\t\t\t\t\tnewMesh.userData = {\n\t\t\t\t\t\tentities: {\n\t\t\t\t\t\t\t0: geometry.id,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdetached: true,\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.#meshComponentBeingProcessed.instanceIndex = instance;\n\t\t\t\t\tthis.#meshComponentBeingProcessed.material.setColor(\n\t\t\t\t\t\tthis.#meshComponentBeingProcessed.instanceIndex,\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t\tthis.#styleComponentBeingProcessed.topColor\n\t\t\t\t\t\t\t? new Color(this.#styleComponentBeingProcessed.topColor)\n\t\t\t\t\t\t\t: color,\n\t\t\t\t\t);\n\n\t\t\t\t\tthis.#meshComponentBeingProcessed.mesh = newMesh;\n\t\t\t\t\tthis.#meshComponentBeingProcessed.material = newMaterial;\n\n\t\t\t\t\tthis.#geometryGroupBeingProcessed.add(newMesh);\n\t\t\t\t\tthis.#meshComponentBeingProcessed.shouldDetach = false;\n\t\t\t\t\tthis.#meshComponentBeingProcessed.detached = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tupdate() {\n\t\tif (!this.dirty) {\n\t\t\treturn;\n\t\t}\n\t\tlet geometry: All3DTypes | undefined;\n\t\tfor (let geometryId of this.rendererState.geometry3DIdsInScene) {\n\t\t\tgeometry = this.rendererState.geometry3DMap.get(geometryId);\n\t\t\tthis.updateOne(geometry);\n\t\t}\n\t\tthis.dirty = false;\n\t\tthis.cleanup();\n\t}\n\n\tprivate cleanup() {\n\t\tthis.#meshComponentBeingProcessed = undefined;\n\t\tthis.#geometryGroupBeingProcessed = undefined;\n\t\tthis.#styleComponentBeingProcessed = undefined;\n\t}\n}\n", "import { Geometry3D, Geometry3DComponents } from '../../entities';\nimport type { MeshComponent } from '../../components/mesh';\nimport type { StyleComponent } from '../../components/styles/style';\nimport type { EntityTypes, RendererState } from '../../renderer';\nimport { updateAltitude, updateHeight } from './utils';\nimport { Matrix4, Quaternion, Vector3 } from 'three';\n\n/**\n * Any physical changes to geometry should go in here. This includes height changes, etc.\n * This is to ensure that physical changes apply before any other systems need to do their work,\n * such as the outline system.\n *\n * TODO: For now, this piggybacks of style.dirty, but we may want to create a flag indicating geometry dirty.\n */\nexport class MeshModificationSystem {\n\trendererState: RendererState;\n\tdirty = false;\n\tconstructor(rendererState: RendererState) {\n\t\tthis.rendererState = rendererState;\n\t}\n\n\t#meshComponentBeingProcessed?: MeshComponent;\n\t#styleComponentBeingProcessed?: StyleComponent;\n\t// these are reused for updating the geometry position\n\t#processingMatrix = new Matrix4();\n\t#processingPosition = new Vector3();\n\t#processingQuaternion = new Quaternion();\n\t#processingScale = new Vector3();\n\n\t// I am starting to add `updateOne` methods, so that in the future a huge optimization\n\t// will be to have a single loop running in the render system and calling all the `updateOne`\n\t// methods of all the systems. This way we loop once through all geometries per frame\n\t// we can leave the `update` method for unit testing\n\tupdateOne(entity?: EntityTypes) {\n\t\tif (\n\t\t\tentity instanceof Geometry3D &&\n\t\t\tentity.type === 'geometry' &&\n\t\t\tentity.components[Geometry3DComponents.Style]?.dirty\n\t\t) {\n\t\t\tthis.#meshComponentBeingProcessed = entity.components[Geometry3DComponents.Mesh] as MeshComponent;\n\t\t\tthis.#styleComponentBeingProcessed = entity.components[Geometry3DComponents.Style] as StyleComponent;\n\n\t\t\tif (entity.type === 'geometry') {\n\t\t\t\tlet modified = false;\n\t\t\t\tif (this.#styleComponentBeingProcessed.height !== this.#meshComponentBeingProcessed.currentHeight) {\n\t\t\t\t\tmodified = updateHeight(\n\t\t\t\t\t\tthis.#meshComponentBeingProcessed,\n\t\t\t\t\t\tthis.#styleComponentBeingProcessed.height,\n\t\t\t\t\t\tthis.#styleComponentBeingProcessed.initialHeight,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (this.#styleComponentBeingProcessed.altitude !== this.#meshComponentBeingProcessed.altitude) {\n\t\t\t\t\tmodified = updateAltitude(\n\t\t\t\t\t\tthis.#meshComponentBeingProcessed,\n\t\t\t\t\t\tthis.#styleComponentBeingProcessed.altitude,\n\t\t\t\t\t\tthis.#processingMatrix,\n\t\t\t\t\t\tthis.#processingPosition,\n\t\t\t\t\t\tthis.#processingQuaternion,\n\t\t\t\t\t\tthis.#processingScale,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tif (modified && this.#meshComponentBeingProcessed.mesh != null) {\n\t\t\t\t\t// we must recompute the bounding sphere for frustrum culling to handle the updated geometry position\n\t\t\t\t\tthis.#meshComponentBeingProcessed.mesh.computeBoundingSphere();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tupdate() {\n\t\tlet entity: EntityTypes | undefined;\n\t\tfor (const entityId of this.rendererState.geometry3DIdsInScene) {\n\t\t\tentity = this.rendererState.geometry3DMap.get(entityId);\n\t\t\tthis.updateOne(entity);\n\t\t}\n\t\tthis.cleanup();\n\t}\n\n\tcleanup() {\n\t\tthis.#meshComponentBeingProcessed = undefined;\n\t\tthis.#styleComponentBeingProcessed = undefined;\n\t}\n}\n", "import type { BatchedMeshGeometryRange, Matrix4, Quaternion, Vector3 } from 'three';\nimport type { MeshComponent } from '../../components/mesh';\nimport { updateBufferGeometryHeight } from '../outline-interpolation/utils';\n\nexport function updateHeight(component: MeshComponent, height: number, initialHeight: number) {\n\tif (component.batchedProps?.range && component.mesh) {\n\t\tlet newHeight = height || 0.0001;\n\t\tlet repeatScalingFactor = newHeight / Math.max(initialHeight, 0.0001);\n\t\tupdateBufferGeometryHeight(\n\t\t\tcomponent.mesh.geometry,\n\t\t\tcomponent.batchedProps.range as BatchedMeshGeometryRange,\n\t\t\tnewHeight,\n\t\t\t0,\n\t\t);\n\t\tif (component.material) {\n\t\t\tcomponent.material.repeatYFactor = repeatScalingFactor;\n\t\t}\n\t\tcomponent.currentHeight = newHeight;\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\nexport function updateAltitude(\n\tcomponent: MeshComponent,\n\taltitude: number,\n\tmatrix: Matrix4,\n\tposition: Vector3,\n\tquaternion: Quaternion,\n\tscale: Vector3,\n) {\n\tif (component.mesh && component.instanceIndex !== -1) {\n\t\tcomponent.mesh.getMatrixAt(component.instanceIndex, matrix);\n\t\tmatrix.decompose(position, quaternion, scale);\n\t\tposition.z = altitude;\n\t\tmatrix.compose(position, quaternion, scale);\n\t\tcomponent.mesh.setMatrixAt(component.instanceIndex, matrix);\n\n\t\tcomponent.altitude = altitude;\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n", "import type Core from '../renderer';\n\n/**\n * Default debug state configuration with all debug features disabled by default.\n */\nconst DEFAULT_DEBUG_STATE = {\n\t/** Shows the text area mesh used for polygon label rendering */\n\tshowPolygonLabelTextAreaMesh: false,\n\t/** Enables the basic environment map for lighting and reflections */\n\tshowEnvMap: false,\n\t/** Shows collision detection boxes for debugging spatial interactions */\n\tshowCollisionBoxes: false,\n};\n\n/**\n * Type definition for the debug state configuration.\n * Represents all available debug options that can be toggled.\n */\nexport type DebugState = typeof DEFAULT_DEBUG_STATE;\n\n/**\n * Debug utility class for toggling various debug visualization features.\n *\n * This class provides a centralized way to control debug features like:\n * - Text area mesh visualization for polygon labels\n * - Environment map rendering\n * - Collision box visualization\n *\n * @example\n * ```typescript\n * const debug = new Debug(core);\n *\n * // Enable collision boxes and environment map\n * debug.update({\n *   showCollisionBoxes: true,\n *   showEnvMap: true\n * });\n *\n * // Disable all debug features\n * debug.update({\n *   showCollisionBoxes: false,\n *   showEnvMap: false,\n *   showPolygonLabelTextAreaMesh: false\n * });\n * ```\n */\nexport class Debug {\n\t/** Current debug state configuration */\n\tstate = DEFAULT_DEBUG_STATE;\n\t/** Reference to the core renderer instance */\n\tcore: Core;\n\n\t/**\n\t * Creates a new Debug instance.\n\t *\n\t * @param core - The core renderer instance to control debug features for\n\t */\n\tconstructor(core: Core) {\n\t\tthis.core = core;\n\t}\n\n\t/**\n\t * Updates the debug state with new configuration options.\n\t * Only changed values will trigger updates to the corresponding systems.\n\t *\n\t * @param updateState - Partial debug state with the options to update\n\t *\n\t * @example\n\t * ```typescript\n\t * // Enable only collision boxes\n\t * debug.update({ showCollisionBoxes: true });\n\t *\n\t * // Enable multiple features at once\n\t * debug.update({\n\t *   showEnvMap: true,\n\t *   showPolygonLabelTextAreaMesh: true\n\t * });\n\t * ```\n\t */\n\tupdate(updateState: Partial<DebugState>) {\n\t\tconst diff: Partial<DebugState> = {};\n\t\tfor (const [key, value] of Object.entries(updateState)) {\n\t\t\tif (key in this.state && this.state[key] !== updateState[key]) {\n\t\t\t\tthis.state[key as keyof DebugState] = value;\n\t\t\t\tdiff[key] = value;\n\t\t\t}\n\t\t}\n\t\tthis.handleUpdate(diff);\n\t}\n\n\t/**\n\t * Handles the actual system updates based on changed debug state values.\n\t * This method applies the debug state changes to the appropriate renderer systems.\n\t *\n\t * @param diff - Object containing only the debug state properties that changed\n\t * @private\n\t */\n\tprivate handleUpdate(diff: Partial<DebugState>) {\n\t\t// Toggle text area mesh visibility for polygon labels\n\t\tif (diff.showPolygonLabelTextAreaMesh != null) {\n\t\t\tif (diff.showPolygonLabelTextAreaMesh) {\n\t\t\t\tthis.core.getSystems().text3DSystem.showTextAreaMesh();\n\t\t\t} else {\n\t\t\t\tthis.core.getSystems().text3DSystem.hideTextAreaMesh();\n\t\t\t}\n\t\t}\n\n\t\t// Toggle environment map rendering\n\t\tif (diff.showEnvMap != null) {\n\t\t\tif (diff.showEnvMap) {\n\t\t\t\tthis.core.setEnvironment('basic');\n\t\t\t} else {\n\t\t\t\tthis.core.setEnvironment(false);\n\t\t\t}\n\t\t}\n\n\t\t// Toggle collision box visualization\n\t\tif (diff.showCollisionBoxes != null) {\n\t\t\tif (diff.showCollisionBoxes) {\n\t\t\t\tthis.core.getSystems().collisionSystem.showCollisionBoxes();\n\t\t\t\tthis.core.render(); // needed to re-render the debug dom\n\t\t\t} else {\n\t\t\t\tthis.core.getSystems().collisionSystem.hideCollisionBoxes();\n\t\t\t}\n\t\t}\n\t}\n}\n", "import type { RendererState } from '../../renderer';\nimport {\n\tShaderMaterial,\n\tWebGLRenderTarget,\n\tGLSL3,\n\ttype BufferGeometry,\n\ttype WebGLRenderer,\n\tColor,\n\tRGBAFormat,\n\tUnsignedByteType,\n\tBufferAttribute,\n\ttype Scene,\n\tMesh,\n\ttype Vector3,\n} from 'three';\nimport { Geometry2DComponents } from '../../entities';\nimport type { Renderer } from '../../services/renderer';\nimport { GroupContainerObject3D } from '../../entities/group-container';\nimport type { Feature, MultiPolygon, Polygon, Position as GeoJsonPosition } from 'geojson';\nimport { renderPolygonGeometry } from '../../geometry/polygons';\nimport { renderMultiPolygonGeometry } from '../../geometry/multi-polygon';\nimport { Logger } from '@packages/internal/common';\n\nconst OCCLUSION_CAMERA_LAYER = 9;\n\nconst DEBUG = false;\n\nconst DEFAULT_OCCLUDER_HEIGHT = 0.1;\n\nexport function fillArrayWithColor(array: Float32Array | Uint8Array, count: number, color: number) {\n\tfor (let i = 0; i < count; i++) {\n\t\t// convert numeric (hex) value to rgb:\n\t\tconst r = (color & 0xff0000) >> 16;\n\t\tconst g = (color & 0x00ff00) >> 8;\n\t\tconst b = color & 0x0000ff;\n\t\tarray[i * 3] = r / 255;\n\t\tarray[i * 3 + 1] = g / 255;\n\t\tarray[i * 3 + 2] = b / 255;\n\t}\n}\n\nexport class Occlusion2DSystem {\n\tprivate state: RendererState;\n\tprivate renderer: WebGLRenderer;\n\tprivate renderService: Renderer;\n\tprivate pickingTexture?: WebGLRenderTarget;\n\tprivate pickingMaterial: ShaderMaterial;\n\tprivate pixelBuffer?: Uint8Array;\n\tprivate width = 0;\n\tprivate height = 0;\n\tprivate scale = 1 / 2;\n\tprivate color = 0x000001;\n\tprivate convertTo3DMapPosition: (position: GeoJsonPosition) => Vector3;\n\tprivate destroyed = false;\n\tprivate enabled = false;\n\tbackgroundId = 0xffffff;\n\n\t/**\n\t * Applies the id to the geometry which is encoded as a color\n\t */\n\tprivate applyId(geometry: BufferGeometry, color: number) {\n\t\tconst position = geometry.attributes.position;\n\t\tconst array = new Float32Array(position.count * 3);\n\t\tfillArrayWithColor(array, position.count, color);\n\n\t\tgeometry.setAttribute('color', new BufferAttribute(array, 3));\n\t}\n\n\tprivate createOccluderMesh(geometry: BufferGeometry, occluderId: number) {\n\t\tconst mesh = new Mesh(geometry, this.pickingMaterial);\n\t\tmesh.layers.set(OCCLUSION_CAMERA_LAYER);\n\t\tthis.applyId(mesh.geometry, occluderId);\n\n\t\tmesh.userData.occluderId = occluderId;\n\n\t\treturn mesh;\n\t}\n\n\tconstructor(\n\t\tstate: RendererState,\n\t\tconvertTo3DMapPosition: (position: GeoJsonPosition) => Vector3,\n\t\trenderer?: Renderer,\n\t) {\n\t\tthis.state = state;\n\t\tthis.convertTo3DMapPosition = convertTo3DMapPosition;\n\t\tif (renderer?.renderer == null) {\n\t\t\tthrow new Error('No Renderer');\n\t\t}\n\t\tthis.renderService = renderer;\n\t\tthis.renderer = renderer.renderer;\n\t\tthis.resize();\n\t\tthis.pickingMaterial = new ShaderMaterial({\n\t\t\tglslVersion: GLSL3,\n\n\t\t\tvertexShader: /* glsl */ `\n\t\t\t\tattribute vec3 color;\n\t\t\t\tvarying vec3 vColor;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvColor = color;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t\t\t}\n\t\t\t`,\n\n\t\t\tfragmentShader: /* glsl */ `\n\t\t\t\tvarying vec3 vColor;\n\t\t\t\tout vec4 fragColor;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tfragColor = vec4(vColor, 1.0);\n\t\t\t\t}\n\t\t\t`,\n\t\t});\n\t}\n\n\treserveOccluderId() {\n\t\tthis.color++;\n\n\t\treturn this.color;\n\t}\n\n\tenable() {\n\t\tthis.enabled = true;\n\t}\n\n\tdisable() {\n\t\tthis.enabled = false;\n\t}\n\n\tresize = () => {\n\t\tconst dpr = this.state.pixelRatio;\n\n\t\tthis.width = Math.floor((this.renderer.domElement.width / dpr) * this.scale);\n\t\tthis.height = Math.floor((this.renderer.domElement.height / dpr) * this.scale);\n\t\tthis.pixelBuffer = new Uint8Array(4 * this.width * this.height);\n\n\t\tthis.pickingTexture = new WebGLRenderTarget(this.width, this.height, {\n\t\t\tformat: RGBAFormat,\n\t\t\ttype: UnsignedByteType,\n\t\t\tinternalFormat: 'RGBA',\n\t\t});\n\t};\n\n\tprivate shouldShowByXY = (x: number, y: number, id: number) => {\n\t\tif (this.pixelBuffer == null) {\n\t\t\treturn false;\n\t\t}\n\t\tconst pixelIndex = x + (this.height - y - 1) * this.width;\n\n\t\t// let's convert the pixel buffer rgb to a numeric color value\n\t\tconst r = this.pixelBuffer[pixelIndex * 4];\n\t\tconst g = this.pixelBuffer[pixelIndex * 4 + 1];\n\t\tconst b = this.pixelBuffer[pixelIndex * 4 + 2];\n\t\tconst color = (r << 16) | (g << 8) | b;\n\n\t\tif (color === id || color === this.backgroundId) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t};\n\n\t// this ensures if an occluder is not active (ie not in the scene),\n\t// we don't hide all colliders associated with this occluder\n\tactiveOccluders = new Set();\n\n\tupdate = () => {\n\t\tif (!this.enabled || this.destroyed) {\n\t\t\treturn;\n\t\t}\n\t\tthis.activeOccluders.clear();\n\t\tthis.activeOccluders.add(this.backgroundId);\n\t\tif (!this.pickingTexture || !this.pixelBuffer) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet feature: Feature<Polygon | MultiPolygon, any>;\n\t\tlet mesh: Mesh;\n\n\t\tfor (const entityId of this.state.geometry3DIdsInScene) {\n\t\t\tconst entity = this.state.geometry3DMap.get(entityId);\n\t\t\tif (\n\t\t\t\tentity &&\n\t\t\t\tentity instanceof GroupContainerObject3D &&\n\t\t\t\tentity.userData.occluderFeature != null &&\n\t\t\t\tentity.userData.occluderId != null\n\t\t\t) {\n\t\t\t\t// if (entity.userData.occluderId !== this.backgroundId) {\n\t\t\t\tthis.activeOccluders.add(entity.userData.occluderId);\n\t\t\t\t// }\n\n\t\t\t\t// populate and create occluders\n\t\t\t\tif (entity.userData.occluderDirty) {\n\t\t\t\t\tfeature = entity.userData.occluderFeature;\n\t\t\t\t\tif (feature.geometry.type === 'Polygon') {\n\t\t\t\t\t\tconst geometry = renderPolygonGeometry(feature as Feature<Polygon, any>, this.convertTo3DMapPosition, {\n\t\t\t\t\t\t\tcolor: 'white',\n\t\t\t\t\t\t\theight: DEFAULT_OCCLUDER_HEIGHT,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tmesh = this.createOccluderMesh(geometry, entity.userData.occluderId);\n\t\t\t\t\t\tentity.add(mesh);\n\t\t\t\t\t} else if (feature.geometry.type === 'MultiPolygon') {\n\t\t\t\t\t\tconst geometry = renderMultiPolygonGeometry(\n\t\t\t\t\t\t\tfeature as Feature<MultiPolygon, any>,\n\t\t\t\t\t\t\tthis.convertTo3DMapPosition,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcolor: 'white',\n\t\t\t\t\t\t\t\theight: DEFAULT_OCCLUDER_HEIGHT,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t\tmesh = this.createOccluderMesh(geometry, entity.userData.occluderId);\n\t\t\t\t\t\tentity?.add(mesh);\n\t\t\t\t\t}\n\n\t\t\t\t\tentity.userData.occluderDirty = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// set the render target to the picking texture\n\t\tthis.renderer.setRenderTarget(this.pickingTexture);\n\t\t// clear the render target and set the clear color to black, which we will use as the \"background\" color\n\t\tconst clearColor = new Color(this.backgroundId);\n\t\tthis.renderer.setClearColor(clearColor);\n\t\tthis.renderer.clear();\n\t\t// disable all layers\n\t\tthis.state.cameraObject.layers.disableAll();\n\t\t// enable the occlusion layer\n\t\tthis.state.cameraObject.layers.enable(OCCLUSION_CAMERA_LAYER);\n\t\t// render the scene\n\t\tthis.renderer.render(this.state.entityScene.parent as Scene, this.state.cameraObject);\n\t\t// reset the render target\n\t\tthis.renderer.setRenderTarget(null);\n\t\tthis.state.cameraObject.layers.disable(OCCLUSION_CAMERA_LAYER);\n\n\t\tif (DEBUG) {\n\t\t\t// enable the occlusion layer\n\t\t\tthis.renderService.enabledLayers.add(OCCLUSION_CAMERA_LAYER);\n\t\t} else {\n\t\t\t// disable the occlusion layer\n\t\t\tthis.renderService.enabledLayers.delete(OCCLUSION_CAMERA_LAYER);\n\t\t}\n\n\t\t// read the pixels from the picking texture\n\t\tthis.renderer\n\t\t\t.readRenderTargetPixelsAsync(this.pickingTexture, 0, 0, this.width, this.height, this.pixelBuffer)\n\t\t\t.then(() => {\n\t\t\t\tif (this.destroyed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tfor (const entityId of this.state.geometry2DIdsInScene) {\n\t\t\t\t\tconst entity = this.state.geometry2DMap.get(entityId);\n\t\t\t\t\tif (entity && entity?.occluderId != null && this.activeOccluders.has(entity?.occluderId)) {\n\t\t\t\t\t\tconst projection = entity.components[Geometry2DComponents.UI].projection;\n\t\t\t\t\t\tconst x = Math.floor(projection.x * this.scale);\n\t\t\t\t\t\tconst y = Math.floor(projection.y * this.scale);\n\t\t\t\t\t\t// check if the entity is occluded by the picking texture\n\t\t\t\t\t\tconst shouldShow = this.shouldShowByXY(x, y, entity.occluderId);\n\t\t\t\t\t\tentity.components[Geometry2DComponents.UI].isOccluded = !shouldShow;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tif (this.destroyed) {\n\t\t\t\t\t// Expected error when system is being destroyed, ignore silently\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tLogger.error(error);\n\t\t\t});\n\t};\n\n\tdestroy() {\n\t\tthis.destroyed = true;\n\t\tthis.pickingTexture?.dispose();\n\t\tthis.pickingMaterial.dispose();\n\t\tthis.pickingTexture = undefined;\n\t\tthis.pixelBuffer = undefined;\n\t}\n}\n", "import { Geometry3D, Geometry3DComponents } from '../../entities';\nimport type { RendererState } from '../../renderer';\n\n/**\n * This system is responsible for disposing of geometries that are no longer needed.\n * It runs at the end of the render loop, so that we can create outlines and whatever is needed in the frame.\n */\n\nexport class GeometryDisposalSystem {\n\tdirty = true;\n\tconstructor(private readonly state: RendererState) {}\n\n\tupdate() {\n\t\tif (!this.dirty) {\n\t\t\treturn;\n\t\t}\n\t\tfor (const entityId of this.state.geometry3DIdsInScene) {\n\t\t\tconst entity = this.state.geometry3DMap.get(entityId);\n\t\t\tif (\n\t\t\t\tentity instanceof Geometry3D &&\n\t\t\t\tentity.type === 'geometry' &&\n\t\t\t\tentity.components[Geometry3DComponents.Mesh]?.geometry != null\n\t\t\t) {\n\t\t\t\tconst meshComponent = entity.components[Geometry3DComponents.Mesh];\n\t\t\t\tif (meshComponent.geometry) {\n\t\t\t\t\tmeshComponent.geometry.dispose();\n\t\t\t\t\tmeshComponent.geometry = undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.dirty = false;\n\t}\n}\n", "import type { RendererState } from '../../renderer';\nimport { PubSub } from '@packages/internal/common';\nimport { Geometry3D, Geometry3DComponents } from '../../entities';\nimport { type Texture } from 'three';\nimport { MeshComponent } from '../../components/mesh';\nimport { TextureComponent } from '../../components/texture';\nimport { getMaterial } from '../draw/utils';\nimport { TextureLoader } from '../../utils/texture-loader';\n\nexport class TextureSystem extends PubSub<{\n\t'texture-added': void;\n}> {\n\tdirty = true;\n\tstate: RendererState;\n\tconstructor(state: RendererState) {\n\t\tsuper();\n\n\t\tthis.state = state;\n\t}\n\n\ttexturePromiseCache: Map<string, Promise<Texture>> = new Map();\n\n\tasync loadTexture(path: string) {\n\t\tif (this.texturePromiseCache.has(path)) {\n\t\t\treturn this.texturePromiseCache.get(path);\n\t\t}\n\t\tconst promise = new Promise<Texture>((resolve, reject) => {\n\t\t\tTextureLoader.getLoader().load(path, resolve, undefined, reject);\n\t\t});\n\t\tthis.texturePromiseCache.set(path, promise);\n\t\treturn promise;\n\t}\n\n\tupdate() {\n\t\tfor (const geometryId of this.state.geometry3DIdsInScene) {\n\t\t\tconst geometry = this.state.geometry3DMap.get(geometryId);\n\t\t\tif (!(geometry instanceof Geometry3D)) continue;\n\n\t\t\tconst textureComponent = geometry.components[Geometry3DComponents.TextureComponent];\n\t\t\tif (!(textureComponent instanceof TextureComponent)) continue;\n\n\t\t\tconst meshComponent = geometry.components[Geometry3DComponents.Mesh];\n\t\t\tif (!(meshComponent instanceof MeshComponent)) continue;\n\n\t\t\tif (!textureComponent.dirty) continue;\n\n\t\t\tconst material = getMaterial(meshComponent);\n\t\t\tif (material == null) continue;\n\n\t\t\tif (textureComponent.texture != null) {\n\t\t\t\tif (textureComponent.texture.path === '') {\n\t\t\t\t\tmaterial.texture = null;\n\t\t\t\t\tmaterial.hideTextures(meshComponent.instanceIndex);\n\t\t\t\t\ttextureComponent.dirty = false;\n\t\t\t\t} else {\n\t\t\t\t\tthis.loadTexture(textureComponent.texture.path).then(texture => {\n\t\t\t\t\t\tif (texture) {\n\t\t\t\t\t\t\ttextureComponent.textureInstance = texture;\n\t\t\t\t\t\t\tmaterial.texture = texture;\n\t\t\t\t\t\t\tmaterial.blendTexture = true;\n\t\t\t\t\t\t\tmaterial.showTextures(meshComponent.instanceIndex);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.publish('texture-added');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (textureComponent.topTexture != null) {\n\t\t\t\tif (textureComponent.topTexture.path === '') {\n\t\t\t\t\tmaterial.topTexture = null;\n\t\t\t\t\tmaterial.hideTextures(meshComponent.instanceIndex);\n\t\t\t\t\ttextureComponent.dirty = false;\n\t\t\t\t} else {\n\t\t\t\t\tthis.loadTexture(textureComponent.topTexture.path).then(texture => {\n\t\t\t\t\t\tif (texture) {\n\t\t\t\t\t\t\ttextureComponent.topTextureInstance = texture;\n\t\t\t\t\t\t\tmaterial.topTexture = texture;\n\t\t\t\t\t\t\tmaterial.blendTexture = true;\n\t\t\t\t\t\t\tmaterial.showTextures(meshComponent.instanceIndex);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.publish('texture-added');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\ttextureComponent.dirty = false;\n\t\t}\n\t}\n\n\tdestroy() {\n\t\tthis.texturePromiseCache.forEach(async t => {\n\t\t\t(await t).dispose();\n\t\t});\n\t\tthis.texturePromiseCache.clear();\n\t}\n}\n", "import type { ModelComponent } from '../../components/model';\nimport type { ModelStyleComponnet } from '../../components/styles';\nimport { Geometry3DComponents } from '../../entities';\nimport type { EntityTypes, RendererState } from '../../renderer';\nimport { RENDER_LAYERS } from '../../utils/constants';\n\n/**\n * System for managing dynamic render order assignment for always-on-top elements.\n */\nexport class RenderOrderSystem {\n\t// TODO: use groupings to support more than just models for this\n\tprivate currentOrder = RENDER_LAYERS.ALWAYS_ON_TOP_MODELS;\n\tprivate assignedOrders = new WeakMap<object, number>();\n\tprivate state: RendererState;\n\n\tconstructor(state: RendererState) {\n\t\tthis.state = state;\n\t}\n\n\t/**\n\t * Assigns a unique render order for an overlay object\n\t * @param object - The object to assign render order to\n\t * @returns The assigned render order\n\t */\n\tassignOrder(object: object): number {\n\t\tif (this.assignedOrders.has(object)) {\n\t\t\treturn this.assignedOrders.get(object)!;\n\t\t}\n\n\t\tthis.currentOrder += 1;\n\t\tthis.assignedOrders.set(object, this.currentOrder);\n\n\t\treturn this.currentOrder;\n\t}\n\n\t/**\n\t * Releases the render order for an object\n\t * @param object - The object to release render order from\n\t * @returns The default render order\n\t */\n\treleaseOrder(object: object): number {\n\t\tthis.assignedOrders.delete(object);\n\n\t\treturn RENDER_LAYERS.GEOMETRY;\n\t}\n\n\t/**\n\t * Gets the current highest render order\n\t * @returns The current highest render order\n\t */\n\tgetHighestOrder(): number {\n\t\treturn this.currentOrder;\n\t}\n\n\t/**\n\t * Gets the assigned render order for an object\n\t * @param object - The object to get render order for\n\t * @returns The render order or undefined if not assigned\n\t */\n\tgetOrder(object: object): number | undefined {\n\t\treturn this.assignedOrders.get(object);\n\t}\n\n\tupdate() {\n\t\tlet styleComponent: ModelStyleComponnet | undefined;\n\t\tlet meshComponent: ModelComponent | undefined;\n\t\tlet entity: EntityTypes | undefined;\n\t\tfor (const entityId of this.state.geometry3DIdsInScene) {\n\t\t\tentity = this.state.geometry3DMap.get(entityId);\n\n\t\t\t// TODO: support more than just models for this\n\t\t\tif (entity && entity.type === 'model') {\n\t\t\t\tif (entity.components[Geometry3DComponents.Style]?.dirty) {\n\t\t\t\t\tstyleComponent = entity.components[Geometry3DComponents.Style];\n\t\t\t\t\tmeshComponent = entity.components[Geometry3DComponents.Mesh];\n\n\t\t\t\t\tif (styleComponent.visibleThroughGeometry === true) {\n\t\t\t\t\t\tconst renderOrder = this.assignOrder(meshComponent);\n\t\t\t\t\t\tif (meshComponent.renderOrder !== renderOrder) {\n\t\t\t\t\t\t\tmeshComponent.renderOrder = renderOrder;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (meshComponent.renderOrder > RENDER_LAYERS.GEOMETRY) {\n\t\t\t\t\t\tmeshComponent.renderOrder = this.releaseOrder(meshComponent);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n", "import { Geometry3DComponents } from '../../entities';\nimport type { EntityTypes, RendererState } from '../../renderer';\nimport type { ClippingPlaneComponent } from '../../components/clipping-plane';\nimport type { ModelComponent } from '../../components/model';\nimport {\n\tAlwaysStencilFunc,\n\tBackSide,\n\ttype BufferGeometry,\n\tDecrementWrapStencilOp,\n\tFrontSide,\n\tGroup,\n\tIncrementWrapStencilOp,\n\tMesh,\n\tMeshBasicMaterial,\n\tMeshStandardMaterial,\n\tNotEqualStencilFunc,\n\tPlane,\n\tPlaneGeometry,\n\tReplaceStencilOp,\n\tVector3,\n} from 'three';\nimport * as BufferGeometryUtils from 'three/examples/jsm/utils/BufferGeometryUtils.js';\n\n/**\n * This system is responsible for creating the clipping plane and the hole fill mesh. From: https://threejs.org/examples/#webgl_clipping_stencil\n */\n\n// this is the max size of the plane geometry to be used as the hole fill mesh, ie this should be as big as the cross section of the model from the top\nconst MAX_PLANE_SIZE = 500;\n\nexport class ClippingPlaneSystem {\n\trendererState: RendererState;\n\tdirty = false;\n\tconstructor(rendererState: RendererState) {\n\t\tthis.rendererState = rendererState;\n\t}\n\n\tupdate() {\n\t\tlet entity: EntityTypes | undefined;\n\t\tlet clippingPlaneComponent: ClippingPlaneComponent | undefined;\n\t\tlet meshComponent: ModelComponent | undefined;\n\t\tfor (const entityId of this.rendererState.geometry3DIdsInScene) {\n\t\t\tentity = this.rendererState.geometry3DMap.get(entityId);\n\t\t\tif (entity?.type === 'model' && entity.components[Geometry3DComponents.ClippingPlane] != null) {\n\t\t\t\tmeshComponent = entity.components[Geometry3DComponents.Mesh] as ModelComponent;\n\t\t\t\tclippingPlaneComponent = entity.components[Geometry3DComponents.ClippingPlane] as ClippingPlaneComponent;\n\n\t\t\t\tif (\n\t\t\t\t\tclippingPlaneComponent.dirty &&\n\t\t\t\t\tmeshComponent.mesh != null &&\n\t\t\t\t\tclippingPlaneComponent?.verticalOffset !== Infinity\n\t\t\t\t) {\n\t\t\t\t\tif (clippingPlaneComponent.plane == null) {\n\t\t\t\t\t\tclippingPlaneComponent.plane = new Plane(new Vector3(0, 0, -1), clippingPlaneComponent.verticalOffset);\n\t\t\t\t\t\tthis.process(meshComponent, clippingPlaneComponent);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (clippingPlaneComponent.plane.constant !== clippingPlaneComponent.verticalOffset) {\n\t\t\t\t\t\tclippingPlaneComponent.plane.constant = clippingPlaneComponent.verticalOffset;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tclippingPlaneComponent.topColor != null &&\n\t\t\t\t\t\tclippingPlaneComponent.holeFillMesh?.material instanceof MeshStandardMaterial\n\t\t\t\t\t) {\n\t\t\t\t\t\tclippingPlaneComponent.holeFillMesh.material.color.set(clippingPlaneComponent.topColor);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (clippingPlaneComponent.topVisible != null && clippingPlaneComponent.holeFillMesh != null) {\n\t\t\t\t\t\tclippingPlaneComponent.holeFillMesh.visible = clippingPlaneComponent.topVisible;\n\t\t\t\t\t}\n\n\t\t\t\t\tclippingPlaneComponent.dirty = false;\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tclippingPlaneComponent.plane != null &&\n\t\t\t\t\tclippingPlaneComponent.holeFillMesh != null &&\n\t\t\t\t\tclippingPlaneComponent.topVisible === true\n\t\t\t\t) {\n\t\t\t\t\tconst plane = clippingPlaneComponent.plane;\n\t\t\t\t\tconst po = clippingPlaneComponent.holeFillMesh;\n\t\t\t\t\tplane.coplanarPoint(po.position);\n\t\t\t\t\tpo.lookAt(po.position.x - plane.normal.x, po.position.y - plane.normal.y, po.position.z - plane.normal.z);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate process(meshComponent: ModelComponent, clippingPlaneComponent: ClippingPlaneComponent) {\n\t\tif (meshComponent.mesh == null) {\n\t\t\treturn;\n\t\t}\n\t\tconst parent = meshComponent.mesh.parent!;\n\n\t\tconst geometries: BufferGeometry[] = [];\n\t\t// we need to create a merged geometry of all the vertices of this nested mesh\n\t\tmeshComponent.mesh.traverse(child => {\n\t\t\tif (child instanceof Mesh) {\n\t\t\t\t// Clone the geometry to avoid modifying the original\n\t\t\t\tconst clonedGeometry = child.geometry.clone() as BufferGeometry;\n\n\t\t\t\t// Apply the child mesh's world matrix to preserve position, rotation, and scale\n\t\t\t\tchild.updateWorldMatrix(true, false);\n\t\t\t\tclonedGeometry.applyMatrix4(child.matrixWorld);\n\n\t\t\t\tgeometries.push(clonedGeometry);\n\t\t\t\tclonedGeometry.computeVertexNormals();\n\t\t\t\tchild.material.clippingPlanes = [clippingPlaneComponent.plane!];\n\t\t\t\tchild.material.transparent = false;\n\t\t\t}\n\t\t});\n\n\t\t// we need to merge the geometries to create a single geometry that can be used for the hole fill mesh\n\t\tconst mergedGeometry = BufferGeometryUtils.mergeGeometries(geometries);\n\n\t\tconst mainGroup = new Group();\n\t\tconst clippedObjectAndStencilGroup = new Group();\n\n\t\tconst holeFillGroup = this.createHoleFillGeometry(mergedGeometry, clippingPlaneComponent.plane!, 1);\n\t\tholeFillGroup.name = 'hole-fill-group';\n\t\tconst holeFillMaterial = new MeshStandardMaterial({\n\t\t\tcolor: clippingPlaneComponent.topColor ?? '#E67B5B',\n\t\t\tclippingPlanes: [],\n\n\t\t\tstencilWrite: true,\n\t\t\tstencilFunc: NotEqualStencilFunc,\n\t\t\tstencilFail: ReplaceStencilOp,\n\t\t\tstencilZFail: ReplaceStencilOp,\n\t\t\tstencilZPass: ReplaceStencilOp,\n\t\t});\n\n\t\tconst planeGeom = new PlaneGeometry(MAX_PLANE_SIZE, MAX_PLANE_SIZE);\n\t\tconst holeFillMesh = new Mesh(planeGeom, holeFillMaterial);\n\t\tholeFillMesh.name = 'hole-fill-mesh';\n\t\tclippingPlaneComponent.holeFillMesh = holeFillMesh;\n\n\t\tholeFillMesh.renderOrder = 1.1;\n\t\tclippedObjectAndStencilGroup.add(holeFillGroup);\n\t\tclippedObjectAndStencilGroup.add(meshComponent.mesh);\n\n\t\tmainGroup.add(clippedObjectAndStencilGroup);\n\t\tmainGroup.add(holeFillMesh);\n\n\t\tparent?.add(mainGroup);\n\t\tmeshComponent.mesh = mainGroup;\n\t}\n\n\tprivate createHoleFillGeometry(geometry: BufferGeometry, plane: Plane, renderOrder = 0) {\n\t\tconst group = new Group();\n\t\tconst baseMat = new MeshBasicMaterial();\n\t\tbaseMat.depthWrite = false;\n\t\tbaseMat.depthTest = false;\n\t\tbaseMat.colorWrite = false;\n\t\tbaseMat.stencilWrite = true;\n\t\tbaseMat.stencilFunc = AlwaysStencilFunc;\n\n\t\t// back faces\n\t\tconst mat0 = baseMat.clone();\n\t\tmat0.side = BackSide;\n\t\tmat0.clippingPlanes = [plane];\n\t\tmat0.stencilFail = IncrementWrapStencilOp;\n\t\tmat0.stencilZFail = IncrementWrapStencilOp;\n\t\tmat0.stencilZPass = IncrementWrapStencilOp;\n\n\t\tconst mesh0 = new Mesh(geometry, mat0);\n\t\tmesh0.renderOrder = renderOrder;\n\t\tgroup.add(mesh0);\n\n\t\t// front faces\n\t\tconst mat1 = baseMat.clone();\n\t\tmat1.side = FrontSide;\n\t\tmat1.clippingPlanes = [plane];\n\t\tmat1.stencilFail = DecrementWrapStencilOp;\n\t\tmat1.stencilZFail = DecrementWrapStencilOp;\n\t\tmat1.stencilZPass = DecrementWrapStencilOp;\n\n\t\tconst mesh1 = new Mesh(geometry, mat1);\n\t\tmesh1.renderOrder = renderOrder;\n\n\t\tgroup.add(mesh1);\n\n\t\treturn group;\n\t}\n}\n", "import tinycolor from 'tinycolor2';\nimport type Core from '../../../src/renderer';\nimport type { RendererCore, WatermarkUpdateOptions } from '../../../src';\n\nexport function mountSceneGraphVisualizer(mv: Core, gui) {\n\tconst parseChild = createParseChild(mv, gui);\n\tparseChild(mv.getScene(), gui);\n\n\tcreateWatermarkChild(mv, gui);\n\n\tconst xp = gui.addFolder('Export');\n\txp.add(\n\t\t{\n\t\t\texport: async () => {\n\t\t\t\tconst gltf = await mv.getCurrentSceneGLTF({\n\t\t\t\t\tbinary: true,\n\t\t\t\t});\n\t\t\t\tconst blob = new Blob([gltf], { type: 'application/octet-stream' });\n\t\t\t\tvar a = document.createElement('a');\n\t\t\t\tdocument.body.appendChild(a);\n\t\t\t\ta.style.display = 'none';\n\t\t\t\tconst url = window.URL.createObjectURL(blob);\n\t\t\t\ta.href = url;\n\t\t\t\ta.download = 'scene.glb';\n\t\t\t\ta.click();\n\t\t\t\twindow.URL.revokeObjectURL(url);\n\t\t\t},\n\t\t},\n\t\t'export',\n\t);\n\n\tconst camera = gui.addFolder('Camera');\n\tconst state = {\n\t\tget bearing() {\n\t\t\treturn mv.camera.bearing;\n\t\t},\n\t\tset bearing(value) {\n\t\t\tmv.camera.setBearing(value);\n\t\t},\n\t\tget pitch() {\n\t\t\treturn mv.camera.pitch;\n\t\t},\n\t\tset pitch(value) {\n\t\t\tmv.camera.setPitch(value);\n\t\t},\n\t\tget zoomLevel() {\n\t\t\treturn mv.camera.zoomLevel;\n\t\t},\n\t\tset zoomLevel(value) {\n\t\t\tmv.camera.setZoomLevel(value);\n\t\t},\n\t};\n\tcamera.add(state, 'bearing', -359, 359, 1);\n\tcamera.add(state, 'pitch', mv.camera.minPitch, mv.camera.maxPitch, 1);\n\tcamera.add(state, 'zoomLevel', mv.camera.minZoomLevel, mv.camera.maxZoomLevel, 0.1);\n}\n\nfunction createParseChild(mv: RendererCore, root) {\n\tconst gui = root;\n\n\treturn function parseChild(obj, parent) {\n\t\tconst group = parent.addFolder(`${[obj.type]} ${obj.id.slice(0, 16)}`);\n\t\tparent.close();\n\t\tif (obj.type === 'geometry' || obj.type === 'model' || obj.type === 'path' || obj.type === 'image') {\n\t\t\tconst state = {\n\t\t\t\tget height() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'geometry' ? state.height : 0;\n\t\t\t\t},\n\t\t\t\tset height(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'geometry') {\n\t\t\t\t\t\tmv.setState(obj, {\n\t\t\t\t\t\t\theight: value,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tset flipImageToFaceCamera(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'image') {\n\t\t\t\t\t\tmv.setState(obj, {\n\t\t\t\t\t\t\tflipImageToFaceCamera: value,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget flipImageToFaceCamera() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'image' ? state.flipImageToFaceCamera : false;\n\t\t\t\t},\n\t\t\t\tset visible(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'geometry' || state?.type === 'path' || state?.type === 'image') {\n\t\t\t\t\t\tmv.setState(obj, {\n\t\t\t\t\t\t\tvisible: value,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget visible() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'geometry' || state?.type === 'path' || state?.type === 'image'\n\t\t\t\t\t\t? state.visible\n\t\t\t\t\t\t: false;\n\t\t\t\t},\n\t\t\t\tset outline(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'geometry') {\n\t\t\t\t\t\tmv.setState(obj, {\n\t\t\t\t\t\t\toutline: value,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget outline() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'geometry' ? state.outline : false;\n\t\t\t\t},\n\t\t\t\tget opacity() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'geometry' ? state.opacity : 1;\n\t\t\t\t},\n\t\t\t\tset opacity(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'geometry') {\n\t\t\t\t\t\tmv.setState(state, {\n\t\t\t\t\t\t\topacity: value,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget color() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'geometry' && state.color ? tinycolor(state.color).toHexString() : '#ffffff';\n\t\t\t\t},\n\t\t\t\tset color(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'geometry') {\n\t\t\t\t\t\tmv.setState(state, {\n\t\t\t\t\t\t\tcolor: value,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tset interactive(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'geometry' || state?.type === 'model' || state?.type === 'path') {\n\t\t\t\t\t\tmv.setState(obj, {\n\t\t\t\t\t\t\tinteractive: value,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tgui.controllersRecursive().forEach(c => c.updateDisplay());\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget interactive() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'geometry' || state?.type === 'model' || state?.type === 'path'\n\t\t\t\t\t\t? state.interactive\n\t\t\t\t\t\t: false;\n\t\t\t\t},\n\t\t\t\tget completeFraction() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'path' ? state.completeFraction : 1;\n\t\t\t\t},\n\t\t\t\tset completeFraction(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'path') {\n\t\t\t\t\t\tmv.setState(state, {\n\t\t\t\t\t\t\tcompleteFraction: value,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfocus: () => {},\n\t\t\t};\n\t\t\tgroup.add(state, 'focus').onChange(() => {\n\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\tif (state?.type === 'model' || state?.type === 'path' || state?.type === 'image') {\n\t\t\t\t\tmv.camera.focusOn([state.position]);\n\t\t\t\t} else if (state?.type === 'geometry') {\n\t\t\t\t\tmv.camera.focusOn(mv.getBoundingArea(state)!);\n\t\t\t\t}\n\t\t\t});\n\t\t\tgroup.add(state, 'visible');\n\t\t\tif (obj.type === 'image') {\n\t\t\t\tgroup.add(state, 'flipImageToFaceCamera');\n\t\t\t} else {\n\t\t\t\tgroup.add(state, 'interactive');\n\n\t\t\t\tif (obj.type === 'path') {\n\t\t\t\t\tgroup.add(state, 'completeFraction', 0, 1, 0.1);\n\t\t\t\t}\n\t\t\t\tif (obj.type !== 'model') {\n\t\t\t\t\tgroup.addColor(state, 'color');\n\t\t\t\t\tgroup.add(state, 'outline');\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (obj.type === 'geometry') {\n\t\t\t\tgroup.add(state, 'height');\n\t\t\t\tgroup.add(state, 'opacity', 0, 1, 0.1);\n\t\t\t}\n\t\t} else if (obj.type === 'marker') {\n\t\t\tconst state = {\n\t\t\t\tget interactive() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'marker' ? state.options?.interactive : false;\n\t\t\t\t},\n\t\t\t\tset interactive(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'marker') {\n\t\t\t\t\t\tmv.setState(state, {\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tinteractive: value,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tgui.controllersRecursive().forEach(c => c.updateDisplay());\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfocus: () => {},\n\t\t\t};\n\t\t\tgroup.add(state, 'focus').onChange(() => {\n\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\tif (state?.type === 'marker') {\n\t\t\t\t\tmv.camera.focusOn([state.position]);\n\t\t\t\t}\n\t\t\t});\n\t\t\tgroup.add(state, 'interactive');\n\t\t} else if (obj.type === 'label') {\n\t\t\tconst state = {\n\t\t\t\tget interactive() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'label' ? state.options?.interactive : false;\n\t\t\t\t},\n\t\t\t\tset interactive(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'label') {\n\t\t\t\t\t\tmv.setState(state, {\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tinteractive: value,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tgui.controllersRecursive().forEach(c => c.updateDisplay());\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget text() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'label' ? state.text : '';\n\t\t\t\t},\n\t\t\t\tset text(value) {\n\t\t\t\t\tconst currentState = mv.getState(obj.id);\n\n\t\t\t\t\tif (currentState?.type === 'label') {\n\t\t\t\t\t\tmv.setState(currentState, { text: value });\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget 'Text Color'() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'label' ? state.options.appearance?.textColor : '#000000';\n\t\t\t\t},\n\t\t\t\tset 'Text Color'(value) {\n\t\t\t\t\tconst currentState = mv.getState(obj.id);\n\n\t\t\t\t\tif (currentState?.type === 'label') {\n\t\t\t\t\t\tmv.setState(obj.id, {\n\t\t\t\t\t\t\ttext: state.text,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tappearance: {\n\t\t\t\t\t\t\t\t\ttextColor: value,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget 'Text Size'() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'label' ? state.options.appearance?.textSize : 10;\n\t\t\t\t},\n\t\t\t\tset 'Text Size'(value) {\n\t\t\t\t\tconst currentState = mv.getState(obj.id);\n\n\t\t\t\t\tif (currentState?.type === 'label') {\n\t\t\t\t\t\tmv.setState(currentState, {\n\t\t\t\t\t\t\ttext: state.text,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tappearance: {\n\t\t\t\t\t\t\t\t\ttextSize: value,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget 'Icon Size'() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'label' ? state.options.appearance?.iconSize : 10;\n\t\t\t\t},\n\t\t\t\tset 'Icon Size'(value) {\n\t\t\t\t\tconst currentState = mv.getState(obj.id);\n\n\t\t\t\t\tif (currentState?.type === 'label') {\n\t\t\t\t\t\tmv.setState(currentState, {\n\t\t\t\t\t\t\ttext: state.text,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tappearance: {\n\t\t\t\t\t\t\t\t\ticonSize: value,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget 'Pin Color'() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'label' ? state.options.appearance?.pinColor : '#000000';\n\t\t\t\t},\n\t\t\t\tset 'Pin Color'(value) {\n\t\t\t\t\tconst currentState = mv.getState(obj.id);\n\n\t\t\t\t\tif (currentState?.type === 'label') {\n\t\t\t\t\t\tmv.setState(currentState, {\n\t\t\t\t\t\t\ttext: state.text,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tappearance: {\n\t\t\t\t\t\t\t\t\tpinColor: value,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget 'Pin Color Inactive'() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'label' ? state.options.appearance?.pinColorInactive : '#000000';\n\t\t\t\t},\n\t\t\t\tset 'Pin Color Inactive'(value) {\n\t\t\t\t\tconst currentState = mv.getState(obj.id);\n\n\t\t\t\t\tif (currentState?.type === 'label') {\n\t\t\t\t\t\tmv.setState(currentState, {\n\t\t\t\t\t\t\ttext: state.text,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tappearance: {\n\t\t\t\t\t\t\t\t\tpinColorInactive: value,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget 'Pin Outline Color'() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'label' ? state.options.appearance?.pinOutlineColor : '#000000';\n\t\t\t\t},\n\t\t\t\tset 'Pin Outline Color'(value) {\n\t\t\t\t\tconst currentState = mv.getState(obj.id);\n\n\t\t\t\t\tif (currentState?.type === 'label') {\n\t\t\t\t\t\tmv.setState(currentState, {\n\t\t\t\t\t\t\ttext: state.text,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tappearance: {\n\t\t\t\t\t\t\t\t\tpinOutlineColor: value,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget 'Pin Outline Color Inactive'() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'label' ? state.options.appearance?.pinOutlineColorInactive : '#000000';\n\t\t\t\t},\n\t\t\t\tset 'Pin Outline Color Inactive'(value) {\n\t\t\t\t\tconst currentState = mv.getState(obj.id);\n\n\t\t\t\t\tif (currentState?.type === 'label') {\n\t\t\t\t\t\tmv.setState(currentState, {\n\t\t\t\t\t\t\ttext: state.text,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tappearance: {\n\t\t\t\t\t\t\t\t\tpinOutlineColorInactive: value,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfocus: () => {},\n\t\t\t};\n\t\t\tgroup.add(state, 'focus').onChange(() => {\n\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\tif (state?.type === 'label') {\n\t\t\t\t\tmv.camera.focusOn([state.position]);\n\t\t\t\t}\n\t\t\t});\n\t\t\tgroup.add(state, 'interactive');\n\t\t\tgroup.add(state, 'text');\n\t\t\tgroup.add(state, 'Text Size', 10, 50);\n\t\t\tgroup.add(state, 'Icon Size', 10, 50);\n\t\t\tgroup.addColor(state, 'Text Color');\n\t\t\tgroup.addColor(state, 'Active Background Color');\n\t\t\tgroup.addColor(state, 'Inactive Background Color');\n\t\t\tgroup.addColor(state, 'Active Foreground Color');\n\t\t\tgroup.addColor(state, 'Inactive Foreground Color');\n\t\t} else if (obj.type === 'geometry-group') {\n\t\t\tconst state = {\n\t\t\t\tget opacity() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'geometry-group' ? state.opacity : 1;\n\t\t\t\t},\n\t\t\t\tset opacity(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'geometry-group') {\n\t\t\t\t\t\tmv.setState(obj, {\n\t\t\t\t\t\t\topacity: value,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tset visible(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'geometry-group') {\n\t\t\t\t\t\tmv.setState(obj, {\n\t\t\t\t\t\t\tvisible: value,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget visible() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'geometry-group' ? state.visible : false;\n\t\t\t\t},\n\t\t\t\tset outline(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'geometry-group') {\n\t\t\t\t\t\tmv.setState(obj, {\n\t\t\t\t\t\t\toutline: value,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget outline() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'geometry-group' ? state.outline : false;\n\t\t\t\t},\n\t\t\t\tset altitude(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'geometry-group') {\n\t\t\t\t\t\tmv.setState(obj, {\n\t\t\t\t\t\t\taltitude: value,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget altitude() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'geometry-group' ? state.altitude : 0;\n\t\t\t\t},\n\t\t\t\tset interactive(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'geometry-group') {\n\t\t\t\t\t\tmv.setState(obj, {\n\t\t\t\t\t\t\tinteractive: value,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tgui.controllersRecursive().forEach(c => c.updateDisplay());\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget interactive() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'geometry-group' ? state.interactive : false;\n\t\t\t\t},\n\t\t\t\tget shadingStart() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'geometry-group' ? state.shading?.start ?? 0 : 0;\n\t\t\t\t},\n\t\t\t\tset shadingStart(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'geometry-group') {\n\t\t\t\t\t\tmv.setState(state, {\n\t\t\t\t\t\t\tshading: {\n\t\t\t\t\t\t\t\tstart: value,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget shadingEnd() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'geometry-group' ? state.shading?.end ?? 0 : 0;\n\t\t\t\t},\n\t\t\t\tset shadingEnd(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'geometry-group') {\n\t\t\t\t\t\tmv.setState(state, {\n\t\t\t\t\t\t\tshading: {\n\t\t\t\t\t\t\t\tend: value,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget shadingIntensity() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'geometry-group' ? state.shading?.intensity ?? 0 : 0;\n\t\t\t\t},\n\t\t\t\tset shadingIntensity(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'geometry-group') {\n\t\t\t\t\t\tmv.setState(state, {\n\t\t\t\t\t\t\tshading: {\n\t\t\t\t\t\t\t\tintensity: value,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t};\n\t\t\tgroup.add(state, 'visible');\n\t\t\tgroup.add(state, 'opacity', 0, 1, 0.1);\n\t\t\tgroup.add(state, 'interactive');\n\t\t\tgroup.add(state, 'outline');\n\t\t\tgroup.add(state, 'altitude', 0, 100, 1);\n\t\t\tgroup.add(state, 'shadingStart', 0, 1, 0.1);\n\t\t\tgroup.add(state, 'shadingEnd', 0, 1, 0.1);\n\t\t\tgroup.add(state, 'shadingIntensity', 0, 1, 0.1);\n\t\t} else if (obj.type === 'group-container') {\n\t\t\tconst state = {\n\t\t\t\tset visible(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'group-container') {\n\t\t\t\t\t\tmv.setState(obj, {\n\t\t\t\t\t\t\tvisible: value,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget visible() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'group-container' ? state.visible : false;\n\t\t\t\t},\n\t\t\t\tset interactive(value) {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\t\t\t\t\tif (state?.type === 'group-container') {\n\t\t\t\t\t\tmv.setState(state, {\n\t\t\t\t\t\t\tinteractive: value,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tgui.controllersRecursive().forEach(c => c.updateDisplay());\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget interactive() {\n\t\t\t\t\tconst state = mv.getState(obj.id);\n\n\t\t\t\t\treturn state?.type === 'group-container' ? state.interactive : false;\n\t\t\t\t},\n\t\t\t};\n\t\t\tgroup.add(state, 'visible');\n\t\t\tgroup.add(state, 'interactive');\n\t\t}\n\t\tgroup.close();\n\t\tif (obj.children) {\n\t\t\tfor (const child of obj.children.values()) {\n\t\t\t\tparseChild(child, group);\n\t\t\t}\n\t\t}\n\t};\n}\n\nfunction createWatermarkChild(mv: Core, gui) {\n\tconst folder = gui.addFolder('Watermark');\n\n\tconst controller: WatermarkUpdateOptions = {\n\t\tpadding: 16,\n\t\ticonOnly: false,\n\t\tposition: 'bottom-left',\n\t\tcolor: 'dark',\n\t\tscale: 1,\n\t};\n\n\tfolder.add(controller, 'padding', 0, 100, 1);\n\tfolder.add(controller, 'scale', 0.5, 1.5, 0.1);\n\tfolder.add(controller, 'color', ['dark', 'light']);\n\tfolder.add(controller, 'position', [\n\t\t'top-left',\n\t\t'top-right',\n\t\t'bottom-left',\n\t\t'bottom-right',\n\t\t'center',\n\t\t'top',\n\t\t'bottom',\n\t\t'left',\n\t\t'right',\n\t]);\n\tfolder.add(controller, 'iconOnly');\n\n\tfolder.onChange(() => {\n\t\tmv.updateWatermark(controller);\n\t});\n}\n", "export { GeoJsonApi } from './api';\nexport { Camera } from './camera';\nexport { Labels } from './labels';\nexport { Markers } from './markers';\nexport { Shapes } from './shapes';\nexport { Models } from './models';\nexport { Paths } from './paths';\nexport { Navigation } from '../navigation/index';\nexport { Exporter } from './exporter';\nexport { Directions } from './directions';\nexport { Style } from './style';\nexport { default as Outdoor } from './outdoor';\nexport { Image3D } from './images';\nexport { Text3D } from './text3d';\n", "import {\n\tsetCollisionWorkerUrl,\n\tsetMaplibreWorkerUrl,\n\tCOLLISION_WORKER_PATH,\n\tMAPLIBRE_WORKER_PATH,\n} from '@mappedin/core-sdk';\nimport type {\n\tGeometryState,\n\tLabelState,\n\tMarkerState,\n\tPosition,\n\tRendererCore,\n\tClickPayload,\n\tHoverPayload,\n\tPolygon,\n\tMultiPolygon,\n\tWatermarkUpdateOptions,\n\tGroupContainerState,\n\tUpdateModelState as GeoJsonUpdateModelState,\n} from '@mappedin/core-sdk';\nimport { assertType, isFiniteBox, Logger, PubSub } from '@packages/internal/common';\nimport { type TClickPayload, type THoverPayload, type TShow3DMapOptions } from '..';\nimport type { MapElementsWithState, TUpdateState, TGetState, TGetInViewOptions, MapFeatureOfType } from '../types';\nimport { WALLS, DOORS } from '../types';\nimport type MapData from '../map-data';\nimport { getMapDataInternal } from '../map-data';\nimport type { FloorStack, MapDataInternal } from '../map-data-objects';\nimport { Facade, Coordinate, MapObject, Space, Floor, Door, Area } from '../map-data-objects';\nimport type { MapView } from '../map-view';\nimport { CameraTransform, Label, Marker, Shape, Text3DView, Model, Path, Image3DView } from '../map-view-objects';\nimport { Navigation, type TNavigationEvents } from '../navigation';\nimport { Camera } from './camera';\nimport { Exporter } from './exporter';\nimport { Labels } from './labels';\nimport { GeojsonApiMapObject } from './map-object';\nimport { Markers } from './markers';\nimport { Image3D } from './images';\nimport { Models } from './models';\nimport { Paths } from './paths';\nimport { convertPanBoundsToCameraBounds, expandBbox, getBoundingBox, getTargetID } from './utils';\nimport type { TEvents, TFloorChangeReason, TStateChangedInternalPayload } from '../events';\nimport { Shapes } from './shapes';\nimport { Style } from './style';\nimport Outdoor from './outdoor';\nimport {\n\tADD_MAP_FOCUS_ON_DURATION,\n\tAREAS_LAYER,\n\tEXTERIOR_DOORS_ID,\n\tEXTERIOR_WALLS_ID,\n\tFOOTPRINT_LAYER,\n\tGEOMETRY_LAYER,\n\tIMAGES_LAYER,\n\tINTERIOR_DOORS_ID,\n\tLABELS_LAYER,\n\tMARKERS_LAYER,\n\tOCCLUSION_LAYER,\n\tPATHS_LAYER,\n\tWALLS_ID,\n} from '../constants';\nimport { getId } from '../utils';\nimport { type BBox, type Feature } from 'geojson';\nimport { Text3D } from './text3d';\nimport { PathSegment } from '../map-view-objects/path';\nimport { MappedinError, MappedinRenderError } from '@packages/internal/common/errors';\nimport { Tween } from '@tweenjs/tween.js';\nimport { destroyObject3D } from '../../../geojson/src/utils/object3d-destroy';\nimport { Box3, Mesh, BoxGeometry, MeshBasicMaterial } from 'three';\nimport type { MapElementToUpdateState } from '../states';\nimport {\n\tparsePartialState,\n\ttranslateDoorsStateToGeojsonCore,\n\ttranslateGeometryStateToGeojsonCore,\n\ttranslateLabelStateToGeojsonCore,\n\ttranslateMarkerStateToGeojsonCore,\n\ttranslateWallsStateToGeojsonCore,\n\tgetFacadeState,\n\tgetFloorState,\n\tgetPathState,\n\tgetShapeState,\n\ttranslateShapeStateToGeojsonCore,\n\tgetWallsState,\n\tgetGeometryState,\n\tgetDoorsState,\n\tgetLabelState,\n\tgetModelState,\n\tgetMarkerState,\n\tgetImageState,\n\tgetText3DState,\n\tlabelStateSchemaPartial,\n\tmarkerStateSchemaPartial,\n\tgeometryStateSchemaPartial,\n\tfloorLabelsStateSchemaPartial,\n\tfootprintStateSchemaPartial,\n\tfloorOcclusionStateSchemaPartial,\n\tfloorMarkersStateSchemaPartial,\n\tfloorImagesStateSchemaPartial,\n\twallsStateSchemaPartial,\n\tshapeStateSchemaPartial,\n\tdoorsStateSchemaPartial,\n\tfloorSchemaPartial,\n\tfloorGeometryStateSchemaPartial,\n\tfacadeStateSchemaPartial,\n\tpathStateSchemaPartial,\n\timageStateSchemaPartial,\n\tfloorPathsStateSchemaPartial,\n\tmodelStateUpdateSchema,\n\ttext3DUpdateStateSchema,\n\tareasStateSchemaPartial,\n} from '../states';\nimport type { ValueOf } from 'type-fest';\nimport { auto } from './auto';\n\nconst PERCENT_OF_SCREEN_PADDING = 0.05;\n\nexport class GeoJsonApi extends PubSub<TNavigationEvents> {\n\tcore: RendererCore;\n\tmapObjects: GeojsonApiMapObject[] = [];\n\tid: string;\n\n\tmapDataExternal: { [key in string]: MapData } = {};\n\tprivate mapsByFloorId: { [floorId: string]: GeojsonApiMapObject } = {};\n\tmapData?: MapData;\n\tcurrentMap: GeojsonApiMapObject;\n\thiddenOutdoorGeometries: [\n\t\tBBox,\n\t\tpolygons: GeoJSON.Feature<GeoJSON.Polygon | GeoJSON.MultiPolygon, any>[],\n\t\tlayers: string[],\n\t][] = [];\n\tprivate lastFacadeIntersected?: Facade;\n\t#manualFloorVisibility = false;\n\t#hidePathsNotOnCurrentFloor = false;\n\tmapView: MapView;\n\t/**\n\t * External event bus for MapView - bridges internal API events to public API.\n\t *\n\t * Internal systems publish events here which are then exposed to developers via\n\t * MapView.on() and MapView.off().\n\t */\n\texternalPubSub: PubSub<TEvents>;\n\n\tget manualFloorVisibility(): boolean {\n\t\treturn this.#manualFloorVisibility;\n\t}\n\n\tset manualFloorVisibility(value: boolean) {\n\t\tthis.#manualFloorVisibility = value;\n\t\tthis.externalPubSub.publish('state-change-internal', {\n\t\t\tmanualFloorVisibility: value,\n\t\t});\n\t}\n\n\tget hidePathsNotOnCurrentFloor(): boolean {\n\t\treturn this.#hidePathsNotOnCurrentFloor;\n\t}\n\n\tset hidePathsNotOnCurrentFloor(value: boolean) {\n\t\tthis.#hidePathsNotOnCurrentFloor = value;\n\t\tthis.currentMap?.updatePathLayersVisibility();\n\t}\n\n\tCamera: Camera;\n\tLabels: Labels;\n\tText3D: Text3D;\n\tMarkers: Markers;\n\tModels: Models;\n\tPaths: Paths;\n\tExporter: Exporter;\n\tNavigation: Navigation;\n\tOutdoor: Outdoor;\n\tShapes: Shapes;\n\tStyle: Style;\n\tImage3D: Image3D;\n\n\tconstructor(rendererCore: RendererCore, mapView: MapView, externalPubSub: PubSub<TEvents>) {\n\t\tsuper();\n\t\tthis.core = rendererCore;\n\t\tthis.mapView = mapView;\n\t\tthis.externalPubSub = externalPubSub;\n\t\tthis.Camera = new Camera(this);\n\t\tthis.id = this.core.addGroupContainer('root').id.toString();\n\n\t\tconst defaultMap = new GeojsonApiMapObject('outdoors-container', undefined, undefined, this);\n\t\tthis.mapObjects.push(defaultMap);\n\t\tthis.currentMap = defaultMap;\n\n\t\tthis.core.on('pre-render', () => {\n\t\t\texternalPubSub.publish('pre-render');\n\t\t});\n\t\tthis.core.on('post-render', () => {\n\t\t\texternalPubSub.publish('post-render');\n\t\t});\n\t\tthis.core.on('resize', () => {\n\t\t\texternalPubSub.publish('resize');\n\t\t});\n\t\tthis.core.on('render-error', ({ error }) => {\n\t\t\texternalPubSub.publish('render-error', {\n\t\t\t\terror: new MappedinRenderError(error instanceof Error ? error.message : 'Unknown error'),\n\t\t\t});\n\t\t});\n\t\tconst getFacadeFromEntityId = (entityId: string) => {\n\t\t\tconst geometry = this.getMapDataObject(entityId) as Facade | Floor;\n\n\t\t\tswitch (geometry?.__type) {\n\t\t\t\tcase 'facade':\n\t\t\t\t\treturn geometry;\n\t\t\t\tcase 'floor':\n\t\t\t\t\t/**\n\t\t\t\t\t * Floors are focusable too and it'll give back the facade that it belongs to.\n\t\t\t\t\t * This allows multi-floor buildings to prevent the raycast from going through the floor\n\t\t\t\t\t * and switching the focus constantly.\n\t\t\t\t\t */\n\t\t\t\t\treturn geometry.floorStack.facade;\n\t\t\t\tdefault:\n\t\t\t\t\treturn null;\n\t\t\t}\n\t\t};\n\t\tthis.core.on('geometry-in-focus', entities => {\n\t\t\tconst uniqueFacades = new Set<Facade>();\n\t\t\tfor (const entityId of entities) {\n\t\t\t\tconst facade = getFacadeFromEntityId(entityId);\n\t\t\t\tif (facade) {\n\t\t\t\t\tuniqueFacades.add(facade);\n\t\t\t\t}\n\t\t\t}\n\t\t\texternalPubSub.publish('facades-in-view-change', {\n\t\t\t\tfacades: Array.from(uniqueFacades),\n\t\t\t});\n\t\t});\n\n\t\tthis.core.getSystems().renderSystem.on('camera-state-change', () => {\n\t\t\texternalPubSub.publish('state-change-internal', {\n\t\t\t\tCamera: this.getCameraState(),\n\t\t\t});\n\t\t});\n\n\t\t// Create CameraTransform with centimeter precision by default\n\t\tconst cameraTransform = new CameraTransform(this.Camera, { precision: 7 });\n\t\tthis.core.on('camera-change', () => {\n\t\t\texternalPubSub.publish('camera-change', cameraTransform);\n\t\t});\n\t\tthis.core.on('pan-bounds-change', panBounds => {\n\t\t\texternalPubSub.publish(\n\t\t\t\t'camera-bounds-change',\n\t\t\t\tconvertPanBoundsToCameraBounds(panBounds, this.core.convert3DMapPositionToCoordinate),\n\t\t\t);\n\t\t});\n\t\tconst createHandler = (event: 'hover' | 'click') => (payload: ClickPayload | HoverPayload) => {\n\t\t\tconst labels: Label[] = [];\n\t\t\tconst markers: Marker[] = [];\n\t\t\tconst models: Model[] = [];\n\t\t\tconst paths: Path[] = [];\n\t\t\tpayload.labels.forEach(l => {\n\t\t\t\tconst found = this.Labels.getById(l.toString());\n\t\t\t\tif (found) labels.push(found.label);\n\t\t\t});\n\t\t\tpayload.markers.forEach(m => {\n\t\t\t\tconst found = this.Markers.getById(m.toString()) || this.Navigation.getMarkerById(m.toString());\n\t\t\t\tif (found) markers.push(found.marker);\n\t\t\t});\n\t\t\tpayload.models.forEach(m => {\n\t\t\t\tconst found = this.Models.getById(m.toString());\n\t\t\t\tif (found) models.push(found.model);\n\t\t\t});\n\t\t\tpayload.paths.forEach(p => {\n\t\t\t\tconst found = this.Paths.getById(p.toString());\n\t\t\t\tif (found) paths.push(found);\n\t\t\t});\n\n\t\t\tconst geometryIntersectIds = payload.geometry;\n\t\t\tlet geometryIntersected: Space | MapObject | Area | Shape | undefined;\n\n\t\t\t// TODO: refactor to getMapDataById ?\n\t\t\tif (geometryIntersectIds.length > 0) {\n\t\t\t\tgeometryIntersected = geometryIntersectIds\n\t\t\t\t\t.map(id => this.getMapDataInternal()?.getById('space', id as string))\n\t\t\t\t\t.filter(Boolean)[0];\n\n\t\t\t\tif (!geometryIntersected) {\n\t\t\t\t\tgeometryIntersected = geometryIntersectIds\n\t\t\t\t\t\t.map(id => this.getMapDataInternal()?.getById('object', id as string))\n\t\t\t\t\t\t.filter(Boolean)[0];\n\t\t\t\t}\n\t\t\t\tif (!geometryIntersected) {\n\t\t\t\t\tgeometryIntersected = geometryIntersectIds\n\t\t\t\t\t\t.map(id => this.getMapDataInternal()?.getById('area', id as string))\n\t\t\t\t\t\t.filter(Boolean)[0];\n\t\t\t\t}\n\t\t\t\tif (!geometryIntersected) {\n\t\t\t\t\tgeometryIntersected = geometryIntersectIds.map(id => this.Shapes.getById(id as string)).filter(Boolean)[0];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst floorsIntersected = payload.containers.reduce((acc: Floor[], id) => {\n\t\t\t\tconst floor = this.getMapDataInternal()?.getById('floor', id as string);\n\n\t\t\t\tif (floor && Floor.is(floor)) {\n\t\t\t\t\tacc.push(floor);\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, []);\n\n\t\t\tlet floorId: string | undefined;\n\t\t\tlet verticalOffset = 0;\n\t\t\tif (floorsIntersected.length > 0) {\n\t\t\t\tfloorId = floorsIntersected[0].id;\n\n\t\t\t\t// Get the vertical offset of the coordinate relative to the floor's altitude\n\t\t\t\tconst floorState = this.core.getState<GroupContainerState>(floorId);\n\t\t\t\tverticalOffset = payload.coordinate[2] ? payload.coordinate[2] - floorState.altitude : verticalOffset;\n\t\t\t}\n\n\t\t\t// Handle facade hover state\n\t\t\tlet facadeIntersected: Facade | undefined;\n\t\t\tif (this.lastFacadeIntersected) {\n\t\t\t\tthis.lastFacadeIntersected.spaces.forEach(space => {\n\t\t\t\t\tthis.core.setState<GeometryState>(space.id, {\n\t\t\t\t\t\thovered: false,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (geometryIntersected && Space.is(geometryIntersected)) {\n\t\t\t\tfacadeIntersected = geometryIntersectIds\n\t\t\t\t\t.map(id => this.getMapDataInternal()?.facadesBySpaceId[id as string])\n\t\t\t\t\t.filter(Boolean)[0];\n\t\t\t\tif (facadeIntersected) {\n\t\t\t\t\tfacadeIntersected.spaces.forEach(space => {\n\t\t\t\t\t\tthis.core.setState<GeometryState>(space.id, {\n\t\t\t\t\t\t\thovered: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.lastFacadeIntersected = facadeIntersected;\n\n\t\t\tconst publicPayload: THoverPayload | TClickPayload = {\n\t\t\t\tcoordinate: new Coordinate({\n\t\t\t\t\tlatitude: payload.coordinate[1],\n\t\t\t\t\tlongitude: payload.coordinate[0],\n\t\t\t\t\tfloorId,\n\t\t\t\t\tverticalOffset,\n\t\t\t\t}),\n\t\t\t\tspaces: geometryIntersected && Space.is(geometryIntersected) ? [geometryIntersected] : [],\n\t\t\t\tobjects: geometryIntersected && MapObject.is(geometryIntersected) ? [geometryIntersected] : [],\n\t\t\t\tareas: geometryIntersected && Area.is(geometryIntersected) ? [geometryIntersected] : [],\n\t\t\t\tshapes: geometryIntersected && Shape.is(geometryIntersected) ? [geometryIntersected] : [],\n\t\t\t\tmarkers,\n\t\t\t\tlabels,\n\t\t\t\tmodels,\n\t\t\t\tpaths,\n\t\t\t\tfloors: floorsIntersected,\n\t\t\t\tfacades: facadeIntersected ? [facadeIntersected] : [],\n\t\t\t};\n\t\t\tif ('pointerEvent' in payload) {\n\t\t\t\t(publicPayload as TClickPayload).pointerEvent = payload.pointerEvent;\n\t\t\t}\n\t\t\texternalPubSub.publish(event, publicPayload);\n\t\t};\n\n\t\tthis.core.on('hover', createHandler('hover'));\n\t\tthis.core.on('click', createHandler('click'));\n\n\t\tthis.core.on('user-interaction-start', () => {\n\t\t\texternalPubSub.publish('user-interaction-start');\n\t\t});\n\n\t\tthis.core.on('user-interaction-end', () => {\n\t\t\texternalPubSub.publish('user-interaction-end');\n\t\t});\n\n\t\tconst currentMapGetter = {\n\t\t\tcurrentMapGetter: () => {\n\t\t\t\treturn this.currentMap;\n\t\t\t},\n\t\t};\n\t\tthis.Markers = new Markers(currentMapGetter);\n\t\tthis.Models = new Models(currentMapGetter);\n\t\tthis.Labels = new Labels(currentMapGetter);\n\t\tthis.Text3D = new Text3D(currentMapGetter);\n\t\tthis.Exporter = new Exporter(currentMapGetter);\n\t\tthis.Paths = new Paths(currentMapGetter);\n\t\tthis.Navigation = new Navigation(this);\n\t\tthis.on('navigation-state-change', e => {\n\t\t\tthis.externalPubSub.publish('state-change-internal', {\n\t\t\t\tNavigation: e,\n\t\t\t});\n\t\t});\n\t\tthis.on('navigation-connection-click', e => {\n\t\t\tthis.externalPubSub.publish('navigation-connection-click', e);\n\t\t});\n\t\tthis.on('navigation-active-path-change', e => {\n\t\t\tthis.externalPubSub.publish('navigation-active-path-change', e);\n\t\t});\n\t\tthis.Outdoor = new Outdoor(this.core, this.hiddenOutdoorGeometries);\n\n\t\tif (this.Outdoor.enabled) {\n\t\t\tthis.core.on('outdoor-view-loaded', () => {\n\t\t\t\texternalPubSub.publish('outdoor-view-loaded');\n\t\t\t});\n\n\t\t\tthis.core.on('outdoor-style-loaded', () => {\n\t\t\t\texternalPubSub.publish('outdoor-style-loaded');\n\t\t\t});\n\t\t}\n\n\t\tthis.Image3D = new Image3D(currentMapGetter);\n\t\tthis.Shapes = new Shapes(currentMapGetter);\n\t\tthis.Style = new Style(currentMapGetter);\n\t}\n\n\tpreloadFloors(floors: Floor[]) {\n\t\tfloors.forEach(floor => {\n\t\t\tif (floor instanceof Floor) {\n\t\t\t\tthis.core.setState<GroupContainerState>(floor.id, { preloadGeometry: true });\n\t\t\t}\n\t\t});\n\t}\n\n\tupdateState<T extends MapElementsWithState>(target: T, state: TUpdateState<T>): void;\n\tupdateState<T extends string & NonNullable<unknown>>(target: T, state: ValueOf<MapElementToUpdateState>): void;\n\tupdateState<T extends MapElementsWithState | string>(target: T, state: TUpdateState<T>): void;\n\tupdateState(target: MapElementsWithState | string, state: TUpdateState<MapElementsWithState | string>): void {\n\t\tif (state == null || typeof state !== 'object') {\n\t\t\t// no state to update\n\t\t\treturn;\n\t\t}\n\n\t\tif (target === WALLS.Interior) {\n\t\t\tthis.currentMap.floors.forEach(floor => {\n\t\t\t\tconst geometryLayer = floor.layers.get(GEOMETRY_LAYER);\n\t\t\t\tif (geometryLayer) {\n\t\t\t\t\tconst wallsId = geometryLayer.layers.get(WALLS_ID);\n\t\t\t\t\tif (wallsId && this.core.hasState(wallsId)) {\n\t\t\t\t\t\tthis.core.setState(\n\t\t\t\t\t\t\twallsId,\n\t\t\t\t\t\t\ttranslateWallsStateToGeojsonCore(\n\t\t\t\t\t\t\t\tparsePartialState(wallsStateSchemaPartial, state, { warn: true }),\n\t\t\t\t\t\t\t\tthis.core.getState<GeometryState>(wallsId),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\t\tif (target === WALLS.Exterior) {\n\t\t\tthis.currentMap.floors.forEach(floor => {\n\t\t\t\tconst geometryLayer = floor.layers.get(GEOMETRY_LAYER);\n\t\t\t\tif (geometryLayer) {\n\t\t\t\t\tconst exteriorWallsId = geometryLayer.layers.get(EXTERIOR_WALLS_ID);\n\t\t\t\t\tif (exteriorWallsId && this.core.hasState(exteriorWallsId)) {\n\t\t\t\t\t\tthis.core.setState(\n\t\t\t\t\t\t\texteriorWallsId,\n\t\t\t\t\t\t\ttranslateWallsStateToGeojsonCore(\n\t\t\t\t\t\t\t\tparsePartialState(wallsStateSchemaPartial, state, { warn: true }),\n\t\t\t\t\t\t\t\tthis.core.getState<GeometryState>(exteriorWallsId),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (target === DOORS.Interior) {\n\t\t\tthis.currentMap.floors.forEach(floor => {\n\t\t\t\tconst geometryLayer = floor.layers.get(GEOMETRY_LAYER);\n\t\t\t\tif (geometryLayer) {\n\t\t\t\t\tconst interiorDoorsId = geometryLayer.layers.get(INTERIOR_DOORS_ID);\n\t\t\t\t\tif (interiorDoorsId && this.core.hasState(interiorDoorsId)) {\n\t\t\t\t\t\tthis.core.setState(\n\t\t\t\t\t\t\tinteriorDoorsId,\n\t\t\t\t\t\t\ttranslateDoorsStateToGeojsonCore(\n\t\t\t\t\t\t\t\tparsePartialState(doorsStateSchemaPartial, state, { warn: true }),\n\t\t\t\t\t\t\t\tthis.core.getState<GeometryState>(interiorDoorsId),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (target === DOORS.Exterior) {\n\t\t\tthis.currentMap.floors.forEach(floor => {\n\t\t\t\tconst geometryLayer = floor.layers.get(GEOMETRY_LAYER);\n\t\t\t\tif (geometryLayer) {\n\t\t\t\t\tconst exteriorDoorsId = geometryLayer.layers.get(EXTERIOR_DOORS_ID);\n\t\t\t\t\tif (exteriorDoorsId && this.core.hasState(exteriorDoorsId)) {\n\t\t\t\t\t\tthis.core.setState(\n\t\t\t\t\t\t\texteriorDoorsId,\n\t\t\t\t\t\t\ttranslateDoorsStateToGeojsonCore(\n\t\t\t\t\t\t\t\tparsePartialState(doorsStateSchemaPartial, state, { warn: true }),\n\t\t\t\t\t\t\t\tthis.core.getState<GeometryState>(exteriorDoorsId),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst dataObject = typeof target === 'string' ? this.getMapDataObject(target) : target;\n\t\tif (!dataObject) return;\n\n\t\t// TODO: why don't paths have state?\n\t\tif (dataObject.__type !== Path.__type && !this.core.hasState(dataObject.id)) {\n\t\t\tLogger.warn(`Failed to update state for \"${dataObject.id}\". No ${dataObject.__type} found with that ID.`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (Label.is(dataObject)) {\n\t\t\treturn this.core.setState(\n\t\t\t\tdataObject.id,\n\t\t\t\ttranslateLabelStateToGeojsonCore(\n\t\t\t\t\tparsePartialState(labelStateSchemaPartial, state, { warn: true }),\n\t\t\t\t\tthis.core.getState<LabelState>(dataObject.id),\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\tif (Marker.is(dataObject)) {\n\t\t\treturn this.core.setState(\n\t\t\t\tdataObject.id,\n\t\t\t\ttranslateMarkerStateToGeojsonCore(\n\t\t\t\t\tparsePartialState(markerStateSchemaPartial, state, { warn: true }),\n\t\t\t\t\tthis.core.getState<MarkerState>(dataObject.id),\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\tif (Space.is(dataObject) || MapObject.is(dataObject)) {\n\t\t\tconst currentState = this.core.getState<GeometryState>(dataObject.id);\n\t\t\tif (currentState != null) {\n\t\t\t\tthis.core.setState(\n\t\t\t\t\tdataObject.id,\n\t\t\t\t\ttranslateGeometryStateToGeojsonCore(\n\t\t\t\t\t\tparsePartialState(geometryStateSchemaPartial, state, { warn: true }),\n\t\t\t\t\t\tcurrentState,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (Area.is(dataObject)) {\n\t\t\tthis.core.setState(dataObject.id, parsePartialState(geometryStateSchemaPartial, state, { warn: true }));\n\t\t}\n\n\t\tif (Image3DView.is(dataObject)) {\n\t\t\tthis.core.setState(dataObject.id, parsePartialState(imageStateSchemaPartial, state, { warn: true }));\n\t\t}\n\n\t\tif (Door.is(dataObject)) {\n\t\t\tthis.core.setState(\n\t\t\t\tdataObject.id,\n\t\t\t\ttranslateDoorsStateToGeojsonCore(\n\t\t\t\t\tparsePartialState(doorsStateSchemaPartial, state, { warn: true }),\n\t\t\t\t\tthis.core.getState<GeometryState>(dataObject.id),\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\tif (Shape.is(dataObject)) {\n\t\t\tthis.core.setState(\n\t\t\t\tdataObject.id,\n\t\t\t\ttranslateShapeStateToGeojsonCore(parsePartialState(shapeStateSchemaPartial, state, { warn: true })),\n\t\t\t);\n\t\t}\n\n\t\tif (Model.is(dataObject)) {\n\t\t\tconst {\n\t\t\t\tposition: target,\n\t\t\t\tscale,\n\t\t\t\trotation,\n\t\t\t\t...rest\n\t\t\t} = parsePartialState(modelStateUpdateSchema, state, { warn: true });\n\t\t\tconst update: GeoJsonUpdateModelState = rest;\n\t\t\tif (target) {\n\t\t\t\tupdate.position = [target.longitude, target.latitude, target.verticalOffset] as [number, number, number];\n\t\t\t}\n\t\t\tif (scale != null) {\n\t\t\t\tif (Array.isArray(scale)) {\n\t\t\t\t\tupdate.scale = scale;\n\t\t\t\t} else {\n\t\t\t\t\tupdate.scale = [scale, scale, scale];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (rotation != null) {\n\t\t\t\tif (Array.isArray(rotation)) {\n\t\t\t\t\tupdate.rotation = rotation;\n\t\t\t\t} else {\n\t\t\t\t\tupdate.rotation = [rotation, rotation, rotation];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (target) {\n\t\t\t\tdataObject.updateTarget(target);\n\t\t\t}\n\t\t\tthis.core.setState(dataObject.id, update);\n\t\t}\n\n\t\tif (Floor.is(dataObject)) {\n\t\t\tconst floorObject = this.currentMap.floorsById.get(dataObject.id);\n\t\t\tif (floorObject == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst parsedState = parsePartialState(floorSchemaPartial, state, { warn: true });\n\n\t\t\tthis.core.setState(dataObject.id, parsedState);\n\n\t\t\tconst geometryLayer = floorObject.layers.get(GEOMETRY_LAYER);\n\t\t\tif (geometryLayer != null && 'geometry' in state && state.geometry) {\n\t\t\t\tthis.core.setState(\n\t\t\t\t\tgeometryLayer.containerId,\n\t\t\t\t\tparsePartialState(floorGeometryStateSchemaPartial, state.geometry, { warn: true }),\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst labelsLayer = floorObject.layers.get(LABELS_LAYER);\n\t\t\tif (labelsLayer != null && 'labels' in state && state.labels) {\n\t\t\t\tconst labelsState = parsePartialState(floorLabelsStateSchemaPartial, state.labels, { warn: true });\n\t\t\t\tif ('enabled' in labelsState && typeof labelsState.enabled === 'boolean') {\n\t\t\t\t\tlabelsLayer.setVisible(labelsState.enabled);\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst markersLayer = floorObject.layers.get(MARKERS_LAYER);\n\t\t\tif (markersLayer != null && 'markers' in state && state.markers) {\n\t\t\t\tconst markersState = parsePartialState(floorMarkersStateSchemaPartial, state.markers, { warn: true });\n\t\t\t\tif ('enabled' in markersState && typeof markersState.enabled === 'boolean') {\n\t\t\t\t\tmarkersLayer.setVisible(markersState.enabled);\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst footprintLayer = floorObject.layers.get(FOOTPRINT_LAYER);\n\t\t\tif (footprintLayer != null && 'footprint' in state && state.footprint) {\n\t\t\t\tthis.core.setState(\n\t\t\t\t\tfootprintLayer.containerId,\n\t\t\t\t\tparsePartialState(footprintStateSchemaPartial, state.footprint, { warn: true }),\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst occlusionLayer = floorObject.layers.get(OCCLUSION_LAYER);\n\t\t\tif (occlusionLayer != null && 'occlusion' in state && state.occlusion) {\n\t\t\t\tconst occlusionState = parsePartialState(floorOcclusionStateSchemaPartial, state.occlusion, { warn: true });\n\t\t\t\tif ('enabled' in occlusionState && typeof occlusionState.enabled === 'boolean') {\n\t\t\t\t\tocclusionLayer.setVisible(occlusionState.enabled);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst imagesLayer = floorObject.layers.get(IMAGES_LAYER);\n\t\t\tif (imagesLayer != null && 'images' in state && state.images) {\n\t\t\t\tconst imagesState = parsePartialState(floorImagesStateSchemaPartial, state.images, { warn: true });\n\t\t\t\tif ('visible' in imagesState && typeof imagesState.visible === 'boolean') {\n\t\t\t\t\timagesLayer.setVisible(imagesState.visible);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst pathsLayer = floorObject.layers.get(PATHS_LAYER);\n\t\t\tif (pathsLayer != null && 'paths' in state && state.paths != null) {\n\t\t\t\tconst pathsState = parsePartialState(floorPathsStateSchemaPartial, state.paths, { warn: true });\n\t\t\t\tif (pathsState.visible != null && typeof pathsState.visible === 'boolean') {\n\t\t\t\t\tpathsLayer.setVisible(pathsState.visible);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst areasLayer = floorObject.layers.get(AREAS_LAYER);\n\t\t\tif (areasLayer != null && 'areas' in state && state.areas != null) {\n\t\t\t\tconst areasState = parsePartialState(areasStateSchemaPartial, state.areas, { warn: true });\n\t\t\t\tif (areasState.visible != null && typeof areasState.visible === 'boolean') {\n\t\t\t\t\tareasLayer.setVisible(areasState.visible);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (Facade.is(dataObject)) {\n\t\t\tconst facadeContainerState = this.core.getState<GroupContainerState>(dataObject.id);\n\t\t\tfor (const facadeGeometryContainer of facadeContainerState.children) {\n\t\t\t\tif (facadeGeometryContainer.type === 'group-container') {\n\t\t\t\t\tthis.core.setState(\n\t\t\t\t\t\tfacadeGeometryContainer.id,\n\t\t\t\t\t\tparsePartialState(facadeStateSchemaPartial, state, { warn: true }),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (Text3DView.is(dataObject)) {\n\t\t\tthis.core.setState(dataObject.id, parsePartialState(text3DUpdateStateSchema, state, { warn: true }));\n\t\t}\n\n\t\tif (Path.is(dataObject)) {\n\t\t\tfor (const segment of dataObject.segments) {\n\t\t\t\tthis.core.setState(segment.id, parsePartialState(pathStateSchemaPartial, state, { warn: true }));\n\t\t\t}\n\t\t}\n\n\t\tif (PathSegment.is(dataObject)) {\n\t\t\tthis.core.setState(dataObject.id, parsePartialState(pathStateSchemaPartial, state, { warn: true }));\n\t\t}\n\n\t\treturn;\n\t}\n\n\tprivate getMapDataObject(id: string) {\n\t\treturn this.getMapDataInternal()?.getMapDataById(id);\n\t}\n\n\tupdate = () => {\n\t\tthis.core.render();\n\t};\n\n\tgetMapDataInternal() {\n\t\tif (!this.mapData) return;\n\n\t\treturn getMapDataInternal(this.mapData);\n\t}\n\n\tgetMapData() {\n\t\treturn this.mapData;\n\t}\n\n\taddMap(mapData: MapData, options?: TShow3DMapOptions): Promise<MapData> {\n\t\treturn new Promise<MapData>(resolve => {\n\t\t\tlet data: MapDataInternal;\n\t\t\ttry {\n\t\t\t\tdata = getMapDataInternal(mapData);\n\t\t\t} catch (e) {\n\t\t\t\tLogger.error('Error adding map', e);\n\t\t\t\tresolve(mapData);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.mapDataExternal[mapData.mapName] = mapData;\n\t\t\tthis.mapData = mapData;\n\n\t\t\tconst { mvf } = data;\n\t\t\tconst mvfCenter = mvf['manifest.geojson'].features[0].geometry.coordinates as Position;\n\t\t\tif (this.core.mode !== 'outdoors-overlay') {\n\t\t\t\t// in overlay mode, we are not in charge of where the camera starts\n\t\t\t\tthis.Camera.set({\n\t\t\t\t\tcenter: new Coordinate(mvfCenter[1], mvfCenter[0]),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst id = mvf['manifest.geojson'].features[0].properties.name;\n\t\t\tconst mapObject = new GeojsonApiMapObject(`mapObject-${id}`, data, options, this);\n\t\t\tthis.currentMap = mapObject;\n\t\t\tthis.currentMap.loadAllFloors();\n\t\t\tthis.currentMap.setFloor(this.currentMap.startingFloorId);\n\n\t\t\t// We can't reliably use the MVF manifest center coordinate for hiding outdoor layers.\n\t\t\t// The MVF uses the center of editor's initial base map image. We need the geometry center.\n\n\t\t\tconst boundingBox = this.core.getBoundingArea(mapObject.currentFloor.id)!;\n\n\t\t\tif (boundingBox == null) {\n\t\t\t\tLogger.error('Could not determine bounding box for map:', mapObject.currentFloor.id);\n\t\t\t}\n\t\t\tconst userHiddenLayers = options?.outdoorView?.layersHiddenByGeometry ?? [];\n\t\t\tif (userHiddenLayers.length > 0) {\n\t\t\t\tlet totalBbox: BBox | undefined;\n\t\t\t\tconst polygons: GeoJSON.Feature<GeoJSON.Polygon | GeoJSON.MultiPolygon, any>[] = [];\n\t\t\t\t// go through each floor-stack, grab the footprint of the default floor\n\t\t\t\t// and hide the outdoor layers that intersect with the footprint\n\t\t\t\tfor (const floorStack of mapObject.floorStacksById.values()) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tfloorStack.defaultFloor.footprint &&\n\t\t\t\t\t\tfloorStack.defaultFloor.footprint.geometry != null &&\n\t\t\t\t\t\tfloorStack.defaultFloor.footprint.geometry?.coordinates.length > 0\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst footprint = floorStack.defaultFloor.footprint as Feature<Polygon | MultiPolygon, any>;\n\t\t\t\t\t\tconst bbox = getBoundingBox(footprint);\n\t\t\t\t\t\tif (totalBbox == null) {\n\t\t\t\t\t\t\ttotalBbox = bbox;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\texpandBbox(totalBbox, bbox);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpolygons.push(footprint);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (polygons.length > 0 && totalBbox != null) {\n\t\t\t\t\tthis.core.hideOutdoorLayersIntersectingPolygons(totalBbox, polygons, userHiddenLayers);\n\t\t\t\t\tthis.hiddenOutdoorGeometries.push([totalBbox, polygons, userHiddenLayers]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.mapObjects.push(mapObject);\n\t\t\tdata.getMVFFeatureByType('floor').forEach(feature => {\n\t\t\t\tthis.mapsByFloorId[feature.id] = mapObject;\n\t\t\t});\n\t\t\tmapObject.on('floor-change-start', e => {\n\t\t\t\tthis.externalPubSub.publish('floor-change-start', {\n\t\t\t\t\treason: e.reason,\n\t\t\t\t\tfloor: this.getMapDataInternal()?.getById('floor', e.floorId) ?? this.currentFloor,\n\t\t\t\t\tpreviousFloor: this.getMapDataInternal()?.getById('floor', e.previousFloorId) ?? this.currentFloor,\n\t\t\t\t});\n\t\t\t});\n\t\t\tmapObject.on('floor-change', e => {\n\t\t\t\tthis.externalPubSub.publish('floor-change', {\n\t\t\t\t\treason: e.reason,\n\t\t\t\t\tfloor: this.currentFloor,\n\t\t\t\t\tpreviousFloor: this.getMapDataInternal()?.getById('floor', e.previousFloorId) ?? this.currentFloor,\n\t\t\t\t});\n\t\t\t\tthis.externalPubSub.publish('state-change-internal', {\n\t\t\t\t\tcurrentFloor: this.currentFloor,\n\t\t\t\t\tcurrentFloorStack: this.currentFloorStack,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// if zoomLevel is specifed we don't do anything here since it's handled in renderer constructor\n\t\t\tif (options?.zoomLevel != null) {\n\t\t\t\tthis.core.camera.setZoomLevel(options.zoomLevel);\n\t\t\t\tresolve(mapData);\n\t\t\t} else {\n\t\t\t\t// otherwise we focusOn the map that's just added\n\t\t\t\tif (this.core.mode !== 'outdoors-overlay' && boundingBox) {\n\t\t\t\t\tconst insets = options?.screenOffsets ?? {\n\t\t\t\t\t\ttop: PERCENT_OF_SCREEN_PADDING * this.core.canvasHeight,\n\t\t\t\t\t\tleft: PERCENT_OF_SCREEN_PADDING * this.core.canvasWidth,\n\t\t\t\t\t\tright: PERCENT_OF_SCREEN_PADDING * this.core.canvasWidth,\n\t\t\t\t\t\tbottom: PERCENT_OF_SCREEN_PADDING * this.core.canvasHeight,\n\t\t\t\t\t};\n\t\t\t\t\tthis.core.camera\n\t\t\t\t\t\t.focusOn(boundingBox, {\n\t\t\t\t\t\t\tduration: ADD_MAP_FOCUS_ON_DURATION,\n\t\t\t\t\t\t\tpadding: insets,\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t// TODO: focusOn should have option not to change elevation\n\t\t\t\t\t\t\tthis.Camera.setElevation(this.currentFloor.elevation);\n\t\t\t\t\t\t\tresolve(mapData);\n\t\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tresolve(mapData);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tsetFloor(floor: Floor | string, reason?: TFloorChangeReason) {\n\t\treturn this.currentMap.setFloor(getId(floor), reason);\n\t}\n\n\tsetFloorStack(floorStack: FloorStack | string, reason?: TFloorChangeReason) {\n\t\treturn this.currentMap.setFloorStack(getId(floorStack), reason);\n\t}\n\n\tupdateWatermark(options: WatermarkUpdateOptions) {\n\t\tthis.core.updateWatermark(options);\n\t}\n\n\tget currentFloorStack() {\n\t\tconst currentFloorStackId = this.currentMap.currentFloorStack.id;\n\t\tif (!currentFloorStackId) throw new MappedinError('Missing currentFloorStack.');\n\n\t\tconst floorStack = this.mapData?.getById('floor-stack', currentFloorStackId);\n\t\tif (!floorStack) throw new MappedinError('FloorStack was not found in map data.');\n\n\t\treturn floorStack;\n\t}\n\n\tget currentFloor() {\n\t\t// properly handle the floorId missing instead of asking compiler to trust us\n\t\tconst currentFloorId = this.currentMap.currentFloor.id;\n\t\tif (!currentFloorId) throw new MappedinError('Missing currentFloor object from GeoJsonApi');\n\t\t// TODO: currentFloor can technically be undefined should we reflect that in typings. Does it make sense for currentFloor to be undefined ever\n\t\tconst currentFloor = this.mapData?.getById('floor', currentFloorId);\n\t\tif (!currentFloor) throw new MappedinError('Missing currentFloor');\n\n\t\treturn currentFloor;\n\t}\n\n\tgetState<T extends MapElementsWithState | string>(target: T): TGetState<T>;\n\tgetState(target: MapElementsWithState | string): TGetState<MapElementsWithState | string> | undefined {\n\t\tif (typeof target === 'object' && Path.is(target)) {\n\t\t\tLogger.warn(\n\t\t\t\t'Cannot get state of a Path directly. Use getState() on individual segments within Path.segments[] instead.',\n\t\t\t);\n\t\t}\n\t\tconst targetId = getTargetID(target, this);\n\t\tconst state = this.core.getState(targetId);\n\t\tif (!state) return undefined;\n\n\t\tif ([WALLS.Interior, WALLS.Exterior].includes(target as WALLS) && state.type === 'geometry-group') {\n\t\t\treturn getWallsState(state);\n\t\t} else if ([DOORS.Interior, DOORS.Exterior].includes(target as DOORS) && state.type === 'geometry-group') {\n\t\t\treturn getDoorsState(state);\n\t\t} else if (state.type === 'geometry') {\n\t\t\treturn getGeometryState(state);\n\t\t} else if (\n\t\t\tstate.type === 'label' &&\n\t\t\tstate.options.appearance &&\n\t\t\tstate.options.rank !== undefined &&\n\t\t\tstate.options.interactive !== undefined\n\t\t) {\n\t\t\treturn getLabelState(state);\n\t\t} else if (\n\t\t\tstate.type === 'marker' &&\n\t\t\tstate.options?.rank !== undefined &&\n\t\t\tstate.options.interactive !== undefined\n\t\t) {\n\t\t\treturn getMarkerState(state, this.Markers.getById(state.id.toString())?.marker);\n\t\t} else if (state.type === 'model') {\n\t\t\treturn getModelState(state);\n\t\t} else if (state.type === 'image') {\n\t\t\treturn getImageState(state);\n\t\t} else if (state.type === 'text3d') {\n\t\t\treturn getText3DState(state);\n\t\t} else if (state.type === 'geometry-group' && target && typeof target !== 'string' && Shape.is(target)) {\n\t\t\treturn getShapeState(state);\n\t\t} else if (state.type === 'path') {\n\t\t\treturn getPathState(state);\n\t\t} else if (state.type === 'group-container' && typeof target !== 'string' && Floor.is(target)) {\n\t\t\treturn getFloorState(state, this.currentMap.floorsById.get(target.id), this.core);\n\t\t} else if (\n\t\t\tstate.type === 'group-container' &&\n\t\t\tstate.children.length > 0 &&\n\t\t\ttypeof target !== 'string' &&\n\t\t\tFacade.is(target)\n\t\t) {\n\t\t\t// for facades lets update the child state but leave the container visible so that it can be focusable\n\t\t\tconst facadeGeometryState = this.core.getState<GroupContainerState>(state.children[0].id);\n\n\t\t\treturn getFacadeState(facadeGeometryState);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tsetHoverColor(c: string) {\n\t\tthis.core.setState({ hoverColor: c });\n\t}\n\tgetHoverColor() {\n\t\tconst state = this.core.getState();\n\n\t\treturn state?.type === 'map-view' ? state.hoverColor : undefined;\n\t}\n\n\t/**\n\t * Create a coordinate from a screen coordinate\n\t * @param x - The x coordinate of the screen\n\t * @param y - The y coordinate of the screen\n\t * @param floor - The floor to use for the coordinate\n\t * @returns The coordinate\n\t */\n\tcreateCoordinateFromScreenCoordinate(x: number, y: number, floor?: Floor) {\n\t\t// for legacy support, we can pass in a floor object\n\t\t// which uses the world plane\n\t\tif (floor != null) {\n\t\t\tconst coord = this.core.projectScreenXYToCoordinate(x, y, true);\n\n\t\t\treturn coord ? new Coordinate(coord.coordinate[1], coord.coordinate[0], floor.id) : undefined;\n\t\t}\n\n\t\t// determine the floor and use all geometry to project instead of just the world plane\n\t\tconst result = this.core.projectScreenXYToCoordinate(x, y);\n\t\tif (result == null || result.coordinate == null) return undefined;\n\n\t\tconst { coordinate, groupContainers } = result;\n\n\t\tconst floorId = groupContainers\n\t\t\t?.find(c => {\n\t\t\t\tconst containerId = c.userData.entityId.toString();\n\n\t\t\t\treturn containerId.includes('f_') || containerId.includes('m_');\n\t\t\t})\n\t\t\t?.userData.entityId.toString();\n\n\t\treturn new Coordinate(coordinate[1], coordinate[0], floorId);\n\t}\n\n\tgetScreenCoordinateFromCoordinate(coordinate: Coordinate) {\n\t\tlet altitude = 0;\n\t\tif (coordinate.floorId != null) {\n\t\t\tconst floor = this.mapData?.getById('floor', coordinate.floorId);\n\t\t\tif (floor != null) {\n\t\t\t\taltitude = this.getState(floor)?.altitude ?? 0;\n\t\t\t}\n\t\t}\n\n\t\treturn this.core.projectCoordinateToScreenXY([coordinate.longitude, coordinate.latitude, altitude]);\n\t}\n\n\tisInView(target: Space | MapObject | Label | Marker | string) {\n\t\treturn this.core.isInView(typeof target === 'string' ? target : target.id);\n\t}\n\n\tgetInView<T extends string>(type: T, options?: TGetInViewOptions): MapFeatureOfType<T>[] {\n\t\tconst ids = this.core.queryGeometry2DInView({\n\t\t\tscreenOffsets: options?.screenOffsets,\n\t\t\tfullyContains: options?.fullyContains,\n\t\t});\n\n\t\tif (ids.length === 0) return [];\n\n\t\tlet result: unknown[] = [];\n\t\tswitch (type) {\n\t\t\tcase Label.__type:\n\t\t\t\tresult = ids\n\t\t\t\t\t.map(id => this.Labels.getById(id))\n\t\t\t\t\t.filter(l => l != null)\n\t\t\t\t\t.map(l => l.label);\n\t\t\t\tbreak;\n\n\t\t\tcase Marker.__type:\n\t\t\t\tresult = ids\n\t\t\t\t\t.map(id => this.Markers.getById(id))\n\t\t\t\t\t.filter(m => m != null)\n\t\t\t\t\t.map(m => m.marker);\n\t\t}\n\n\t\treturn result as MapFeatureOfType<T>[];\n\t}\n\n\tasync __EXPERIMENTAL__auto(): Promise<{ labels: Label[] }> {\n\t\tconst mapData = this.getMapDataInternal();\n\t\tif (!mapData) {\n\t\t\tthrow new Error('Map data not found');\n\t\t}\n\t\treturn await auto(mapData, this);\n\t}\n\n\ttween<T extends Record<string, unknown>>(object: T) {\n\t\tconst tween = new Tween<T>(object);\n\t\tthis.core.getExternalTweenGroup().add(tween);\n\t\tthis.core.render();\n\n\t\treturn tween;\n\t}\n\n\tremoveTween(tween: Tween<any>) {\n\t\tthis.core.getExternalTweenGroup().remove(tween);\n\t}\n\n\ttweenGroup() {\n\t\treturn this.core.getExternalTweenGroup();\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tget __core() {\n\t\treturn this.core;\n\t}\n\n\t/**\n\t * Get camera state for synchronization\n\t * @private\n\t */\n\tprivate getCameraState(): TStateChangedInternalPayload['Camera'] {\n\t\treturn this.core.camera.getState() satisfies TStateChangedInternalPayload['Camera'];\n\t}\n\n\t/**\n\t * Get navigation state for synchronization\n\t * @private\n\t */\n\tprivate getNavigationState() {\n\t\treturn {\n\t\t\tisMultiFloor: this.Navigation.isMultiFloor,\n\t\t\tfloorStacks: this.Navigation.floorStacks,\n\t\t\tfloors: this.Navigation.floors,\n\t\t\tactiveDirections: this.Navigation.activeDirections,\n\t\t\tactivePath: this.Navigation.activePath,\n\t\t\tpaths: this.Navigation.paths,\n\t\t};\n\t}\n\n\t/**\n\t * Get all current state information for synchronization\n\t * @internal\n\t */\n\tgetAllState() {\n\t\tconst state: TStateChangedInternalPayload = {\n\t\t\tcurrentFloor: this.currentFloor,\n\t\t\tcurrentFloorStack: this.currentFloorStack,\n\t\t\tCamera: this.getCameraState(),\n\t\t\tNavigation: this.getNavigationState(),\n\t\t\tmanualFloorVisibility: this.manualFloorVisibility,\n\t\t} as TStateChangedInternalPayload;\n\n\t\treturn state;\n\t}\n\n\t/**\n\t * Publish all current state information\n\t * @internal\n\t */\n\tpublishAllState() {\n\t\tthis.externalPubSub.publish('state-change-internal', this.getAllState());\n\t}\n\n\tclear() {\n\t\tthis.Navigation.clear();\n\t\tthis.Shapes.removeAll();\n\t\tthis.Paths.removeAll();\n\t\tthis.Models.removeAll();\n\t\tthis.Markers.removeAll();\n\t\tthis.Image3D.removeAll();\n\t\tthis.Labels.removeAll();\n\t}\n\n\tdestroy() {\n\t\tthis.clear();\n\t\tthis.core.destroy();\n\t}\n\n\tgetOptimalVisualDistanceBetweenFloors(floors: Floor[], debug = false) {\n\t\tconst currentMap = this.currentMap;\n\t\tif (!currentMap) {\n\t\t\tLogger.error(`Cannot compute optimal visual distance between floors. Missing current map.`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (floors.length < 2) {\n\t\t\tLogger.warn(`Cannot compute optimal visual distance between floors. Must provide at least 2 floors.`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst floor = currentMap.renderer.getInternalState().geometry3DMap.get(floors[0].id);\n\t\tconst floor2 = currentMap.renderer.getInternalState().geometry3DMap.get(floors[1].id);\n\t\tif (!floor || !floor2) {\n\t\t\tLogger.warn(`Cannot compute optimal visual distance between floors. Floors not found in current map.`);\n\t\t\treturn;\n\t\t}\n\n\t\tassertType(floor, 'group-container');\n\t\tassertType(floor2, 'group-container');\n\n\t\tif (debug) {\n\t\t\t// Visualize bounding boxes of floors\n\t\t\tconst floorBox = new Box3();\n\t\t\tfloorBox.setFromObject(floor);\n\t\t\tconst floor2Box = new Box3();\n\t\t\tfloor2Box.setFromObject(floor2);\n\n\t\t\t// Remove existing debug boxes if any\n\t\t\tfloor.children.forEach(child => {\n\t\t\t\tif (child instanceof Mesh && child.userData.debugBox) {\n\t\t\t\t\t// floor.remove(child);\n\t\t\t\t\tdestroyObject3D(child);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfloor2.children.forEach(child => {\n\t\t\t\tif (child instanceof Mesh && child.userData.debugBox) {\n\t\t\t\t\t// floor2.remove(child);\n\t\t\t\t\tdestroyObject3D(child);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!isFiniteBox(floorBox) || !isFiniteBox(floor2Box)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Create mesh for floor bounding box\n\t\t\tconst floorBoxGeometry = new BoxGeometry(\n\t\t\t\tfloorBox.max.x - floorBox.min.x,\n\t\t\t\tfloorBox.max.y - floorBox.min.y,\n\t\t\t\tfloorBox.max.z - floorBox.min.z,\n\t\t\t);\n\t\t\tconst floorBoxMaterial = new MeshBasicMaterial({ color: 0x0000ff, transparent: true, opacity: 0.5 });\n\t\t\tconst floorBoxMesh = new Mesh(floorBoxGeometry, floorBoxMaterial);\n\t\t\tfloorBoxMesh.position.set(\n\t\t\t\t(floorBox.min.x + floorBox.max.x) / 2,\n\t\t\t\t(floorBox.min.y + floorBox.max.y) / 2,\n\t\t\t\t(floorBox.min.z + floorBox.max.z) / 2,\n\t\t\t);\n\t\t\tfloorBoxMesh.userData.debugBox = true;\n\n\t\t\t// Create mesh for floor2 bounding box\n\t\t\tconst floor2BoxGeometry = new BoxGeometry(\n\t\t\t\tfloor2Box.max.x - floor2Box.min.x,\n\t\t\t\tfloor2Box.max.y - floor2Box.min.y,\n\t\t\t\tfloor2Box.max.z - floor2Box.min.z,\n\t\t\t);\n\t\t\tconst floor2BoxMaterial = new MeshBasicMaterial({ color: 'cyan', transparent: true, opacity: 0.5 });\n\t\t\tconst floor2BoxMesh = new Mesh(floor2BoxGeometry, floor2BoxMaterial);\n\t\t\tfloor2BoxMesh.position.set(\n\t\t\t\t(floor2Box.min.x + floor2Box.max.x) / 2,\n\t\t\t\t(floor2Box.min.y + floor2Box.max.y) / 2,\n\t\t\t\t(floor2Box.min.z + floor2Box.max.z) / 2,\n\t\t\t);\n\t\t\tfloor2BoxMesh.userData.debugBox = true;\n\n\t\t\t// Add meshes to the floor objects instead of scene\n\t\t\tfloor.add(floorBoxMesh);\n\t\t\tfloor2.add(floor2BoxMesh);\n\t\t}\n\n\t\tconst result = currentMap.renderer.computeMinZOffsetBetweenContainers(floor, floor2);\n\t\tif (result === -1) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn result;\n\t}\n}\n\n/**\n * Sets the base URL directory where worker scripts are hosted for CSP compatibility.\n *\n * This function configures both the MapLibre and collision system workers to load from\n * external URLs instead of using inline blob URLs. The SDK expects two specific worker\n * files to be available in the provided directory:\n * - `maplibre-worker.csp.js` - For MapLibre map rendering\n * - `collision-worker.csp.js` - For the collision detection system\n *\n * Using this approach enables compatibility with strict Content Security Policies\n * that block unsafe-eval and blob: URLs.\n *\n * @param baseUrl - Base URL directory where worker scripts are hosted (without trailing slash)\n *                  Example: \"https://cdn.example.com/workers\"\n *\n * @example\n * ```typescript\n * import { setWorkersUrl } from '@mappedin/mappedin-js';\n *\n * // Call before initializing any maps\n * setWorkersUrl('https://cdn.example.com/workers');\n * // This will load:\n * // - https://cdn.example.com/workers/maplibre-worker.csp.js\n * // - https://cdn.example.com/workers/collision-worker.csp.js\n * ```\n *\n * @remarks\n * - The worker files can be found in the published package at:\n *   `node_modules/@mappedin/mappedin-js/lib/esm/workers/`\n * - For deployment, copy these files to your web server or CDN\n * - A better approach is to add these files to your build process to ensure\n *   they're always in sync with your application\n * - Call this function before creating any map instances\n */\nexport function setWorkersUrl(baseUrl: string) {\n\tif (baseUrl === '') {\n\t\tsetCollisionWorkerUrl('');\n\t\tsetMaplibreWorkerUrl('');\n\t\treturn;\n\t}\n\n\t// ensure the file name matches the build script in build.mjs\n\tsetMaplibreWorkerUrl(`${baseUrl}/${MAPLIBRE_WORKER_PATH}`);\n\tsetCollisionWorkerUrl(`${baseUrl}/${COLLISION_WORKER_PATH}`);\n}\n", "export { Label } from './label';\nexport { Marker } from './marker';\nexport { Image3DView } from './image3d';\nexport { Model } from './model';\nexport { Path, PathSegment } from './path';\nexport { CameraTransform, type CameraTransformOptions } from './camera-transform';\nexport { Shape } from './shape';\nexport { Text3DView } from './text3d';\n", "import type { IAnchorable, IFocusable } from '../types';\n\n/**\n * Class representing a label on the {@link MapView}.\n *\n * Labels contain text and an image that are anchored to a specific point on the map. They automatically rotate and show and hide based on priority and zoom level.\n * Use them to inform users about location names, points of interest and more!\n *\n * Effective use of labels allows an app to convey additional information to the user.\n * For example labels can be used to show room names, important points of interest, main entrances or any other piece of contextual information that is useful to the user.\n *\n * Refer to the [Labels Guide](https://developer.mappedin.com/web-sdk/labels) for more information and interactive examples.\n */\nexport class Label implements IFocusable {\n\t/**\n\t * The label's id\n\t */\n\treadonly id: string;\n\t/**\n\t * The label's text\n\t */\n\treadonly text: string;\n\t/**\n\t * The target object where the label is anchored.\n\t */\n\treadonly target: IAnchorable;\n\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'label';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = Label.__type;\n\n\t/**\n\t * Checks if the provided instance is of type Label.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a Label, false otherwise.\n\t */\n\tstatic is(instance: object): instance is Label {\n\t\treturn (instance as { __type: string }).__type === Label.__type;\n\t}\n\n\t/** @internal */\n\tget focusTarget() {\n\t\treturn this.target.anchorTarget;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(id: string, text: string, target: IAnchorable) {\n\t\tthis.id = id;\n\t\tthis.text = text;\n\t\tthis.target = target;\n\t}\n}\n", "import type { IAnchorable, IFocusable } from '../types';\n\n/**\n * Mappedin JS allows adding and removing Markers on a map using the {@link Markers} class. Markers are elements containing HTML that Mappedin JS anchors to a {@link Door}, {@link Space}, {@link Coordinate} or {@link Node}.\n * They are automatically rotated and repositioned when the camera moves.\n *\n * Refer to the [Markers Guide](https://developer.mappedin.com/web-sdk/markers) for more information and interactive examples.\n */\nexport class Marker implements IFocusable {\n\t/**\n\t * The marker's id\n\t */\n\tid: string;\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'marker';\n\n\t#target: IAnchorable;\n\n\tget target() {\n\t\treturn this.#target;\n\t}\n\n\tget coordinate() {\n\t\treturn this.#target.anchorTarget;\n\t}\n\n\ttoJSON() {\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\t__type: Marker.__type,\n\t\t\ttarget: this.target,\n\t\t\tcoordinate: this.coordinate,\n\t\t};\n\t}\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = Marker.__type;\n\n\t/**\n\t * The HTML element that represents the marker.\n\t */\n\treadonly contentEl: HTMLElement;\n\n\t/**\n\t * Checks if the provided instance is of type Marker\"\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a Marker, false otherwise.\n\t */\n\tstatic is(instance: object): instance is Marker {\n\t\treturn (instance as { __type: string }).__type === Marker.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(id: string, contentEl: HTMLElement, target: IAnchorable) {\n\t\tthis.id = id;\n\t\t/**\n\t\t * The HTML element that makes up the content of the marker.\n\t\t */\n\t\tthis.contentEl = contentEl;\n\t\t/**\n\t\t * The target the marker is anchored to.\n\t\t */\n\t\tthis.#target = target;\n\t}\n\n\t/** @internal */\n\tget focusTarget() {\n\t\treturn this.target.anchorTarget;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tupdateTarget(target: IAnchorable) {\n\t\tthis.#target = target;\n\t}\n}\n", "import type { IAnchorable } from '../types';\n\n/**\n * Class representing an Image on the {@link MapView}.\n */\nexport class Image3DView {\n\t/**\n\t * The image's id\n\t */\n\t#id: string;\n\n\t/**\n\t * The image's url\n\t */\n\t#url: string;\n\t/**\n\t * The image's target\n\t */\n\treadonly target: IAnchorable;\n\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'image-3d';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = Image3DView.__type;\n\n\t/**\n\t * Checks if the provided instance is of type Image\"\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a Image, false otherwise.\n\t */\n\tstatic is(instance: object): instance is Image3DView {\n\t\treturn (instance as { __type: string }).__type === Image3DView.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(id: string, url: string, target: IAnchorable) {\n\t\tthis.#id = id;\n\t\tthis.#url = url;\n\t\tthis.target = target;\n\t}\n\n\t/**\n\t * The image's id\n\t */\n\tget id() {\n\t\treturn this.#id;\n\t}\n\n\t/**\n\t * The image's url\n\t */\n\tget url() {\n\t\treturn this.#url;\n\t}\n}\n", "import type { IAnchorable } from '../types';\n\n/**\n * Class representing a 3D model on the {@link MapView}.\n *\n * Adding 3D models to a map can be a great way to represent landmarks to help users find key locations. They could also be used to show the location of assets or represent furniture to provide a rich indoor layout.\n\n * Mappedin JS supports models in Graphics Library Transmission Format (GLTF) and GL Transmission Format Binary (GLB) format. Models with nested meshes are not supported and should not be used.\n *\n * 3D Models can be added to a {@link Coordinate}, {@link Door} or {@link Space}.\n * When adding the same model to multiple locations at the same time always use an array instead of calling the add method multiple times.\n * This allows the SDK to re-use the same instance of the model to reduce RAM usage and rendering time, resulting in better performance.\n *\n * Models are added using {@link Models.add}.\n *\n * Refer to the [3D Models Guide](https://developer.mappedin.com/web-sdk/3d-models) for more information and interactive examples.\n */\nexport class Model {\n\t/**\n\t * The model's id\n\t */\n\tid: string;\n\t/**\n\t * The group's id\n\t */\n\tgroupId: string;\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'model';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = Model.__type;\n\n\t#target: IAnchorable;\n\n\tget target() {\n\t\treturn this.#target;\n\t}\n\n\t/**\n\t * Checks if the provided instance is of type Model\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a Marker, false otherwise.\n\t */\n\tstatic is(instance: object): instance is Model {\n\t\treturn (instance as { __type: string }).__type === Model.__type;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(id: string, groupId: string, target: IAnchorable) {\n\t\tthis.id = id;\n\t\tthis.groupId = groupId;\n\t\tthis.#target = target;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tupdateTarget(target: IAnchorable) {\n\t\tthis.#target = target;\n\t}\n\ttoJSON() {\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\t__type: Model.__type,\n\t\t\tgroupId: this.groupId,\n\t\t\ttarget: this.#target,\n\t\t};\n\t}\n}\n", "import { type Coordinate } from '../map-data-objects';\nimport type { IFocusable } from '../types';\nimport { computeTotalDistanceBetweenCoordinates } from '../utils/misc';\n\n/**\n * @experimental\n *\n * A segment of a complete path. This can be a continuous portion of the path on a single floor, or\n * the transition of a path between two floors, or a transition between indoors and outdoors.\n */\nexport class PathSegment implements IFocusable {\n\treadonly id: string;\n\n\treadonly coordinates: Coordinate[];\n\n\t#cachedDistance: number | undefined;\n\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'path-segment';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = PathSegment.__type;\n\n\t/**\n\t * Checks if the provided instance is a PathSegment.\n\t */\n\tstatic is(instance: object): instance is PathSegment {\n\t\treturn (instance as { __type: string }).__type === PathSegment.__type;\n\t}\n\n\tconstructor(id: string, coordinates: Coordinate[]) {\n\t\tthis.id = id;\n\t\tthis.coordinates = coordinates;\n\t}\n\n\t/**\n\t * Whether the path segment is a connection segment between two floors.\n\t */\n\tget isConnectionSegment() {\n\t\treturn this.coordinates.length === 2 && this.coordinates[0].floorId !== this.coordinates[1].floorId;\n\t}\n\n\t/**\n\t * The distance of the path segment in meters.\n\t */\n\tget distance() {\n\t\tif (this.#cachedDistance) {\n\t\t\treturn this.#cachedDistance;\n\t\t}\n\n\t\tthis.#cachedDistance = computeTotalDistanceBetweenCoordinates(this.coordinates);\n\n\t\treturn this.#cachedDistance;\n\t}\n\n\t/** @internal */\n\tget focusTarget() {\n\t\treturn this.coordinates;\n\t}\n}\n\n/**\n * Class representing a path on the {@link MapView}.\n *\n * Paths are used to indicate a route on the map and can be added and removed using {@link Paths.add} and {@link Paths.remove}.\n */\nexport class Path implements IFocusable {\n\t/**\n\t * The path's id\n\t */\n\tid: string;\n\n\t/**\n\t * The promise that resolves when the current path animation is complete.\n\t */\n\tanimation: Promise<void>;\n\n\t/**\n\t * The coordinates of the path.\n\t */\n\tcoordinates: Coordinate[];\n\n\t/**\n\t * @experimental\n\t *\n\t * The segments of the path.\n\t */\n\tsegments: PathSegment[];\n\n\t#cachedDistance: number | undefined;\n\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'path';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = Path.__type;\n\n\t/**\n\t * Checks if the provided instance is a Path.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a Path, false otherwise.\n\t */\n\tstatic is(instance: object): instance is Path {\n\t\treturn (instance as { __type: string }).__type === Path.__type;\n\t}\n\n\t/** @internal */\n\tget focusTarget() {\n\t\treturn this.coordinates;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(\n\t\tid: string,\n\t\tdrawAnimation: Promise<void>,\n\t\tcoordinates: Coordinate[],\n\t\tsegments: {\n\t\t\tid: string | number;\n\t\t\tcoordinates: Coordinate[];\n\t\t}[],\n\t) {\n\t\tthis.id = id;\n\t\tthis.animation = drawAnimation;\n\t\tthis.coordinates = coordinates;\n\t\tthis.segments = segments.map(({ id, coordinates }) => new PathSegment(id.toString(), coordinates));\n\t}\n\n\t/**\n\t * The distance of the path in meters.\n\t */\n\tget distance() {\n\t\tif (this.#cachedDistance) {\n\t\t\treturn this.#cachedDistance;\n\t\t}\n\n\t\tthis.#cachedDistance = computeTotalDistanceBetweenCoordinates(this.coordinates);\n\n\t\treturn this.#cachedDistance;\n\t}\n\n\ttoJSON() {\n\t\treturn {\n\t\t\t__type: Path.__type,\n\t\t\tid: this.id,\n\t\t\tcoordinates: this.coordinates,\n\t\t\tsegments: this.segments,\n\t\t};\n\t}\n}\n", "import { round } from '@packages/internal/common';\nimport { Coordinate } from '../map-data-objects';\nimport type { Camera } from '../api-geojson';\n\n/**\n * Configuration options for CameraTransform precision.\n */\nexport interface CameraTransformOptions {\n\t/**\n\t * Number of decimal places for coordinate precision.\n\t * Default: 7 (centimeter accuracy)\n\t * Set to -1 to disable coordinate rounding.\n\t *\n\t * Note: ZoomLevel is always rounded to 5 decimal places for consistency\n\t */\n\tprecision?: number;\n}\n\n/**\n * Precision constant for centimeter-level coordinate accuracy.\n * 7 decimal places provides approximately 1cm accuracy for lat/lng coordinates.\n */\nconst CENTIMETER_PRECISION = 7;\n\n/**\n * Class representing camera transformation data.\n */\nexport class CameraTransform {\n\t#internalCamera: Camera;\n\t#precision: number;\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(camera: Camera, options?: CameraTransformOptions) {\n\t\tthis.#internalCamera = camera;\n\t\tthis.#precision = options?.precision ?? CENTIMETER_PRECISION;\n\t}\n\n\ttoJSON() {\n\t\treturn {\n\t\t\tcenter: this.center,\n\t\t\tbearing: this.bearing,\n\t\t\tpitch: this.pitch,\n\t\t\tzoomLevel: this.zoomLevel,\n\t\t};\n\t}\n\n\t/**\n\t * Getter for the center coordinate of the camera.\n\t *\n\t * @returns Center Coordinate with precision applied (default: 7 decimal places for centimeter accuracy).\n\t */\n\tget center() {\n\t\tconst originalCenter = this.#internalCamera.center;\n\n\t\t// If precision is disabled (-1), return original coordinates\n\t\tif (this.#precision === -1) {\n\t\t\treturn originalCenter;\n\t\t}\n\n\t\t// Round coordinates to specified precision and create new Coordinate instance\n\t\tconst roundedLat = round(originalCenter.latitude, this.#precision);\n\t\tconst roundedLng = round(originalCenter.longitude, this.#precision);\n\n\t\treturn new Coordinate({\n\t\t\tlatitude: roundedLat,\n\t\t\tlongitude: roundedLng,\n\t\t\tfloorId: originalCenter.floorId,\n\t\t\tverticalOffset: originalCenter.verticalOffset,\n\t\t});\n\t}\n\n\t/**\n\t * Getter for the camera's bearing in degrees.\n\t *\n\t * @returns Camera bearing in degrees.\n\t */\n\tget bearing() {\n\t\treturn this.#internalCamera.bearing;\n\t}\n\n\t/**\n\t * Getter for the camera's pitch in degrees.\n\t *\n\t * @returns Camera pitch in degrees.\n\t */\n\tget pitch() {\n\t\treturn this.#internalCamera.pitch;\n\t}\n\n\t/**\n\t * Getter for the camera's zoom level in mercator zoom levels.\n\t * Rounded to 5 decimal places for consistency.\n\t *\n\t * @see https://wiki.openstreetmap.org/wiki/Zoom_levels\n\t *\n\t * @returns Zoom level in mercator zoom levels, rounded to 5 decimal places.\n\t */\n\tget zoomLevel() {\n\t\t// Round to 5 decimal places (same precision as BlueDot implementation). This prevents tiny zoom level changes from affecting camera-change events\n\t\treturn round(this.#internalCamera.zoomLevel, 5);\n\t}\n}\n", "import type { IFocusable } from '../types';\n\n/**\n * Class representing GeoJSON shape on the {@link MapView}.\n *\n * Refer to the [Shapes Guide](https://developer.mappedin.com/web-sdk/shapes) for more information and interactive examples.\n */\nexport class Shape implements IFocusable {\n\t/**\n\t * id of Shape\n\t */\n\treadonly id: string;\n\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'shape';\n\n\t/**\n\t * @internal\n\t */\n\treadonly __type = Shape.__type;\n\n\t/**\n\t * Checks if the provided instance is of type Shape.\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a Shape, false otherwise.\n\t */\n\tstatic is(instance: object): instance is Shape {\n\t\treturn (instance as { __type: string }).__type === Shape.__type;\n\t}\n\n\t/** @internal */\n\tget focusTarget() {\n\t\treturn this;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(id: string) {\n\t\tthis.id = id;\n\t}\n}\n", "import type { Space, EnterpriseLocation } from '../map-data-objects';\n\n/**\n * Class representing an Text3D on the {@link MapView}.\n */\nexport class Text3DView {\n\t/**\n\t * The text3d's id\n\t */\n\treadonly id: string;\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(id: string, target: Space | EnterpriseLocation) {\n\t\tthis.id = id;\n\t\tthis.target = target;\n\t}\n\n\t/**\n\t * The text3d's target\n\t */\n\treadonly target: Space | EnterpriseLocation;\n\n\t/**\n\t * @internal\n\t */\n\tstatic readonly __type = 'text-3d';\n\n\treadonly __type = Text3DView.__type;\n\n\t/**\n\t * Checks if the provided instance is of type Text3D\n\t *\n\t * @param instance The instance to check.\n\t * @returns {boolean} True if the instance is a text3d, false otherwise.\n\t */\n\tstatic is(instance: object): instance is Text3DView {\n\t\treturn (instance as { __type: string }).__type === Text3DView.__type;\n\t}\n}\n", "import type {\n\tCoordinate,\n\tTAddPathOptions,\n\tTClickPayload,\n\tTDirectionInstruction,\n\tTDirectionInstructionAction,\n} from '../';\nimport Logger from '../../../packages/common/Mappedin.Logger';\nimport { ConnectionMarker, DEPARTURE_COLOR, DESTINATION_COLOR, DroppedPin } from './markers';\nimport { getHighlightedPathSegments, ms } from './utils';\nimport type { Directions, GeoJsonApi } from '../api-geojson';\nimport type { Floor, FloorStack } from '../map-data-objects';\nimport { Marker, Path } from '../map-view-objects';\nimport { randomId } from '../utils';\nimport type { TPathSectionHighlightOptions } from '../types';\nimport { Tween } from '@tweenjs/tween.js';\n\nexport type TCreateMarker = boolean | ((instruction: TDirectionInstruction) => Marker);\n\nexport const INACTIVE_PATH_VERTICAL_OFFSET = 0.01;\nexport const ACTIVE_PATH_VERTICAL_OFFSET = 0.02;\n\n/**\n * Options for navigation.\n */\nexport type TNavigationOptions = {\n\t/**\n\t * Controls whether the map should be set to the floor of the connection point when a connection point is clicked.\n\t * @default true\n\t */\n\tsetMapOnConnectionClick?: boolean;\n\t/**\n\t * Controls whether the map should be set to the floor of the departure point when the path is drawn.\n\t * @default true\n\t */\n\tsetMapToDeparture?: boolean;\n\t/**\n\t * Controls whether markers are created for the departure, destination, and connection points.\n\t */\n\tcreateMarkers?: {\n\t\t/**\n\t\t * Controls whether a marker is created for the departure point and allows a custom marker to be created.\n\t\t * @default true\n\t\t */\n\t\tdeparture?: TCreateMarker;\n\t\t/**\n\t\t * Controls whether a marker is created for the destination point and allows a custom marker to be created.\n\t\t * @default true\n\t\t */\n\t\tdestination?: TCreateMarker;\n\t\t/**\n\t\t * Controls whether markers are created for connection points and allows a custom marker to be created.\n\t\t * @default true\n\t\t */\n\t\tconnection?: TCreateMarker;\n\t};\n\n\t/**\n\t * Path Options for the non-current path in multi-destination mode.\n\t */\n\tinactivePathOptions?: Partial<TAddPathOptions>;\n\n\t/**\n\t * Controls whether the path drawing is animated across floors.\n\t * @default true\n\t */\n\tanimatePathDrawing?: boolean;\n\n\t/**\n\t * Options for the path.\n\t */\n\tpathOptions?: Partial<TAddPathOptions>;\n\t/**\n\t * Options for the markers at the departure and destination.\n\t */\n\tmarkerOptions?: {\n\t\t/**\n\t\t * The color of the departure marker.\n\t\t * @default '#1890FF'\n\t\t */\n\t\tdepartureColor?: string;\n\t\t/**\n\t\t * The color of the destination marker.\n\t\t * @default '#722ED1'\n\t\t */\n\t\tdestinationColor?: string;\n\t};\n};\n\nconst defaultPathOptions: TNavigationOptions['pathOptions'] = {\n\tdrawDuration: 1000,\n\tcolor: '#40A9FF',\n\tinteractive: false,\n\taccentColor: 'blue',\n\twidth: {\n\t\ton: 'zoom-level',\n\t\tinput: [17, 22],\n\t\toutput: [2, 0.5],\n\t},\n\tdisplayArrowsOnPath: false,\n\tanimateArrowsOnPath: false,\n};\n\nconst defaultInactivePathOptions: TNavigationOptions['inactivePathOptions'] = {\n\tdrawDuration: 1000,\n\tcolor: '#B3DDFF',\n\tinteractive: false,\n\taccentColor: '#40A9FF',\n\twidth: {\n\t\ton: 'zoom-level',\n\t\tinput: [17, 22],\n\t\toutput: [2, 0.5],\n\t},\n\tdisplayArrowsOnPath: false,\n\tanimateArrowsOnPath: false,\n};\n\nconst defaultOptions: Required<TNavigationOptions> = {\n\tsetMapOnConnectionClick: true,\n\tsetMapToDeparture: true,\n\tcreateMarkers: {\n\t\tdeparture: true,\n\t\tdestination: true,\n\t\tconnection: true,\n\t},\n\tpathOptions: defaultPathOptions,\n\tinactivePathOptions: defaultInactivePathOptions,\n\tmarkerOptions: {\n\t\tdepartureColor: DEPARTURE_COLOR,\n\t\tdestinationColor: DESTINATION_COLOR,\n\t},\n\tanimatePathDrawing: true,\n};\n\nexport type NavigationState = {\n\tisMultiFloor: boolean;\n\tfloorStacks: FloorStack[];\n\tfloors: Floor[];\n\tactiveDirections?: Directions;\n\tactivePath?: Path;\n\tpaths: Path[];\n};\n\n/**\n * Navigation-specific event types.\n */\nexport type TNavigationEvents = {\n\t/**\n\t * Emitted when the navigation state changes.\n\t */\n\t'navigation-state-change': NavigationState;\n\t/**\n\t * Emitted when a connection point is clicked.\n\t */\n\t'navigation-connection-click': { fromFloor?: Floor; toFloor: Floor; instruction: TDirectionInstruction };\n\t/**\n\t * Emitted when the active path changes.\n\t */\n\t'navigation-active-path-change': { directions: Directions; path: Path };\n};\n\n/**\n * When a user needs to get from point A to point B, drawing a path on the map helps them to navigate to their destination. It can help them to visualize the route they'll need to take, like a good treasure map.\n\n * Navigation is a helper class to display wayfinding easily on the map. Functionality of Navigation could be replicated by drawing the paths using {@link Paths} and adding well designed tooltips at connection points.\n *\n * This class is accessed using {@link MapView.Navigation}.\n *\n * {@link Navigation.draw} allows for easily drawing multiple components that make up a wayfinding illustration. It shows a human figure to mark the start point, a path with animated directional arrows, pulses in the direction of travel and a pin to mark the destination. Each of these components can be customized to match an app's style.\n *\n * Refer to the [Drawing Navigation](https://developer.mappedin.com/web-sdk/wayfinding#drawing-navigation) in the Wayfinding Guide for more information and interactive examples.\n */\nexport class Navigation {\n\t#markers = new Map<string | number, { instruction: TDirectionInstruction; marker: Marker } | undefined>();\n\t#paths = new Map<string, Path>();\n\t#geoJSONApi: GeoJsonApi;\n\t#options: Required<TNavigationOptions> = defaultOptions;\n\t#existingDraw?: {\n\t\tpromise: Promise<void>;\n\t\tcancel: () => void;\n\t};\n\t#existingDrawSync?: boolean;\n\t#directions: Directions[] = [];\n\t#activePath?: Path;\n\t// Map of directions to paths, INCLUDING internal paths\n\t#pathsMap: Map<Directions, Path> = new Map();\n\t// Map of paths to directions, INCLUDING internal paths\n\t#directionsMap: Map<Path, Directions> = new Map();\n\n\t/**\n\t * Returns true if the navigation is for a multi-floor path.\n\t */\n\tget isMultiFloor() {\n\t\tif (!this.#directions.length) return false;\n\n\t\tconst floorIds = new Set<string>();\n\t\tfor (const direction of this.#directions) {\n\t\t\tfor (const coordinate of direction.coordinates) {\n\t\t\t\tif (coordinate.floorId) {\n\t\t\t\t\tfloorIds.add(coordinate.floorId);\n\t\t\t\t\tif (floorIds.size > 1) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(geoJSONApi: GeoJsonApi) {\n\t\tthis.#geoJSONApi = geoJSONApi;\n\t}\n\n\t#isVortexAction(action?: TDirectionInstructionAction) {\n\t\treturn action != null && ['TakeConnection', 'ExitConnection', 'TakeVortex', 'ExitVortex'].includes(action.type);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tgetPathById(id: string) {\n\t\treturn this.#geoJSONApi.Paths.getById(id);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tgetMarkerById(id: string) {\n\t\treturn this.#markers.get(id);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tget paths() {\n\t\t// There is a duplicate Path in the paths map for each segment of the path.\n\t\tconst paths = new Set<Path>();\n\t\tthis.#paths.forEach(path => paths.add(path));\n\n\t\treturn Array.from(paths);\n\t}\n\n\t/**\n\t * The currently active directions.\n\t */\n\tget activeDirections() {\n\t\treturn this.#directionsMap.get(this.#activePath!);\n\t}\n\n\t/**\n\t * The currently active path.\n\t */\n\tget activePath() {\n\t\tif (!this.#activePath) return undefined;\n\n\t\treturn this.#paths.get(this.#activePath.id);\n\t}\n\n\t/**\n\t * The current list of floor stacks along the navigation paths.\n\t */\n\tget floorStacks(): FloorStack[] {\n\t\tconst mapData = this.#geoJSONApi.getMapData();\n\n\t\tif (!this.#directions.length || !mapData) return [];\n\n\t\tconst floorStacks = new Set<FloorStack>();\n\t\tfor (const direction of this.#directions) {\n\t\t\tfor (const coordinate of direction.coordinates) {\n\t\t\t\tif (coordinate.floorId) {\n\t\t\t\t\tconst floor = mapData.getById('floor', coordinate.floorId);\n\n\t\t\t\t\tif (floor) {\n\t\t\t\t\t\tfloorStacks.add(floor.floorStack);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn Array.from(floorStacks);\n\t}\n\n\t/**\n\t * The current list of floors along the navigation paths.\n\t */\n\tget floors(): Floor[] {\n\t\tconst mapData = this.#geoJSONApi.getMapData();\n\n\t\tif (!this.#directions.length || !mapData) return [];\n\n\t\tconst floors = new Set<Floor>();\n\t\tfor (const direction of this.#directions) {\n\t\t\tfor (const coordinate of direction.coordinates) {\n\t\t\t\tif (coordinate.floorId) {\n\t\t\t\t\tconst floor = mapData.getById('floor', coordinate.floorId);\n\n\t\t\t\t\tif (floor) {\n\t\t\t\t\t\tfloors.add(floor);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn Array.from(floors);\n\t}\n\n\t/**\n\t * Sets the active path by index.\n\t */\n\tsetActivePathByIndex(target: number) {\n\t\tconst directions = this.#directions[target];\n\n\t\tif (!this.#directions.length) {\n\t\t\tLogger.warn('Cannot set an active path before drawing. Call Navigation.draw() first.');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#directions[target]) {\n\t\t\tLogger.warn(`Direction #${target} does not exist`);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst path = this.#pathsMap.get(directions);\n\n\t\tif (!path) {\n\t\t\tLogger.warn('The direction is not a part of muli-direcional path');\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#setActiveDirections(path);\n\t}\n\n\t/**\n\t * Sets the active path.\n\t */\n\tsetActivePath(target: Path) {\n\t\tif (!this.#directions.length) {\n\t\t\tLogger.warn('Cannot set an active path before drawing. Call Navigation.draw() first.');\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst path = this.#directionsMap.get(target);\n\t\tif (!path) {\n\t\t\tLogger.warn(`Path \"${target.id}\" is not a part of muli-direcional path`);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#setActiveDirections(target);\n\t}\n\n\t/**\n\t * This function ensures that the active path is always above the other paths, so slightly higher than the current adjusted altitude.\n\t */\n\t#reorderPaths() {\n\t\tif (!this.#activePath) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst activePath = this.#paths.get(this.#activePath.id);\n\t\tif (!activePath) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const path of this.#paths.values()) {\n\t\t\tif (!path.id.includes('internal-')) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (path.id === this.#activePath.id) {\n\t\t\t\tfor (const segment of activePath.segments) {\n\t\t\t\t\tthis.#geoJSONApi.updateState(segment, {\n\t\t\t\t\t\tverticalOffset: ACTIVE_PATH_VERTICAL_OFFSET,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.#geoJSONApi.updateState(path, {\n\t\t\t\t\tverticalOffset: INACTIVE_PATH_VERTICAL_OFFSET,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Sets the active path by directions.\n\t */\n\tsetActivePathByDirections(target: Directions) {\n\t\tif (!this.#directions.length) {\n\t\t\tLogger.warn(\n\t\t\t\t'[setActivePathByDirections] Cannot set an active path before drawing. Call Navigation.draw() first.',\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet path = this.#pathsMap.get(target);\n\t\tif (!path) {\n\t\t\tconst foundDirections = this.#directions.find(d => d.id === target.id);\n\t\t\tif (!foundDirections) {\n\t\t\t\tLogger.warn('[setActivePathByDirections] Cannot find directions for id');\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpath = this.#pathsMap.get(foundDirections);\n\t\t}\n\n\t\tif (!path) {\n\t\t\tLogger.warn('[setActivePathByDirections] Cannot find path for directions');\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#setActiveDirections(path);\n\t}\n\n\tclearHighlightedPathSection() {\n\t\tfor (const path of this.paths) {\n\t\t\tfor (const segment of path.segments) {\n\t\t\t\tthis.#geoJSONApi.updateState(segment, {\n\t\t\t\t\thighlightCompleteFraction: 0.0,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Highlights path section between two coordinates. This can be used to highlight any section of the path or indicated the currently traveled path.\n\t */\n\thighlightPathSection(from: Coordinate, to: Coordinate, options?: TPathSectionHighlightOptions) {\n\t\tconst animationDuration = options?.animationDuration ?? 1500;\n\n\t\t// this point will be used to project all coordinates to the same cartesian space for searching\n\t\tconst projectionOrigin = this.#geoJSONApi.getMapData()!.mapCenter;\n\n\t\tconst highlightedPathSegments = getHighlightedPathSegments(this.paths, from, to, projectionOrigin);\n\t\tif (!highlightedPathSegments) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.clearHighlightedPathSection();\n\n\t\tconst tweens: Tween[] = highlightedPathSegments.map(h => {\n\t\t\tthis.#geoJSONApi.updateState(h.segment, {\n\t\t\t\thighlightStartFraction: h.startHighlightFraction,\n\t\t\t\thighlightEndFraction: h.endHighlightFraction,\n\t\t\t\thighlightColor: options?.color ?? 'red',\n\t\t\t\thighlightWidthMultiplier: options?.widthMultiplier ?? 1,\n\t\t\t});\n\t\t\treturn new Tween({ fraction: 0.0 }).to({ fraction: 1.0 }, animationDuration).onUpdate(value => {\n\t\t\t\tthis.#geoJSONApi.updateState(h.segment, {\n\t\t\t\t\thighlightCompleteFraction: value.fraction,\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\tlet resolveFn: () => void = () => undefined;\n\n\t\tconst completedPromise = new Promise(res => {\n\t\t\tresolveFn = res as () => void;\n\t\t});\n\n\t\tif (tweens.length > 0) {\n\t\t\ttweens.forEach((tween, index) => {\n\t\t\t\tif (index < tweens.length - 1) {\n\t\t\t\t\ttween.chain(tweens[index + 1]);\n\t\t\t\t}\n\t\t\t\tthis.#geoJSONApi.tweenGroup().add(tweens[index]);\n\t\t\t});\n\t\t\ttweens[0].start();\n\t\t\ttweens[tweens.length - 1].onComplete(() => {\n\t\t\t\tthis.#geoJSONApi.tweenGroup().remove(tweens[tweens.length - 1]);\n\t\t\t\tresolveFn();\n\t\t\t});\n\t\t}\n\t\treturn {\n\t\t\tanimation: completedPromise,\n\t\t};\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tdrawSync(directions: Directions | Directions[], options: TNavigationOptions = {}) {\n\t\tif (this.#existingDrawSync) {\n\t\t\tthis.clear();\n\t\t}\n\n\t\tthis.#existingDrawSync = true;\n\n\t\tthis.#setupOptions(options);\n\n\t\tconst directionsArray = Array.isArray(directions) ? directions : [directions];\n\t\tconst firstDirection = directionsArray[0];\n\t\tconst lastDirection = directionsArray[directionsArray.length - 1];\n\t\tconst firstNode = firstDirection.coordinates[0];\n\t\tthis.#directions = directionsArray;\n\n\t\tif (firstNode.floorId && this.#options.setMapToDeparture) {\n\t\t\tthis.#geoJSONApi.setFloor(firstNode.floorId);\n\t\t}\n\n\t\tif (this.#options.createMarkers?.departure) {\n\t\t\tthis.#addMarker('departure', firstDirection.instructions[0]);\n\t\t}\n\n\t\tfor (let i = 0; i < directionsArray.length; i++) {\n\t\t\tconst direction = directionsArray[i];\n\t\t\tconst pathOptions = i ? { ...this.#options.inactivePathOptions } : { ...this.#options.pathOptions };\n\t\t\tif (direction.coordinates.length < 2) {\n\t\t\t\tLogger.warn('Directions must have at least 2 coordinates');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst path = this.#createPath(direction.coordinates, {\n\t\t\t\t...pathOptions,\n\t\t\t\tanimateDrawing: this.#options.animatePathDrawing,\n\t\t\t\tverticalOffset: this.#computeVerticalOffset(i === 0 ? 'active' : 'inactive'),\n\t\t\t});\n\n\t\t\tthis.#pathsMap.set(direction, path);\n\t\t\tthis.#directionsMap.set(path, direction);\n\n\t\t\tif (this.#options.createMarkers?.connection) {\n\t\t\t\tthis.#addMarkers(direction.instructions, 'connection');\n\t\t\t}\n\n\t\t\tif (i === 0) {\n\t\t\t\tthis.#activePath = this.#pathsMap.get(this.#directions[0])!;\n\t\t\t\tthis.#geoJSONApi.externalPubSub.on('click', this.#handleClick);\n\t\t\t}\n\t\t}\n\n\t\tif (this.#options.createMarkers?.destination) {\n\t\t\tthis.#addMarker('destination', lastDirection.instructions[lastDirection.instructions.length - 1]);\n\t\t}\n\n\t\tthis.#geoJSONApi.mapObjects.forEach(mo => {\n\t\t\tmo.processFloorChange(mo.currentFloorId);\n\t\t});\n\n\t\tthis.#emitNavigationStateChanged();\n\t}\n\n\t#createPath(coordinates: Coordinate[], options: TAddPathOptions & { id?: string }): Path {\n\t\tconst id = options.id?.toString() ?? randomId();\n\t\tconst internalPath = this.#geoJSONApi.currentMap.Paths.add(coordinates, options);\n\t\tconst path = new Path(id, internalPath.animation, coordinates, internalPath.paths);\n\t\tthis.#paths.set(id, path);\n\t\treturn path;\n\t}\n\n\t#createMarker(instruction: TDirectionInstruction, contentEl: string, interactive = false): Marker {\n\t\tconst internalMarker = this.#geoJSONApi.currentMap.Markers.add(instruction.coordinate, contentEl, {\n\t\t\tinteractive,\n\t\t\tplacement: 'top',\n\t\t\trank: 'always-visible',\n\t\t});\n\t\tconst el = this.#geoJSONApi.currentMap.Markers.getContentEl(internalMarker.id.toString());\n\t\tif (!el) throw new Error('marker component should exist');\n\t\tconst marker = new Marker(internalMarker.id.toString(), el, instruction.coordinate);\n\t\treturn marker;\n\t}\n\n\t#computeVerticalOffset(type: 'active' | 'inactive') {\n\t\treturn type === 'active'\n\t\t\t? ACTIVE_PATH_VERTICAL_OFFSET + (this.#options.pathOptions?.verticalOffset ?? 0)\n\t\t\t: INACTIVE_PATH_VERTICAL_OFFSET + (this.#options.inactivePathOptions?.verticalOffset ?? 0);\n\t}\n\n\t#drawAsync(directionsArray: Directions[]) {\n\t\tconst firstDirection = directionsArray[0];\n\t\tconst lastDirection = directionsArray[directionsArray.length - 1];\n\n\t\tlet cancelled = false;\n\t\tthis.#existingDraw = {\n\t\t\tpromise: new Promise<void>(async resolve => {\n\t\t\t\tif (process.env.NODE_ENV !== 'test') {\n\t\t\t\t\tawait ms(500);\n\t\t\t\t}\n\n\t\t\t\tif (cancelled || !directionsArray.length) {\n\t\t\t\t\tresolve();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.#options.createMarkers?.departure) {\n\t\t\t\t\tthis.#addMarker('departure', firstDirection.instructions[0]);\n\t\t\t\t}\n\n\t\t\t\tfor (let i = 0; i < directionsArray.length; i++) {\n\t\t\t\t\tconst direction = directionsArray[i];\n\t\t\t\t\tconst pathOptions = i === 0 ? { ...this.#options.pathOptions } : { ...this.#options.inactivePathOptions };\n\t\t\t\t\tif (direction.coordinates.length < 2) {\n\t\t\t\t\t\tLogger.warn('Directions must have at least 2 coordinates');\n\t\t\t\t\t\tresolve();\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst path = this.#createPath(direction.coordinates, {\n\t\t\t\t\t\t...pathOptions,\n\t\t\t\t\t\tanimateDrawing: this.#options.animatePathDrawing,\n\t\t\t\t\t\tverticalOffset: this.#computeVerticalOffset(i === 0 ? 'active' : 'inactive'),\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.#pathsMap.set(direction, path);\n\t\t\t\t\tthis.#directionsMap.set(path, direction);\n\t\t\t\t\tif (i === 0) {\n\t\t\t\t\t\tthis.#activePath = this.#pathsMap.get(this.#directions[0])!;\n\t\t\t\t\t\tthis.#geoJSONApi.externalPubSub.on('click', this.#handleClick);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (process.env.NODE_ENV !== 'test') {\n\t\t\t\t\t\tawait path.animation;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (cancelled) {\n\t\t\t\t\t\tresolve();\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.#options.createMarkers?.connection) {\n\t\t\t\t\t\tthis.#addMarkers(direction.instructions, 'connection');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (this.#options.createMarkers?.destination) {\n\t\t\t\t\tthis.#addMarker('destination', lastDirection.instructions[lastDirection.instructions.length - 1]);\n\t\t\t\t}\n\n\t\t\t\tif (cancelled) {\n\t\t\t\t\tresolve();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#geoJSONApi.mapObjects.forEach(mo => {\n\t\t\t\t\tmo.processFloorChange(mo.currentFloorId);\n\t\t\t\t});\n\n\t\t\t\tthis.#emitNavigationStateChanged();\n\n\t\t\t\tresolve();\n\t\t\t}),\n\t\t\tcancel: () => {\n\t\t\t\tcancelled = true;\n\t\t\t},\n\t\t};\n\n\t\treturn this.#existingDraw.promise;\n\t}\n\n\t#setupOptions(options: TNavigationOptions) {\n\t\tthis.#options = {\n\t\t\tsetMapOnConnectionClick: options.setMapOnConnectionClick ?? defaultOptions.setMapOnConnectionClick,\n\t\t\tsetMapToDeparture: options.setMapToDeparture ?? defaultOptions.setMapToDeparture,\n\t\t\tpathOptions: {\n\t\t\t\t...defaultOptions.pathOptions,\n\t\t\t\t...options.pathOptions,\n\t\t\t},\n\t\t\tinactivePathOptions: {\n\t\t\t\t...defaultOptions.inactivePathOptions,\n\t\t\t\t...options.inactivePathOptions,\n\t\t\t},\n\t\t\tcreateMarkers: {\n\t\t\t\t...defaultOptions.createMarkers,\n\t\t\t\t...options.createMarkers,\n\t\t\t},\n\t\t\tmarkerOptions: {\n\t\t\t\t...defaultOptions.markerOptions,\n\t\t\t\t...options.markerOptions,\n\t\t\t},\n\t\t\tanimatePathDrawing: options.animatePathDrawing ?? defaultOptions.animatePathDrawing,\n\t\t};\n\t}\n\n\t#emitNavigationStateChanged() {\n\t\tthis.#geoJSONApi.publish('navigation-state-change', {\n\t\t\tisMultiFloor: this.isMultiFloor,\n\t\t\tfloorStacks: this.floorStacks,\n\t\t\tfloors: this.floors,\n\t\t\tactiveDirections: this.activeDirections,\n\t\t\tactivePath: this.activePath,\n\t\t\tpaths: this.paths,\n\t\t});\n\t}\n\t/**\n\t * Draws the specified directions on the map.\n\t * @param directions The directions to be drawn.\n\t * @param options Optional additional options for the navigation.\n\t */\n\tasync draw(directions: Directions | Directions[], options: TNavigationOptions = {}) {\n\t\tif (this.#existingDraw) {\n\t\t\tthis.clear();\n\t\t}\n\n\t\tthis.#setupOptions(options);\n\n\t\tconst directionsArray = Array.isArray(directions) ? directions : [directions];\n\t\tconst firstDirection = directionsArray[0];\n\t\tconst firstNode = firstDirection.coordinates[0];\n\t\tthis.#directions = directionsArray;\n\n\t\tif (firstNode.floorId && this.#options.setMapToDeparture) {\n\t\t\tthis.#geoJSONApi.setFloor(firstNode.floorId);\n\t\t}\n\n\t\treturn this.#drawAsync(directionsArray);\n\t}\n\n\t#setActiveDirections(target: Path) {\n\t\tthis.#activePath = target;\n\n\t\tthis.#directions.forEach(directions => {\n\t\t\tconst internalPath = this.#pathsMap.get(directions);\n\t\t\tif (internalPath) {\n\t\t\t\tconst options =\n\t\t\t\t\tinternalPath.id === this.#activePath!.id\n\t\t\t\t\t\t? { ...this.#options.pathOptions }\n\t\t\t\t\t\t: { ...this.#options.inactivePathOptions };\n\t\t\t\tthis.#geoJSONApi.updateState(internalPath, options);\n\t\t\t}\n\t\t});\n\n\t\tthis.#geoJSONApi.publish('navigation-active-path-change', {\n\t\t\tdirections: this.activeDirections!,\n\t\t\tpath: this.activePath!,\n\t\t});\n\n\t\tthis.#reorderPaths();\n\t\tthis.#emitNavigationStateChanged();\n\t}\n\n\t#addMarker(type: 'departure' | 'destination' | 'connection', instruction: TDirectionInstruction) {\n\t\tif (type === 'connection' && instruction) {\n\t\t\tconst color =\n\t\t\t\tinstruction.action.type === 'ExitConnection'\n\t\t\t\t\t? this.#options.markerOptions.departureColor\n\t\t\t\t\t: this.#options.markerOptions.destinationColor;\n\n\t\t\tlet marker: Marker;\n\t\t\tif (typeof this.#options.createMarkers?.connection === 'function') {\n\t\t\t\tmarker = this.#options.createMarkers.connection(instruction);\n\t\t\t\tthis.#geoJSONApi.updateState(marker, {\n\t\t\t\t\tinteractive: true,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tmarker = this.#createMarker(\n\t\t\t\t\tinstruction,\n\t\t\t\t\tConnectionMarker({\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * Connections aren't associated correctly in the MVF right now, so sometimes they are undefined.\n\t\t\t\t\t\t * If we have an explicit connection type, we can temporarily fallback to that even if it should\n\t\t\t\t\t\t * be deprecated.\n\t\t\t\t\t\t *\n\t\t\t\t\t\t * TODO: Remove fallback to a deprecated property when connections are overhauled in the MVF.\n\t\t\t\t\t\t */\n\t\t\t\t\t\ttype: instruction.action.connection?.type ?? instruction.action.connectionType,\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t\tdirection: instruction.action.direction,\n\t\t\t\t\t}),\n\t\t\t\t\ttrue,\n\t\t\t\t);\n\t\t\t}\n\t\t\tthis.#markers.set(marker.id, {\n\t\t\t\tinstruction,\n\t\t\t\tmarker,\n\t\t\t});\n\t\t} else {\n\t\t\tconst color =\n\t\t\t\ttype === 'departure'\n\t\t\t\t\t? this.#options.markerOptions.departureColor\n\t\t\t\t\t: this.#options.markerOptions.destinationColor;\n\t\t\tlet marker: Marker;\n\t\t\tif (typeof this.#options.createMarkers?.departure === 'function' && type === 'departure') {\n\t\t\t\tmarker = this.#options.createMarkers.departure(instruction);\n\t\t\t} else if (typeof this.#options.createMarkers?.destination === 'function' && type === 'destination') {\n\t\t\t\tmarker = this.#options.createMarkers.destination(instruction);\n\t\t\t} else {\n\t\t\t\tmarker = this.#createMarker(instruction, DroppedPin({ type, color }))!;\n\t\t\t}\n\t\t\tthis.#markers.set(marker.id, {\n\t\t\t\tinstruction,\n\t\t\t\tmarker,\n\t\t\t});\n\t\t}\n\t}\n\n\t#addMarkers(instructions: TDirectionInstruction[], type: 'connection') {\n\t\tconst connectionInstructions = instructions.filter(instruction => this.#isVortexAction(instruction.action));\n\t\tconnectionInstructions.forEach(instruction => {\n\t\t\tthis.#addMarker(type, instruction);\n\t\t});\n\t}\n\n\t#handleClick = (e: TClickPayload) => {\n\t\tif (this.#options.createMarkers?.connection && e.markers != null && e.markers.length > 0) {\n\t\t\tconst { instruction } = this.#markers.get(e.markers[0].id)!;\n\n\t\t\tif (instruction?.action.toFloor) {\n\t\t\t\tif (this.#options.setMapOnConnectionClick) {\n\t\t\t\t\tthis.#geoJSONApi.setFloor(instruction.action.toFloor.id, 'navigation-connection-click');\n\t\t\t\t}\n\t\t\t\tthis.#geoJSONApi.publish('navigation-connection-click', {\n\t\t\t\t\tinstruction,\n\t\t\t\t\tfromFloor: instruction.action.fromFloor,\n\t\t\t\t\ttoFloor: instruction.action.toFloor,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Clears any drawn navigation paths or directions from the map.\n\t */\n\tclear() {\n\t\tthis.#markers.forEach(m => {\n\t\t\tif (m?.marker) {\n\t\t\t\tthis.#geoJSONApi.currentMap.Markers.remove(m.marker.id.toString());\n\t\t\t}\n\t\t});\n\t\tthis.#markers.clear();\n\t\tthis.#paths.forEach(path => {\n\t\t\tthis.#geoJSONApi.currentMap.Paths.remove(path.segments.map(s => s.id.toString()));\n\t\t});\n\t\tthis.#paths.clear();\n\n\t\tif (this.#existingDraw) {\n\t\t\tthis.#existingDraw.cancel();\n\t\t\tthis.#existingDraw = undefined;\n\t\t}\n\t\tif (this.#existingDrawSync) {\n\t\t\tthis.#existingDrawSync = false;\n\t\t}\n\t\tthis.#directions = [];\n\t\tthis.#pathsMap.clear();\n\t\tthis.#directionsMap.clear();\n\t\tthis.#activePath = undefined;\n\t\tthis.#geoJSONApi.externalPubSub.off('click', this.#handleClick);\n\t\tthis.#geoJSONApi.mapObjects.forEach(mo => {\n\t\t\tmo.processFloorChange(mo.currentFloorId);\n\t\t});\n\n\t\tthis.#emitNavigationStateChanged();\n\t}\n}\n", "import '../styles/navigation.scss';\nimport { getStyledIcon } from './icons';\n\nconst getDeparturePin = (color: string) =>\n\t`\n\t\t<div class=\"pin-shadow\" style=\"background: ${color}\"></div>\n\t\t<svg width=\"${20 * 0.9}px\" height=\"${48 * 0.9}px\" viewBox=\"0 0 20 48\">\n\t\t\t<path\n\t\t\t\td=\"M1.37965 29.3246C1.5778 31.2167 2.27661 33.0694 3.83078 33.775C4.0998 37.1861 4.7451 40.2227 5.65918 42.4784C6.14556 43.6787 6.72883 44.71 7.41453 45.4578C8.10027 46.2056 8.97065 46.7527 9.99989 46.7527C11.0292 46.7527 11.8995 46.2055 12.585 45.4576C13.2706 44.7098 13.8536 43.6785 14.3398 42.4783C15.2536 40.2226 15.8988 37.186 16.1688 33.7752C17.7232 33.0697 18.422 31.2169 18.6201 29.3247C18.8386 27.2385 18.5165 24.6502 17.6475 22.0285L17.6473 22.0278C16.9657 19.9761 16.0319 18.1622 14.9848 16.7474C17.0884 15.1587 18.4471 12.5964 18.4471 9.7152C18.4471 4.93539 14.6967 1 9.99966 1C5.30272 1 1.54993 4.93527 1.54993 9.7152C1.54993 12.5961 2.90839 15.1583 5.01167 16.747C3.9635 18.1625 3.03185 19.977 2.3522 22.0286C1.48319 24.6503 1.16118 27.2385 1.37965 29.3246Z\"\n\t\t\t\tfill=\"${color}\"\n\t\t\t\tstroke=\"white\"\n\t\t\t\tstrokeWidth=\"2\"\n\t\t\t/>\n\t\t</svg>\n\t`;\n\nconst getDestinationPin = (color: string) =>\n\t`\n\t\t<div class=\"pin-shadow\" style=\"background: ${color}\"></div>\n\t\t<svg width=\"36\" height=\"42\" viewBox=\"-2 -2 40 46\">\n\t\t\t<path\n\t\t\t\td=\"M35.8372 5.86776C35.6765 7.92448 34.2625 10.158 32.0612 11.8292C30.0929 13.3235 25.8269 15.6292 19.3114 14.3438C13.6237 13.219 9.78333 15.5569 7.88708 21.2934L13.4303 39.7879C13.6151 40.4267 13.2536 41.0955 12.6189 41.2903C12.5064 41.3225 12.39 41.3385 12.2735 41.3385C11.7412 41.3385 11.2712 40.989 11.1166 40.4789L5.54093 21.88C5.47265 21.7474 5.43047 21.6028 5.41239 21.4542L1.07409 6.97696C0.975678 6.80825 0.921449 6.61744 0.913417 6.42263L0.053779 3.56251C-0.0406172 3.2552 -0.0104927 2.92379 0.142154 2.64058C0.29279 2.35738 0.549874 2.14649 0.857157 2.05411C1.16646 1.96172 1.49786 1.99587 1.77906 2.15052C2.06025 2.30317 2.26912 2.56226 2.35951 2.87155L2.51215 3.39375C3.55453 2.22081 4.87615 1.32902 6.35237 0.798742C10.1685 -0.631292 15.2377 -0.117113 19.5763 2.14846C22.2435 3.53834 29.0241 6.57524 34.2141 4.63904C34.5998 4.49845 35.0316 4.56272 35.361 4.81178C35.6884 5.06083 35.8673 5.45801 35.8372 5.86776Z\"\n\t\t\t\tfill=\"none\"\n\t\t\t\tstroke=\"white\"\n\t\t\t\tstrokeWidth=\"4\"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td=\"M35.8372 5.86776C35.6765 7.92448 34.2625 10.158 32.0612 11.8292C30.0929 13.3235 25.8269 15.6292 19.3114 14.3438C13.6237 13.219 9.78333 15.5569 7.88708 21.2934L13.4303 39.7879C13.6151 40.4267 13.2536 41.0955 12.6189 41.2903C12.5064 41.3225 12.39 41.3385 12.2735 41.3385C11.7412 41.3385 11.2712 40.989 11.1166 40.4789L5.54093 21.88C5.47265 21.7474 5.43047 21.6028 5.41239 21.4542L1.07409 6.97696C0.975678 6.80825 0.921449 6.61744 0.913417 6.42263L0.053779 3.56251C-0.0406172 3.2552 -0.0104927 2.92379 0.142154 2.64058C0.29279 2.35738 0.549874 2.14649 0.857157 2.05411C1.16646 1.96172 1.49786 1.99587 1.77906 2.15052C2.06025 2.30317 2.26912 2.56226 2.35951 2.87155L2.51215 3.39375C3.55453 2.22081 4.87615 1.32902 6.35237 0.798742C10.1685 -0.631292 15.2377 -0.117113 19.5763 2.14846C22.2435 3.53834 29.0241 6.57524 34.2141 4.63904C34.5998 4.49845 35.0316 4.56272 35.361 4.81178C35.6884 5.06083 35.8673 5.45801 35.8372 5.86776Z\"\n\t\t\t\tfill=\"${color}\"\n\t\t\t/>\n\t\t</svg>\n    `;\nexport const DESTINATION_COLOR = '#722ED1';\nexport const DEPARTURE_COLOR = '#1890FF';\nexport const DroppedPin = ({ type = 'departure', color = DEPARTURE_COLOR }) => {\n\treturn `<div class=\"dropped-pin-wrapper\">\n\t\t\t${type === 'departure' ? getDeparturePin(color) : getDestinationPin(color)}\n\t\t</div>`;\n};\n\nconst getSize = (state: 'default' | 'selection' | 'navigation') => {\n\tswitch (state) {\n\t\tcase 'default':\n\t\t\treturn 28;\n\t\tcase 'selection':\n\t\t\treturn 28;\n\t\tcase 'navigation':\n\t\t\treturn 32;\n\t}\n};\n\nexport const ConnectionMarker = ({ type = 'stairs', color = DESTINATION_COLOR, direction = 'up' }) => {\n\tconst size = getSize('default');\n\tconst iconSize = size / 2 + 2;\n\tconst hasDirection = direction && direction !== 'none';\n\n\treturn `<div class=\"mappedin-connection-marker\">\n\t\t\t<div class=\"connection-circle\"\n\t\t\t\trole=\"button\"\n                style=\"background:${color}; width:${size}px; height:${size}px;\"\n\t\t\t>\n                ${getStyledIcon('connection-' + type + '-16x16', 'white', iconSize) || ''}\n\t\t\t</div>\n\t\t\t${\n\t\t\t\thasDirection\n\t\t\t\t\t? `<div style=\"margin-left: -${size * 0.2}px;\">\n\t\t\t\t\t<div class=\"bouncey\">\n\t\t\t\t\t\t<div class=\"connection-circle\"\n\t\t\t\t\t\t\trole=\"button\"\n\t\t\t\t\t\t\tstyle=\"width: ${size}px; height: ${size}px;\">\n\t\t\t\t\t\t\t<div class=\"${direction === 'up' ? '' : 'arrow--down'}\">\n                                <svg viewBox=\"0 0 16 16\" style=\"fill: white; width: ${iconSize}px; height: ${iconSize}px\">\n                                    <path\n                                        fillRule=\"evenodd\"\n                                        clipRule=\"evenodd\"\n                                        d=\"M8.00015 0.5C8.34685 0.5 8.67835 0.642318 8.91714 0.893677L15.6517 7.98267C15.8441 8.18525 15.8359 8.50548 15.6333 8.69793L14.533 9.7433C14.3304 9.93575 14.0101 9.92754 13.8177 9.72496L9.26497 4.93262V15.4249C9.26497 15.7043 9.03846 15.9308 8.75904 15.9308H7.24125C6.96184 15.9308 6.73532 15.7043 6.73532 15.4249V4.93262L2.1826 9.72496C1.99015 9.92754 1.66992 9.93575 1.46734 9.7433L0.366945 8.69793C0.164367 8.50548 0.156156 8.18525 0.348604 7.98267L7.08315 0.893677C7.32194 0.642318 7.65344 0.5 8.00015 0.5Z\"\n                                        stroke=\"none\"\n                                    />\n                                </svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n\t\t\t\t\t: ''\n\t\t\t}\n\t\t</div>`;\n};\n", "const ICONS = new Map([\n\t[\n\t\t'search-16x16',\n\t\t`<svg viewBox=\"0 0 16 16\">\n\t\t\t<path\n\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\td=\"M1 7C1 3.68629 3.68629 1 7 1C10.3137 1 13 3.68629 13 7C13 8.29583 12.5892 9.49572 11.8907 10.4765L15.4614 14.0472C15.6567 14.2425 15.6567 14.559 15.4614 14.7543L14.7543 15.4614C14.559 15.6567 14.2424 15.6567 14.0472 15.4614L10.4765 11.8907C9.49571 12.5892 8.29583 13 7 13C3.68629 13 1 10.3137 1 7ZM7 11C4.79086 11 3 9.20914 3 7C3 4.79086 4.79086 3 7 3C9.20914 3 11 4.79086 11 7C11 9.20914 9.20914 11 7 11Z\"\n\t\t\t\tstroke=\"none\"\n\t\t\t/>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'close-16x16',\n\t\t`<svg viewBox=\"0 0 16 16\">\n\t\t\t<path\n\t\t\t\td=\"M12.5963 1.98959C12.7916 1.79433 13.1082 1.79433 13.3034 1.98959L14.0105 2.6967C14.2058 2.89196 14.2058 3.20855 14.0105 3.40381L3.40392 14.0104C3.20866 14.2057 2.89208 14.2057 2.69682 14.0104L1.98971 13.3033C1.79445 13.108 1.79445 12.7915 1.98971 12.5962L12.5963 1.98959Z\"\n\t\t\t\tstroke=\"none\"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td=\"M1.98971 3.40381C1.79445 3.20855 1.79445 2.89196 1.98971 2.6967L2.69682 1.98959C2.89208 1.79433 3.20866 1.79433 3.40392 1.98959L14.0105 12.5962C14.2058 12.7915 14.2058 13.108 14.0105 13.3033L13.3034 14.0104C13.1082 14.2057 12.7916 14.2057 12.5963 14.0104L1.98971 3.40381Z\"\n\t\t\t\tstroke=\"none\"\n\t\t\t/>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'empty-64x40',\n\t\t`<svg viewBox=\"0 0 64 40\">\n\t\t\t<g>\n\t\t\t\t<g clipPath=\"url(#clip0_499_175492)\">\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M32 39.7032C49.6731 39.7032 64 36.5925 64 32.7552C64 28.9179 49.6731 25.8071 32 25.8071C14.3269 25.8071 0 28.9179 0 32.7552C0 36.5925 14.3269 39.7032 32 39.7032Z\"\n\t\t\t\t\t\tstroke=\"none\"\n\t\t\t\t\t\tfill=\"#F5F5F5\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M55 13.6653L44.854 2.24866C44.367 1.47048 43.656 1 42.907 1H21.093C20.344 1 19.633 1.47048 19.146 2.24767L9 13.6663V22.8367H55V13.6653Z\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M41.613 16.8128C41.613 15.2197 42.607 13.9046 43.84 13.9036H55V31.9059C55 34.0132 53.68 35.7402 52.05 35.7402H11.95C10.32 35.7402 9 34.0122 9 31.9059V13.9036H20.16C21.393 13.9036 22.387 15.2167 22.387 16.8098V16.8317C22.387 18.4248 23.392 19.7111 24.624 19.7111H39.376C40.608 19.7111 41.613 18.4128 41.613 16.8198V16.8128Z\"\n\t\t\t\t\t\tfill=\"#FAFAFA\"\n\t\t\t\t\t/>\n\t\t\t\t</g>\n\t\t\t\t<defs>\n\t\t\t\t\t<clipPath id=\"clip0_499_175492\">\n\t\t\t\t\t\t<rect width=\"64\" height=\"40\" fill=\"white\" />\n\t\t\t\t\t</clipPath>\n\t\t\t\t</defs>\n\t\t\t</g>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'caret-12x12',\n\t\t`<svg viewBox=\"0 0 12 12\">\n\t\t\t<path\n\t\t\t\tstroke=\"none\"\n\t\t\t\td=\"M8.38828 5.78337L3.92578 1.93493C3.75938 1.79196 3.51562 1.92087 3.51562 2.15173V9.84861C3.51562 10.0795 3.75938 10.2084 3.92578 10.0654L8.38828 6.21696C8.51602 6.10681 8.51602 5.89353 8.38828 5.78337Z\"\n\t\t\t/>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'plus-16x16',\n\t\t`<svg viewBox=\"0 0 16 16\">\n\t\t\t<path\n\t\t\t\td=\"M7.5 1C7.22386 1 7 1.22386 7 1.5V7H1.5C1.22386 7 1 7.22386 1 7.5L1 8.5C1 8.77614 1.22386 9 1.5 9H7V14.5C7 14.7761 7.22386 15 7.5 15H8.5C8.77614 15 9 14.7761 9 14.5V9H14.5C14.7761 9 15 8.77614 15 8.5V7.5C15 7.22386 14.7761 7 14.5 7H9V1.5C9 1.22386 8.77614 1 8.5 1H7.5Z\"\n\t\t\t\tstroke=\"none\"\n\t\t\t/>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'recenter-16x16',\n\t\t`<svg viewBox=\"0 0 16 16\">\n\t\t\t<g stroke=\"none\">\n\t\t\t\t<path d=\"M0 2.5C0 2.22386 0.223858 2 0.5 2H1.5C1.77614 2 2 2.22386 2 2.5V13.5C2 13.7761 1.77614 14 1.5 14H0.5C0.223858 14 0 13.7761 0 13.5V2.5Z\" />\n\t\t\t\t<path\n\t\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\t\td=\"M4.5 4C4.22386 4 4 4.22386 4 4.5V11.5C4 11.7761 4.22386 12 4.5 12H11.5C11.7761 12 12 11.7761 12 11.5V4.5C12 4.22386 11.7761 4 11.5 4H4.5ZM6 6V10H10V6H6Z\"\n\t\t\t\t/>\n\t\t\t\t<path d=\"M14.5 2C14.2239 2 14 2.22386 14 2.5V13.5C14 13.7761 14.2239 14 14.5 14H15.5C15.7761 14 16 13.7761 16 13.5V2.5C16 2.22386 15.7761 2 15.5 2H14.5Z\" />\n\t\t\t</g>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'minus-16x16',\n\t\t`<svg viewBox=\"0 0 16 16\">\n\t\t\t<path\n\t\t\t\td=\"M1.5 9C1.22386 9 1 8.77614 1 8.5L1 7.5C1 7.22386 1.22386 7 1.5 7L14.5 7C14.7761 7 15 7.22386 15 7.5V8.5C15 8.77614 14.7761 9 14.5 9L1.5 9Z\"\n\t\t\t\tstroke=\"none\"\n\t\t\t/>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'logo-horizontal-206x48',\n\t\t`<svg viewBox=\"0 0 206 48\">\n\t\t\t<path d=\"M27.2678 14.2261H22.3187C21.0695 14.2261 20.4695 14.7801 20.4695 15.9852V31.142L10.3966 15.5591C9.69665 14.4784 9.2475 14.2773 7.8475 14.2261H2.97462C1.67462 14.2261 1.07631 14.7801 1.07631 15.9852V44.7665C1.07631 45.9716 1.67462 46.5256 2.97462 46.5256H7.92377C9.22207 46.5256 9.82207 45.9716 9.82207 44.7665V29.6847L19.9441 45.1926C20.695 46.3244 21.095 46.5256 22.4933 46.5256H27.2933C28.5916 46.5256 29.1916 45.9716 29.1916 44.7665V15.9852C29.1407 14.7801 28.5424 14.2261 27.2678 14.2261Z\" />\n\t\t\t<path d=\"M5.44915 10.9602C8.45863 10.9602 10.8983 8.50669 10.8983 5.48011C10.8983 2.45353 8.45863 0 5.44915 0C2.43967 0 0 2.45353 0 5.48011C0 8.50669 2.43967 10.9602 5.44915 10.9602Z\" />\n\t\t\t<path d=\"M61.7899 25.0449C63.2306 23.1903 65.078 22.2051 67.556 22.2051C72.0526 22.2051 74.7611 25.3347 74.7611 29.4511V39.2489C74.8187 39.7125 74.5306 39.9443 74.0695 39.9443H72.5136C72.0526 39.9443 71.7645 39.7125 71.8221 39.2489V29.5091C71.8221 27.1909 69.9187 25.2187 67.4984 25.2187C65.1339 25.2187 63.2323 27.1329 63.2323 29.2773V39.2489C63.2899 39.7125 63.0018 39.9443 62.5407 39.9443H60.9831C60.5221 39.9443 60.2916 39.7125 60.2916 39.2489V29.4511C60.2916 27.1329 58.3899 25.2187 56.0255 25.2187C53.7204 25.2187 51.7594 27.075 51.7594 29.2773V39.3068C51.817 39.7705 51.5289 40.0023 51.0102 40.0023H49.5119C49.0509 40.0023 48.7628 39.7705 48.7628 39.3068V23.25C48.7051 22.7864 48.9933 22.4966 49.5119 22.4966H50.9526C51.356 22.4966 51.5289 22.6704 51.5289 23.0182V24.2352C52.7407 22.9602 54.239 22.2648 56.0255 22.2648C58.4475 22.2068 60.3492 23.192 61.7899 25.0466V25.0449ZM77.1255 31.2477C77.1255 26.3216 81.1018 22.2051 86.1187 22.2051C88.539 22.2051 90.6136 23.1903 92.3441 25.1608V23.1903C92.3441 22.7267 92.5746 22.5528 93.0357 22.5528H94.4187C94.8797 22.5528 95.1102 22.7847 95.1102 23.3062V39.3648C95.1102 39.8284 94.8797 40.0602 94.4187 40.0602H93.0357C92.5746 40.0602 92.3441 39.8284 92.3441 39.4227V37.4523C90.6712 39.3648 88.5967 40.35 86.1746 40.35C81.1018 40.2341 77.1238 36.1773 77.1238 31.2477H77.1255ZM92.1136 31.2477C92.1136 27.8284 89.4611 25.2187 86.0594 25.2187C82.7746 25.2187 80.1221 27.8864 80.1221 31.2477C80.1221 34.6687 82.7746 37.2784 86.1187 37.2784C86.9062 37.2789 87.6861 37.1232 88.4138 36.8202C89.1414 36.5173 89.8026 36.0731 90.3593 35.513C90.9161 34.9528 91.3577 34.2878 91.6587 33.556C91.9597 32.8241 92.1143 32.0397 92.1136 31.2477ZM100.992 37.3943V46.3807C101.049 46.8443 100.761 47.1341 100.298 47.1341H98.7424C98.2814 47.1341 97.9933 46.9023 97.9933 46.3807V23.1903C97.9933 22.7267 98.2238 22.4369 98.7424 22.4369H100.183C100.646 22.379 100.934 22.6687 100.934 23.0744V24.9869C102.605 23.0744 104.68 22.1472 107.044 22.1472C112.002 22.1472 116.037 26.2619 116.037 31.1898C116.037 36.1176 112.059 40.2341 107.044 40.2341C104.622 40.2341 102.603 39.3068 100.992 37.3943ZM106.987 25.2187C103.7 25.2187 101.049 27.8864 101.049 31.2477C101.049 34.6687 103.7 37.2784 107.044 37.2784C110.446 37.2784 113.039 34.6108 113.039 31.2477C113.039 27.8864 110.388 25.2187 106.987 25.2187ZM121.11 37.3943V46.3807C121.168 46.8443 120.88 47.1341 120.419 47.1341H118.861C118.4 47.1341 118.112 46.9023 118.112 46.3807V23.1903C118.112 22.7267 118.342 22.4369 118.861 22.4369H120.302C120.764 22.379 121.053 22.6687 121.053 23.0744V24.9869C122.724 23.0744 124.798 22.1472 127.163 22.1472C132.12 22.1472 136.156 26.2619 136.156 31.1898C136.156 36.1176 132.178 40.2341 127.163 40.2341C124.742 40.2341 122.781 39.3068 121.11 37.3943ZM127.105 25.2187C123.819 25.2187 121.168 27.8864 121.168 31.2477C121.168 34.6687 123.819 37.2784 127.163 37.2784C130.564 37.2784 133.158 34.6108 133.158 31.2477C133.158 27.8864 130.507 25.2187 127.107 25.2187H127.105ZM153.97 32.3506H141.054C141.342 35.2483 143.995 37.4523 147.164 37.4523C148.893 37.4523 150.393 37.0466 151.719 36.0597C152.007 35.8858 152.295 35.7699 152.353 35.7699C152.583 35.7699 152.756 35.8858 152.929 36.1773L153.505 37.1625C153.622 37.3364 153.68 37.4523 153.68 37.5682C153.68 37.8 153.507 38.0318 153.103 38.3216C151.258 39.5966 149.183 40.292 146.992 40.292C141.688 40.292 137.883 36.3511 137.883 31.2477C137.883 26.204 141.803 22.2051 146.703 22.2051C151.546 22.2051 154.717 25.7983 154.717 31.0176C154.717 31.5972 154.717 32.3506 153.968 32.3506H153.97ZM141.056 30.0324H151.72C151.432 26.8432 149.473 24.929 146.648 24.929C145.241 24.8904 143.875 25.3995 142.833 26.3501C141.791 27.3007 141.154 28.6194 141.056 30.0307V30.0324ZM156.332 31.2477C156.332 26.3216 160.31 22.2051 165.326 22.2051C167.748 22.2051 169.707 23.1324 171.32 25.0449V16.2324C171.263 15.7687 171.551 15.479 172.012 15.479H173.57C174.031 15.479 174.319 15.7108 174.319 16.2324V39.3068C174.319 39.7705 174.088 40.0023 173.57 40.0023H172.129C171.666 40.0602 171.378 39.7705 171.378 39.3648V37.3943C169.649 39.3068 167.632 40.292 165.268 40.292C160.31 40.2341 156.332 36.1773 156.332 31.2477ZM171.264 31.2477C171.264 27.8284 168.612 25.2187 165.21 25.2187C161.924 25.2187 159.273 27.8864 159.273 31.2477C159.273 34.6687 161.924 37.2784 165.268 37.2784C166.057 37.2838 166.839 37.1316 167.569 36.8304C168.299 36.5292 168.962 36.0852 169.52 35.5241C170.077 34.963 170.519 34.296 170.818 33.5619C171.117 32.8277 171.268 32.0411 171.263 31.2477H171.264ZM177.72 19.0739C177.715 18.8594 177.754 18.646 177.833 18.4468C177.912 18.2476 178.031 18.0667 178.182 17.915C178.333 17.7633 178.512 17.6439 178.71 17.5642C178.909 17.4845 179.121 17.446 179.334 17.4511C179.546 17.4507 179.756 17.4923 179.952 17.5737C180.148 17.6551 180.326 17.7746 180.476 17.9254C180.626 18.0762 180.745 18.2553 180.826 18.4523C180.907 18.6494 180.948 18.8606 180.948 19.0739C180.953 19.2884 180.914 19.5017 180.835 19.7009C180.756 19.9001 180.637 20.081 180.486 20.2327C180.335 20.3845 180.156 20.5038 179.957 20.5835C179.759 20.6633 179.547 20.7017 179.334 20.6966C178.412 20.7545 177.72 20.0591 177.72 19.0739ZM177.836 39.2489V23.1903C177.836 22.7267 178.066 22.4369 178.527 22.4369H180.083C180.544 22.4369 180.832 22.6687 180.775 23.1903V39.2489C180.832 39.7125 180.544 39.9443 180.083 39.9443H178.527C178.066 39.9443 177.836 39.7125 177.836 39.2489ZM186.944 23.0165V24.1756C188.212 22.8426 189.71 22.2051 191.497 22.2051C195.937 22.2051 198.646 25.2767 198.646 29.3932V39.2489C198.703 39.7125 198.415 39.9443 197.954 39.9443H196.398C195.936 39.9443 195.705 39.7125 195.705 39.2489V29.4511C195.705 27.1329 193.803 25.2187 191.439 25.2187C189.134 25.2187 187.175 27.075 187.175 29.2773V39.3068C187.232 39.7705 186.944 40.0023 186.424 40.0023H184.868C184.407 40.0023 184.119 39.7705 184.119 39.3068V23.1903C184.061 22.7267 184.349 22.4949 184.868 22.4949H186.309C186.712 22.4949 186.944 22.6687 186.944 23.0165Z\" />\n\t\t\t<path d=\"M204 40C205.115 40 206 39.0857 206 38V37.9886C206 36.9029 205.126 36 204 36C202.885 36 202 36.9143 202 38V38.0114C202 39.0971 202.874 40 204 40ZM204 39.7829C202.989 39.7829 202.23 38.9829 202.23 38.0114V38C202.23 37.0286 203 36.2171 204 36.2171C205.011 36.2171 205.77 37.0171 205.77 37.9886V38C205.77 38.9714 205 39.7829 204 39.7829ZM203.218 38.9714H203.609V38.2743H204.034L204.517 38.9714H204.989L204.448 38.2057C204.724 38.1257 204.92 37.92 204.92 37.5886C204.92 37.1657 204.586 36.9486 204.138 36.9486H203.218V38.9714ZM203.609 37.9543V37.2914H204.103C204.368 37.2914 204.517 37.4057 204.517 37.6229C204.517 37.8171 204.368 37.9543 204.103 37.9543H203.609Z\" />\n\t\t</svg>`,\n\t],\n\t[\n\t\t'share-16x16',\n\t\t`<svg viewBox=\"0 0 16 16\">\n\t\t\t<path\n\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\td=\"M13 6C14.6569 6 16 4.65685 16 3C16 1.34315 14.6569 0 13 0C11.3431 0 10 1.34315 10 3C10 3.13463 10.0089 3.26719 10.0261 3.39712L6.82972 5.17286C6.10576 4.44825 5.10523 4 4 4C1.79086 4 0 5.79086 0 8C0 10.2091 1.79086 12 4 12C5.10523 12 6.10576 11.5518 6.82972 10.8271L10.0261 12.6029C10.0089 12.7328 10 12.8654 10 13C10 14.6569 11.3431 16 13 16C14.6569 16 16 14.6569 16 13C16 11.3431 14.6569 10 13 10C12.2011 10 11.4752 10.3123 10.9376 10.8214L7.84579 9.1037C7.94622 8.75313 8 8.38284 8 8C8 7.61716 7.94622 7.24687 7.84579 6.8963L10.9376 5.17864C11.4752 5.68775 12.2011 6 13 6ZM13 4C13.5523 4 14 3.55228 14 3C14 2.44772 13.5523 2 13 2C12.4477 2 12 2.44772 12 3C12 3.55228 12.4477 4 13 4ZM4 10C5.10457 10 6 9.10457 6 8C6 6.89543 5.10457 6 4 6C2.89543 6 2 6.89543 2 8C2 9.10457 2.89543 10 4 10ZM14 13C14 13.5523 13.5523 14 13 14C12.4477 14 12 13.5523 12 13C12 12.4477 12.4477 12 13 12C13.5523 12 14 12.4477 14 13Z\"\n\t\t\t\tstroke=\"none\"\n\t\t\t/>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'checkmark-16x16',\n\t\t`<svg viewBox=\"0 0 16 16\">\n\t\t\t<path\n\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\td=\"M15.387 3.31662C15.6008 3.49148 15.6323 3.80649 15.4574 4.02021L6.77402 14.6332C6.58509 14.8642 6.30292 14.9986 6.00457 15C5.70622 15.0013 5.42285 14.8694 5.23184 14.6402L0.551937 9.02429C0.375155 8.81215 0.403817 8.49687 0.615956 8.32009L1.38418 7.67991C1.59632 7.50312 1.9116 7.53179 2.08838 7.74392L5.99299 12.4295L13.9095 2.75374C14.0844 2.54002 14.3994 2.50852 14.6131 2.68338L15.387 3.31662Z\"\n\t\t\t\tstroke=\"none\"\n\t\t\t/>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'arrow-right-16x16',\n\t\t`<svg viewBox=\"0 0 16 16\">\n\t\t\t<path\n\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\td=\"M8.35355 1.64645C8.54881 1.45118 8.8654 1.45118 9.06066 1.64645L14.7071 7.29289C15.0976 7.68342 15.0976 8.31658 14.7071 8.70711L9.06066 14.3536C8.8654 14.5488 8.54882 14.5488 8.35355 14.3536L7.64645 13.6464C7.45118 13.4512 7.45118 13.1346 7.64645 12.9393L11.5858 9H0.5C0.223858 9 0 8.77614 0 8.5V7.5C0 7.22386 0.223858 7 0.5 7H11.5858L7.64645 3.06066C7.45118 2.8654 7.45118 2.54882 7.64645 2.35355L8.35355 1.64645Z\"\n\t\t\t\tstroke=\"none\"\n\t\t\t/>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'arrow-up-16x16',\n\t\t`<svg viewBox=\"0 0 16 16\">\n\t\t\t<path\n\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\td=\"M8.00015 0.5C8.34685 0.5 8.67835 0.642318 8.91714 0.893677L15.6517 7.98267C15.8441 8.18525 15.8359 8.50548 15.6333 8.69793L14.533 9.7433C14.3304 9.93575 14.0101 9.92754 13.8177 9.72496L9.26497 4.93262V15.4249C9.26497 15.7043 9.03846 15.9308 8.75904 15.9308H7.24125C6.96184 15.9308 6.73532 15.7043 6.73532 15.4249V4.93262L2.1826 9.72496C1.99015 9.92754 1.66992 9.93575 1.46734 9.7433L0.366945 8.69793C0.164367 8.50548 0.156156 8.18525 0.348604 7.98267L7.08315 0.893677C7.32194 0.642318 7.65344 0.5 8.00015 0.5Z\"\n\t\t\t\tstroke=\"none\"\n\t\t\t/>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'connection-stairs-16x16',\n\t\t`<svg viewBox=\"0 0 16 16\">\n\t\t\t<g stroke=\"none\">\n\t\t\t\t<path d=\"M1 11.5C1 11.2239 1.22386 11 1.5 11H6V13.5C6 13.7761 5.77614 14 5.5 14H1.5C1.22386 14 1 13.7761 1 13.5V11.5Z\" />\n\t\t\t\t<path d=\"M4 8.5C4 8.22386 4.22386 8 4.5 8H9V10.5C9 10.7761 8.77614 11 8.5 11H4V8.5Z\" />\n\t\t\t\t<path d=\"M7 5.5C7 5.22386 7.22386 5 7.5 5H12V7.5C12 7.77614 11.7761 8 11.5 8H7V5.5Z\" />\n\t\t\t\t<path d=\"M10 2.5C10 2.22386 10.2239 2 10.5 2H14.5C14.7761 2 15 2.22386 15 2.5V4.5C15 4.77614 14.7761 5 14.5 5H10V2.5Z\" />\n\t\t\t</g>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'connection-stairs-14x14',\n\t\t`<svg viewBox=\"0 0 14 14\">\n\t\t\t<path\n\t\t\t\td=\"M5.25 12H2.5C2.225 12 2 11.7429 2 11.4286C2 11.1143 2.225 10.8571 2.5 10.8571H4.25V7.91429H6.5V4.94286H8.75V2H11.5C11.775 2 12 2.25714 12 2.57143C12 2.88571 11.775 3.14286 11.5 3.14286H9.75V6.08571H7.5V9.02857H5.25V12Z\"\n\t\t\t\tstroke=\"none\"\n\t\t\t/>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'connection-stairs-12x12',\n\t\t`<svg viewBox=\"0 0 12 12\" stroke=\"none\">\n\t\t\t<path d=\"M1.625 8.1875C1.625 8.01491 1.76491 7.875 1.9375 7.875H4.75V9.4375C4.75 9.61009 4.61009 9.75 4.4375 9.75H1.9375C1.76491 9.75 1.625 9.61009 1.625 9.4375V8.1875Z\" />\n\t\t\t<path d=\"M3.5 6.3125C3.5 6.13991 3.63991 6 3.8125 6H6.625V7.5625C6.625 7.73509 6.48509 7.875 6.3125 7.875H3.5V6.3125Z\" />\n\t\t\t<path d=\"M5.375 4.4375C5.375 4.26491 5.51491 4.125 5.6875 4.125H8.5V5.6875C8.5 5.86009 8.36009 6 8.1875 6H5.375V4.4375Z\" />\n\t\t\t<path d=\"M7.25 2.5625C7.25 2.38991 7.38991 2.25 7.5625 2.25H10.0625C10.2351 2.25 10.375 2.38991 10.375 2.5625V3.8125C10.375 3.98509 10.2351 4.125 10.0625 4.125H7.25V2.5625Z\" />\n\t\t</svg>`,\n\t],\n\t[\n\t\t'connection-escalator-16x16',\n\t\t`<svg viewBox=\"0 0 16 16\">\n\t\t\t<g stroke=\"none\">\n\t\t\t\t<path d=\"M3.63008 12H2C0.895431 12 0 12.8954 0 14C0 15.1046 0.89543 16 2 16H4.63008C4.86879 16 5.09962 15.9146 5.28087 15.7593L11.7191 10.2407C11.9004 10.0854 12.1312 10 12.3699 10H14C15.1046 10 16 9.10457 16 8C16 6.89543 15.1046 6 14 6H11.3699C11.1312 6 10.9004 6.08539 10.7191 6.24074L4.28087 11.7593C4.09962 11.9146 3.86879 12 3.63008 12Z\" />\n\t\t\t\t<path d=\"M5 6C5 4.89543 5.89543 4 7 4C8.10457 4 9 4.89543 9 6L5 9.5V6Z\" />\n\t\t\t\t<path d=\"M9 2C9 3.10457 8.10457 4 7 4C5.89543 4 5 3.10457 5 2C5 0.89543 5.89543 0 7 0C8.10457 0 9 0.89543 9 2Z\" />\n\t\t\t</g>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'connection-escalator-14x14',\n\t\t`<svg viewBox=\"0 0 14 14\">\n\t\t\t<path\n\t\t\t\td=\"M5.26686 2.98522C5.26686 2.44335 5.71573 2 6.26436 2C6.81299 2 7.26187 2.44335 7.26187 2.98522C7.26187 3.5271 6.81299 3.97045 6.26436 3.97045C5.71573 3.97045 5.26686 3.50246 5.26686 2.98522Z\"\n\t\t\t\tstroke=\"none\"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td=\"M7.26188 5.48588V5.25125C7.26188 4.85716 6.91275 4.53696 6.48881 4.53696H6.03993C5.61599 4.53696 5.26687 4.88179 5.26687 5.25125V7.66458L4.3192 8.6995H3.67082C2.74813 8.6995 2 9.43842 2 10.3498C2 11.2611 2.74813 12 3.67082 12H4.61845C5.36658 12 6.11471 11.6798 6.61347 11.1133L9.6808 7.76354H10.3292C11.2519 7.76354 12 7.02463 12 6.11329C12 5.20196 11.2519 4.46305 10.3292 4.46305H9.38155C8.60848 4.46305 7.88529 4.78324 7.38653 5.34975L7.26188 5.48588ZM4.61846 11.0148H3.67083C3.29677 11.0148 2.99751 10.7192 2.99751 10.3498C2.99751 9.9803 3.29677 9.68473 3.67083 9.68473H4.61846C4.71821 9.68473 4.81796 9.63547 4.86784 9.56158L8.13467 5.99015C8.45886 5.64532 8.90774 5.44828 9.38155 5.44828H10.3292C10.7032 5.44828 11.0025 5.74384 11.0025 6.1133C11.0025 6.48276 10.7032 6.77833 10.3292 6.77833H9.38155C9.2818 6.77833 9.18205 6.82759 9.13218 6.87685L5.86534 10.4729C5.54115 10.8177 5.09228 11.0148 4.61846 11.0148Z\"\n\t\t\t\tstroke=\"none\"\n\t\t\t/>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'connection-elevator-16x16',\n\t\t`<svg viewBox=\"0 0 16 16\">\n\t\t\t<g stroke=\"none\">\n\t\t\t\t<path d=\"M3 5.5C3 6.32843 2.32843 7 1.5 7C0.671573 7 0 6.32843 0 5.5C0 4.67157 0.671573 4 1.5 4C2.32843 4 3 4.67157 3 5.5Z\" />\n\t\t\t\t<path d=\"M3 10.5C3 11.3284 2.32843 12 1.5 12C0.671573 12 0 11.3284 0 10.5C0 9.67157 0.671573 9 1.5 9C2.32843 9 3 9.67157 3 10.5Z\" />\n\t\t\t\t<path d=\"M11 1H14C14.5523 1 15 1.44772 15 2V14C15 14.5523 14.5523 15 14 15H11V1Z\" />\n\t\t\t\t<path d=\"M9 1H6C5.44772 1 5 1.44772 5 2V14C5 14.5523 5.44772 15 6 15H9V1Z\" />\n\t\t\t</g>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'connection-elevator-14x14',\n\t\t`<svg viewBox=\"0 0 14 14\">\n\t\t\t<path\n\t\t\t\td=\"M7.476 2H2.72693C1.77095 2 1 2.72464 1 3.62319V10.3768C1 11.2754 1.77095 12 2.72693 12H7.476C8.43198 12 9.20293 11.2754 9.20293 10.3768V3.62319C9.17209 2.72464 8.40114 2 7.476 2ZM7.476 3.15942C7.75354 3.15942 7.96941 3.36232 7.96941 3.62319V10.3768C7.96941 10.6377 7.75354 10.8406 7.476 10.8406H5.71824V3.15942H7.476ZM4.48472 3.15942V10.8406H2.72693C2.44939 10.8406 2.23352 10.6377 2.23352 10.3768V3.62319C2.23352 3.36232 2.44939 3.15942 2.72693 3.15942H4.48472Z\"\n\t\t\t\tstroke=\"none\"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td=\"M12.4643 6.19064H10.6638C10.4456 6.19064 10.2546 6.06243 10.1728 5.88294C10.0909 5.70346 10.1455 5.47269 10.2819 5.31884L11.1821 4.47269C11.4004 4.26756 11.755 4.26756 11.946 4.47269L12.8462 5.31884C13.0099 5.47269 13.0371 5.67781 12.9553 5.88294C12.8735 6.08807 12.6825 6.19064 12.4643 6.19064Z\"\n\t\t\t\tstroke=\"none\"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td=\"M11.564 9.65216C11.4276 9.65216 11.2912 9.60088 11.1821 9.49831L10.2819 8.65216C10.1182 8.49831 10.0909 8.29319 10.1728 8.08806C10.2546 7.90857 10.4456 7.78036 10.6638 7.78036H12.4643C12.6825 7.78036 12.8735 7.90857 12.9553 8.08806C13.0371 8.26754 12.9826 8.49831 12.8462 8.65216L11.9459 9.49831C11.8641 9.60088 11.7004 9.65216 11.564 9.65216Z\"\n\t\t\t\tstroke=\"none\"\n\t\t\t/>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'connection-elevator-12x12',\n\t\t`<svg viewBox=\"0 0 12 12\" stroke=\"none\">\n\t\t\t<circle cx=\"1.9375\" cy=\"4.4375\" r=\"0.9375\" />\n\t\t\t<circle cx=\"1.9375\" cy=\"7.5625\" r=\"0.9375\" />\n\t\t\t<path\n\t\t\t\tfillRule=\"evenodd\"\n\t\t\t\tclipRule=\"evenodd\"\n\t\t\t\td=\"M7.6 2H9.4C9.73137 2 10 2.26863 10 2.6V9.41328C10 9.74465 9.73137 10.0133 9.4 10.0133H7.6V2ZM6.4 2H4.6C4.26863 2 4 2.26863 4 2.6V9.41328C4 9.74465 4.26863 10.0133 4.6 10.0133H6.4V2Z\"\n\t\t\t/>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'new-tab-14x14',\n\t\t`<svg viewBox=\"0 0 14 14\">\n\t\t\t<g stroke=\"none\">\n\t\t\t\t<path d=\"M2.625 2.625H5.6875C5.92913 2.625 6.125 2.42912 6.125 2.1875V1.3125C6.125 1.07088 5.92913 0.875 5.6875 0.875H1.3125C1.07088 0.875 0.875 1.07088 0.875 1.3125V12.6875C0.875 12.9291 1.07088 13.125 1.3125 13.125H12.6875C12.9291 13.125 13.125 12.9291 13.125 12.6875V8.3125C13.125 8.07088 12.9291 7.875 12.6875 7.875H11.8125C11.5709 7.875 11.375 8.07088 11.375 8.3125V11.375H2.625V2.625Z\" />\n\t\t\t\t<path d=\"M12.9063 0.875H8.40311C8.20822 0.875 8.11063 1.11062 8.24843 1.24843L9.88124 2.88124L5.8156 6.94688C5.64475 7.11774 5.64475 7.39475 5.8156 7.5656L6.43432 8.18432C6.60517 8.35517 6.88218 8.35517 7.05304 8.18432L11.1187 4.11868L12.7516 5.75157C12.8894 5.88938 13.125 5.79178 13.125 5.59689V1.09375C13.125 0.972938 13.0271 0.875 12.9063 0.875Z\" />\n\t\t\t</g>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'compress-16x16',\n\t\t`<svg viewBox=\"0 0 16 16\">\n\t\t\t<g stroke=\"none\">\n\t\t\t\t<path\n\t\t\t\t\tid=\"Vector\"\n\t\t\t\t\td=\"M4.67773 10.7154H0.713449C0.556306 10.7154 0.427734 10.844 0.427734 11.0011V11.8583C0.427734 12.0154 0.556306 12.144 0.713449 12.144H3.82059V15.2868C3.82059 15.444 3.94916 15.5725 4.10631 15.5725H4.96345C5.12059 15.5725 5.24916 15.444 5.24916 15.2868V11.2868C5.24916 10.9708 4.99381 10.7154 4.67773 10.7154ZM4.96345 0.429688H4.10631C3.94916 0.429688 3.82059 0.558259 3.82059 0.715402V3.85826H0.713449C0.556306 3.85826 0.427734 3.98683 0.427734 4.14397V5.00112C0.427734 5.15826 0.556306 5.28683 0.713449 5.28683H4.67773C4.99381 5.28683 5.24916 5.03147 5.24916 4.7154V0.715402C5.24916 0.558259 5.12059 0.429688 4.96345 0.429688ZM15.2849 10.7154H11.3206C11.0045 10.7154 10.7492 10.9708 10.7492 11.2868V15.2868C10.7492 15.444 10.8777 15.5725 11.0349 15.5725H11.892C12.0492 15.5725 12.1777 15.444 12.1777 15.2868V12.144H15.2849C15.442 12.144 15.5706 12.0154 15.5706 11.8583V11.0011C15.5706 10.844 15.442 10.7154 15.2849 10.7154ZM15.2849 3.85826H12.1777V0.715402C12.1777 0.558259 12.0492 0.429688 11.892 0.429688H11.0349C10.8777 0.429688 10.7492 0.558259 10.7492 0.715402V4.7154C10.7492 5.03147 11.0045 5.28683 11.3206 5.28683H15.2849C15.442 5.28683 15.5706 5.15826 15.5706 5.00112V4.14397C15.5706 3.98683 15.442 3.85826 15.2849 3.85826Z\"\n\t\t\t\t/>\n\t\t\t</g>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'washroom-14x14',\n\t\t`<svg viewBox=\"0 0 14 14\" stroke=\"none\">\n\t\t\t<path d=\"M4.55125 3.09062C4.55125 3.69326 4.07639 4.18176 3.49058 4.18176C2.90525 4.18176 2.43039 3.69326 2.43039 3.09062C2.43039 2.4885 2.90525 2 3.49058 2C4.07639 2 4.55125 2.4885 4.55125 3.09062Z\" />\n\t\t\t<path d=\"M5.1193 5.48047C4.81653 4.83116 4.17252 4.41571 3.47822 4.41571C2.78392 4.41571 2.13986 4.83116 1.83714 5.48047L1.04175 7.22034C0.940664 7.441 1.02893 7.70073 1.24393 7.81791C1.47077 7.90871 1.72324 7.81791 1.82433 7.59725L2.49349 6.15554L2.21587 11.4407C2.20305 11.7263 2.41805 11.9734 2.69567 11.9993C2.97329 12.0124 3.21344 11.7913 3.23859 11.5057L3.4028 8.285H3.567L3.73121 11.5057C3.74403 11.7913 3.97086 11.9993 4.23616 11.9993H4.26131C4.53893 11.9861 4.75343 11.7395 4.74111 11.4407L4.46349 6.15554L5.13265 7.59725C5.20858 7.75298 5.35997 7.85697 5.52418 7.85697C5.5873 7.85697 5.65042 7.84379 5.71354 7.81792C5.92804 7.71393 6.0163 7.44153 5.91572 7.22035L5.1193 5.48047Z\" />\n\t\t\t<path d=\"M12.9582 7.22034L12.1505 5.48047C11.8477 4.83116 11.2037 4.41571 10.5094 4.41571C9.81513 4.41571 9.17107 4.83116 8.86836 5.48047L8.06064 7.22034C7.95955 7.441 8.04782 7.70073 8.26282 7.81791C8.47732 7.9219 8.7298 7.8311 8.84371 7.60993L9.52519 6.12977L9.46207 7.2204L8.57842 8.92184C8.47733 9.11663 8.61638 9.36316 8.83089 9.36316H9.33584L9.22242 11.4668C9.2096 11.7397 9.41177 11.9862 9.68939 11.9994C9.95469 12.0126 10.1943 11.8046 10.2072 11.519L10.3581 9.33723H10.6737L10.7871 11.5058C10.7999 11.7787 11.0144 11.9862 11.2792 11.9862H11.3043C11.5696 11.973 11.7841 11.7396 11.7713 11.4535L11.6579 9.33718H12.1628C12.3773 9.33718 12.5287 9.09066 12.4153 8.89586L11.5317 7.19442L11.4685 6.1038L12.1757 7.5972C12.2516 7.75293 12.403 7.85692 12.5672 7.85692C12.6303 7.85692 12.6934 7.84373 12.7566 7.81786C12.9711 7.70068 13.0593 7.44102 12.9582 7.22034Z\" />\n\t\t\t<path d=\"M11.5696 3.09062C11.5696 3.69326 11.0948 4.18176 10.5094 4.18176C9.92363 4.18176 9.44876 3.69326 9.44876 3.09062C9.44876 2.4885 9.92363 2 10.5094 2C11.0948 2 11.5696 2.4885 11.5696 3.09062Z\" />\n\t\t\t<path d=\"M6.99996 2.00006C6.76031 2.00006 6.57095 2.19485 6.57095 2.44138V11.5575C6.57095 11.804 6.76031 11.9988 6.99996 11.9988C7.2396 11.9988 7.42896 11.804 7.42896 11.5575V2.44138C7.42896 2.19485 7.2396 2.00006 6.99996 2.00006Z\" />\n\t\t</svg>`,\n\t],\n\t[\n\t\t'point-of-interest-12x12',\n\t\t`<svg viewBox=\"0 0 12 12\" stroke=\"none\">\n\t\t\t<path\n\t\t\t\tstroke=\"none\"\n\t\t\t\tid=\"Subtract\"\n\t\t\t\t// Do not change these to fillRule or clipRule, since they need to be rendered as actual SVGs in labels, not React SVGs\n\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\td=\"M6.24724 10.7516C7.94597 9.0358 9.85962 6.89195 9.85962 4.85965C9.85962 2.72802 8.13159 1 5.99997 1C3.86834 1 2.14032 2.72802 2.14032 4.85965C2.14032 6.89195 4.05397 9.0358 5.7527 10.7516C5.88904 10.8893 6.1109 10.8893 6.24724 10.7516ZM5.99994 6.26317C6.77508 6.26317 7.40345 5.6348 7.40345 4.85967C7.40345 4.08453 6.77508 3.45616 5.99994 3.45616C5.22481 3.45616 4.59644 4.08453 4.59644 4.85967C4.59644 5.6348 5.22481 6.26317 5.99994 6.26317Z\"\n\t\t\t/>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'flag-20x20',\n\t\t`<svg viewBox=\"0 0 20 20\" stroke=\"none\">\n\t\t\t<path\n\t\t\t\td=\"M16.9987 4.27111C16.936 5.06715 16.3836 5.93162 15.5238 6.57845C14.7549 7.15682 13.0885 8.04927 10.5434 7.55174C8.32167 7.1164 6.82156 8.02129 6.08085 10.2416L8.24615 17.3998C8.31833 17.6471 8.17711 17.9059 7.9292 17.9813C7.88527 17.9938 7.83976 18 7.79426 18C7.58634 18 7.40277 17.8647 7.34236 17.6673L5.1644 10.4686C5.13773 10.4173 5.12125 10.3613 5.11419 10.3038L3.41956 4.70042C3.38112 4.63512 3.35994 4.56127 3.3568 4.48587L3.02101 3.37886C2.98413 3.25992 2.9959 3.13165 3.05553 3.02203C3.11437 2.91242 3.21479 2.83079 3.33482 2.79504C3.45564 2.75928 3.5851 2.7725 3.69494 2.83235C3.80477 2.89144 3.88637 2.99172 3.92167 3.11143L3.9813 3.31355C4.38847 2.85956 4.90472 2.51439 5.48136 2.30915C6.97201 1.75566 8.95216 1.95467 10.6469 2.83156C11.6888 3.36951 14.3374 4.54493 16.3647 3.79553C16.5154 3.74111 16.684 3.76599 16.8127 3.86239C16.9406 3.95879 17.0105 4.11251 16.9987 4.27111Z\"\n\t\t\t\tstroke=\"none\"\n\t\t\t/>\n\t\t</svg>`,\n\t],\n\t[\n\t\t'link-16x16',\n\t\t`<svg viewBox=\"0 0 16 16\" stroke=\"none\">\n\t\t\t<path\n\t\t\t\td=\"M9.10678 11.2433C9.07993 11.2167 9.04367 11.2018 9.00589 11.2018C8.9681 11.2018 8.93184 11.2167 8.90499 11.2433L6.82999 13.3183C5.86928 14.279 4.24785 14.3808 3.18714 13.3183C2.12464 12.2558 2.22642 10.6362 3.18714 9.67546L5.26214 7.60046C5.31749 7.5451 5.31749 7.45403 5.26214 7.39868L4.55142 6.68796C4.52457 6.66138 4.48832 6.64646 4.45053 6.64646C4.41274 6.64646 4.37649 6.66138 4.34964 6.68796L2.27464 8.76296C0.763923 10.2737 0.763923 12.7183 2.27464 14.2272C3.78535 15.7362 6.22999 15.738 7.73892 14.2272L9.81392 12.1522C9.86928 12.0969 9.86928 12.0058 9.81392 11.9505L9.10678 11.2433ZM13.7246 2.77903C12.2139 1.26832 9.76928 1.26832 8.26035 2.77903L6.18357 4.85403C6.15698 4.88088 6.14207 4.91714 6.14207 4.95493C6.14207 4.99271 6.15698 5.02897 6.18357 5.05582L6.89249 5.76475C6.94785 5.8201 7.03892 5.8201 7.09428 5.76475L9.16928 3.68975C10.13 2.72903 11.7514 2.62725 12.8121 3.68975C13.8746 4.75225 13.7729 6.37189 12.8121 7.3326L10.7371 9.4076C10.7106 9.43445 10.6956 9.47071 10.6956 9.5085C10.6956 9.54628 10.7106 9.58254 10.7371 9.60939L11.4479 10.3201C11.5032 10.3755 11.5943 10.3755 11.6496 10.3201L13.7246 8.2451C15.2336 6.73439 15.2336 4.28975 13.7246 2.77903ZM9.75142 6.00939C9.72457 5.9828 9.68832 5.96789 9.65053 5.96789C9.61275 5.96789 9.57649 5.9828 9.54964 6.00939L5.50499 10.0522C5.47841 10.0791 5.46349 10.1154 5.46349 10.1531C5.46349 10.1909 5.47841 10.2272 5.50499 10.254L6.21214 10.9612C6.26749 11.0165 6.35857 11.0165 6.41392 10.9612L10.4568 6.91832C10.5121 6.86296 10.5121 6.77189 10.4568 6.71653L9.75142 6.00939Z\"\n\t\t\t\tstroke=\"none\"\n\t\t\t/>\n\t\t</svg>`,\n\t],\n]);\n\nconst regex = /<svg([^>]*)>/g;\n\nexport function getStyledIcon(iconName: string, color: string, size: number): string {\n\tconst icon = ICONS.get(iconName);\n\tif (!icon) {\n\t\treturn '';\n\t}\n\n\treturn icon.replace(regex, `<svg$1 style=\"fill:${color}; width:${size}px; height:${size}px\">`);\n}\n\nexport default ICONS;\n", "import { Coordinate } from '../map-data-objects';\nimport type { Path } from '../map-view-objects';\nimport { PathSegment } from '../map-view-objects';\n\nconst EARTH_RADIUS_M = 6371008.8;\n\n// cache the projected coordinates for each segment and origin coordinate\nconst cartesianToCoordinateCache = new WeakMap<PathSegment, Map<Coordinate, { x: number; y: number }[]>>();\n\nexport const ms = async (ms: number) => new Promise(resolve => setTimeout(resolve, ms));\n\nexport function computePathCoordinateFraction(segment: PathSegment, coordinate: Coordinate, origin: Coordinate) {\n\tconst totalDistance = segment.distance;\n\n\tconst remainingPathSegment = getRemainingPathSegment(segment, coordinate, origin);\n\n\tif (!remainingPathSegment) {\n\t\treturn 0;\n\t}\n\n\treturn (totalDistance - remainingPathSegment?.distance) / totalDistance;\n}\n\n/**\n * Projects an array of geographic coordinates to a local Cartesian plane where 1 unit = 1 meter.\n * Uses the specified origin coordinate as (0, 0) and projects all coordinates relative to it.\n *\n * This is particularly useful for indoor mapping where you need precise distance calculations\n * in a local coordinate system, and you want to control where the origin point is located.\n *\n * @param coordinates Array of Coordinate objects to project\n * @param origin The coordinate to use as the origin (0, 0) point\n * @returns Array of {x, y} points in meters relative to the origin coordinate\n * @example\n * ```typescript\n * const origin = new Coordinate({ latitude: 43.8613, longitude: -78.9459 });\n * const coords = [\n *   new Coordinate({ latitude: 43.8613, longitude: -78.9459 }),\n *   new Coordinate({ latitude: 43.8612, longitude: -78.9458 })\n * ];\n * const projected = projectToCartesianPlane(coords, origin);\n * // Returns: [{ x: 0, y: 0 }, { x: 7.84, y: -11.12 }] (approximate)\n * ```\n */\n// TODO: weakmap cache each segment so we don't have to project the same segment multiple times\nexport function projectSegmentToCartesianPlane(segment: PathSegment, origin: Coordinate): { x: number; y: number }[] {\n\tif (segment.coordinates.length === 0) {\n\t\treturn [];\n\t}\n\n\tif (cartesianToCoordinateCache.has(segment) && cartesianToCoordinateCache.get(segment)!.has(origin)) {\n\t\treturn cartesianToCoordinateCache.get(segment)!.get(origin)!;\n\t}\n\n\tconst projectedCoords = segment.coordinates.map(coord => projectCoordinateToCartesianPlane(coord, origin));\n\tcartesianToCoordinateCache.set(segment, new Map([[origin, projectedCoords]]));\n\treturn projectedCoords;\n}\n\nfunction projectCoordinateToCartesianPlane(coordinate: Coordinate, origin: Coordinate): { x: number; y: number } {\n\t// Use the provided origin coordinate as the reference point\n\tconst originLat = origin.latitude;\n\tconst originLon = origin.longitude;\n\n\tconst deltaLat = coordinate.latitude - originLat;\n\tconst deltaLon = coordinate.longitude - originLon;\n\n\t// Convert to meters using approximate Earth radius (6,378,137 meters)\n\t// For latitude: 1 degree \u2248 111,320 meters (constant)\n\t// For longitude: 1 degree \u2248 111,320 * cos(latitude) meters (varies by latitude)\n\n\tconst metersPerDegreeLatitude = (Math.PI * EARTH_RADIUS_M) / 180;\n\tconst metersPerDegreeLongitude = metersPerDegreeLatitude * Math.cos((originLat * Math.PI) / 180);\n\n\t// Convert to x,y coordinates in meters\n\tconst x = deltaLon * metersPerDegreeLongitude;\n\tconst y = deltaLat * metersPerDegreeLatitude;\n\n\treturn { x, y };\n}\n\n/**\n * Finds the closest intersection point on path segments to a given coordinate.\n * Projects all coordinates to Cartesian space using the point as origin, then finds\n * the closest point on any segment and converts it back to geographic coordinates.\n *\n * @param segments Array of PathSegment objects to search through\n * @param point The coordinate to use as reference point (origin in Cartesian space)\n * @param method Method to use for finding intersection ('distance' finds closest point)\n * @returns The closest coordinate on any segment, or undefined if no segments provided\n * @example\n * ```typescript\n * const segments = [pathSegment1, pathSegment2];\n * const userLocation = new Coordinate({ latitude: 43.8613, longitude: -78.9459 });\n * const closest = findSegmentIntersection(segments, userLocation, 'distance');\n * // Returns the closest point on any path segment to the user's location\n * ```\n */\nexport function findSegmentIntersection(segments: PathSegment[], point: Coordinate): Coordinate | undefined {\n\tif (segments.length === 0) {\n\t\treturn undefined;\n\t}\n\n\tlet closestPoint: { x: number; y: number } | undefined;\n\tlet closestDistance = Infinity;\n\n\t// Process each segment\n\tfor (let segmentIndex = 0; segmentIndex < segments.length; segmentIndex++) {\n\t\tconst segment = segments[segmentIndex];\n\n\t\t// Project segment coordinates to Cartesian plane using point as origin\n\t\tconst projectedCoords = projectSegmentToCartesianPlane(segment, point);\n\n\t\t// Check each line segment within this path segment\n\t\tfor (let i = 0; i < projectedCoords.length - 1; i++) {\n\t\t\tconst start = projectedCoords[i];\n\t\t\tconst end = projectedCoords[i + 1];\n\n\t\t\t// Find closest point on this line segment to origin (0, 0)\n\t\t\tconst closest = getClosestPointOnLineSegment(start, end, { x: 0, y: 0 });\n\n\t\t\t// Calculate distance from origin to this closest point\n\t\t\tconst distance = Math.sqrt(closest.x * closest.x + closest.y * closest.y);\n\n\t\t\t// Keep track of the overall closest point\n\t\t\tif (distance < closestDistance) {\n\t\t\t\tclosestDistance = distance;\n\t\t\t\tclosestPoint = closest;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!closestPoint) {\n\t\treturn undefined;\n\t}\n\n\t// Convert the closest Cartesian point back to geographic coordinates\n\treturn cartesianToCoordinate(closestPoint, point);\n}\n\n/**\n * Finds the closest point on a line segment to a given point.\n * Uses vector projection to find the point on the line segment AB that is closest to point P.\n *\n * @param start Start point of the line segment\n * @param end End point of the line segment\n * @param point Point to find closest point to\n * @returns The closest point on the line segment\n */\nfunction getClosestPointOnLineSegment(\n\tstart: { x: number; y: number },\n\tend: { x: number; y: number },\n\tpoint: { x: number; y: number },\n): { x: number; y: number } {\n\t// Vector from start to end of line segment\n\tconst segmentX = end.x - start.x;\n\tconst segmentY = end.y - start.y;\n\n\t// Vector from start to the point\n\tconst pointX = point.x - start.x;\n\tconst pointY = point.y - start.y;\n\n\t// Calculate the projection parameter t\n\tconst segmentLengthSq = segmentX * segmentX + segmentY * segmentY;\n\n\t// Handle degenerate case where start and end are the same point\n\tif (segmentLengthSq === 0) {\n\t\treturn { x: start.x, y: start.y };\n\t}\n\n\tconst t = (pointX * segmentX + pointY * segmentY) / segmentLengthSq;\n\n\t// Clamp t to [0, 1] to stay within the line segment\n\tconst clampedT = Math.max(0, Math.min(1, t));\n\n\t// Calculate the closest point\n\treturn {\n\t\tx: start.x + clampedT * segmentX,\n\t\ty: start.y + clampedT * segmentY,\n\t};\n}\n\n/**\n * Converts a Cartesian coordinate back to geographic coordinates.\n * Reverses the projection done by projectToCartesianPlane.\n *\n * @param cartesian The Cartesian point to convert\n * @param origin The original origin coordinate used for projection\n * @returns Geographic coordinate\n */\nfunction cartesianToCoordinate(cartesian: { x: number; y: number }, origin: Coordinate): Coordinate {\n\t// Earth radius and conversion factors (same as in projectToCartesianPlane)\n\tconst earthRadius = EARTH_RADIUS_M; // meters\n\tconst metersPerDegreeLatitude = (Math.PI * earthRadius) / 180;\n\tconst metersPerDegreeLongitude = metersPerDegreeLatitude * Math.cos((origin.latitude * Math.PI) / 180);\n\n\t// Convert meters back to decimal degrees\n\tconst deltaLat = cartesian.y / metersPerDegreeLatitude;\n\tconst deltaLon = cartesian.x / metersPerDegreeLongitude;\n\n\t// Add to origin to get final coordinates\n\tconst latitude = origin.latitude + deltaLat;\n\tconst longitude = origin.longitude + deltaLon;\n\n\treturn new Coordinate({\n\t\tlatitude,\n\t\tlongitude,\n\t\tfloorId: origin.floorId,\n\t\tverticalOffset: origin.verticalOffset,\n\t});\n}\n\n/**\n * Creates a new PathSegment starting from the closest intersection point to the given coordinate\n * and continuing to the end of the original segment. This is useful for navigation scenarios\n * where you want to calculate remaining distance from a user's current position.\n *\n * @param segment The original path segment to modify\n * @param point The coordinate to find intersection with and use as new starting point\n * @returns A new PathSegment starting from the intersection point, or undefined if no intersection found\n * @example\n * ```typescript\n * const pathSegment = new PathSegment('route1', coordinates, totalDistance);\n * const userLocation = new Coordinate({ latitude: 43.8613, longitude: -78.9459 });\n * const remainingPath = getRemainingPathSegment(pathSegment, userLocation);\n * // Returns a new path segment from user's projected position to the end\n * ```\n */\nexport function getRemainingPathSegment(\n\tsegment: PathSegment,\n\tpoint: Coordinate,\n\torigin: Coordinate,\n): PathSegment | undefined {\n\t// Find the closest intersection point on this segment\n\tconst intersectionPoint = findSegmentIntersection([segment], point);\n\n\tif (!intersectionPoint) {\n\t\treturn undefined;\n\t}\n\n\t// Project all coordinates to Cartesian space for distance calculations\n\tconst projectedCoords = projectSegmentToCartesianPlane(segment, origin);\n\tconst projectedIntersection = projectCoordinateToCartesianPlane(intersectionPoint, origin);\n\n\t// Find which line segment the intersection point lies on\n\tlet segmentIndex = -1;\n\tlet closestDistance = Infinity;\n\n\tfor (let i = 0; i < projectedCoords.length - 1; i++) {\n\t\tconst start = projectedCoords[i];\n\t\tconst end = projectedCoords[i + 1];\n\n\t\t// Find closest point on this line segment to the intersection\n\t\tconst closest = getClosestPointOnLineSegment(start, end, projectedIntersection);\n\n\t\t// Calculate distance from intersection to this closest point\n\t\tconst dx = closest.x - projectedIntersection.x;\n\t\tconst dy = closest.y - projectedIntersection.y;\n\t\tconst distance = Math.sqrt(dx * dx + dy * dy);\n\n\t\t// If this is very close (within 1 meter), this is our segment\n\t\tif (distance < 1 && distance < closestDistance) {\n\t\t\tclosestDistance = distance;\n\t\t\tsegmentIndex = i;\n\t\t}\n\t}\n\n\t// If we couldn't find which segment, use the closest endpoint\n\tif (segmentIndex === -1) {\n\t\tlet closestEndpointIndex = 0;\n\t\tlet closestEndpointDistance = Infinity;\n\n\t\tfor (let i = 0; i < projectedCoords.length; i++) {\n\t\t\tconst coord = projectedCoords[i];\n\t\t\tconst dx = coord.x - projectedIntersection.x;\n\t\t\tconst dy = coord.y - projectedIntersection.y;\n\t\t\tconst distance = Math.sqrt(dx * dx + dy * dy);\n\n\t\t\tif (distance < closestEndpointDistance) {\n\t\t\t\tclosestEndpointDistance = distance;\n\t\t\t\tclosestEndpointIndex = i;\n\t\t\t}\n\t\t}\n\t\tsegmentIndex = Math.max(0, closestEndpointIndex - 1);\n\t}\n\n\t// Create new coordinates array starting from intersection point\n\tconst remainingCoordinates: Coordinate[] = [intersectionPoint];\n\n\t// Add all coordinates from the segment after the intersection point\n\tfor (let i = segmentIndex + 1; i < segment.coordinates.length; i++) {\n\t\tremainingCoordinates.push(segment.coordinates[i]);\n\t}\n\n\t// Create and return the new path segment\n\treturn new PathSegment(`${segment.id}_remaining`, remainingCoordinates);\n}\n\n/**\n * Finds the closest path segment to a given coordinate.\n * Projects all coordinates to Cartesian space and finds the segment containing the closest point.\n *\n * @param segments Array of PathSegment objects to search through\n * @param coordinate The coordinate to find the closest segment to\n * @returns The closest PathSegment, or undefined if no segments provided\n * @example\n * ```typescript\n * const segments = [pathSegment1, pathSegment2, pathSegment3];\n * const userLocation = new Coordinate({ latitude: 43.8613, longitude: -78.9459 });\n * const closestSegment = findClosestSegment(segments, userLocation);\n * // Returns the path segment that contains the point closest to the user's location\n * ```\n */\nexport function findClosestSegment(\n\tsegments: PathSegment[],\n\tcoordinate: Coordinate,\n\torigin: Coordinate,\n): PathSegment | undefined {\n\tif (segments.length === 0) {\n\t\treturn undefined;\n\t}\n\n\tlet closestSegment: PathSegment | undefined;\n\tlet closestDistance = Infinity;\n\n\tconst projectedCoordinate = projectCoordinateToCartesianPlane(coordinate, origin);\n\n\t// Process each segment to find the one with the closest point\n\tfor (const segment of segments) {\n\t\t// Project segment coordinates to Cartesian plane using origin\n\t\tconst projectedCoords = projectSegmentToCartesianPlane(segment, origin);\n\n\t\tlet segmentMinDistance = Infinity;\n\n\t\t// Check each line segment within this path segment\n\t\tfor (let i = 0; i < projectedCoords.length - 1; i++) {\n\t\t\tconst start = projectedCoords[i];\n\t\t\tconst end = projectedCoords[i + 1];\n\n\t\t\t// Find closest point on this line segment to the projected coordinate\n\t\t\tconst closest = getClosestPointOnLineSegment(start, end, projectedCoordinate);\n\n\t\t\t// Calculate distance from projected coordinate to this closest point\n\t\t\tconst dx = closest.x - projectedCoordinate.x;\n\t\t\tconst dy = closest.y - projectedCoordinate.y;\n\t\t\tconst distance = Math.sqrt(dx * dx + dy * dy);\n\n\t\t\tif (distance < segmentMinDistance) {\n\t\t\t\tsegmentMinDistance = distance;\n\t\t\t}\n\n\t\t\t// Keep track of the segment with the overall closest point\n\t\t\tif (distance < closestDistance) {\n\t\t\t\tclosestDistance = distance;\n\t\t\t\tclosestSegment = segment;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn closestSegment;\n}\n\nexport function getHighlightedPathSegments(\n\tpaths: Path[],\n\tfrom: Coordinate,\n\tto: Coordinate,\n\tprojectionOrigin: Coordinate,\n) {\n\t// Find closest segments for both from and to coordinates in a single pass\n\tlet fromSegment: PathSegment | undefined;\n\tlet toSegment: PathSegment | undefined;\n\tlet fromClosestDistance = Infinity;\n\tlet toClosestDistance = Infinity;\n\n\tconst projectedFrom = projectCoordinateToCartesianPlane(from, projectionOrigin);\n\tconst projectedTo = projectCoordinateToCartesianPlane(to, projectionOrigin);\n\n\t// Single pass through all segments\n\tfor (const path of paths) {\n\t\tfor (const segment of path.segments) {\n\t\t\t// Skip connection segments\n\t\t\tif (segment.isConnectionSegment) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Only process segments on the same floor as the target coordinates\n\t\t\tconst segmentFloorId = segment.coordinates[0]?.floorId;\n\t\t\tconst isFromFloor = segmentFloorId === from.floorId;\n\t\t\tconst isToFloor = segmentFloorId === to.floorId;\n\n\t\t\tif (!isFromFloor && !isToFloor) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Project segment coordinates once for both calculations\n\t\t\tconst projectedCoords = projectSegmentToCartesianPlane(segment, projectionOrigin);\n\n\t\t\t// Check distance to 'from' coordinate if on same floor\n\t\t\tif (isFromFloor) {\n\t\t\t\tlet segmentMinDistanceFrom = Infinity;\n\n\t\t\t\tfor (let i = 0; i < projectedCoords.length - 1; i++) {\n\t\t\t\t\tconst start = projectedCoords[i];\n\t\t\t\t\tconst end = projectedCoords[i + 1];\n\n\t\t\t\t\tconst closest = getClosestPointOnLineSegment(start, end, projectedFrom);\n\t\t\t\t\tconst dx = closest.x - projectedFrom.x;\n\t\t\t\t\tconst dy = closest.y - projectedFrom.y;\n\t\t\t\t\tconst distance = Math.sqrt(dx * dx + dy * dy);\n\n\t\t\t\t\tif (distance < segmentMinDistanceFrom) {\n\t\t\t\t\t\tsegmentMinDistanceFrom = distance;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (segmentMinDistanceFrom < fromClosestDistance) {\n\t\t\t\t\tfromClosestDistance = segmentMinDistanceFrom;\n\t\t\t\t\tfromSegment = segment;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Check distance to 'to' coordinate if on same floor\n\t\t\tif (isToFloor) {\n\t\t\t\tlet segmentMinDistanceTo = Infinity;\n\n\t\t\t\tfor (let i = 0; i < projectedCoords.length - 1; i++) {\n\t\t\t\t\tconst start = projectedCoords[i];\n\t\t\t\t\tconst end = projectedCoords[i + 1];\n\n\t\t\t\t\tconst closest = getClosestPointOnLineSegment(start, end, projectedTo);\n\t\t\t\t\tconst dx = closest.x - projectedTo.x;\n\t\t\t\t\tconst dy = closest.y - projectedTo.y;\n\t\t\t\t\tconst distance = Math.sqrt(dx * dx + dy * dy);\n\n\t\t\t\t\tif (distance < segmentMinDistanceTo) {\n\t\t\t\t\t\tsegmentMinDistanceTo = distance;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (segmentMinDistanceTo < toClosestDistance) {\n\t\t\t\t\ttoClosestDistance = segmentMinDistanceTo;\n\t\t\t\t\ttoSegment = segment;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!fromSegment || !toSegment) {\n\t\treturn;\n\t}\n\n\tconst segmentHighlights: {\n\t\tsegment: PathSegment;\n\t\tstartHighlightFraction: number;\n\t\tendHighlightFraction: number;\n\t}[] = [];\n\n\tif (fromSegment.id === toSegment.id) {\n\t\tsegmentHighlights.push({\n\t\t\tsegment: fromSegment,\n\t\t\tstartHighlightFraction: computePathCoordinateFraction(fromSegment, from, projectionOrigin),\n\t\t\tendHighlightFraction: computePathCoordinateFraction(toSegment, to, projectionOrigin),\n\t\t});\n\t\treturn segmentHighlights;\n\t}\n\n\tfor (const path of paths) {\n\t\tfor (const segment of path.segments) {\n\t\t\tif (segment.id === fromSegment.id) {\n\t\t\t\tsegmentHighlights.push({\n\t\t\t\t\tsegment,\n\t\t\t\t\tstartHighlightFraction: computePathCoordinateFraction(segment, from, projectionOrigin),\n\t\t\t\t\tendHighlightFraction: 1.0,\n\t\t\t\t});\n\t\t\t} else if (segment.id === toSegment.id) {\n\t\t\t\tsegmentHighlights.push({\n\t\t\t\t\tsegment,\n\t\t\t\t\tstartHighlightFraction: 0.0,\n\t\t\t\t\tendHighlightFraction: computePathCoordinateFraction(segment, to, projectionOrigin),\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsegmentHighlights.push({\n\t\t\t\t\tsegment,\n\t\t\t\t\tstartHighlightFraction: 0.0,\n\t\t\t\t\tendHighlightFraction: 1.0,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\treturn segmentHighlights;\n}\n", "import { coordEach } from '@turf/meta';\nimport type {\n\tIFocusable,\n\tTCameraAnimationOptions,\n\tTCameraTarget,\n\tTFocusOnOptions,\n\tTCameraInteractionsSetOptions,\n} from '../types';\nimport type { GroupContainerState, InsetPadding, Position, RendererCore } from '../../../geojson/src';\nimport { Coordinate, Floor } from '../map-data-objects';\nimport { isPosition } from '../utils';\nimport type { GeoJsonApi } from './api';\nimport { convertPanBoundsToCameraBounds } from './utils';\nimport type { CameraBounds } from '../events';\n\n/**\n * ## Camera in Mappedin JS\n *\n * The Camera class controls the map's viewpoint, including position, pitch, bearing, and zoom. It can instantly reposition or animate to a new location, and can focus on one or more map elements.\n *\n * ### Features\n * - Focus on any map element (space, coordinate, marker, etc.)\n * - Smooth animation and custom easing\n * - Control pan, zoom, bearing, and pitch\n * - Set safe screen areas (insets) for UI overlays\n *\n * > **Best Practice:** Use `focusOn` for user-driven navigation (e.g., \"Show this store\"), and `animateTo` for smooth transitions between known camera states.\n *\n * ### Example Usage\n * ```ts\n * // Focus on a single space\n * mapView.Camera.focusOn(space, { minZoomLevel: 5 });\n *\n * // Animate to a specific camera target\n * mapView.Camera.animateTo({ center: coordinate, zoomLevel: 6, bearing: 45 });\n *\n * // Set the camera instantly\n * mapView.Camera.set({ center: coordinate, zoomLevel: 7 });\n *\n * // Set safe screen insets (e.g., for a sidebar)\n * mapView.Camera.setScreenOffsets({ left: 300, top: 0, right: 0, bottom: 0 });\n * ```\n *\n * ### Advanced\n * - Use `getFocusOnTransform` to calculate the camera transform before applying it.\n * - Use `interactions.set` to enable/disable pan, zoom, or rotation.\n *\n * ### More Information\n * - [Camera Guide](https://developer.mappedin.com/web-sdk/camera)\n *\n * This class is accessed using {@link MapView.Camera}.\n */\nexport class Camera {\n\t#rendererCore: RendererCore;\n\t#api: GeoJsonApi;\n\t/**\n\t * @internal\n\t */\n\tconstructor(api: GeoJsonApi) {\n\t\tthis.#api = api;\n\t\tthis.#rendererCore = api.core;\n\t}\n\n\t/**\n\t * Controls which camera interactions are enabled/disabled.\n\t *\n\t * @example\n\t * // Disable zoom and rotation\n\t * mapView.Camera.interactions.set({ zoom: false, bearingAndPitch: false });\n\t *\n\t * // Enable all interactions\n\t * mapView.Camera.interactions.enable();\n\t *\n\t * // Disable all interactions\n\t * mapView.Camera.interactions.disable();\n\t */\n\tinteractions = {\n\t\tset: (options: TCameraInteractionsSetOptions) => {\n\t\t\tif (options?.pan != null) {\n\t\t\t\tthis.#rendererCore.getSystems().cameraSystem.enablePan = options.pan;\n\t\t\t}\n\t\t\tif (options?.zoom != null) {\n\t\t\t\tthis.#rendererCore.getSystems().cameraSystem.enableZoom = options.zoom;\n\t\t\t}\n\t\t\tif (options?.bearingAndPitch != null) {\n\t\t\t\tthis.#rendererCore.getSystems().cameraSystem.enableRotate = options.bearingAndPitch;\n\t\t\t}\n\t\t},\n\t\tenable: () => {\n\t\t\tthis.#rendererCore.getSystems().cameraSystem.enablePan = true;\n\t\t\tthis.#rendererCore.getSystems().cameraSystem.enableZoom = true;\n\t\t\tthis.#rendererCore.getSystems().cameraSystem.enableRotate = true;\n\t\t},\n\t\tdisable: () => {\n\t\t\tthis.#rendererCore.getSystems().cameraSystem.enablePan = false;\n\t\t\tthis.#rendererCore.getSystems().cameraSystem.enableZoom = false;\n\t\t\tthis.#rendererCore.getSystems().cameraSystem.enableRotate = false;\n\t\t},\n\t};\n\n\t/**\n\t * Define an area of the screen that is safe for the camera. Anything outside the safe area is assumed to be covered in some way. The camera will not place any map elements there when calling {@link Camera.focusOn}.\n\t *\n\t * @param padding The padding to apply. Can specify individual sides and optionally the type.\n\t * - `type`: 'pixel' (absolute pixels) or 'portion' (fraction of canvas, 0-1). Defaults to 'pixel'.\n\t * - When updating without specifying type, the existing type is preserved.\n\t * @example\n\t * // Reserve 300px on the left for a sidebar\n\t * mapView.Camera.setScreenOffsets({ left: 300, top: 0, right: 0, bottom: 0 });\n\t *\n\t * @example\n\t * // Reserve 20% of the screen height at the top using portion type\n\t * mapView.Camera.setScreenOffsets({ top: 0.2, type: 'portion' });\n\t *\n\t * @example\n\t * // Update only the bottom padding, preserving existing type and other values\n\t * mapView.Camera.setScreenOffsets({ bottom: 50 });\n\t */\n\tsetScreenOffsets(padding: Partial<InsetPadding>) {\n\t\tthis.#rendererCore.camera.setInsetPadding(padding);\n\t}\n\n\tget screenOffsets() {\n\t\treturn this.#rendererCore.camera.insetsPadding;\n\t}\n\n\t/**\n\t * The camera's current pan mode.\n\t */\n\tget panMode() {\n\t\treturn this.#rendererCore.camera.panMode;\n\t}\n\n\t/**\n\t * Set the camera's pan mode. 'elevation' moves the camera up and down, while 'default' allows the camera to pan in all directions.\n\t * @experimental\n\t * @param panMode The new pan mode.\n\t */\n\tsetPanMode(panMode: 'default' | 'elevation') {\n\t\tif (panMode !== 'default' && panMode !== 'elevation') {\n\t\t\tthrow new Error('Invalid pan mode');\n\t\t}\n\t\tif (panMode === this.panMode) {\n\t\t\treturn;\n\t\t}\n\t\tthis.#rendererCore.camera.setPanMode(panMode);\n\t}\n\n\t/**\n\t * Get the camera transform that can be used to focus on a target or array of targets. Similar to {@link Camera.focusOn} but returns the transform directly.\n\t * @param target The target(s) to get the camera transform for.\n\t * @param options Optional settings for the camera transform.\n\t * @returns The camera transform which can then be passed to {@link Camera.set} or {@link Camera.animateTo}.\n\t *\n\t * @example\n\t * // Focus on a single space\n\t * const transform = mapView.Camera.getFocusOnTransform(space, { minZoomLevel: 5 });\n\t * mapView.Camera.animateTo(transform);\n\t */\n\tgetFocusOnTransform(target: IFocusable | IFocusable[], options?: TFocusOnOptions): TCameraTarget {\n\t\tconst frame = this.#rendererCore.camera.getCameraFrameForCoordinates(this.#computeCoordinateCloud(target), {\n\t\t\tpitch: options?.pitch,\n\t\t\tbearing: options?.bearing,\n\t\t\tpadding: options?.screenOffsets || this.screenOffsets,\n\t\t\tmaxZoomLevel: options?.maxZoomLevel,\n\t\t\tverticalPadding: options?.axisAlignedPadding?.vertical,\n\t\t\tminZoomLevel: options?.minZoomLevel,\n\t\t\tduration: options?.duration,\n\t\t\teasing: options?.easing,\n\t\t});\n\n\t\treturn {\n\t\t\tcenter: new Coordinate(frame.center[1], frame.center[0]),\n\t\t\tzoomLevel: frame.zoomLevel,\n\t\t\tbearing: options?.bearing ?? this.bearing,\n\t\t\tpitch: options?.pitch ?? this.pitch,\n\t\t};\n\t}\n\n\t#getFloorAltitude(thing: IFocusable) {\n\t\tconst fallback = this.#rendererCore.camera.elevation;\n\t\tif (Coordinate.is(thing) && thing.floorId != null) {\n\t\t\treturn this.#rendererCore.getState<GroupContainerState>(thing.floorId)?.altitude ?? fallback;\n\t\t} else if (Floor.is(thing)) {\n\t\t\treturn this.#rendererCore.getState<GroupContainerState>(thing.id)?.altitude ?? fallback;\n\t\t} else if ('floor' in thing && Floor.is(thing.floor as Floor)) {\n\t\t\treturn this.#rendererCore.getState<GroupContainerState>((thing.floor as Floor).id)?.altitude ?? fallback;\n\t\t}\n\n\t\treturn fallback;\n\t}\n\n\t#computeCoordinateCloud(target: IFocusable | IFocusable[]) {\n\t\tlet targets: (Position | string)[] = [];\n\t\tconst thingsArr = Array.isArray(target) ? target : [target];\n\t\tconst flattenedThings = thingsArr.flatMap(t => t?.focusTarget ?? [t]);\n\n\t\tfor (const thing of flattenedThings) {\n\t\t\tif (thing == null) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (Coordinate.is(thing)) {\n\t\t\t\t// get the floor altitude, if the thing is on a floor\n\t\t\t\tconst floorAltitude = this.#getFloorAltitude(thing);\n\n\t\t\t\ttargets.push([thing.longitude, thing.latitude, floorAltitude]);\n\t\t\t} else if (thing?.id != null) {\n\t\t\t\t// get the floor altitude, if the thing is on a floor\n\t\t\t\tconst floorAltitude = this.#getFloorAltitude(thing);\n\n\t\t\t\t// NOTE: Prefer direct coordinates to camera.focusOn - camera space calculations\n\t\t\t\t// provide tighter bounds than world space AABB\n\t\t\t\t// When sending floor IDs: Enterprise doesn't have floor geometries in MVF,\n\t\t\t\t// so we pass IDs to core to get world coordinates for camera calculations.\n\t\t\t\tif (Floor.is(thing) && this.#api.getMapDataInternal()?.enterpriseMode) {\n\t\t\t\t\ttargets.push(thing.id);\n\t\t\t\t\tcontinue;\n\t\t\t\t} else if ('geoJSON' in thing && thing.geoJSON.geometry.coordinates.length > 0) {\n\t\t\t\t\tcoordEach(thing.geoJSON, coord => {\n\t\t\t\t\t\ttargets.push([coord[0], coord[1], floorAltitude]);\n\t\t\t\t\t});\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// if sending down geojson doesn't work we use bounding box approach.\n\t\t\t\tconst boundingBox = this.#rendererCore.getBoundingArea(thing.id);\n\t\t\t\tif (boundingBox) {\n\t\t\t\t\ttargets.push(...boundingBox.map(coord => [coord[0], coord[1], floorAltitude] as Position));\n\t\t\t\t} else if ('geoJSONBoundingBox' in thing) {\n\t\t\t\t\tconst floorAltitude = this.#getFloorAltitude(thing);\n\t\t\t\t\t// if the thing has a geoJSONBoundingBox, use that\n\t\t\t\t\tif (thing.geoJSONBoundingBox != null) {\n\t\t\t\t\t\tconst coordinates = [\n\t\t\t\t\t\t\t[thing.geoJSONBoundingBox[0], thing.geoJSONBoundingBox[1], floorAltitude],\n\t\t\t\t\t\t\t[thing.geoJSONBoundingBox[2], thing.geoJSONBoundingBox[3], floorAltitude],\n\t\t\t\t\t\t] as Position[];\n\t\t\t\t\t\ttargets.push(...coordinates);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (isPosition(thing)) {\n\t\t\t\ttargets.push(thing);\n\t\t\t}\n\t\t}\n\n\t\treturn targets;\n\t}\n\n\t/**\n\t * Focuses the camera on a specific target or array of targets.\n\t *\n\t * @param target The target(s) to focus on, either a single element or an array of elements.\n\t * @param options Optional settings for focusing the camera (see {@link TFocusOnOptions}).\n\t * @returns A promise that resolves when the camera animation is complete.\n\t *\n\t * @example Focus on a single space\n\t * ```ts\n\t * mapView.Camera.focusOn(space, { minZoomLevel: 5 });\n\t * ```\n\t *\n\t * @example Focus on multiple elements\n\t * ```ts\n\t * mapView.Camera.focusOn([space1, space2], { pitch: 45 });\n\t * ```\n\t *\n\t * @see [Camera Guide](https://developer.mappedin.com/web-sdk/camera)\n\t */\n\tfocusOn(target: IFocusable | IFocusable[], options?: TFocusOnOptions): Promise<void> {\n\t\treturn this.#rendererCore.camera.focusOn(this.#computeCoordinateCloud(target), {\n\t\t\tpitch: options?.pitch,\n\t\t\tbearing: options?.bearing,\n\t\t\tpadding: options?.screenOffsets || this.screenOffsets,\n\t\t\tmaxZoomLevel: options?.maxZoomLevel,\n\t\t\tminZoomLevel: options?.minZoomLevel,\n\t\t\tduration: options?.duration,\n\t\t\tverticalPadding: options?.axisAlignedPadding?.vertical,\n\t\t\teasing: options?.easing,\n\t\t});\n\t}\n\n\t/**\n\t * Animates the camera to a specific target.\n\t *\n\t * @param target The camera target ({@link TCameraTarget}) to animate to.\n\t * @param options Optional animation options (see {@link TCameraAnimationOptions}).\n\t * @returns A promise that resolves when the animation is complete.\n\t *\n\t * @example\n\t * mapView.Camera.animateTo({ center: coordinate, zoomLevel: 6, bearing: 45 }, { duration: 1000 });\n\t */\n\tanimateTo(target: TCameraTarget, options?: TCameraAnimationOptions): Promise<void> {\n\t\tconst { center: _center, zoomLevel, bearing, pitch } = target;\n\n\t\tconst center = _center ?? this.center;\n\n\t\treturn this.#rendererCore.camera.animateTo({\n\t\t\tcenter:\n\t\t\t\t_center != null\n\t\t\t\t\t? ([center.longitude, center.latitude, this.#rendererCore.camera.elevation] as Position)\n\t\t\t\t\t: undefined,\n\t\t\tzoomLevel: zoomLevel,\n\t\t\tbearing: bearing,\n\t\t\tpitch: pitch,\n\t\t\tduration: options?.duration ?? 600,\n\t\t\teasing: options?.easing,\n\t\t});\n\t}\n\n\t/**\n\t * Instantly sets the camera to a specific target.\n\t *\n\t * @param target The camera target ({@link TCameraTarget}) to set.\n\t *\n\t * @example\n\t * mapView.Camera.set({ center: coordinate, zoomLevel: 7 });\n\t */\n\tset(target: TCameraTarget): void {\n\t\tconst { center = this.center, zoomLevel = this.zoomLevel, bearing = this.bearing, pitch = this.pitch } = target;\n\n\t\tconst position = [center.longitude, center.latitude] as Position;\n\n\t\tthis.#rendererCore.camera.setCenter(position);\n\t\tthis.#rendererCore.camera.setZoomLevel(zoomLevel);\n\t\tthis.#rendererCore.camera.setBearing(bearing);\n\t\tthis.#rendererCore.camera.setPitch(pitch);\n\t}\n\n\t/**\n\t * The current center coordinate ({@link Coordinate}) of the camera.\n\t */\n\tget center() {\n\t\tconst center = this.#rendererCore.camera.center;\n\n\t\treturn new Coordinate(center[1], center[0], undefined);\n\t}\n\n\t/**\n\t * Toggle the mode of the camera to automatically set the minimum zoom level based on the size of the scene.\n\t * It will be automatically disabled when the minimum zoom level is set manually.\n\t * @param value The new value for the auto min zoom level mode.\n\t */\n\tsetAutoMinZoomLevel(value: boolean) {\n\t\tthis.#rendererCore.camera.setAutoMinZoomLevel(value);\n\t}\n\n\t/**\n\t * The mode of the camera to automatically set the minimum zoom level based on the size of the scene.\n\t */\n\tget autoMinZoomLevel() {\n\t\treturn this.#rendererCore.camera.autoMinZoomLevel;\n\t}\n\n\t/**\n\t * The current zoom level of the camera in mercator zoom levels.\n\t *\n\t * @see https://wiki.openstreetmap.org/wiki/Zoom_levels\n\t */\n\tget zoomLevel() {\n\t\treturn this.#rendererCore.camera.zoomLevel;\n\t}\n\n\t/**\n\t * The current pitch of the camera in degrees.\n\t */\n\tget pitch() {\n\t\treturn this.#rendererCore.camera.pitch;\n\t}\n\n\t/**\n\t * The minimum pitch of the camera in degrees.\n\t */\n\tget minPitch() {\n\t\treturn this.#rendererCore.camera.minPitch;\n\t}\n\n\t/**\n\t * The maximum pitch of the camera in degrees.\n\t */\n\tget maxPitch() {\n\t\treturn this.#rendererCore.camera.maxPitch;\n\t}\n\n\t/**\n\t * Update the minimum pitch of the camera in degrees.\n\t * @param minPitch The new minimum pitch.\n\t */\n\tsetMinPitch = (minPitch: number) => {\n\t\tthis.#rendererCore.camera.setMinPitch(minPitch);\n\t};\n\n\t/**\n\t * Update the maximum pitch of the camera in degrees.\n\t * @param maxPitch The new maximum pitch.\n\t */\n\tsetMaxPitch = (maxPitch: number) => {\n\t\tthis.#rendererCore.camera.setMaxPitch(maxPitch);\n\t};\n\n\t/**\n\t * The current bearing of the camera in degrees clockwise from North. 0 degrees is North, 90 degrees is East, 180 degrees is South, and 270 degrees is West.\n\t */\n\tget bearing() {\n\t\tconst bearing = this.#rendererCore.camera.bearing;\n\n\t\treturn (bearing < 0 ? bearing + 360 : bearing) % 360;\n\t}\n\t/**\n\t * The minimum zoom level of the camera in mercator zoom levels.\n\t *\n\t * @see https://wiki.openstreetmap.org/wiki/Zoom_levels\n\t */\n\tget minZoomLevel() {\n\t\treturn this.#rendererCore.camera.minZoomLevel;\n\t}\n\t/**\n\t * Update the minimum zoom level of the camera in mercator zoom levels.\n\t * @param zoomLevel The new minimum zoom level.\n\t * @see https://wiki.openstreetmap.org/wiki/Zoom_levels\n\t */\n\tsetMinZoomLevel = (zoomLevel: number) => {\n\t\tthis.#rendererCore.camera.setMinZoomLevel(zoomLevel, true);\n\t};\n\t/**\n\t * The maximum zoom level of the camera in mercator zoom levels.\n\t *\n\t * @see https://wiki.openstreetmap.org/wiki/Zoom_levels\n\t */\n\tget maxZoomLevel() {\n\t\treturn this.#rendererCore.camera.maxZoomLevel;\n\t}\n\t/**\n\t * Update the maximum zoom level of the camera in mercator zoom levels.\n\t * @param zoomLevel The new maximum zoom level.\n\t * @see https://wiki.openstreetmap.org/wiki/Zoom_levels\n\t * @default 22\n\t * @max 24\n\t * @min 0\n\t */\n\tsetMaxZoomLevel = (zoomLevel: number) => {\n\t\tthis.#rendererCore.camera.setMaxZoomLevel(zoomLevel);\n\t};\n\n\t/**\n\t * Set the camera's elevation in meters.\n\t * @experimental\n\t * @param elevation The new elevation in meters.\n\t */\n\tsetElevation(elevation: number) {\n\t\tthis.#rendererCore.camera.setElevation(elevation);\n\t}\n\n\t/**\n\t * The current elevation of the camera in meters.\n\t */\n\tget elevation() {\n\t\treturn this.#rendererCore.camera.elevation;\n\t}\n\n\t/**\n\t * Animate the camera's elevation to a specified elevation.\n\t * @experimental\n\t * @param elevation The target elevation in meters.\n\t * @param options Optional settings for the camera animation.\n\t */\n\tanimateElevation(elevation: number, options?: TCameraAnimationOptions) {\n\t\treturn this.#rendererCore.camera.animateElevation(elevation, options);\n\t}\n\n\t/**\n\t * The current pan boundary of the camera.\n\t */\n\tget bounds(): CameraBounds {\n\t\treturn convertPanBoundsToCameraBounds(\n\t\t\tthis.#rendererCore.getSystems().cameraSystem.panBounds,\n\t\t\tthis.#rendererCore.convert3DMapPositionToCoordinate,\n\t\t);\n\t}\n\n\tget isAnimating() {\n\t\treturn this.#rendererCore.camera.isAnimating;\n\t}\n\n\tcancelAnimation() {\n\t\tthis.#rendererCore.camera.cancelAnimation();\n\t}\n\n\t/**\n\t * @internal\n\t * @experimental\n\t * Force an update of the facades in view.\n\t */\n\tupdateFacadesInView() {\n\t\tthis.#rendererCore.getSystems().geometryInFocusSystem.raycast();\n\t}\n}\n", "import type { GeojsonApiMapObject } from './map-object';\nimport type { GLTFExportOptions } from '../types';\nimport { Logger } from '@packages/internal/common';\n\n/**\n * API to export the scene.\n *\n * @hidden\n */\nexport class Exporter {\n\t#getCurrentMap: CurrentMapGetter;\n\t/**\n\t * @internal\n\t */\n\tget currentMap() {\n\t\treturn this.#getCurrentMap();\n\t}\n\t/**\n\t * @internal\n\t */\n\tconstructor({ currentMapGetter }: { currentMapGetter: CurrentMapGetter }) {\n\t\tthis.#getCurrentMap = currentMapGetter;\n\t}\n\n\t/**\n\t * Exports the current scene as a GLTF file.\n\t *\n\t * @hidden\n\t */\n\tasync getCurrentSceneGLTF(userOptions: GLTFExportOptions): Promise<Blob> {\n\t\tconst map = this.#getCurrentMap();\n\n\t\tif (!map) {\n\t\t\tLogger.error('There is no map to export. Please load a map first.');\n\n\t\t\treturn new Blob();\n\t\t}\n\n\t\treturn map?.Exporter.getCurrentSceneGLTF(userOptions);\n\t}\n}\ntype CurrentMapGetter = () => GeojsonApiMapObject | undefined;\n", "import type { IAnchorable, TAddLabelOptions } from '../types';\nimport { Label } from '../map-view-objects';\nimport type { GeojsonApiMapObject } from './map-object';\nimport { getAttachableGeometryId } from './utils';\n\n/**\n * ## Labels in Mappedin JS\n *\n * Labels are text elements anchored to map objects that automatically rotate, show/hide based on priority and zoom level, and manage collisions with other labels. They're perfect for displaying location names, points of interest, and contextual information.\n *\n * ### Features\n * - Automatic collision management and visibility ranking\n * - Customizable appearance (color, font, background, etc.)\n * - Support for interactivity (click, hover)\n * - Automatic rotation and positioning\n * - Batch operations for adding all labels at once\n *\n * > **Best Practice:** Use the `rank` option to control label visibility priority. Use `interactive: true` to enable click/hover events for important labels.\n *\n * ### Example Usage\n * ```ts\n * // Add a single label\n * mapView.Labels.add(space, 'Welcome', { appearance: { color: 'blue' } });\n *\n * // Add a label with high priority\n * mapView.Labels.add(space, 'Main Entrance', { rank: 'always-visible' });\n *\n * // Add all labels automatically (experimental)\n * mapView.Labels.__EXPERIMENTAL__all();\n *\n * // Remove a specific label\n * mapView.Labels.remove(label);\n *\n * // Remove all labels\n * mapView.Labels.removeAll();\n * ```\n *\n * ### Advanced\n * - Use `appearance` to customize colors, fonts, and backgrounds.\n * - Use `rank` to control collision priority ('low', 'medium', 'high', 'always-visible').\n * - Use `__EXPERIMENTAL__all()` to automatically add labels for all map objects with predefined text (experimental feature).\n *\n * ### More Information\n * - [Labels Guide](https://developer.mappedin.com/web-sdk/labels)\n *\n * This class is accessed using {@link MapView.Labels}.\n */\nexport class Labels {\n\t#labelsById: Map<string, { label: Label; entityId: string }> = new Map();\n\t#getCurrentMap: CurrentMapGetter;\n\t/**\n\t * @internal\n\t */\n\tget currentMap() {\n\t\treturn this.#getCurrentMap();\n\t}\n\t/**\n\t * @internal\n\t */\n\tconstructor({ currentMapGetter }: { currentMapGetter: CurrentMapGetter }) {\n\t\tthis.#getCurrentMap = currentMapGetter;\n\t}\n\n\tgetAll(): Label[] {\n\t\treturn Array.from(this.#labelsById.values()).map(l => l.label);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tgetById(id: string) {\n\t\treturn this.#labelsById.get(id);\n\t}\n\n\t/**\n\t * Adds a label ({@link Label}) to the map.\n\t *\n\t * @param target The target object ({@link IAnchorable}) where the label should be added (e.g., {@link Space}, {@link Door}, {@link Coordinate}, or {@link Node}).\n\t * @param text The text content of the label.\n\t * @param options Optional additional options for the label (see {@link TAddLabelOptions}).\n\t * @returns {Label | undefined} The created label, or undefined if creation failed.\n\t *\n\t * @example Add a simple label\n\t * ```ts\n\t * mapView.Labels.add(space, 'Welcome', { appearance: { color: 'blue' } });\n\t * ```\n\t *\n\t * @example Add a high-priority interactive label\n\t * ```ts\n\t * mapView.Labels.add(space, 'Main Entrance', {\n\t *   rank: 'always-visible',\n\t *   interactive: true,\n\t *   appearance: {\n\t *     color: 'red',\n\t *     backgroundColor: 'white',\n\t *     fontSize: 14\n\t *   }\n\t * });\n\t * ```\n\t *\n\t * @see [Labels Guide](https://developer.mappedin.com/web-sdk/labels)\n\t */\n\tadd(target: IAnchorable, text: string, options?: TAddLabelOptions | undefined): Label {\n\t\tconst coord = target.anchorTarget;\n\t\t// @TODO: add layer support\n\t\tconst map = this.currentMap;\n\t\tif (!map) throw new Error('currentMap should exist');\n\t\tconst entity = map.Labels.add(coord, text, {\n\t\t\t...options,\n\t\t\tattachTo: getAttachableGeometryId(target),\n\t\t\trank: options?.rank == null || options?.rank === 'initial' ? 'medium' : options.rank,\n\t\t});\n\n\t\tconst newLabel = new Label(entity.id.toString(), text, target);\n\t\tthis.#labelsById.set(newLabel.id, { label: newLabel, entityId: newLabel.id });\n\n\t\treturn newLabel;\n\t}\n\t/**\n\t * @experimental\n\t * @warning **EXPERIMENTAL FEATURE UNDER CONSTRUCTION**\n\t *\n\t * This is an experimental feature that may undergo significant changes,\n\t * including breaking changes, renaming, or complete removal in future versions.\n\t * Do not rely on this API in production environments.\n\t *\n\t * Automatically adds all the labels ({@link Label}) to the map.\n\t *\n\t * The text, appearance, priority, etc. of the labels will be automatically determined based on the external data from the map.\n\t *\n\t * @param options Optional additional options for the labels, similar to those in the `add` method (see {@link TAddLabelOptions}).\n\t * @returns An array of all created {@link Label} instances.\n\t *\n\t * @example Add all labels with default settings\n\t * ```ts\n\t * const labels = mapView.Labels.__EXPERIMENTAL__all();\n\t * ```\n\t *\n\t * @example Add all labels with custom appearance\n\t * ```ts\n\t * const labels = mapView.Labels.__EXPERIMENTAL__all({\n\t *   appearance: { color: 'darkblue' },\n\t *   rank: 'high'\n\t * });\n\t * ```\n\t */\n\t__EXPERIMENTAL__all(options?: TAddLabelOptions) {\n\t\tconst created: Label[] = [];\n\t\tthis.currentMap?.Labels.all({\n\t\t\tonCreate: (id, text, target) => {\n\t\t\t\tconst newLabel = new Label(id.toString(), text, target);\n\t\t\t\tthis.#labelsById.set(newLabel.id, { label: newLabel, entityId: newLabel.id });\n\t\t\t\tcreated.push(newLabel);\n\t\t\t},\n\t\t\tlabelOptions: options,\n\t\t});\n\n\t\treturn created;\n\t}\n\t/**\n\t * Removes a label ({@link Label}) from the map.\n\t *\n\t * @param label The label which should be removed.\n\t * @example\n\t * mapView.Labels.remove(label);\n\t */\n\tremove(label: Label) {\n\t\tconst found = this.#labelsById.get(label.id);\n\t\tif (!found) return;\n\t\tthis.currentMap?.Labels.remove(found);\n\t\tthis.#labelsById.delete(label.id.toString());\n\t}\n\t/**\n\t * Removes all the labels ({@link Label}) from the map.\n\t *\n\t * @returns An array of all removed {@link Label} instances.\n\t * @example\n\t * const removedLabels = mapView.Labels.removeAll();\n\t */\n\tremoveAll() {\n\t\tconst removed: Label[] = [];\n\t\tthis.#labelsById.forEach(({ label }) => {\n\t\t\tthis.remove(label);\n\t\t\tremoved.push(label);\n\t\t\tthis.#labelsById.delete(label.id.toString());\n\t\t});\n\n\t\treturn removed;\n\t}\n}\ntype CurrentMapGetter = () => GeojsonApiMapObject | undefined;\n", "import type { ParsedMVF, PolygonStyle } from '@mappedin/mvf-v2';\nimport type { FeatureCollection, LineString, MultiPolygon, Polygon, Feature, Point } from 'geojson';\nimport { Logger, PubSub } from '@packages/internal/common';\nimport {\n\ttype Position,\n\ttype AddLabelOptionsInternal,\n\ttype RendererCore,\n\ttype PathState,\n\ttype GroupContainerState,\n\ttype MarkerState,\n\ttype LabelAppearance,\n\ttype LineStyle,\n\ttype PaintStyle,\n\ttype EntityId,\n\ttype CollisionRankingTier,\n\ttype InitializeModelState,\n\ttype Text3DState,\n\tANIMATION_TWEENS,\n} from '@mappedin/core-sdk';\nimport { FloorObject } from './floor-object';\nimport type { TAddMarkerOptions, TAddPathOptions, TShow3DMapOptions } from '..';\nimport type {\n\tGLTFExportOptions,\n\tTAnimationOptions,\n\tTAddModelOptions,\n\tTAddImageOptions,\n\tTAddText3DOptions,\n\tTCollisionRankingTier,\n\tIAnchorable,\n\tTAddLabelOptions,\n\tTMultiFloorViewOptions,\n} from '../types';\nimport {\n\ttype AggregatedStyleMap,\n\tconvertCoordinateToPosition,\n\tshouldAnimatePathDrawing,\n\textractStyleMap,\n\tgetAttachableGeometryId,\n\tgetTargetFloorObject,\n\ttweenToPromise,\n\tcomputeFloorAltitudes,\n\tparseFloorGap,\n} from './utils';\nimport type { TFloorChangeReason } from '../events';\nimport { getId, randomId } from '../utils';\nimport type { Shape } from '../map-view-objects';\nimport type { MapDataInternal } from '../map-data-objects';\nimport { Space, Coordinate } from '../map-data-objects';\nimport { type GeoJsonApi } from './api';\nimport { Tween } from '@tweenjs/tween.js';\nimport { FloorStackObject } from './floor-stack-object';\nimport { getMultiFloorState } from './multi-floor';\nimport { LABELS_LAYER, MARKERS_LAYER, PATHS_LAYER } from '../constants';\nimport { MappedinError } from '@packages/internal/common/errors';\n\nexport type InternalPath = {\n\tpaths: (EntityId<PathState> & {\n\t\tcoordinates: Coordinate[];\n\t})[];\n\tanimation: Promise<void>;\n};\n\nexport class GeojsonApiMapObject extends PubSub<{\n\t'floor-change': { reason?: TFloorChangeReason; floorId: string; previousFloorId: string };\n\t'floor-change-start': { reason?: TFloorChangeReason; floorId: string; previousFloorId: string };\n}> {\n\tfloorStacksById: Map<string, FloorStackObject> = new Map();\n\tfloorsById: Map<string, FloorObject> = new Map();\n\tstartingFloorId = '';\n\tcurrentFloorId = '';\n\tcurrentFloorStackId = '';\n\toutdoorFloorStacks: Set<string> = new Set();\n\tid: string;\n\trenderer: RendererCore;\n\tapi: GeoJsonApi;\n\tmvf: ParsedMVF;\n\toptions: TShow3DMapOptions = {};\n\tstyleMap: AggregatedStyleMap;\n\tprivate animations: Map<string, Tween> = new Map();\n\tprivate floorStackAltitudeMap: Map<string, Map<number, { altitude: number; effectiveHeight: number }>> = new Map();\n\n\tget currentFloorStack() {\n\t\tconst floorStack = this.floorStacksById.get(this.currentFloorStackId);\n\t\tif (!floorStack) {\n\t\t\tthrow new MappedinError(`Current floor stack with id \"${this.currentFloorStackId}\" not found`);\n\t\t}\n\n\t\treturn floorStack!;\n\t}\n\n\tsetFloorStack(floorStackId: string, reason?: TFloorChangeReason) {\n\t\tif (this.currentFloorStackId === floorStackId) {\n\t\t\treturn;\n\t\t}\n\t\tconst floorStack = this.floorStacksById.get(floorStackId);\n\t\tif (floorStack == null) {\n\t\t\tLogger.error(\n\t\t\t\t`Invalid floor stack passed to setFloorStack (${floorStackId}), the floor stack was not changed. Current floor stack is still ${this.currentFloorStack.id}.`,\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (floorStack.floorObjects.length === 0) {\n\t\t\tLogger.error(\n\t\t\t\t`Floor stack (${floorStackId}) has no floors. The floor stack was not changed. Current floor stack is still ${this.currentFloorStack.id}.`,\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setFloor(floorStack.defaultFloor.id, reason);\n\t}\n\n\tget currentFloor() {\n\t\tconst floor = this.floorsById.get(this.currentFloorId);\n\t\tif (!floor) {\n\t\t\tthrow new MappedinError(`Floor with id \"${this.currentFloorId}\" not found`);\n\t\t}\n\n\t\treturn floor!;\n\t}\n\n\t/** @deprecated use `currentFloorStack.floorObjects` or `floorsById` instead */\n\tget floors() {\n\t\treturn Array.from(this.floorsById.values());\n\t}\n\n\tprocessFloorChange(floorId: string) {\n\t\tif (this.api.manualFloorVisibility === true) {\n\t\t\treturn;\n\t\t}\n\t\tconst currentFloor = this.api.getMapDataInternal()?.getById('floor', floorId);\n\t\tconst currentFloorStack = this.api.getMapDataInternal()?.getById('floor-stack', this.currentFloorStackId);\n\t\tif (currentFloor && currentFloorStack) {\n\t\t\tif (!this.#multiFloorView?.enabled || currentFloor.floorStack.id !== currentFloorStack?.id) {\n\t\t\t\tfor (const floorStack of this.floorStacksById.values()) {\n\t\t\t\t\tfloorStack.floorObjects.forEach(floor => {\n\t\t\t\t\t\tif (floor.id === floorId) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfloor.setVisible(false);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst state = getMultiFloorState(\n\t\t\t\t\tcurrentFloorStack.floors,\n\t\t\t\t\tcurrentFloor,\n\t\t\t\t\tthis.#multiFloorView.floorGap,\n\t\t\t\t\tthis.api.Navigation?.floors?.map(f => f.id) || [],\n\t\t\t\t\tthis.getFloorStackAltitudeData(currentFloorStack.id),\n\t\t\t\t);\n\n\t\t\t\tthis.api?.Outdoor?.setOpacity(state.outdoorOpacity);\n\t\t\t\tstate.floorStates.forEach(f => {\n\t\t\t\t\tif (f.floor) {\n\t\t\t\t\t\tconst floor = this.api.getMapData()?.getById('floor', f.floor.id);\n\n\t\t\t\t\t\tif (floor) {\n\t\t\t\t\t\t\tthis.api.updateState(floor, f.state);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (this.#multiFloorView.updateCameraElevationOnFloorChange) {\n\t\t\t\t\tconst floorAltitudes = this.floorStackAltitudeMap.get(currentFloorStack.id)!;\n\t\t\t\t\tthis.api.Camera.setElevation(\n\t\t\t\t\t\tfloorAltitudes.get(currentFloor.elevation)?.altitude ??\n\t\t\t\t\t\t\tcurrentFloor.elevation * parseFloorGap(this.#multiFloorView.floorGap, currentFloor.maxHeight),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsetFloor(floorId: string, reason?: TFloorChangeReason) {\n\t\tif (this.currentFloorId === floorId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst newFloor = this.floorsById.get(floorId);\n\t\tif (!newFloor) {\n\t\t\tLogger.error(\n\t\t\t\t`Invalid floor passed to setFloor (${floorId}), the floor was not changed. Current floor is still ${this.currentFloor.id}`,\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Warning: this.currentFloor throw here on first load\n\t\tconst previousFloorId = this.currentFloorId;\n\n\t\tthis.publish('floor-change-start', {\n\t\t\tpreviousFloorId,\n\t\t\tfloorId,\n\t\t\treason,\n\t\t});\n\n\t\tif (this.currentFloorStack) {\n\t\t\tthis.processFloorChange(floorId);\n\t\t}\n\n\t\t// Then show the current floor\n\t\tthis.currentFloorId = floorId;\n\t\tthis.currentFloorStackId = this.currentFloor.floorStackId;\n\t\tthis.currentFloor.setVisible(true);\n\n\t\t// Legacy behavior for compat\n\t\tthis.updatePathLayersVisibility();\n\n\t\tthis.publish('floor-change', {\n\t\t\treason,\n\t\t\tfloorId: this.currentFloor.id,\n\t\t\tpreviousFloorId,\n\t\t});\n\t}\n\n\t/**\n\t * Updates the visibility of path layers across all floors based the value of hidePathsNotOnCurrentFloor\n\t * and whether multi-floor view is enabled.\n\t */\n\tupdatePathLayersVisibility() {\n\t\tconst shouldHideOtherFloors = this.api.hidePathsNotOnCurrentFloor === true && !this.options.multiFloorView?.enabled;\n\n\t\tfor (const floor of this.floorsById.values()) {\n\t\t\tconst pathLayer = floor.layers.get(PATHS_LAYER);\n\t\t\tif (!pathLayer) continue;\n\n\t\t\tconst shouldShowLayer = !shouldHideOtherFloors || floor.id === this.currentFloor.id;\n\t\t\tpathLayer.setVisible(shouldShowLayer);\n\t\t}\n\t}\n\n\tgetFloorStackAltitudeData(floorStackId: string) {\n\t\treturn this.floorStackAltitudeMap.get(floorStackId)!;\n\t}\n\n\tprivate cancelAnimation(id: string) {\n\t\tconst animation = this.animations.get(id);\n\t\tif (animation) {\n\t\t\tanimation.stop();\n\t\t\tthis.animations.delete(id);\n\t\t\tthis.renderer.getInternalTweenGroup().remove(animation);\n\t\t}\n\t}\n\n\tModels = {\n\t\tadd: (id: string, targets: Coordinate[], opts: TAddModelOptions & { floorId?: string; url: string }) => {\n\t\t\tconst { floorId, scale, ...rest } = opts;\n\t\t\tconst floor = floorId ? this.floorsById.get(floorId) : undefined;\n\t\t\tconst params: InitializeModelState = { ...rest };\n\t\t\tif (scale != null) {\n\t\t\t\tparams.scale = Array.isArray(opts.scale)\n\t\t\t\t\t? opts.scale\n\t\t\t\t\t: ([opts.scale, opts.scale, opts.scale] as [number, number, number]);\n\t\t\t}\n\t\t\tconst model = this.renderer.addModelGroup(\n\t\t\t\tid,\n\t\t\t\t{\n\t\t\t\t\ttype: 'FeatureCollection',\n\t\t\t\t\tfeatures: targets.map(target => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttype: 'Feature',\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tid: randomId(),\n\t\t\t\t\t\t\t\trotation: opts.rotation,\n\t\t\t\t\t\t\t\tscale: params.scale,\n\t\t\t\t\t\t\t\tinteractive: opts.interactive,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tgeometry: {\n\t\t\t\t\t\t\t\ttype: 'Point',\n\t\t\t\t\t\t\t\tcoordinates: convertCoordinateToPosition(target) as number[],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\tparams,\n\t\t\t\t{\n\t\t\t\t\tparent: floor?.id,\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tif (model == null) {\n\t\t\t\tthrow new MappedinError('error creating model');\n\t\t\t}\n\n\t\t\treturn this.renderer.getState(model).children;\n\t\t},\n\t\tremove: (_id: string, _groupId: string) => {\n\t\t\tthis.renderer.remove(_id);\n\t\t\tconst group = this.renderer.getState<GroupContainerState>(_groupId);\n\n\t\t\tif (group.children.length === 0) {\n\t\t\t\tthis.renderer.remove(_groupId);\n\t\t\t}\n\t\t},\n\t};\n\n\tImage3D = {\n\t\tadd: (target: Position, url: string, opts: TAddImageOptions & { floorId?: string }) => {\n\t\t\tconst { floorId, flipImageToFaceCamera, ...properties } = opts;\n\t\t\tconst floor = floorId ? this.floorsById.get(floorId)! : this.currentFloor;\n\t\t\tconst geometry: Feature<Point, Omit<TAddImageOptions, 'id' | 'flipImageToFaceCamera'>> = {\n\t\t\t\ttype: 'Feature',\n\t\t\t\tproperties,\n\t\t\t\tgeometry: { type: 'Point', coordinates: target as [number, number] },\n\t\t\t};\n\n\t\t\treturn this.renderer.addImage(\n\t\t\t\topts.id ?? randomId(),\n\t\t\t\tgeometry,\n\t\t\t\t{ url, flipImageToFaceCamera: flipImageToFaceCamera ?? false },\n\t\t\t\tfloor.id,\n\t\t\t);\n\t\t},\n\t\tremove: (id: string) => {\n\t\t\tthis.renderer.remove(id);\n\t\t},\n\t\tremoveAll: () => {\n\t\t\t// Already implemented globally, no need to implement here for now\n\t\t},\n\t};\n\n\tMarkers = {\n\t\tadd: (\n\t\t\tcoordinate: Coordinate,\n\t\t\thtml: string,\n\t\t\topts: TAddMarkerOptions & { attachTo?: string },\n\t\t): EntityId<MarkerState> => {\n\t\t\tconst floor = getTargetFloorObject(\n\t\t\t\tcoordinate,\n\t\t\t\tthis.floorsById,\n\t\t\t\tthis.api.mapObjects[0].floorsById.get('default-floor')!,\n\t\t\t);\n\t\t\tconst { attachTo, ...rest } = opts;\n\t\t\tconst _opts = rest as Omit<TAddMarkerOptions, 'rank'> & {\n\t\t\t\trank: TCollisionRankingTier;\n\t\t\t};\n\t\t\tif (rest.rank === 'initial') {\n\t\t\t\t_opts.rank = 'medium';\n\t\t\t}\n\n\t\t\tconst markerLayer = floor.layers.get(MARKERS_LAYER);\n\n\t\t\tconst marker = this.renderer.addMarker2D(\n\t\t\t\tconvertCoordinateToPosition(coordinate),\n\t\t\t\thtml,\n\t\t\t\t{ ..._opts, occluderId: floor?.occluderId, attachTo },\n\t\t\t\tmarkerLayer?.containerId,\n\t\t\t);\n\n\t\t\tif (!marker) {\n\t\t\t\tthrow new MappedinError('Failed to create Marker');\n\t\t\t}\n\n\t\t\treturn marker;\n\t\t},\n\t\tremove: (id: string) => {\n\t\t\tthis.renderer.remove(id);\n\t\t},\n\t\tgetContentEl: (id: string) => {\n\t\t\tconst markerState = this.renderer.getState(id);\n\t\t\tif (markerState?.type === 'marker') {\n\t\t\t\treturn markerState.element;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t},\n\t\tremoveAll: () => {\n\t\t\t// Already implemented globally, no need to implement here for now\n\t\t},\n\t\tsetPosition: (id: string, coordinate: Position, targetFloorId: string) => {\n\t\t\tconst markerState = this.renderer.getState(id);\n\t\t\tconst floor = targetFloorId ? this.floorsById.get(targetFloorId) : this.currentFloor;\n\n\t\t\tif (!markerState) {\n\t\t\t\tLogger.error(`Failed to retrieve state for Marker with id \"${id}\".`);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (markerState.type !== 'marker') {\n\t\t\t\tLogger.error(`Geometry with id \"${id}\" is not of type \"marker\".`);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.renderer.setState<MarkerState>(markerState, {\n\t\t\t\tposition: coordinate,\n\t\t\t\tparent: floor?.layers.get(MARKERS_LAYER)?.containerId,\n\t\t\t});\n\t\t},\n\t\tanimateTo: (id: string, coordinate: Position, targetFloorId: string, options?: TAnimationOptions) => {\n\t\t\tconst markerState = this.renderer.getState(id);\n\t\t\tconst floor = targetFloorId ? this.floorsById.get(targetFloorId) : this.currentFloor;\n\n\t\t\tif (!markerState) {\n\t\t\t\tLogger.error(`Failed to retrieve state for Marker with id \"${id}\".`);\n\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t\tif (markerState.type !== 'marker') {\n\t\t\t\tLogger.error(`Geometry with id \"${id}\" is not of type \"marker\".`);\n\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t\tconst optionsWithDefaults = {\n\t\t\t\tduration: 1000,\n\t\t\t\teasing: 'ease-in-out',\n\t\t\t\t...options,\n\t\t\t};\n\n\t\t\tthis.cancelAnimation(id);\n\n\t\t\tconst tween = new Tween({ lon: markerState.position[0], lat: markerState.position[1] })\n\t\t\t\t.to({ lon: coordinate[0], lat: coordinate[1] }, optionsWithDefaults.duration)\n\t\t\t\t.easing(ANIMATION_TWEENS[optionsWithDefaults.easing])\n\t\t\t\t.onUpdate(({ lon, lat }) => {\n\t\t\t\t\tconst state = this.renderer.getState(id);\n\t\t\t\t\tif (!state) {\n\t\t\t\t\t\tthis.cancelAnimation(id);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst layerContainerId = floor?.layers.get(MARKERS_LAYER)?.containerId;\n\t\t\t\t\t\tif (layerContainerId) {\n\t\t\t\t\t\t\tthis.Markers.setPosition(id, [lon, lat], layerContainerId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.start();\n\t\t\tthis.renderer.getInternalTweenGroup().add(tween);\n\t\t\tthis.renderer.render();\n\n\t\t\tthis.animations.set(id, tween);\n\n\t\t\treturn tweenToPromise(tween).then(() => {\n\t\t\t\tthis.animations.delete(id);\n\t\t\t});\n\t\t},\n\t};\n\n\tExporter = {\n\t\tgetCurrentSceneGLTF: async (options: GLTFExportOptions) => {\n\t\t\treturn this.renderer.getCurrentSceneGLTF(options);\n\t\t},\n\t};\n\n\tShapes = {\n\t\tadd: <T extends FeatureCollection<Polygon | MultiPolygon | LineString, any>>(\n\t\t\tgeometry: T,\n\t\t\tstyle: T extends FeatureCollection<LineString, any> ? LineStyle : PaintStyle,\n\t\t\topts: { floorId?: string },\n\t\t) => {\n\t\t\tconst floor = opts?.floorId ? this.floorsById.get(opts?.floorId)! : this.currentFloor;\n\t\t\tconst id = 'shape-' + randomId();\n\t\t\tthis.renderer.addGeometryGroup(id, geometry, style, floor.id);\n\n\t\t\treturn id;\n\t\t},\n\n\t\tremove: (customGeometry: Shape) => {\n\t\t\tthis.renderer.remove(customGeometry.id);\n\n\t\t\treturn customGeometry.id;\n\t\t},\n\t};\n\n\tText3D = {\n\t\tlabel: (target: Space, content?: string, options?: TAddText3DOptions): Text3DInfo | undefined => {\n\t\t\tif (!this.api.getMapDataInternal()?.enterpriseMode) {\n\t\t\t\tLogger.warn('Enterprise mode is not enabled, skipping label creation');\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst textInfo = labelSpace(this.renderer, target, content, options);\n\n\t\t\tif (textInfo) {\n\t\t\t\treturn {\n\t\t\t\t\ttextInfo,\n\t\t\t\t\ttarget: target,\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\t\tlabelAll: (option: TAddText3DOptions = {}): Text3DInfo[] => {\n\t\t\tif (!this.api.getMapDataInternal()?.enterpriseMode) {\n\t\t\t\tLogger.warn('Enterprise mode is not enabled, skipping label creation');\n\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tconst mapData = this.api.getMapData();\n\t\t\tif (!mapData) return [];\n\n\t\t\tconst result: Text3DInfo[] = [];\n\n\t\t\tmapData.getByType('space').forEach(space => {\n\t\t\t\tif (space.locations[0]) {\n\t\t\t\t\tconst text3d = labelSpace(this.renderer, space, space.locations[0]?.name ?? space.name, option);\n\t\t\t\t\tif (text3d) {\n\t\t\t\t\t\tresult.push({\n\t\t\t\t\t\t\ttextInfo: text3d,\n\t\t\t\t\t\t\ttarget: space,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn result;\n\t\t},\n\t\tremove: (id: string) => {\n\t\t\tif (!this.api.getMapDataInternal()?.enterpriseMode) {\n\t\t\t\tLogger.warn('Remove text label only works in enterprise mode');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.renderer.remove(id);\n\n\t\t\treturn id;\n\t\t},\n\t};\n\tLabels = {\n\t\tall: ({\n\t\t\tonCreate,\n\t\t\tlabelOptions = {},\n\t\t}: {\n\t\t\tonCreate: (labelId: string | number, text: string, target: IAnchorable) => void;\n\t\t\tlabelOptions?: TAddLabelOptions;\n\t\t}) => {\n\t\t\tfor (const entry of Object.entries(this.mvf.space)) {\n\t\t\t\tconst [floorId, val] = entry;\n\t\t\t\tif (!val) continue;\n\t\t\t\tval.features.forEach(feature => {\n\t\t\t\t\tconst space = this.api.getMapData()?.getById('space', feature.properties.id);\n\t\t\t\t\tif (!space) return;\n\t\t\t\t\tconst hasImageLabel = (this.styleMap[feature.properties.id] as PolygonStyle)?.showImage;\n\t\t\t\t\tconst featureImages = feature.properties.details?.images;\n\t\t\t\t\tconst icon = hasImageLabel && featureImages?.[0]?.url ? { icon: featureImages[0].url } : {};\n\t\t\t\t\tconst appearance: LabelAppearance = {\n\t\t\t\t\t\ticon: icon.icon,\n\t\t\t\t\t\t...labelOptions.appearance,\n\t\t\t\t\t};\n\t\t\t\t\tconst floor = floorId ? this.floorsById.get(floorId)! : this.currentFloor;\n\n\t\t\t\t\tconst labelLayer = floor.layers.get(LABELS_LAYER);\n\n\t\t\t\t\tif (feature.properties.center && space.name !== '') {\n\t\t\t\t\t\tconst label = this.renderer.addLabel2D(\n\t\t\t\t\t\t\tfeature.properties.center,\n\t\t\t\t\t\t\tspace.name,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tid: feature.properties.id + '-label',\n\t\t\t\t\t\t\t\t...labelOptions,\n\t\t\t\t\t\t\t\tappearance,\n\t\t\t\t\t\t\t\trank: labelOptions.rank as CollisionRankingTier,\n\t\t\t\t\t\t\t\tattachTo: getAttachableGeometryId(space),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tSpace.is(space) ? space.id : labelLayer?.containerId,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (label) {\n\t\t\t\t\t\t\tonCreate(label.id, space.name, space);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tadd: (\n\t\t\tcoordinate: Coordinate,\n\t\t\ttext: string,\n\t\t\topts: AddLabelOptionsInternal & { attachTo?: string; verticalOffset?: number } = {},\n\t\t): { id: string | number } => {\n\t\t\tconst { attachTo, ...rest } = opts;\n\t\t\tconst floor = getTargetFloorObject(\n\t\t\t\tcoordinate,\n\t\t\t\tthis.floorsById,\n\t\t\t\tthis.api.mapObjects[0].floorsById.get('default-floor')!,\n\t\t\t);\n\n\t\t\tconst labelLayer = floor.layers.get(LABELS_LAYER)!;\n\n\t\t\tconst label = this.renderer.addLabel2D(\n\t\t\t\tconvertCoordinateToPosition(coordinate),\n\t\t\t\ttext,\n\t\t\t\t{ ...rest, occluderId: floor.occluderId, attachTo },\n\t\t\t\tlabelLayer?.containerId,\n\t\t\t);\n\n\t\t\tif (!label) {\n\t\t\t\tthrow new MappedinError('label creating failed');\n\t\t\t}\n\n\t\t\treturn label;\n\t\t},\n\t\tremove: ({ entityId }: { entityId: string }) => {\n\t\t\tthis.renderer.remove(entityId);\n\t\t},\n\n\t\tremoveAll: () => {\n\t\t\t// TODO: currently removeall is to remove all labels that's not exclusive this map.\n\t\t\t// When we ever get the multi map support, we should implement the logic to only remove\n\t\t\t// the map in here\n\t\t},\n\t};\n\n\tPaths: {\n\t\tadd: (\n\t\t\tcoordinates: Coordinate[],\n\t\t\toptions?: TAddPathOptions & { id?: string },\n\t\t) => { paths: (EntityId<PathState> & { coordinates: Coordinate[] })[]; animation: Promise<void> };\n\t\tremove: (entityIds: string[]) => void;\n\t} = {\n\t\tadd: (coordinates: Coordinate[], options?: TAddPathOptions & { id?: string }): InternalPath => {\n\t\t\tconst animateDrawing = options?.animateDrawing ?? true;\n\t\t\tconst segments: {\n\t\t\t\tfloorId: string;\n\t\t\t\tcoordinates: Coordinate[];\n\t\t\t}[] = [];\n\t\t\tlet currentFloorId = coordinates[0].floorId || 'root';\n\t\t\tlet segmentIndex = 0;\n\t\t\tfor (const coord of coordinates) {\n\t\t\t\tconst { floorId = 'root', latitude, longitude } = coord;\n\n\t\t\t\t// Detect floor changes and iterate to the next segment\n\t\t\t\tif (floorId !== currentFloorId) {\n\t\t\t\t\tsegmentIndex++;\n\t\t\t\t\tcurrentFloorId = floorId;\n\t\t\t\t}\n\n\t\t\t\t// Create a new segment if it doesn't exist\n\t\t\t\tif (segments[segmentIndex] == null) {\n\t\t\t\t\tsegments.push({ floorId, coordinates: [] });\n\t\t\t\t}\n\n\t\t\t\t// Add the coordinate to the current segment\n\t\t\t\tconst coordinate = floorId === coord.floorId ? coord : new Coordinate({ longitude, latitude, floorId });\n\t\t\t\tsegments[segmentIndex].coordinates.push(coordinate);\n\t\t\t}\n\n\t\t\tconst paths = segments.reduce<(EntityId<PathState> & { coordinates: Coordinate[] })[]>(\n\t\t\t\t(acc, { floorId, coordinates }, idx) => {\n\t\t\t\t\tif (idx !== 0) {\n\t\t\t\t\t\tconst fromSegment = segments[idx - 1];\n\t\t\t\t\t\tconst fromCoordinate = fromSegment.coordinates[fromSegment.coordinates.length - 1];\n\t\t\t\t\t\tconst toCoordinate = coordinates[0];\n\t\t\t\t\t\tconst fromPosition = convertCoordinateToPosition(fromCoordinate);\n\t\t\t\t\t\tconst toPosition = convertCoordinateToPosition(toCoordinate);\n\n\t\t\t\t\t\t// Between each path segment create a connection path which will stretch in stacked maps\n\t\t\t\t\t\tconst connectionPath = this.renderer.addPath(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: 'FeatureCollection',\n\t\t\t\t\t\t\t\tfeatures: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\ttype: 'Feature',\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tparentId: fromSegment.floorId,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tgeometry: {\n\t\t\t\t\t\t\t\t\t\t\ttype: 'Point',\n\t\t\t\t\t\t\t\t\t\t\tcoordinates: fromPosition,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\ttype: 'Feature',\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tparentId: floorId,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tgeometry: {\n\t\t\t\t\t\t\t\t\t\t\ttype: 'Point',\n\t\t\t\t\t\t\t\t\t\t\tcoordinates: toPosition,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\toptions,\n\t\t\t\t\t\t\tthis.id,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (connectionPath) {\n\t\t\t\t\t\t\tif (animateDrawing) {\n\t\t\t\t\t\t\t\tthis.renderer.setState<PathState>(connectionPath.id, {\n\t\t\t\t\t\t\t\t\tcompleteFraction: 0,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tacc.push({ ...connectionPath, coordinates: [fromCoordinate, toCoordinate] });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t/**\n\t\t\t\t\t * Sometimes, only a single coordinate of a path exists on a floor. This usually happens just before a connection.\n\t\t\t\t\t * For example, if a path begins at a door on the outdoor map, the path segment outdoors will be a single coord\n\t\t\t\t\t * at the door, and the next path segment will be two coordinates (connecting the door coordinate outdoor to the\n\t\t\t\t\t * door coordinate indoors). If there is only a single coordinate in a path segment, there is nothing to draw.\n\t\t\t\t\t */\n\t\t\t\t\tif (coordinates.length < 2) {\n\t\t\t\t\t\treturn acc;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Create the path for the current floor segment\n\t\t\t\t\tconst pathsLayerId = this.floorsById.get(floorId)?.layers.get(PATHS_LAYER)?.containerId;\n\t\t\t\t\tconst path = this.renderer.addPath(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'FeatureCollection',\n\t\t\t\t\t\t\tfeatures: coordinates.map(coord => ({\n\t\t\t\t\t\t\t\ttype: 'Feature',\n\t\t\t\t\t\t\t\tproperties: {},\n\t\t\t\t\t\t\t\tgeometry: { type: 'Point', coordinates: convertCoordinateToPosition(coord) },\n\t\t\t\t\t\t\t})),\n\t\t\t\t\t\t},\n\t\t\t\t\t\toptions,\n\t\t\t\t\t\t// attempt to add to the floor's paths layer\n\t\t\t\t\t\t// if pathsLayerId is not found, then the floorId is probably 'root'\n\t\t\t\t\t\tpathsLayerId ?? floorId,\n\t\t\t\t\t);\n\n\t\t\t\t\tif (path) {\n\t\t\t\t\t\tif (animateDrawing) {\n\t\t\t\t\t\t\tthis.renderer.setState<PathState>(path.id, {\n\t\t\t\t\t\t\t\tcompleteFraction: 0,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tacc.push({ ...path, coordinates });\n\t\t\t\t\t}\n\n\t\t\t\t\treturn acc;\n\t\t\t\t},\n\t\t\t\t[],\n\t\t\t);\n\n\t\t\tif (animateDrawing) {\n\t\t\t\tconst tweens: Tween[] = [];\n\t\t\t\tconst mapData = this.api.getMapData();\n\n\t\t\t\tpaths.forEach(path => {\n\t\t\t\t\tconst shouldAnimate = shouldAnimatePathDrawing(path, mapData!, this.api);\n\n\t\t\t\t\ttweens.push(\n\t\t\t\t\t\tnew Tween({ fraction: 0.0 })\n\t\t\t\t\t\t\t// do not animate if the floor is not visible\n\t\t\t\t\t\t\t.to({ fraction: 1.0 }, shouldAnimate ? options?.drawDuration ?? 1500 : 0)\n\t\t\t\t\t\t\t.onUpdate(value => {\n\t\t\t\t\t\t\t\tthis.renderer.setState<PathState>(path.id, {\n\t\t\t\t\t\t\t\t\tcompleteFraction: value.fraction,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t});\n\n\t\t\t\ttweens.forEach((tween, index) => {\n\t\t\t\t\tif (index < tweens.length - 1) {\n\t\t\t\t\t\ttween.chain(tweens[index + 1]);\n\t\t\t\t\t}\n\t\t\t\t\tthis.renderer.getInternalTweenGroup().add(tween);\n\t\t\t\t});\n\n\t\t\t\ttweens[0].start();\n\n\t\t\t\tthis.renderer.render();\n\t\t\t\tthis.animations.set(paths[0].id.toString(), tweens[0]);\n\n\t\t\t\treturn {\n\t\t\t\t\tpaths,\n\t\t\t\t\tanimation: tweenToPromise(tweens[tweens.length - 1]).then(() => {\n\t\t\t\t\t\tthis.animations.delete(paths[0].id.toString());\n\t\t\t\t\t}),\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn {\n\t\t\t\t\tpaths,\n\t\t\t\t\tanimation: Promise.resolve(),\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\t\tremove: (entityIds: string[]) => {\n\t\t\tentityIds.forEach(id => {\n\t\t\t\tthis.cancelAnimation(id);\n\t\t\t\tthis.renderer.remove(id);\n\t\t\t});\n\t\t},\n\t};\n\n\t#multiFloorView: Required<TMultiFloorViewOptions> = {\n\t\tenabled: false,\n\t\tfloorGap: 'auto',\n\t\tupdateCameraElevationOnFloorChange: true,\n\t};\n\n\tconstructor(\n\t\tid: string,\n\t\tmapDataInternal: MapDataInternal | undefined,\n\t\toptions: TShow3DMapOptions | undefined,\n\t\tapi: GeoJsonApi,\n\t) {\n\t\tsuper();\n\t\tthis.renderer = api.core;\n\t\tthis.api = api;\n\t\tthis.id = id;\n\t\tthis.renderer.addGroupContainer(id, {}, 'root');\n\t\tthis.options = options ?? {};\n\t\tthis.mvf = mapDataInternal?.mvf ?? ({} as ParsedMVF);\n\t\tconst styleMap = extractStyleMap(this.mvf['styles.json'] || {});\n\t\tthis.styleMap = styleMap;\n\t\tthis.#multiFloorView = {\n\t\t\tenabled: false,\n\t\t\tfloorGap: 'auto',\n\t\t\tupdateCameraElevationOnFloorChange: true,\n\t\t\t...options?.multiFloorView,\n\t\t};\n\n\t\tif (!mapDataInternal) {\n\t\t\tif (this.id !== 'outdoors-container') {\n\t\t\t\tLogger.warn(`Map (${this.id}) created with no data.`);\n\t\t\t}\n\n\t\t\tconst defaultStack = new FloorStackObject(\n\t\t\t\t{\n\t\t\t\t\tid: 'default-stack',\n\t\t\t\t\texternalId: 'default-stack',\n\t\t\t\t\tname: 'Default Stack',\n\t\t\t\t\tmaps: ['default-floor'],\n\t\t\t\t},\n\t\t\t\tthis.id,\n\t\t\t\tthis.renderer,\n\t\t\t);\n\t\t\tthis.floorStacksById.set(defaultStack.id, defaultStack);\n\t\t\tthis.currentFloorStackId = defaultStack.id;\n\t\t\tconst defaultFloor = new FloorObject(\n\t\t\t\tdefaultStack.id,\n\t\t\t\t{\n\t\t\t\t\tid: 'default-floor',\n\t\t\t\t\texternalId: 'default-floor',\n\t\t\t\t\tname: 'Default Floor',\n\t\t\t\t\televation: 0,\n\t\t\t\t},\n\t\t\t\tthis,\n\t\t\t\tthis.#multiFloorView,\n\t\t\t\toptions ?? {},\n\t\t\t);\n\t\t\tthis.floorsById.set(defaultFloor.id, defaultFloor);\n\t\t\tdefaultStack.addFloor(defaultFloor);\n\t\t\tthis.setFloor(defaultFloor.id);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst floorStacks = mapDataInternal.getMVFFeatureByType('floor-stack');\n\t\tif (floorStacks == null || floorStacks.length === 0) {\n\t\t\tthrow new MappedinError('MVF does not contain any Floor Stacks.');\n\t\t}\n\n\t\tfor (const floorStack of floorStacks) {\n\t\t\tconst floorStackInternal = new FloorStackObject(\n\t\t\t\tfloorStack,\n\t\t\t\tthis.id,\n\t\t\t\tthis.renderer,\n\t\t\t\tthis.mvf['facade']?.[floorStack.id],\n\t\t\t);\n\t\t\tfor (const floorId of floorStackInternal.floorIds) {\n\t\t\t\tconst floor = mapDataInternal.getMVFFeatureById('floor', floorId);\n\n\t\t\t\tif (floor != null) {\n\t\t\t\t\tconst floorObject = new FloorObject(\n\t\t\t\t\t\tfloorStackInternal.id,\n\t\t\t\t\t\tfloor,\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\tthis.#multiFloorView,\n\t\t\t\t\t\toptions ?? {},\n\t\t\t\t\t\tthis.mvf,\n\t\t\t\t\t\tstyleMap,\n\t\t\t\t\t\tmapDataInternal,\n\t\t\t\t\t);\n\t\t\t\t\tthis.floorsById.set(floorObject.id, floorObject);\n\t\t\t\t\tfloorStackInternal.addFloor(floorObject);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (floorStackInternal.floorObjects.length < 1) {\n\t\t\t\t// We don't currently support a floor stack with no floors. Downstream logic expects this to exist\n\t\t\t\tLogger.warn(`Floor stack ${floorStack.id} has no floors. It will not be loaded.`);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.floorStacksById.set(floorStack.id, floorStackInternal);\n\t\t\tif (!this.currentFloorStackId) {\n\t\t\t\tthis.currentFloorStackId = floorStack.id;\n\t\t\t}\n\t\t\tthis.floorStackAltitudeMap.set(\n\t\t\t\tfloorStack.id,\n\t\t\t\tcomputeFloorAltitudes(floorStackInternal.floorObjects, this.#multiFloorView.floorGap),\n\t\t\t);\n\t\t}\n\n\t\tfor (const [spaceId] of Object.entries(mapDataInternal.facadesBySpaceId)) {\n\t\t\t// We can assume that the facade space is rendered outdoors\n\t\t\t// We need to keep track of these floor stacks and keep them visible\n\t\t\tconst space = mapDataInternal.getById('space', spaceId);\n\t\t\tif (space) {\n\t\t\t\tthis.outdoorFloorStacks.add(space.floor.floorStack.id);\n\t\t\t\tthis.floorsById.get(space.floor.id)?.setVisible(true);\n\t\t\t}\n\t\t}\n\n\t\tlet floorId = this.mvf.enterprise?.venue.defaultMap;\n\n\t\tif (options?.initialFloor) {\n\t\t\tconst pickedFloor = getId(options.initialFloor);\n\t\t\tif (pickedFloor && this.floorsById.has(pickedFloor)) {\n\t\t\t\tfloorId = pickedFloor;\n\t\t\t} else {\n\t\t\t\tLogger.error(`Invalid initial floor specified (${options.initialFloor}), using default behavior instead`);\n\t\t\t}\n\t\t}\n\n\t\tif (!floorId) {\n\t\t\t// If no floorId is provided, use the default floor of the first floor stack\n\t\t\tfloorId = this.currentFloorStack.defaultFloor.id;\n\t\t}\n\n\t\tthis.startingFloorId = floorId;\n\t}\n\n\tloadAllFloors() {\n\t\tfor (const floorStack of this.floorStacksById.values()) {\n\t\t\tfloorStack.loadAllFloors();\n\n\t\t\t// We get the corresponding floor to the space and use the floor's data to calculate the altitude and height\n\t\t\t// Currently, this works since the space altitude are incrementally increasing by the same amount since we are\n\t\t\t// using a default altitude for all spaces. When the mvf export correctly exports the altitude for each space, we can\n\t\t\t// remove this logic and use the space's altitude and height directly.\n\t\t\tlet altitudeData = this.floorStackAltitudeMap.get(floorStack.id);\n\t\t\tfloorStack.facade?.spaces.forEach(space => {\n\t\t\t\tlet spaceStyle = this.styleMap[space.spaceId] as any;\n\t\t\t\tif (spaceStyle && spaceStyle.altitude >= 0) {\n\t\t\t\t\tlet spaceAltitudeData = altitudeData?.get(spaceStyle.altitude / 2);\n\t\t\t\t\tif (spaceAltitudeData) {\n\t\t\t\t\t\tthis.renderer.setState(space.spaceId, {\n\t\t\t\t\t\t\taltitude: spaceAltitudeData.altitude,\n\t\t\t\t\t\t\theight: spaceAltitudeData.effectiveHeight,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n\nfunction labelSpace(\n\tcore: RendererCore,\n\tspace: Space,\n\tcontent?: string,\n\toptions?: TAddText3DOptions,\n): EntityId<Text3DState> | undefined {\n\treturn core.labelText3D(space.id, content ?? space.name, { ...options, parentId: space.floor.id });\n}\nexport type Text3DInfo = {\n\ttarget: Space;\n\ttextInfo: EntityId<Text3DState>;\n};\n", "import type {\n\tEntranceCollection,\n\tObstructionCollection,\n\tSpaceCollection,\n\tPolygon,\n\tMultiPolygon,\n\tFeatureCollection,\n\tPolygonStyle,\n\tLineStringStyle,\n\tFloorProperties as MVFFloor,\n\tFloorImageFeatureCollection,\n\tParsedMVF,\n\tFeature,\n\tFloorTextFeatureCollection,\n\tSpaceProperties,\n\tLineString,\n\tPoint,\n\tAreaCollection,\n} from '@mappedin/mvf-v2';\nimport type { GeometryState, RendererCore, LineStyle, GroupContainerState, BBox } from '@mappedin/core-sdk';\nimport type { AggregatedStyleMap, WithId } from './utils';\nimport {\n\ttranslateToCoreStyle,\n\tcutEntrancesFromLineStrings,\n\tgroupGeometryByStyle,\n\tgetBoundingBox,\n\tgenerateImageId,\n\tparseFloorGap,\n} from './utils';\nimport type { TShow3DMapOptions } from '..';\nimport {\n\tAREAS_LAYER,\n\tEXTERIOR_DOORS_ID,\n\tEXTERIOR_WALLS_ID,\n\tFACADES_LAYER,\n\tFOOTPRINT_LAYER,\n\tGEOMETRY_LAYER,\n\tIMAGES_LAYER,\n\tINTERIOR_DOORS_ID,\n\tLABELS_LAYER,\n\tMARKERS_LAYER,\n\tOCCLUSION_LAYER,\n\tPATHS_LAYER,\n\tWALLS_ID,\n} from '../constants';\nimport { randomId } from '../utils';\nimport { Logger } from '@packages/internal/common';\nimport { Coordinate, type MapDataInternal } from '../map-data-objects';\nimport type { GeojsonApiMapObject } from './map-object';\n\ntype LineStringStyleWithTopColor = Omit<LineStringStyle, 'lineStrings'> & {\n\tid?: string;\n\ttopColor?: string;\n};\n\nconst DEFAULT_WALL_STYLE: LineStringStyleWithTopColor = {\n\taltitude: 0,\n\theight: 1,\n\tcolor: '#ffffff',\n\topacity: 1,\n\twidth: 0.15,\n};\n\nconst DEFAULT_DOOR_STYLE = {\n\topacity: 0.25,\n\tcolor: '#a7d1ec',\n\theight: 0.8,\n\twidth: 0.05,\n\taltitude: 0.1,\n\tcap: 'square' as LineStyle['cap'],\n\tvisible: false,\n};\n\nconst DEFAULT_AREA_STYLE = {\n\tcolor: 'red',\n\topacity: 0.2,\n\theight: DEFAULT_WALL_STYLE.height + 0.1,\n\tvisible: true,\n\tborderVisible: false,\n};\n\nconst MIN_DOOR_HEIGHT = 0.5;\n\nclass Layer {\n\tcontainerId: string;\n\tlayers: Map<string, string>;\n\trenderer: RendererCore;\n\tconstructor(renderer: RendererCore, containerId: string, layers = new Map()) {\n\t\tthis.containerId = containerId;\n\t\tthis.layers = layers;\n\t\tthis.renderer = renderer;\n\t}\n\n\tget visible() {\n\t\treturn this.renderer.getState<GroupContainerState>(this.containerId).visible;\n\t}\n\n\tsetVisible(visible: boolean) {\n\t\tthis.renderer.setState<GroupContainerState>(this.containerId, {\n\t\t\tvisible,\n\t\t});\n\t}\n}\n\nlet imageIdx = 0;\n\nexport class FloorObject implements MVFFloor {\n\tid: string;\n\tname?: string;\n\televation: number;\n\tmaxHeight?: number;\n\tcontainerId: string;\n\texternalId: string;\n\tmetadata?: Partial<Record<string, unknown>> | undefined;\n\tshortName?: string | undefined;\n\tsubtitle?: string | undefined;\n\toccluderId?: number;\n\tprivate loaded = false;\n\tprivate styleMap: AggregatedStyleMap = {};\n\tprivate obstructions?: ObstructionCollection;\n\tprivate entrances?: EntranceCollection;\n\tprivate spaces?: SpaceCollection;\n\tprivate floorImages?: FloorImageFeatureCollection;\n\tprivate floorText?: FloorTextFeatureCollection;\n\tprivate areas?: AreaCollection;\n\tprivate renderer: RendererCore;\n\tprivate mapObject: GeojsonApiMapObject;\n\tprivate options: TShow3DMapOptions;\n\tlayers: Map<string, Layer> = new Map();\n\tfootprint?: Feature<Polygon | MultiPolygon | null, MVFFloor>;\n\tfloorStackId: string;\n\tprivate multiFloorView?: Required<TShow3DMapOptions['multiFloorView']>;\n\tprivate mapDataInternal?: MapDataInternal;\n\t/** Map of styleId to array of facadeIds for styling */\n\tfacadesByStyleId: Map<string, string[]> = new Map();\n\t#geoJSONBoundingBox?: BBox;\n\tget geoJSONBoundingBox() {\n\t\tif (this.#geoJSONBoundingBox) {\n\t\t\treturn this.#geoJSONBoundingBox;\n\t\t}\n\n\t\tif (!this.footprint) {\n\t\t\tLogger.warn(`Attempting to get bounding box with no footprint for floor ${this.id}`);\n\n\t\t\treturn undefined;\n\t\t}\n\t\tthis.#geoJSONBoundingBox = getBoundingBox(this.footprint as Feature<Polygon | MultiPolygon, any>);\n\n\t\treturn this.#geoJSONBoundingBox;\n\t}\n\n\tconstructor(\n\t\tparentId: string,\n\t\tfloor: MVFFloor,\n\t\tmapObject: GeojsonApiMapObject,\n\t\tmultiFloorView: Required<TShow3DMapOptions['multiFloorView']>,\n\t\toptions: TShow3DMapOptions,\n\t\tmvf?: ParsedMVF,\n\t\tstyleMap?: AggregatedStyleMap,\n\t\tmapDataInternal?: MapDataInternal,\n\t) {\n\t\tthis.mapObject = mapObject;\n\t\tthis.renderer = mapObject.renderer;\n\t\tthis.id = floor.id;\n\t\tthis.options = options;\n\t\tconst floorContainer = this.renderer.addGroupContainer(\n\t\t\tthis.id,\n\t\t\t{\n\t\t\t\tvisible: false,\n\t\t\t\tinteractive: true,\n\t\t\t\tpreloadGeometry: options.preloadFloors?.map(f => f.id).includes(floor.id),\n\t\t\t},\n\t\t\tparentId,\n\t\t);\n\t\tthis.containerId = floorContainer.id.toString();\n\t\tthis.externalId = floor.externalId;\n\t\tthis.metadata = floor.metadata;\n\t\tthis.shortName = floor.shortName;\n\t\tthis.subtitle = floor.subtitle;\n\t\tthis.name = floor.name;\n\t\tthis.maxHeight = floor.maxHeight;\n\t\tthis.elevation = floor.elevation;\n\t\tif (mvf != null && styleMap != null) {\n\t\t\tthis.styleMap = styleMap;\n\t\t\tthis.spaces = mvf.space[this.id]!;\n\t\t\tthis.entrances = mvf.entrance[this.id]!;\n\t\t\tthis.areas = mvf.area?.[this.id];\n\t\t\tthis.obstructions = mvf.obstruction[this.id]!;\n\t\t\tthis.floorImages = mvf.floorImages?.[this.id];\n\t\t\tthis.floorText = mvf.enterprise?.floorText?.[this.id];\n\t\t\tthis.footprint = mvf['floor.geojson']?.features.find(f => f.properties.id === floor.id);\n\t\t}\n\t\tthis.floorStackId = parentId;\n\t\tthis.multiFloorView = multiFloorView;\n\t\tthis.mapDataInternal = mapDataInternal;\n\t}\n\n\tload = () => {\n\t\tif (this.loaded) {\n\t\t\treturn this;\n\t\t}\n\t\tif (\n\t\t\tthis.footprint?.geometry == null &&\n\t\t\tthis.obstructions?.features.length === 0 &&\n\t\t\tthis.spaces?.features.length === 0\n\t\t) {\n\t\t\t// floors with no spaces/obstructions are valid in mvf\n\t\t\t// lets warn but allow it to load and render whatever we have\n\t\t\tLogger.warn(`Floor ${this.id} exists in the data but contains no geometry.`);\n\t\t}\n\t\tthis.loaded = true;\n\n\t\tconst labelsLayer = this.renderer.addGroupContainer(`${LABELS_LAYER}-${this.id}`, {}, this.id);\n\t\tthis.layers.set(LABELS_LAYER, new Layer(this.renderer, labelsLayer.id.toString()));\n\n\t\tconst markersLayer = this.renderer.addGroupContainer(`${MARKERS_LAYER}-${this.id}`, {}, this.id);\n\t\tthis.layers.set(MARKERS_LAYER, new Layer(this.renderer, markersLayer.id.toString()));\n\n\t\tconst allGeometry = this.renderer.addGroupContainer(`${GEOMETRY_LAYER}-${this.id}`, {}, this.id);\n\t\tthis.layers.set(GEOMETRY_LAYER, new Layer(this.renderer, allGeometry.id.toString()));\n\n\t\tconst pathsContainer = this.renderer.addGroupContainer(`${PATHS_LAYER}-${this.id}`, {}, this.id);\n\t\tthis.layers.set(PATHS_LAYER, new Layer(this.renderer, pathsContainer.id.toString()));\n\n\t\tconst floorAltitudes = this.mapObject.getFloorStackAltitudeData(this.floorStackId);\n\n\t\tif (this.footprint?.geometry != null && this.footprint?.geometry.coordinates.length !== 0) {\n\t\t\tlet style = DEFAULT_WALL_STYLE;\n\t\t\tif (this.obstructions != null && this.obstructions.features.length > 0) {\n\t\t\t\tconst exteriorWallFeatures = this.obstructions.features.filter(\n\t\t\t\t\tf =>\n\t\t\t\t\t\tf.geometry.type === 'LineString' &&\n\t\t\t\t\t\tf.properties.kind?.toLowerCase() === 'wall' &&\n\t\t\t\t\t\tf.properties.footprintComponent === true,\n\t\t\t\t);\n\n\t\t\t\tif (exteriorWallFeatures != null && exteriorWallFeatures.length > 0) {\n\t\t\t\t\tstyle = this.styleMap[exteriorWallFeatures[0].properties?.id] as WithId<LineStringStyle>;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst footprintGroup = this.renderer.addGeometryGroup(\n\t\t\t\t`Footprint-${this.id}`,\n\t\t\t\t{\n\t\t\t\t\tfeatures: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgeometry: this.footprint.geometry,\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tid: `Footprint-Floor-${this.id}`,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t} as any,\n\t\t\t\t{\n\t\t\t\t\t...style,\n\t\t\t\t\theight:\n\t\t\t\t\t\tfloorAltitudes.get(this.elevation)?.effectiveHeight ??\n\t\t\t\t\t\tparseFloorGap(this.multiFloorView?.floorGap, this.maxHeight),\n\t\t\t\t\taltitude: 0,\n\t\t\t\t\toutline: this.options.style?.outlines ?? true,\n\t\t\t\t\tvisible: false,\n\t\t\t\t\topacity: this.elevation < 0 ? 1 : 0.4,\n\t\t\t\t\t// we want back-facing material for underground floors\n\t\t\t\t\t// and front-facing material for above-ground floors\n\t\t\t\t\tside: this.elevation < 0 ? 'back' : 'front',\n\t\t\t\t\tcolor: this.elevation < 0 ? '#F0EEE8' : style.color,\n\t\t\t\t\trenderOrder: 2,\n\t\t\t\t},\n\t\t\t\tthis.id,\n\t\t\t);\n\n\t\t\tthis.layers.set(FOOTPRINT_LAYER, new Layer(this.renderer, footprintGroup.id.toString()));\n\t\t}\n\n\t\tif (this.spaces != null && this.spaces.features.length > 0) {\n\t\t\tconst spaceFeatures: Feature<Polygon | LineString | Point, SpaceProperties>[] = [];\n\t\t\tconst facadeSpaceGroups = new Map<string, Feature<Polygon | LineString | Point, SpaceProperties>[]>();\n\n\t\t\tthis.spaces.features\n\t\t\t\t.filter(space => space.geometry.type === 'Polygon' && space.properties.kind?.toLowerCase() !== 'void')\n\t\t\t\t.forEach(space => {\n\t\t\t\t\tconst facade = this.mapDataInternal?.facadesBySpaceId[space.properties.id];\n\t\t\t\t\tif (facade) {\n\t\t\t\t\t\t// If space is part of a facade it will be processed in its own group\n\t\t\t\t\t\tconst group = facadeSpaceGroups.get(facade.id) || [];\n\t\t\t\t\t\tfacadeSpaceGroups.set(facade.id, [...group, space]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tspaceFeatures.push(space);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\tconst spaceStyleGroups = groupGeometryByStyle(spaceFeatures, this.styleMap);\n\n\t\t\tconst spaces = this.renderer.addGroupContainer(`spaces-${this.id}`, {}, allGeometry);\n\t\t\tlet index = 0;\n\n\t\t\tfor (const [style, features] of spaceStyleGroups) {\n\t\t\t\tconst group = this.renderer.addGeometryGroup(\n\t\t\t\t\t`Spaces-${this.id}-${index}`,\n\t\t\t\t\t{\n\t\t\t\t\t\tfeatures,\n\t\t\t\t\t} as FeatureCollection<Polygon, any>,\n\t\t\t\t\ttranslateToCoreStyle(style as PolygonStyle, this.options),\n\t\t\t\t\tspaces,\n\t\t\t\t);\n\n\t\t\t\tindex++;\n\t\t\t\tconst groupId = spaces.id.toString();\n\t\t\t\tthis.layers.get(GEOMETRY_LAYER)!.layers.set(style.id || groupId, group.id.toString());\n\t\t\t}\n\n\t\t\tif (facadeSpaceGroups.size > 0) {\n\t\t\t\tconst facadesLayer = this.renderer.addGroupContainer(`${FACADES_LAYER}-${this.id}`, {}, this.id);\n\t\t\t\tthis.layers.set(FACADES_LAYER, new Layer(this.renderer, facadesLayer.id.toString()));\n\n\t\t\t\tfor (const [facadeId, features] of facadeSpaceGroups) {\n\t\t\t\t\t// Wrap the facade geometry in a layer that is focusable. When we change the visibility of the geometry,\n\t\t\t\t\t// we want to keep this container visible so it can be raycasted.\n\t\t\t\t\tconst facadeContainer = this.renderer.addGroupContainer(facadeId, { focusable: true }, facadesLayer);\n\t\t\t\t\tconst facadeGeometryLayer = this.renderer.addGroupContainer(`${facadeId}-geometry`, {}, facadeContainer);\n\t\t\t\t\tconst spaceFacadeStyleGroups = groupGeometryByStyle(features, this.styleMap);\n\t\t\t\t\tlet index = 0;\n\t\t\t\t\tfor (const [style, features] of spaceFacadeStyleGroups) {\n\t\t\t\t\t\tconst geometry = this.renderer.addGeometryGroup(\n\t\t\t\t\t\t\t`Facades-${this.id}-${facadeId}-${index}`,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfeatures,\n\t\t\t\t\t\t\t} as FeatureCollection<Polygon, any>,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t...translateToCoreStyle(style as PolygonStyle, this.options),\n\t\t\t\t\t\t\t\trenderOrder: 3, // Facades need to render above other geometry to prevent opacity fighting\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfacadeGeometryLayer,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tindex++;\n\n\t\t\t\t\t\tconst groupId = style.id || geometry.id.toString();\n\t\t\t\t\t\t// Facades can contain and share multiple styleIds\n\t\t\t\t\t\t// Use a composite key for looking up the styleId of a specific facade\n\t\t\t\t\t\tthis.layers.get(FACADES_LAYER)!.layers.set(`${facadeId}-${groupId}`, geometry.id.toString());\n\t\t\t\t\t\t// Store the array of facadeIds for a given styleId\n\t\t\t\t\t\tif (!this.facadesByStyleId.has(groupId)) {\n\t\t\t\t\t\t\tthis.facadesByStyleId.set(groupId, [facadeId]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.facadesByStyleId.get(groupId)?.push(facadeId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.obstructions != null && this.obstructions.features.length > 0) {\n\t\t\tconst objectFeatures = this.obstructions.features.filter(\n\t\t\t\tf =>\n\t\t\t\t\tf.geometry.type === 'Polygon' &&\n\t\t\t\t\t(f.properties.kind === 'object' ||\n\t\t\t\t\t\t// MVF v3 downconversion is incorrectly typing objects as type \"unknown\"\n\t\t\t\t\t\t// TODO: Remove this when it's fixed in MVF and we can regenerate all MVFs\n\t\t\t\t\t\tf.properties.kind === 'unknown'),\n\t\t\t);\n\n\t\t\tconst objectStyleGroups = groupGeometryByStyle(objectFeatures, this.styleMap);\n\n\t\t\tconst objects = this.renderer.addGroupContainer(`objects-${this.id}`, {}, allGeometry);\n\t\t\tlet index = 0;\n\t\t\tfor (const [style, features] of objectStyleGroups) {\n\t\t\t\tconst group = this.renderer.addGeometryGroup(\n\t\t\t\t\t`Objects-${this.id}-${index}`,\n\t\t\t\t\t{\n\t\t\t\t\t\tfeatures,\n\t\t\t\t\t} as FeatureCollection<Polygon, any>,\n\t\t\t\t\ttranslateToCoreStyle(style as PolygonStyle, this.options),\n\t\t\t\t\tobjects,\n\t\t\t\t);\n\t\t\t\tindex++;\n\t\t\t\tconst groupId = objects.id.toString();\n\t\t\t\tthis.layers.get(GEOMETRY_LAYER)!.layers.set(style.id || groupId, group.id.toString());\n\t\t\t}\n\n\t\t\tconst wallFeatures = this.obstructions.features.filter(\n\t\t\t\tf =>\n\t\t\t\t\tf.geometry.type === 'LineString' &&\n\t\t\t\t\tf.properties.kind?.toLowerCase() === 'wall' &&\n\t\t\t\t\tf.properties.footprintComponent === false,\n\t\t\t);\n\t\t\tconst exteriorWallFeatures = this.obstructions.features.filter(\n\t\t\t\tf =>\n\t\t\t\t\tf.geometry.type === 'LineString' &&\n\t\t\t\t\tf.properties.kind?.toLowerCase() === 'wall' &&\n\t\t\t\t\tf.properties.footprintComponent === true,\n\t\t\t);\n\n\t\t\tconst entrances = this.entrances;\n\t\t\tlet wallStyle = DEFAULT_WALL_STYLE;\n\t\t\tlet exteriorWallStyle = DEFAULT_WALL_STYLE;\n\n\t\t\tif (wallFeatures != null && wallFeatures.length > 0) {\n\t\t\t\tconst style = this.styleMap[wallFeatures[0].properties?.id] as WithId<LineStringStyle>;\n\t\t\t\tif (style != null) {\n\t\t\t\t\twallStyle = { ...style };\n\t\t\t\t}\n\t\t\t\texteriorWallStyle = wallStyle; // exterior walls default to interior wall style\n\n\t\t\t\tconst { walls, entrances: entrancesCollection } = cutEntrancesFromLineStrings(\n\t\t\t\t\twallFeatures,\n\t\t\t\t\tentrances?.features || [],\n\t\t\t\t);\n\n\t\t\t\tconst doorHeight = Math.max(wallStyle.height - 0.11, MIN_DOOR_HEIGHT);\n\t\t\t\tconst doorStyle = { ...DEFAULT_DOOR_STYLE, height: doorHeight };\n\t\t\t\tconst interiorDoors = this.renderer.addGeometryGroup(\n\t\t\t\t\t`InteriorDoors-${this.id}`,\n\t\t\t\t\tentrancesCollection,\n\t\t\t\t\tdoorStyle,\n\t\t\t\t\tallGeometry,\n\t\t\t\t);\n\t\t\t\tthis.layers.get(GEOMETRY_LAYER)!.layers.set(INTERIOR_DOORS_ID, interiorDoors.id.toString());\n\n\t\t\t\tconst interiorWalls = this.renderer.addGeometryGroup(\n\t\t\t\t\t`Walls-${this.id}`,\n\t\t\t\t\t{\n\t\t\t\t\t\tfeatures: [walls],\n\t\t\t\t\t} as any,\n\t\t\t\t\ttranslateToCoreStyle(wallStyle as LineStringStyle, this.options),\n\t\t\t\t\tallGeometry,\n\t\t\t\t);\n\n\t\t\t\tthis.layers.get(GEOMETRY_LAYER)!.layers.set(WALLS_ID, interiorWalls.id.toString());\n\t\t\t}\n\t\t\tif (exteriorWallFeatures != null && exteriorWallFeatures.length > 0) {\n\t\t\t\tconst style = this.styleMap[exteriorWallFeatures[0].properties?.id] as WithId<LineStringStyle>;\n\t\t\t\tif (style != null) {\n\t\t\t\t\texteriorWallStyle = { ...style, id: EXTERIOR_WALLS_ID };\n\t\t\t\t}\n\n\t\t\t\tconst { walls, entrances: entrancesCollection } = cutEntrancesFromLineStrings(\n\t\t\t\t\texteriorWallFeatures,\n\t\t\t\t\tentrances?.features || [],\n\t\t\t\t);\n\t\t\t\tconst doorHeight = Math.max(exteriorWallStyle.height - 0.11, MIN_DOOR_HEIGHT);\n\t\t\t\tconst doorStyle = { ...DEFAULT_DOOR_STYLE, height: doorHeight };\n\t\t\t\tconst exteriorDoors = this.renderer.addGeometryGroup(\n\t\t\t\t\t`ExteriorDoors-${this.id}`,\n\t\t\t\t\tentrancesCollection,\n\t\t\t\t\tdoorStyle,\n\t\t\t\t\tallGeometry,\n\t\t\t\t);\n\n\t\t\t\tthis.layers.get(GEOMETRY_LAYER)!.layers.set(EXTERIOR_DOORS_ID, exteriorDoors.id.toString());\n\n\t\t\t\tconst exteriorWalls = this.renderer.addGeometryGroup(\n\t\t\t\t\t`ExteriorWalls-${this.id}`,\n\t\t\t\t\t{\n\t\t\t\t\t\tfeatures: [walls],\n\t\t\t\t\t} as any,\n\t\t\t\t\ttranslateToCoreStyle(exteriorWallStyle as LineStringStyle, this.options),\n\t\t\t\t\tallGeometry,\n\t\t\t\t);\n\t\t\t\tthis.layers.get(GEOMETRY_LAYER)!.layers.set(EXTERIOR_WALLS_ID, exteriorWalls.id.toString());\n\t\t\t}\n\t\t}\n\n\t\t// load floating images for floor\n\t\tif (this.floorImages != null) {\n\t\t\tconst imageContainer = this.renderer.addGroupContainer(`images-${this.id}`, {}, this.id);\n\t\t\tfor (const feature of this.floorImages.features || []) {\n\t\t\t\t// only process floating images\n\t\t\t\tif (\n\t\t\t\t\t!(\n\t\t\t\t\t\t'anchorId' in feature.properties ||\n\t\t\t\t\t\t('anchorId' in feature.properties && feature.properties?.anchorId == null)\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\t/**\n\t\t\t\t\t * WARNING:This generated id is used to associate images with compat invisible polygon images.\n\t\t\t\t\t * Do not change this without updating the logic in compat!\n\t\t\t\t\t *\n\t\t\t\t\t * We use the same hashing function along with a unique index to ensure that the id is unique.\n\t\t\t\t\t * the index is unique per venue.\n\t\t\t\t\t */\n\t\t\t\t\tconst id = generateImageId(feature, imageIdx);\n\t\t\t\t\tthis.mapObject.api.Image3D.add(\n\t\t\t\t\t\tnew Coordinate({\n\t\t\t\t\t\t\tlatitude: feature.geometry.coordinates[1],\n\t\t\t\t\t\t\tlongitude: feature.geometry.coordinates[0],\n\t\t\t\t\t\t\tfloorId: this.id,\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tfeature.properties.path,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\tflipImageToFaceCamera: this.options.flipImagesToFaceCamera ?? true,\n\t\t\t\t\t\t\t...feature.properties,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\n\t\t\t\t\timageIdx++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.layers.set(IMAGES_LAYER, new Layer(this.renderer, imageContainer.id.toString()));\n\t\t}\n\n\t\tif (this.floorText != null) {\n\t\t\tfor (const feature of this.floorText.features || []) {\n\t\t\t\tlet verticalOffset = 0;\n\t\t\t\tif ('geometryId' in feature.properties) {\n\t\t\t\t\tverticalOffset = this.renderer.getState<GeometryState>(feature.properties.geometryId)?.height ?? 0;\n\t\t\t\t} else {\n\t\t\t\t\tverticalOffset = feature.properties.verticalOffset ?? 0;\n\t\t\t\t}\n\t\t\t\tthis.renderer.addText3D(\n\t\t\t\t\trandomId(),\n\t\t\t\t\t{ ...feature, properties: { ...feature.properties, verticalOffset } },\n\t\t\t\t\t{},\n\t\t\t\t\tthis.id,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (this.areas != null) {\n\t\t\tconst areasLayer = this.renderer.addGroupContainer(`areas-${this.id}`, {}, this.id);\n\t\t\tthis.layers.set(AREAS_LAYER, new Layer(this.renderer, areasLayer.id.toString()));\n\n\t\t\tconst group = this.renderer.addGeometryGroup(\n\t\t\t\t`Areas-${this.id}`,\n\t\t\t\t{\n\t\t\t\t\tfeatures: this.areas.features,\n\t\t\t\t} as FeatureCollection<Polygon, any>,\n\t\t\t\t{\n\t\t\t\t\tcolor: DEFAULT_AREA_STYLE.color,\n\t\t\t\t},\n\t\t\t\tareasLayer,\n\t\t\t);\n\n\t\t\t// TODO: swap over to the styleMap function in the future:\n\t\t\tfor (const feature of this.areas.features || []) {\n\t\t\t\tthis.renderer.setState(feature.properties.id, {\n\t\t\t\t\t...DEFAULT_AREA_STYLE,\n\t\t\t\t\tvisible: false,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.layers.get(AREAS_LAYER)!.layers.set(group.id.toString(), group.id.toString());\n\t\t}\n\n\t\tif (this.multiFloorView?.enabled) {\n\t\t\tthis.renderer.setState(this.id, {\n\t\t\t\taltitude:\n\t\t\t\t\tfloorAltitudes.get(this.elevation)?.altitude ??\n\t\t\t\t\tthis.elevation * parseFloorGap(this.multiFloorView?.floorGap, this.maxHeight),\n\t\t\t});\n\t\t}\n\n\t\tthis.renderer.render();\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * Add an occluder to the floor if it has a footprint.\n\t */\n\taddOccluder() {\n\t\tif (this.footprint?.geometry == null) {\n\t\t\treturn;\n\t\t}\n\t\t// add container so we can show/hide the occluder\n\t\tconst occluderContainer = this.renderer.addGroupContainer(`${OCCLUSION_LAYER}-${this.id}`, {}, this.id);\n\t\tconst occluderLayer = new Layer(this.renderer, occluderContainer.id.toString());\n\t\tthis.layers.set(OCCLUSION_LAYER, occluderLayer);\n\n\t\tthis.occluderId = this.renderer.addOccluder(\n\t\t\tthis.footprint as Feature<Polygon | MultiPolygon, any>,\n\t\t\toccluderLayer.containerId,\n\t\t);\n\t}\n\n\t/**\n\t * Whether the floor contains facade geometry.\n\t */\n\tget hasFacadeGeometry(): boolean {\n\t\treturn this.facadesByStyleId.size > 0;\n\t}\n\n\tget visible() {\n\t\treturn this.renderer.getState<GroupContainerState>(this.containerId).visible;\n\t}\n\n\tsetVisible(visible: boolean) {\n\t\tthis.renderer.setState<GroupContainerState>(this.containerId, {\n\t\t\tvisible,\n\t\t});\n\t}\n}\n", "import type { GeometryState, RendererCore } from '@mappedin/core-sdk';\nimport type { FloorId, FloorStack as MVFFloorStack, Facade as MVFFacade } from '@mappedin/mvf-v2';\nimport { Logger } from '@packages/internal/common';\nimport type { FloorObject } from './floor-object';\nimport { MappedinError } from '@packages/internal/common/errors';\n\nexport class FloorStackObject implements Omit<MVFFloorStack, 'maps' | 'floors' | 'defaultFloor' | 'footprint'> {\n\tid: MVFFloorStack['id'];\n\texternalId: MVFFloorStack['externalId'];\n\tname: MVFFloorStack['name'];\n\ttype: MVFFloorStack['type'];\n\tfloorIds: FloorId[];\n\tdefaultFloorId?: MVFFloorStack['defaultFloor'];\n\n\t/** Sorted floor objects by elevation */\n\tfloorObjects: FloorObject[] = [];\n\tfloorObjectsByElevation: Map<number, FloorObject> = new Map();\n\tmetadata?: MVFFloorStack['metadata'];\n\tcontainerId: string;\n\tfacade?: MVFFacade;\n\n\tprivate renderer: RendererCore;\n\tconstructor(floorStack: MVFFloorStack, parentId: string, renderer: RendererCore, facade?: MVFFacade) {\n\t\tthis.id = floorStack.id;\n\t\tthis.externalId = floorStack.externalId;\n\t\tthis.name = floorStack.name;\n\t\tthis.type = floorStack.type;\n\t\tthis.metadata = floorStack.metadata;\n\t\tthis.floorIds = floorStack.floors ?? floorStack.maps;\n\t\tthis.defaultFloorId = floorStack.defaultFloor;\n\t\tthis.renderer = renderer;\n\t\tconst groupContainer = renderer.addGroupContainer(\n\t\t\tthis.id,\n\t\t\t{\n\t\t\t\tvisible: true,\n\t\t\t\tinteractive: true,\n\t\t\t},\n\t\t\tparentId,\n\t\t);\n\t\tthis.containerId = groupContainer.id.toString();\n\t\tthis.facade = facade;\n\t}\n\n\t#defaultFloorObject?: FloorObject;\n\tget defaultFloor(): FloorObject {\n\t\tif (this.#defaultFloorObject == null) {\n\t\t\tif (this.floorObjects.length === 0) {\n\t\t\t\tthrow new MappedinError(`No floors in floor stack (${this.id}). Could not get default floor.`);\n\t\t\t}\n\n\t\t\tlet defaultFloor: FloorObject | undefined;\n\t\t\tif (this.defaultFloorId) {\n\t\t\t\t// find the floor with the default floor id\n\t\t\t\tdefaultFloor = this.floorObjects.find(floor => floor.id === this.defaultFloorId);\n\t\t\t}\n\n\t\t\tif (!defaultFloor) {\n\t\t\t\t// if no default floor id, find the floor with the elevation closest to 0\n\t\t\t\tdefaultFloor = this.floorObjects.reduce((prev, curr) => {\n\t\t\t\t\treturn Math.abs(curr.elevation) < Math.abs(prev.elevation) ? curr : prev;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.#defaultFloorObject = defaultFloor;\n\t\t}\n\n\t\treturn this.#defaultFloorObject;\n\t}\n\n\t/**\n\t * Whether the floorstack is an outdoor stack.\n\t * This may not be accurate if the type property is incorrect or if the building contains another facade.\n\t *\n\t * A floor stack being outdoors is determined by the following:\n\t * - The type is 'outdoor'\n\t * - It does not have a facade\n\t * - One of the floors contains facades\n\t */\n\tget isOutdoors(): boolean {\n\t\tconst type = this.type?.toLowerCase();\n\t\tif (type === 'outdoor') {\n\t\t\treturn true;\n\t\t}\n\n\t\t// if this floorstack has a facade, it's a building\n\t\tif (this.facade != null) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// if one of the floors has facade geometry, this is probably an outdoor stack\n\t\treturn this.floorObjects.some(floor => floor.hasFacadeGeometry);\n\t}\n\n\taddFloor(floor: FloorObject) {\n\t\tif (this.floorObjectsByElevation.has(floor.elevation)) {\n\t\t\tLogger.error(\n\t\t\t\t`Floor with same elevation ${floor.elevation} already exists in Stack (${this.id}). Floor (${floor.id}) will not be added.`,\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\t\tthis.floorObjects.push(floor);\n\t\tthis.floorObjectsByElevation.set(floor.elevation, floor);\n\t\tif (this.facade) {\n\t\t\t// if this floorstack has a facade, we make floors focusable so they occlude the raycast\n\t\t\tthis.renderer.setState<GeometryState>(floor.containerId, {\n\t\t\t\tfocusable: true,\n\t\t\t});\n\t\t}\n\t}\n\n\tloadAllFloors() {\n\t\tfor (const floor of this.floorObjects) {\n\t\t\tfloor.load();\n\t\t\tif (\n\t\t\t\t// Don't add occluders to outdoor floor stacks, they collide with the lower floors of buildings\n\t\t\t\t!this.isOutdoors &&\n\t\t\t\t// If the floor has facades, it's probably an outdoor enterprise map\n\t\t\t\t!floor.hasFacadeGeometry &&\n\t\t\t\tfloor.footprint != null\n\t\t\t) {\n\t\t\t\tfloor.addOccluder();\n\t\t\t}\n\t\t}\n\t}\n}\n", "import type { Floor } from '../map-data-objects';\nimport type { TFloorState } from '../states';\nimport { parseFloorGap } from './utils';\n\nexport type VisibilityState = {\n\toutdoorOpacity: number;\n\tfloorStates: {\n\t\tfloor?: Floor;\n\t\tstate: TFloorState;\n\t}[];\n};\n\nexport function getMultiFloorState(\n\tfloors: Floor[],\n\tcurrentFloor: Floor,\n\tfloorGap: number | 'auto' = 'auto',\n\tfloorIdsInNavigation: Floor['id'][],\n\tfloorsVisualHeightMap: Map<number, { altitude: number; effectiveHeight: number }> = new Map(),\n): VisibilityState {\n\tconst state: VisibilityState = {\n\t\toutdoorOpacity: 1,\n\t\tfloorStates: [],\n\t};\n\n\tconst sortedFloors = floors.sort((f1, f2) => f1.elevation - f2.elevation);\n\n\t// Check if there's no ground floor (elevation 0)\n\tconst hasGroundFloor = floors.some(floor => floor.elevation === 0);\n\tlet firstNonGroundFloorProcessed = true;\n\n\tfor (const floor of sortedFloors) {\n\t\tconst footprintHeight =\n\t\t\tfloorsVisualHeightMap.get(floor.elevation)?.effectiveHeight ?? parseFloorGap(floorGap, floor.maxHeight);\n\t\tconst currentFloorState = {\n\t\t\tfloor,\n\t\t\tstate: {\n\t\t\t\ttype: 'floor',\n\t\t\t\tvisible: false,\n\t\t\t\tgeometry: {\n\t\t\t\t\tvisible: false,\n\t\t\t\t},\n\t\t\t\tlabels: {\n\t\t\t\t\tenabled: false,\n\t\t\t\t},\n\t\t\t\tmarkers: {\n\t\t\t\t\tenabled: false,\n\t\t\t\t},\n\t\t\t\tfootprint: {\n\t\t\t\t\tvisible: false,\n\t\t\t\t},\n\t\t\t\tocclusion: {\n\t\t\t\t\tenabled: false,\n\t\t\t\t},\n\t\t\t\tareas: {\n\t\t\t\t\tvisible: false,\n\t\t\t\t},\n\t\t\t} as Required<TFloorState>,\n\t\t};\n\t\tstate.floorStates.push(currentFloorState);\n\n\t\tif (floor.id === currentFloor.id) {\n\t\t\tcurrentFloorState.state.visible = true;\n\t\t\tcurrentFloorState.state.geometry.visible = true;\n\t\t\tcurrentFloorState.state.labels.enabled = true;\n\t\t\tcurrentFloorState.state.markers.enabled = true;\n\t\t\tcurrentFloorState.state.occlusion.enabled = true;\n\t\t\tcurrentFloorState.state.areas.visible = true;\n\t\t\tif (floor.elevation < 0) {\n\t\t\t\tcurrentFloorState.state.footprint.height = footprintHeight;\n\t\t\t\tcurrentFloorState.state.footprint.visible = true;\n\t\t\t\tstate.outdoorOpacity = 0.2;\n\t\t\t}\n\t\t} else if (floorIdsInNavigation.includes(floor.id) && floor.elevation < currentFloor.elevation) {\n\t\t\tcurrentFloorState.state.visible = true;\n\t\t\tcurrentFloorState.state.geometry.visible = true;\n\t\t\tcurrentFloorState.state.markers.enabled = true;\n\t\t\tcurrentFloorState.state.occlusion.enabled = true;\n\t\t\tcurrentFloorState.state.footprint.visible = true;\n\t\t\tcurrentFloorState.state.footprint.height = footprintHeight;\n\t\t\tif (floor.elevation < 0) {\n\t\t\t\tstate.outdoorOpacity = 0.2;\n\t\t\t}\n\t\t} else if (currentFloor.elevation > 0 && floor.elevation < currentFloor.elevation && floor.elevation >= 0) {\n\t\t\tcurrentFloorState.state.visible = true;\n\t\t\tcurrentFloorState.state.footprint.visible = true;\n\t\t\tcurrentFloorState.state.footprint.height = footprintHeight;\n\t\t}\n\n\t\t// If we dont have a ground floor, dont make the footprint visible for that floor\n\t\tif (\n\t\t\t!hasGroundFloor &&\n\t\t\tfloor.elevation > 0 &&\n\t\t\tfirstNonGroundFloorProcessed &&\n\t\t\tcurrentFloor.elevation === floor.elevation\n\t\t) {\n\t\t\tfirstNonGroundFloorProcessed = false;\n\t\t\tcurrentFloorState.state.footprint.visible = false;\n\t\t}\n\t}\n\treturn state;\n}\n", "import type { IAnchorable, TAddMarkerOptions, TAnimationOptions } from '../types';\nimport { Marker } from '../map-view-objects';\nimport { convertCoordinateToPosition, getAttachableGeometryId } from './utils';\nimport type { GeojsonApiMapObject } from './map-object';\nimport { Logger } from '@packages/internal/common';\n\n/**\n * ## Markers in Mappedin JS\n *\n * Markers are interactive HTML elements anchored to a {@link Door}, {@link Space}, {@link Coordinate}, or {@link Node} on the map. They automatically rotate and reposition as the camera moves, making them ideal for highlighting points of interest, custom icons, or interactive UI overlays.\n *\n * ### Features\n * - Fully customizable HTML content\n * - Automatic collision management and visibility ranking\n * - Support for interactivity (click, hover, etc.)\n * - Dynamic resizing and animation\n *\n * > **Best Practice:** Use the `rank` option to control marker visibility priority. Use `interactive: true` to enable SDK-level click/hover events, or `'pointer-events-auto'` for native browser pointer events.\n *\n * ### Example Usage\n * ```ts\n * // Add a simple marker\n * mapView.Markers.add(coordinate, '<div>Marker Content</div>', { interactive: true });\n *\n * // Add a marker with custom placement and high priority\n * mapView.Markers.add(space, '<div>Shop</div>', { placement: 'top', rank: 'always-visible' });\n *\n * // Remove a marker\n * mapView.Markers.remove(marker);\n *\n * // Remove all markers\n * mapView.Markers.removeAll();\n *\n * // Move a marker to a new coordinate\n * mapView.Markers.setPosition(marker, newCoordinate);\n *\n * // Animate a marker to a new coordinate\n * mapView.Markers.animateTo(marker, newCoordinate, { duration: 1000 });\n * ```\n *\n * ### Advanced\n * - Dynamic resizing is enabled by default - use `dynamicResize: false` for static content.\n * - Use `zIndex` and `rank: 'always-visible'` to keep important markers on top.\n *\n * ### More Information\n * - [Markers Guide](https://developer.mappedin.com/web-sdk/markers)\n *\n * This class is accessed using {@link MapView.Markers}.\n */\nexport class Markers {\n\t#markersById: Map<string, { marker: Marker; entityId: string }> = new Map();\n\t#getCurrentMap: CurrentMapGetter;\n\t/**\n\t * @internal\n\t */\n\tget currentMap() {\n\t\treturn this.#getCurrentMap();\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor({ currentMapGetter }: { currentMapGetter: CurrentMapGetter }) {\n\t\tthis.#getCurrentMap = currentMapGetter;\n\t}\n\n\tgetAll() {\n\t\treturn Array.from(this.#markersById.values()).map(({ marker }) => marker);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tgetById(id: string) {\n\t\treturn this.#markersById.get(id);\n\t}\n\n\t/**\n\t * Adds a marker to the map.\n\t *\n\t * @param target The target object ({@link IAnchorable}) for the marker (e.g., {@link Space}, {@link Door}, {@link Coordinate}, or {@link Node}).\n\t * @param html The HTML content for the {@link Marker}.\n\t * @param options Optional additional options for the {@link Marker} (see {@link TAddMarkerOptions}).\n\t * @returns {Marker | undefined} The created {@link Marker}, or undefined if creation failed.\n\t *\n\t * @example Add an interactive marker with custom HTML\n\t * ```ts\n\t * mapView.Markers.add(coordinate, '<div>Marker Content</div>', { interactive: true });\n\t * ```\n\t *\n\t * @example Add a marker with high priority and custom placement\n\t * ```ts\n\t * mapView.Markers.add(space, '<div>Shop</div>', { placement: 'top', rank: 'always-visible' });\n\t * ```\n\t *\n\t * @see [Markers Guide](https://developer.mappedin.com/web-sdk/markers)\n\t */\n\tadd(target: IAnchorable, html: string, options?: TAddMarkerOptions): Marker {\n\t\tconst coord = target.anchorTarget;\n\t\tif (!coord) {\n\t\t\tthrow new Error('get coordinate failed');\n\t\t}\n\t\t// @TODO: add layer support\n\t\tconst map = this.currentMap;\n\t\tif (!map) throw new Error('currentMap should exist');\n\t\tconst marker = map.Markers.add(coord, html, {\n\t\t\t...options,\n\t\t\trank: options?.rank || 'medium',\n\t\t\tdynamicResize: options?.dynamicResize ?? true,\n\t\t\tattachTo: getAttachableGeometryId(target),\n\t\t});\n\t\tif (marker == null) {\n\t\t\tthrow new Error('error creating marker');\n\t\t}\n\t\tconst el = map.Markers.getContentEl(marker.id.toString());\n\t\tif (!el) throw new Error('marker component should exist');\n\t\tconst newMarker = new Marker(marker.id.toString(), el, target);\n\t\tthis.#markersById.set(newMarker.id, { marker: newMarker, entityId: marker.id.toString() });\n\n\t\treturn newMarker;\n\t}\n\t/**\n\t * Removes a marker from the map.\n\t *\n\t * @param marker {Marker} The {@link Marker} which should be removed.\n\t * @example\n\t * mapView.Markers.remove(marker);\n\t */\n\tremove(marker: Marker) {\n\t\tconst found = this.#markersById.get(marker.id);\n\t\tif (!found) return;\n\t\tthis.currentMap?.Markers.remove(found.entityId);\n\t\tthis.#markersById.delete(marker.id.toString());\n\t}\n\t/**\n\t * Remove all the markers from the map.\n\t *\n\t * @example\n\t * mapView.Markers.removeAll();\n\t */\n\tremoveAll() {\n\t\tconst removed: Marker[] = [];\n\t\tthis.#markersById.forEach(({ marker }) => {\n\t\t\tthis.remove(marker);\n\t\t\tremoved.push(marker);\n\t\t\tthis.#markersById.delete(marker.id.toString());\n\t\t});\n\n\t\treturn removed;\n\t}\n\t/**\n\t * Update the position of a marker.\n\t * @param marker The {@link Marker} which should be moved.\n\t * @param target The new target object ({@link Space}, {@link Door}, or {@link Coordinate}) for the marker.\n\t * @example\n\t * const marker = mapView.Markers.add(coordinate, '<div>Marker Content</div>');\n\t * mapView.Markers.setPosition(marker, newCoordinate);\n\t */\n\tsetPosition(marker: Marker, target: IAnchorable) {\n\t\tconst coord = target.anchorTarget;\n\t\tif (!coord) {\n\t\t\tLogger.error('Cannot determine coordinate from target.');\n\n\t\t\treturn;\n\t\t}\n\t\tconst map = this.currentMap;\n\t\tif (!map) {\n\t\t\tLogger.error('Cannot determine the current map.');\n\n\t\t\treturn;\n\t\t}\n\t\tconst found = this.#markersById.get(marker.id);\n\t\tif (!found) {\n\t\t\tLogger.error(`Cannot find the Marker with id \"${marker.id}\".`);\n\n\t\t\treturn;\n\t\t}\n\n\t\tmap.Markers.setPosition(found.entityId, convertCoordinateToPosition(coord), coord.floorId ?? map.currentFloorId);\n\t\tfound.marker.updateTarget(target);\n\t}\n\t/**\n\t * Update the position of a marker with an animation.\n\t * @param marker The {@link Marker} which should be updated.\n\t * @param target The new target object ({@link Space}, {@link Door}, or {@link Coordinate}) for the marker.\n\t * @param options Optional additional options for the animation (see {@link TAnimationOptions}).\n\t * @returns {Promise<void>} A promise that resolves when the animation is complete.\n\t * @example\n\t * const marker = mapView.Markers.add(coordinate, '<div>Marker Content</div>');\n\t * mapView.Markers.animateTo(marker, newCoordinate, { duration: 1000 });\n\t */\n\tanimateTo(marker: Marker, target: IAnchorable, options?: TAnimationOptions) {\n\t\tconst coord = target.anchorTarget;\n\t\tif (!coord) {\n\t\t\tLogger.error('Cannot determine coordinate from target.');\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tconst map = this.currentMap;\n\t\tif (!map) {\n\t\t\tLogger.error('Cannot determine the current map.');\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tconst found = this.#markersById.get(marker.id);\n\t\tif (!found) {\n\t\t\tLogger.error(`Cannot find the Marker with id \"${marker.id}\".`);\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tfound.marker.updateTarget(target);\n\n\t\treturn map.Markers.animateTo(\n\t\t\tfound.entityId,\n\t\t\tconvertCoordinateToPosition(coord),\n\t\t\tcoord.floorId ?? map.currentFloorId,\n\t\t\toptions,\n\t\t);\n\t}\n}\ntype CurrentMapGetter = () => GeojsonApiMapObject | undefined;\n", "import type { IAnchorable, TAddImageOptions } from '../types';\nimport { Image3DView } from '../map-view-objects';\nimport { convertCoordinateToPosition } from './utils';\nimport type { GeojsonApiMapObject } from './map-object';\n\n/**\n * ## 3D images in Mappedin JS\n *\n * Images can enhance indoor maps by adding custom branding, highlighting important features, or providing additional visual information. They can be placed on any {@link Door}, {@link Space}, or {@link Coordinate} and support various positioning and styling options.\n *\n * ### Features\n * - Support for JPEG and PNG formats\n * - Automatic caching and reuse of identical URLs\n * - Customizable size, rotation, and vertical offset\n * - Option to face the camera automatically\n * - Memory-efficient rendering\n *\n * > **Best Practice:** Consider image memory usage carefully. The SDK caches images with the same URL, so reuse images when possible. Large images can impact performance on mobile devices.\n *\n * ### Memory Usage Calculation\n * Formula: `width * height * 4 bytes/pixel = memory used`\n * - 512 x 512 Pixel Image: `512px * 512px * 4 bytes/pixel = 1MB`\n * - 4096 x 4096 Pixel Image: `4096px * 4096px * 4 bytes/pixel = 64MB`\n *\n * ### Example Usage\n * ```ts\n * // Add a simple image\n * mapView.Image3D.add(coordinate, 'https://example.com/logo.png', { width: 2, height: 1 });\n *\n * // Add an image with custom positioning\n * mapView.Image3D.add(space, 'https://example.com/banner.jpg', {\n *   width: 3,\n *   height: 1.5,\n *   rotation: 45,\n *   verticalOffset: 2\n * });\n *\n * // Add an image that faces the camera\n * mapView.Image3D.add(coordinate, 'https://example.com/icon.png', {\n *   width: 1,\n *   height: 1,\n *   flipImageToFaceCamera: true\n * });\n *\n * // Remove an image\n * mapView.Images.remove(image);\n *\n * // Remove all images\n * mapView.Images.removeAll();\n * ```\n *\n * ### Advanced\n * - Use `flipImageToFaceCamera: true` for billboard-style images that always face the user.\n * - Use `verticalOffset` to position images above or below the anchor point.\n * - Use `rotation` to orient images in specific directions.\n *\n * ### Performance Tips\n * - Reuse image URLs to take advantage of caching.\n * - Use appropriately sized images for your use case.\n * - Consider using smaller images on mobile devices.\n *\n * ### More Information\n * - [Images Guide](https://developer.mappedin.com/web-sdk/images-textures)\n *\n * This class is accessed using {@link MapView.Image3D}.\n */\nexport class Image3D {\n\t#images: Map<string, { image: Image3DView; entityId: string }> = new Map();\n\t#getCurrentMap: CurrentMapGetter;\n\t/**\n\t * @internal\n\t */\n\tget currentMap() {\n\t\treturn this.#getCurrentMap();\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor({ currentMapGetter }: { currentMapGetter: CurrentMapGetter }) {\n\t\tthis.#getCurrentMap = currentMapGetter;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tgetById(id: string) {\n\t\treturn this.#images.get(id);\n\t}\n\n\t/**\n\t * Adds an image to the map.\n\t *\n\t * @param target The target object ({@link IAnchorable}) for the image (e.g., {@link Space}, {@link Door}, or {@link Coordinate}).\n\t * @param url The URL of the image (JPEG or PNG format).\n\t * @param options Configuration options for the image (see {@link TAddImageOptions}).\n\t * @returns {Image | undefined} The created {@link Image}, or undefined if creation failed.\n\t *\n\t * @example Add a simple image\n\t * ```ts\n\t * mapView.Image3D.add(coordinate, 'https://example.com/logo.png', { width: 2, height: 1 });\n\t * ```\n\t *\n\t * @example Add an image with custom positioning\n\t * ```ts\n\t * mapView.Image3D.add(space, 'https://example.com/banner.jpg', {\n\t *   width: 3,\n\t *   height: 1.5,\n\t *   rotation: 45,\n\t *   verticalOffset: 2\n\t * });\n\t * ```\n\t *\n\t * @example Add a billboard-style image\n\t * ```ts\n\t * mapView.Image3D.add(coordinate, 'https://example.com/icon.png', {\n\t *   width: 1,\n\t *   height: 1,\n\t *   flipImageToFaceCamera: true\n\t * });\n\t * ```\n\t *\n\t * @see [Images Guide](https://developer.mappedin.com/web-sdk/images-textures)\n\t */\n\tadd(target: IAnchorable, url: string, options: TAddImageOptions): Image3DView {\n\t\tconst coord = target.anchorTarget;\n\t\tif (!coord) {\n\t\t\tthrow new Error('Target does not implement IAnchorable.');\n\t\t}\n\t\t// @TODO: add layer support\n\t\tconst map = this.currentMap;\n\t\tif (!map) throw new Error('currentMap should exist');\n\t\tconst entity = map.Image3D.add(convertCoordinateToPosition(coord), url, {\n\t\t\t...options,\n\t\t\tfloorId: coord.floorId,\n\t\t\tverticalOffset: coord.verticalOffset + (options.verticalOffset ?? 0),\n\t\t});\n\n\t\tif (!entity) throw new Error('image component should exist');\n\n\t\tconst newImage = new Image3DView(entity.id.toString(), url, target);\n\t\tthis.#images.set(newImage.id, { image: newImage, entityId: entity.id.toString() });\n\n\t\treturn newImage;\n\t}\n\t/**\n\t * Removes an image from the map.\n\t *\n\t * @param image {Image} The {@link Image} which should be removed.\n\t * @example\n\t * mapView.Images.remove(image);\n\t */\n\tremove(image: Image3DView) {\n\t\tconst found = this.#images.get(image.id);\n\t\tif (!found) return;\n\t\tthis.currentMap?.Image3D.remove(found.entityId);\n\t\tthis.#images.delete(image.id.toString());\n\t}\n\t/**\n\t * Remove all the images from the map.\n\t *\n\t * @returns An array of all removed {@link Image} instances.\n\t * @example\n\t * const removedImages = mapView.Images.removeAll();\n\t */\n\tremoveAll() {\n\t\tconst removed: Image3DView[] = [];\n\t\tthis.#images.forEach(({ image }) => {\n\t\t\tthis.remove(image);\n\t\t\tremoved.push(image);\n\t\t\tthis.#images.delete(image.id.toString());\n\t\t});\n\n\t\treturn removed;\n\t}\n}\ntype CurrentMapGetter = () => GeojsonApiMapObject | undefined;\n", "import type { TAddModelOptions } from '../types';\nimport { Model } from '../map-view-objects';\nimport { randomId } from '../utils';\nimport { Logger } from '@packages/internal/common';\nimport type { CurrentMapGetter } from './types';\nimport type { Coordinate } from '../map-data-objects';\nimport { getTargetFloorObject } from './utils';\n\n/**\n * ## 3D Models in Mappedin JS\n *\n * 3D models can be used to represent landmarks, assets, or furniture, providing a rich and interactive indoor map experience. Mappedin JS supports models in GLTF and GLB formats. **Models with nested meshes are not supported.**\n *\n * ### Supported Formats\n * - GLTF (.gltf)\n * - GLB (.glb)\n * - Inline base64 models (from the Mappedin 3D Assets Library)\n *\n * ### Adding 3D Models\n * Use the `add` method to place a model at a specific {@link Coordinate}.\n *\n * ### Mappedin 3D Assets Library\n * Mappedin provides a library of ready-to-use 3D models for common indoor objects. You can install it via npm:\n *\n * ```bash\n * npm install @mappedin/3d-assets\n * ```\n *\n * - [Mappedin 3D Assets on npm](https://www.npmjs.com/package/@mappedin/3d-assets)\n *\n * #### Usage (Self-hosted GLB files)\n * ```ts\n * const coordinate = mapView.createCoordinate(45, -75);\n * mapView.Models.add(coordinate, 'https://your-domain.com/assets/model.glb');\n * ```\n *\n * #### Usage (Direct base64 imports)\n * ```ts\n * import { bed } from '@mappedin/3d-assets/inline';\n * const coordinate = mapView.createCoordinate(45, -75);\n * mapView.Models.add(coordinate, bed);\n * ```\n *\n * > **Best Practice:** Use self-hosted GLB files for smaller download size and better caching. Use direct imports for convenience and rapid prototyping.\n *\n * ### Performance Tips\n * - Avoid using models with nested meshes.\n *\n * ### More Information\n * - [3D Models Guide](https://developer.mappedin.com/web-sdk/3d-models)\n * - [Mappedin 3D Assets Library](https://www.npmjs.com/package/@mappedin/3d-assets)\n *\n * This class is accessed using {@link MapView.Models}.\n */\nexport class Models {\n\t#models: Map<string, { model: Model; entityId: string; groupId: string }> = new Map();\n\t#getCurrentMap: CurrentMapGetter;\n\t/**\n\t * @internal\n\t */\n\tget currentMap() {\n\t\treturn this.#getCurrentMap();\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor({ currentMapGetter }: { currentMapGetter: CurrentMapGetter }) {\n\t\tthis.#getCurrentMap = currentMapGetter;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tgetById(id: string) {\n\t\treturn this.#models.get(id);\n\t}\n\n\t/**\n\t * Adds a 3D model to the map at the specified coordinate.\n\t *\n\t * @param coordinate - The {@link Coordinate} where the model will be placed.\n\t * @param url - The URL to the GLTF or GLB model file, or an inline base64 encoded 3D asset from the [Mappedin 3D Assets Library](https://www.npmjs.com/package/@mappedin/3d-assets).\n\t * @param options - Configuration options for the model using {@link TAddModelOptions}.\n\t * @returns A {@link Model} instance representing the added 3D model.\n\t *\n\t * @example Add a model from a self-hosted GLB file\n\t * ```ts\n\t * const coordinate = mapView.createCoordinate(45, -75);\n\t * mapView.Models.add(coordinate, 'https://your-domain.com/assets/model.glb', {\n\t *   scale: [1, 1, 1],\n\t *   rotation: [0, 0, 0],\n\t *   interactive: true\n\t * });\n\t * ```\n\t *\n\t * @example Add a model from the Mappedin 3D Assets Library (base64 import)\n\t * ```ts\n\t * import { bed } from '@mappedin/3d-assets/inline';\n\t * const coordinate = mapView.createCoordinate(45, -75);\n\t * mapView.Models.add(coordinate, bed, {\n\t *   scale: [0.5, 0.5, 0.5],\n\t *   rotation: [0, 90, 0],\n\t *   interactive: true\n\t * });\n\t * ```\n\t *\n\t * @see [3D Models Guide](https://developer.mappedin.com/web-sdk/3d-models)\n\t * @see [Mappedin 3D Assets Library](https://www.npmjs.com/package/@mappedin/3d-assets)\n\t */\n\tadd(coordinate: Coordinate, url: string, options?: TAddModelOptions): Model {\n\t\t// Since model position can be updated and models are not really anchored to an object,\n\t\t// they are added directly to a coordinate and not an IAnchorable.\n\t\tconst targets = [coordinate];\n\t\tconst targetsByFloor = targets.reduce((acc, coord) => {\n\t\t\tif (!coord) {\n\t\t\t\tLogger.error('Cannot determine coordinate from options.');\n\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\tconst floorId = getTargetFloorObject(\n\t\t\t\tcoord,\n\t\t\t\tthis.currentMap!.floorsById,\n\t\t\t\tthis.currentMap!.floorsById.get('default-floor')!,\n\t\t\t)?.id;\n\n\t\t\tif (!acc.has(floorId)) {\n\t\t\t\tacc.set(floorId, []);\n\t\t\t}\n\n\t\t\tacc.get(floorId)?.push(coord);\n\n\t\t\treturn acc;\n\t\t}, new Map<string | undefined, Coordinate[]>());\n\n\t\tif (!targets.length) {\n\t\t\tthrow new Error('targets should not be empty when adding a model');\n\t\t}\n\t\t// @TODO: add layer support\n\t\tconst map = this.currentMap;\n\t\tif (!map) throw new Error('currentMap should exist');\n\t\tconst instances: Model[] = [];\n\n\t\ttargetsByFloor.forEach((targets, floorId) => {\n\t\t\tconst groupId = randomId();\n\t\t\tconst newModels = map.Models.add(groupId, targets, {\n\t\t\t\t...options,\n\t\t\t\turl,\n\t\t\t\tfloorId,\n\t\t\t\tverticalOffset: targets[0].verticalOffset + (options?.verticalOffset ?? 0),\n\t\t\t});\n\n\t\t\tnewModels.forEach(id => {\n\t\t\t\tconst newModel = new Model(id.toString(), groupId, targets[0]);\n\t\t\t\tthis.#models.set(newModel.id, { model: newModel, entityId: id.toString(), groupId });\n\t\t\t\tinstances.push(newModel);\n\t\t\t});\n\t\t});\n\n\t\treturn instances[0];\n\t}\n\n\t/**\n\t * Removes a model from the map.\n\t *\n\t * @param model - The {@link Model} instance which should be removed.\n\t * @example\n\t * mapView.Models.remove(model);\n\t */\n\tremove(model: Model) {\n\t\tconst found = this.#models.get(model.id);\n\t\tif (!found) return;\n\t\tthis.currentMap?.Models.remove(found.entityId, found.groupId);\n\t\tthis.#models.delete(model.id.toString());\n\t}\n\n\t/**\n\t * Remove all the models from the map.\n\t *\n\t * @returns An array of all removed {@link Model} instances.\n\t * @example\n\t * const removedModels = mapView.Models.removeAll();\n\t */\n\tremoveAll() {\n\t\tconst removed: Model[] = [];\n\n\t\tthis.#models.forEach(({ model }) => {\n\t\t\tconst found = this.#models.get(model.id);\n\t\t\tif (found) {\n\t\t\t\tremoved.push(model);\n\t\t\t\tthis.currentMap?.Models.remove(found.entityId, found.groupId);\n\t\t\t\tthis.#models.delete(model.id.toString());\n\t\t\t}\n\t\t});\n\n\t\treturn removed;\n\t}\n}\n", "import type { GeojsonApiMapObject } from './map-object';\nimport type { TAddPathOptions } from '..';\nimport { Path } from '../map-view-objects';\nimport type { Coordinate } from '../map-data-objects';\nimport { randomId } from '../utils';\nimport type { TPathSectionHighlightOptions } from '../types';\nimport { getHighlightedPathSegments } from '../navigation/utils';\nimport { Tween } from '@tweenjs/tween.js';\n\n/**\n * ## Paths in Mappedin JS\n *\n * Paths allow you to draw custom routes on the map, from simple straight lines between coordinates to complex navigation paths that avoid obstacles. While {@link Navigation} provides complete turn-by-turn directions, Paths give you fine-grained control over route visualization.\n *\n * ### Features\n * - Draw paths between any coordinates\n * - Customizable styling (color, width, animation, etc.)\n * - Integration with navigation directions\n * - Animated path drawing and pulse effects\n * - Support for dashed lines and arrows\n *\n * > **Best Practice:** Use `MapData.getDirections()` to generate navigation-aware paths that avoid walls and follow walkable routes, rather than drawing straight lines between coordinates.\n *\n * ### Example Usage\n * ```ts\n * // Draw a simple straight path\n * const path = mapView.Paths.add([coord1, coord2], { color: '#ff0000' });\n *\n * // Draw a navigation path using directions\n * const directions = await mapView.getDirections(space1, space2);\n * if (directions) {\n *   const path = mapView.Paths.add(directions.path, {\n *     color: '#4b90e2',\n *     showPulse: true,\n *     animateDrawing: true\n *   });\n * }\n *\n * // Remove a path\n * mapView.Paths.remove(path);\n *\n * // Remove all paths\n * mapView.Paths.removeAll();\n * ```\n *\n * ### Path Styling Options\n * - `color`: Path color (default: '#4b90e2')\n * - `width`: Path width. Can be a number or an {@link Interpolation}.\n * - `showPulse`: Animated pulse indicating direction\n * - `animateDrawing`: Animate path drawing\n * - `displayArrowsOnPath`: Show direction arrows\n * - `dashed`: Use dashed line style\n *\n * ### Advanced\n * - Use `interactive: true` to make paths clickable.\n *\n * ### More Information\n * - [Wayfinding Guide](https://developer.mappedin.com/web-sdk/wayfinding#drawing-a-path)\n *\n * This class is accessed using {@link MapView.Paths}.\n */\nexport class Paths {\n\t#paths: Map<string, { path: Path; entityIds: string[] }> = new Map();\n\t#getCurrentMap: CurrentMapGetter;\n\t/**\n\t * @internal\n\t */\n\tget currentMap() {\n\t\treturn this.#getCurrentMap();\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor({ currentMapGetter }: { currentMapGetter: CurrentMapGetter }) {\n\t\tthis.#getCurrentMap = currentMapGetter;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tgetById(id: string) {\n\t\treturn this.#paths.get(id)?.path;\n\t}\n\n\t/**\n\t * Adds a path ({@link Path}) to the map.\n\t * @param coordinates Array of coordinates ({@link Coordinate}) to form the path.\n\t * @param options Optional styling and behavior options (see {@link TAddPathOptions}).\n\t * @returns A {@link Path} instance representing the created path.\n\t *\n\t * @example Draw a simple red path\n\t * ```ts\n\t * const path = mapView.Paths.add([coord1, coord2], { color: '#ff0000' });\n\t * ```\n\t *\n\t * @example Draw a navigation path with animation\n\t * ```ts\n\t * const directions = await mapView.getDirections(space1, space2);\n\t * if (directions) {\n\t *   const path = mapView.Paths.add(directions.path, {\n\t *     color: '#4b90e2',\n\t *     showPulse: true,\n\t *     animateDrawing: true,\n\t *     displayArrowsOnPath: true\n\t *   });\n\t * }\n\t * ```\n\t *\n\t * @example Draw a dashed path with custom width\n\t * ```ts\n\t * const path = mapView.Paths.add(coordinates, {\n\t *   color: '#00ff00',\n\t *   dashed: true,\n\t *   width: 1,\n\t * });\n\t * ```\n\t *\n\t * @see [Wayfinding Guide](https://developer.mappedin.com/web-sdk/wayfinding#drawing-a-path)\n\t */\n\tadd(coordinates: Coordinate[], options?: { id?: string } & TAddPathOptions): Path {\n\t\tconst map = this.currentMap;\n\t\tif (!map) throw new Error('currentMap should exist');\n\t\tconst internalPath = map.Paths.add(coordinates, options);\n\t\tconst entityIds = internalPath.paths.map(p => p.id.toString());\n\n\t\tconst newPath = new Path(options?.id || randomId(), internalPath.animation, coordinates, internalPath.paths);\n\n\t\tfor (const id of entityIds) {\n\t\t\tthis.#paths.set(id, {\n\t\t\t\tpath: newPath,\n\t\t\t\tentityIds,\n\t\t\t});\n\t\t}\n\t\tthis.#paths.set(newPath.id, {\n\t\t\tpath: newPath,\n\t\t\tentityIds,\n\t\t});\n\n\t\treturn newPath;\n\t}\n\t/**\n\t *\n\t * Highlights a section of a path between two coordinates.\n\t *\n\t * @param path The path to highlight.\n\t * @param start The start coordinate.\n\t * @param end The end coordinate.\n\t * @param options The options for the highlight.\n\t */\n\thighlightPathSection(path: Path, start: Coordinate, end: Coordinate, options?: TPathSectionHighlightOptions) {\n\t\tconst projectionOrigin = this.currentMap?.api.getMapData()?.mapCenter;\n\t\tif (!projectionOrigin) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst highlightedPathSegments = getHighlightedPathSegments([path], start, end, projectionOrigin);\n\t\tif (!highlightedPathSegments) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst animationDuration = options?.animationDuration ?? 1500;\n\n\t\tlet resolveFn: () => void = () => undefined;\n\n\t\tconst completedPromise = new Promise(res => {\n\t\t\tresolveFn = res as () => void;\n\t\t});\n\n\t\tconst tween = new Tween({ fraction: 0.0 })\n\t\t\t.to({ fraction: 1.0 }, animationDuration)\n\t\t\t.onUpdate(value => {\n\t\t\t\tfor (const highlightedPathSegment of highlightedPathSegments) {\n\t\t\t\t\tthis.currentMap?.api.updateState(highlightedPathSegment.segment, {\n\t\t\t\t\t\thighlightCompleteFraction: value.fraction,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.onStart(() => {\n\t\t\t\tfor (const highlightedPathSegment of highlightedPathSegments) {\n\t\t\t\t\tthis.currentMap?.api.updateState(highlightedPathSegment.segment, {\n\t\t\t\t\t\thighlightStartFraction: highlightedPathSegment.startHighlightFraction,\n\t\t\t\t\t\thighlightEndFraction: highlightedPathSegment.endHighlightFraction,\n\t\t\t\t\t\thighlightColor: options?.color ?? 'red',\n\t\t\t\t\t\thighlightWidthMultiplier: options?.widthMultiplier ?? 1,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.onComplete(() => {\n\t\t\t\tresolveFn();\n\t\t\t\tthis.currentMap?.api.removeTween(tween);\n\t\t\t});\n\n\t\tthis.currentMap?.api.tweenGroup().add(tween);\n\n\t\ttween.start();\n\n\t\treturn {\n\t\t\tanimation: completedPromise,\n\t\t};\n\t}\n\n\t/**\n\t * Clears the highlighted section of a path.\n\t * @param path The path to clear the highlight from.\n\t */\n\tclearHighlightedPathSection(path: Path) {\n\t\tthis.currentMap?.api.updateState(path, {\n\t\t\thighlightCompleteFraction: 0.0,\n\t\t\thighlightStartFraction: 0.0,\n\t\t\thighlightEndFraction: 0.0,\n\t\t});\n\t}\n\n\t/**\n\t * Clears the highlighted section of all paths.\n\t */\n\tclearAllHighlightedPathSections() {\n\t\tfor (const path of this.#paths.values()) {\n\t\t\tthis.clearHighlightedPathSection(path.path);\n\t\t}\n\t}\n\n\t/**\n\t * Removes a specific path ({@link Path}) from the map.\n\t * @param path The path to be removed.\n\t * @example\n\t * mapView.Paths.remove(path);\n\t */\n\tremove(path: Path) {\n\t\tconst found = this.#paths.get(path.id);\n\t\tif (!found) return;\n\t\tthis.currentMap?.Paths.remove(found.entityIds);\n\t\tthis.#paths.delete(path.id);\n\t\tfound.entityIds.forEach(id => this.#paths.delete(id));\n\t}\n\t/**\n\t * Removes all paths ({@link Path}) from the map.\n\t *\n\t * @returns An array of all removed {@link Path} instances.\n\t * @example\n\t * const removedPaths = mapView.Paths.removeAll();\n\t */\n\tremoveAll() {\n\t\tconst removed: Path[] = [];\n\t\tthis.#paths.forEach(({ path }) => {\n\t\t\tthis.remove(path);\n\t\t\tremoved.push(path);\n\t\t});\n\n\t\treturn removed;\n\t}\n}\ntype CurrentMapGetter = () => GeojsonApiMapObject | undefined;\n", "import type { GeojsonApiMapObject } from './map-object';\nimport { Shape } from '../map-view-objects';\nimport type { FeatureCollection, LineString, MultiPolygon, Polygon } from 'geojson';\nimport type { LineStyle, PaintStyle } from '@mappedin/core-sdk';\nimport type { Floor } from '../map-data-objects';\n\n/**\n * ## Shapes in Mappedin JS\n *\n * The Shapes class allows you to draw custom 3D geometry on the map using GeoJSON. You can create polygons, multi-polygons, and line strings to highlight areas, create custom boundaries, or add visual overlays to your indoor map.\n *\n * ### Features\n * - Support for GeoJSON geometry (Polygon, MultiPolygon, LineString)\n * - Customizable styling with colors, opacity, and materials\n * - 3D rendering with height and altitude control\n * - Interactive shapes with click/hover events\n * - Floor-specific placement\n *\n * > **Best Practice:** Use shapes to highlight areas of interest, create custom zones, or add visual overlays. Keep shapes simple for better performance, especially on mobile devices.\n *\n * ### Example Usage\n * ```ts\n * // Create a simple polygon shape\n * const polygon = {\n *   type: 'FeatureCollection',\n *   features: [{\n *     type: 'Feature',\n *     geometry: {\n *       type: 'Polygon',\n *       coordinates: [[[lng1, lat1], [lng2, lat2], [lng3, lat3], [lng1, lat1]]]\n *     }\n *   }]\n * };\n *\n * const shape = mapView.Shapes.add(polygon, { color: 'red' }, mapView.currentFloor);\n *\n * // Create a line string\n * const lineString = {\n *   type: 'FeatureCollection',\n *   features: [{\n *     type: 'Feature',\n *     geometry: {\n *       type: 'LineString',\n *       coordinates: [[lng1, lat1], [lng2, lat2]]\n *     }\n *   }]\n * };\n *\n * const line = mapView.Shapes.add(lineString, { color: 'blue', width: 2 });\n *\n * // Remove a shape\n * mapView.Shapes.remove(shape);\n *\n * // Remove all shapes\n * mapView.Shapes.removeAll();\n * ```\n *\n * ### Styling Options\n * - **Polygons/MultiPolygons**: Use `PaintStyle` with color, opacity, height\n * - **LineStrings**: Use `LineStyle` with color, width, opacity\n * - **Interactive**: Set `interactive: true` for click/hover events\n *\n * ### Advanced\n * - Use `altitude` to position shapes at specific heights.\n * - Use `height` to create 3D extruded shapes.\n * - Use `interactive: true` to make shapes clickable.\n * - Use `floor` parameter to place shapes on specific floors.\n *\n * ### More Information\n * - [Shapes Guide](https://developer.mappedin.com/web-sdk/shapes)\n *\n * This class is accessed using {@link MapView.Shapes}.\n */\nexport class Shapes {\n\t#shapes: Map<string, Shape> = new Map();\n\t#getCurrentMap: CurrentMapGetter;\n\t/**\n\t * @internal\n\t */\n\tget currentMap() {\n\t\treturn this.#getCurrentMap();\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tconstructor({ currentMapGetter }: { currentMapGetter: CurrentMapGetter }) {\n\t\tthis.#getCurrentMap = currentMapGetter;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tgetById(id: string) {\n\t\treturn this.#shapes.get(id);\n\t}\n\n\t/**\n\t * Adds a custom GeoJSON geometry ({@link Shape}) to the map.\n\t *\n\t * @param geometry A valid GeoJSON feature collection containing Polygon, MultiPolygon, or LineString features.\n\t * @param style Styling options for the geometry (see {@link PaintStyle} for polygons, {@link LineStyle} for lines).\n\t * @param floor Optional floor to add the geometry to. If not specified, uses the current floor.\n\t * @returns {Shape | undefined} The created shape, or undefined if creation failed.\n\t *\n\t * @example Add a red polygon shape\n\t * ```ts\n\t * const polygon = {\n\t *   type: 'FeatureCollection',\n\t *   features: [{\n\t *     type: 'Feature',\n\t *     geometry: {\n\t *       type: 'Polygon',\n\t *       coordinates: [[[lng1, lat1], [lng2, lat2], [lng3, lat3], [lng1, lat1]]]\n\t *     }\n\t *   }]\n\t * };\n\t *\n\t * const shape = mapView.Shapes.add(polygon, { color: 'red' }, mapView.currentFloor);\n\t * ```\n\t *\n\t * @example Add a blue line string\n\t * ```ts\n\t * const lineString = {\n\t *   type: 'FeatureCollection',\n\t *   features: [{\n\t *     type: 'Feature',\n\t *     geometry: {\n\t *       type: 'LineString',\n\t *       coordinates: [[lng1, lat1], [lng2, lat2]]\n\t *     }\n\t *   }]\n\t * };\n\t *\n\t * const line = mapView.Shapes.add(lineString, { color: 'blue', width: 2 });\n\t * ```\n\t *\n\t * @example Add an interactive shape with custom styling\n\t * ```ts\n\t * const shape = mapView.Shapes.add(geometry, {\n\t *   color: 'green',\n\t *   opacity: 0.7,\n\t *   height: 2,\n\t *   interactive: true\n\t * }, mapView.currentFloor);\n\t * ```\n\t *\n\t * @see [Shapes Guide](https://developer.mappedin.com/web-sdk/shapes)\n\t */\n\tadd<T extends FeatureCollection<Polygon | MultiPolygon | LineString, any>>(\n\t\tgeometry: T,\n\t\tstyle: T extends FeatureCollection<LineString, any> ? LineStyle : PaintStyle,\n\t\tfloor?: Floor,\n\t) {\n\t\tconst map = this.currentMap;\n\t\tif (!map) throw new Error('currentMap should exist');\n\t\tconst geometryId = map.Shapes.add(geometry, style || {}, {\n\t\t\tfloorId: floor?.id,\n\t\t});\n\t\tconst shapes = new Shape(geometryId);\n\t\tthis.#shapes.set(shapes.id, shapes);\n\n\t\treturn shapes;\n\t}\n\t/**\n\t * Removes a specific shape ({@link Shape}) from the map.\n\t * @param shape The shape to be removed.\n\t * @example\n\t * mapView.Shapes.remove(shape);\n\t */\n\tremove(shape: Shape) {\n\t\tconst found = this.#shapes.get(shape.id);\n\t\tif (!found) return;\n\t\tthis.currentMap?.Shapes.remove(shape);\n\t\tthis.#shapes.delete(shape.id.toString());\n\t}\n\t/**\n\t * Removes all Shapes ({@link Shape}) from the map.\n\t *\n\t * @returns An array of all removed shape IDs.\n\t * @example\n\t * const removedShapeIds = mapView.Shapes.removeAll();\n\t */\n\tremoveAll() {\n\t\tconst removed: string[] = [];\n\t\tthis.#shapes.forEach(shapes => {\n\t\t\tthis.remove(shapes);\n\t\t\tremoved.push(shapes.id);\n\t\t\tthis.#shapes.delete(shapes.id.toString());\n\t\t});\n\n\t\treturn removed;\n\t}\n}\ntype CurrentMapGetter = () => GeojsonApiMapObject | undefined;\n", "import type { StyleCollection } from '@mappedin/mvf-v2';\nimport type { GeojsonApiMapObject } from './map-object';\nimport { EXTERIOR_WALLS_ID, FACADES_LAYER, GEOMETRY_LAYER, WALLS_ID } from '../constants';\nexport class Style {\n\t#getCurrentMap: CurrentMapGetter;\n\t/**\n\t * @internal\n\t */\n\tget currentMap() {\n\t\treturn this.#getCurrentMap();\n\t}\n\t/**\n\t * @internal\n\t */\n\tconstructor({ currentMapGetter }: { currentMapGetter: CurrentMapGetter }) {\n\t\tthis.#getCurrentMap = currentMapGetter;\n\t}\n\n\tsetFromStyleCollection(styleCollection: StyleCollection): void {\n\t\tfor (const styleId in styleCollection) {\n\t\t\tfor (const floor of this.currentMap?.floors || []) {\n\t\t\t\tif (styleCollection[styleId] == null) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (!floor.layers.has(GEOMETRY_LAYER)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst geometryLayer = floor.layers.get(GEOMETRY_LAYER);\n\n\t\t\t\tif (geometryLayer?.layers.has(styleId) && 'color' in styleCollection[styleId]) {\n\t\t\t\t\tconst layer = geometryLayer.layers.get(styleId);\n\t\t\t\t\tif (layer) {\n\t\t\t\t\t\tthis.currentMap?.renderer.setState(layer, {\n\t\t\t\t\t\t\tcolor: styleCollection[styleId].color,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// only update exterior wall style with wall style when there's no explicit exterior wall id in the stylecollection\n\t\t\t\tif (geometryLayer && styleId === WALLS_ID && !(EXTERIOR_WALLS_ID in styleCollection)) {\n\t\t\t\t\tconst exteriorId = geometryLayer.layers.get(EXTERIOR_WALLS_ID);\n\t\t\t\t\tif (exteriorId && 'color' in styleCollection[styleId]) {\n\t\t\t\t\t\tthis.currentMap?.renderer.setState(exteriorId, {\n\t\t\t\t\t\t\tcolor: styleCollection[styleId].color,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!floor.layers.has(FACADES_LAYER)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst facadeLayer = floor.layers.get(FACADES_LAYER)!;\n\t\t\t\t// Get the facades that share geometry with this styleId\n\t\t\t\tconst facades = floor.facadesByStyleId.get(styleId);\n\t\t\t\tif (facades && facades.length > 0) {\n\t\t\t\t\tfor (const facadeId of facades) {\n\t\t\t\t\t\tconst groupId = facadeLayer.layers.get(`${facadeId}-${styleId}`);\n\t\t\t\t\t\tif (groupId && 'color' in styleCollection[styleId]) {\n\t\t\t\t\t\t\tthis.currentMap?.renderer.setState(groupId, {\n\t\t\t\t\t\t\t\tcolor: styleCollection[styleId].color,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\ntype CurrentMapGetter = () => GeojsonApiMapObject | undefined;\n", "import { MAPPEDIN_LAYER_ID, type RendererCore } from '@mappedin/core-sdk';\nimport { Logger } from '@packages/internal/common';\nimport type { Map as MapLibreMap } from '../../../packages/outdoor-context-v5';\nimport type { BBox } from 'geojson';\n\nconst DEFAULT_STYLE = { opacity: 1 };\n\nexport type HiddenOutdoorGeometry = [\n\tBBox,\n\tpolygons: GeoJSON.Feature<GeoJSON.Polygon | GeoJSON.MultiPolygon, any>[],\n\tlayers: string[],\n];\n\n/**\n * The outdoor map shown around the Mappedin indoor map can be manipulated to show or hide additional information. It can be used to add GeoJSON based geometry, images, deck.gl layers and more.\n *\n * The outdoor map is accessed using {@link MapView.Outdoor}, which returns a maplibregl.Map object.\n * [MapLibre GL JS](https://maplibre.org/maplibre-gl-js/docs/) is a TypeScript library that uses WebGL to render interactive maps from vector tiles in a browser. The Mappedin SDK makes use of it to display the outdoor map.\n *\n * By providing access to the MapLibre map used to draw the outdoor map, the Mappedin SDK enables developers to draw on and manipulate the outdoor map.\n * Developers can use most capabilities of MapLibre GL JS with key exceptions being Interactivity and Camera, which are not available.\n *\n * User touch and click events are handled by Mappedin JS and are not propagated to the outdoor map layer. Camera movement is also handled by Mappedin JS and cannot be manipulated using MapLibre controls.\n *\n * Refer to the [Outdoor Map Guide](https://developer.mappedin.com/web-sdk/outdoor-map) for more information and interactive examples.\n */\nexport default class Outdoor {\n\t#core: RendererCore;\n\t#hiddenOutdoorGeometry: HiddenOutdoorGeometry[] = [];\n\t#style: { opacity: number | 'initial' } = { opacity: 'initial' };\n\t#initialStyle = { opacity: new Map<string, [object | number, object | number | undefined]>() };\n\t#hiddenLayers = new Set<string>();\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(core: RendererCore, hiddenOutdoorGeometry?: HiddenOutdoorGeometry[]) {\n\t\tthis.#core = core;\n\t\tthis.#hiddenOutdoorGeometry = hiddenOutdoorGeometry || [];\n\t\tconst map = this.#core.map;\n\n\t\tif (map) {\n\t\t\tmap.on('idle', () => {\n\t\t\t\tif (this.#initialStyle.opacity.size) return;\n\n\t\t\t\tthis.#setInitialStyle(map);\n\t\t\t});\n\t\t}\n\t}\n\n\t#setInitialStyle(map) {\n\t\tconst layers = map.getStyle().layers;\n\n\t\tif (layers) {\n\t\t\tlayers.forEach(layer => {\n\t\t\t\tconst visibility = map.getLayoutProperty(layer.id, 'visibility');\n\n\t\t\t\tif (visibility !== 'none') {\n\t\t\t\t\tif (layer.id === 'background') {\n\t\t\t\t\t\t// do nothing\n\t\t\t\t\t} else if (layer.type === 'symbol') {\n\t\t\t\t\t\tthis.#initialStyle.opacity.set(layer.id, [\n\t\t\t\t\t\t\t(map.getPaintProperty(layer.id, `icon-opacity`) as number) ?? DEFAULT_STYLE.opacity,\n\t\t\t\t\t\t\t(map.getPaintProperty(layer.id, `text-opacity`) as number) ?? DEFAULT_STYLE.opacity,\n\t\t\t\t\t\t]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.#initialStyle.opacity.set(layer.id, [\n\t\t\t\t\t\t\t(map.getPaintProperty(layer.id, `${layer.type}-opacity`) as number) ?? DEFAULT_STYLE.opacity,\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\t#clearInitialStyle() {\n\t\tObject.values(this.#initialStyle).forEach(value => value.clear());\n\t}\n\n\t/**\n\t * Set the style of the outdoor map. Use one of [Mappedin's predefined styles](https://developer.mappedin.com/web-sdk/outdoor-map#styles) or link to a custom style.\n\t * @param style {any}\n\t */\n\tsetStyle(style: any) {\n\t\tif (this.#core.map) {\n\t\t\tthis.#core.map?.setStyle(style);\n\t\t\tif (this.#hiddenLayers.size) {\n\t\t\t\tthis.#hiddenLayers.clear();\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t\tthis.#clearInitialStyle();\n\t\t\tthis.#setInitialStyle(this.#core.map);\n\t\t\tthis.setOpacity(this.#style.opacity);\n\t\t\t// move mappedin layer to the top\n\t\t\tthis.#core.map?.moveLayer(MAPPEDIN_LAYER_ID);\n\t\t\tfor (let [bbox, polygons, layers] of this.#hiddenOutdoorGeometry || []) {\n\t\t\t\tthis.#core.hideOutdoorLayersIntersectingPolygons(bbox, polygons, layers);\n\t\t\t}\n\t\t}\n\t}\n\t/**\n\t * Returns a Maplibre map for advanced usage.\n\t *\n\t * @returns {object} Maplibre map instance\n\t *\n\t * Limitations:\n\t * - Maplibre interaction events are not supported, use Mappedin JS interaction events.\n\t * - Maplibre markers and labels may overlap as they are not integrated with the Mappedin JS collision engine.\n\t */\n\tget map(): MapLibreMap | undefined {\n\t\treturn this.#core.map;\n\t}\n\t/**\n\t * Whether the outdoorView is enabled.\n\t */\n\tget enabled() {\n\t\treturn !!this.#core.map;\n\t}\n\n\t/**\n\t * Whether the outdoorView is visible.\n\t */\n\tget visible() {\n\t\treturn this.#hiddenLayers.size === 0;\n\t}\n\n\t/**\n\t * Show the outdoor map.\n\t */\n\tshow() {\n\t\tconst map = this.#core.map;\n\n\t\tif (!map) return;\n\n\t\tconst layers = map.getStyle().layers;\n\n\t\tif (!layers) return;\n\n\t\tlayers.forEach(layer => {\n\t\t\tif (this.#hiddenLayers.has(layer.id)) {\n\t\t\t\tmap.setLayoutProperty(layer.id, 'visibility', 'visible');\n\t\t\t}\n\t\t});\n\n\t\tthis.#hiddenLayers.clear();\n\t}\n\n\t/**\n\t * Hide the outdoor map.\n\t * @param excludedStyleLayerIds {string[]}\n\t */\n\thide(excludedStyleLayerIds: string[] = []) {\n\t\tconst map = this.#core.map;\n\n\t\tif (!map) return;\n\n\t\tconst layers = map.getStyle().layers;\n\n\t\tif (!layers) return;\n\n\t\tlayers.forEach(layer => {\n\t\t\tconst visibility = map.getLayoutProperty(layer.id, 'visibility');\n\n\t\t\tif (!excludedStyleLayerIds.includes(layer.id) && visibility !== 'none') {\n\t\t\t\tmap.setLayoutProperty(layer.id, 'visibility', 'none');\n\t\t\t\tthis.#hiddenLayers.add(layer.id);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Set outdoor view opacity.\n\t * @param targetOpacity {number | 'initial'}\n\t * @param excludedStyleLayerIds {string[]}\n\t */\n\tsetOpacity(targetOpacity: number | 'initial', excludedStyleLayerIds: string[] = []) {\n\t\tconst map = this.#core.map;\n\n\t\tif (!map) return;\n\n\t\t// TODO: Not sure why `getStyle` can sometimes be undefined\n\t\tconst layers = this.#core.map?.getStyle?.()?.layers;\n\n\t\tif (!layers) return;\n\n\t\tmap.once('idle', () => {\n\t\t\tlayers.forEach(layer => {\n\t\t\t\tconst visibility = map.getLayoutProperty(layer.id, 'visibility');\n\n\t\t\t\tif (!excludedStyleLayerIds.includes(layer.id) && visibility !== 'none') {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst initialOpacity = this.#initialStyle.opacity.get(layer.id);\n\n\t\t\t\t\t\tif (initialOpacity !== undefined) {\n\t\t\t\t\t\t\tif (layer.id === 'background') {\n\t\t\t\t\t\t\t\t// do nothing\n\t\t\t\t\t\t\t} else if (layer.type === 'symbol') {\n\t\t\t\t\t\t\t\tmap.setPaintProperty(\n\t\t\t\t\t\t\t\t\tlayer.id,\n\t\t\t\t\t\t\t\t\t`icon-opacity`,\n\t\t\t\t\t\t\t\t\ttargetOpacity === 'initial' ? initialOpacity[0] : targetOpacity,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tmap.setPaintProperty(\n\t\t\t\t\t\t\t\t\tlayer.id,\n\t\t\t\t\t\t\t\t\t`text-opacity`,\n\t\t\t\t\t\t\t\t\ttargetOpacity === 'initial' ? initialOpacity[1] : targetOpacity,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tmap.setPaintProperty(\n\t\t\t\t\t\t\t\t\tlayer.id,\n\t\t\t\t\t\t\t\t\t`${layer.type}-opacity`,\n\t\t\t\t\t\t\t\t\ttargetOpacity === 'initial' ? initialOpacity[0] : targetOpacity,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.#style.opacity = targetOpacity;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tLogger.warn('Error setting opacity:', error);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n}\n", "import { Space } from '../map-data-objects';\nimport type { TAddText3DOptions } from '../types';\nimport type { CurrentMapGetter } from './types';\nimport { Text3DView } from '../map-view-objects';\nimport { configureWorker } from '@mappedin/core-sdk';\n\n/**\n * Disables the Text3D web worker and falls back to processing on the main thread.\n *\n * This function should be called when using Text3D features in environments\n * with strict Content Security Policy (CSP) that blocks web workers from\n * being created using blob: URLs or unsafe-eval directives.\n *\n * While disabling the worker may slightly impact performance for complex text\n * rendering, it enables Text3D functionality in CSP-restricted environments.\n *\n * Ensure calling this before calling preloadFont\n *\n * @example\n * ```typescript\n * import {disableText3DWorker} from '@mappedin/mappedin-js';\n * // Disable Text3D worker for CSP compatibility\n * disableText3DWorker();\n *\n * // Then use Text3D features as normal\n * mapView.Text3D.labelAll();\n * ```\n */\nexport function disableText3DWorker() {\n\tconfigureWorker(false);\n}\n\n/**\n * ## Text3D in Mappedin JS\n *\n * Text3D creates three-dimensional text labels that are rendered directly in the 3D scene. These labels are perfect for displaying space names, room numbers, or any text that needs to be visible from any angle in the 3D environment.\n *\n * ### Features\n * - 3D text rendering with depth and perspective\n * - Automatic text wrapping and sizing\n * - Customizable fonts, colors, and materials\n * - Performance-optimized with web worker support\n *\n * ### Example Usage\n * ```ts\n * // Create labels for all spaces\n * const labels = mapView.Text3D.labelAll();\n *\n * // Create a label for a specific space\n * const label = mapView.Text3D.label(space, \"Room 101\", { fontSize: 12 });\n *\n * // Remove a specific label\n * mapView.Text3D.remove(label);\n *\n * // Remove all labels\n * mapView.Text3D.removeAll();\n * ```\n *\n * ### Performance Considerations\n * - Use `labelAll()` for better performance when creating multiple labels.\n *\n * ### Advanced\n * - Customize text appearance with fonts, colors, and materials.\n * - Use `labelAll()` with options to apply consistent styling to all labels.\n * - Text3D labels are automatically positioned and sized based on space geometry.\n *\n * This class is accessed using {@link MapView.Text3D}.\n */\nexport class Text3D {\n\t#getCurrentMap: CurrentMapGetter;\n\t#textViewMap: Map<string, { text3d: string; targetId: string; text3DView: Text3DView }> = new Map();\n\t#text3DToTextViewMap: Map<string, { text3DView: Text3DView }> = new Map();\n\n\t/**\n\t * @internal\n\t */\n\tconstructor({ currentMapGetter }: { currentMapGetter: CurrentMapGetter }) {\n\t\tthis.#getCurrentMap = currentMapGetter;\n\t}\n\n\t/**\n\t * Creates polygon labels for all spaces.\n\t *\n\t * @param options Configuration options for text label creation (see {@link AddText3DOptions}).\n\t * @returns An array of Text3DView instances representing the created labels. If a space is already labeled, the existing Text3D instance will be returned.\n\t *\n\t * @example Create labels for all spaces with default settings\n\t * ```ts\n\t * const labels = mapView.Text3D.labelAll();\n\t * ```\n\t *\n\t * @example Create labels with custom styling\n\t * ```ts\n\t * const labels = mapView.Text3D.labelAll({\n\t *   fontSize: 14,\n\t *   color: 'white',\n\t *   backgroundColor: 'rgba(0, 0, 0, 0.7)'\n\t * });\n\t * ```\n\t *\n\t * @see [Text3D Guide](https://developer.mappedin.com/web-sdk/text3d)\n\t */\n\tlabelAll(options: TAddText3DOptions = {}) {\n\t\tconst results: Text3DView[] = [];\n\t\tconst recordedTextInfoId = new Set<string>();\n\n\t\tthis.#getCurrentMap()\n\t\t\t?.Text3D.labelAll(options)\n\t\t\t?.forEach(({ textInfo, target }) => {\n\t\t\t\tconst textId = textInfo.id.toString();\n\t\t\t\t/**\n\t\t\t\t * If we found existing text3DView, we will add it to the results array only if it hasn't been added yet\n\t\t\t\t */\n\t\t\t\tconst found = this.#text3DToTextViewMap.get(textId);\n\t\t\t\tif (found) {\n\t\t\t\t\tif (!recordedTextInfoId.has(textId)) {\n\t\t\t\t\t\tresults.push(found.text3DView);\n\t\t\t\t\t}\n\n\t\t\t\t\trecordedTextInfoId.add(textId);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\trecordedTextInfoId.add(textId);\n\n\t\t\t\tconst text3DView = new Text3DView(textId, target);\n\t\t\t\tthis.#textViewMap.set(text3DView.id, {\n\t\t\t\t\ttargetId: target.id,\n\t\t\t\t\ttext3d: textId,\n\t\t\t\t\ttext3DView: text3DView,\n\t\t\t\t});\n\t\t\t\tthis.#text3DToTextViewMap.set(textId, { text3DView });\n\t\t\t\tresults.push(text3DView);\n\t\t\t});\n\n\t\treturn results;\n\t}\n\n\t/**\n\t * Creates a 3D text label for a given space.\n\t *\n\t * @param target The target space to label.\n\t * @param content The content of the label. If not provided, target.name will be used.\n\t * @param options Configuration options for the text label creation (see {@link AddText3DOptions}).\n\t * @returns A Text3DView instance representing the created label, or undefined if creation failed.\n\t *\n\t * @throws {Error} If the target is not a Space.\n\t *\n\t * @example Create a label with custom text\n\t * ```ts\n\t * const label = mapView.Text3D.label(space, \"Conference Room A\", { fontSize: 12 });\n\t * ```\n\t *\n\t * @example Create a label using space name\n\t * ```ts\n\t * const label = mapView.Text3D.label(space); // Uses space.name\n\t * ```\n\t *\n\t * @example Create a label with custom styling\n\t * ```ts\n\t * const label = mapView.Text3D.label(space, \"VIP Room\", {\n\t *   fontSize: 16,\n\t *   color: 'gold',\n\t *   backgroundColor: 'rgba(0, 0, 0, 0.8)'\n\t * });\n\t * ```\n\t *\n\t * @see [Text3D Guide](https://developer.mappedin.com/web-sdk/text3d)\n\t */\n\tlabel(target: Space, content?: string, options: TAddText3DOptions = {}): Text3DView | undefined {\n\t\tconst currentMap = this.#getCurrentMap();\n\t\tif (!currentMap) return;\n\t\tif (Space.is(target)) {\n\t\t\tconst created = this.#getCurrentMap()?.Text3D.label(target, content, options);\n\t\t\tif (!created) return;\n\t\t\tconst textId = created.textInfo.id.toString();\n\t\t\tconst found = this.#text3DToTextViewMap.get(textId);\n\t\t\tif (found) {\n\t\t\t\treturn found.text3DView;\n\t\t\t}\n\t\t\tconst text3dView = new Text3DView(textId, created.target);\n\t\t\tthis.#textViewMap.set(text3dView.id, {\n\t\t\t\ttargetId: created.target.id,\n\t\t\t\ttext3d: textId,\n\t\t\t\ttext3DView: text3dView,\n\t\t\t});\n\t\t\tthis.#text3DToTextViewMap.set(textId, { text3DView: text3dView });\n\n\t\t\treturn text3dView;\n\t\t} else {\n\t\t\tthrow new Error('Non-space target is not supported');\n\t\t}\n\t}\n\n\t/**\n\t * Removes one or more Text3D labels from the map.\n\t *\n\t * @param target Can be either:\n\t * - A single Text3DView instance\n\t * - An array of Text3DView instances\n\t * - A string ID of the Text3DView to remove\n\t *\n\t * @example Remove a single text label\n\t * ```ts\n\t * mapView.Text3D.remove(text3dView);\n\t * ```\n\t *\n\t * @example Remove multiple text labels\n\t * ```ts\n\t * mapView.Text3D.remove([text3dView1, text3dView2]);\n\t * ```\n\t *\n\t * @example Remove by ID\n\t * ```ts\n\t * mapView.Text3D.remove(\"text3d-123\");\n\t * ```\n\t */\n\tremove(target: Text3DView): void;\n\tremove(target: string): void;\n\tremove(target: string | Text3DView) {\n\t\tconst id = typeof target === 'string' ? target : target.id;\n\t\tconst info = this.#textViewMap.get(id);\n\t\tif (!info) return;\n\t\tthis.#getCurrentMap()?.Text3D.remove(info.text3d);\n\t\tthis.#textViewMap.delete(id);\n\t\tthis.#text3DToTextViewMap.delete(info.text3d);\n\t}\n\n\t/**\n\t * Removes all Text3D labels from the current map.\n\t *\n\t * @example\n\t * ```ts\n\t * mapView.Text3D.removeAll();\n\t * ```\n\t */\n\tremoveAll() {\n\t\tthis.#textViewMap.forEach(item => {\n\t\t\tthis.#getCurrentMap()?.Text3D.remove(item.text3d);\n\t\t});\n\t\tthis.#textViewMap.clear();\n\t}\n}\n", "export * from './doors-state';\nexport * from './facade-state';\nexport * from './floor-state';\nexport * from './geometry-state';\nexport * from './label-state';\nexport * from './marker-state';\nexport * from './path-state';\nexport * from './shape-state';\nexport * from './state-utils';\nexport * from './text3d-state';\nexport * from './walls-state';\nexport * from './image-state';\nexport * from './model-state';\n", "import type { GeometryGroupState, GeometryState } from '@mappedin/core-sdk';\nimport z from 'zod';\nimport { parseCompleteState } from './state-utils';\n\nexport const DOORS_STATE_TYPE = 'doors';\n\nexport const doorsStateSchema = z.object({\n\ttype: z.literal(DOORS_STATE_TYPE).default(DOORS_STATE_TYPE),\n\t/**\n\t * Color of the doors.\n\t * @default #ffffff\n\t */\n\tcolor: z.string().default('#ffffff'),\n\t/**\n\t * Color of the top of doors, if not set, defaults to the color.\n\t */\n\ttopColor: z.string().optional(),\n\t/** Texture to apply to the geometry element. */\n\ttexture: z.object({ url: z.string().optional() }).optional(),\n\t/** Top texture to apply to the geometry element. */\n\ttopTexture: z.object({ url: z.string().optional() }).optional(),\n\t/**\n\t * Visibility of the doors.\n\t * @default false\n\t */\n\tvisible: z.boolean().default(false),\n\t/**\n\t * Opacity of the doors.\n\t * @default 1\n\t */\n\topacity: z.number().default(1),\n});\n\nexport const doorsStateSchemaPartial = doorsStateSchema.partial();\nconst doorsStateSchemaStrict = z.strictObject(doorsStateSchema.shape);\n\nexport type TDoorsState = z.infer<typeof doorsStateSchemaStrict>;\nexport type TDoorsUpdateState = z.infer<typeof doorsStateSchemaPartial>;\n\nexport function getDoorsState(geometryGroupState: GeometryGroupState): TDoorsState {\n\tconst { color, topColor, texture, topTexture, visible, opacity } = geometryGroupState;\n\n\treturn parseCompleteState(doorsStateSchema, {\n\t\tvisible,\n\t\tcolor,\n\t\ttopColor,\n\t\topacity,\n\t\ttexture: texture ? { url: texture } : undefined,\n\t\ttopTexture: topTexture ? { url: topTexture } : undefined,\n\t});\n}\n\nexport function translateDoorsStateToGeojsonCore(\n\tstate: TDoorsUpdateState,\n\tcurrentState: Partial<GeometryState>,\n): Partial<GeometryState> {\n\tconst update: Partial<GeometryState> = {};\n\tif (currentState == null) {\n\t\treturn update;\n\t}\n\tif (state.color) {\n\t\tif (state.color === 'initial') {\n\t\t\tupdate.color = currentState.initialColor;\n\t\t} else {\n\t\t\tupdate.color = state.color;\n\t\t}\n\t}\n\tif (state.topColor) {\n\t\tif (state.topColor === 'initial') {\n\t\t\tupdate.topColor = currentState.initialTopColor;\n\t\t} else {\n\t\t\tupdate.topColor = state.topColor;\n\t\t}\n\t}\n\tif (state.visible !== undefined) {\n\t\tupdate.visible = state.visible;\n\t}\n\tif (state.texture?.url !== undefined) {\n\t\tupdate.texture = state.texture.url;\n\t}\n\tif (state.topTexture?.url !== undefined) {\n\t\tupdate.topTexture = state.topTexture.url;\n\t}\n\n\tif (state.opacity !== undefined) {\n\t\tupdate.opacity = state.opacity;\n\t}\n\n\treturn update;\n}\n", "import Logger from '@packages/internal/common/Mappedin.Logger';\nimport type { Complete } from '@packages/internal/common/type-utils';\nimport { z } from 'zod';\nimport type { TDoorsState, TDoorsUpdateState } from './doors-state';\nimport type { TFacadeState, TFacadeUpdateState } from './facade-state';\nimport type { TFloorState, TFloorUpdateState } from './floor-state';\nimport type { TGeometryState, TGeometryUpdateState } from './geometry-state';\nimport type { TImage3DState, TImage3DUpdateState } from './image-state';\nimport type { TLabelState, TLabelUpdateState } from './label-state';\nimport type { TMarkerState, TMarkerUpdateState } from './marker-state';\nimport type { TModelState, TModelUpdateState } from './model-state';\nimport type { TPathState, TPathUpdateState } from './path-state';\nimport type { TShapeState, TShapeUpdateState } from './shape-state';\nimport type { TText3DState, TText3DUpdateState } from './text3d-state';\nimport type { TWallsState, TWallsUpdateState } from './walls-state';\nimport type { Label, Marker, Model, Path, PathSegment, Shape, Text3DView, Image3DView } from '../map-view-objects';\nimport type { DOORS, WALLS } from '../types';\nimport type { Area, Door, Facade, Floor, MapObject, Space } from '../map-data-objects';\nimport type { ReadonlyDeep } from 'type-fest';\n\ntype ParseStateOptions = {\n\twarn?: boolean;\n};\n\n/**\n * Extracts the type from a Zod schema by looking for a 'type' field with a literal value\n * @param schema - The Zod schema to extract type from\n * @returns The type string or 'unknown' if not found\n */\nfunction extractTypeFromSchema(schema: z.ZodObject<any>): string {\n\ttry {\n\t\t// Try to get the type from the schema shape\n\t\tconst shape = schema.shape;\n\t\tif ('type' in shape) {\n\t\t\tlet typeSchema = shape.type;\n\n\t\t\t// Unwrap optional schemas (e.g., from .partial())\n\t\t\tif (typeSchema instanceof z.ZodOptional) {\n\t\t\t\ttypeSchema = typeSchema._def.innerType;\n\t\t\t}\n\n\t\t\t// Check if it's a literal with a value\n\t\t\tif ('value' in typeSchema) {\n\t\t\t\treturn String(typeSchema.value);\n\t\t\t}\n\n\t\t\t// Check if it's a literal with default value\n\t\t\tif (typeSchema instanceof z.ZodDefault && 'value' in typeSchema._def.innerType) {\n\t\t\t\treturn String(typeSchema._def.innerType.value);\n\t\t\t}\n\t\t}\n\n\t\treturn 'unknown';\n\t} catch {\n\t\treturn 'unknown';\n\t}\n}\n\n/**\n * Extracts invalid fields from a Zod parse result\n * @param parseResult - The result from schema.safeParse()\n * @returns Object with field names as keys and error messages as values\n */\nfunction extractInvalidFields(parseResult: ReturnType<typeof z.ZodType.prototype.safeParse>): Record<string, string[]> {\n\tif (parseResult.success) {\n\t\treturn {};\n\t}\n\n\t// Manually extract field errors from issues array (flatten() is deprecated in v4)\n\tconst fieldErrors: Record<string, string[]> = {};\n\tfor (const issue of parseResult.error.issues) {\n\t\t// Only process issues with a path (field-level errors)\n\t\tif (issue.path.length > 0) {\n\t\t\tconst fieldName = String(issue.path[0]);\n\t\t\tif (!fieldErrors[fieldName]) {\n\t\t\t\tfieldErrors[fieldName] = [];\n\t\t\t}\n\t\t\tfieldErrors[fieldName].push(issue.message);\n\t\t}\n\t}\n\treturn fieldErrors;\n}\n\n/**\n * Logs invalid fields and their error messages to the console\n * @param invalidFields - Object with field names as keys and error messages as values\n * @param elementType - The type of element being parsed (for logging)\n */\nfunction logInvalidFields(invalidFields: Record<string, string[]>, elementType: string) {\n\tconst fieldEntries = Object.entries(invalidFields);\n\n\tif (fieldEntries.length > 0) {\n\t\tconst fieldDetails = fieldEntries.map(([field, messages]) => `${field}: ${messages.join(', ')}`).join('; ');\n\t\tLogger.warn(`${fieldEntries.length} invalid field(s) in ${elementType ?? 'unknown'} state: [${fieldDetails}]`);\n\t}\n}\n\n/**\n * Parses state with partial validation - warns about invalid fields and strips them,\n * but keeps valid fields and continues processing.\n *\n * @param schema - Partial Zod schema to validate against (already has .partial() applied)\n * @param state - Input state to parse\n * @param options - Optional configuration\n * @returns Parsed and cleaned state with only valid fields\n */\nexport function parsePartialState<T extends z.ZodObject<any>>(\n\tschema: T,\n\tstate: object,\n\toptions?: ParseStateOptions,\n): Partial<z.infer<T>> {\n\tif (state == null || typeof state !== 'object') {\n\t\treturn {};\n\t}\n\n\tconst parseResult = schema.safeParse(state);\n\tif (parseResult.success) {\n\t\t// Zod v4 applies defaults even in optional fields, so we need to filter out\n\t\t// fields that weren't in the original input to preserve partial update behavior\n\t\tconst result: Record<string, unknown> = {};\n\t\tfor (const key of Object.keys(state)) {\n\t\t\tif (key in parseResult.data) {\n\t\t\t\tresult[key] = parseResult.data[key];\n\t\t\t}\n\t\t}\n\n\t\treturn result as Partial<z.infer<T>>;\n\t}\n\n\tconst invalidFields = extractInvalidFields(parseResult);\n\n\tif (options?.warn) {\n\t\tlogInvalidFields(invalidFields, extractTypeFromSchema(schema));\n\t}\n\n\t// Build result with only valid fields (copy from original input)\n\tconst result: Record<string, unknown> = {};\n\tfor (const key of Object.keys(state)) {\n\t\tif (!(key in invalidFields) && key in schema.shape) {\n\t\t\tresult[key] = state[key];\n\t\t}\n\t}\n\n\treturn result as Partial<z.infer<T>>;\n}\n\n/**\n * Parses state with full validation - uses schema defaults for missing fields\n * and returns the complete inferred type.\n *\n * @param schema - Zod schema to validate against\n * @param state - Input state to parse\n * @param options - Optional configuration\n * @returns Parsed state with all fields (using defaults where needed)\n */\nexport function parseCompleteState<T extends z.ZodObject<any>>(\n\tschema: T,\n\tstate: object,\n\toptions?: ParseStateOptions,\n): z.infer<Complete<T>> {\n\tconst parseResult = schema.safeParse(state);\n\n\tif (parseResult.success) {\n\t\treturn parseResult.data as z.infer<Complete<T>>;\n\t}\n\n\tif (options?.warn === true) {\n\t\tconst invalidFields = extractInvalidFields(parseResult);\n\t\tlogInvalidFields(invalidFields, extractTypeFromSchema(schema));\n\t}\n\n\treturn state as z.infer<Complete<T>>;\n}\n\n/**\n * Centralized mapping of element types to their get state types.\n */\nexport type MapElementToGetState = {\n\t// Map View Objects\n\t[Marker.__type]: ReadonlyDeep<TMarkerState>;\n\t[Label.__type]: ReadonlyDeep<TLabelState>;\n\t[Shape.__type]: ReadonlyDeep<TShapeState>;\n\t[Model.__type]: ReadonlyDeep<TModelState>;\n\t[Path.__type]: ReadonlyDeep<TPathState>;\n\t[PathSegment.__type]: ReadonlyDeep<TPathState>;\n\t[Text3DView.__type]: ReadonlyDeep<TText3DState>;\n\t[Image3DView.__type]: ReadonlyDeep<TImage3DState>;\n\n\t// Map Data Objects\n\t[Space.__type]: ReadonlyDeep<TGeometryState>;\n\t[MapObject.__type]: ReadonlyDeep<TGeometryState>;\n\t[Floor.__type]: ReadonlyDeep<TFloorState>;\n\t[Facade.__type]: ReadonlyDeep<TFacadeState>;\n\t[Door.__type]: ReadonlyDeep<TDoorsState>;\n\t[Area.__type]: ReadonlyDeep<TGeometryState>;\n\n\t// Enums\n\t[WALLS.Exterior]: ReadonlyDeep<TWallsState>;\n\t[WALLS.Interior]: ReadonlyDeep<TWallsState>;\n\t[DOORS.Exterior]: ReadonlyDeep<TDoorsState>;\n\t[DOORS.Interior]: ReadonlyDeep<TDoorsState>;\n};\n\n/**\n * Centralized mapping of element types to their update state types.\n */\nexport type MapElementToUpdateState = {\n\t// Map View Objects\n\t[Marker.__type]: TMarkerUpdateState;\n\t[Label.__type]: TLabelUpdateState;\n\t[Shape.__type]: TShapeUpdateState;\n\t[Model.__type]: TModelUpdateState;\n\t[Path.__type]: TPathUpdateState;\n\t[PathSegment.__type]: TPathUpdateState;\n\t[Text3DView.__type]: TText3DUpdateState;\n\t[Image3DView.__type]: TImage3DUpdateState;\n\n\t// Map Data Objects\n\t[Space.__type]: TGeometryUpdateState;\n\t[MapObject.__type]: TGeometryUpdateState;\n\t[Floor.__type]: TFloorUpdateState;\n\t[Facade.__type]: TFacadeUpdateState;\n\t[Door.__type]: TDoorsUpdateState;\n\t[Area.__type]: TGeometryUpdateState;\n\n\t// Enums\n\t[WALLS.Exterior]: TWallsUpdateState;\n\t[WALLS.Interior]: TWallsUpdateState;\n\t[DOORS.Exterior]: TDoorsUpdateState;\n\t[DOORS.Interior]: TDoorsUpdateState;\n};\n", "import type { GroupContainerState } from '@mappedin/core-sdk';\nimport { z } from 'zod';\nimport { parseCompleteState } from './state-utils';\n\nexport const FACADE_STATE_TYPE = 'facade';\n\nexport const facadeStateSchema = z.object({\n\ttype: z.literal(FACADE_STATE_TYPE).default(FACADE_STATE_TYPE),\n\t/**\n\t * The opacity of the facade.\n\t * @default 1\n\t */\n\topacity: z.number().default(1),\n\t/**\n\t * Whether the facade is visible.\n\t * @default true\n\t */\n\tvisible: z.boolean().default(true),\n});\n\nexport const facadeStateSchemaPartial = facadeStateSchema.partial();\nconst facadeStateSchemaStrict = z.strictObject(facadeStateSchema.shape);\n\nexport type TFacadeState = z.infer<typeof facadeStateSchemaStrict>;\nexport type TFacadeUpdateState = z.infer<typeof facadeStateSchemaPartial>;\n\nexport function getFacadeState(state: GroupContainerState): TFacadeState {\n\treturn parseCompleteState(facadeStateSchema, {\n\t\topacity: state.opacity,\n\t\tvisible: state.visible,\n\t});\n}\n", "import type { GeometryGroupState, GroupContainerState, RendererCore } from '@mappedin/core-sdk';\nimport { Logger } from '@packages/internal/common';\nimport { z } from 'zod';\nimport type { FloorObject } from '../api-geojson/floor-object';\nimport {\n\tFOOTPRINT_LAYER,\n\tOCCLUSION_LAYER,\n\tGEOMETRY_LAYER,\n\tMARKERS_LAYER,\n\tLABELS_LAYER,\n\tIMAGES_LAYER,\n\tPATHS_LAYER,\n\tAREAS_LAYER,\n} from '../constants';\nimport { parseCompleteState } from './state-utils';\n\nconst FLOOR_STATE_TYPE = 'floor';\nconst FOOTPRINT_STATE_TYPE = `${FLOOR_STATE_TYPE}.footprint`;\nconst GEOMETRY_STATE_TYPE = `${FLOOR_STATE_TYPE}.geometry`;\nconst LABELS_STATE_TYPE = `${FLOOR_STATE_TYPE}.labels`;\nconst MARKERS_STATE_TYPE = `${FLOOR_STATE_TYPE}.markers`;\nconst IMAGES_STATE_TYPE = `${FLOOR_STATE_TYPE}.images`;\nconst OCCLUSION_STATE_TYPE = `${FLOOR_STATE_TYPE}.occlusion`;\nconst PATHS_STATE_TYPE = `${FLOOR_STATE_TYPE}.paths`;\nconst AREAS_STATE_TYPE = `${FLOOR_STATE_TYPE}.areas`;\n\nexport const footprintStateSchema = z.object({\n\ttype: z.literal(FOOTPRINT_STATE_TYPE).default(FOOTPRINT_STATE_TYPE),\n\t/**\n\t * Altitude of the footprint relative to the floor.\n\t * @default 0\n\t */\n\taltitude: z.number().default(0),\n\t/**\n\t * Whether the footprint is visible.\n\t * @default false\n\t */\n\tvisible: z.boolean().default(false),\n\t/**\n\t * Height of the footprint relative to altitude.\n\t * @default 0\n\t */\n\theight: z.number().default(0),\n\t/**\n\t * Opacity of the footprint.\n\t * @default 1\n\t */\n\topacity: z.number().default(1),\n\t/**\n\t * Material side of the footprint.\n\t * @internal\n\t */\n\tside: z.enum(['double', 'front', 'back']),\n\t/**\n\t * Color of the footprint.\n\t * @default #ffffff\n\t */\n\tcolor: z.string().default('#ffffff'),\n});\n\nexport const footprintStateSchemaPartial = footprintStateSchema.partial();\n\nexport const floorGeometryStateSchema = z.object({\n\ttype: z.literal(GEOMETRY_STATE_TYPE).default(GEOMETRY_STATE_TYPE),\n\t/**\n\t * Opacity of the floor geometry.\n\t * @default 1\n\t */\n\topacity: z.number().default(1),\n\t/**\n\t * Visibility of floor geometry.\n\t * @default true\n\t */\n\tvisible: z.boolean().default(true),\n});\n\nexport const floorGeometryStateSchemaPartial = floorGeometryStateSchema.partial();\n\nexport const floorLabelsStateSchema = z.object({\n\ttype: z.literal(LABELS_STATE_TYPE).default(LABELS_STATE_TYPE),\n\t/**\n\t * Whether the labels are enabled to be shown when the floor is visible.\n\t * @default true\n\t */\n\tenabled: z.boolean().default(true),\n});\n\nexport const floorLabelsStateSchemaPartial = floorLabelsStateSchema.partial();\n\nexport const floorMarkersStateSchema = z.object({\n\ttype: z.literal(MARKERS_STATE_TYPE).default(MARKERS_STATE_TYPE),\n\t/**\n\t * Whether the markers are enabled to be shown when the floor is visible.\n\t * @default true\n\t */\n\tenabled: z.boolean().default(true),\n});\n\nexport const floorMarkersStateSchemaPartial = floorMarkersStateSchema.partial();\n\nexport const floorImagesStateSchema = z.object({\n\ttype: z.literal(IMAGES_STATE_TYPE).default(IMAGES_STATE_TYPE),\n\t/**\n\t * Visibility of the images on the floor.\n\t * @default true\n\t */\n\tvisible: z.boolean().default(true),\n});\n\nexport const floorImagesStateSchemaPartial = floorImagesStateSchema.partial();\n\nexport const floorOcclusionStateSchema = z.object({\n\ttype: z.literal(OCCLUSION_STATE_TYPE).default(OCCLUSION_STATE_TYPE),\n\t/**\n\t * @internal\n\t * Whether this floor should occlude labels and markers on other floors\n\t * @default true\n\t */\n\tenabled: z.boolean().default(true),\n});\n\nexport const floorOcclusionStateSchemaPartial = floorOcclusionStateSchema.partial();\n\nexport const floorPathsStateSchema = z.object({\n\ttype: z.literal(PATHS_STATE_TYPE).default(PATHS_STATE_TYPE),\n\t/**\n\t * Visibility of the paths on the floor.\n\t * @default true\n\t */\n\tvisible: z.boolean().default(true),\n});\n\nexport const floorPathsStateSchemaPartial = floorPathsStateSchema.partial();\n\nexport const floorSchema = z.object({\n\ttype: z.literal(FLOOR_STATE_TYPE).default(FLOOR_STATE_TYPE),\n\t/**\n\t * The visibility of the floor, including the geometry, labels, and markers.\n\t * @default false\n\t */\n\tvisible: z.boolean().default(false),\n\t/**\n\t * The altitude of the floor.\n\t * @default 0\n\t */\n\taltitude: z.number().default(0),\n});\n\nexport const areasStateSchema = z.object({\n\ttype: z.literal(AREAS_STATE_TYPE).default(AREAS_STATE_TYPE),\n\t/**\n\t * Visibility of the areas on the floor.\n\t * @default true\n\t */\n\tvisible: z.boolean().default(true),\n});\n\nexport const areasStateSchemaPartial = areasStateSchema.partial();\n\nexport const floorStateSchema = z.object({\n\t...floorSchema.shape,\n\tgeometry: floorGeometryStateSchema,\n\tlabels: floorLabelsStateSchema,\n\tmarkers: floorMarkersStateSchema,\n\timages: floorImagesStateSchema,\n\tfootprint: footprintStateSchema,\n\tocclusion: floorOcclusionStateSchema,\n\tpaths: floorPathsStateSchema,\n\tareas: areasStateSchema,\n});\n\nexport const floorSchemaPartial = floorSchema.partial();\n\nconst floorStateSchemaPartial = z\n\t.object({\n\t\t...floorSchema.shape,\n\t\t/**\n\t\t * State of the geometry on the floor.\n\t\t */\n\t\tgeometry: floorGeometryStateSchema.partial(),\n\t\tlabels: floorLabelsStateSchema.partial(),\n\t\tmarkers: floorMarkersStateSchema.partial(),\n\t\timages: floorImagesStateSchema.partial(),\n\t\tfootprint: footprintStateSchema.partial(),\n\t\tocclusion: floorOcclusionStateSchema.partial(),\n\t\tpaths: floorPathsStateSchema.partial(),\n\t\tareas: areasStateSchema.partial(),\n\t})\n\t.partial();\nconst floorStateSchemaStrict = z.strictObject({\n\t...floorSchema.shape,\n\tgeometry: z.strictObject(floorGeometryStateSchema.shape),\n\tlabels: z.strictObject(floorLabelsStateSchema.shape),\n\tmarkers: z.strictObject(floorMarkersStateSchema.shape),\n\timages: z.strictObject(floorImagesStateSchema.shape),\n\tfootprint: z.strictObject(footprintStateSchema.shape),\n\tocclusion: z.strictObject(floorOcclusionStateSchema.shape),\n\tpaths: z.strictObject(floorPathsStateSchema.shape),\n\tareas: z.strictObject(areasStateSchema.shape),\n});\n\nexport type TFloorState = z.infer<typeof floorStateSchemaStrict>;\nexport type TFloorUpdateState = z.infer<typeof floorStateSchemaPartial>;\n\nexport function getFloorState(\n\tstate: GroupContainerState,\n\tfloor?: FloorObject,\n\trenderer?: RendererCore,\n): TFloorState | undefined {\n\tif (!floor) {\n\t\tLogger.error(`Floor is not defined. Cannot get floor state.`);\n\t\treturn;\n\t}\n\tconst geometryLayer = floor.layers.get(GEOMETRY_LAYER);\n\tconst geometryLayerState = geometryLayer\n\t\t? renderer?.getState<GroupContainerState>(geometryLayer.containerId)\n\t\t: undefined;\n\n\tconst labelLayer = floor.layers.get(LABELS_LAYER);\n\tconst markersLayer = floor.layers.get(MARKERS_LAYER);\n\tconst footprintLayer = floor.layers.get(FOOTPRINT_LAYER);\n\tconst footprintLayerState = footprintLayer\n\t\t? renderer?.getState<GeometryGroupState>(footprintLayer.containerId)\n\t\t: undefined;\n\tconst occlusionLayer = floor.layers.get(OCCLUSION_LAYER);\n\tconst occlusionLayerState = occlusionLayer\n\t\t? renderer?.getState<GeometryGroupState>(occlusionLayer.containerId)\n\t\t: undefined;\n\tconst imagesLayer = floor.layers.get(IMAGES_LAYER);\n\tconst imagesLayerState = imagesLayer ? renderer?.getState<GeometryGroupState>(imagesLayer.containerId) : undefined;\n\tconst pathsLayer = floor.layers.get(PATHS_LAYER);\n\tconst pathsLayerState = pathsLayer ? renderer?.getState<GeometryGroupState>(pathsLayer.containerId) : undefined;\n\tconst areasLayer = floor.layers.get(AREAS_LAYER);\n\tconst areasLayerState = areasLayer ? renderer?.getState<GeometryGroupState>(areasLayer.containerId) : undefined;\n\treturn parseCompleteState(floorStateSchema, {\n\t\tgeometry: {\n\t\t\topacity: geometryLayerState?.opacity,\n\t\t\tvisible: geometryLayerState?.visible,\n\t\t},\n\t\tlabels: {\n\t\t\tenabled: labelLayer?.visible,\n\t\t},\n\t\tmarkers: {\n\t\t\tenabled: markersLayer?.visible,\n\t\t},\n\t\tfootprint: {\n\t\t\taltitude: footprintLayerState?.altitude,\n\t\t\tvisible: footprintLayerState?.visible,\n\t\t\theight: footprintLayerState?.height,\n\t\t\topacity: footprintLayerState?.opacity,\n\t\t\tside: footprintLayerState?.side,\n\t\t\tcolor: footprintLayerState?.color,\n\t\t},\n\t\timages: {\n\t\t\tvisible: imagesLayerState?.visible,\n\t\t},\n\t\tocclusion: {\n\t\t\tenabled: occlusionLayerState?.visible,\n\t\t},\n\t\tpaths: {\n\t\t\tvisible: pathsLayerState?.visible,\n\t\t},\n\t\tareas: {\n\t\t\tvisible: areasLayerState?.visible,\n\t\t},\n\t\tvisible: state.visible,\n\t\taltitude: state.altitude,\n\t});\n}\n", "import type { GeometryState } from '@mappedin/core-sdk';\nimport { z } from 'zod';\nimport { parseCompleteState } from './state-utils';\n\nconst GEOMETRY_STATE_TYPE = 'geometry';\n/**\n * Zod schema for geometry state validation\n */\nexport const geometryStateSchema = z.object({\n\ttype: z.literal(GEOMETRY_STATE_TYPE).default(GEOMETRY_STATE_TYPE),\n\t/**\n\t * Whether the geometry is visible.\n\t * @default true\n\t */\n\tvisible: z.boolean().default(true),\n\t/**\n\t * Color of the geometry element. Color can be set using CSS colors names `DarkGoldenRod`, as Hex strings `#0000FF` or the rgb values `rgb(255,0,0)`.\n\t * @default #ffffff\n\t */\n\tcolor: z.union([z.string(), z.literal('initial')]).default('#ffffff'),\n\t/**\n\t * Color of the geometry element's top. Color can be set using CSS colors names `DarkGoldenRod`, as Hex strings `#0000FF` or the rgb values `rgb(255,0,0)`.\n\t */\n\ttopColor: z.union([z.string(), z.literal('initial')]).optional(),\n\t/**\n\t * Color of the geometry element when hovered over. Color can be set using CSS colors names `DarkGoldenRod`, as Hex strings `#0000FF` or the rgb values `rgb(255,0,0)`.\n\t */\n\thoverColor: z.union([z.string(), z.literal('initial')]).optional(),\n\t/**\n\t * Indicates if the geometry element is interactive. Color can be set using CSS colors names `DarkGoldenRod`, as Hex strings `#0000FF` or the rgb values `rgb(255,0,0)`.\n\t * @default false\n\t */\n\tinteractive: z.boolean().default(false),\n\t/**\n\t * Opacity of the geometry element.\n\t * @default 1\n\t */\n\topacity: z.number().default(1),\n\t/**\n\t * Height of the geometry element in meters.\n\t * @default 0\n\t */\n\theight: z.number().default(0),\n\t/**\n\t * The altitude of the geometry element in meters.\n\t * @default 0\n\t */\n\taltitude: z.number().default(0),\n\t/**\n\t * Texture to apply to the geometry element.\n\t */\n\ttexture: z\n\t\t.object({\n\t\t\turl: z.string(),\n\t\t})\n\t\t.optional(),\n\t/**\n\t * Top texture to apply to the geometry element.\n\t */\n\ttopTexture: z\n\t\t.object({\n\t\t\turl: z.string(),\n\t\t})\n\t\t.optional(),\n\t/**\n\t * Whether the image should be flipped to face the camera.\n\t * @default false\n\t */\n\tflipImageToFaceCamera: z.boolean().default(false),\n\t/**\n\t * Whether the anchored image should collide with other images.\n\t * @default false\n\t */\n\tenableImageCollisions: z.boolean().default(false),\n\t/**\n\t * Whether the geometry has a border\n\t */\n\tborderVisible: z.boolean().default(false),\n\t/**\n\t * The color of the border. borderVisible must be true for this to take effect.\n\t */\n\tborderColor: z.string().optional(),\n\t/**\n\t * The width of the border. borderVisible must be true for this to take effect.\n\t */\n\tborderWidth: z.number().optional(),\n});\n\nexport const geometryStateSchemaPartial = geometryStateSchema.partial();\nconst geometryStateSchemaStrict = z.strictObject(geometryStateSchema.shape);\n\n/**\n * Defines the state for geometry elements like {@link Space} when updated.\n */\nexport type TGeometryState = z.infer<typeof geometryStateSchemaStrict>;\nexport type TGeometryUpdateState = z.infer<typeof geometryStateSchemaPartial>;\n\nexport function getGeometryState(geometryState: GeometryState): TGeometryState {\n\tconst {\n\t\taltitude,\n\t\tinteractive,\n\t\thoverColor,\n\t\tcolor,\n\t\tvisible,\n\t\topacity,\n\t\theight,\n\t\ttexture,\n\t\ttopTexture,\n\t\tflipImageToFaceCamera,\n\t\tenableImageCollisions,\n\t\ttopColor,\n\t\tborderVisible,\n\t\tborderColor,\n\t\tborderWidth,\n\t} = geometryState;\n\n\treturn parseCompleteState(geometryStateSchema, {\n\t\tinteractive,\n\t\thoverColor,\n\t\tcolor,\n\t\tvisible,\n\t\topacity,\n\t\theight,\n\t\ttexture: texture ? { url: geometryState.texture } : undefined,\n\t\ttopTexture: topTexture ? { url: topTexture } : undefined,\n\t\tflipImageToFaceCamera,\n\t\tenableImageCollisions,\n\t\ttopColor,\n\t\taltitude,\n\t\tborderVisible,\n\t\tborderColor,\n\t\tborderWidth,\n\t});\n}\n\nexport function translateGeometryStateToGeojsonCore(\n\tstate: TGeometryUpdateState,\n\tcurrentState: Partial<GeometryState>,\n): Partial<GeometryState> {\n\tconst update: Partial<GeometryState> = {};\n\tif (currentState == null) {\n\t\treturn update;\n\t}\n\tif (state.color) {\n\t\tif (state.color === 'initial') {\n\t\t\tupdate.color = currentState.initialColor;\n\t\t} else {\n\t\t\tupdate.color = state.color;\n\t\t}\n\t}\n\tif (state.topColor) {\n\t\tif (state.topColor === 'initial') {\n\t\t\tupdate.topColor = currentState.initialTopColor;\n\t\t} else {\n\t\t\tupdate.topColor = state.topColor;\n\t\t}\n\t}\n\tif (state.visible !== undefined) {\n\t\tupdate.visible = state.visible;\n\t}\n\tif (state.texture?.url !== undefined) {\n\t\tupdate.texture = state.texture.url;\n\t}\n\tif (state.topTexture?.url !== undefined) {\n\t\tupdate.topTexture = state.topTexture.url;\n\t}\n\tif (state.hoverColor !== undefined) {\n\t\tupdate.hoverColor = state.hoverColor;\n\t}\n\tif (state.interactive !== undefined) {\n\t\tupdate.interactive = state.interactive;\n\t}\n\tif (state.height !== undefined) {\n\t\tupdate.height = state.height;\n\t}\n\tif (state.opacity !== undefined) {\n\t\tupdate.opacity = state.opacity;\n\t}\n\tif (state.flipImageToFaceCamera !== undefined) {\n\t\tupdate.flipImageToFaceCamera = state.flipImageToFaceCamera;\n\t}\n\tif (state.enableImageCollisions !== undefined) {\n\t\tupdate.enableImageCollisions = state.enableImageCollisions;\n\t}\n\tif (state.altitude !== undefined) {\n\t\tupdate.altitude = state.altitude;\n\t}\n\tif (state.borderVisible !== undefined) {\n\t\tupdate.borderVisible = state.borderVisible;\n\t}\n\tif (state.borderColor !== undefined) {\n\t\tupdate.borderColor = state.borderColor;\n\t}\n\tif (state.borderWidth !== undefined) {\n\t\tupdate.borderWidth = state.borderWidth;\n\t}\n\n\treturn update;\n}\n", "import type { LabelAppearance, LabelState } from '@mappedin/core-sdk';\nimport z from 'zod';\nimport type { TCollisionRankingTier } from '../types';\nimport {\n\tDEFAULT_LABEL_TEXT_PLACEMENTS,\n\tLABEL_TEXT_PLACEMENT_VALUES,\n\tlabelAppearanceSchemaBase,\n\tparseLabelAppearance,\n} from '../../../geojson/src/components/label-utils';\nimport type { Complete } from '@packages/internal/common/type-utils';\nimport { collisionRankingTierSchema } from '../../../geojson/src/utils/collision-ranking-tier';\n\nexport const LABEL_STATE_TYPE = 'label';\n\nexport const labelStateSchema = z.object({\n\ttype: z.literal(LABEL_STATE_TYPE).default(LABEL_STATE_TYPE),\n\t/** Text content of the label */\n\ttext: z.string(),\n\t/**\n\t * Determines the collision ranking tier of the label, which influences its visibility in relation to other colliders.\n\t * @default 'medium'\n\t */\n\trank: z.custom<TCollisionRankingTier | 'initial'>(val => {\n\t\treturn collisionRankingTierSchema.safeParse(val).success || val === 'initial';\n\t}),\n\t/** Customize the appearance of the Label and its pin */\n\tappearance: z.custom<LabelAppearance>(val => {\n\t\treturn labelAppearanceSchemaBase.safeParse(val).success;\n\t}),\n\t/**\n\t * Whether the Label should be clickable.\n\t * @default false\n\t */\n\tinteractive: z.boolean().default(false),\n\t/**\n\t * Whether the label is enabled.\n\t * @default true\n\t */\n\tenabled: z.boolean().default(true),\n\t/**\n\t * The placement of the text relative to the pin.\n\t */\n\ttextPlacement: z\n\t\t.union([z.enum(LABEL_TEXT_PLACEMENT_VALUES), z.array(z.enum(LABEL_TEXT_PLACEMENT_VALUES))])\n\t\t.default(DEFAULT_LABEL_TEXT_PLACEMENTS),\n});\n\nexport const labelStateSchemaPartial = labelStateSchema.partial();\n\nexport type TLabelState = z.infer<typeof labelStateSchema>;\n\nexport type TLabelUpdateState = z.infer<typeof labelStateSchemaPartial>;\n\nexport function getLabelState(state: LabelState): TLabelState {\n\tconst { text, enabled, options } = state;\n\treturn {\n\t\ttype: LABEL_STATE_TYPE,\n\t\ttext: text ?? '',\n\t\tappearance: parseLabelAppearance(options?.appearance ?? {}),\n\t\trank: (options?.rank as TCollisionRankingTier) ?? 'medium',\n\t\tenabled: enabled ?? true,\n\t\tinteractive: options?.interactive ?? false,\n\t\ttextPlacement: options?.textPlacement ?? DEFAULT_LABEL_TEXT_PLACEMENTS,\n\t} satisfies Complete<TLabelState>;\n}\n\nexport function translateLabelStateToGeojsonCore(\n\tstate: TLabelUpdateState,\n\tcurrentState: Partial<LabelState>,\n): Partial<LabelState> {\n\tconst update: Partial<LabelState> = { options: {} } as Partial<LabelState>;\n\tif (!update.options) throw new Error('options should exist');\n\tif (state.text) {\n\t\tupdate.text = state.text;\n\t}\n\tif (state.appearance) {\n\t\tupdate.options.appearance = state.appearance;\n\t}\n\tif (state.textPlacement) {\n\t\tupdate.options.textPlacement = state.textPlacement;\n\t}\n\tif (state.rank != null) {\n\t\tif (state.rank === 'initial') {\n\t\t\tupdate.options.rank = currentState.initialRank || 2;\n\t\t} else {\n\t\t\tupdate.options.rank = state.rank;\n\t\t}\n\t}\n\tif (state.enabled !== undefined) {\n\t\tupdate.enabled = state.enabled;\n\t}\n\tif (state.interactive !== undefined) {\n\t\tupdate.options.interactive = state.interactive;\n\t}\n\tif (state.enabled !== undefined) {\n\t\tupdate.enabled = state.enabled;\n\t}\n\n\treturn update;\n}\n", "import type { MarkerState } from '@mappedin/core-sdk';\nimport z from 'zod';\nimport type { TCollisionRankingTier } from '../types';\nimport type { Marker } from '../map-view-objects';\nimport { Coordinate } from '../map-data-objects';\nimport type { Complete } from '@packages/internal/common/type-utils';\nimport { collisionRankingTierSchema } from '../../../geojson/src/utils/collision-ranking-tier';\nimport { MARKER_PLACEMENT_VALUES } from '../../../geojson/src/components/marker-utils';\n\nexport const MARKER_STATE_TYPE = 'marker';\n\nexport const markerStateSchema = z.object({\n\ttype: z.literal(MARKER_STATE_TYPE).default(MARKER_STATE_TYPE),\n\t/**\n\t * Determines the collision ranking tier of the marker, which influences its visibility in relation to other colliders.\n\t * @default 'medium'\n\t */\n\trank: z.custom<TCollisionRankingTier | 'initial'>(val => {\n\t\treturn collisionRankingTierSchema.safeParse(val).success || val === 'initial';\n\t}),\n\t/**\n\t * Specifies the placement of the marker, determining its position relative to its coordinates.\n\t * Can be a single placement or an array of placements.\n\t */\n\tplacement: z.union([z.enum(MARKER_PLACEMENT_VALUES), z.array(z.enum(MARKER_PLACEMENT_VALUES))]).optional(),\n\t/**\n\t * Whether the Marker should be clickable.\n\t * @default false\n\t */\n\tinteractive: z.union([z.boolean(), z.literal('pointer-events-auto')]).default(false),\n\t/**\n\t * When true, the marker's collision boundary automatically adjusts when the marker's content or size changes.\n\t * @default true\n\t */\n\tdynamicResize: z.boolean().default(true),\n\t/**\n\t * Whether the marker is enabled.\n\t * @default true\n\t */\n\tenabled: z.boolean().default(true),\n\t/**\n\t * The z-index of the marker.\n\t */\n\tzIndex: z.number().optional(),\n\t/** Configuration for the low priority pin fallback strategy. */\n\tlowPriorityPin: z\n\t\t.object({\n\t\t\t/** Whether to enable low priority pin strategy when all anchor positions have collisions. */\n\t\t\tenabled: z.boolean().optional(),\n\t\t\t/** Size of the low priority pin in pixels. */\n\t\t\tsize: z.number().positive().optional(),\n\t\t\t/** Color of the low priority pin. */\n\t\t\tcolor: z.string().optional(),\n\t\t})\n\t\t.optional(),\n\t/** HTML element for the marker. */\n\telement: z.custom<HTMLElement>(val => val instanceof HTMLElement, { error: 'Must be an HTMLElement instance' }),\n\t/** HTML content of the marker as text */\n\tcontentHTML: z.string(),\n});\n\nexport const markerStateSchemaPartial = markerStateSchema\n\t.omit({\n\t\telement: true,\n\t})\n\t.partial();\n\nexport type TMarkerState = z.infer<typeof markerStateSchema>;\nexport type TMarkerUpdateState = z.infer<typeof markerStateSchemaPartial>;\n\nexport function getMarkerState(state: MarkerState, marker?: Marker): TMarkerState {\n\t// we want to use the coordinate that the marker was created with\n\tlet coordinate = marker?.target ? marker.target.anchorTarget : undefined;\n\n\tconst { enabled, placement, element, dynamicResize, contentHTML, options, position, parent } = state;\n\tconst parentId = typeof parent === 'object' ? parent.id : parent;\n\n\tif (coordinate == null) {\n\t\tcoordinate = new Coordinate({\n\t\t\tlatitude: position?.[1] ?? 0,\n\t\t\tlongitude: position?.[0] ?? 0,\n\t\t\tfloorId: parentId?.toString(),\n\t\t});\n\t}\n\n\treturn {\n\t\ttype: MARKER_STATE_TYPE,\n\t\trank: (options?.rank as TCollisionRankingTier) ?? 'medium',\n\t\tinteractive: options?.interactive ?? false,\n\t\tenabled: enabled ?? true,\n\t\telement: element,\n\t\tplacement: placement ?? [],\n\t\tzIndex: options?.zIndex,\n\t\tdynamicResize: dynamicResize ?? true,\n\t\tlowPriorityPin: options?.lowPriorityPin,\n\t\tcontentHTML: contentHTML ?? '',\n\t} satisfies Complete<TMarkerState>;\n}\n\nexport function translateMarkerStateToGeojsonCore(\n\tstate: TMarkerUpdateState,\n\tcurrentState: Partial<MarkerState>,\n): Partial<MarkerState> {\n\tconst update = {} as Partial<MarkerState>;\n\tupdate.options = {} as MarkerState['options'];\n\n\tif (state.rank != null) {\n\t\tif (state.rank === 'initial') {\n\t\t\tupdate.options.rank = currentState.initialRank || 2;\n\t\t} else {\n\t\t\tupdate.options.rank = state.rank;\n\t\t}\n\t}\n\tif (state.dynamicResize != null) {\n\t\tupdate.options.dynamicResize = state.dynamicResize;\n\t}\n\tif (state.enabled != null) {\n\t\tupdate.enabled = state.enabled;\n\t}\n\tif (state.interactive != null) {\n\t\tupdate.options.interactive = state.interactive;\n\t}\n\tif (state.enabled !== null) {\n\t\tupdate.enabled = state.enabled;\n\t}\n\tif (state.contentHTML !== undefined) {\n\t\tupdate.contentHTML = state.contentHTML;\n\t}\n\tif (state.placement != null) {\n\t\tupdate.placement = state.placement;\n\t}\n\n\treturn update;\n}\n", "import type { PathState } from '@mappedin/core-sdk';\nimport z from 'zod';\nimport type { Interpolation } from '../../../geojson/src/types';\nimport { parseCompleteState } from './state-utils';\n\nexport const PATH_STATE_TYPE = 'path';\n\nexport const PATH_DEFAULTS = {\n\tcolor: '#4b90e2',\n\twidth: 1,\n\tcompleteFraction: 0,\n\tvisible: true,\n\tverticalOffset: 0.1,\n} as const;\n\nexport const pathStateSchema = z.object({\n\ttype: z.literal(PATH_STATE_TYPE).default(PATH_STATE_TYPE),\n\t/**\n\t * The color of the path.\n\t * @default #4b90e2\n\t */\n\tcolor: z.string().default(PATH_DEFAULTS.color),\n\t/**\n\t * The width of the path in meters. Can be a number or an Interpolation.\n\t */\n\twidth: z.union([z.number(), z.any()]) as z.ZodType<number | Interpolation<'zoom-level', number[]>>,\n\t/**\n\t * The fraction of the path that should be complete. This can be used to animate the path.\n\t * @default 0\n\t */\n\tcompleteFraction: z.number().default(PATH_DEFAULTS.completeFraction),\n\t/** Whether the path is visible.\n\t * @default true\n\t */\n\tvisible: z.boolean().default(PATH_DEFAULTS.visible),\n\t/**\n\t * The altitude of the geometry, in meters\n\t * @default 0.1\n\t */\n\tverticalOffset: z.number().default(PATH_DEFAULTS.verticalOffset),\n\t/**\n\t * The start fraction of the path that should be highlighted. Indicates the start of the highlighted section.\n\t * @default 0\n\t */\n\thighlightStartFraction: z.number().default(0),\n\t/**\n\t * The end fraction of the path that should be highlighted. Indicates the end of the highlighted section.\n\t * @default 0\n\t */\n\thighlightEndFraction: z.number().default(0),\n\t/**\n\t * The color of the highlight.\n\t * @default red\n\t */\n\thighlightColor: z.string().default('red'),\n\t/**\n\t * The width multiplier of the highlight. Setting this to 1 will result in no changes to path width.\n\t * @default 1.1\n\t */\n\thighlightWidthMultiplier: z.number().default(1.1),\n\t/**\n\t * The fraction of the highlighted path that should be complete. This can be used to animate the highlight.\n\t * @default 1\n\t */\n\thighlightCompleteFraction: z.number().default(1),\n});\n\nexport const pathStateSchemaPartial = pathStateSchema.partial();\nconst pathStateSchemaStrict = z.strictObject(pathStateSchema.shape);\n\nexport type TPathState = z.infer<typeof pathStateSchemaStrict>;\n\nexport type TPathUpdateState = z.infer<typeof pathStateSchemaPartial>;\n\nexport function getPathState(state: PathState): TPathState {\n\tconst {\n\t\tcolor,\n\t\tvisible,\n\t\twidth,\n\t\tverticalOffset,\n\t\tcompleteFraction,\n\t\thighlightStartFraction,\n\t\thighlightEndFraction,\n\t\thighlightColor,\n\t\thighlightWidthMultiplier,\n\t\thighlightCompleteFraction,\n\t} = state;\n\n\treturn parseCompleteState(pathStateSchema, {\n\t\tcolor,\n\t\tvisible,\n\t\twidth,\n\t\tverticalOffset,\n\t\tcompleteFraction,\n\t\thighlightStartFraction,\n\t\thighlightEndFraction,\n\t\thighlightColor,\n\t\thighlightWidthMultiplier,\n\t\thighlightCompleteFraction,\n\t});\n}\n", "import type { GeometryGroupState } from '@mappedin/core-sdk';\nimport { Logger } from '@packages/internal/common';\nimport { z } from 'zod';\nimport { parseCompleteState, parsePartialState } from './state-utils';\n\nexport const SHAPE_STATE_TYPE = 'shape';\n\n/**\n * Schema for validating shape state properties.\n */\nexport const shapeStateSchema = z.object({\n\t/**\n\t * The type of the shape.\n\t */\n\ttype: z.literal(SHAPE_STATE_TYPE).default(SHAPE_STATE_TYPE),\n\n\t/**\n\t * Whether Shape is visible\n\t * @default true\n\t */\n\tvisible: z.boolean().default(true),\n\n\t/**\n\t * The altitude of the shape.\n\t * @default 0\n\t */\n\taltitude: z.number().default(0),\n\n\t/**\n\t * The color of the shape.\n\t * @default #ffffff\n\t */\n\tcolor: z.string().default('#ffffff'),\n\n\t/**\n\t * The height of the shape.\n\t * Height cannot be updated at this time\n\t */\n\theight: z.number().default(0),\n\n\t/**\n\t * The opacity of the shape.\n\t * @default 1\n\t */\n\topacity: z.number().default(1),\n\n\t/**\n\t * Whether the shape is interactive.\n\t * @default false\n\t */\n\tinteractive: z.boolean().default(false),\n\n\t/**\n\t * Bevel configuration for extruded shapes.\n\t */\n\tbevel: z\n\t\t.object({\n\t\t\tenabled: z.boolean().optional(),\n\t\t\tthickness: z.number().optional(),\n\t\t\tsize: z.number().optional(),\n\t\t\toffset: z.number().optional(),\n\t\t\tsegments: z.number().optional(),\n\t\t})\n\t\t.optional(),\n});\n\nexport const shapeStateSchemaPartial = shapeStateSchema.partial();\nconst shapeStateSchemaStrict = z.strictObject(shapeStateSchema.shape);\n\n/**\n * Represents the state of a shape.\n */\nexport type TShapeState = z.infer<typeof shapeStateSchemaStrict>;\nexport type TShapeUpdateState = z.infer<typeof shapeStateSchemaPartial>;\n\nexport function getShapeState(state: GeometryGroupState): TShapeState | undefined {\n\tconst { altitude, visible, color, opacity, interactive, height, children, bevel } = state;\n\n\tif (children == null || children.length < 1) {\n\t\tLogger.error(`Expected at least one child for Shape (${state.id}). Cannot get shape state.`);\n\t\treturn;\n\t}\n\n\treturn parseCompleteState(shapeStateSchema, {\n\t\taltitude,\n\t\tvisible,\n\t\tcolor,\n\t\theight,\n\t\topacity,\n\t\tinteractive,\n\t\tbevel,\n\t});\n}\n\n/**\n * Translates a shape state update to the core renderer state format.\n * Handles geometry updates by passing them through to the core renderer.\n *\n * @param state The partial shape state update\n * @returns The translated state for the core renderer\n */\nexport function translateShapeStateToGeojsonCore(state: TShapeUpdateState): Partial<GeometryGroupState> {\n\tconst parsedState = parsePartialState(shapeStateSchemaPartial, state, { warn: true });\n\n\t// Start with all the standard properties\n\tconst translatedState: Partial<GeometryGroupState> = {};\n\n\tif (parsedState.visible !== undefined) {\n\t\ttranslatedState.visible = parsedState.visible;\n\t}\n\tif (parsedState.color !== undefined) {\n\t\ttranslatedState.color = parsedState.color;\n\t}\n\tif (parsedState.opacity !== undefined) {\n\t\ttranslatedState.opacity = parsedState.opacity;\n\t}\n\tif (parsedState.altitude !== undefined) {\n\t\ttranslatedState.altitude = parsedState.altitude;\n\t}\n\tif (parsedState.height !== undefined) {\n\t\ttranslatedState.height = parsedState.height;\n\t}\n\tif (parsedState.interactive !== undefined) {\n\t\ttranslatedState.interactive = parsedState.interactive;\n\t}\n\tif (parsedState.bevel !== undefined) {\n\t\t// Convert our bevel object to match the expected type\n\t\tconst bevelState = {\n\t\t\tenabled: parsedState.bevel.enabled || false,\n\t\t\tthickness: parsedState.bevel.thickness,\n\t\t\tsize: parsedState.bevel.size,\n\t\t\toffset: parsedState.bevel.offset,\n\t\t\tsegments: parsedState.bevel.segments,\n\t\t};\n\t\ttranslatedState.bevel = bevelState as any;\n\t}\n\n\treturn translatedState;\n}\n", "import z from 'zod';\nimport type { Text3DState } from '../../../geojson/src/components/text3d';\nimport {\n\ttext3DStateSchema as GeoJsonText3DStateSchema,\n\tupdateText3DStateSchema,\n} from '../../../geojson/src/components/text3d';\nimport { Coordinate } from '../map-data-objects';\nimport { parseCompleteState } from './state-utils';\n\nconst TEXT3D_STATE_TYPE = 'text3d';\n\nconst commonText3DStateSchema = z.object({\n\ttype: z.literal(TEXT3D_STATE_TYPE).default(TEXT3D_STATE_TYPE),\n\tposition: z.custom<Coordinate>(val => val instanceof Coordinate, {\n\t\terror: 'Must be a Coordinate instance',\n\t}),\n});\n\nexport const text3DStateSchema = GeoJsonText3DStateSchema.extend({\n\t...commonText3DStateSchema.shape,\n});\n\nexport const text3DUpdateStateSchema = updateText3DStateSchema\n\t.extend({\n\t\t...commonText3DStateSchema.shape,\n\t})\n\t.partial();\n\nconst text3DStateSchemaStrict = z.strictObject(text3DStateSchema.shape);\n\nexport type TText3DState = z.infer<typeof text3DStateSchemaStrict>;\n\nexport type TText3DUpdateState = z.infer<typeof text3DUpdateStateSchema>;\n\nexport function getText3DState(state: Text3DState): TText3DState {\n\tconst {\n\t\tposition,\n\t\tvisible,\n\t\tcolor,\n\t\tflipToFaceCamera,\n\t\tfont,\n\t\tfontSize,\n\t\toutlineColor,\n\t\toutlineOpacity,\n\t\toutlineBlur,\n\t\toutlineWidth,\n\t\toutlineOffsetX,\n\t\toutlineOffsetY,\n\t\tstrokeWidth,\n\t\tstrokeOpacity,\n\t\tstrokeColor,\n\t\tfillOpacity,\n\t\thoverColor,\n\t} = state;\n\treturn parseCompleteState(text3DStateSchema, {\n\t\tposition: new Coordinate({\n\t\t\tlatitude: position?.[1] ?? 0,\n\t\t\tlongitude: position?.[0] ?? 0,\n\t\t}),\n\t\tvisible,\n\t\tcolor,\n\t\tflipToFaceCamera,\n\t\tfont,\n\t\tfontSize,\n\t\toutlineColor,\n\t\toutlineOpacity,\n\t\toutlineBlur,\n\t\toutlineWidth,\n\t\toutlineOffsetX,\n\t\toutlineOffsetY,\n\t\tstrokeWidth,\n\t\tstrokeOpacity,\n\t\tstrokeColor,\n\t\tfillOpacity,\n\t\thoverColor,\n\t});\n}\n", "import type { GeometryGroupState, GeometryState } from '@mappedin/core-sdk';\nimport z from 'zod';\nimport { parseCompleteState } from './state-utils';\n\nexport const WALLS_STATE_TYPE = 'walls';\n\nexport const wallsStateSchema = z.object({\n\ttype: z.literal(WALLS_STATE_TYPE).default(WALLS_STATE_TYPE),\n\t/**\n\t * Color of the walls.\n\t * @default #ffffff\n\t */\n\tcolor: z.string().default('#ffffff'),\n\t/**\n\t * Color of the top of walls, if not set, defaults to the color.\n\t */\n\ttopColor: z.string().optional(),\n\t/**\n\t * Texture to apply to the geometry element.\n\t */\n\ttexture: z.object({ url: z.string() }).or(z.undefined()),\n\t/**\n\t * Top texture to apply to the geometry element.\n\t */\n\ttopTexture: z.object({ url: z.string() }).or(z.undefined()),\n\t/**\n\t * Visibility of the walls.\n\t * @default true\n\t */\n\tvisible: z.boolean().default(true),\n\t/**\n\t * Height of the walls.\n\t * @default 0\n\t */\n\theight: z.number().default(0),\n\t/**\n\t * Opacity of the walls.\n\t * @default 1\n\t */\n\topacity: z.number().default(1),\n});\n\nexport const wallsStateSchemaPartial = wallsStateSchema.partial();\nconst wallsStateSchemaStrict = z.strictObject(wallsStateSchema.shape);\n\nexport type TWallsState = z.infer<typeof wallsStateSchemaStrict>;\nexport type TWallsUpdateState = z.infer<typeof wallsStateSchemaPartial>;\n\nexport function getWallsState(geometryGroupState: GeometryGroupState): TWallsState {\n\tconst { color, topColor, texture, topTexture, visible, height, opacity } = geometryGroupState;\n\n\treturn parseCompleteState(wallsStateSchema, {\n\t\tvisible,\n\t\tcolor,\n\t\ttopColor,\n\t\ttexture: texture ? { url: texture } : undefined,\n\t\ttopTexture: topTexture ? { url: topTexture } : undefined,\n\t\theight,\n\t\topacity,\n\t});\n}\n\nexport function translateWallsStateToGeojsonCore(\n\tstate: TWallsUpdateState,\n\tcurrentState: Partial<GeometryState>,\n): Partial<GeometryState> {\n\tconst update: Partial<GeometryState> = {};\n\tif (currentState == null) {\n\t\treturn update;\n\t}\n\tif (state.color) {\n\t\tif (state.color === 'initial') {\n\t\t\tupdate.color = currentState.initialColor;\n\t\t} else {\n\t\t\tupdate.color = state.color;\n\t\t}\n\t}\n\tif (state.topColor) {\n\t\tif (state.topColor === 'initial') {\n\t\t\tupdate.topColor = currentState.initialTopColor;\n\t\t} else {\n\t\t\tupdate.topColor = state.topColor;\n\t\t}\n\t}\n\tif (state.visible !== undefined) {\n\t\tupdate.visible = state.visible;\n\t}\n\tif (state.texture?.url !== undefined) {\n\t\tupdate.texture = state.texture.url;\n\t}\n\tif (state.topTexture?.url !== undefined) {\n\t\tupdate.topTexture = state.topTexture.url;\n\t}\n\tif (state.height !== undefined) {\n\t\tupdate.height = state.height;\n\t}\n\tif (state.opacity !== undefined) {\n\t\tupdate.opacity = state.opacity;\n\t}\n\n\treturn update;\n}\n", "import type { ImageState } from '@mappedin/core-sdk';\nimport { z } from 'zod';\nimport { Coordinate } from '../map-data-objects';\nimport type { Complete } from '@packages/internal/common/type-utils';\n\n/**\n * Defines the state for an image when its appearance is updated.\n */\nexport const IMAGE_STATE_TYPE = 'image3d';\n\nexport const imageStateSchema = z.object({\n\ttype: z.literal(IMAGE_STATE_TYPE).default(IMAGE_STATE_TYPE),\n\t/**\n\t * Whether the image is visible.\n\t * @default true\n\t */\n\tvisible: z.boolean().default(true),\n\t/**\n\t * Opacity of the image.\n\t * @default 1\n\t */\n\topacity: z.number().min(0).max(1).default(1),\n\t/**\n\t * Coordinate position of the image.\n\t */\n\tposition: z.custom<Coordinate>(val => val instanceof Coordinate, {\n\t\terror: 'Must be a Coordinate instance',\n\t}),\n\t/**\n\t * Width of the image in meters.\n\t * @default 1\n\t */\n\twidth: z.number().default(1),\n\t/**\n\t * Height of the image in meters.\n\t * @default 1\n\t */\n\theight: z.number().default(1),\n\t/**\n\t * Rotation of the image in degrees clockwise from North. 0 degrees is North, 90 degrees is East, 180 degrees is South, and 270 degrees is West.\n\t *\n\t * @default 0\n\t */\n\trotation: z.number().default(0),\n\t/**\n\t * Vertical offset of the image in meters.\n\t *\n\t * @default 0\n\t */\n\tverticalOffset: z.number().default(0),\n\t/**\n\t * Attempt to keep the image facing the camera as much as possible\n\t *\n\t * @default false\n\t */\n\tflipImagesToFaceCamera: z.boolean().default(false),\n});\nexport const imageStateSchemaPartial = imageStateSchema.partial();\n\nexport type TImage3DState = z.infer<typeof imageStateSchema>;\nexport type TImage3DUpdateState = z.infer<typeof imageStateSchemaPartial>;\n\nexport function getImageState(state: ImageState): TImage3DState {\n\tconst { position } = state;\n\treturn {\n\t\ttype: IMAGE_STATE_TYPE,\n\t\tvisible: state.visible ?? true,\n\t\topacity: state.opacity ?? 1,\n\t\tposition: new Coordinate({\n\t\t\tlatitude: position?.[1] ?? 0,\n\t\t\tlongitude: position?.[0] ?? 0,\n\t\t\tverticalOffset: position?.[2],\n\t\t}),\n\t\twidth: state.width ?? 1,\n\t\theight: state.height ?? 1,\n\t\trotation: state.rotation ?? 0,\n\t\tverticalOffset: state.verticalOffset ?? 0,\n\t\tflipImagesToFaceCamera: state.flipImageToFaceCamera ?? false,\n\t} satisfies Complete<TImage3DState>;\n}\n", "import type { ModelState } from '@mappedin/core-sdk';\nimport { Coordinate } from '../map-data-objects';\nimport { z } from 'zod';\nimport { MaterialStyleSchema, modelPropertiesSchema } from '../../../geojson/src/components/model';\nimport { parseCompleteState } from './state-utils';\n\nexport const MODEL_STATE_TYPE = 'model';\n\n/**\n * Schema for validating model state properties.\n */\nexport const modelStateSchema = modelPropertiesSchema.extend({\n\ttype: z.literal(MODEL_STATE_TYPE).default(MODEL_STATE_TYPE),\n\n\t/**\n\t * Color property designed for use with @mappedin/3d-assets.\n\t * Updates the accent color of 3d assets by applying the color to materials named\n\t * ['Default', 'Fabric', 'Mpdn_Logo', 'Fabric_Logo'].\n\t * For custom colors on non-Mappedin models, use the {@link ModelStyle.material | material} property.\n\t * If both the `material` and `color` properties are provided, `material` property updates will take higher precedence than `color` property updates.\n\t */\n\tcolor: z.string().optional(),\n\n\t/**\n\t * The position of the model as a Coordinate.\n\t */\n\tposition: z.custom<Coordinate>(val => Coordinate.is(val as any), {\n\t\terror: 'Expected a Coordinate',\n\t}),\n\n\t/**\n\t * Whether the model is visible.\n\t * @default true\n\t */\n\tvisible: z.boolean().default(true),\n\n\t/**\n\t * The rotation of the model.\n\t * @default [0, 0, 0]\n\t */\n\trotation: z.tuple([z.number(), z.number(), z.number()]).default([0, 0, 0]),\n\n\t/**\n\t * The scale of the model.\n\t * @default [1, 1, 1]\n\t */\n\tscale: z.tuple([z.number(), z.number(), z.number()]).default([1, 1, 1]),\n\n\t/**\n\t * The vertical offset of the model.\n\t * @default 0\n\t */\n\tverticalOffset: z.number().default(0),\n\n\t/**\n\t * The opacity of the model.\n\t * @default 1\n\t */\n\topacity: z.number().default(1),\n\n\t/**\n\t * The material state by name.\n\t */\n\tmaterial: z.record(z.string(), MaterialStyleSchema).optional(),\n\n\t/**\n\t * Whether the model is interactive.\n\t * @default false\n\t */\n\tinteractive: z.boolean().default(false),\n\n\t/**\n\t * The clipping plane z offset of the model. 0 is the bottom of the model, and positive values are above the model in meters. Clips the model vertically above the clipping plane.\n\t *\n\t * Note: models need to be manifold for this to work\n\t *\n\t * @experimental\n\t * @default Infinity\n\t */\n\tclippingPlaneZOffset: z.number().default(Infinity),\n\n\t/**\n\t * The color of the top of the clipping plane.\n\t * @experimental\n\t */\n\tclippingPlaneTopColor: z.string().default('#E67B5B'),\n\n\t/**\n\t * Whether the clipping plane is visible.\n\t * @experimental\n\t * @default true\n\t */\n\tclippingPlaneTopVisible: z.boolean().default(true),\n});\n\nexport const modelStateUpdateSchema = modelStateSchema\n\t.extend({\n\t\tscale: z.union([z.number(), z.tuple([z.number(), z.number(), z.number()])]),\n\t\trotation: z.union([z.number(), z.tuple([z.number(), z.number(), z.number()])]),\n\t})\n\t.partial();\n\nconst modelStateSchemaStrict = z.strictObject(modelStateSchema.shape);\n\n/**\n * Represents the state of a model.\n */\nexport type TModelState = z.infer<typeof modelStateSchemaStrict>;\nexport type TModelUpdateState = z.infer<typeof modelStateUpdateSchema>;\n\nexport function getModelState(state: ModelState): TModelState {\n\tconst {\n\t\tcolor,\n\t\tposition,\n\t\trotation,\n\t\tscale,\n\t\tvisible,\n\t\tinteractive,\n\t\topacity,\n\t\tmaterial,\n\t\tverticalOffset,\n\t\tparent,\n\t\tclippingPlaneZOffset,\n\t\tclippingPlaneTopVisible,\n\t} = state;\n\tconst floorId = typeof parent === 'object' ? parent?.id?.toString() : parent?.toString();\n\n\treturn parseCompleteState(modelStateSchema, {\n\t\tcolor,\n\t\tposition: new Coordinate({\n\t\t\tlatitude: position?.[1] ?? 0,\n\t\t\tlongitude: position?.[0] ?? 0,\n\t\t\tverticalOffset: position?.[2],\n\t\t\tfloorId,\n\t\t}),\n\t\trotation,\n\t\tscale,\n\t\tvisible,\n\t\tinteractive,\n\t\topacity,\n\t\tmaterial,\n\t\tverticalOffset,\n\t\tclippingPlaneZOffset,\n\t\tclippingPlaneTopVisible,\n\t});\n}\n", "import { type MapDataInternal } from '../../map-data-objects';\nimport { type GeoJsonApi } from '../api';\nimport { autoGeometries } from './geometries';\nimport { autoLabels } from './labels';\n\nexport async function auto(mapData: MapDataInternal, api: GeoJsonApi) {\n\tconst promises = [autoLabels(mapData, api), autoGeometries(mapData, api)] as const;\n\tconst [labels] = await Promise.all(promises);\n\treturn { labels };\n}\n", "import { type MapDataInternal } from '../../map-data-objects';\nimport { type GeoJsonApi } from '../api';\n\nexport function autoGeometries(mapData: MapDataInternal, api: GeoJsonApi) {\n\t[...mapData.getByType('space'), ...mapData.getByType('object')].forEach(thing => {\n\t\tif (thing.name == null || thing.name === '') {\n\t\t\treturn;\n\t\t}\n\n\t\tapi.updateState(thing, {\n\t\t\tinteractive: true,\n\t\t});\n\t});\n}\n", "import { Connection, Door, Facade, type MapDataInternal, PointOfInterest } from '../../map-data-objects';\nimport type DetailedMapData from '../../map-data-objects/detailed-map-data';\nimport { type Label } from '../../map-view-objects';\nimport type { TAddLabelOptions } from '../../types';\nimport type { GeoJsonApi } from '../api';\nimport { type IconName, getBuiltInIcon, fetchIcon } from '../icons';\nimport { hasParkingCategory, hasWashroomCategory } from './utils';\n\ntype AutoLabelThing = DetailedMapData<any> | Facade;\n\nexport const LABEL_COLORS = {\n\tdefault: '#3D5676',\n\tconnection: '#128387',\n\twashroom: '#3161B4',\n\tpoint: '#AD468F',\n\tparking: '#418425',\n\tdoor: '#A0552C',\n} as const;\n\nexport const LABEL_ICONS = {\n\televator: 'connection-elevator-12x12',\n\tescalator: 'connection-stairs-12x12',\n\tstairs: 'connection-stairs-12x12',\n\tpoint: 'point-of-interest-12x12',\n\tdoor: 'door-12x12',\n\tbuilding: 'building-12x12',\n\tladder: 'ladder-12x12',\n} as const;\n\nfunction getDefaultIcon(thing: AutoLabelThing): string | null {\n\tlet iconName: IconName | null = null;\n\tif (Connection.is(thing)) {\n\t\tswitch (thing.type) {\n\t\t\tcase 'elevator':\n\t\t\t\ticonName = LABEL_ICONS.elevator;\n\t\t\t\tbreak;\n\t\t\tcase 'ladder':\n\t\t\t\ticonName = LABEL_ICONS.ladder;\n\t\t\t\tbreak;\n\t\t\tcase 'escalator':\n\t\t\tcase 'stairs':\n\t\t\tdefault:\n\t\t\t\ticonName = LABEL_ICONS.stairs;\n\t\t}\n\t} else if (PointOfInterest.is(thing)) {\n\t\ticonName = LABEL_ICONS.point;\n\t} else if (Door.is(thing)) {\n\t\ticonName = LABEL_ICONS.door;\n\t} else if (Facade.is(thing)) {\n\t\ticonName = LABEL_ICONS.building;\n\t}\n\n\tif (iconName != null) {\n\t\treturn getBuiltInIcon(iconName, '#FFFFFF', 12);\n\t}\n\n\treturn null;\n}\n\nfunction getLabelColor(thing: AutoLabelThing) {\n\tif (Connection.is(thing)) {\n\t\treturn LABEL_COLORS.connection;\n\t} else if (Facade.is(thing)) {\n\t\treturn LABEL_COLORS.default;\n\t} else if (hasWashroomCategory(thing)) {\n\t\treturn LABEL_COLORS.washroom;\n\t} else if (hasParkingCategory(thing)) {\n\t\treturn LABEL_COLORS.parking;\n\t} else if (PointOfInterest.is(thing)) {\n\t\treturn LABEL_COLORS.point;\n\t} else if (Door.is(thing)) {\n\t\treturn LABEL_COLORS.door;\n\t}\n\n\treturn LABEL_COLORS.default;\n}\n\nasync function getLabelIcon(thing: AutoLabelThing, options: { color?: string }) {\n\tlet icon: Awaited<ReturnType<typeof fetchIcon>> | null = null;\n\tconst url = 'locationProfiles' in thing ? thing.locationProfiles.find(location => location.icon != null)?.icon : null;\n\tif (url?.url != null) {\n\t\ticon = await fetchIcon(url.url, {\n\t\t\tcolor: options.color,\n\t\t\tstyle: 'fill',\n\t\t});\n\t}\n\n\tif (icon == null) {\n\t\tconst defaultIcon = getDefaultIcon(thing);\n\t\tif (defaultIcon != null) {\n\t\t\ticon = { icon: defaultIcon, type: 'svg' };\n\t\t}\n\t}\n\n\treturn icon;\n}\n\nasync function getLabelRank(thing: AutoLabelThing): Promise<TAddLabelOptions['rank']> {\n\tif (Connection.is(thing)) {\n\t\treturn 'low';\n\t} else if (Door.is(thing)) {\n\t\treturn 'low';\n\t} else if (PointOfInterest.is(thing)) {\n\t\treturn 'high';\n\t} else if (Facade.is(thing)) {\n\t\treturn 'high';\n\t}\n\treturn 'medium';\n}\n\nasync function getLabelOptions(thing: AutoLabelThing): Promise<TAddLabelOptions> {\n\tconst options: TAddLabelOptions = {\n\t\tappearance: {\n\t\t\tcolor: getLabelColor(thing),\n\t\t\tpinOutlineColor: getLabelColor(thing),\n\t\t\ticonPadding: 8,\n\t\t\ticonSize: 24,\n\t\t\ttextSize: 12.5,\n\t\t\ticonScale: {\n\t\t\t\ton: 'zoom-level',\n\t\t\t\tinput: [18, 20],\n\t\t\t\toutput: [0.7, 1],\n\t\t\t},\n\t\t},\n\t\trank: await getLabelRank(thing),\n\t\tinteractive: true,\n\t};\n\n\tconst icon = await getLabelIcon(thing, { color: '#FFFFFF' });\n\tif (icon != null) {\n\t\toptions.appearance!.icon = icon.icon;\n\t\tif (icon.type === 'svg') {\n\t\t\tif (Facade.is(thing)) {\n\t\t\t\toptions.appearance!.iconSize = 30;\n\t\t\t\toptions.appearance!.iconPadding = 10;\n\t\t\t}\n\t\t} else if (icon.type === 'image') {\n\t\t\toptions.appearance!.iconSize = 48;\n\t\t\toptions.appearance!.iconPadding = 2;\n\t\t\toptions.appearance!.pinOutlineColor = '#FFFFFF';\n\t\t\t// Image labels should have a high rank regardless of type\n\t\t\toptions.rank = 'high';\n\t\t}\n\t}\n\n\treturn options;\n}\n\nexport function autoLabels(mapData: MapDataInternal, api: GeoJsonApi): Promise<Label[]> {\n\tconst promises = [\n\t\t...mapData.getByType('connection'),\n\t\t...mapData.getByType('point-of-interest'),\n\t\t...mapData.getByType('space'),\n\t\t...mapData.getByType('object'),\n\t\t...mapData.getByType('door'),\n\t\t...mapData.getByType('facade'),\n\t].flatMap(async thing => {\n\t\tlet labels: Label[] = [];\n\t\tconst options = await getLabelOptions(thing);\n\t\tif (Connection.is(thing)) {\n\t\t\t// Connections always get a label with an icon\n\t\t\tlabels = thing.coordinates.map(coordinate => api.Labels.add(coordinate, thing.name, options));\n\t\t} else if (Facade.is(thing)) {\n\t\t\tif (thing.spaces.length > 0 && thing.floorStack.name != null && thing.floorStack.name !== '') {\n\t\t\t\t// Make sure these get attached to a space, so they disappear when the facade is hidden\n\t\t\t\tlabels.push(api.Labels.add(thing.spaces[0], thing.floorStack.name, options));\n\t\t\t}\n\t\t} else if ('name' in thing && thing.name != null && thing.name !== '') {\n\t\t\tlabels.push(api.Labels.add(thing, thing.name, options));\n\t\t}\n\t\treturn labels;\n\t});\n\treturn Promise.all(promises).then(labels => labels.flat());\n}\n", "import { Logger } from '../../../packages/common';\nimport DOMPurify from 'dompurify';\nimport { isomorphicFetch } from '../../../packages/mvf-utils/mvf-utils';\n\nconst ICONS = {\n\t'connection-stairs-12x12': `<svg viewBox=\"0 0 12 12\" stroke=\"none\">\n\t\t<path d=\"M1.625 8.1875C1.625 8.01491 1.76491 7.875 1.9375 7.875H4.75V9.4375C4.75 9.61009 4.61009 9.75 4.4375 9.75H1.9375C1.76491 9.75 1.625 9.61009 1.625 9.4375V8.1875Z\" />\n\t\t<path d=\"M3.5 6.3125C3.5 6.13991 3.63991 6 3.8125 6H6.625V7.5625C6.625 7.73509 6.48509 7.875 6.3125 7.875H3.5V6.3125Z\" />\n\t\t<path d=\"M5.375 4.4375C5.375 4.26491 5.51491 4.125 5.6875 4.125H8.5V5.6875C8.5 5.86009 8.36009 6 8.1875 6H5.375V4.4375Z\" />\n\t\t<path d=\"M7.25 2.5625C7.25 2.38991 7.38991 2.25 7.5625 2.25H10.0625C10.2351 2.25 10.375 2.38991 10.375 2.5625V3.8125C10.375 3.98509 10.2351 4.125 10.0625 4.125H7.25V2.5625Z\" />\n\t</svg>`,\n\t'connection-elevator-12x12': `<svg viewBox=\"0 0 12 12\" stroke=\"none\">\n\t\t<circle cx=\"1.9375\" cy=\"4.4375\" r=\"0.9375\" />\n\t\t<circle cx=\"1.9375\" cy=\"7.5625\" r=\"0.9375\" />\n\t\t<path\n\t\t\tfillRule=\"evenodd\"\n\t\t\tclipRule=\"evenodd\"\n\t\t\td=\"M7.6 2H9.4C9.73137 2 10 2.26863 10 2.6V9.41328C10 9.74465 9.73137 10.0133 9.4 10.0133H7.6V2ZM6.4 2H4.6C4.26863 2 4 2.26863 4 2.6V9.41328C4 9.74465 4.26863 10.0133 4.6 10.0133H6.4V2Z\"\n\t\t/>\n\t</svg>`,\n\t'point-of-interest-12x12': `<svg viewBox=\"0 0 12 12\" stroke=\"none\">\n\t\t<path\n\t\t\tstroke=\"none\"\n\t\t\tid=\"Subtract\"\n\t\t\tfill-rule=\"evenodd\"\n\t\t\tclip-rule=\"evenodd\"\n\t\t\td=\"M6.24724 10.7516C7.94597 9.0358 9.85962 6.89195 9.85962 4.85965C9.85962 2.72802 8.13159 1 5.99997 1C3.86834 1 2.14032 2.72802 2.14032 4.85965C2.14032 6.89195 4.05397 9.0358 5.7527 10.7516C5.88904 10.8893 6.1109 10.8893 6.24724 10.7516ZM5.99994 6.26317C6.77508 6.26317 7.40345 5.6348 7.40345 4.85967C7.40345 4.08453 6.77508 3.45616 5.99994 3.45616C5.22481 3.45616 4.59644 4.08453 4.59644 4.85967C4.59644 5.6348 5.22481 6.26317 5.99994 6.26317Z\"\n\t\t/>\n\t</svg>`,\n\t'door-12x12': `<svg viewBox=\"0 0 13 12\">\n\t\t\t<path\n\t\t\t\tstroke=\"none\"\n\t\t\t\td=\"M4.02533 0.662341H9.61421C9.95171 0.662341 10.2264 0.937033 10.2264 1.27453V10.726C10.2264 11.0639 9.95218 11.3382 9.61421 11.3382H4.02533C3.69721 11.3382 3.42674 11.078 3.41408 10.7504V1.24696C3.4272 0.919297 3.69721 0.659149 4.02533 0.659149V0.662341ZM5.96969 5.22798H6.64563V6.7725H5.96969V5.22798ZM4.94219 1.39218L7.31267 2.6541C7.43501 2.71973 7.50533 2.84488 7.50533 2.97473C7.50721 4.99181 7.50674 7.00877 7.50674 9.02585C7.50674 9.17679 7.41487 9.30663 7.28361 9.36195L4.94217 10.6084H9.49653V1.39227L4.94219 1.39218Z\"\n\t\t\t/>\n\t\t</svg>`,\n\t'building-12x12': `<svg viewBox=\"0 0 12 12\" stroke=\"none\">\n\t\t\t<path\n\t\t\t\td=\"M11.2374 9.75H10.5V4.5C10.5 4.30109 10.421 4.11032 10.2804 3.96967C10.1397 3.82902 9.94894 3.75 9.75003 3.75H7.68753C7.6378 3.75 7.59011 3.76976 7.55495 3.80492C7.51978 3.84008 7.50003 3.88777 7.50003 3.9375V9.75H6.75003V1.51922C6.75127 1.4024 6.72592 1.28683 6.67589 1.18125C6.62587 1.07567 6.55248 0.982864 6.46128 0.909845C6.33697 0.812924 6.18528 0.757635 6.02776 0.751829C5.87024 0.746023 5.71489 0.789995 5.58378 0.877501L1.83378 3.375C1.73091 3.44364 1.6466 3.53664 1.58837 3.64574C1.53014 3.75484 1.4998 3.87665 1.50003 4.00031V9.75H0.762687C0.66578 9.74857 0.571927 9.78389 0.500006 9.84885C0.428085 9.91382 0.383432 10.0036 0.37503 10.1002C0.371625 10.1515 0.378802 10.2029 0.396116 10.2513C0.413431 10.2997 0.440513 10.344 0.47568 10.3815C0.510847 10.419 0.553349 10.4489 0.600545 10.4693C0.647741 10.4897 0.698623 10.5001 0.75003 10.5H11.25C11.3014 10.5001 11.3523 10.4897 11.3995 10.4693C11.4467 10.4489 11.4892 10.419 11.5244 10.3815C11.5595 10.344 11.5866 10.2997 11.6039 10.2513C11.6213 10.2029 11.6284 10.1515 11.625 10.1002C11.6166 10.0036 11.572 9.91382 11.5001 9.84885C11.4281 9.78389 11.3343 9.74857 11.2374 9.75ZM3.56253 8.625C3.56264 8.67641 3.55219 8.72729 3.53181 8.77449C3.51143 8.82168 3.48156 8.86418 3.44406 8.89935C3.40657 8.93452 3.36224 8.9616 3.31383 8.97892C3.26543 8.99623 3.21398 9.00341 3.16269 9C3.06605 8.99159 2.9762 8.94688 2.91122 8.87485C2.84624 8.80283 2.81098 8.70886 2.81253 8.61188V7.88766C2.81121 7.79078 2.84657 7.69699 2.91151 7.62509C2.97645 7.55319 3.06618 7.50851 3.16269 7.5C3.21398 7.4966 3.26543 7.50377 3.31383 7.52109C3.36224 7.5384 3.40657 7.56548 3.44406 7.60065C3.48156 7.63582 3.51143 7.67832 3.53181 7.72552C3.55219 7.77271 3.56264 7.82359 3.56253 7.875V8.625ZM3.56253 6C3.56264 6.05141 3.55219 6.10229 3.53181 6.14949C3.51143 6.19668 3.48156 6.23918 3.44406 6.27435C3.40657 6.30952 3.36224 6.3366 3.31383 6.35392C3.26543 6.37123 3.21398 6.37841 3.16269 6.375C3.06609 6.36649 2.9763 6.32174 2.91135 6.24974C2.84639 6.17774 2.81109 6.08383 2.81253 5.98688V5.26266C2.81121 5.16578 2.84657 5.07199 2.91151 5.00009C2.97645 4.92819 3.06618 4.88351 3.16269 4.875C3.21398 4.8716 3.26543 4.87877 3.31383 4.89609C3.36224 4.9134 3.40657 4.94048 3.44406 4.97565C3.48156 5.01082 3.51143 5.05332 3.53181 5.10052C3.55219 5.14771 3.56264 5.19859 3.56253 5.25V6ZM5.43753 8.625C5.43764 8.67641 5.42719 8.72729 5.40681 8.77449C5.38643 8.82168 5.35656 8.86418 5.31906 8.89935C5.28157 8.93452 5.23724 8.9616 5.18883 8.97892C5.14043 8.99623 5.08898 9.00341 5.03769 9C4.94122 8.9916 4.8515 8.94702 4.78654 8.8752C4.72159 8.80338 4.68622 8.70964 4.68753 8.61281V7.88766C4.68633 7.79086 4.72174 7.69718 4.78667 7.62539C4.8516 7.55359 4.94126 7.50897 5.03769 7.50047C5.08898 7.49706 5.14043 7.50424 5.18883 7.52156C5.23724 7.53887 5.28157 7.56595 5.31906 7.60112C5.35656 7.63629 5.38643 7.67879 5.40681 7.72598C5.42719 7.77318 5.43764 7.82406 5.43753 7.87547V8.625ZM5.43753 6C5.43764 6.05141 5.42719 6.10229 5.40681 6.14949C5.38643 6.19668 5.35656 6.23918 5.31906 6.27435C5.28157 6.30952 5.23724 6.3366 5.18883 6.35392C5.14043 6.37123 5.08898 6.37841 5.03769 6.375C4.94126 6.3665 4.8516 6.32188 4.78667 6.25008C4.72174 6.17829 4.68633 6.08461 4.68753 5.98781V5.26266C4.68633 5.16586 4.72174 5.07218 4.78667 5.00039C4.8516 4.92859 4.94126 4.88397 5.03769 4.87547C5.08898 4.87206 5.14043 4.87924 5.18883 4.89656C5.23724 4.91387 5.28157 4.94095 5.31906 4.97612C5.35656 5.01129 5.38643 5.05379 5.40681 5.10098C5.42719 5.14818 5.43764 5.19906 5.43753 5.25047V6Z\"\n\t\t\t\tstroke=\"none\"\n\t\t\t/>\n\t\t</svg>`,\n\t'ladder-12x12': `<svg viewBox=\"0 0 12 12\">\n\t\t\t<g id=\"surface1\">\n\t\t\t\t<path style=\" stroke:none;fill-rule:nonzero;fill:rgb(94.117647%,94.117647%,94.117647%);fill-opacity:1;\" d=\"M 2.34375 0.375 L 2.53125 0.375 L 2.625 11.53125 L 2.34375 11.625 L 2.25 0.46875 Z M 2.34375 0.375 \"/>\n\t\t\t\t<path style=\" stroke:none;fill-rule:nonzero;fill:rgb(94.117647%,94.117647%,94.117647%);fill-opacity:1;\" d=\"M 9.46875 0.375 L 9.65625 0.375 L 9.75 11.53125 L 9.46875 11.625 L 9.375 0.46875 Z M 9.46875 0.375 \"/>\n\t\t\t\t<path style=\" stroke:none;fill-rule:nonzero;fill:rgb(94.117647%,94.117647%,94.117647%);fill-opacity:1;\" d=\"M 2.25 2.25 L 2.25 1.875 L 9.75 1.875 L 9.75 2.25 Z M 2.25 2.25 \"/>\n\t\t\t\t<path style=\" stroke:none;fill-rule:nonzero;fill:rgb(94.117647%,94.117647%,94.117647%);fill-opacity:1;\" d=\"M 2.25 4.875 L 2.25 4.5 L 9.75 4.5 L 9.75 4.875 Z M 2.25 4.875 \"/>\n\t\t\t\t<path style=\" stroke:none;fill-rule:nonzero;fill:rgb(94.117647%,94.117647%,94.117647%);fill-opacity:1;\" d=\"M 2.25 7.5 L 2.25 7.125 L 9.75 7.125 L 9.75 7.5 Z M 2.25 7.5 \"/>\n\t\t\t\t<path style=\" stroke:none;fill-rule:nonzero;fill:rgb(94.117647%,94.117647%,94.117647%);fill-opacity:1;\" d=\"M 2.25 10.125 L 2.25 9.75 L 9.75 9.75 L 9.75 10.125 Z M 2.25 10.125 \"/>\n\t\t\t</g>\n\t\t</svg>`,\n};\n\nexport type IconName = keyof typeof ICONS;\n\nconst OPENING_TAG_REGEX = /<svg([^>]*)>/g;\n\nexport function getBuiltInIcon(iconName: IconName, color: string, size: number): string;\nexport function getBuiltInIcon(iconName: string, color: string, size: number): string | null {\n\tconst icon = ICONS[iconName];\n\tif (!icon) {\n\t\treturn null;\n\t}\n\n\treturn icon.replace(\n\t\tOPENING_TAG_REGEX,\n\t\t`<svg$1 xmlns=\"http://www.w3.org/2000/svg\" style=\"fill:${color}; width:${size}px; height:${size}px\">`,\n\t);\n}\n\n/**\n * Sanitize an SVG string to be rendered in the DOM.\n */\nexport function sanitizeSVGString(svg: string) {\n\treturn DOMPurify.sanitize(svg, { USE_PROFILES: { svg: true } });\n}\n\n/**\n * Style a given SVG string by adding `fill=currentColor` and `stroke=currentColor` where appropriate\n * and setting `color` on the root element.\n */\nexport function styleSVGString(svg: string, color: string): string {\n\t// Extract the SVG content to apply styling easier\n\tconst parser = new DOMParser();\n\tconst doc = parser.parseFromString(svg, 'image/svg+xml');\n\tconst svgElement = doc.documentElement;\n\tif (svgElement == null || svgElement.tagName === 'parsererror' || svgElement.tagName.toLowerCase() !== 'svg') {\n\t\tLogger.error('Failed to parse SVG', { svg, tagName: svgElement?.tagName });\n\t\treturn svg;\n\t}\n\n\t// Apply color to all path and shape elements\n\tif (color != null) {\n\t\tsvgElement.setAttribute('color', color);\n\t\tconst innerElements = svgElement.querySelectorAll('*');\n\t\tinnerElements.forEach(element => {\n\t\t\tif (\n\t\t\t\t(element.getAttribute('fill') != null || element.tagName === 'path') &&\n\t\t\t\telement.getAttribute('fill') !== 'none'\n\t\t\t) {\n\t\t\t\telement.setAttribute('fill', 'currentColor');\n\t\t\t}\n\t\t\tif (element.getAttribute('stroke') != null && element.getAttribute('stroke') !== 'none') {\n\t\t\t\telement.setAttribute('stroke', 'currentColor');\n\t\t\t}\n\t\t});\n\t}\n\n\t// Convert back to string\n\tconst serializer = new XMLSerializer();\n\treturn serializer.serializeToString(svgElement);\n}\n\n/**\n * Fetch an SVG from a URL and return it as a string.\n */\nexport async function fetchIcon(\n\turl: string,\n\toptions?: { color?: string; style?: 'default' | 'fill' },\n): Promise<{ icon: string; type: 'svg' | 'image' } | null> {\n\tlet icon = '';\n\ttry {\n\t\tif (url.trim() === '') {\n\t\t\tthrow new Error('URL is empty!');\n\t\t}\n\n\t\tif (options?.style === 'fill') {\n\t\t\turl = url.replace('.svg', '-fill.svg');\n\t\t}\n\n\t\tconst res = await isomorphicFetch()(url);\n\t\t// Check if the response is an SVG\n\t\tconst contentType = res.headers.get('content-type');\n\t\tif (contentType?.includes('image/svg+xml')) {\n\t\t\tconst raw = await res.text();\n\t\t\ticon = sanitizeSVGString(raw);\n\t\t\tif (options?.color != null) {\n\t\t\t\ticon = styleSVGString(icon, options.color);\n\t\t\t}\n\t\t\treturn { icon, type: 'svg' };\n\t\t} else if (contentType?.includes('image')) {\n\t\t\t// Label creation will fetch the image from cached now that we've fetched it here\n\t\t\treturn { icon: url, type: 'image' };\n\t\t} else {\n\t\t\tthrow new Error(`Expected SVG or Image content, but received: ${contentType}`);\n\t\t}\n\t} catch (e) {\n\t\tLogger.error(`Failed to fetch icon from ${url}.`, e);\n\t\treturn null;\n\t}\n}\n", "const {\n  entries,\n  setPrototypeOf,\n  isFrozen,\n  getPrototypeOf,\n  getOwnPropertyDescriptor,\n} = Object;\n\nlet { freeze, seal, create } = Object; // eslint-disable-line import/no-mutable-exports\nlet { apply, construct } = typeof Reflect !== 'undefined' && Reflect;\n\nif (!freeze) {\n  freeze = function (x) {\n    return x;\n  };\n}\n\nif (!seal) {\n  seal = function (x) {\n    return x;\n  };\n}\n\nif (!apply) {\n  apply = function (fun, thisValue, args) {\n    return fun.apply(thisValue, args);\n  };\n}\n\nif (!construct) {\n  construct = function (Func, args) {\n    return new Func(...args);\n  };\n}\n\nconst arrayForEach = unapply(Array.prototype.forEach);\nconst arrayIndexOf = unapply(Array.prototype.indexOf);\nconst arrayLastIndexOf = unapply(Array.prototype.lastIndexOf);\nconst arrayPop = unapply(Array.prototype.pop);\nconst arrayPush = unapply(Array.prototype.push);\nconst arraySlice = unapply(Array.prototype.slice);\nconst arraySplice = unapply(Array.prototype.splice);\n\nconst stringToLowerCase = unapply(String.prototype.toLowerCase);\nconst stringToString = unapply(String.prototype.toString);\nconst stringMatch = unapply(String.prototype.match);\nconst stringReplace = unapply(String.prototype.replace);\nconst stringIndexOf = unapply(String.prototype.indexOf);\nconst stringTrim = unapply(String.prototype.trim);\n\nconst objectHasOwnProperty = unapply(Object.prototype.hasOwnProperty);\n\nconst regExpTest = unapply(RegExp.prototype.test);\n\nconst typeErrorCreate = unconstruct(TypeError);\n\n/**\n * Creates a new function that calls the given function with a specified thisArg and arguments.\n *\n * @param func - The function to be wrapped and called.\n * @returns A new function that calls the given function with a specified thisArg and arguments.\n */\nfunction unapply<T>(\n  func: (thisArg: any, ...args: any[]) => T\n): (thisArg: any, ...args: any[]) => T {\n  return (thisArg: any, ...args: any[]): T => {\n    if (thisArg instanceof RegExp) {\n      thisArg.lastIndex = 0;\n    }\n\n    return apply(func, thisArg, args);\n  };\n}\n\n/**\n * Creates a new function that constructs an instance of the given constructor function with the provided arguments.\n *\n * @param func - The constructor function to be wrapped and called.\n * @returns A new function that constructs an instance of the given constructor function with the provided arguments.\n */\nfunction unconstruct<T>(func: (...args: any[]) => T): (...args: any[]) => T {\n  return (...args: any[]): T => construct(func, args);\n}\n\n/**\n * Add properties to a lookup table\n *\n * @param set - The set to which elements will be added.\n * @param array - The array containing elements to be added to the set.\n * @param transformCaseFunc - An optional function to transform the case of each element before adding to the set.\n * @returns The modified set with added elements.\n */\nfunction addToSet(\n  set: Record<string, any>,\n  array: readonly any[],\n  transformCaseFunc: ReturnType<typeof unapply<string>> = stringToLowerCase\n): Record<string, any> {\n  if (setPrototypeOf) {\n    // Make 'in' and truthy checks like Boolean(set.constructor)\n    // independent of any properties defined on Object.prototype.\n    // Prevent prototype setters from intercepting set as a this value.\n    setPrototypeOf(set, null);\n  }\n\n  let l = array.length;\n  while (l--) {\n    let element = array[l];\n    if (typeof element === 'string') {\n      const lcElement = transformCaseFunc(element);\n      if (lcElement !== element) {\n        // Config presets (e.g. tags.js, attrs.js) are immutable.\n        if (!isFrozen(array)) {\n          (array as any[])[l] = lcElement;\n        }\n\n        element = lcElement;\n      }\n    }\n\n    set[element] = true;\n  }\n\n  return set;\n}\n\n/**\n * Clean up an array to harden against CSPP\n *\n * @param array - The array to be cleaned.\n * @returns The cleaned version of the array\n */\nfunction cleanArray<T>(array: T[]): Array<T | null> {\n  for (let index = 0; index < array.length; index++) {\n    const isPropertyExist = objectHasOwnProperty(array, index);\n\n    if (!isPropertyExist) {\n      array[index] = null;\n    }\n  }\n\n  return array;\n}\n\n/**\n * Shallow clone an object\n *\n * @param object - The object to be cloned.\n * @returns A new object that copies the original.\n */\nfunction clone<T extends Record<string, any>>(object: T): T {\n  const newObject = create(null);\n\n  for (const [property, value] of entries(object)) {\n    const isPropertyExist = objectHasOwnProperty(object, property);\n\n    if (isPropertyExist) {\n      if (Array.isArray(value)) {\n        newObject[property] = cleanArray(value);\n      } else if (\n        value &&\n        typeof value === 'object' &&\n        value.constructor === Object\n      ) {\n        newObject[property] = clone(value);\n      } else {\n        newObject[property] = value;\n      }\n    }\n  }\n\n  return newObject;\n}\n\n/**\n * This method automatically checks if the prop is function or getter and behaves accordingly.\n *\n * @param object - The object to look up the getter function in its prototype chain.\n * @param prop - The property name for which to find the getter function.\n * @returns The getter function found in the prototype chain or a fallback function.\n */\nfunction lookupGetter<T extends Record<string, any>>(\n  object: T,\n  prop: string\n): ReturnType<typeof unapply<any>> | (() => null) {\n  while (object !== null) {\n    const desc = getOwnPropertyDescriptor(object, prop);\n\n    if (desc) {\n      if (desc.get) {\n        return unapply(desc.get);\n      }\n\n      if (typeof desc.value === 'function') {\n        return unapply(desc.value);\n      }\n    }\n\n    object = getPrototypeOf(object);\n  }\n\n  function fallbackValue(): null {\n    return null;\n  }\n\n  return fallbackValue;\n}\n\nexport {\n  // Array\n  arrayForEach,\n  arrayIndexOf,\n  arrayLastIndexOf,\n  arrayPop,\n  arrayPush,\n  arraySlice,\n  arraySplice,\n  // Object\n  entries,\n  freeze,\n  getPrototypeOf,\n  getOwnPropertyDescriptor,\n  isFrozen,\n  setPrototypeOf,\n  seal,\n  clone,\n  create,\n  objectHasOwnProperty,\n  // RegExp\n  regExpTest,\n  // String\n  stringIndexOf,\n  stringMatch,\n  stringReplace,\n  stringToLowerCase,\n  stringToString,\n  stringTrim,\n  // Errors\n  typeErrorCreate,\n  // Other\n  lookupGetter,\n  addToSet,\n  // Reflect\n  unapply,\n  unconstruct,\n};\n", "import { freeze } from './utils.js';\n\nexport const html = freeze([\n  'a',\n  'abbr',\n  'acronym',\n  'address',\n  'area',\n  'article',\n  'aside',\n  'audio',\n  'b',\n  'bdi',\n  'bdo',\n  'big',\n  'blink',\n  'blockquote',\n  'body',\n  'br',\n  'button',\n  'canvas',\n  'caption',\n  'center',\n  'cite',\n  'code',\n  'col',\n  'colgroup',\n  'content',\n  'data',\n  'datalist',\n  'dd',\n  'decorator',\n  'del',\n  'details',\n  'dfn',\n  'dialog',\n  'dir',\n  'div',\n  'dl',\n  'dt',\n  'element',\n  'em',\n  'fieldset',\n  'figcaption',\n  'figure',\n  'font',\n  'footer',\n  'form',\n  'h1',\n  'h2',\n  'h3',\n  'h4',\n  'h5',\n  'h6',\n  'head',\n  'header',\n  'hgroup',\n  'hr',\n  'html',\n  'i',\n  'img',\n  'input',\n  'ins',\n  'kbd',\n  'label',\n  'legend',\n  'li',\n  'main',\n  'map',\n  'mark',\n  'marquee',\n  'menu',\n  'menuitem',\n  'meter',\n  'nav',\n  'nobr',\n  'ol',\n  'optgroup',\n  'option',\n  'output',\n  'p',\n  'picture',\n  'pre',\n  'progress',\n  'q',\n  'rp',\n  'rt',\n  'ruby',\n  's',\n  'samp',\n  'section',\n  'select',\n  'shadow',\n  'small',\n  'source',\n  'spacer',\n  'span',\n  'strike',\n  'strong',\n  'style',\n  'sub',\n  'summary',\n  'sup',\n  'table',\n  'tbody',\n  'td',\n  'template',\n  'textarea',\n  'tfoot',\n  'th',\n  'thead',\n  'time',\n  'tr',\n  'track',\n  'tt',\n  'u',\n  'ul',\n  'var',\n  'video',\n  'wbr',\n] as const);\n\nexport const svg = freeze([\n  'svg',\n  'a',\n  'altglyph',\n  'altglyphdef',\n  'altglyphitem',\n  'animatecolor',\n  'animatemotion',\n  'animatetransform',\n  'circle',\n  'clippath',\n  'defs',\n  'desc',\n  'ellipse',\n  'filter',\n  'font',\n  'g',\n  'glyph',\n  'glyphref',\n  'hkern',\n  'image',\n  'line',\n  'lineargradient',\n  'marker',\n  'mask',\n  'metadata',\n  'mpath',\n  'path',\n  'pattern',\n  'polygon',\n  'polyline',\n  'radialgradient',\n  'rect',\n  'stop',\n  'style',\n  'switch',\n  'symbol',\n  'text',\n  'textpath',\n  'title',\n  'tref',\n  'tspan',\n  'view',\n  'vkern',\n] as const);\n\nexport const svgFilters = freeze([\n  'feBlend',\n  'feColorMatrix',\n  'feComponentTransfer',\n  'feComposite',\n  'feConvolveMatrix',\n  'feDiffuseLighting',\n  'feDisplacementMap',\n  'feDistantLight',\n  'feDropShadow',\n  'feFlood',\n  'feFuncA',\n  'feFuncB',\n  'feFuncG',\n  'feFuncR',\n  'feGaussianBlur',\n  'feImage',\n  'feMerge',\n  'feMergeNode',\n  'feMorphology',\n  'feOffset',\n  'fePointLight',\n  'feSpecularLighting',\n  'feSpotLight',\n  'feTile',\n  'feTurbulence',\n] as const);\n\n// List of SVG elements that are disallowed by default.\n// We still need to know them so that we can do namespace\n// checks properly in case one wants to add them to\n// allow-list.\nexport const svgDisallowed = freeze([\n  'animate',\n  'color-profile',\n  'cursor',\n  'discard',\n  'font-face',\n  'font-face-format',\n  'font-face-name',\n  'font-face-src',\n  'font-face-uri',\n  'foreignobject',\n  'hatch',\n  'hatchpath',\n  'mesh',\n  'meshgradient',\n  'meshpatch',\n  'meshrow',\n  'missing-glyph',\n  'script',\n  'set',\n  'solidcolor',\n  'unknown',\n  'use',\n] as const);\n\nexport const mathMl = freeze([\n  'math',\n  'menclose',\n  'merror',\n  'mfenced',\n  'mfrac',\n  'mglyph',\n  'mi',\n  'mlabeledtr',\n  'mmultiscripts',\n  'mn',\n  'mo',\n  'mover',\n  'mpadded',\n  'mphantom',\n  'mroot',\n  'mrow',\n  'ms',\n  'mspace',\n  'msqrt',\n  'mstyle',\n  'msub',\n  'msup',\n  'msubsup',\n  'mtable',\n  'mtd',\n  'mtext',\n  'mtr',\n  'munder',\n  'munderover',\n  'mprescripts',\n] as const);\n\n// Similarly to SVG, we want to know all MathML elements,\n// even those that we disallow by default.\nexport const mathMlDisallowed = freeze([\n  'maction',\n  'maligngroup',\n  'malignmark',\n  'mlongdiv',\n  'mscarries',\n  'mscarry',\n  'msgroup',\n  'mstack',\n  'msline',\n  'msrow',\n  'semantics',\n  'annotation',\n  'annotation-xml',\n  'mprescripts',\n  'none',\n] as const);\n\nexport const text = freeze(['#text'] as const);\n", "import { freeze } from './utils.js';\n\nexport const html = freeze([\n  'accept',\n  'action',\n  'align',\n  'alt',\n  'autocapitalize',\n  'autocomplete',\n  'autopictureinpicture',\n  'autoplay',\n  'background',\n  'bgcolor',\n  'border',\n  'capture',\n  'cellpadding',\n  'cellspacing',\n  'checked',\n  'cite',\n  'class',\n  'clear',\n  'color',\n  'cols',\n  'colspan',\n  'controls',\n  'controlslist',\n  'coords',\n  'crossorigin',\n  'datetime',\n  'decoding',\n  'default',\n  'dir',\n  'disabled',\n  'disablepictureinpicture',\n  'disableremoteplayback',\n  'download',\n  'draggable',\n  'enctype',\n  'enterkeyhint',\n  'face',\n  'for',\n  'headers',\n  'height',\n  'hidden',\n  'high',\n  'href',\n  'hreflang',\n  'id',\n  'inputmode',\n  'integrity',\n  'ismap',\n  'kind',\n  'label',\n  'lang',\n  'list',\n  'loading',\n  'loop',\n  'low',\n  'max',\n  'maxlength',\n  'media',\n  'method',\n  'min',\n  'minlength',\n  'multiple',\n  'muted',\n  'name',\n  'nonce',\n  'noshade',\n  'novalidate',\n  'nowrap',\n  'open',\n  'optimum',\n  'pattern',\n  'placeholder',\n  'playsinline',\n  'popover',\n  'popovertarget',\n  'popovertargetaction',\n  'poster',\n  'preload',\n  'pubdate',\n  'radiogroup',\n  'readonly',\n  'rel',\n  'required',\n  'rev',\n  'reversed',\n  'role',\n  'rows',\n  'rowspan',\n  'spellcheck',\n  'scope',\n  'selected',\n  'shape',\n  'size',\n  'sizes',\n  'span',\n  'srclang',\n  'start',\n  'src',\n  'srcset',\n  'step',\n  'style',\n  'summary',\n  'tabindex',\n  'title',\n  'translate',\n  'type',\n  'usemap',\n  'valign',\n  'value',\n  'width',\n  'wrap',\n  'xmlns',\n  'slot',\n] as const);\n\nexport const svg = freeze([\n  'accent-height',\n  'accumulate',\n  'additive',\n  'alignment-baseline',\n  'amplitude',\n  'ascent',\n  'attributename',\n  'attributetype',\n  'azimuth',\n  'basefrequency',\n  'baseline-shift',\n  'begin',\n  'bias',\n  'by',\n  'class',\n  'clip',\n  'clippathunits',\n  'clip-path',\n  'clip-rule',\n  'color',\n  'color-interpolation',\n  'color-interpolation-filters',\n  'color-profile',\n  'color-rendering',\n  'cx',\n  'cy',\n  'd',\n  'dx',\n  'dy',\n  'diffuseconstant',\n  'direction',\n  'display',\n  'divisor',\n  'dur',\n  'edgemode',\n  'elevation',\n  'end',\n  'exponent',\n  'fill',\n  'fill-opacity',\n  'fill-rule',\n  'filter',\n  'filterunits',\n  'flood-color',\n  'flood-opacity',\n  'font-family',\n  'font-size',\n  'font-size-adjust',\n  'font-stretch',\n  'font-style',\n  'font-variant',\n  'font-weight',\n  'fx',\n  'fy',\n  'g1',\n  'g2',\n  'glyph-name',\n  'glyphref',\n  'gradientunits',\n  'gradienttransform',\n  'height',\n  'href',\n  'id',\n  'image-rendering',\n  'in',\n  'in2',\n  'intercept',\n  'k',\n  'k1',\n  'k2',\n  'k3',\n  'k4',\n  'kerning',\n  'keypoints',\n  'keysplines',\n  'keytimes',\n  'lang',\n  'lengthadjust',\n  'letter-spacing',\n  'kernelmatrix',\n  'kernelunitlength',\n  'lighting-color',\n  'local',\n  'marker-end',\n  'marker-mid',\n  'marker-start',\n  'markerheight',\n  'markerunits',\n  'markerwidth',\n  'maskcontentunits',\n  'maskunits',\n  'max',\n  'mask',\n  'media',\n  'method',\n  'mode',\n  'min',\n  'name',\n  'numoctaves',\n  'offset',\n  'operator',\n  'opacity',\n  'order',\n  'orient',\n  'orientation',\n  'origin',\n  'overflow',\n  'paint-order',\n  'path',\n  'pathlength',\n  'patterncontentunits',\n  'patterntransform',\n  'patternunits',\n  'points',\n  'preservealpha',\n  'preserveaspectratio',\n  'primitiveunits',\n  'r',\n  'rx',\n  'ry',\n  'radius',\n  'refx',\n  'refy',\n  'repeatcount',\n  'repeatdur',\n  'restart',\n  'result',\n  'rotate',\n  'scale',\n  'seed',\n  'shape-rendering',\n  'slope',\n  'specularconstant',\n  'specularexponent',\n  'spreadmethod',\n  'startoffset',\n  'stddeviation',\n  'stitchtiles',\n  'stop-color',\n  'stop-opacity',\n  'stroke-dasharray',\n  'stroke-dashoffset',\n  'stroke-linecap',\n  'stroke-linejoin',\n  'stroke-miterlimit',\n  'stroke-opacity',\n  'stroke',\n  'stroke-width',\n  'style',\n  'surfacescale',\n  'systemlanguage',\n  'tabindex',\n  'tablevalues',\n  'targetx',\n  'targety',\n  'transform',\n  'transform-origin',\n  'text-anchor',\n  'text-decoration',\n  'text-rendering',\n  'textlength',\n  'type',\n  'u1',\n  'u2',\n  'unicode',\n  'values',\n  'viewbox',\n  'visibility',\n  'version',\n  'vert-adv-y',\n  'vert-origin-x',\n  'vert-origin-y',\n  'width',\n  'word-spacing',\n  'wrap',\n  'writing-mode',\n  'xchannelselector',\n  'ychannelselector',\n  'x',\n  'x1',\n  'x2',\n  'xmlns',\n  'y',\n  'y1',\n  'y2',\n  'z',\n  'zoomandpan',\n] as const);\n\nexport const mathMl = freeze([\n  'accent',\n  'accentunder',\n  'align',\n  'bevelled',\n  'close',\n  'columnsalign',\n  'columnlines',\n  'columnspan',\n  'denomalign',\n  'depth',\n  'dir',\n  'display',\n  'displaystyle',\n  'encoding',\n  'fence',\n  'frame',\n  'height',\n  'href',\n  'id',\n  'largeop',\n  'length',\n  'linethickness',\n  'lspace',\n  'lquote',\n  'mathbackground',\n  'mathcolor',\n  'mathsize',\n  'mathvariant',\n  'maxsize',\n  'minsize',\n  'movablelimits',\n  'notation',\n  'numalign',\n  'open',\n  'rowalign',\n  'rowlines',\n  'rowspacing',\n  'rowspan',\n  'rspace',\n  'rquote',\n  'scriptlevel',\n  'scriptminsize',\n  'scriptsizemultiplier',\n  'selection',\n  'separator',\n  'separators',\n  'stretchy',\n  'subscriptshift',\n  'supscriptshift',\n  'symmetric',\n  'voffset',\n  'width',\n  'xmlns',\n]);\n\nexport const xml = freeze([\n  'xlink:href',\n  'xml:id',\n  'xlink:title',\n  'xml:space',\n  'xmlns:xlink',\n] as const);\n", "import { seal } from './utils.js';\n\n// eslint-disable-next-line unicorn/better-regex\nexport const MUSTACHE_EXPR = seal(/\\{\\{[\\w\\W]*|[\\w\\W]*\\}\\}/gm); // Specify template detection regex for SAFE_FOR_TEMPLATES mode\nexport const ERB_EXPR = seal(/<%[\\w\\W]*|[\\w\\W]*%>/gm);\nexport const TMPLIT_EXPR = seal(/\\$\\{[\\w\\W]*/gm); // eslint-disable-line unicorn/better-regex\nexport const DATA_ATTR = seal(/^data-[\\-\\w.\\u00B7-\\uFFFF]+$/); // eslint-disable-line no-useless-escape\nexport const ARIA_ATTR = seal(/^aria-[\\-\\w]+$/); // eslint-disable-line no-useless-escape\nexport const IS_ALLOWED_URI = seal(\n  /^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i // eslint-disable-line no-useless-escape\n);\nexport const IS_SCRIPT_OR_DATA = seal(/^(?:\\w+script|data):/i);\nexport const ATTR_WHITESPACE = seal(\n  /[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g // eslint-disable-line no-control-regex\n);\nexport const DOCTYPE_NAME = seal(/^html$/i);\nexport const CUSTOM_ELEMENT = seal(/^[a-z][.\\w]*(-[.\\w]+)+$/i);\n", "/* eslint-disable @typescript-eslint/indent */\n\nimport type { TrustedHTML, TrustedTypesWindow } from 'trusted-types/lib';\nimport type { Config, UseProfilesConfig } from './config';\nimport * as TAGS from './tags.js';\nimport * as ATTRS from './attrs.js';\nimport * as EXPRESSIONS from './regexp.js';\nimport {\n  addToSet,\n  clone,\n  entries,\n  freeze,\n  arrayForEach,\n  arrayLastIndexOf,\n  arrayPop,\n  arrayPush,\n  arraySplice,\n  stringMatch,\n  stringReplace,\n  stringToLowerCase,\n  stringToString,\n  stringIndexOf,\n  stringTrim,\n  regExpTest,\n  typeErrorCreate,\n  lookupGetter,\n  create,\n  objectHasOwnProperty,\n} from './utils.js';\n\nexport type { Config } from './config';\n\ndeclare const VERSION: string;\n\n// https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\nconst NODE_TYPE = {\n  element: 1,\n  attribute: 2,\n  text: 3,\n  cdataSection: 4,\n  entityReference: 5, // Deprecated\n  entityNode: 6, // Deprecated\n  progressingInstruction: 7,\n  comment: 8,\n  document: 9,\n  documentType: 10,\n  documentFragment: 11,\n  notation: 12, // Deprecated\n};\n\nconst getGlobal = function (): WindowLike {\n  return typeof window === 'undefined' ? null : window;\n};\n\n/**\n * Creates a no-op policy for internal use only.\n * Don't export this function outside this module!\n * @param trustedTypes The policy factory.\n * @param purifyHostElement The Script element used to load DOMPurify (to determine policy name suffix).\n * @return The policy created (or null, if Trusted Types\n * are not supported or creating the policy failed).\n */\nconst _createTrustedTypesPolicy = function (\n  trustedTypes: TrustedTypePolicyFactory,\n  purifyHostElement: HTMLScriptElement\n) {\n  if (\n    typeof trustedTypes !== 'object' ||\n    typeof trustedTypes.createPolicy !== 'function'\n  ) {\n    return null;\n  }\n\n  // Allow the callers to control the unique policy name\n  // by adding a data-tt-policy-suffix to the script element with the DOMPurify.\n  // Policy creation with duplicate names throws in Trusted Types.\n  let suffix = null;\n  const ATTR_NAME = 'data-tt-policy-suffix';\n  if (purifyHostElement && purifyHostElement.hasAttribute(ATTR_NAME)) {\n    suffix = purifyHostElement.getAttribute(ATTR_NAME);\n  }\n\n  const policyName = 'dompurify' + (suffix ? '#' + suffix : '');\n\n  try {\n    return trustedTypes.createPolicy(policyName, {\n      createHTML(html) {\n        return html;\n      },\n      createScriptURL(scriptUrl) {\n        return scriptUrl;\n      },\n    });\n  } catch (_) {\n    // Policy creation failed (most likely another DOMPurify script has\n    // already run). Skip creating the policy, as this will only cause errors\n    // if TT are enforced.\n    console.warn(\n      'TrustedTypes policy ' + policyName + ' could not be created.'\n    );\n    return null;\n  }\n};\n\nconst _createHooksMap = function (): HooksMap {\n  return {\n    afterSanitizeAttributes: [],\n    afterSanitizeElements: [],\n    afterSanitizeShadowDOM: [],\n    beforeSanitizeAttributes: [],\n    beforeSanitizeElements: [],\n    beforeSanitizeShadowDOM: [],\n    uponSanitizeAttribute: [],\n    uponSanitizeElement: [],\n    uponSanitizeShadowNode: [],\n  };\n};\n\nfunction createDOMPurify(window: WindowLike = getGlobal()): DOMPurify {\n  const DOMPurify: DOMPurify = (root: WindowLike) => createDOMPurify(root);\n\n  DOMPurify.version = VERSION;\n\n  DOMPurify.removed = [];\n\n  if (\n    !window ||\n    !window.document ||\n    window.document.nodeType !== NODE_TYPE.document ||\n    !window.Element\n  ) {\n    // Not running in a browser, provide a factory function\n    // so that you can pass your own Window\n    DOMPurify.isSupported = false;\n\n    return DOMPurify;\n  }\n\n  let { document } = window;\n\n  const originalDocument = document;\n  const currentScript: HTMLScriptElement =\n    originalDocument.currentScript as HTMLScriptElement;\n  const {\n    DocumentFragment,\n    HTMLTemplateElement,\n    Node,\n    Element,\n    NodeFilter,\n    NamedNodeMap = window.NamedNodeMap || (window as any).MozNamedAttrMap,\n    HTMLFormElement,\n    DOMParser,\n    trustedTypes,\n  } = window;\n\n  const ElementPrototype = Element.prototype;\n\n  const cloneNode = lookupGetter(ElementPrototype, 'cloneNode');\n  const remove = lookupGetter(ElementPrototype, 'remove');\n  const getNextSibling = lookupGetter(ElementPrototype, 'nextSibling');\n  const getChildNodes = lookupGetter(ElementPrototype, 'childNodes');\n  const getParentNode = lookupGetter(ElementPrototype, 'parentNode');\n\n  // As per issue #47, the web-components registry is inherited by a\n  // new document created via createHTMLDocument. As per the spec\n  // (http://w3c.github.io/webcomponents/spec/custom/#creating-and-passing-registries)\n  // a new empty registry is used when creating a template contents owner\n  // document, so we use that as our parent document to ensure nothing\n  // is inherited.\n  if (typeof HTMLTemplateElement === 'function') {\n    const template = document.createElement('template');\n    if (template.content && template.content.ownerDocument) {\n      document = template.content.ownerDocument;\n    }\n  }\n\n  let trustedTypesPolicy;\n  let emptyHTML = '';\n\n  const {\n    implementation,\n    createNodeIterator,\n    createDocumentFragment,\n    getElementsByTagName,\n  } = document;\n  const { importNode } = originalDocument;\n\n  let hooks = _createHooksMap();\n\n  /**\n   * Expose whether this browser supports running the full DOMPurify.\n   */\n  DOMPurify.isSupported =\n    typeof entries === 'function' &&\n    typeof getParentNode === 'function' &&\n    implementation &&\n    implementation.createHTMLDocument !== undefined;\n\n  const {\n    MUSTACHE_EXPR,\n    ERB_EXPR,\n    TMPLIT_EXPR,\n    DATA_ATTR,\n    ARIA_ATTR,\n    IS_SCRIPT_OR_DATA,\n    ATTR_WHITESPACE,\n    CUSTOM_ELEMENT,\n  } = EXPRESSIONS;\n\n  let { IS_ALLOWED_URI } = EXPRESSIONS;\n\n  /**\n   * We consider the elements and attributes below to be safe. Ideally\n   * don't add any new ones but feel free to remove unwanted ones.\n   */\n\n  /* allowed element names */\n  let ALLOWED_TAGS = null;\n  const DEFAULT_ALLOWED_TAGS = addToSet({}, [\n    ...TAGS.html,\n    ...TAGS.svg,\n    ...TAGS.svgFilters,\n    ...TAGS.mathMl,\n    ...TAGS.text,\n  ]);\n\n  /* Allowed attribute names */\n  let ALLOWED_ATTR = null;\n  const DEFAULT_ALLOWED_ATTR = addToSet({}, [\n    ...ATTRS.html,\n    ...ATTRS.svg,\n    ...ATTRS.mathMl,\n    ...ATTRS.xml,\n  ]);\n\n  /*\n   * Configure how DOMPurify should handle custom elements and their attributes as well as customized built-in elements.\n   * @property {RegExp|Function|null} tagNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any custom elements)\n   * @property {RegExp|Function|null} attributeNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any attributes not on the allow list)\n   * @property {boolean} allowCustomizedBuiltInElements allow custom elements derived from built-ins if they pass CUSTOM_ELEMENT_HANDLING.tagNameCheck. Default: `false`.\n   */\n  let CUSTOM_ELEMENT_HANDLING = Object.seal(\n    create(null, {\n      tagNameCheck: {\n        writable: true,\n        configurable: false,\n        enumerable: true,\n        value: null,\n      },\n      attributeNameCheck: {\n        writable: true,\n        configurable: false,\n        enumerable: true,\n        value: null,\n      },\n      allowCustomizedBuiltInElements: {\n        writable: true,\n        configurable: false,\n        enumerable: true,\n        value: false,\n      },\n    })\n  );\n\n  /* Explicitly forbidden tags (overrides ALLOWED_TAGS/ADD_TAGS) */\n  let FORBID_TAGS = null;\n\n  /* Explicitly forbidden attributes (overrides ALLOWED_ATTR/ADD_ATTR) */\n  let FORBID_ATTR = null;\n\n  /* Decide if ARIA attributes are okay */\n  let ALLOW_ARIA_ATTR = true;\n\n  /* Decide if custom data attributes are okay */\n  let ALLOW_DATA_ATTR = true;\n\n  /* Decide if unknown protocols are okay */\n  let ALLOW_UNKNOWN_PROTOCOLS = false;\n\n  /* Decide if self-closing tags in attributes are allowed.\n   * Usually removed due to a mXSS issue in jQuery 3.0 */\n  let ALLOW_SELF_CLOSE_IN_ATTR = true;\n\n  /* Output should be safe for common template engines.\n   * This means, DOMPurify removes data attributes, mustaches and ERB\n   */\n  let SAFE_FOR_TEMPLATES = false;\n\n  /* Output should be safe even for XML used within HTML and alike.\n   * This means, DOMPurify removes comments when containing risky content.\n   */\n  let SAFE_FOR_XML = true;\n\n  /* Decide if document with <html>... should be returned */\n  let WHOLE_DOCUMENT = false;\n\n  /* Track whether config is already set on this instance of DOMPurify. */\n  let SET_CONFIG = false;\n\n  /* Decide if all elements (e.g. style, script) must be children of\n   * document.body. By default, browsers might move them to document.head */\n  let FORCE_BODY = false;\n\n  /* Decide if a DOM `HTMLBodyElement` should be returned, instead of a html\n   * string (or a TrustedHTML object if Trusted Types are supported).\n   * If `WHOLE_DOCUMENT` is enabled a `HTMLHtmlElement` will be returned instead\n   */\n  let RETURN_DOM = false;\n\n  /* Decide if a DOM `DocumentFragment` should be returned, instead of a html\n   * string  (or a TrustedHTML object if Trusted Types are supported) */\n  let RETURN_DOM_FRAGMENT = false;\n\n  /* Try to return a Trusted Type object instead of a string, return a string in\n   * case Trusted Types are not supported  */\n  let RETURN_TRUSTED_TYPE = false;\n\n  /* Output should be free from DOM clobbering attacks?\n   * This sanitizes markups named with colliding, clobberable built-in DOM APIs.\n   */\n  let SANITIZE_DOM = true;\n\n  /* Achieve full DOM Clobbering protection by isolating the namespace of named\n   * properties and JS variables, mitigating attacks that abuse the HTML/DOM spec rules.\n   *\n   * HTML/DOM spec rules that enable DOM Clobbering:\n   *   - Named Access on Window (§7.3.3)\n   *   - DOM Tree Accessors (§3.1.5)\n   *   - Form Element Parent-Child Relations (§4.10.3)\n   *   - Iframe srcdoc / Nested WindowProxies (§4.8.5)\n   *   - HTMLCollection (§4.2.10.2)\n   *\n   * Namespace isolation is implemented by prefixing `id` and `name` attributes\n   * with a constant string, i.e., `user-content-`\n   */\n  let SANITIZE_NAMED_PROPS = false;\n  const SANITIZE_NAMED_PROPS_PREFIX = 'user-content-';\n\n  /* Keep element content when removing element? */\n  let KEEP_CONTENT = true;\n\n  /* If a `Node` is passed to sanitize(), then performs sanitization in-place instead\n   * of importing it into a new Document and returning a sanitized copy */\n  let IN_PLACE = false;\n\n  /* Allow usage of profiles like html, svg and mathMl */\n  let USE_PROFILES: UseProfilesConfig | false = {};\n\n  /* Tags to ignore content of when KEEP_CONTENT is true */\n  let FORBID_CONTENTS = null;\n  const DEFAULT_FORBID_CONTENTS = addToSet({}, [\n    'annotation-xml',\n    'audio',\n    'colgroup',\n    'desc',\n    'foreignobject',\n    'head',\n    'iframe',\n    'math',\n    'mi',\n    'mn',\n    'mo',\n    'ms',\n    'mtext',\n    'noembed',\n    'noframes',\n    'noscript',\n    'plaintext',\n    'script',\n    'style',\n    'svg',\n    'template',\n    'thead',\n    'title',\n    'video',\n    'xmp',\n  ]);\n\n  /* Tags that are safe for data: URIs */\n  let DATA_URI_TAGS = null;\n  const DEFAULT_DATA_URI_TAGS = addToSet({}, [\n    'audio',\n    'video',\n    'img',\n    'source',\n    'image',\n    'track',\n  ]);\n\n  /* Attributes safe for values like \"javascript:\" */\n  let URI_SAFE_ATTRIBUTES = null;\n  const DEFAULT_URI_SAFE_ATTRIBUTES = addToSet({}, [\n    'alt',\n    'class',\n    'for',\n    'id',\n    'label',\n    'name',\n    'pattern',\n    'placeholder',\n    'role',\n    'summary',\n    'title',\n    'value',\n    'style',\n    'xmlns',\n  ]);\n\n  const MATHML_NAMESPACE = 'http://www.w3.org/1998/Math/MathML';\n  const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\n  const HTML_NAMESPACE = 'http://www.w3.org/1999/xhtml';\n  /* Document namespace */\n  let NAMESPACE = HTML_NAMESPACE;\n  let IS_EMPTY_INPUT = false;\n\n  /* Allowed XHTML+XML namespaces */\n  let ALLOWED_NAMESPACES = null;\n  const DEFAULT_ALLOWED_NAMESPACES = addToSet(\n    {},\n    [MATHML_NAMESPACE, SVG_NAMESPACE, HTML_NAMESPACE],\n    stringToString\n  );\n\n  let MATHML_TEXT_INTEGRATION_POINTS = addToSet({}, [\n    'mi',\n    'mo',\n    'mn',\n    'ms',\n    'mtext',\n  ]);\n\n  let HTML_INTEGRATION_POINTS = addToSet({}, ['annotation-xml']);\n\n  // Certain elements are allowed in both SVG and HTML\n  // namespace. We need to specify them explicitly\n  // so that they don't get erroneously deleted from\n  // HTML namespace.\n  const COMMON_SVG_AND_HTML_ELEMENTS = addToSet({}, [\n    'title',\n    'style',\n    'font',\n    'a',\n    'script',\n  ]);\n\n  /* Parsing of strict XHTML documents */\n  let PARSER_MEDIA_TYPE: null | DOMParserSupportedType = null;\n  const SUPPORTED_PARSER_MEDIA_TYPES = ['application/xhtml+xml', 'text/html'];\n  const DEFAULT_PARSER_MEDIA_TYPE = 'text/html';\n  let transformCaseFunc: null | Parameters<typeof addToSet>[2] = null;\n\n  /* Keep a reference to config to pass to hooks */\n  let CONFIG: Config | null = null;\n\n  /* Ideally, do not touch anything below this line */\n  /* ______________________________________________ */\n\n  const formElement = document.createElement('form');\n\n  const isRegexOrFunction = function (\n    testValue: unknown\n  ): testValue is Function | RegExp {\n    return testValue instanceof RegExp || testValue instanceof Function;\n  };\n\n  /**\n   * _parseConfig\n   *\n   * @param cfg optional config literal\n   */\n  // eslint-disable-next-line complexity\n  const _parseConfig = function (cfg: Config = {}): void {\n    if (CONFIG && CONFIG === cfg) {\n      return;\n    }\n\n    /* Shield configuration object from tampering */\n    if (!cfg || typeof cfg !== 'object') {\n      cfg = {};\n    }\n\n    /* Shield configuration object from prototype pollution */\n    cfg = clone(cfg);\n\n    PARSER_MEDIA_TYPE =\n      // eslint-disable-next-line unicorn/prefer-includes\n      SUPPORTED_PARSER_MEDIA_TYPES.indexOf(cfg.PARSER_MEDIA_TYPE) === -1\n        ? DEFAULT_PARSER_MEDIA_TYPE\n        : cfg.PARSER_MEDIA_TYPE;\n\n    // HTML tags and attributes are not case-sensitive, converting to lowercase. Keeping XHTML as is.\n    transformCaseFunc =\n      PARSER_MEDIA_TYPE === 'application/xhtml+xml'\n        ? stringToString\n        : stringToLowerCase;\n\n    /* Set configuration parameters */\n    ALLOWED_TAGS = objectHasOwnProperty(cfg, 'ALLOWED_TAGS')\n      ? addToSet({}, cfg.ALLOWED_TAGS, transformCaseFunc)\n      : DEFAULT_ALLOWED_TAGS;\n    ALLOWED_ATTR = objectHasOwnProperty(cfg, 'ALLOWED_ATTR')\n      ? addToSet({}, cfg.ALLOWED_ATTR, transformCaseFunc)\n      : DEFAULT_ALLOWED_ATTR;\n    ALLOWED_NAMESPACES = objectHasOwnProperty(cfg, 'ALLOWED_NAMESPACES')\n      ? addToSet({}, cfg.ALLOWED_NAMESPACES, stringToString)\n      : DEFAULT_ALLOWED_NAMESPACES;\n    URI_SAFE_ATTRIBUTES = objectHasOwnProperty(cfg, 'ADD_URI_SAFE_ATTR')\n      ? addToSet(\n          clone(DEFAULT_URI_SAFE_ATTRIBUTES),\n          cfg.ADD_URI_SAFE_ATTR,\n          transformCaseFunc\n        )\n      : DEFAULT_URI_SAFE_ATTRIBUTES;\n    DATA_URI_TAGS = objectHasOwnProperty(cfg, 'ADD_DATA_URI_TAGS')\n      ? addToSet(\n          clone(DEFAULT_DATA_URI_TAGS),\n          cfg.ADD_DATA_URI_TAGS,\n          transformCaseFunc\n        )\n      : DEFAULT_DATA_URI_TAGS;\n    FORBID_CONTENTS = objectHasOwnProperty(cfg, 'FORBID_CONTENTS')\n      ? addToSet({}, cfg.FORBID_CONTENTS, transformCaseFunc)\n      : DEFAULT_FORBID_CONTENTS;\n    FORBID_TAGS = objectHasOwnProperty(cfg, 'FORBID_TAGS')\n      ? addToSet({}, cfg.FORBID_TAGS, transformCaseFunc)\n      : clone({});\n    FORBID_ATTR = objectHasOwnProperty(cfg, 'FORBID_ATTR')\n      ? addToSet({}, cfg.FORBID_ATTR, transformCaseFunc)\n      : clone({});\n    USE_PROFILES = objectHasOwnProperty(cfg, 'USE_PROFILES')\n      ? cfg.USE_PROFILES\n      : false;\n    ALLOW_ARIA_ATTR = cfg.ALLOW_ARIA_ATTR !== false; // Default true\n    ALLOW_DATA_ATTR = cfg.ALLOW_DATA_ATTR !== false; // Default true\n    ALLOW_UNKNOWN_PROTOCOLS = cfg.ALLOW_UNKNOWN_PROTOCOLS || false; // Default false\n    ALLOW_SELF_CLOSE_IN_ATTR = cfg.ALLOW_SELF_CLOSE_IN_ATTR !== false; // Default true\n    SAFE_FOR_TEMPLATES = cfg.SAFE_FOR_TEMPLATES || false; // Default false\n    SAFE_FOR_XML = cfg.SAFE_FOR_XML !== false; // Default true\n    WHOLE_DOCUMENT = cfg.WHOLE_DOCUMENT || false; // Default false\n    RETURN_DOM = cfg.RETURN_DOM || false; // Default false\n    RETURN_DOM_FRAGMENT = cfg.RETURN_DOM_FRAGMENT || false; // Default false\n    RETURN_TRUSTED_TYPE = cfg.RETURN_TRUSTED_TYPE || false; // Default false\n    FORCE_BODY = cfg.FORCE_BODY || false; // Default false\n    SANITIZE_DOM = cfg.SANITIZE_DOM !== false; // Default true\n    SANITIZE_NAMED_PROPS = cfg.SANITIZE_NAMED_PROPS || false; // Default false\n    KEEP_CONTENT = cfg.KEEP_CONTENT !== false; // Default true\n    IN_PLACE = cfg.IN_PLACE || false; // Default false\n    IS_ALLOWED_URI = cfg.ALLOWED_URI_REGEXP || EXPRESSIONS.IS_ALLOWED_URI;\n    NAMESPACE = cfg.NAMESPACE || HTML_NAMESPACE;\n    MATHML_TEXT_INTEGRATION_POINTS =\n      cfg.MATHML_TEXT_INTEGRATION_POINTS || MATHML_TEXT_INTEGRATION_POINTS;\n    HTML_INTEGRATION_POINTS =\n      cfg.HTML_INTEGRATION_POINTS || HTML_INTEGRATION_POINTS;\n\n    CUSTOM_ELEMENT_HANDLING = cfg.CUSTOM_ELEMENT_HANDLING || {};\n    if (\n      cfg.CUSTOM_ELEMENT_HANDLING &&\n      isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck)\n    ) {\n      CUSTOM_ELEMENT_HANDLING.tagNameCheck =\n        cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck;\n    }\n\n    if (\n      cfg.CUSTOM_ELEMENT_HANDLING &&\n      isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)\n    ) {\n      CUSTOM_ELEMENT_HANDLING.attributeNameCheck =\n        cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;\n    }\n\n    if (\n      cfg.CUSTOM_ELEMENT_HANDLING &&\n      typeof cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements ===\n        'boolean'\n    ) {\n      CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements =\n        cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;\n    }\n\n    if (SAFE_FOR_TEMPLATES) {\n      ALLOW_DATA_ATTR = false;\n    }\n\n    if (RETURN_DOM_FRAGMENT) {\n      RETURN_DOM = true;\n    }\n\n    /* Parse profile info */\n    if (USE_PROFILES) {\n      ALLOWED_TAGS = addToSet({}, TAGS.text);\n      ALLOWED_ATTR = [];\n      if (USE_PROFILES.html === true) {\n        addToSet(ALLOWED_TAGS, TAGS.html);\n        addToSet(ALLOWED_ATTR, ATTRS.html);\n      }\n\n      if (USE_PROFILES.svg === true) {\n        addToSet(ALLOWED_TAGS, TAGS.svg);\n        addToSet(ALLOWED_ATTR, ATTRS.svg);\n        addToSet(ALLOWED_ATTR, ATTRS.xml);\n      }\n\n      if (USE_PROFILES.svgFilters === true) {\n        addToSet(ALLOWED_TAGS, TAGS.svgFilters);\n        addToSet(ALLOWED_ATTR, ATTRS.svg);\n        addToSet(ALLOWED_ATTR, ATTRS.xml);\n      }\n\n      if (USE_PROFILES.mathMl === true) {\n        addToSet(ALLOWED_TAGS, TAGS.mathMl);\n        addToSet(ALLOWED_ATTR, ATTRS.mathMl);\n        addToSet(ALLOWED_ATTR, ATTRS.xml);\n      }\n    }\n\n    /* Merge configuration parameters */\n    if (cfg.ADD_TAGS) {\n      if (ALLOWED_TAGS === DEFAULT_ALLOWED_TAGS) {\n        ALLOWED_TAGS = clone(ALLOWED_TAGS);\n      }\n\n      addToSet(ALLOWED_TAGS, cfg.ADD_TAGS, transformCaseFunc);\n    }\n\n    if (cfg.ADD_ATTR) {\n      if (ALLOWED_ATTR === DEFAULT_ALLOWED_ATTR) {\n        ALLOWED_ATTR = clone(ALLOWED_ATTR);\n      }\n\n      addToSet(ALLOWED_ATTR, cfg.ADD_ATTR, transformCaseFunc);\n    }\n\n    if (cfg.ADD_URI_SAFE_ATTR) {\n      addToSet(URI_SAFE_ATTRIBUTES, cfg.ADD_URI_SAFE_ATTR, transformCaseFunc);\n    }\n\n    if (cfg.FORBID_CONTENTS) {\n      if (FORBID_CONTENTS === DEFAULT_FORBID_CONTENTS) {\n        FORBID_CONTENTS = clone(FORBID_CONTENTS);\n      }\n\n      addToSet(FORBID_CONTENTS, cfg.FORBID_CONTENTS, transformCaseFunc);\n    }\n\n    /* Add #text in case KEEP_CONTENT is set to true */\n    if (KEEP_CONTENT) {\n      ALLOWED_TAGS['#text'] = true;\n    }\n\n    /* Add html, head and body to ALLOWED_TAGS in case WHOLE_DOCUMENT is true */\n    if (WHOLE_DOCUMENT) {\n      addToSet(ALLOWED_TAGS, ['html', 'head', 'body']);\n    }\n\n    /* Add tbody to ALLOWED_TAGS in case tables are permitted, see #286, #365 */\n    if (ALLOWED_TAGS.table) {\n      addToSet(ALLOWED_TAGS, ['tbody']);\n      delete FORBID_TAGS.tbody;\n    }\n\n    if (cfg.TRUSTED_TYPES_POLICY) {\n      if (typeof cfg.TRUSTED_TYPES_POLICY.createHTML !== 'function') {\n        throw typeErrorCreate(\n          'TRUSTED_TYPES_POLICY configuration option must provide a \"createHTML\" hook.'\n        );\n      }\n\n      if (typeof cfg.TRUSTED_TYPES_POLICY.createScriptURL !== 'function') {\n        throw typeErrorCreate(\n          'TRUSTED_TYPES_POLICY configuration option must provide a \"createScriptURL\" hook.'\n        );\n      }\n\n      // Overwrite existing TrustedTypes policy.\n      trustedTypesPolicy = cfg.TRUSTED_TYPES_POLICY;\n\n      // Sign local variables required by `sanitize`.\n      emptyHTML = trustedTypesPolicy.createHTML('');\n    } else {\n      // Uninitialized policy, attempt to initialize the internal dompurify policy.\n      if (trustedTypesPolicy === undefined) {\n        trustedTypesPolicy = _createTrustedTypesPolicy(\n          trustedTypes,\n          currentScript\n        );\n      }\n\n      // If creating the internal policy succeeded sign internal variables.\n      if (trustedTypesPolicy !== null && typeof emptyHTML === 'string') {\n        emptyHTML = trustedTypesPolicy.createHTML('');\n      }\n    }\n\n    // Prevent further manipulation of configuration.\n    // Not available in IE8, Safari 5, etc.\n    if (freeze) {\n      freeze(cfg);\n    }\n\n    CONFIG = cfg;\n  };\n\n  /* Keep track of all possible SVG and MathML tags\n   * so that we can perform the namespace checks\n   * correctly. */\n  const ALL_SVG_TAGS = addToSet({}, [\n    ...TAGS.svg,\n    ...TAGS.svgFilters,\n    ...TAGS.svgDisallowed,\n  ]);\n  const ALL_MATHML_TAGS = addToSet({}, [\n    ...TAGS.mathMl,\n    ...TAGS.mathMlDisallowed,\n  ]);\n\n  /**\n   * @param element a DOM element whose namespace is being checked\n   * @returns Return false if the element has a\n   *  namespace that a spec-compliant parser would never\n   *  return. Return true otherwise.\n   */\n  const _checkValidNamespace = function (element: Element): boolean {\n    let parent = getParentNode(element);\n\n    // In JSDOM, if we're inside shadow DOM, then parentNode\n    // can be null. We just simulate parent in this case.\n    if (!parent || !parent.tagName) {\n      parent = {\n        namespaceURI: NAMESPACE,\n        tagName: 'template',\n      };\n    }\n\n    const tagName = stringToLowerCase(element.tagName);\n    const parentTagName = stringToLowerCase(parent.tagName);\n\n    if (!ALLOWED_NAMESPACES[element.namespaceURI]) {\n      return false;\n    }\n\n    if (element.namespaceURI === SVG_NAMESPACE) {\n      // The only way to switch from HTML namespace to SVG\n      // is via <svg>. If it happens via any other tag, then\n      // it should be killed.\n      if (parent.namespaceURI === HTML_NAMESPACE) {\n        return tagName === 'svg';\n      }\n\n      // The only way to switch from MathML to SVG is via`\n      // svg if parent is either <annotation-xml> or MathML\n      // text integration points.\n      if (parent.namespaceURI === MATHML_NAMESPACE) {\n        return (\n          tagName === 'svg' &&\n          (parentTagName === 'annotation-xml' ||\n            MATHML_TEXT_INTEGRATION_POINTS[parentTagName])\n        );\n      }\n\n      // We only allow elements that are defined in SVG\n      // spec. All others are disallowed in SVG namespace.\n      return Boolean(ALL_SVG_TAGS[tagName]);\n    }\n\n    if (element.namespaceURI === MATHML_NAMESPACE) {\n      // The only way to switch from HTML namespace to MathML\n      // is via <math>. If it happens via any other tag, then\n      // it should be killed.\n      if (parent.namespaceURI === HTML_NAMESPACE) {\n        return tagName === 'math';\n      }\n\n      // The only way to switch from SVG to MathML is via\n      // <math> and HTML integration points\n      if (parent.namespaceURI === SVG_NAMESPACE) {\n        return tagName === 'math' && HTML_INTEGRATION_POINTS[parentTagName];\n      }\n\n      // We only allow elements that are defined in MathML\n      // spec. All others are disallowed in MathML namespace.\n      return Boolean(ALL_MATHML_TAGS[tagName]);\n    }\n\n    if (element.namespaceURI === HTML_NAMESPACE) {\n      // The only way to switch from SVG to HTML is via\n      // HTML integration points, and from MathML to HTML\n      // is via MathML text integration points\n      if (\n        parent.namespaceURI === SVG_NAMESPACE &&\n        !HTML_INTEGRATION_POINTS[parentTagName]\n      ) {\n        return false;\n      }\n\n      if (\n        parent.namespaceURI === MATHML_NAMESPACE &&\n        !MATHML_TEXT_INTEGRATION_POINTS[parentTagName]\n      ) {\n        return false;\n      }\n\n      // We disallow tags that are specific for MathML\n      // or SVG and should never appear in HTML namespace\n      return (\n        !ALL_MATHML_TAGS[tagName] &&\n        (COMMON_SVG_AND_HTML_ELEMENTS[tagName] || !ALL_SVG_TAGS[tagName])\n      );\n    }\n\n    // For XHTML and XML documents that support custom namespaces\n    if (\n      PARSER_MEDIA_TYPE === 'application/xhtml+xml' &&\n      ALLOWED_NAMESPACES[element.namespaceURI]\n    ) {\n      return true;\n    }\n\n    // The code should never reach this place (this means\n    // that the element somehow got namespace that is not\n    // HTML, SVG, MathML or allowed via ALLOWED_NAMESPACES).\n    // Return false just in case.\n    return false;\n  };\n\n  /**\n   * _forceRemove\n   *\n   * @param node a DOM node\n   */\n  const _forceRemove = function (node: Node): void {\n    arrayPush(DOMPurify.removed, { element: node });\n\n    try {\n      // eslint-disable-next-line unicorn/prefer-dom-node-remove\n      getParentNode(node).removeChild(node);\n    } catch (_) {\n      remove(node);\n    }\n  };\n\n  /**\n   * _removeAttribute\n   *\n   * @param name an Attribute name\n   * @param element a DOM node\n   */\n  const _removeAttribute = function (name: string, element: Element): void {\n    try {\n      arrayPush(DOMPurify.removed, {\n        attribute: element.getAttributeNode(name),\n        from: element,\n      });\n    } catch (_) {\n      arrayPush(DOMPurify.removed, {\n        attribute: null,\n        from: element,\n      });\n    }\n\n    element.removeAttribute(name);\n\n    // We void attribute values for unremovable \"is\" attributes\n    if (name === 'is') {\n      if (RETURN_DOM || RETURN_DOM_FRAGMENT) {\n        try {\n          _forceRemove(element);\n        } catch (_) {}\n      } else {\n        try {\n          element.setAttribute(name, '');\n        } catch (_) {}\n      }\n    }\n  };\n\n  /**\n   * _initDocument\n   *\n   * @param dirty - a string of dirty markup\n   * @return a DOM, filled with the dirty markup\n   */\n  const _initDocument = function (dirty: string): Document {\n    /* Create a HTML document */\n    let doc = null;\n    let leadingWhitespace = null;\n\n    if (FORCE_BODY) {\n      dirty = '<remove></remove>' + dirty;\n    } else {\n      /* If FORCE_BODY isn't used, leading whitespace needs to be preserved manually */\n      const matches = stringMatch(dirty, /^[\\r\\n\\t ]+/);\n      leadingWhitespace = matches && matches[0];\n    }\n\n    if (\n      PARSER_MEDIA_TYPE === 'application/xhtml+xml' &&\n      NAMESPACE === HTML_NAMESPACE\n    ) {\n      // Root of XHTML doc must contain xmlns declaration (see https://www.w3.org/TR/xhtml1/normative.html#strict)\n      dirty =\n        '<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>' +\n        dirty +\n        '</body></html>';\n    }\n\n    const dirtyPayload = trustedTypesPolicy\n      ? trustedTypesPolicy.createHTML(dirty)\n      : dirty;\n    /*\n     * Use the DOMParser API by default, fallback later if needs be\n     * DOMParser not work for svg when has multiple root element.\n     */\n    if (NAMESPACE === HTML_NAMESPACE) {\n      try {\n        doc = new DOMParser().parseFromString(dirtyPayload, PARSER_MEDIA_TYPE);\n      } catch (_) {}\n    }\n\n    /* Use createHTMLDocument in case DOMParser is not available */\n    if (!doc || !doc.documentElement) {\n      doc = implementation.createDocument(NAMESPACE, 'template', null);\n      try {\n        doc.documentElement.innerHTML = IS_EMPTY_INPUT\n          ? emptyHTML\n          : dirtyPayload;\n      } catch (_) {\n        // Syntax error if dirtyPayload is invalid xml\n      }\n    }\n\n    const body = doc.body || doc.documentElement;\n\n    if (dirty && leadingWhitespace) {\n      body.insertBefore(\n        document.createTextNode(leadingWhitespace),\n        body.childNodes[0] || null\n      );\n    }\n\n    /* Work on whole document or just its body */\n    if (NAMESPACE === HTML_NAMESPACE) {\n      return getElementsByTagName.call(\n        doc,\n        WHOLE_DOCUMENT ? 'html' : 'body'\n      )[0];\n    }\n\n    return WHOLE_DOCUMENT ? doc.documentElement : body;\n  };\n\n  /**\n   * Creates a NodeIterator object that you can use to traverse filtered lists of nodes or elements in a document.\n   *\n   * @param root The root element or node to start traversing on.\n   * @return The created NodeIterator\n   */\n  const _createNodeIterator = function (root: Node): NodeIterator {\n    return createNodeIterator.call(\n      root.ownerDocument || root,\n      root,\n      // eslint-disable-next-line no-bitwise\n      NodeFilter.SHOW_ELEMENT |\n        NodeFilter.SHOW_COMMENT |\n        NodeFilter.SHOW_TEXT |\n        NodeFilter.SHOW_PROCESSING_INSTRUCTION |\n        NodeFilter.SHOW_CDATA_SECTION,\n      null\n    );\n  };\n\n  /**\n   * _isClobbered\n   *\n   * @param element element to check for clobbering attacks\n   * @return true if clobbered, false if safe\n   */\n  const _isClobbered = function (element: Element): boolean {\n    return (\n      element instanceof HTMLFormElement &&\n      (typeof element.nodeName !== 'string' ||\n        typeof element.textContent !== 'string' ||\n        typeof element.removeChild !== 'function' ||\n        !(element.attributes instanceof NamedNodeMap) ||\n        typeof element.removeAttribute !== 'function' ||\n        typeof element.setAttribute !== 'function' ||\n        typeof element.namespaceURI !== 'string' ||\n        typeof element.insertBefore !== 'function' ||\n        typeof element.hasChildNodes !== 'function')\n    );\n  };\n\n  /**\n   * Checks whether the given object is a DOM node.\n   *\n   * @param value object to check whether it's a DOM node\n   * @return true is object is a DOM node\n   */\n  const _isNode = function (value: unknown): value is Node {\n    return typeof Node === 'function' && value instanceof Node;\n  };\n\n  function _executeHooks<\n    T extends\n      | NodeHook\n      | ElementHook\n      | DocumentFragmentHook\n      | UponSanitizeElementHook\n      | UponSanitizeAttributeHook\n  >(hooks: T[], currentNode: Parameters<T>[0], data: Parameters<T>[1]): void {\n    arrayForEach(hooks, (hook) => {\n      hook.call(DOMPurify, currentNode, data, CONFIG);\n    });\n  }\n\n  /**\n   * _sanitizeElements\n   *\n   * @protect nodeName\n   * @protect textContent\n   * @protect removeChild\n   * @param currentNode to check for permission to exist\n   * @return true if node was killed, false if left alive\n   */\n  const _sanitizeElements = function (currentNode: any): boolean {\n    let content = null;\n\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeElements, currentNode, null);\n\n    /* Check if element is clobbered or can clobber */\n    if (_isClobbered(currentNode)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Now let's check the element's type and name */\n    const tagName = transformCaseFunc(currentNode.nodeName);\n\n    /* Execute a hook if present */\n    _executeHooks(hooks.uponSanitizeElement, currentNode, {\n      tagName,\n      allowedTags: ALLOWED_TAGS,\n    });\n\n    /* Detect mXSS attempts abusing namespace confusion */\n    if (\n      SAFE_FOR_XML &&\n      currentNode.hasChildNodes() &&\n      !_isNode(currentNode.firstElementChild) &&\n      regExpTest(/<[/\\w!]/g, currentNode.innerHTML) &&\n      regExpTest(/<[/\\w!]/g, currentNode.textContent)\n    ) {\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Remove any occurrence of processing instructions */\n    if (currentNode.nodeType === NODE_TYPE.progressingInstruction) {\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Remove any kind of possibly harmful comments */\n    if (\n      SAFE_FOR_XML &&\n      currentNode.nodeType === NODE_TYPE.comment &&\n      regExpTest(/<[/\\w]/g, currentNode.data)\n    ) {\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Remove element if anything forbids its presence */\n    if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {\n      /* Check if we have a custom element to handle */\n      if (!FORBID_TAGS[tagName] && _isBasicCustomElement(tagName)) {\n        if (\n          CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp &&\n          regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, tagName)\n        ) {\n          return false;\n        }\n\n        if (\n          CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function &&\n          CUSTOM_ELEMENT_HANDLING.tagNameCheck(tagName)\n        ) {\n          return false;\n        }\n      }\n\n      /* Keep content except for bad-listed elements */\n      if (KEEP_CONTENT && !FORBID_CONTENTS[tagName]) {\n        const parentNode = getParentNode(currentNode) || currentNode.parentNode;\n        const childNodes = getChildNodes(currentNode) || currentNode.childNodes;\n\n        if (childNodes && parentNode) {\n          const childCount = childNodes.length;\n\n          for (let i = childCount - 1; i >= 0; --i) {\n            const childClone = cloneNode(childNodes[i], true);\n            childClone.__removalCount = (currentNode.__removalCount || 0) + 1;\n            parentNode.insertBefore(childClone, getNextSibling(currentNode));\n          }\n        }\n      }\n\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Check whether element has a valid namespace */\n    if (currentNode instanceof Element && !_checkValidNamespace(currentNode)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Make sure that older browsers don't get fallback-tag mXSS */\n    if (\n      (tagName === 'noscript' ||\n        tagName === 'noembed' ||\n        tagName === 'noframes') &&\n      regExpTest(/<\\/no(script|embed|frames)/i, currentNode.innerHTML)\n    ) {\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Sanitize element content to be template-safe */\n    if (SAFE_FOR_TEMPLATES && currentNode.nodeType === NODE_TYPE.text) {\n      /* Get the element's text content */\n      content = currentNode.textContent;\n\n      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], (expr) => {\n        content = stringReplace(content, expr, ' ');\n      });\n\n      if (currentNode.textContent !== content) {\n        arrayPush(DOMPurify.removed, { element: currentNode.cloneNode() });\n        currentNode.textContent = content;\n      }\n    }\n\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeElements, currentNode, null);\n\n    return false;\n  };\n\n  /**\n   * _isValidAttribute\n   *\n   * @param lcTag Lowercase tag name of containing element.\n   * @param lcName Lowercase attribute name.\n   * @param value Attribute value.\n   * @return Returns true if `value` is valid, otherwise false.\n   */\n  // eslint-disable-next-line complexity\n  const _isValidAttribute = function (\n    lcTag: string,\n    lcName: string,\n    value: string\n  ): boolean {\n    /* Make sure attribute cannot clobber */\n    if (\n      SANITIZE_DOM &&\n      (lcName === 'id' || lcName === 'name') &&\n      (value in document || value in formElement)\n    ) {\n      return false;\n    }\n\n    /* Allow valid data-* attributes: At least one character after \"-\"\n        (https://html.spec.whatwg.org/multipage/dom.html#embedding-custom-non-visible-data-with-the-data-*-attributes)\n        XML-compatible (https://html.spec.whatwg.org/multipage/infrastructure.html#xml-compatible and http://www.w3.org/TR/xml/#d0e804)\n        We don't need to check the value; it's always URI safe. */\n    if (\n      ALLOW_DATA_ATTR &&\n      !FORBID_ATTR[lcName] &&\n      regExpTest(DATA_ATTR, lcName)\n    ) {\n      // This attribute is safe\n    } else if (ALLOW_ARIA_ATTR && regExpTest(ARIA_ATTR, lcName)) {\n      // This attribute is safe\n      /* Otherwise, check the name is permitted */\n    } else if (!ALLOWED_ATTR[lcName] || FORBID_ATTR[lcName]) {\n      if (\n        // First condition does a very basic check if a) it's basically a valid custom element tagname AND\n        // b) if the tagName passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n        // and c) if the attribute name passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.attributeNameCheck\n        (_isBasicCustomElement(lcTag) &&\n          ((CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp &&\n            regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, lcTag)) ||\n            (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function &&\n              CUSTOM_ELEMENT_HANDLING.tagNameCheck(lcTag))) &&\n          ((CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof RegExp &&\n            regExpTest(CUSTOM_ELEMENT_HANDLING.attributeNameCheck, lcName)) ||\n            (CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof Function &&\n              CUSTOM_ELEMENT_HANDLING.attributeNameCheck(lcName)))) ||\n        // Alternative, second condition checks if it's an `is`-attribute, AND\n        // the value passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n        (lcName === 'is' &&\n          CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements &&\n          ((CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp &&\n            regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, value)) ||\n            (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function &&\n              CUSTOM_ELEMENT_HANDLING.tagNameCheck(value))))\n      ) {\n        // If user has supplied a regexp or function in CUSTOM_ELEMENT_HANDLING.tagNameCheck, we need to also allow derived custom elements using the same tagName test.\n        // Additionally, we need to allow attributes passing the CUSTOM_ELEMENT_HANDLING.attributeNameCheck user has configured, as custom elements can define these at their own discretion.\n      } else {\n        return false;\n      }\n      /* Check value is safe. First, is attr inert? If so, is safe */\n    } else if (URI_SAFE_ATTRIBUTES[lcName]) {\n      // This attribute is safe\n      /* Check no script, data or unknown possibly unsafe URI\n        unless we know URI values are safe for that attribute */\n    } else if (\n      regExpTest(IS_ALLOWED_URI, stringReplace(value, ATTR_WHITESPACE, ''))\n    ) {\n      // This attribute is safe\n      /* Keep image data URIs alive if src/xlink:href is allowed */\n      /* Further prevent gadget XSS for dynamically built script tags */\n    } else if (\n      (lcName === 'src' || lcName === 'xlink:href' || lcName === 'href') &&\n      lcTag !== 'script' &&\n      stringIndexOf(value, 'data:') === 0 &&\n      DATA_URI_TAGS[lcTag]\n    ) {\n      // This attribute is safe\n      /* Allow unknown protocols: This provides support for links that\n        are handled by protocol handlers which may be unknown ahead of\n        time, e.g. fb:, spotify: */\n    } else if (\n      ALLOW_UNKNOWN_PROTOCOLS &&\n      !regExpTest(IS_SCRIPT_OR_DATA, stringReplace(value, ATTR_WHITESPACE, ''))\n    ) {\n      // This attribute is safe\n      /* Check for binary attributes */\n    } else if (value) {\n      return false;\n    } else {\n      // Binary attributes are safe at this point\n      /* Anything else, presume unsafe, do not add it back */\n    }\n\n    return true;\n  };\n\n  /**\n   * _isBasicCustomElement\n   * checks if at least one dash is included in tagName, and it's not the first char\n   * for more sophisticated checking see https://github.com/sindresorhus/validate-element-name\n   *\n   * @param tagName name of the tag of the node to sanitize\n   * @returns Returns true if the tag name meets the basic criteria for a custom element, otherwise false.\n   */\n  const _isBasicCustomElement = function (tagName: string): RegExpMatchArray {\n    return tagName !== 'annotation-xml' && stringMatch(tagName, CUSTOM_ELEMENT);\n  };\n\n  /**\n   * _sanitizeAttributes\n   *\n   * @protect attributes\n   * @protect nodeName\n   * @protect removeAttribute\n   * @protect setAttribute\n   *\n   * @param currentNode to sanitize\n   */\n  const _sanitizeAttributes = function (currentNode: Element): void {\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeAttributes, currentNode, null);\n\n    const { attributes } = currentNode;\n\n    /* Check if we have attributes; if not we might have a text node */\n    if (!attributes || _isClobbered(currentNode)) {\n      return;\n    }\n\n    const hookEvent = {\n      attrName: '',\n      attrValue: '',\n      keepAttr: true,\n      allowedAttributes: ALLOWED_ATTR,\n      forceKeepAttr: undefined,\n    };\n    let l = attributes.length;\n\n    /* Go backwards over all attributes; safely remove bad ones */\n    while (l--) {\n      const attr = attributes[l];\n      const { name, namespaceURI, value: attrValue } = attr;\n      const lcName = transformCaseFunc(name);\n\n      const initValue = attrValue;\n      let value = name === 'value' ? initValue : stringTrim(initValue);\n\n      /* Execute a hook if present */\n      hookEvent.attrName = lcName;\n      hookEvent.attrValue = value;\n      hookEvent.keepAttr = true;\n      hookEvent.forceKeepAttr = undefined; // Allows developers to see this is a property they can set\n      _executeHooks(hooks.uponSanitizeAttribute, currentNode, hookEvent);\n      value = hookEvent.attrValue;\n\n      /* Full DOM Clobbering protection via namespace isolation,\n       * Prefix id and name attributes with `user-content-`\n       */\n      if (SANITIZE_NAMED_PROPS && (lcName === 'id' || lcName === 'name')) {\n        // Remove the attribute with this value\n        _removeAttribute(name, currentNode);\n\n        // Prefix the value and later re-create the attribute with the sanitized value\n        value = SANITIZE_NAMED_PROPS_PREFIX + value;\n      }\n\n      /* Work around a security issue with comments inside attributes */\n      if (SAFE_FOR_XML && regExpTest(/((--!?|])>)|<\\/(style|title)/i, value)) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n\n      /* Did the hooks approve of the attribute? */\n      if (hookEvent.forceKeepAttr) {\n        continue;\n      }\n\n      /* Did the hooks approve of the attribute? */\n      if (!hookEvent.keepAttr) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n\n      /* Work around a security issue in jQuery 3.0 */\n      if (!ALLOW_SELF_CLOSE_IN_ATTR && regExpTest(/\\/>/i, value)) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n\n      /* Sanitize attribute content to be template-safe */\n      if (SAFE_FOR_TEMPLATES) {\n        arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], (expr) => {\n          value = stringReplace(value, expr, ' ');\n        });\n      }\n\n      /* Is `value` valid for this attribute? */\n      const lcTag = transformCaseFunc(currentNode.nodeName);\n      if (!_isValidAttribute(lcTag, lcName, value)) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n\n      /* Handle attributes that require Trusted Types */\n      if (\n        trustedTypesPolicy &&\n        typeof trustedTypes === 'object' &&\n        typeof trustedTypes.getAttributeType === 'function'\n      ) {\n        if (namespaceURI) {\n          /* Namespaces are not yet supported, see https://bugs.chromium.org/p/chromium/issues/detail?id=1305293 */\n        } else {\n          switch (trustedTypes.getAttributeType(lcTag, lcName)) {\n            case 'TrustedHTML': {\n              value = trustedTypesPolicy.createHTML(value);\n              break;\n            }\n\n            case 'TrustedScriptURL': {\n              value = trustedTypesPolicy.createScriptURL(value);\n              break;\n            }\n\n            default: {\n              break;\n            }\n          }\n        }\n      }\n\n      /* Handle invalid data-* attribute set by try-catching it */\n      if (value !== initValue) {\n        try {\n          if (namespaceURI) {\n            currentNode.setAttributeNS(namespaceURI, name, value);\n          } else {\n            /* Fallback to setAttribute() for browser-unrecognized namespaces e.g. \"x-schema\". */\n            currentNode.setAttribute(name, value);\n          }\n\n          if (_isClobbered(currentNode)) {\n            _forceRemove(currentNode);\n          } else {\n            arrayPop(DOMPurify.removed);\n          }\n        } catch (_) {\n          _removeAttribute(name, currentNode);\n        }\n      }\n    }\n\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeAttributes, currentNode, null);\n  };\n\n  /**\n   * _sanitizeShadowDOM\n   *\n   * @param fragment to iterate over recursively\n   */\n  const _sanitizeShadowDOM = function (fragment: DocumentFragment): void {\n    let shadowNode = null;\n    const shadowIterator = _createNodeIterator(fragment);\n\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeShadowDOM, fragment, null);\n\n    while ((shadowNode = shadowIterator.nextNode())) {\n      /* Execute a hook if present */\n      _executeHooks(hooks.uponSanitizeShadowNode, shadowNode, null);\n\n      /* Sanitize tags and elements */\n      _sanitizeElements(shadowNode);\n\n      /* Check attributes next */\n      _sanitizeAttributes(shadowNode);\n\n      /* Deep shadow DOM detected */\n      if (shadowNode.content instanceof DocumentFragment) {\n        _sanitizeShadowDOM(shadowNode.content);\n      }\n    }\n\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeShadowDOM, fragment, null);\n  };\n\n  // eslint-disable-next-line complexity\n  DOMPurify.sanitize = function (dirty, cfg = {}) {\n    let body = null;\n    let importedNode = null;\n    let currentNode = null;\n    let returnNode = null;\n    /* Make sure we have a string to sanitize.\n      DO NOT return early, as this will return the wrong type if\n      the user has requested a DOM object rather than a string */\n    IS_EMPTY_INPUT = !dirty;\n    if (IS_EMPTY_INPUT) {\n      dirty = '<!-->';\n    }\n\n    /* Stringify, in case dirty is an object */\n    if (typeof dirty !== 'string' && !_isNode(dirty)) {\n      if (typeof dirty.toString === 'function') {\n        dirty = dirty.toString();\n        if (typeof dirty !== 'string') {\n          throw typeErrorCreate('dirty is not a string, aborting');\n        }\n      } else {\n        throw typeErrorCreate('toString is not a function');\n      }\n    }\n\n    /* Return dirty HTML if DOMPurify cannot run */\n    if (!DOMPurify.isSupported) {\n      return dirty;\n    }\n\n    /* Assign config vars */\n    if (!SET_CONFIG) {\n      _parseConfig(cfg);\n    }\n\n    /* Clean up removed elements */\n    DOMPurify.removed = [];\n\n    /* Check if dirty is correctly typed for IN_PLACE */\n    if (typeof dirty === 'string') {\n      IN_PLACE = false;\n    }\n\n    if (IN_PLACE) {\n      /* Do some early pre-sanitization to avoid unsafe root nodes */\n      if ((dirty as Node).nodeName) {\n        const tagName = transformCaseFunc((dirty as Node).nodeName);\n        if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {\n          throw typeErrorCreate(\n            'root node is forbidden and cannot be sanitized in-place'\n          );\n        }\n      }\n    } else if (dirty instanceof Node) {\n      /* If dirty is a DOM element, append to an empty document to avoid\n         elements being stripped by the parser */\n      body = _initDocument('<!---->');\n      importedNode = body.ownerDocument.importNode(dirty, true);\n      if (\n        importedNode.nodeType === NODE_TYPE.element &&\n        importedNode.nodeName === 'BODY'\n      ) {\n        /* Node is already a body, use as is */\n        body = importedNode;\n      } else if (importedNode.nodeName === 'HTML') {\n        body = importedNode;\n      } else {\n        // eslint-disable-next-line unicorn/prefer-dom-node-append\n        body.appendChild(importedNode);\n      }\n    } else {\n      /* Exit directly if we have nothing to do */\n      if (\n        !RETURN_DOM &&\n        !SAFE_FOR_TEMPLATES &&\n        !WHOLE_DOCUMENT &&\n        // eslint-disable-next-line unicorn/prefer-includes\n        dirty.indexOf('<') === -1\n      ) {\n        return trustedTypesPolicy && RETURN_TRUSTED_TYPE\n          ? trustedTypesPolicy.createHTML(dirty)\n          : dirty;\n      }\n\n      /* Initialize the document to work on */\n      body = _initDocument(dirty);\n\n      /* Check we have a DOM node from the data */\n      if (!body) {\n        return RETURN_DOM ? null : RETURN_TRUSTED_TYPE ? emptyHTML : '';\n      }\n    }\n\n    /* Remove first element node (ours) if FORCE_BODY is set */\n    if (body && FORCE_BODY) {\n      _forceRemove(body.firstChild);\n    }\n\n    /* Get node iterator */\n    const nodeIterator = _createNodeIterator(IN_PLACE ? dirty : body);\n\n    /* Now start iterating over the created document */\n    while ((currentNode = nodeIterator.nextNode())) {\n      /* Sanitize tags and elements */\n      _sanitizeElements(currentNode);\n\n      /* Check attributes next */\n      _sanitizeAttributes(currentNode);\n\n      /* Shadow DOM detected, sanitize it */\n      if (currentNode.content instanceof DocumentFragment) {\n        _sanitizeShadowDOM(currentNode.content);\n      }\n    }\n\n    /* If we sanitized `dirty` in-place, return it. */\n    if (IN_PLACE) {\n      return dirty;\n    }\n\n    /* Return sanitized string or DOM */\n    if (RETURN_DOM) {\n      if (RETURN_DOM_FRAGMENT) {\n        returnNode = createDocumentFragment.call(body.ownerDocument);\n\n        while (body.firstChild) {\n          // eslint-disable-next-line unicorn/prefer-dom-node-append\n          returnNode.appendChild(body.firstChild);\n        }\n      } else {\n        returnNode = body;\n      }\n\n      if (ALLOWED_ATTR.shadowroot || ALLOWED_ATTR.shadowrootmode) {\n        /*\n          AdoptNode() is not used because internal state is not reset\n          (e.g. the past names map of a HTMLFormElement), this is safe\n          in theory but we would rather not risk another attack vector.\n          The state that is cloned by importNode() is explicitly defined\n          by the specs.\n        */\n        returnNode = importNode.call(originalDocument, returnNode, true);\n      }\n\n      return returnNode;\n    }\n\n    let serializedHTML = WHOLE_DOCUMENT ? body.outerHTML : body.innerHTML;\n\n    /* Serialize doctype if allowed */\n    if (\n      WHOLE_DOCUMENT &&\n      ALLOWED_TAGS['!doctype'] &&\n      body.ownerDocument &&\n      body.ownerDocument.doctype &&\n      body.ownerDocument.doctype.name &&\n      regExpTest(EXPRESSIONS.DOCTYPE_NAME, body.ownerDocument.doctype.name)\n    ) {\n      serializedHTML =\n        '<!DOCTYPE ' + body.ownerDocument.doctype.name + '>\\n' + serializedHTML;\n    }\n\n    /* Sanitize final string template-safe */\n    if (SAFE_FOR_TEMPLATES) {\n      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], (expr) => {\n        serializedHTML = stringReplace(serializedHTML, expr, ' ');\n      });\n    }\n\n    return trustedTypesPolicy && RETURN_TRUSTED_TYPE\n      ? trustedTypesPolicy.createHTML(serializedHTML)\n      : serializedHTML;\n  };\n\n  DOMPurify.setConfig = function (cfg = {}) {\n    _parseConfig(cfg);\n    SET_CONFIG = true;\n  };\n\n  DOMPurify.clearConfig = function () {\n    CONFIG = null;\n    SET_CONFIG = false;\n  };\n\n  DOMPurify.isValidAttribute = function (tag, attr, value) {\n    /* Initialize shared config vars if necessary. */\n    if (!CONFIG) {\n      _parseConfig({});\n    }\n\n    const lcTag = transformCaseFunc(tag);\n    const lcName = transformCaseFunc(attr);\n    return _isValidAttribute(lcTag, lcName, value);\n  };\n\n  DOMPurify.addHook = function (entryPoint, hookFunction) {\n    if (typeof hookFunction !== 'function') {\n      return;\n    }\n\n    arrayPush(hooks[entryPoint], hookFunction);\n  };\n\n  DOMPurify.removeHook = function (entryPoint, hookFunction) {\n    if (hookFunction !== undefined) {\n      const index = arrayLastIndexOf(hooks[entryPoint], hookFunction);\n\n      return index === -1\n        ? undefined\n        : arraySplice(hooks[entryPoint], index, 1)[0];\n    }\n\n    return arrayPop(hooks[entryPoint]);\n  };\n\n  DOMPurify.removeHooks = function (entryPoint) {\n    hooks[entryPoint] = [];\n  };\n\n  DOMPurify.removeAllHooks = function () {\n    hooks = _createHooksMap();\n  };\n\n  return DOMPurify;\n}\n\nexport default createDOMPurify();\n\nexport interface DOMPurify {\n  /**\n   * Creates a DOMPurify instance using the given window-like object. Defaults to `window`.\n   */\n  (root?: WindowLike): DOMPurify;\n\n  /**\n   * Version label, exposed for easier checks\n   * if DOMPurify is up to date or not\n   */\n  version: string;\n\n  /**\n   * Array of elements that DOMPurify removed during sanitation.\n   * Empty if nothing was removed.\n   */\n  removed: Array<RemovedElement | RemovedAttribute>;\n\n  /**\n   * Expose whether this browser supports running the full DOMPurify.\n   */\n  isSupported: boolean;\n\n  /**\n   * Set the configuration once.\n   *\n   * @param cfg configuration object\n   */\n  setConfig(cfg?: Config): void;\n\n  /**\n   * Removes the configuration.\n   */\n  clearConfig(): void;\n\n  /**\n   * Provides core sanitation functionality.\n   *\n   * @param dirty string or DOM node\n   * @param cfg object\n   * @returns Sanitized TrustedHTML.\n   */\n  sanitize(\n    dirty: string | Node,\n    cfg: Config & { RETURN_TRUSTED_TYPE: true }\n  ): TrustedHTML;\n\n  /**\n   * Provides core sanitation functionality.\n   *\n   * @param dirty DOM node\n   * @param cfg object\n   * @returns Sanitized DOM node.\n   */\n  sanitize(dirty: Node, cfg: Config & { IN_PLACE: true }): Node;\n\n  /**\n   * Provides core sanitation functionality.\n   *\n   * @param dirty string or DOM node\n   * @param cfg object\n   * @returns Sanitized DOM node.\n   */\n  sanitize(dirty: string | Node, cfg: Config & { RETURN_DOM: true }): Node;\n\n  /**\n   * Provides core sanitation functionality.\n   *\n   * @param dirty string or DOM node\n   * @param cfg object\n   * @returns Sanitized document fragment.\n   */\n  sanitize(\n    dirty: string | Node,\n    cfg: Config & { RETURN_DOM_FRAGMENT: true }\n  ): DocumentFragment;\n\n  /**\n   * Provides core sanitation functionality.\n   *\n   * @param dirty string or DOM node\n   * @param cfg object\n   * @returns Sanitized string.\n   */\n  sanitize(dirty: string | Node, cfg?: Config): string;\n\n  /**\n   * Checks if an attribute value is valid.\n   * Uses last set config, if any. Otherwise, uses config defaults.\n   *\n   * @param tag Tag name of containing element.\n   * @param attr Attribute name.\n   * @param value Attribute value.\n   * @returns Returns true if `value` is valid. Otherwise, returns false.\n   */\n  isValidAttribute(tag: string, attr: string, value: string): boolean;\n\n  /**\n   * Adds a DOMPurify hook.\n   *\n   * @param entryPoint entry point for the hook to add\n   * @param hookFunction function to execute\n   */\n  addHook(entryPoint: BasicHookName, hookFunction: NodeHook): void;\n\n  /**\n   * Adds a DOMPurify hook.\n   *\n   * @param entryPoint entry point for the hook to add\n   * @param hookFunction function to execute\n   */\n  addHook(entryPoint: ElementHookName, hookFunction: ElementHook): void;\n\n  /**\n   * Adds a DOMPurify hook.\n   *\n   * @param entryPoint entry point for the hook to add\n   * @param hookFunction function to execute\n   */\n  addHook(\n    entryPoint: DocumentFragmentHookName,\n    hookFunction: DocumentFragmentHook\n  ): void;\n\n  /**\n   * Adds a DOMPurify hook.\n   *\n   * @param entryPoint entry point for the hook to add\n   * @param hookFunction function to execute\n   */\n  addHook(\n    entryPoint: 'uponSanitizeElement',\n    hookFunction: UponSanitizeElementHook\n  ): void;\n\n  /**\n   * Adds a DOMPurify hook.\n   *\n   * @param entryPoint entry point for the hook to add\n   * @param hookFunction function to execute\n   */\n  addHook(\n    entryPoint: 'uponSanitizeAttribute',\n    hookFunction: UponSanitizeAttributeHook\n  ): void;\n\n  /**\n   * Remove a DOMPurify hook at a given entryPoint\n   * (pops it from the stack of hooks if hook not specified)\n   *\n   * @param entryPoint entry point for the hook to remove\n   * @param hookFunction optional specific hook to remove\n   * @returns removed hook\n   */\n  removeHook(\n    entryPoint: BasicHookName,\n    hookFunction?: NodeHook\n  ): NodeHook | undefined;\n\n  /**\n   * Remove a DOMPurify hook at a given entryPoint\n   * (pops it from the stack of hooks if hook not specified)\n   *\n   * @param entryPoint entry point for the hook to remove\n   * @param hookFunction optional specific hook to remove\n   * @returns removed hook\n   */\n  removeHook(\n    entryPoint: ElementHookName,\n    hookFunction?: ElementHook\n  ): ElementHook | undefined;\n\n  /**\n   * Remove a DOMPurify hook at a given entryPoint\n   * (pops it from the stack of hooks if hook not specified)\n   *\n   * @param entryPoint entry point for the hook to remove\n   * @param hookFunction optional specific hook to remove\n   * @returns removed hook\n   */\n  removeHook(\n    entryPoint: DocumentFragmentHookName,\n    hookFunction?: DocumentFragmentHook\n  ): DocumentFragmentHook | undefined;\n\n  /**\n   * Remove a DOMPurify hook at a given entryPoint\n   * (pops it from the stack of hooks if hook not specified)\n   *\n   * @param entryPoint entry point for the hook to remove\n   * @param hookFunction optional specific hook to remove\n   * @returns removed hook\n   */\n  removeHook(\n    entryPoint: 'uponSanitizeElement',\n    hookFunction?: UponSanitizeElementHook\n  ): UponSanitizeElementHook | undefined;\n\n  /**\n   * Remove a DOMPurify hook at a given entryPoint\n   * (pops it from the stack of hooks if hook not specified)\n   *\n   * @param entryPoint entry point for the hook to remove\n   * @param hookFunction optional specific hook to remove\n   * @returns removed hook\n   */\n  removeHook(\n    entryPoint: 'uponSanitizeAttribute',\n    hookFunction?: UponSanitizeAttributeHook\n  ): UponSanitizeAttributeHook | undefined;\n\n  /**\n   * Removes all DOMPurify hooks at a given entryPoint\n   *\n   * @param entryPoint entry point for the hooks to remove\n   */\n  removeHooks(entryPoint: HookName): void;\n\n  /**\n   * Removes all DOMPurify hooks.\n   */\n  removeAllHooks(): void;\n}\n\n/**\n * An element removed by DOMPurify.\n */\nexport interface RemovedElement {\n  /**\n   * The element that was removed.\n   */\n  element: Node;\n}\n\n/**\n * An element removed by DOMPurify.\n */\nexport interface RemovedAttribute {\n  /**\n   * The attribute that was removed.\n   */\n  attribute: Attr | null;\n\n  /**\n   * The element that the attribute was removed.\n   */\n  from: Node;\n}\n\ntype BasicHookName =\n  | 'beforeSanitizeElements'\n  | 'afterSanitizeElements'\n  | 'uponSanitizeShadowNode';\ntype ElementHookName = 'beforeSanitizeAttributes' | 'afterSanitizeAttributes';\ntype DocumentFragmentHookName =\n  | 'beforeSanitizeShadowDOM'\n  | 'afterSanitizeShadowDOM';\ntype UponSanitizeElementHookName = 'uponSanitizeElement';\ntype UponSanitizeAttributeHookName = 'uponSanitizeAttribute';\n\ninterface HooksMap {\n  beforeSanitizeElements: NodeHook[];\n  afterSanitizeElements: NodeHook[];\n  beforeSanitizeShadowDOM: DocumentFragmentHook[];\n  uponSanitizeShadowNode: NodeHook[];\n  afterSanitizeShadowDOM: DocumentFragmentHook[];\n  beforeSanitizeAttributes: ElementHook[];\n  afterSanitizeAttributes: ElementHook[];\n  uponSanitizeElement: UponSanitizeElementHook[];\n  uponSanitizeAttribute: UponSanitizeAttributeHook[];\n}\n\nexport type HookName =\n  | BasicHookName\n  | ElementHookName\n  | DocumentFragmentHookName\n  | UponSanitizeElementHookName\n  | UponSanitizeAttributeHookName;\n\nexport type NodeHook = (\n  this: DOMPurify,\n  currentNode: Node,\n  hookEvent: null,\n  config: Config\n) => void;\n\nexport type ElementHook = (\n  this: DOMPurify,\n  currentNode: Element,\n  hookEvent: null,\n  config: Config\n) => void;\n\nexport type DocumentFragmentHook = (\n  this: DOMPurify,\n  currentNode: DocumentFragment,\n  hookEvent: null,\n  config: Config\n) => void;\n\nexport type UponSanitizeElementHook = (\n  this: DOMPurify,\n  currentNode: Node,\n  hookEvent: UponSanitizeElementHookEvent,\n  config: Config\n) => void;\n\nexport type UponSanitizeAttributeHook = (\n  this: DOMPurify,\n  currentNode: Element,\n  hookEvent: UponSanitizeAttributeHookEvent,\n  config: Config\n) => void;\n\nexport interface UponSanitizeElementHookEvent {\n  tagName: string;\n  allowedTags: Record<string, boolean>;\n}\n\nexport interface UponSanitizeAttributeHookEvent {\n  attrName: string;\n  attrValue: string;\n  keepAttr: boolean;\n  allowedAttributes: Record<string, boolean>;\n  forceKeepAttr: boolean | undefined;\n}\n\n/**\n * A `Window`-like object containing the properties and types that DOMPurify requires.\n */\nexport type WindowLike = Pick<\n  typeof globalThis,\n  | 'DocumentFragment'\n  | 'HTMLTemplateElement'\n  | 'Node'\n  | 'Element'\n  | 'NodeFilter'\n  | 'NamedNodeMap'\n  | 'HTMLFormElement'\n  | 'DOMParser'\n> & {\n  document?: Document;\n  MozNamedAttrMap?: typeof window.NamedNodeMap;\n} & Pick<TrustedTypesWindow, 'trustedTypes'>;\n", "import type DetailedMapData from '../../map-data-objects/detailed-map-data';\n\nexport function hasWashroomCategory(thing: DetailedMapData<any>) {\n\treturn thing.locationProfiles.some(profile =>\n\t\tprofile.categories.some(category => category.name.includes('Restroom')),\n\t);\n}\n\nexport function hasParkingCategory(thing: DetailedMapData<any>) {\n\treturn thing.locationProfiles.some(profile => profile.categories.some(category => category.name.includes('Parking')));\n}\n", "import type { RendererCore } from '../../geojson/src';\n\nexport class Debug {\n\tstate: RendererCore['Debug']['state'];\n\tconstructor(core: RendererCore) {\n\t\tthis.update = core.Debug.update.bind(core.Debug);\n\t\tthis.state = core.Debug.state;\n\t}\n\tupdate: RendererCore['Debug']['update'];\n}\n", "import z from 'zod';\n\nexport const updateGlobalStateSchema = z.strictObject({\n\tenvironment: z.union([z.literal('basic'), z.literal(false)]).optional(),\n\ttext3d: z\n\t\t.object({\n\t\t\thoverColor: z.string().optional(),\n\t\t})\n\t\t.optional(),\n\tgeometry: z\n\t\t.object({\n\t\t\thoverColor: z.string().optional(),\n\t\t})\n\t\t.optional(),\n\tbackgroundColor: z.string().optional(),\n\tbackgroundAlpha: z.number().optional(),\n});\n", "import merge from 'lodash.merge';\nimport { isColor, Logger, rgbArrayToString, stringToRgbArray } from '@packages/internal/common';\nimport type { PartialDeep } from 'type-fest';\n\n/**\n * Extracts only the properties from object1 that have corresponding keys in object2.\n * Maintains the same nested structure but only includes properties that will be animated.\n */\nexport const extractProperties = <T extends object>(object1: T, object2: PartialDeep<T>): Partial<T> => {\n\tconst result: Partial<T> = {};\n\n\tconst processObject = (object1: any, object2: any, target: any) => {\n\t\tfor (const key in object2) {\n\t\t\tconst object1Value = object1[key];\n\t\t\tconst object2Value = object2[key];\n\n\t\t\tif (\n\t\t\t\ttypeof object2Value === 'object' &&\n\t\t\t\t!Array.isArray(object2Value) &&\n\t\t\t\tobject2Value !== null &&\n\t\t\t\ttypeof object1Value === 'object' &&\n\t\t\t\t!Array.isArray(object1Value) &&\n\t\t\t\tobject1Value !== null\n\t\t\t) {\n\t\t\t\t// For nested objects, create a new object and process recursively\n\t\t\t\ttarget[key] = {};\n\t\t\t\tprocessObject(object1Value, object2Value, target[key]);\n\t\t\t} else {\n\t\t\t\t// For leaf values, copy the initial value\n\t\t\t\ttarget[key] = object1Value;\n\t\t\t}\n\t\t}\n\t};\n\n\tprocessObject(object1, object2, result);\n\n\treturn result;\n};\n\nexport const animationFactory = <T extends object>(initialState: T, finalValues: PartialDeep<T>) => {\n\tconst baseState = extractProperties(initialState, finalValues);\n\tconst finalState = merge({}, baseState, finalValues);\n\n\t// Create one intermediate state object we will continously update to avoid creating new objects every frame\n\tconst intermediateState = merge({}, baseState);\n\n\t// Define interpolation function once\n\tconst interpolate = (initial: object, final: object, percent: number, target: object = intermediateState) => {\n\t\tfor (const key in final) {\n\t\t\tconst currentValue = initial[key];\n\t\t\tconst finalValue = final[key];\n\n\t\t\tif (typeof finalValue === 'number' && typeof currentValue === 'number') {\n\t\t\t\t// Interpolate numbers\n\t\t\t\ttarget[key] = currentValue + (finalValue - currentValue) * percent;\n\t\t\t} else if (typeof finalValue === 'string' && typeof currentValue === 'string') {\n\t\t\t\tif (isColor(currentValue) && isColor(finalValue)) {\n\t\t\t\t\tconst currentColor = stringToRgbArray(currentValue);\n\t\t\t\t\tconst finalColor = stringToRgbArray(finalValue);\n\n\t\t\t\t\tif (currentColor && finalColor) {\n\t\t\t\t\t\ttarget[key] = rgbArrayToString([\n\t\t\t\t\t\t\tcurrentColor[0] + (finalColor[0] - currentColor[0]) * percent,\n\t\t\t\t\t\t\tcurrentColor[1] + (finalColor[1] - currentColor[1]) * percent,\n\t\t\t\t\t\t\tcurrentColor[2] + (finalColor[2] - currentColor[2]) * percent,\n\t\t\t\t\t\t]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tLogger.warn(`Color \"${key}\" could not be animated!`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\ttypeof finalValue === 'object' &&\n\t\t\t\tfinalValue !== null &&\n\t\t\t\ttypeof currentValue === 'object' &&\n\t\t\t\tcurrentValue !== null\n\t\t\t) {\n\t\t\t\t// Recursively interpolate nested objects\n\t\t\t\tinterpolate(currentValue, finalValue, percent, target[key]);\n\t\t\t} else {\n\t\t\t\tLogger.warn(`Value \"${key}\" could not be animated!`);\n\t\t\t}\n\t\t}\n\t};\n\n\treturn (percent: number) => {\n\t\tpercent = Math.min(Math.max(percent, 0), 1);\n\n\t\tif (percent === 0) {\n\t\t\treturn initialState;\n\t\t}\n\n\t\tif (percent === 1) {\n\t\t\treturn finalState;\n\t\t}\n\n\t\tinterpolate(baseState, finalValues, percent);\n\n\t\treturn intermediateState;\n\t};\n};\n", "import { isBrowser, Logger, PubSub } from '../../common';\nimport { ACCESS_TOKEN_REFRESH_BUFFER_MS, getAccessToken } from './access-token';\nimport { SAS_TOKEN_REFRESH_BUFFER_MS, getSasToken } from './sas-token';\n\nconst TWO_HOURS_MS = 1000 * 60 * 60 * 2;\n\ntype TokenWithExpiration = {\n\ttoken: string;\n\texpires?: number;\n};\n\ntype TokenManagerOptions = {\n\tbaseUri?: string;\n\tbaseAuthUri?: string;\n\tcustomAuthUri?: string;\n\tkey?: string;\n\tsecret?: string;\n\taccessToken?: string;\n\tenterprise?: boolean;\n};\n\ntype TokenManagerEvents = {\n\t'access-token-refreshed': {\n\t\taccessToken: TokenWithExpiration;\n\t};\n\t'sas-tokens-refreshed': {\n\t\tsasTokens: Record<string, TokenWithExpiration>;\n\t};\n};\n\ntype TokenManagerPubSub = PubSub<TokenManagerEvents>;\n\n/**\n * Class for retrieving and refreshing tokens.\n */\nexport class TokenManager {\n\t#pubsub: TokenManagerPubSub = new PubSub();\n\t#mapIds: string[];\n\t#options: TokenManagerOptions;\n\n\t// Dedupe requests by saving promises\n\t#accessTokenPromise: Promise<TokenWithExpiration> | undefined;\n\t#sasTokensPromise: Promise<{ tokens: Record<string, TokenWithExpiration>; expires: number }> | undefined;\n\n\t// Save results to allow synchronous access\n\t#accessToken: TokenWithExpiration | undefined;\n\t#sasTokens: { tokens: Record<string, TokenWithExpiration>; expires: number } | undefined;\n\n\t// Refresh tokens on an interval\n\t#accessTokenRefresh: ReturnType<typeof setInterval> | undefined;\n\t#sasTokensRefresh: ReturnType<typeof setInterval> | undefined;\n\n\tconstructor(mapIds: string[], options: TokenManagerOptions) {\n\t\tthis.#mapIds = mapIds;\n\t\tthis.#options = options;\n\t}\n\n\t#handleWindowFocus = () => {\n\t\tif ('key' in this.#options && 'secret' in this.#options) {\n\t\t\tthis.#refreshAccessToken();\n\t\t}\n\t\tthis.#refreshSasTokens();\n\t};\n\n\t#setAccessToken(accessToken: TokenWithExpiration) {\n\t\tconst isDifferent = accessToken.token !== this.#accessToken?.token;\n\t\tthis.#accessToken = accessToken;\n\t\tif (isDifferent) {\n\t\t\tthis.#pubsub.publish('access-token-refreshed', { accessToken });\n\t\t}\n\t}\n\n\t#setSasTokens(sasTokens: { tokens: Record<string, TokenWithExpiration>; expires: number }) {\n\t\tconst isDifferent = JSON.stringify(sasTokens.tokens) !== JSON.stringify(this.#sasTokens?.tokens);\n\t\tthis.#sasTokens = sasTokens;\n\t\tif (isDifferent) {\n\t\t\tthis.#pubsub.publish('sas-tokens-refreshed', { sasTokens: sasTokens.tokens });\n\t\t}\n\t}\n\n\tasync #refreshAccessToken(forceRefresh = false) {\n\t\tif ('accessToken' in this.#options && typeof this.#options.accessToken === 'string') {\n\t\t\tconst accessToken = {\n\t\t\t\ttoken: this.#options.accessToken,\n\t\t\t\t// We don't actually know the expiry so we assume something short, like 2 hours\n\t\t\t\texpires: Date.now() + 1000 * 60 * 60 * 2,\n\t\t\t};\n\t\t\tthis.#accessToken = accessToken;\n\n\t\t\treturn accessToken;\n\t\t}\n\n\t\tif (\n\t\t\t!('key' in this.#options) ||\n\t\t\t!('secret' in this.#options) ||\n\t\t\ttypeof this.#options.key !== 'string' ||\n\t\t\ttypeof this.#options.secret !== 'string'\n\t\t) {\n\t\t\tthrow new Error('No API keys or access token provided!');\n\t\t}\n\n\t\tif (this.#accessTokenPromise != null) {\n\t\t\treturn this.#accessTokenPromise;\n\t\t}\n\n\t\tif (\n\t\t\tthis.#accessToken != null &&\n\t\t\tthis.#accessToken.expires != null &&\n\t\t\tthis.#accessToken.expires > Date.now() &&\n\t\t\t!forceRefresh\n\t\t) {\n\t\t\treturn this.#accessToken;\n\t\t}\n\n\t\tthis.#accessTokenPromise = getAccessToken(\n\t\t\t{\n\t\t\t\t...this.#options,\n\t\t\t\tkey: this.#options.key,\n\t\t\t\tsecret: this.#options.secret,\n\t\t\t},\n\t\t\tthis.#options.enterprise ?? false,\n\t\t)\n\t\t\t.then(token => {\n\t\t\t\tconst accessToken = {\n\t\t\t\t\ttoken: token.accessToken,\n\t\t\t\t\t// Access token expiry is in seconds\n\t\t\t\t\texpires: token.expiresTimestamp * 1000,\n\t\t\t\t};\n\t\t\t\tthis.#setAccessToken(accessToken);\n\n\t\t\t\treturn accessToken;\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tthrow error; // Re-throw for proper error propagation\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\t// Clear the promise after it has resolved or rejected so we don't return expired token promises\n\t\t\t\tthis.#accessTokenPromise = undefined;\n\t\t\t});\n\n\t\treturn this.#accessTokenPromise;\n\t}\n\n\tasync #refreshSasTokens(forceRefresh = false) {\n\t\tif (this.isEnterpriseMode()) {\n\t\t\treturn {\n\t\t\t\ttokens: {},\n\t\t\t\texpires: Infinity,\n\t\t\t};\n\t\t}\n\n\t\tif (this.#sasTokensPromise != null) {\n\t\t\treturn this.#sasTokensPromise;\n\t\t}\n\n\t\tif (this.#sasTokens != null && this.#sasTokens.expires > Date.now() && !forceRefresh) {\n\t\t\treturn this.#sasTokens;\n\t\t}\n\n\t\tthis.#sasTokensPromise = new Promise((resolve, reject) => {\n\t\t\tthis.#refreshAccessToken()\n\t\t\t\t.then(accessToken => {\n\t\t\t\t\tconst sasTokens: Record<string, TokenWithExpiration> = {};\n\t\t\t\t\tconst sasTokenPromises = this.#mapIds.map(mapId =>\n\t\t\t\t\t\tgetSasToken({ ...this.#options, mapId }, accessToken.token)\n\t\t\t\t\t\t\t.then(token => {\n\t\t\t\t\t\t\t\tsasTokens[mapId] = {\n\t\t\t\t\t\t\t\t\ttoken: token.token,\n\t\t\t\t\t\t\t\t\texpires: token.expires,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\t\t\tLogger.error(`Error getting SAS token for map ${mapId}:`, error);\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t\tPromise.all(sasTokenPromises).then(() => {\n\t\t\t\t\t\tconst res = {\n\t\t\t\t\t\t\ttokens: sasTokens,\n\t\t\t\t\t\t\texpires: Math.min(...Object.values(sasTokens).map(token => token.expires ?? Infinity)),\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.#setSasTokens(res);\n\t\t\t\t\t\tresolve(res);\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(error => {\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t});\n\n\t\t// Clear the promise after it has resolved so we don't return expired token promises\n\t\tthis.#sasTokensPromise\n\t\t\t.catch(error => {\n\t\t\t\tthrow error;\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tthis.#sasTokensPromise = undefined;\n\t\t\t});\n\n\t\treturn this.#sasTokensPromise;\n\t}\n\n\t#setAccessTokenRefresh(token: TokenWithExpiration) {\n\t\t// If we don't have API keys, we can't refresh the access token\n\t\tif (!('key' in this.#options) || !('secret' in this.#options)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst expiresIn = token.expires != null ? token.expires - Date.now() : TWO_HOURS_MS;\n\t\tif (isFinite(expiresIn)) {\n\t\t\tthis.#accessTokenRefresh = setTimeout(() => {\n\t\t\t\tthis.#refreshAccessToken(true).then(token => {\n\t\t\t\t\tthis.#setAccessTokenRefresh(token);\n\t\t\t\t});\n\t\t\t}, expiresIn - ACCESS_TOKEN_REFRESH_BUFFER_MS);\n\t\t}\n\t}\n\n\t#setSasTokensRefresh(tokens: { tokens: Record<string, TokenWithExpiration>; expires: number }) {\n\t\tconst expiresIn = tokens.expires - Date.now();\n\t\tif (isFinite(expiresIn)) {\n\t\t\tthis.#sasTokensRefresh = setTimeout(() => {\n\t\t\t\tthis.#refreshSasTokens(true).then(tokens => {\n\t\t\t\t\tthis.#setSasTokensRefresh(tokens);\n\t\t\t\t});\n\t\t\t}, expiresIn - SAS_TOKEN_REFRESH_BUFFER_MS);\n\t\t}\n\t}\n\n\t#stopRefreshing() {\n\t\tif (this.#accessTokenRefresh != null) {\n\t\t\tclearTimeout(this.#accessTokenRefresh);\n\t\t}\n\t\tif (this.#sasTokensRefresh != null) {\n\t\t\tclearTimeout(this.#sasTokensRefresh);\n\t\t}\n\t}\n\n\t/**\n\t * Set the map IDs that the token manager will manage.\n\t */\n\tsetMapIds(mapIds: string[]) {\n\t\tthis.#mapIds = mapIds;\n\t}\n\n\t/**\n\t * Set the enterprise flag.\n\t */\n\tsetEnterprise(enterprise: boolean) {\n\t\tthis.#options.enterprise = enterprise;\n\t}\n\n\t/**\n\t * Preload tokens so they can be retrieved synchronously. This will also refresh tokens on an\n\t * interval so they remain valid synchronously.\n\t */\n\tasync readySync() {\n\t\tif ((!('key' in this.#options) || !('secret' in this.#options)) && !('accessToken' in this.#options)) {\n\t\t\tLogger.error('No API keys or access token provided! Cannot preload tokens.');\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst promises: [\n\t\t\tPromise<TokenWithExpiration>,\n\t\t\tPromise<{ tokens: Record<string, TokenWithExpiration>; expires: number }> | null,\n\t\t] = [this.#refreshAccessToken(), null];\n\t\tif (!this.#options.enterprise) {\n\t\t\tpromises[1] = this.getSasTokensAsync();\n\t\t}\n\t\tconst [accessToken, sasTokens] = await Promise.all(promises);\n\n\t\t// Refresh tokens before they expire so they are always synchronously available\n\t\tthis.#stopRefreshing();\n\t\tthis.#setAccessTokenRefresh(accessToken);\n\t\tif (sasTokens != null) {\n\t\t\tthis.#setSasTokensRefresh(sasTokens);\n\t\t}\n\n\t\tif (isBrowser()) {\n\t\t\tglobalThis.addEventListener?.('focus', this.#handleWindowFocus);\n\t\t}\n\t}\n\n\t/**\n\t * Get a promise that resolves when the tokens are refreshed, but does not trigger token\n\t * refreshing.\n\t */\n\tasync refreshing() {\n\t\tconst promises: Promise<unknown>[] = [];\n\t\tif (this.#accessTokenPromise != null) {\n\t\t\tpromises.push(this.#accessTokenPromise);\n\t\t}\n\t\tif (this.#sasTokensPromise != null) {\n\t\t\tpromises.push(this.#sasTokensPromise);\n\t\t}\n\n\t\treturn Promise.all(promises);\n\t}\n\n\t/**\n\t * Get an access token for the current set of API keys. If an access token was passed in, that\n\t * will be returned instead.\n\t */\n\tgetAccessTokenAsync() {\n\t\treturn this.#refreshAccessToken();\n\t}\n\n\t/**\n\t * Get SAS tokens for all maps. If any SAS token are expired, all SAS tokens will be refreshed.\n\t */\n\tgetSasTokensAsync() {\n\t\treturn this.#refreshSasTokens();\n\t}\n\n\t/**\n\t * Get an access token synchronously. `readySync()` must be called first.\n\t */\n\tgetAccessToken(): TokenWithExpiration {\n\t\tif (this.#accessToken == null) {\n\t\t\tLogger.error('Tokens must be loaded before reading synchronously! Try awaiting readySync() first.');\n\n\t\t\treturn {\n\t\t\t\ttoken: '',\n\t\t\t};\n\t\t}\n\n\t\treturn this.#accessToken;\n\t}\n\n\t/**\n\t * Get a SAS token for a specific map synchronously. `readySync()` must be called first.\n\t */\n\tgetSasToken(mapId: string): TokenWithExpiration {\n\t\tif (this.isEnterpriseMode()) {\n\t\t\tLogger.error('SAS tokens are not available in the enterprise mode!');\n\n\t\t\treturn {\n\t\t\t\ttoken: '',\n\t\t\t};\n\t\t}\n\n\t\tif (this.#sasTokens == null) {\n\t\t\tLogger.error(`Tokens must be loaded before reading synchronously! Try awaiting readySync() first.`);\n\n\t\t\treturn {\n\t\t\t\ttoken: '',\n\t\t\t};\n\t\t}\n\n\t\tif (!(mapId in this.#sasTokens.tokens)) {\n\t\t\tLogger.error(`SAS token for map ${mapId} not found!`);\n\n\t\t\treturn {\n\t\t\t\ttoken: '',\n\t\t\t};\n\t\t}\n\n\t\treturn this.#sasTokens.tokens[mapId];\n\t}\n\n\t/**\n\t * Check if the token manager is in enterprise mode.\n\t */\n\tisEnterpriseMode(): boolean {\n\t\treturn this.#options.enterprise ?? false;\n\t}\n\n\t/**\n\t * Subscribe to events emitted by the token manager.\n\t */\n\ton: TokenManagerPubSub['on'] = (eventName, fn) => {\n\t\treturn this.#pubsub.on(eventName, fn);\n\t};\n\n\t/**\n\t * Unsubscribe from events emitted by the token manager.\n\t */\n\toff: TokenManagerPubSub['off'] = (eventName, fn) => {\n\t\treturn this.#pubsub.off(eventName, fn);\n\t};\n\n\t/**\n\t * Clean up the token manager.\n\t */\n\tdestroy() {\n\t\tthis.#stopRefreshing();\n\t\tthis.#pubsub.destroy();\n\t\tif (isBrowser()) {\n\t\t\tglobalThis.removeEventListener('focus', this.#handleWindowFocus);\n\t\t}\n\t}\n}\n", "import MapData from './map-data';\nimport type { TGetMapDataOptions } from '../../packages/mvf-utils';\nimport type { ParsedMVF as TMVF, ParsedMVFLocalePack } from '@mappedin/mvf-v2';\nimport { MapDataInternal } from './map-data-objects';\nimport { Logger } from '@packages/internal/common';\nimport type { LanguagePackHydrationItem } from './types';\nimport {\n\tcreateEnvControl,\n\tgetBuildingIds,\n\tparseLanguagePack,\n\tunzipAndParseMVFv2,\n} from '@packages/internal/mvf-utils/mvf-utils';\nimport type { TMapDataInternalOptions } from './map-data-objects/types';\nimport { TokenManager } from '@packages/internal/mvf-utils/tokens/token-manager';\nimport type { AnalyticsUpdateOptions } from './analytics';\nimport { shouldForceEnterpriseLocations } from '.';\n\nexport type THydrateMapDataBundle =\n\t| {\n\t\t\ttype: 'binary';\n\t\t\toptions?: {\n\t\t\t\tversion?: '2.0.0' | '3.0.0';\n\t\t\t\tenterprise?: boolean;\n\t\t\t};\n\t\t\tlanguagePacks?: {\n\t\t\t\tlanguage: { code: string; name: string };\n\t\t\t\tlocalePack: Uint8Array;\n\t\t\t}[];\n\t\t\tmain: Uint8Array;\n\t  }\n\t| {\n\t\t\ttype: 'json';\n\t\t\toptions?: {\n\t\t\t\tversion?: '2.0.0' | '3.0.0';\n\t\t\t\tenterprise?: boolean;\n\t\t\t};\n\t\t\tlanguagePacks?: {\n\t\t\t\tlanguage: { code: string; name: string };\n\t\t\t\tlocalePack: ParsedMVFLocalePack;\n\t\t\t}[];\n\t\t\tmain: TMVF;\n\t  };\n\n/**\n * Load a MapData instance from a backup including language packs. Pass in userOptions to ensure outdoor view is available.\n */\nexport const hydrateMapData = async (\n\tbackup: THydrateMapDataBundle | TMVF,\n\tuserOptions?: TGetMapDataOptions,\n): Promise<MapData> => {\n\tconst mvfVersion =\n\t\t('mvfVersion' in (userOptions ?? {}) ? userOptions?.mvfVersion : undefined) ??\n\t\t('options' in backup && 'version' in (backup.options ?? {}) ? backup.options?.version : undefined);\n\tconst userOptionsWithDefaults: TGetMapDataOptions = {\n\t\tprefetchTokens: true,\n\t\t...(userOptions || ({} as TGetMapDataOptions)),\n\t\tmvfVersion,\n\t};\n\tlet mvf: TMVF;\n\tconst env = createEnvControl();\n\tenv.updateByUserOption(userOptionsWithDefaults);\n\tconst internalOptions: TMapDataInternalOptions = {};\n\n\tif ('type' in backup && typeof backup.type === 'string') {\n\t\tinternalOptions.enterprise = backup.options?.enterprise;\n\n\t\tif (backup.type === 'binary' && backup.main instanceof Uint8Array) {\n\t\t\tmvf = await unzipAndParseMVFv2(backup.main, userOptionsWithDefaults.mvfVersion);\n\t\t\tinternalOptions.languagePacks = [];\n\t\t\tfor (const lp of backup.languagePacks ?? []) {\n\t\t\t\tif (lp.localePack instanceof Uint8Array) {\n\t\t\t\t\tinternalOptions.languagePacks.push({\n\t\t\t\t\t\tlanguage: lp.language,\n\t\t\t\t\t\tlocalePack: await parseLanguagePack(lp.localePack),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (backup.type === 'json') {\n\t\t\tmvf = backup.main as TMVF;\n\t\t\tinternalOptions.languagePacks = (backup.languagePacks as LanguagePackHydrationItem[]) ?? [];\n\t\t} else {\n\t\t\tthrow new Error('Invalid backup type');\n\t\t}\n\n\t\tif (backup.type === 'binary' && backup.main instanceof Uint8Array) {\n\t\t\tinternalOptions.binaryBundle = backup.main;\n\t\t}\n\t} else {\n\t\tmvf = backup as TMVF;\n\t\tinternalOptions.enterprise = mvf.enterprise != null;\n\t}\n\n\tenv.setEnterprise(internalOptions.enterprise ?? false);\n\n\tconst floorStackIds = getBuildingIds(mvf);\n\tconst mapIds = floorStackIds.length > 0 ? floorStackIds : [userOptionsWithDefaults.mapId];\n\t// baseAuthUri needs to be set before tokenManager gets instantiated\n\tuserOptionsWithDefaults.baseAuthUri = env.getBaseAuthUri();\n\tconst tokenManager = new TokenManager(mapIds, {\n\t\t...userOptionsWithDefaults,\n\t\tenterprise: internalOptions.enterprise,\n\t});\n\tlet accessToken: string | undefined;\n\tif ('accessToken' in userOptionsWithDefaults && userOptionsWithDefaults.accessToken) {\n\t\taccessToken = userOptionsWithDefaults.accessToken;\n\t} else if ('key' in userOptionsWithDefaults && 'secret' in userOptionsWithDefaults) {\n\t\tlet tokenData;\n\t\ttry {\n\t\t\ttokenData = await tokenManager.getAccessTokenAsync();\n\t\t} catch (e) {\n\t\t\tLogger.error('Failed getting token during hydrateMapData', e);\n\t\t}\n\t\taccessToken = tokenData?.token || '';\n\t}\n\n\tinternalOptions.outdoorViewToken = accessToken;\n\tinternalOptions.env = env;\n\tinternalOptions.getMapDataOptions = userOptionsWithDefaults;\n\n\tif (userOptionsWithDefaults.prefetchTokens) {\n\t\ttry {\n\t\t\tawait tokenManager.readySync();\n\t\t} catch (e) {\n\t\t\tLogger.error('Failed to ready token manager!', e);\n\t\t}\n\t}\n\n\tif (shouldForceEnterpriseLocations()) {\n\t\tif (internalOptions.enterprise) {\n\t\t\tLogger.warn('forceEnterpriseLocations is enabled, but the map is already an enterprise map!');\n\t\t}\n\n\t\tif (userOptionsWithDefaults.mvfVersion !== '3.0.0') {\n\t\t\tLogger.warn(\"mvfVersion must be '3.0.0' when forceEnterpriseLocations is enabled!\");\n\t\t}\n\t}\n\n\tconst mapDataInternal = new MapDataInternal(mvf, internalOptions);\n\tif (accessToken) {\n\t\tmapDataInternal.Analytics.init({\n\t\t\taccessToken,\n\t\t\tmapId: userOptionsWithDefaults.mapId,\n\t\t\tkey: 'key' in userOptionsWithDefaults ? userOptionsWithDefaults.key : undefined,\n\t\t\tsecret: 'secret' in userOptionsWithDefaults ? userOptionsWithDefaults.secret : undefined,\n\t\t\t...userOptionsWithDefaults.analytics,\n\t\t\tbaseUri: env.getAnalyticsBaseUri(),\n\t\t\tcontext: userOptionsWithDefaults.analytics?.context as AnalyticsUpdateOptions['context'],\n\t\t});\n\t}\n\n\tconst mapData = new MapData(mapDataInternal);\n\n\tconst language = mapDataInternal.findPreferredLanguage({\n\t\tlanguageCode: userOptionsWithDefaults.language,\n\t\tfallbackToNavigatorLanguage: false,\n\t});\n\tif (language) {\n\t\ttry {\n\t\t\tawait mapData.changeLanguage(language.code);\n\t\t} catch (e) {\n\t\t\t/* empty */\n\t\t}\n\t}\n\n\tif (typeof userOptions?.onMVFParsed === 'function') {\n\t\tuserOptions.onMVFParsed(mvf);\n\t}\n\n\treturn mapData;\n};\n", "type AddStyleOptions = Partial<{\n\tid: string;\n}>;\n\nexport const injectCSS = (style: string | string[], { id }: AddStyleOptions = {}) => {\n\tconst stylesArr = Array.isArray(style) ? style : [style];\n\tif (!stylesArr.every(s => typeof s === 'string')) {\n\t\treturn;\n\t}\n\n\tconst styleContent = stylesArr.join('');\n\tlet styleElement: HTMLStyleElement | null = null;\n\n\t// Don't add the same style twice\n\tif (id) {\n\t\tconst existing = document.getElementById(id);\n\t\tif (existing instanceof HTMLStyleElement) {\n\t\t\tstyleElement = existing;\n\t\t}\n\t}\n\n\tif (styleElement == null) {\n\t\tstyleElement = document.createElement('style');\n\t}\n\n\tif (id && id !== '') {\n\t\tstyleElement.id = id;\n\t}\n\n\t// Add the style to the document\n\tstyleElement.textContent = styleContent;\n\tdocument.head.appendChild(styleElement);\n};\n", ":root {\n\t--pin-shadow-hover-scale: 0.9;\n\t--pin-shadow-width: 12px;\n\t--pin-shadow-height: 5px;\n\t--pin-shadow-opacity: 0.35;\n\t--pin-drop-animation-duration-ms: 250ms;\n}\n\n@keyframes drop-pin {\n\t0% {\n\t\ttransform: translateY(-200%);\n\t}\n\n\t100% {\n\t\ttransform: translateY(0);\n\t}\n}\n\n@keyframes pin-shadow {\n\t0% {\n\t\ttransform: scale(var(--pin-shadow-hover-scale));\n\t}\n\n\t100% {\n\t\ttransform: scale(1);\n\t}\n}\n\n.mappedin-dropped-pin-wrapper {\n\tposition: relative;\n\n\twidth: fit-content;\n\theight: fit-content;\n\twidth: 36px;\n\theight: 42px;\n\n\t& svg {\n\t\tposition: absolute;\n\t\tleft: calc(50% - var(--pin-shadow-width));\n\t\tanimation: drop-pin var(--pin-drop-animation-duration-ms) ease-in;\n\t}\n\n\t& > .pin-shadow {\n\t\tposition: absolute;\n\t\tleft: calc(50% - (var(--pin-shadow-width) / 2));\n\t\tbottom: 0;\n\n\t\theight: var(--pin-shadow-height);\n\t\twidth: var(--pin-shadow-width);\n\t\tborder-radius: 100%;\n\n\t\topacity: var(--pin-shadow-opacity);\n\n\t\tanimation: pin-shadow 250ms ease-in;\n\t}\n}\n\n@keyframes bounce {\n\t0% {\n\t\ttransform: translateY(-10px);\n\t\topacity: 0;\n\t}\n\t12.5% {\n\t\ttransform: translateY(0);\n\t\topacity: 1;\n\t}\n\t25% {\n\t\ttransform: translateY(0);\n\t}\n\t37.5% {\n\t\ttransform: translateY(-10px);\n\t}\n\t50% {\n\t\ttransform: translateY(0);\n\t}\n\t62.5% {\n\t\ttransform: translateY(-10px);\n\t}\n\t75% {\n\t\ttransform: translateY(0);\n\t}\n\t87.5% {\n\t\ttransform: translateY(-10px);\n\t}\n\t100% {\n\t\ttransform: translateY(0);\n\t}\n}\n\n.mappedin-connection-marker {\n\tposition: relative;\n\tdisplay: flex;\n\n\t.bouncey {\n\t\tanimation: bounce 2.5s linear;\n\t}\n\n\t.arrow--down {\n\t\ttransform: rotate(180deg);\n\t}\n\n\t.connection-circle {\n\t\tdisplay: flex;\n\t\tbox-sizing: border-box;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\tborder-radius: 50%;\n\t\tborder: 2px solid white;\n\t\tbox-shadow: 0px 2px 8px 0px rgba(0, 0, 0, 0.15);\n\t\tbackground: #595959;\n\t}\n}\n", ".mappedin-marker {\n\tfont-family: 'InterUI-Regular', Helvetica, Arial, sans-serif;\n\tfont-weight: normal;\n\ttop: 0;\n\tposition: absolute;\n\tfont-weight: bold;\n\tcolor: black;\n\tdisplay: flex;\n\tflex-direction: row;\n\twill-change: transform, opacity;\n\ttransition: opacity 150ms ease-in-out;\n\tjustify-content: center;\n\topacity: 0;\n}\n\n/* Low priority pin strategy styles */\n\n/* Hide child elements as well */\n.mappedin-marker[data-placement='hidden'] > .mappedin-marker-content {\n\tvisibility: hidden;\n}\n\n/* Create the pin using ::before pseudo-element */\n.mappedin-marker::before {\n\tcontent: '';\n\tdisplay: none;\n\tborder-radius: 50%;\n\tposition: relative;\n\t/* Default values - will be overridden by inline styles */\n\twidth: var(--mappedin-pin-size, 2px);\n\theight: var(--mappedin-pin-size, 2px);\n\tbackground-color: var(--pin-color, #666);\n}\n\n.mappedin-marker[data-placement='hidden']::before {\n\tdisplay: block;\n}\n", ".mappedin__smart-collision-engine__container {\n\tposition: absolute;\n\tleft: 0px;\n\ttop: 0px;\n\tbottom: 0px;\n\tright: 0px;\n\tpointer-events: none;\n\t/* Enables colliders to use translate3D */\n\ttransform-style: preserve-3d;\n\tfont-family: 'InterUI-Regular', Helvetica, Arial, sans-serif;\n}\n\n.mappedin__smart-collision-engine-debug__container {\n\tposition: absolute;\n\tleft: 0px;\n\ttop: 0px;\n\tbottom: 0px;\n\tright: 0px;\n\ttransition: opacity 300ms ease-in-out;\n\tpointer-events: none;\n\twill-change: opacity;\n\t&.interacting {\n\t\topacity: 0.2;\n\t}\n}\n", ".mappedin-map {\n\t.mappedin-interactive {\n\t\tcursor: grab;\n\n\t\t&:active {\n\t\t\tcursor: grabbing;\n\t\t}\n\n\t\t&.mappedin-interaction-hover {\n\t\t\tcursor: pointer;\n\t\t}\n\t}\n}\n", ".mappedin-map {\n\t.mappedin-control-container {\n\t\tposition: absolute;\n\t\tleft: 0px;\n\t\ttop: 0px;\n\t\tbottom: 0px;\n\t\tright: 0px;\n\t\tpointer-events: none;\n\t\tfont-family: 'InterUI-Regular', Helvetica, Arial, sans-serif;\n\n\t\t.mappedin-ctrl-top-left,\n\t\t.mappedin-ctrl-top-right,\n\t\t.mappedin-ctrl-bottom-left,\n\t\t.mappedin-ctrl-bottom-right {\n\t\t\tposition: absolute;\n\t\t\tpointer-events: none;\n\t\t}\n\n\t\t.mappedin-ctrl-top-left {\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t}\n\n\t\t.mappedin-ctrl-top-right {\n\t\t\ttop: 0;\n\t\t\tright: 0;\n\t\t}\n\n\t\t.mappedin-ctrl-bottom-left {\n\t\t\tbottom: 0;\n\t\t\tleft: 0;\n\t\t}\n\n\t\t.mappedin-ctrl-bottom-right {\n\t\t\tbottom: 0;\n\t\t\tright: 0;\n\t\t}\n\n\t\t.mappedin-ctrl-attrib {\n\t\t\tdisplay: block;\n\t\t\tposition: relative;\n\t\t\tpointer-events: auto;\n\t\t\tfont: 9px/11px 'InterUI-Regular', Helvetica, Arial, sans-serif;\n\t\t\tpadding: 3px 5px 1px 5px;\n\t\t\tbackground-color: rgba(255, 255, 255, 0.5);\n\t\t\tmargin: 0;\n\t\t\tmin-width: 11px;\n\t\t\tmin-height: 11px;\n\t\t\tuser-select: none;\n\n\t\t\tsummary.mappedin-ctrl-attrib-button {\n\t\t\t\tappearance: none;\n\t\t\t\tlist-style: none;\n\t\t\t}\n\n\t\t\tsummary.mappedin-ctrl-attrib-button::-webkit-details-marker {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\n\t\t\t&.mappedin-compact .mappedin-ctrl-attrib-button,\n\t\t\t&.mappedin-compact-show .mappedin-ctrl-attrib-inner {\n\t\t\t\tdisplay: inline-block;\n\t\t\t}\n\n\t\t\t&.mappedin-compact {\n\t\t\t\tbackground-color: transparent;\n\t\t\t}\n\n\t\t\t&.mappedin-compact-show {\n\t\t\t\tmin-width: 15px;\n\t\t\t\tmin-height: 15px;\n\t\t\t\tbox-sizing: border-box;\n\t\t\t\tbackground-color: rgba(255, 255, 255, 0.5);\n\t\t\t}\n\t\t}\n\n\t\t.mappedin-ctrl-attrib-top-left {\n\t\t\tfloat: left;\n\t\t\tborder-bottom-right-radius: 4px;\n\t\t}\n\n\t\t.mappedin-ctrl-attrib-top-right {\n\t\t\tfloat: right;\n\t\t\tborder-bottom-left-radius: 4px;\n\t\t}\n\n\t\t.mappedin-ctrl-attrib-bottom-left {\n\t\t\tfloat: left;\n\t\t\tborder-top-right-radius: 4px;\n\t\t}\n\n\t\t.mappedin-ctrl-attrib-bottom-right {\n\t\t\tfloat: right;\n\t\t\tborder-top-left-radius: 4px;\n\t\t}\n\t\t.mappedin-ctrl-attrib-top-left,\n\t\t.mappedin-ctrl-attrib-bottom-left {\n\t\t\tpadding: 3px 5px 1px 20px;\n\t\t}\n\n\t\t.mappedin-ctrl-attrib-inner {\n\t\t\tdisplay: inline-block;\n\t\t\tmargin-right: 12px;\n\t\t}\n\n\t\t.mappedin-ctrl-attrib-inner,\n\t\t.mappedin-ctrl-attrib-inner a {\n\t\t\tcolor: rgba(0, 0, 0, 0.75);\n\t\t\ttext-decoration: none;\n\t\t}\n\n\t\t.mappedin-ctrl-attrib-inner-bold,\n\t\t.mappedin-ctrl-attrib-inner-bold a {\n\t\t\tfont-weight: bold;\n\t\t}\n\n\t\t.mappedin-ctrl-attrib-inner a:hover {\n\t\t\tcolor: #017ef1;\n\t\t\ttext-decoration: underline;\n\t\t\tcursor: pointer;\n\t\t}\n\n\t\t.mappedin-ctrl-attrib-button {\n\t\t\tdisplay: none;\n\t\t\tcursor: pointer;\n\t\t\tposition: absolute;\n\t\t\twidth: 15px;\n\t\t\theight: 15px;\n\t\t\tbox-sizing: border-box;\n\t\t\tborder-radius: 50%;\n\t\t\ttop: 0;\n\t\t\tright: 2px;\n\t\t\tborder: 1px;\n\t\t}\n\t\t.mappedin-ctrl-attrib-top-left .mappedin-ctrl-attrib-button,\n\t\t.mappedin-ctrl-attrib-bottom-left .mappedin-ctrl-attrib-button {\n\t\t\tleft: 2px;\n\t\t}\n\t}\n}\n", ".maplibregl-map {\n    font: 12px/20px \"Helvetica Neue\", Arial, Helvetica, sans-serif;\n    overflow: hidden;\n    position: relative;\n    -webkit-tap-highlight-color: rgb(0 0 0 / 0%);\n}\n\n.maplibregl-canvas {\n    position: absolute;\n    left: 0;\n    top: 0;\n}\n\n.maplibregl-map:fullscreen {\n    width: 100%;\n    height: 100%;\n}\n\n.maplibregl-ctrl-group button.maplibregl-ctrl-compass {\n    touch-action: none;\n}\n\n.maplibregl-canvas-container.maplibregl-interactive,\n.maplibregl-ctrl-group button.maplibregl-ctrl-compass {\n    cursor: grab;\n    user-select: none;\n}\n\n.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer {\n    cursor: pointer;\n}\n\n.maplibregl-canvas-container.maplibregl-interactive:active,\n.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active {\n    cursor: grabbing;\n}\n\n.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,\n.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas {\n    touch-action: pan-x pan-y;\n}\n\n.maplibregl-canvas-container.maplibregl-touch-drag-pan,\n.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas {\n    touch-action: pinch-zoom;\n}\n\n.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,\n.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas {\n    touch-action: none;\n}\n\n.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,\n.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas {\n    touch-action: pan-x pan-y;\n}\n\n.maplibregl-ctrl-top-left,\n.maplibregl-ctrl-top-right,\n.maplibregl-ctrl-bottom-left,\n.maplibregl-ctrl-bottom-right {\n    position: absolute;\n    pointer-events: none;\n    z-index: 2;\n}\n\n.maplibregl-ctrl-top-left {\n    top: 0;\n    left: 0;\n}\n\n.maplibregl-ctrl-top-right {\n     top: 0;\n     right: 0;\n    }\n\n.maplibregl-ctrl-bottom-left {\n    bottom: 0;\n    left: 0;\n}\n\n.maplibregl-ctrl-bottom-right {\n     right: 0;\n     bottom: 0;\n}\n\n.maplibregl-ctrl {\n    clear: both;\n    pointer-events: auto;\n\n    /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n    transform: translate(0, 0);\n}\n\n.maplibregl-ctrl-top-left .maplibregl-ctrl {\n    margin: 10px 0 0 10px;\n     float: left;\n}\n\n.maplibregl-ctrl-top-right .maplibregl-ctrl {\n    margin: 10px 10px 0 0;\n    float: right;\n}\n\n.maplibregl-ctrl-bottom-left .maplibregl-ctrl {\n    margin: 0 0 10px 10px;\n    float: left;\n}\n\n.maplibregl-ctrl-bottom-right .maplibregl-ctrl {\n    margin: 0 10px 10px 0;\n    float: right;\n}\n\n.maplibregl-ctrl-group {\n    border-radius: 4px;\n    background: #fff;\n}\n\n.maplibregl-ctrl-group:not(:empty) {\n    box-shadow: 0 0 0 2px rgb(0 0 0 / 10%);\n}\n\n@media (forced-colors: active) {\n    .maplibregl-ctrl-group:not(:empty) {\n        box-shadow: 0 0 0 2px ButtonText;\n    }\n}\n\n.maplibregl-ctrl-group button {\n    width: 29px;\n    height: 29px;\n    display: block;\n    padding: 0;\n    outline: none;\n    border: 0;\n    box-sizing: border-box;\n    background-color: transparent;\n    cursor: pointer;\n}\n\n.maplibregl-ctrl-group button + button {\n    border-top: 1px solid #ddd;\n}\n\n.maplibregl-ctrl button .maplibregl-ctrl-icon {\n    display: block;\n    width: 100%;\n    height: 100%;\n    background-repeat: no-repeat;\n    background-position: center center;\n}\n\n@media (forced-colors: active) {\n    .maplibregl-ctrl-icon {\n        background-color: transparent;\n    }\n\n    .maplibregl-ctrl-group button + button {\n        border-top: 1px solid ButtonText;\n    }\n}\n\n/* https://bugzilla.mozilla.org/show_bug.cgi?id=140562 */\n.maplibregl-ctrl button::-moz-focus-inner {\n    border: 0;\n    padding: 0;\n}\n\n.maplibregl-ctrl-attrib-button:focus,\n.maplibregl-ctrl-group button:focus {\n    box-shadow: 0 0 2px 2px rgb(0 150 255 / 100%);\n}\n\n.maplibregl-ctrl button:disabled {\n    cursor: not-allowed;\n}\n\n.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon {\n    opacity: 0.25;\n}\n\n@media (hover: hover) {\n    .maplibregl-ctrl button:not(:disabled):hover {\n        background-color: rgb(0 0 0/5%);\n    }\n}\n\n.maplibregl-ctrl button:not(:disabled):active {\n    background-color: rgb(0 0 0/5%);\n}\n\n.maplibregl-ctrl-group button:focus:focus-visible {\n    box-shadow: 0 0 2px 2px rgb(0 150 255 / 100%);\n}\n\n.maplibregl-ctrl-group button:focus:not(:focus-visible) {\n    box-shadow: none;\n}\n\n.maplibregl-ctrl-group button:focus:first-child {\n    border-radius: 4px 4px 0 0;\n}\n\n.maplibregl-ctrl-group button:focus:last-child {\n    border-radius: 0 0 4px 4px;\n}\n\n.maplibregl-ctrl-group button:focus:only-child {\n    border-radius: inherit;\n}\n\n.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon {\n    background-image: svg-load(\"svg/maplibregl-ctrl-zoom-out.svg\", fill: #333);\n}\n\n.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon {\n    background-image: svg-load(\"svg/maplibregl-ctrl-zoom-in.svg\", fill: #333);\n}\n\n@media (forced-colors: active) {\n    .maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon {\n        background-image: svg-load(\"svg/maplibregl-ctrl-zoom-out.svg\", fill: #fff);\n    }\n\n    .maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon {\n        background-image: svg-load(\"svg/maplibregl-ctrl-zoom-in.svg\", fill: #fff);\n    }\n}\n\n@media (forced-colors: active) and (prefers-color-scheme: light) {\n    .maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon {\n        background-image: svg-load(\"svg/maplibregl-ctrl-zoom-out.svg\", fill: #000);\n    }\n\n    .maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon {\n        background-image: svg-load(\"svg/maplibregl-ctrl-zoom-in.svg\", fill: #000);\n    }\n}\n\n.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon {\n    background-image: svg-load(\"svg/maplibregl-ctrl-fullscreen.svg\", fill: #333);\n}\n\n.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon {\n    background-image: svg-load(\"svg/maplibregl-ctrl-shrink.svg\");\n}\n\n@media (forced-colors: active) {\n    .maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon {\n        background-image: svg-load(\"svg/maplibregl-ctrl-fullscreen.svg\", fill: #fff);\n    }\n\n    .maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon {\n        background-image: svg-load(\"svg/maplibregl-ctrl-shrink.svg\", fill: #fff);\n    }\n}\n\n@media (forced-colors: active) and (prefers-color-scheme: light) {\n    .maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon {\n        background-image: svg-load(\"svg/maplibregl-ctrl-fullscreen.svg\", fill: #000);\n    }\n\n    .maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon {\n        background-image: svg-load(\"svg/maplibregl-ctrl-shrink.svg\", fill: #000);\n    }\n}\n\n.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon {\n    background-image: svg-load(\"svg/maplibregl-ctrl-compass.svg\", fill: #333);\n}\n\n@media (forced-colors: active) {\n    .maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon {\n        @svg-load ctrl-compass-white url(\"svg/maplibregl-ctrl-compass.svg\") {\n            fill: #fff;\n            #south { fill: #999; }\n        }\n\n        background-image: svg-inline(ctrl-compass-white);\n    }\n}\n\n@media (forced-colors: active) and (prefers-color-scheme: light) {\n    .maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon {\n        background-image: svg-load(\"svg/maplibregl-ctrl-compass.svg\", fill: #000);\n    }\n}\n\n@svg-load ctrl-globe url(\"svg/maplibregl-ctrl-globe.svg\") {\n    stroke: #333;\n}\n\n@svg-load ctrl-globe-enabled url(\"svg/maplibregl-ctrl-globe.svg\") {\n    stroke: #33b5e5;\n}\n\n.maplibregl-ctrl button.maplibregl-ctrl-globe .maplibregl-ctrl-icon {\n    background-image: svg-inline(ctrl-globe);\n}\n\n.maplibregl-ctrl button.maplibregl-ctrl-globe-enabled .maplibregl-ctrl-icon {\n    background-image: svg-inline(ctrl-globe-enabled);\n}\n\n@svg-load ctrl-terrain url(\"svg/maplibregl-ctrl-terrain.svg\") {\n    fill: #333;\n    \n}\n\n@svg-load ctrl-terrain-enabled url(\"svg/maplibregl-ctrl-terrain.svg\") {\n    fill: #33b5e5;\n    \n}\n\n.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon {\n    background-image: svg-inline(ctrl-terrain);\n}\n\n.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon {\n    background-image: svg-inline(ctrl-terrain-enabled);\n}\n\n@svg-load ctrl-geolocate url(\"svg/maplibregl-ctrl-geolocate.svg\") {\n    fill: #333;\n    #stroke { display: none; }\n}\n\n@svg-load ctrl-geolocate-white url(\"svg/maplibregl-ctrl-geolocate.svg\") {\n    fill: #fff;\n    #stroke { display: none; }\n}\n\n@svg-load ctrl-geolocate-black url(\"svg/maplibregl-ctrl-geolocate.svg\") {\n    fill: #000;\n    #stroke { display: none; }\n}\n\n@svg-load ctrl-geolocate-disabled url(\"svg/maplibregl-ctrl-geolocate.svg\") {\n    fill: #aaa;\n    #stroke { fill: #f00; }\n}\n\n@svg-load ctrl-geolocate-disabled-white url(\"svg/maplibregl-ctrl-geolocate.svg\") {\n    fill: #999;\n    #stroke { fill: #f00; }\n}\n\n@svg-load ctrl-geolocate-disabled-black url(\"svg/maplibregl-ctrl-geolocate.svg\") {\n    fill: #666;\n    #stroke { fill: #f00; }\n}\n\n@svg-load ctrl-geolocate-active url(\"svg/maplibregl-ctrl-geolocate.svg\") {\n    fill: #33b5e5;\n    #stroke { display: none; }\n}\n\n@svg-load ctrl-geolocate-active-error url(\"svg/maplibregl-ctrl-geolocate.svg\") {\n    fill: #e58978;\n    #stroke { display: none; }\n}\n\n@svg-load ctrl-geolocate-background url(\"svg/maplibregl-ctrl-geolocate.svg\") {\n    fill: #33b5e5;\n    #stroke { display: none; }\n    #dot { display: none; }\n}\n\n@svg-load ctrl-geolocate-background-error url(\"svg/maplibregl-ctrl-geolocate.svg\") {\n    fill: #e54e33;\n    #stroke { display: none; }\n    #dot { display: none; }\n}\n\n.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon {\n    background-image: svg-inline(ctrl-geolocate);\n}\n\n.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon {\n    background-image: svg-inline(ctrl-geolocate-disabled);\n}\n\n.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon {\n    background-image: svg-inline(ctrl-geolocate-active);\n}\n\n.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon {\n    background-image: svg-inline(ctrl-geolocate-active-error);\n}\n\n.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon {\n    background-image: svg-inline(ctrl-geolocate-background);\n}\n\n.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon {\n    background-image: svg-inline(ctrl-geolocate-background-error);\n}\n\n.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon {\n    animation: maplibregl-spin 2s infinite linear;\n}\n\n@media (forced-colors: active) {\n    .maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon {\n        background-image: svg-inline(ctrl-geolocate-white);\n    }\n\n    .maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon {\n        background-image: svg-inline(ctrl-geolocate-disabled-white);\n    }\n\n    .maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon {\n        background-image: svg-inline(ctrl-geolocate-active);\n    }\n\n    .maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon {\n        background-image: svg-inline(ctrl-geolocate-active-error);\n    }\n\n    .maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon {\n        background-image: svg-inline(ctrl-geolocate-background);\n    }\n\n    .maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon {\n        background-image: svg-inline(ctrl-geolocate-background-error);\n    }\n}\n\n@media (forced-colors: active) and (prefers-color-scheme: light) {\n    .maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon {\n        background-image: svg-inline(ctrl-geolocate-black);\n    }\n\n    .maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon {\n        background-image: svg-inline(ctrl-geolocate-disabled-black);\n    }\n}\n\n@keyframes maplibregl-spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n}\n\na.maplibregl-ctrl-logo {\n    width: 88px;\n    height: 23px;\n    margin: 0 0 -4px -4px;\n    display: block;\n    background-repeat: no-repeat;\n    cursor: pointer;\n    overflow: hidden;\n    background-image: svg-load(\"svg/maplibregl-ctrl-logo.svg\");\n}\n\na.maplibregl-ctrl-logo.maplibregl-compact {\n    width: 14px;\n}\n\n@media (forced-colors: active) {\n    a.maplibregl-ctrl-logo {\n        @svg-load ctrl-logo-white url(\"svg/maplibregl-ctrl-logo.svg\") {\n            #outline { opacity: 1; }\n            #fill { opacity: 1; }\n        }\n\n        background-color: transparent;\n        background-image: svg-inline(ctrl-logo-white);\n    }\n}\n\n@media (forced-colors: active) and (prefers-color-scheme: light) {\n    a.maplibregl-ctrl-logo {\n        @svg-load ctrl-logo-black url(\"svg/maplibregl-ctrl-logo.svg\") {\n            #outline { opacity: 1; fill: #fff; stroke: #fff; }\n            #fill { opacity: 1; fill: #000; }\n        }\n\n        background-image: svg-inline(ctrl-logo-black);\n    }\n}\n\n.maplibregl-ctrl.maplibregl-ctrl-attrib {\n    padding: 0 5px;\n    background-color: rgb(255 255 255 / 50%);\n    margin: 0;\n}\n\n@media screen {\n    .maplibregl-ctrl-attrib.maplibregl-compact {\n        min-height: 20px;\n        padding: 2px 24px 2px 0;\n        margin: 10px;\n        position: relative;\n        background-color: #fff;\n        color: #000;\n        border-radius: 12px;\n        box-sizing: content-box;\n    }\n\n    .maplibregl-ctrl-attrib.maplibregl-compact-show {\n        padding: 2px 28px 2px 8px;\n        visibility: visible;\n    }\n\n    .maplibregl-ctrl-top-left > .maplibregl-ctrl-attrib.maplibregl-compact-show,\n    .maplibregl-ctrl-bottom-left > .maplibregl-ctrl-attrib.maplibregl-compact-show {\n        padding: 2px 8px 2px 28px;\n        border-radius: 12px;\n    }\n\n    .maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner {\n        display: none;\n    }\n\n    .maplibregl-ctrl-attrib-button {\n        display: none;\n        cursor: pointer;\n        position: absolute;\n        background-image: svg-load(\"svg/maplibregl-ctrl-attrib.svg\");\n        background-color: rgb(255 255 255 / 50%);\n        width: 24px;\n        height: 24px;\n        box-sizing: border-box;\n        border-radius: 12px;\n        outline: none;\n        top: 0;\n        right: 0;\n        border: 0;\n    }\n\n    .maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button {\n        appearance: none;\n        list-style: none;\n    }\n\n    .maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker {\n        display: none;\n    }\n\n    .maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button,\n    .maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button {\n        left: 0;\n    }\n\n    .maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,\n    .maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner {\n        display: block;\n    }\n\n    .maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button {\n        background-color: rgb(0 0 0 / 5%);\n    }\n\n    .maplibregl-ctrl-bottom-right > .maplibregl-ctrl-attrib.maplibregl-compact::after {\n        bottom: 0;\n        right: 0;\n    }\n\n    .maplibregl-ctrl-top-right > .maplibregl-ctrl-attrib.maplibregl-compact::after {\n        top: 0;\n        right: 0;\n    }\n\n    .maplibregl-ctrl-top-left > .maplibregl-ctrl-attrib.maplibregl-compact::after {\n        top: 0;\n        left: 0;\n    }\n\n    .maplibregl-ctrl-bottom-left > .maplibregl-ctrl-attrib.maplibregl-compact::after {\n        bottom: 0;\n        left: 0;\n    }\n}\n\n@media screen and (forced-colors: active) {\n    .maplibregl-ctrl-attrib.maplibregl-compact::after {\n        background-image: svg-load(\"svg/maplibregl-ctrl-attrib.svg\", fill=#fff);\n    }\n}\n\n@media screen and (forced-colors: active) and (prefers-color-scheme: light) {\n    .maplibregl-ctrl-attrib.maplibregl-compact::after {\n        background-image: svg-load(\"svg/maplibregl-ctrl-attrib.svg\");\n    }\n}\n\n.maplibregl-ctrl-attrib a {\n    color: rgb(0 0 0 / 75%);\n    text-decoration: none;\n}\n\n.maplibregl-ctrl-attrib a:hover {\n    color: inherit;\n    text-decoration: underline;\n}\n\n.maplibregl-attrib-empty {\n    display: none;\n}\n\n.maplibregl-ctrl-scale {\n    background-color: rgb(255 255 255 / 75%);\n    font-size: 10px;\n    border-width: medium 2px 2px;\n    border-style: none solid solid;\n    border-color: #333;\n    padding: 0 5px;\n    color: #333;\n    box-sizing: border-box;\n}\n\n.maplibregl-popup {\n    position: absolute;\n    top: 0;\n    left: 0;\n    display: flex;\n    will-change: transform;\n    pointer-events: none;\n}\n\n.maplibregl-popup-anchor-top,\n.maplibregl-popup-anchor-top-left,\n.maplibregl-popup-anchor-top-right {\n    flex-direction: column;\n}\n\n.maplibregl-popup-anchor-bottom,\n.maplibregl-popup-anchor-bottom-left,\n.maplibregl-popup-anchor-bottom-right {\n    flex-direction: column-reverse;\n}\n\n.maplibregl-popup-anchor-left {\n    flex-direction: row;\n}\n\n.maplibregl-popup-anchor-right {\n    flex-direction: row-reverse;\n}\n\n.maplibregl-popup-tip {\n    width: 0;\n    height: 0;\n    border: 10px solid transparent;\n    z-index: 1;\n}\n\n.maplibregl-popup-anchor-top .maplibregl-popup-tip {\n    align-self: center;\n    border-top: none;\n    border-bottom-color: #fff;\n}\n\n.maplibregl-popup-anchor-top-left .maplibregl-popup-tip {\n    align-self: flex-start;\n    border-top: none;\n    border-left: none;\n    border-bottom-color: #fff;\n}\n\n.maplibregl-popup-anchor-top-right .maplibregl-popup-tip {\n    align-self: flex-end;\n    border-top: none;\n    border-right: none;\n    border-bottom-color: #fff;\n}\n\n.maplibregl-popup-anchor-bottom .maplibregl-popup-tip {\n    align-self: center;\n    border-bottom: none;\n    border-top-color: #fff;\n}\n\n.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip {\n    align-self: flex-start;\n    border-bottom: none;\n    border-left: none;\n    border-top-color: #fff;\n}\n\n.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip {\n    align-self: flex-end;\n    border-bottom: none;\n    border-right: none;\n    border-top-color: #fff;\n}\n\n.maplibregl-popup-anchor-left .maplibregl-popup-tip {\n    align-self: center;\n    border-left: none;\n    border-right-color: #fff;\n}\n\n.maplibregl-popup-anchor-right .maplibregl-popup-tip {\n    align-self: center;\n    border-right: none;\n    border-left-color: #fff;\n}\n\n.maplibregl-popup-close-button {\n    position: absolute;\n    right: 0;\n    top: 0;\n    border: 0;\n    border-radius: 0 3px 0 0;\n    cursor: pointer;\n    background-color: transparent;\n}\n\n.maplibregl-popup-close-button:hover {\n    background-color: rgb(0 0 0 / 5%);\n}\n\n.maplibregl-popup-content {\n    position: relative;\n    background: #fff;\n    border-radius: 3px;\n    box-shadow: 0 1px 2px rgb(0 0 0 / 10%);\n    padding: 15px 10px;\n    pointer-events: auto;\n}\n\n.maplibregl-popup-anchor-top-left .maplibregl-popup-content {\n    border-top-left-radius: 0;\n}\n\n.maplibregl-popup-anchor-top-right .maplibregl-popup-content {\n    border-top-right-radius: 0;\n}\n\n.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content {\n    border-bottom-left-radius: 0;\n}\n\n.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content {\n    border-bottom-right-radius: 0;\n}\n\n.maplibregl-popup-track-pointer {\n    display: none;\n}\n\n.maplibregl-popup-track-pointer * {\n    pointer-events: none;\n    user-select: none;\n}\n\n.maplibregl-map:hover .maplibregl-popup-track-pointer {\n    display: flex;\n}\n\n.maplibregl-map:active .maplibregl-popup-track-pointer {\n    display: none;\n}\n\n.maplibregl-marker {\n    position: absolute;\n    top: 0;\n    left: 0;\n    will-change: transform;\n    transition: opacity 0.2s;\n}\n\n.maplibregl-user-location-dot {\n    background-color: #1da1f2;\n    width: 15px;\n    height: 15px;\n    border-radius: 50%;\n}\n\n.maplibregl-user-location-dot::before {\n    background-color: #1da1f2;\n    content: \"\";\n    width: 15px;\n    height: 15px;\n    border-radius: 50%;\n    position: absolute;\n    animation: maplibregl-user-location-dot-pulse 2s infinite;\n}\n\n.maplibregl-user-location-dot::after {\n    border-radius: 50%;\n    border: 2px solid #fff;\n    content: \"\";\n    height: 19px;\n    left: -2px;\n    position: absolute;\n    top: -2px;\n    width: 19px;\n    box-sizing: border-box;\n    box-shadow: 0 0 3px rgb(0 0 0 / 35%);\n}\n\n@keyframes maplibregl-user-location-dot-pulse {\n    0%   { transform: scale(1); opacity: 1; }\n    70%  { transform: scale(3); opacity: 0; }\n    100% { transform: scale(1); opacity: 0; }\n}\n\n.maplibregl-user-location-dot-stale {\n    background-color: #aaa;\n}\n\n.maplibregl-user-location-dot-stale::after {\n    display: none;\n}\n\n.maplibregl-user-location-accuracy-circle {\n    background-color: #1da1f233;\n    width: 1px;\n    height: 1px;\n    border-radius: 100%;\n}\n\n.maplibregl-crosshair,\n.maplibregl-crosshair .maplibregl-interactive,\n.maplibregl-crosshair .maplibregl-interactive:active {\n    cursor: crosshair;\n}\n\n.maplibregl-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n}\n\n.maplibregl-cooperative-gesture-screen {\n    background: rgba(0 0 0 / 40%);\n    position: absolute;\n    inset: 0;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: white;\n    padding: 1rem;\n    font-size: 1.4em;\n    line-height: 1.2;\n    opacity: 0;\n    pointer-events: none;\n    transition: opacity 1s ease 1s;\n    z-index: 99999;\n}\n\n.maplibregl-cooperative-gesture-screen.maplibregl-show {\n    opacity: 1;\n    transition: opacity 0.05s;\n}\n\n.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message {\n    display: none;\n}\n\n@media (hover: none), (pointer: coarse) {\n    .maplibregl-cooperative-gesture-screen .maplibregl-desktop-message {\n        display: none;\n    }\n\n    .maplibregl-cooperative-gesture-screen .maplibregl-mobile-message {\n        display: block;\n    }\n}\n\n.maplibregl-pseudo-fullscreen {\n    position: fixed !important;\n    width: 100% !important;\n    height: 100% !important;\n    top: 0 !important;\n    left: 0 !important;\n    z-index: 99999;\n}\n", "import type { Language } from '@mappedin/mvf-v2';\nimport { isBrowser, Logger } from '@packages/internal/common';\nimport type { EnterpriseVenue } from '../map-data-objects';\n\nexport type TFindPreferredLanguageInVenueOptions = {\n\t/**\n\t * Preferred language code to use.\n\t */\n\tlanguageCode?: string;\n\t/**\n\t * Whether to use browser's language settings as fallback if the supplied language code is not available.\n\t * @default true\n\t * */\n\tfallbackToNavigatorLanguage?: boolean;\n};\n\n/**\n * Finds the first language that exists in both the venue and navigator.\n * @param venue - The MappedinVenue object containing available languages\n * @returns The preferred language, or undefined if no language is found\n */\nexport function findNavigatorPreferredLanguageInVenue(venue: EnterpriseVenue): Language | undefined {\n\tif (!venue.languages || !isBrowser() || !globalThis.navigator?.languages?.length) return;\n\tfor (let i = 0; i < globalThis.navigator.languages.length; i++) {\n\t\t// find the first language that exists in the venue and navigator\n\t\tconst language = venue.languages.find(\n\t\t\tl => l.code.toLowerCase() === globalThis.navigator.languages[i].toLowerCase(),\n\t\t);\n\t\tif (language) {\n\t\t\treturn {\n\t\t\t\tcode: language.code,\n\t\t\t\tname: language.name,\n\t\t\t};\n\t\t}\n\t}\n\n\treturn;\n}\n\n/**\n * Finds the ideal language for the venue based on the following priority:\n * 1. User specified language (if it exists in venue languages)\n * 2. Browser navigator languages (if fallback is enabled)\n * 3. Venue's default language\n *\n * @param venue - The MappedinVenue object containing available languages\n * @param options - Configuration options\n * @returns An object containing the selected language code and name, or undefined if no language is found\n */\nexport function findPreferredLanguageInVenue(\n\tvenue: EnterpriseVenue,\n\toptions?: TFindPreferredLanguageInVenueOptions,\n): Language {\n\tconst languageCode = options?.languageCode ?? '';\n\tconst fallbackToNavigatorLanguage = options?.fallbackToNavigatorLanguage ?? true;\n\n\tconst preferredLanguageInVenue = venue?.languages?.find(l => l.code.toLowerCase() === languageCode.toLowerCase());\n\tlet result: Language | undefined;\n\n\tif (!preferredLanguageInVenue) {\n\t\tif (fallbackToNavigatorLanguage ?? true) {\n\t\t\ttry {\n\t\t\t\tconst navigatorLanguage = findNavigatorPreferredLanguageInVenue(venue);\n\t\t\t\tif (navigatorLanguage) {\n\t\t\t\t\tresult = navigatorLanguage;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tLogger.error(\n\t\t\t\t\t'fallbackToNavigatorLanguage is set, however, there was an error getting the navigator language',\n\t\t\t\t\te,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tresult = preferredLanguageInVenue;\n\t}\n\n\treturn result ?? venue.defaultLanguage;\n}\n"],
  "mappings": "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;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAfC,IAAA,IAAOC,GAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA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hBzB,GAAqBmB,EAAOM,CAAK,IAGvDN,EAAMM,CAAK,EAAI,MAInB,OAAON,CACT,CAQA,SAASO,GAAqCC,EAAS,CACrD,IAAMC,EAAY/D,GAAO,IAAI,EAE7B,OAAW,CAACgE,EAAUC,CAAK,IAAKzE,GAAQsE,CAAM,EACpB3B,GAAqB2B,EAAQE,CAAQ,IAGvDrD,MAAMuD,QAAQD,CAAK,EACrBF,EAAUC,CAAQ,EAAIL,GAAWM,CAAK,EAEtCA,GACA,OAAOA,GAAU,UACjBA,EAAME,cAAgBtE,OAEtBkE,EAAUC,CAAQ,EAAIH,GAAMI,CAAK,EAEjCF,EAAUC,CAAQ,EAAIC,GAK5B,OAAOF,CACT,CASA,SAASK,GACPN,EACAO,EAAY,CAEZ,KAAOP,IAAW,MAAM,CACtB,IAAMQ,EAAO1E,GAAyBkE,EAAQO,CAAI,EAElD,GAAIC,EAAM,CACR,GAAIA,EAAKC,IACP,OAAO7D,GAAQ4D,EAAKC,GAAG,EAGzB,GAAI,OAAOD,EAAKL,OAAU,WACxB,OAAOvD,GAAQ4D,EAAKL,KAAK,CAE7B,CAEAH,EAASnE,GAAemE,CAAM,CAChC,CAEA,SAASU,GAAa,CACpB,OAAO,IACT,CAEA,OAAOA,CACT,CC3MO,IAAMC,GAAO3E,GAAO,CACzB,IACA,OACA,UACA,UACA,OACA,UACA,QACA,QACA,IACA,MACA,MACA,MACA,QACA,aACA,OACA,KACA,SACA,SACA,UACA,SACA,OACA,OACA,MACA,WACA,UACA,OACA,WACA,KACA,YACA,MACA,UACA,MACA,SACA,MACA,MACA,KACA,KACA,UACA,KACA,WACA,aACA,SACA,OACA,SACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,SACA,SACA,KACA,OACA,IACA,MACA,QACA,MACA,MACA,QACA,SACA,KACA,OACA,MACA,OACA,UACA,OACA,WACA,QACA,MACA,OACA,KACA,WACA,SACA,SACA,IACA,UACA,MACA,WACA,IACA,KACA,KACA,OACA,IACA,OACA,UACA,SACA,SACA,QACA,SACA,SACA,OACA,SACA,SACA,QACA,MACA,UACA,MACA,QACA,QACA,KACA,WACA,WACA,QACA,KACA,QACA,OACA,KACA,QACA,KACA,IACA,KACA,MACA,QACA,KAAK,CACG,EAEG4E,GAAM5E,GAAO,CACxB,MACA,IACA,WACA,cACA,eACA,eACA,gBACA,mBACA,SACA,WACA,OACA,OACA,UACA,SACA,OACA,IACA,QACA,WACA,QACA,QACA,OACA,iBACA,SACA,OACA,WACA,QACA,OACA,UACA,UACA,WACA,iBACA,OACA,OACA,QACA,SACA,SACA,OACA,WACA,QACA,OACA,QACA,OACA,OAAO,CACC,EAEG6E,GAAa7E,GAAO,CAC/B,UACA,gBACA,sBACA,cACA,mBACA,oBACA,oBACA,iBACA,eACA,UACA,UACA,UACA,UACA,UACA,iBACA,UACA,UACA,cACA,eACA,WACA,eACA,qBACA,cACA,SACA,cAAc,CACN,EAMG8E,GAAgB9E,GAAO,CAClC,UACA,gBACA,SACA,UACA,YACA,mBACA,iBACA,gBACA,gBACA,gBACA,QACA,YACA,OACA,eACA,YACA,UACA,gBACA,SACA,MACA,aACA,UACA,KAAK,CACG,EAEG+E,GAAS/E,GAAO,CAC3B,OACA,WACA,SACA,UACA,QACA,SACA,KACA,aACA,gBACA,KACA,KACA,QACA,UACA,WACA,QACA,OACA,KACA,SACA,QACA,SACA,OACA,OACA,UACA,SACA,MACA,QACA,MACA,SACA,aACA,aAAa,CACL,EAIGgF,GAAmBhF,GAAO,CACrC,UACA,cACA,aACA,WACA,YACA,UACA,UACA,SACA,SACA,QACA,YACA,aACA,iBACA,cACA,MAAM,CACE,EAEGiF,GAAOjF,GAAO,CAAC,OAAO,CAAU,ECpRhC2E,GAAO3E,GAAO,CACzB,SACA,SACA,QACA,MACA,iBACA,eACA,uBACA,WACA,aACA,UACA,SACA,UACA,cACA,cACA,UACA,OACA,QACA,QACA,QACA,OACA,UACA,WACA,eACA,SACA,cACA,WACA,WACA,UACA,MACA,WACA,0BACA,wBACA,WACA,YACA,UACA,eACA,OACA,MACA,UACA,SACA,SACA,OACA,OACA,WACA,KACA,YACA,YACA,QACA,OACA,QACA,OACA,OACA,UACA,OACA,MACA,MACA,YACA,QACA,SACA,MACA,YACA,WACA,QACA,OACA,QACA,UACA,aACA,SACA,OACA,UACA,UACA,cACA,cACA,UACA,gBACA,sBACA,SACA,UACA,UACA,aACA,WACA,MACA,WACA,MACA,WACA,OACA,OACA,UACA,aACA,QACA,WACA,QACA,OACA,QACA,OACA,UACA,QACA,MACA,SACA,OACA,QACA,UACA,WACA,QACA,YACA,OACA,SACA,SACA,QACA,QACA,OACA,QACA,MAAM,CACE,EAEG4E,GAAM5E,GAAO,CACxB,gBACA,aACA,WACA,qBACA,YACA,SACA,gBACA,gBACA,UACA,gBACA,iBACA,QACA,OACA,KACA,QACA,OACA,gBACA,YACA,YACA,QACA,sBACA,8BACA,gBACA,kBACA,KACA,KACA,IACA,KACA,KACA,kBACA,YACA,UACA,UACA,MACA,WACA,YACA,MACA,WACA,OACA,eACA,YACA,SACA,cACA,cACA,gBACA,cACA,YACA,mBACA,eACA,aACA,eACA,cACA,KACA,KACA,KACA,KACA,aACA,WACA,gBACA,oBACA,SACA,OACA,KACA,kBACA,KACA,MACA,YACA,IACA,KACA,KACA,KACA,KACA,UACA,YACA,aACA,WACA,OACA,eACA,iBACA,eACA,mBACA,iBACA,QACA,aACA,aACA,eACA,eACA,cACA,cACA,mBACA,YACA,MACA,OACA,QACA,SACA,OACA,MACA,OACA,aACA,SACA,WACA,UACA,QACA,SACA,cACA,SACA,WACA,cACA,OACA,aACA,sBACA,mBACA,eACA,SACA,gBACA,sBACA,iBACA,IACA,KACA,KACA,SACA,OACA,OACA,cACA,YACA,UACA,SACA,SACA,QACA,OACA,kBACA,QACA,mBACA,mBACA,eACA,cACA,eACA,cACA,aACA,eACA,mBACA,oBACA,iBACA,kBACA,oBACA,iBACA,SACA,eACA,QACA,eACA,iBACA,WACA,cACA,UACA,UACA,YACA,mBACA,cACA,kBACA,iBACA,aACA,OACA,KACA,KACA,UACA,SACA,UACA,aACA,UACA,aACA,gBACA,gBACA,QACA,eACA,OACA,eACA,mBACA,mBACA,IACA,KACA,KACA,QACA,IACA,KACA,KACA,IACA,YAAY,CACJ,EAEG+E,GAAS/E,GAAO,CAC3B,SACA,cACA,QACA,WACA,QACA,eACA,cACA,aACA,aACA,QACA,MACA,UACA,eACA,WACA,QACA,QACA,SACA,OACA,KACA,UACA,SACA,gBACA,SACA,SACA,iBACA,YACA,WACA,cACA,UACA,UACA,gBACA,WACA,WACA,OACA,WACA,WACA,aACA,UACA,SACA,SACA,cACA,gBACA,uBACA,YACA,YACA,aACA,WACA,iBACA,iBACA,YACA,UACA,QACA,OAAO,CACR,EAEYkF,GAAMlF,GAAO,CACxB,aACA,SACA,cACA,YACA,aAAa,CACL,EC/WGmF,GAAgBlF,GAAK,2BAA2B,EAChDmF,GAAWnF,GAAK,uBAAuB,EACvCoF,GAAcpF,GAAK,eAAe,EAClCqF,GAAYrF,GAAK,8BAA8B,EAC/CsF,GAAYtF,GAAK,gBAAgB,EACjCuF,GAAiBvF,GAC5B,oGAEWwF,GAAoBxF,GAAK,uBAAuB,EAChDyF,GAAkBzF,GAC7B,+DAEW0F,GAAe1F,GAAK,SAAS,EAC7B2F,GAAiB3F,GAAK,0BAA0B,uMCmBvD4F,GAAY,CAChBlC,QAAS,EACTmC,UAAW,EACXb,KAAM,EACNc,aAAc,EACdC,gBAAiB,EACjBC,WAAY,EACZC,uBAAwB,EACxBC,QAAS,EACTC,SAAU,EACVC,aAAc,GACdC,iBAAkB,GAClBC,SAAU,IAGNC,GAAY,UAAA,CAChB,OAAO,OAAOC,OAAW,IAAc,KAAOA,MAChD,EAUMC,GAA4B,SAChCC,EACAC,EAAoC,CAEpC,GACE,OAAOD,GAAiB,UACxB,OAAOA,EAAaE,cAAiB,WAErC,OAAO,KAMT,IAAIC,EAAS,KACPC,EAAY,wBACdH,GAAqBA,EAAkBI,aAAaD,CAAS,IAC/DD,EAASF,EAAkBK,aAAaF,CAAS,GAGnD,IAAM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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAA,IAAAC,GAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAA,IAAAC,GAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAA,IAAAC,GAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAA,IAAAC,GAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAA,IAAAC,GAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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",
  "names": ["require_tinyqueue", "__commonJSMin", "exports", "module", "init_define_process", "global", "factory", "TinyQueue", "data", "compare", "defaultCompare", "item", "top", "bottom", "pos", "ref", "parent", "current", "halfLength", "left", "best", "right", "a", "b", "require_polylabel", "__commonJSMin", "exports", "module", "init_define_process", "Queue", "polylabel", "polygon", "precision", "debug", "minX", "minY", "maxX", "maxY", "i", "p", "width", "height", "cellSize", "degeneratePoleOfInaccessibility", "cellQueue", "compareMax", "x", "y", "Cell", "bestCell", "getCentroidCell", "bboxCell", "numProbes", "cell", "poleOfInaccessibility", "a", "b", "h", "pointToPolygonDist", "inside", "minDistSq", "k", "ring", "len", "j", "getSegDistSq", "area", "points", "f", "px", "py", "dx", "dy", "t", "require_rbush_min", "__commonJSMin", "exports", "module", "init_define_process", "t", "i", "r", "e", "a", "h", "n", "o", "s", "l", "f", "u", "m", "c", "p", "d", "x", "v", "M", "require_js", "__commonJSMin", "exports", "init_define_process", "feature", "geom", "properties", "options", "feat", "geometry", "type", "coordinates", "_options", "point", "lineString", "polygon", "multiPoint", "multiLineString", "multiPolygon", "isNumber", "points", "featureCollection", "coords", "_i", "coordinates_1", "ring", "j", "polygons", "lineStrings", "features", "fc", "geometryCollection", "geometries", "round", "num", "precision", "multiplier", "radiansToLength", "radians", "units", "factor", "lengthToRadians", "distance", "lengthToDegrees", "radiansToDegrees", "bearingToAzimuth", "bearing", "angle", "degrees", "degreesToRadians", "convertLength", "length", "originalUnit", "finalUnit", "convertArea", "area", "startFactor", "finalFactor", "isObject", "input", "validateBBox", "bbox", "validateId", "id", "require_js", "__commonJSMin", "exports", "init_define_process", "helpers", "coordEach", "geojson", "callback", "excludeWrapCoord", "j", "k", "l", "geometry", "stopG", "coords", "geometryMaybeCollection", "wrapShrink", "coordIndex", "isGeometryCollection", "type", "isFeatureCollection", "isFeature", "stop", "featureIndex", "geomIndex", "multiFeatureIndex", "geometryIndex", "geomType", "coordReduce", "initialValue", "previousValue", "currentCoord", "propEach", "i", "propReduce", "currentProperties", "featureEach", "featureReduce", "currentFeature", "coordAll", "coord", "geomEach", "g", "featureProperties", "featureBBox", "featureId", "geomReduce", "currentGeometry", "flattenEach", "properties", "bbox", "id", "coordinate", "geom", "flattenReduce", "segmentEach", "feature", "segmentIndex", "previousCoords", "previousFeatureIndex", "previousMultiIndex", "prevGeomIndex", "featureIndexCoord", "multiPartIndexCoord", "currentSegment", "segmentReduce", "started", "lineEach", "lineReduce", "currentLine", "findSegment", "options", "findPoint", "require_js", "__commonJSMin", "exports", "init_define_process", "meta_1", "bbox", "geojson", "result", "coord", "require_geojson_rbush", "__commonJSMin", "exports", "module", "init_define_process", "rbush", "helpers", "meta", "turfBBox", "featureEach", "coordEach", "polygon", "featureCollection", "geojsonRbush", "maxEntries", "tree", "feature", "features", "load", "equals", "geojson", "json", "bbox", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "notNull", "value", "control", "fetch", "args", "notNull", "f", "VALID_CONTEXTS", "DEFAULT_CONTEXT", "ANALYTICS_URL", "DENY_WATCH_POSITION", "LOAD_MAPVIEW", "LOAD_MAPDATA", "CHANGE_LANGUAGE", "QUERY_DIRECTION", "_options", "_state", "_AnalyticsInternal_instances", "saveStateToStorage_fn", "getStateWithOption_fn", "AnalyticsInternal", "__privateAdd", "__publicField", "debounce", "start", "end", "accessible", "payload", "QUERY_DIRECTION", "__privateSet", "__privateMethod", "__privateGet", "options", "update", "updatedState", "getBaseUrl", "getValidContext", "key", "secret", "accessToken", "DEFAULT_CONTEXT", "getSessionIDFromStorage", "getDeviceIDFromStorage", "target", "data", "state", "url", "buildUrl", "headers", "Mappedin_Logger_default", "jsonData", "fetch", "query", "USER_CANNOT_SEND", "eventName", "RESERVED_EVENTS", "LOAD_MAPDATA", "CHANGE_LANGUAGE", "DENY_WATCH_POSITION", "firstRenderDuration", "dimension", "collisionWorkerDisabled", "outdoorsWorkerDisabled", "LOAD_MAPVIEW", "event", "SafeStorage", "baseUri", "ANALYTICS_URL", "define_process_default", "mapId", "baseUrl", "context", "VALID_CONTEXTS", "c", "analyticsInternal", "_internal", "Analytics", "internalAnalytics", "sessionId", "deviceId", "publicState", "init_define_process", "init_define_process", "_mapData", "_mapDataInternal", "_languageChangeHandler", "Search", "mapData", "mapDataInternal", "enabled", "__privateAdd", "__publicField", "__privateSet", "search", "term", "options", "Mappedin_Logger_default", "e", "SearchClass", "__privateGet", "MapDataInternalByMapData", "_pubSub", "_internal", "MapData", "internal", "search", "__privateAdd", "__publicField", "eventName", "fn", "__privateGet", "from", "to", "options", "__privateSet", "PubSub", "Analytics", "Search", "language", "type", "id", "externalId", "mapDataObject", "localeCode", "downloadLanguagePacks", "map_data_default", "getMapDataInternal", "mapData", "found", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "WELL_KNOWN_FLAGS", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "value_exports", "__export", "HasPropertyKey", "IsArray", "IsAsyncIterator", "IsBigInt", "IsBoolean", "IsDate", "IsFunction", "IsIterator", "IsNull", "IsNumber", "IsObject", "IsRegExp", "IsString", "IsSymbol", "IsUint8Array", "IsUndefined", "init_define_process", "value", "key", "ArrayType", "value", "Visit", "DateType", "Uint8ArrayType", "RegExpType", "ObjectType", "result", "key", "IsArray", "IsDate", "IsUint8Array", "IsRegExp", "IsObject", "Clone", "CloneRest", "schemas", "schema", "CloneType", "options", "Clone", "init_define_process", "init_define_process", "init_define_process", "IsAsyncIterator", "value", "IsObject", "IsIterator", "IsStandardObject", "IsPromise", "value", "IsDate", "IsMap", "IsSet", "IsTypedArray", "value", "IsUint8Array", "value", "HasPropertyKey", "value", "key", "IsObject", "IsArray", "IsUndefined", "IsNull", "IsBoolean", "IsNumber", "IsInteger", "IsBigInt", "IsString", "IsFunction", "IsSymbol", "IsValueType", "TypeSystemPolicy", "IsExactOptionalProperty", "value", "key", "IsObjectLike", "isObject", "IsObject", "IsArray", "IsRecordLike", "IsNumberLike", "IsNumber", "IsVoidLike", "isUndefined", "IsUndefined", "init_define_process", "ImmutableArray", "value", "Immutable", "ImmutableObject", "value", "result", "key", "Immutable", "IsArray", "ImmutableArray", "IsDate", "IsUint8Array", "IsRegExp", "IsObject", "CreateType", "schema", "options", "result", "TypeSystemPolicy", "Immutable", "Clone", "init_define_process", "TypeBoxError", "message", "init_define_process", "init_define_process", "init_define_process", "TransformKind", "ReadonlyKind", "OptionalKind", "Hint", "Kind", "IsReadonly", "value", "IsObject", "ReadonlyKind", "IsOptional", "OptionalKind", "IsAny", "IsKindOf", "IsArray", "IsAsyncIterator", "IsBigInt", "IsBoolean", "IsConstructor", "IsDate", "IsFunction", "IsInteger", "IsIntersect", "value", "IsKindOf", "IsIterator", "kind", "IsObject", "Kind", "IsLiteral", "value", "IsKindOf", "IsMappedKey", "IsMappedResult", "IsNever", "IsNot", "IsNull", "IsNumber", "IsObject", "IsPromise", "IsRecord", "IsRef", "value", "IsKindOf", "IsRegExp", "IsString", "IsSymbol", "IsTemplateLiteral", "IsThis", "IsTransform", "IsObject", "TransformKind", "IsTuple", "IsUndefined", "IsUnion", "IsUint8Array", "IsUnknown", "IsUnsafe", "IsVoid", "IsKind", "Kind", "IsSchema", "IsAny", "IsArray", "IsBoolean", "IsBigInt", "IsAsyncIterator", "IsConstructor", "IsDate", "IsFunction", "IsInteger", "IsIntersect", "IsIterator", "IsLiteral", "IsMappedKey", "IsMappedResult", "IsNever", "IsNot", "IsNull", "IsNumber", "IsPromise", "IsRecord", "type_exports", "__export", "IsAny", "IsArray", "IsAsyncIterator", "IsBigInt", "IsBoolean", "IsConstructor", "IsDate", "IsFunction", "IsInteger", "IsIntersect", "IsIterator", "IsKind", "IsKindOf", "IsLiteral", "IsLiteralBoolean", "IsLiteralNumber", "IsLiteralString", "IsLiteralValue", "IsMappedKey", "IsMappedResult", "IsNever", "IsNot", "IsNull", "IsNumber", "IsObject", "IsOptional", "IsPromise", "IsProperties", "IsReadonly", "IsRecord", "IsRecursive", "IsRef", "IsRegExp", "IsSchema", "IsString", "IsSymbol", "IsTemplateLiteral", "IsThis", "IsTransform", "IsTuple", "IsUint8Array", "IsUndefined", "IsUnion", "IsUnionLiteral", "IsUnknown", "IsUnsafe", "IsVoid", "TypeGuardUnknownTypeError", "init_define_process", "TypeGuardUnknownTypeError", "TypeBoxError", "KnownTypes", "IsPattern", "value", "IsControlCharacterFree", "IsString", "i", "code", "IsAdditionalProperties", "IsOptionalBoolean", "IsSchema", "IsOptionalBigInt", "IsUndefined", "IsBigInt", "IsOptionalNumber", "IsNumber", "IsBoolean", "IsOptionalString", "IsOptionalPattern", "IsOptionalFormat", "IsOptionalSchema", "IsReadonly", "IsObject", "ReadonlyKind", "IsOptional", "OptionalKind", "IsAny", "IsKindOf", "IsArray", "IsAsyncIterator", "IsConstructor", "schema", "IsDate", "IsFunction", "IsInteger", "IsProperties", "key", "IsIntersect", "IsTransform", "IsIterator", "kind", "Kind", "IsLiteralString", "IsLiteral", "IsLiteralNumber", "IsLiteralBoolean", "IsLiteralValue", "IsMappedKey", "IsMappedResult", "IsNever", "IsNot", "IsNull", "IsPromise", "IsRecord", "keys", "IsRecursive", "Hint", "IsRef", "IsRegExp", "IsSymbol", "IsTemplateLiteral", "IsThis", "TransformKind", "IsTuple", "IsUnionLiteral", "IsUnion", "IsUint8Array", "IsUnknown", "IsUnsafe", "IsVoid", "IsKind", "init_define_process", "PatternBoolean", "PatternNumber", "PatternString", "PatternNever", "PatternBooleanExact", "PatternNumberExact", "PatternStringExact", "PatternNeverExact", "init_define_process", "format_exports", "__export", "Clear", "Delete", "Entries", "Get", "Has", "Set", "init_define_process", "map", "format", "func", "type_exports", "__export", "Clear", "Delete", "Entries", "Get", "Has", "Set", "init_define_process", "map", "kind", "func", "init_define_process", "SetIncludes", "T", "S", "SetDistinct", "T", "SetIntersect", "S", "L", "SetIntersectManyResolve", "T", "Init", "Acc", "L", "SetIntersect", "SetIntersectMany", "SetUnionMany", "init_define_process", "Any", "options", "CreateType", "Kind", "init_define_process", "Array", "items", "options", "CreateType", "Kind", "init_define_process", "AsyncIterator", "items", "options", "CreateType", "Kind", "init_define_process", "init_define_process", "init_define_process", "DiscardKey", "value", "key", "_", "rest", "Discard", "keys", "acc", "init_define_process", "Never", "options", "CreateType", "Kind", "init_define_process", "init_define_process", "MappedResult", "properties", "CreateType", "Kind", "init_define_process", "init_define_process", "Constructor", "parameters", "returns", "options", "CreateType", "Kind", "init_define_process", "Function", "parameters", "returns", "options", "CreateType", "Kind", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "UnionCreate", "T", "options", "CreateType", "Kind", "IsUnionOptional", "T", "L", "IsOptional", "RemoveOptionalFromRest", "RemoveOptionalFromType", "Discard", "OptionalKind", "ResolveUnion", "options", "Optional", "UnionCreate", "UnionEvaluated", "Never", "CreateType", "init_define_process", "Union", "T", "options", "Never", "CreateType", "UnionCreate", "init_define_process", "init_define_process", "init_define_process", "TemplateLiteralParserError", "TypeBoxError", "Unescape", "pattern", "IsNonEscaped", "index", "char", "IsOpenParen", "IsCloseParen", "IsSeparator", "IsGroup", "count", "InGroup", "IsPrecedenceOr", "IsPrecedenceAnd", "Or", "start", "expressions", "range", "TemplateLiteralParse", "And", "Group", "value", "scan", "Range", "end", "TemplateLiteralParseExact", "TemplateLiteralFiniteError", "TypeBoxError", "IsNumberExpression", "expression", "IsBooleanExpression", "IsStringExpression", "IsTemplateLiteralExpressionFinite", "expr", "IsTemplateLiteralFinite", "schema", "TemplateLiteralParseExact", "init_define_process", "TemplateLiteralGenerateError", "TypeBoxError", "GenerateReduce", "buffer", "left", "right", "GenerateAnd", "expression", "expr", "TemplateLiteralExpressionGenerate", "GenerateOr", "GenerateConst", "TemplateLiteralGenerate", "schema", "TemplateLiteralParseExact", "IsTemplateLiteralExpressionFinite", "init_define_process", "init_define_process", "Literal", "value", "options", "CreateType", "Kind", "init_define_process", "Boolean", "options", "CreateType", "Kind", "init_define_process", "BigInt", "options", "CreateType", "Kind", "init_define_process", "Number", "options", "CreateType", "Kind", "init_define_process", "String", "options", "CreateType", "Kind", "FromUnion", "syntax", "trim", "Boolean", "Number", "BigInt", "String", "literals", "literal", "Literal", "Never", "UnionEvaluated", "FromTerminal", "L", "R", "FromSyntax", "i", "TemplateLiteralSyntax", "init_define_process", "TemplateLiteralPatternError", "TypeBoxError", "Escape", "value", "Visit", "schema", "acc", "IsTemplateLiteral", "IsUnion", "IsNumber", "PatternNumber", "IsInteger", "IsBigInt", "IsString", "PatternString", "IsLiteral", "IsBoolean", "PatternBoolean", "Kind", "TemplateLiteralPattern", "kinds", "init_define_process", "TemplateLiteralToUnion", "schema", "L", "TemplateLiteralGenerate", "S", "Literal", "UnionEvaluated", "init_define_process", "TemplateLiteral", "unresolved", "options", "pattern", "IsString", "TemplateLiteralPattern", "TemplateLiteralSyntax", "CreateType", "Kind", "FromTemplateLiteral", "T", "TemplateLiteralGenerate", "S", "FromUnion", "Acc", "L", "IndexPropertyKeys", "FromLiteral", "IsTemplateLiteral", "IsUnion", "IsLiteral", "IsNumber", "IsInteger", "init_define_process", "FromProperties", "T", "P", "options", "Acc", "K2", "Index", "IndexPropertyKeys", "FromMappedResult", "R", "IndexFromMappedResult", "MappedResult", "FromRest", "T", "K", "L", "IndexFromPropertyKey", "FromIntersectRest", "IsNever", "FromIntersect", "IntersectEvaluated", "FromUnionRest", "FromUnion", "UnionEvaluated", "FromTuple", "Never", "FromArray", "FromProperty", "IsIntersect", "IsUnion", "IsTuple", "IsArray", "IsObject", "IndexFromPropertyKeys", "FromSchema", "Index", "options", "IsMappedResult", "IndexFromMappedResult", "IsMappedKey", "IndexFromMappedKey", "CreateType", "IsSchema", "IndexPropertyKeys", "MappedIndexPropertyKey", "T", "K", "options", "Index", "Clone", "MappedIndexPropertyKeys", "Acc", "L", "MappedIndexProperties", "IndexFromMappedKey", "P", "MappedResult", "init_define_process", "Iterator", "items", "options", "CreateType", "Kind", "init_define_process", "RequiredKeys", "properties", "keys", "key", "IsOptional", "_Object", "options", "required", "schematic", "Kind", "CreateType", "Object", "init_define_process", "Promise", "item", "options", "CreateType", "Kind", "init_define_process", "init_define_process", "RemoveReadonly", "schema", "CreateType", "Discard", "ReadonlyKind", "AddReadonly", "ReadonlyWithFlag", "F", "Readonly", "enable", "IsMappedResult", "ReadonlyFromMappedResult", "FromProperties", "K", "F", "Acc", "K2", "Readonly", "FromMappedResult", "R", "ReadonlyFromMappedResult", "P", "MappedResult", "init_define_process", "Tuple", "items", "options", "CreateType", "Kind", "FromMappedResult", "K", "P", "FromSchemaType", "MappedResult", "MappedKeyToKnownMappedResultProperties", "Literal", "MappedKeyToUnknownMappedResultProperties", "Acc", "L", "MappedKeyToMappedResultProperties", "SetIncludes", "FromMappedKey", "R", "FromRest", "T", "FromProperties", "K2", "options", "IsOptional", "Optional", "Discard", "OptionalKind", "IsReadonly", "Readonly", "ReadonlyKind", "IsMappedResult", "IsMappedKey", "IsConstructor", "Constructor", "IsFunction", "Function", "IsAsyncIterator", "AsyncIterator", "IsIterator", "Iterator", "IsIntersect", "Intersect", "IsUnion", "Union", "IsTuple", "Tuple", "IsObject", "Object", "IsArray", "Array", "IsPromise", "Promise", "MappedFunctionReturnType", "Mapped", "key", "map", "IsSchema", "IndexPropertyKeys", "RT", "Kind", "init_define_process", "RemoveOptional", "schema", "CreateType", "Discard", "OptionalKind", "AddOptional", "OptionalWithFlag", "F", "Optional", "enable", "IsMappedResult", "OptionalFromMappedResult", "FromProperties", "P", "F", "Acc", "K2", "Optional", "FromMappedResult", "R", "OptionalFromMappedResult", "MappedResult", "init_define_process", "IntersectCreate", "T", "options", "allObjects", "schema", "IsObject", "clonedUnevaluatedProperties", "IsSchema", "CreateType", "Kind", "IsIntersectOptional", "T", "L", "IsOptional", "RemoveOptionalFromType", "Discard", "OptionalKind", "RemoveOptionalFromRest", "ResolveIntersect", "options", "Optional", "IntersectCreate", "IntersectEvaluated", "Never", "CreateType", "schema", "IsTransform", "init_define_process", "Intersect", "T", "options", "Never", "CreateType", "schema", "IsTransform", "IntersectCreate", "FromRest", "T", "L", "AwaitedResolve", "FromIntersect", "Intersect", "FromUnion", "Union", "FromPromise", "IsIntersect", "IsUnion", "IsPromise", "Awaited", "options", "CreateType", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "FromRest", "T", "Acc", "L", "KeyOfPropertyKeys", "FromIntersect", "C", "SetUnionMany", "FromUnion", "SetIntersectMany", "FromTuple", "_", "I", "FromArray", "FromProperties", "FromPatternProperties", "patternProperties", "includePatternProperties", "key", "IsIntersect", "IsUnion", "IsTuple", "IsArray", "IsObject", "IsRecord", "KeyOfPattern", "schema", "keys", "KeyOfPropertyKeysToRest", "T", "L", "Number", "Literal", "KeyOf", "options", "IsMappedResult", "KeyOfFromMappedResult", "K", "KeyOfPropertyKeys", "S", "U", "UnionEvaluated", "CreateType", "FromProperties", "K", "options", "Acc", "K2", "KeyOf", "Clone", "FromMappedResult", "R", "KeyOfFromMappedResult", "P", "MappedResult", "init_define_process", "KeyOfPropertyEntries", "schema", "keys", "KeyOfPropertyKeys", "schemas", "IndexFromPropertyKeys", "_", "index", "CompositeKeys", "T", "Acc", "L", "KeyOfPropertyKeys", "SetDistinct", "FilterNever", "IsNever", "CompositeProperty", "K", "IndexFromPropertyKeys", "CompositeProperties", "IntersectEvaluated", "Composite", "options", "P", "Object", "init_define_process", "init_define_process", "Date", "options", "CreateType", "Kind", "init_define_process", "Null", "options", "CreateType", "Kind", "init_define_process", "Symbol", "options", "CreateType", "Kind", "init_define_process", "Undefined", "options", "CreateType", "Kind", "init_define_process", "Uint8Array", "options", "CreateType", "Kind", "init_define_process", "Unknown", "options", "CreateType", "Kind", "FromArray", "T", "L", "FromValue", "FromProperties", "value", "Acc", "K", "Readonly", "ConditionalReadonly", "root", "IsAsyncIterator", "Any", "IsIterator", "IsArray", "Tuple", "IsUint8Array", "Uint8Array", "IsDate", "Date", "IsObject", "Object", "IsFunction", "Function", "Unknown", "IsUndefined", "Undefined", "IsNull", "Null", "IsSymbol", "Symbol", "IsBigInt", "BigInt", "IsNumber", "Literal", "IsBoolean", "IsString", "Const", "options", "CreateType", "init_define_process", "ConstructorParameters", "schema", "options", "Tuple", "init_define_process", "FromRest", "schema", "references", "Deref", "FromProperties", "properties", "Acc", "K", "FromConstructor", "FromFunction", "FromIntersect", "FromUnion", "FromTuple", "IsUndefined", "FromArray", "FromObject", "FromPromise", "FromAsyncIterator", "FromIterator", "FromRef", "target", "remote", "discard", "Discard", "DerefResolve", "IsConstructor", "IsFunction", "IsIntersect", "IsUnion", "IsTuple", "IsArray", "IsObject", "IsPromise", "IsAsyncIterator", "IsIterator", "IsRef", "CloneType", "CloneRest", "init_define_process", "Enum", "item", "options", "IsUndefined", "values1", "key", "anyOf", "value", "Literal", "Union", "Hint", "init_define_process", "init_define_process", "init_define_process", "ExtendsResolverError", "TypeBoxError", "ExtendsResult", "IntoBooleanResult", "result", "Throw", "message", "IsStructuralRight", "right", "type_exports", "StructuralRight", "left", "FromNeverRight", "FromIntersectRight", "FromUnionRight", "FromUnknownRight", "FromAnyRight", "FromAny", "schema", "FromArrayRight", "FromArray", "IsObjectArrayLike", "Visit", "FromAsyncIterator", "FromBigInt", "FromObjectRight", "FromRecordRight", "FromBooleanRight", "FromBoolean", "FromConstructor", "index", "FromDate", "FromFunction", "FromIntegerRight", "value_exports", "FromInteger", "FromIntersect", "FromIterator", "FromLiteral", "FromStringRight", "FromNumberRight", "FromNever", "UnwrapTNot", "current", "depth", "Unknown", "FromNot", "FromNull", "FromNumber", "IsObjectPropertyCount", "count", "IsObjectStringLike", "IsObjectSymbolLike", "IsObjectNumberLike", "IsObjectBooleanLike", "IsObjectBigIntLike", "IsObjectDateLike", "IsObjectUint8ArrayLike", "IsObjectFunctionLike", "length", "Number", "IsObjectConstructorLike", "IsObjectPromiseLike", "then", "Function", "Any", "Property", "RecordKey", "Hint", "FromObject", "key", "FromPromise", "PatternNumberExact", "PatternStringExact", "String", "RecordValue", "Key", "Value", "FromRecord", "FromRegExp", "L", "R", "FromString", "FromSymbol", "FromTemplateLiteral", "TemplateLiteralToUnion", "IsArrayOfTuple", "FromTupleRight", "FromTuple", "FromUint8Array", "FromUndefined", "FromVoidRight", "FromUnion", "FromUnknown", "FromVoid", "Kind", "ExtendsCheck", "init_define_process", "init_define_process", "init_define_process", "FromProperties", "P", "Right", "True", "False", "options", "Acc", "K2", "Extends", "Clone", "FromMappedResult", "Left", "ExtendsFromMappedResult", "MappedResult", "ExtendsResolve", "left", "right", "trueType", "falseType", "R", "ExtendsCheck", "ExtendsResult", "Union", "Extends", "L", "T", "F", "options", "IsMappedResult", "ExtendsFromMappedResult", "IsMappedKey", "CreateType", "ExtendsFromMappedKey", "FromPropertyKey", "K", "U", "L", "R", "options", "Extends", "Literal", "Clone", "FromPropertyKeys", "Acc", "LK", "FromMappedKey", "ExtendsFromMappedKey", "T", "P", "MappedResult", "init_define_process", "Intersect", "schema", "ExtendsUndefinedCheck", "Union", "Not", "Kind", "init_define_process", "ExcludeFromTemplateLiteral", "L", "R", "Exclude", "TemplateLiteralToUnion", "ExcludeRest", "L", "R", "excluded", "inner", "ExtendsCheck", "ExtendsResult", "Union", "Exclude", "options", "IsTemplateLiteral", "CreateType", "ExcludeFromTemplateLiteral", "IsMappedResult", "ExcludeFromMappedResult", "IsUnion", "Never", "FromProperties", "P", "U", "Acc", "K2", "Exclude", "FromMappedResult", "R", "T", "ExcludeFromMappedResult", "MappedResult", "init_define_process", "init_define_process", "init_define_process", "ExtractFromTemplateLiteral", "L", "R", "Extract", "TemplateLiteralToUnion", "ExtractRest", "L", "R", "extracted", "inner", "ExtendsCheck", "ExtendsResult", "Union", "Extract", "options", "IsTemplateLiteral", "CreateType", "ExtractFromTemplateLiteral", "IsMappedResult", "ExtractFromMappedResult", "IsUnion", "Never", "FromProperties", "P", "T", "Acc", "K2", "Extract", "FromMappedResult", "R", "ExtractFromMappedResult", "MappedResult", "init_define_process", "InstanceType", "schema", "options", "CreateType", "init_define_process", "Integer", "options", "CreateType", "Kind", "init_define_process", "init_define_process", "init_define_process", "MappedIntrinsicPropertyKey", "K", "M", "options", "Intrinsic", "Literal", "Clone", "MappedIntrinsicPropertyKeys", "Acc", "L", "MappedIntrinsicProperties", "T", "IntrinsicFromMappedKey", "P", "MappedResult", "ApplyUncapitalize", "value", "first", "rest", "ApplyCapitalize", "ApplyUppercase", "ApplyLowercase", "FromTemplateLiteral", "schema", "mode", "options", "expression", "TemplateLiteralParseExact", "IsTemplateLiteralExpressionFinite", "FromLiteralValue", "literals", "TemplateLiteralExpressionGenerate", "Literal", "mapped", "FromRest", "union", "Union", "TemplateLiteral", "T", "M", "L", "Intrinsic", "IsMappedKey", "IntrinsicFromMappedKey", "IsTemplateLiteral", "IsUnion", "IsLiteral", "CreateType", "Capitalize", "T", "options", "Intrinsic", "init_define_process", "Lowercase", "T", "options", "Intrinsic", "init_define_process", "Uncapitalize", "T", "options", "Intrinsic", "init_define_process", "Uppercase", "T", "options", "Intrinsic", "init_define_process", "Not", "not", "options", "CreateType", "Kind", "init_define_process", "init_define_process", "init_define_process", "FromProperties", "P", "K", "options", "Acc", "K2", "Omit", "Clone", "FromMappedResult", "R", "OmitFromMappedResult", "MappedResult", "FromIntersect", "T", "K", "OmitResolve", "FromUnion", "FromProperty", "_", "R", "FromProperties", "K2", "FromObject", "options", "Discard", "TransformKind", "properties", "Object", "IsIntersect", "Intersect", "IsUnion", "Union", "IsObject", "Omit", "IsMappedKey", "OmitFromMappedKey", "IsMappedResult", "OmitFromMappedResult", "I", "IsSchema", "IndexPropertyKeys", "CreateType", "FromPropertyKey", "T", "K", "options", "Omit", "Clone", "FromPropertyKeys", "Acc", "LK", "FromMappedKey", "OmitFromMappedKey", "P", "MappedResult", "init_define_process", "Parameters", "schema", "options", "Tuple", "init_define_process", "init_define_process", "FromRest", "T", "L", "PartialResolve", "FromProperties", "Acc", "K", "Optional", "FromObject", "options", "Discard", "TransformKind", "properties", "Object", "IsIntersect", "Intersect", "IsUnion", "Union", "IsObject", "Partial", "IsMappedResult", "PartialFromMappedResult", "CreateType", "FromProperties", "K", "options", "Acc", "K2", "Partial", "Clone", "FromMappedResult", "R", "PartialFromMappedResult", "P", "MappedResult", "init_define_process", "init_define_process", "init_define_process", "FromProperties", "P", "K", "options", "Acc", "K2", "Pick", "Clone", "FromMappedResult", "R", "PickFromMappedResult", "MappedResult", "FromIntersect", "T", "K", "PickResolve", "FromUnion", "FromProperties", "Acc", "K2", "FromObject", "options", "Discard", "TransformKind", "properties", "Object", "IsIntersect", "Intersect", "IsUnion", "Union", "IsObject", "Pick", "IsMappedKey", "PickFromMappedKey", "IsMappedResult", "PickFromMappedResult", "I", "IsSchema", "IndexPropertyKeys", "CreateType", "FromPropertyKey", "T", "K", "options", "Pick", "Clone", "FromPropertyKeys", "Acc", "LK", "FromMappedKey", "PickFromMappedKey", "P", "MappedResult", "init_define_process", "ReadonlyOptional", "schema", "Readonly", "Optional", "init_define_process", "RecordCreateFromPattern", "pattern", "T", "options", "CreateType", "Kind", "RecordCreateFromKeys", "K", "Acc", "K2", "Object", "Hint", "FromTemplateLiteralKey", "IsTemplateLiteralFinite", "IndexPropertyKeys", "FromUnionKey", "Union", "FromLiteralKey", "FromRegExpKey", "FromStringKey", "IsUndefined", "PatternStringExact", "FromAnyKey", "FromNeverKey", "PatternNeverExact", "FromIntegerKey", "_", "PatternNumberExact", "FromNumberKey", "Record", "IsUnion", "IsTemplateLiteral", "IsLiteral", "IsInteger", "IsNumber", "IsRegExp", "IsString", "IsAny", "IsNever", "Never", "init_define_process", "Ordinal", "Recursive", "callback", "options", "IsUndefined", "thisType", "CloneType", "Kind", "CreateType", "Hint", "init_define_process", "Ref", "unresolved", "options", "IsString", "CreateType", "Kind", "IsUndefined", "init_define_process", "RegExp", "unresolved", "options", "expr", "IsString", "CreateType", "Kind", "init_define_process", "init_define_process", "FromRest", "T", "L", "RequiredResolve", "FromProperties", "Acc", "K", "Discard", "OptionalKind", "FromObject", "options", "TransformKind", "properties", "Object", "IsIntersect", "Intersect", "IsUnion", "Union", "IsObject", "Required", "IsMappedResult", "RequiredFromMappedResult", "CreateType", "FromProperties", "P", "options", "Acc", "K2", "Required", "FromMappedResult", "R", "RequiredFromMappedResult", "MappedResult", "init_define_process", "RestResolve", "T", "IsIntersect", "IsUnion", "IsTuple", "Rest", "init_define_process", "ReturnType", "schema", "options", "CreateType", "init_define_process", "Strict", "schema", "init_define_process", "TransformDecodeBuilder", "schema", "decode", "TransformEncodeBuilder", "encode", "Codec", "value", "TransformKind", "IsTransform", "Transform", "init_define_process", "Unsafe", "options", "CreateType", "Kind", "init_define_process", "Void", "options", "CreateType", "Kind", "init_define_process", "type_exports", "__export", "Any", "Array", "AsyncIterator", "Awaited", "BigInt", "Boolean", "Capitalize", "Composite", "Const", "Constructor", "ConstructorParameters", "Date", "Deref", "Enum", "Exclude", "Extends", "Extract", "Function", "Index", "InstanceType", "Integer", "Intersect", "Iterator", "KeyOf", "Literal", "Lowercase", "Mapped", "Never", "Not", "Null", "Number", "Object", "Omit", "Optional", "Parameters", "Partial", "Pick", "Promise", "Readonly", "ReadonlyOptional", "Record", "Recursive", "Ref", "RegExp", "Required", "Rest", "ReturnType", "Strict", "String", "Symbol", "TemplateLiteral", "Transform", "Tuple", "Uint8Array", "Uncapitalize", "Undefined", "Union", "Unknown", "Unsafe", "Uppercase", "Void", "init_define_process", "Type", "type_exports", "init_define_process", "BaseDetails", "Type", "Details", "WithDetails", "WithRequiredDetails", "requiredFields", "ordered", "required", "optional", "DetailsReferences", "init_define_process", "Longitude", "Type", "Latitude", "Position", "Point", "MultiPoint", "LineString", "MultiLineString", "LinearRing", "LinearRings", "Polygon", "MultiPolygon", "Feature", "geometry", "properties", "options", "FeatureCollection", "feature", "arrayOptions", "GeoJSON", "init_define_process", "Ident", "prefix", "id", "Type", "GeometryId", "FloorId", "Identifiers", "init_define_process", "init_define_process", "init_define_process", "OptionIterator", "value", "__publicField", "Some", "fn", "other", "message", "fallback", "option", "none", "error", "ok", "some", "None", "err", "ResultIterator", "value", "__publicField", "Ok", "fn", "some", "none", "message", "fallback", "ok", "result", "Err", "_Err", "error", "other", "err", "init_define_process", "IntegrityErrorKind", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "TypeSystemDuplicateTypeKind", "TypeBoxError", "kind", "TypeSystemDuplicateFormat", "TypeSystem", "Type", "check", "type_exports", "options", "Unsafe", "Kind", "Format", "format", "format_exports", "init_define_process", "DefaultErrorFunction", "error", "ValueErrorType", "Kind", "errorFunction", "GetErrorFunction", "errorFunction", "init_define_process", "TypeDereferenceError", "TypeBoxError", "schema", "Resolve", "references", "target", "Deref", "Pushref", "IsString", "Kind", "init_define_process", "ValueHashError", "TypeBoxError", "value", "ByteMarker", "Accumulator", "Prime", "Size", "Bytes", "_", "i", "F64", "F64In", "F64Out", "NumberToBytes", "byteCount", "ArrayType", "FNV1A64", "item", "Visit", "BooleanType", "BigIntType", "byte", "DateType", "NullType", "NumberType", "ObjectType", "key", "StringType", "SymbolType", "Uint8ArrayType", "UndefinedType", "IsArray", "IsBoolean", "IsBigInt", "IsDate", "IsNull", "IsNumber", "IsObject", "IsString", "IsSymbol", "IsUint8Array", "IsUndefined", "Hash", "init_define_process", "ValueCheckUnknownTypeError", "TypeBoxError", "schema", "IsAnyOrUnknown", "Kind", "IsDefined", "value", "FromAny", "references", "FromArray", "IsArray", "Visit", "set", "element", "hashed", "Hash", "IsNumber", "containsSchema", "Never", "containsCount", "acc", "FromAsyncIterator", "IsAsyncIterator", "FromBigInt", "IsBigInt", "FromBoolean", "IsBoolean", "FromConstructor", "FromDate", "IsDate", "FromFunction", "IsFunction", "FromInteger", "IsInteger", "FromIntersect", "check1", "keyPattern", "KeyOfPattern", "check2", "key", "IsSchema", "keyCheck", "FromIterator", "IsIterator", "FromLiteral", "FromNever", "FromNot", "FromNull", "IsNull", "FromNumber", "TypeSystemPolicy", "FromObject", "knownKeys", "knownKey", "property", "ExtendsUndefinedCheck", "valueKeys", "valueKey", "FromPromise", "IsPromise", "FromRecord", "patternKey", "patternSchema", "regex", "check3", "FromRef", "Deref", "FromRegExp", "FromString", "IsString", "format_exports", "FromSymbol", "IsSymbol", "FromTemplateLiteral", "FromThis", "FromTuple", "i", "FromUndefined", "IsUndefined", "FromUnion", "inner", "FromUint8Array", "IsUint8Array", "FromUnknown", "FromVoid", "FromKind", "type_exports", "references_", "schema_", "Check", "args", "ValueErrorType", "ValueErrorsUnknownTypeError", "TypeBoxError", "schema", "EscapeKey", "key", "IsDefined", "value", "ValueErrorIterator", "iterator", "next", "Create", "errorType", "path", "errors", "GetErrorFunction", "FromAny", "references", "FromArray", "IsArray", "i", "Visit", "set", "element", "hashed", "Hash", "containsSchema", "Never", "containsCount", "acc", "index", "IsNumber", "FromAsyncIterator", "IsAsyncIterator", "FromBigInt", "IsBigInt", "FromBoolean", "IsBoolean", "FromConstructor", "FromDate", "IsDate", "FromFunction", "IsFunction", "FromInteger", "IsInteger", "FromIntersect", "hasError", "inner", "error", "keyCheck", "KeyOfPattern", "valueKey", "FromIterator", "IsIterator", "FromLiteral", "FromNever", "FromNot", "FromNull", "IsNull", "FromNumber", "TypeSystemPolicy", "FromObject", "requiredKeys", "knownKeys", "unknownKeys", "requiredKey", "knownKey", "property", "ExtendsUndefinedCheck", "FromPromise", "IsPromise", "FromRecord", "patternKey", "patternSchema", "regex", "propertyKey", "propertyValue", "FromRef", "Deref", "FromRegExp", "IsString", "FromString", "format_exports", "FromSymbol", "IsSymbol", "FromTemplateLiteral", "FromThis", "FromTuple", "FromUndefined", "IsUndefined", "FromUnion", "Check", "variant", "FromUint8Array", "IsUint8Array", "FromUnknown", "FromVoid", "FromKind", "type_exports", "Kind", "references_", "schema_", "Errors", "args", "init_define_process", "init_define_process", "__classPrivateFieldSet", "receiver", "state", "value", "kind", "f", "__classPrivateFieldGet", "_AssertError_instances", "_AssertError_iterator", "_AssertError_Iterator", "AssertError", "TypeBoxError", "iterator", "error", "ValueErrorIterator", "AssertValue", "schema", "references", "Check", "Errors", "Assert", "args", "init_define_process", "init_define_process", "init_define_process", "FromObject", "value", "Acc", "key", "Clone", "FromArray", "element", "FromTypedArray", "FromMap", "FromSet", "FromDate", "Clone", "value", "IsArray", "FromArray", "IsDate", "FromDate", "IsTypedArray", "FromTypedArray", "IsMap", "FromMap", "IsSet", "FromSet", "IsObject", "FromObject", "IsValueType", "ValueCreateError", "TypeBoxError", "schema", "message", "FromDefault", "value", "IsFunction", "Clone", "FromAny", "references", "HasPropertyKey", "FromArray", "item", "Visit", "FromAsyncIterator", "FromBigInt", "FromBoolean", "FromConstructor", "key", "val", "self", "FromDate", "FromFunction", "FromInteger", "FromIntersect", "acc", "next", "Check", "FromIterator", "FromLiteral", "FromNever", "FromNot", "FromNull", "FromNumber", "FromObject", "required", "Acc", "subschema", "FromPromise", "FromRecord", "keyPattern", "valueSchema", "PatternStringExact", "PatternNumberExact", "propertyKeys", "FromRef", "Deref", "FromRegExp", "FromString", "FromSymbol", "FromTemplateLiteral", "IsTemplateLiteralFinite", "TemplateLiteralGenerate", "FromThis", "recursiveDepth", "recursiveMaxDepth", "FromTuple", "_", "index", "FromUndefined", "FromUnion", "FromUint8Array", "FromUnknown", "FromVoid", "FromKind", "references_", "Pushref", "schema_", "Kind", "type_exports", "Create", "args", "ValueCastError", "TypeBoxError", "schema", "message", "ScoreUnion", "references", "value", "Kind", "IsNull", "object", "keys", "entries", "point", "max", "acc", "key", "literal", "checks", "Check", "exists", "SelectUnion", "union", "schemas", "Deref", "select", "best", "score", "CastUnion", "Clone", "Cast", "DefaultClone", "Create", "Default", "FromArray", "created", "IsArray", "minimum", "IsNumber", "casted", "Visit", "unique", "FromConstructor", "required", "result", "property", "FromIntersect", "mapped", "IsObject", "FromNever", "FromObject", "propertyNames", "propertyName", "FromRecord", "subschemaPropertyName", "subschema", "propKey", "propValue", "FromRef", "FromThis", "FromTuple", "index", "FromUnion", "references_", "IsString", "schema_", "args", "init_define_process", "IsCheckable", "schema", "IsKind", "Kind", "FromArray", "references", "value", "IsArray", "Visit", "FromIntersect", "unevaluatedProperties", "composite", "Clone", "acc", "IsObject", "knownkeys", "KeyOfPropertyKeys", "key", "Check", "FromObject", "additionalProperties", "HasPropertyKey", "FromRecord", "propertyKeys", "propertyKey", "propertySchema", "propertyKeyTest", "FromRef", "Deref", "FromThis", "FromTuple", "IsUndefined", "length", "i", "FromUnion", "inner", "references_", "IsString", "schema_", "Clean", "args", "init_define_process", "IsStringNumeric", "value", "IsString", "IsValueToString", "IsBigInt", "IsBoolean", "IsNumber", "IsValueTrue", "IsValueFalse", "IsTimeStringWithTimeZone", "IsTimeStringWithoutTimeZone", "IsDateTimeStringWithTimeZone", "IsDateTimeStringWithoutTimeZone", "IsDateString", "TryConvertLiteralString", "target", "conversion", "TryConvertString", "TryConvertLiteralNumber", "TryConvertNumber", "TryConvertLiteralBoolean", "TryConvertBoolean", "TryConvertLiteral", "schema", "TryConvertBigInt", "truncateInteger", "IsSymbol", "TryConvertInteger", "TryConvertNull", "TryConvertUndefined", "TryConvertDate", "IsDate", "FromArray", "schema", "references", "value", "IsArray", "element", "Visit", "FromBigInt", "TryConvertBigInt", "FromBoolean", "TryConvertBoolean", "FromDate", "TryConvertDate", "FromInteger", "TryConvertInteger", "FromIntersect", "FromLiteral", "TryConvertLiteral", "FromNull", "TryConvertNull", "FromNumber", "TryConvertNumber", "FromObject", "IsObject", "propertyKey", "HasPropertyKey", "FromRecord", "property", "propKey", "propValue", "FromRef", "Deref", "FromString", "TryConvertString", "FromSymbol", "IsString", "IsNumber", "FromThis", "FromTuple", "IsUndefined", "index", "FromUndefined", "TryConvertUndefined", "FromUnion", "subschema", "converted", "Clone", "Check", "references_", "Pushref", "schema_", "Kind", "Convert", "args", "init_define_process", "init_define_process", "TransformDecodeCheckError", "TypeBoxError", "schema", "value", "error", "TransformDecodeError", "path", "Default", "IsTransform", "TransformKind", "FromArray", "references", "IsArray", "index", "Visit", "FromIntersect", "IsObject", "IsValueType", "knownEntries", "KeyOfPropertyEntries", "knownKeys", "entry", "knownProperties", "knownKey", "knownSchema", "unknownKeys", "unevaluatedProperties", "unknownProperties", "key", "FromNot", "FromObject", "KeyOfPropertyKeys", "HasPropertyKey", "IsUndefined", "TypeSystemPolicy", "IsSchema", "additionalProperties", "FromRecord", "pattern", "FromRef", "target", "Deref", "FromThis", "FromTuple", "FromUnion", "subschema", "Check", "decoded", "references_", "Pushref", "schema_", "Kind", "TransformDecode", "init_define_process", "TransformEncodeCheckError", "TypeBoxError", "schema", "value", "error", "TransformEncodeError", "path", "Default", "IsTransform", "TransformKind", "FromArray", "references", "defaulted", "IsArray", "index", "Visit", "FromIntersect", "IsObject", "IsValueType", "knownEntries", "KeyOfPropertyEntries", "knownKeys", "entry", "knownProperties", "knownKey", "knownSchema", "unknownKeys", "unevaluatedProperties", "properties", "key", "FromNot", "FromObject", "KeyOfPropertyKeys", "HasPropertyKey", "IsUndefined", "TypeSystemPolicy", "IsSchema", "additionalProperties", "FromRecord", "pattern", "FromRef", "target", "Deref", "resolved", "FromThis", "FromTuple", "value1", "FromUnion", "subschema", "Check", "references_", "Pushref", "schema_", "Kind", "TransformEncode", "init_define_process", "FromArray", "schema", "references", "IsTransform", "Visit", "FromAsyncIterator", "FromConstructor", "FromFunction", "FromIntersect", "FromIterator", "FromNot", "FromObject", "IsSchema", "FromPromise", "FromRecord", "pattern", "property", "FromRef", "Deref", "FromThis", "FromTuple", "IsUndefined", "FromUnion", "references_", "Pushref", "schema_", "visited", "Kind", "HasTransform", "Decode", "args", "schema", "references", "value", "Check", "TransformDecodeCheckError", "Errors", "HasTransform", "TransformDecode", "init_define_process", "ValueOrDefault", "schema", "value", "defaultValue", "HasPropertyKey", "clone", "IsFunction", "Clone", "IsUndefined", "IsObject", "HasDefaultProperty", "IsKind", "FromArray", "references", "defaulted", "IsArray", "i", "Visit", "FromDate", "IsDate", "FromIntersect", "acc", "next", "FromObject", "knownPropertyKeys", "key", "propertyValue", "FromRecord", "additionalPropertiesSchema", "propertyKeyPattern", "propertySchema", "knownPropertyKey", "FromRef", "Deref", "FromThis", "FromTuple", "items", "max", "FromUnion", "inner", "result", "Check", "references_", "Pushref", "schema_", "Kind", "Default", "args", "init_define_process", "init_define_process", "pointer_exports", "__export", "Delete", "Format", "Get", "Has", "Set", "ValuePointerRootDeleteError", "ValuePointerRootSetError", "init_define_process", "ValuePointerRootSetError", "TypeBoxError", "value", "path", "update", "ValuePointerRootDeleteError", "Escape", "component", "Format", "pointer", "start", "end", "i", "Set", "owner", "next", "key", "Delete", "index", "Has", "Get", "current", "init_define_process", "ObjectType", "left", "right", "IsObject", "leftKeys", "rightKeys", "key", "Equal", "DateType", "IsDate", "ArrayType", "IsArray", "value", "index", "TypedArrayType", "IsTypedArray", "ValueType", "IsValueType", "Insert", "Object", "Literal", "String", "Unknown", "Update", "Delete", "Edit", "Union", "ValueDiffError", "TypeBoxError", "value", "message", "CreateUpdate", "path", "CreateInsert", "CreateDelete", "AssertDiffable", "ObjectType", "current", "next", "IsStandardObject", "currentKeys", "nextKeys", "key", "HasPropertyKey", "Equal", "Visit", "ArrayType", "IsArray", "i", "TypedArrayType", "IsTypedArray", "ValueType", "IsValueType", "Diff", "IsRootUpdate", "edits", "IsIdentity", "Patch", "Clone", "clone", "edit", "pointer_exports", "init_define_process", "Encode", "args", "schema", "references", "value", "encoded", "HasTransform", "TransformEncode", "Check", "TransformEncodeCheckError", "Errors", "init_define_process", "ValueMutateError", "TypeBoxError", "message", "ObjectType", "root", "path", "current", "next", "IsObject", "pointer_exports", "Clone", "currentKeys", "nextKeys", "currentKey", "nextKey", "Visit", "ArrayType", "IsArray", "index", "TypedArrayType", "IsTypedArray", "i", "ValueType", "IsValueType", "IsNonMutableValue", "value", "IsMismatchedValue", "Mutate", "init_define_process", "ParseReducer", "_schema", "_references", "value", "Clone", "schema", "references", "Default", "Clean", "Convert", "Assert", "HasTransform", "TransformDecode", "ParseValue", "reducer", "Parse", "args", "init_define_process", "value_exports", "__export", "Assert", "Cast", "Check", "Clean", "Clone", "Convert", "Create", "Decode", "Default", "Diff", "Edit", "Encode", "Equal", "Errors", "Hash", "Mutate", "Parse", "Patch", "ValueErrorIterator", "init_define_process", "init_define_process", "ch2", "wk", "c", "id", "msg", "transfer", "cb", "w", "e", "d", "ed", "err", "u8", "u16", "i32", "fleb", "fdeb", "clim", "freb", "eb", "start", "b", "i", "r", "j", "_a", "fl", "revfl", "_b", "fd", "revfd", "rev", "x", "hMap", "cd", "mb", "s", "l", "le", "co", "rvb", "sv", "r_1", "v", "m", "flt", "fdt", "flm", "flrm", "fdm", "fdrm", "max", "a", "bits", "p", "o", "bits16", "shft", "slc", "FlateErrorCode", "ec", "ind", "nt", "inflt", "dat", "st", "buf", "dict", "sl", "dl", "noBuf", "resize", "noSt", "cbuf", "bl", "nbuf", "final", "pos", "bt", "lm", "dm", "lbt", "dbt", "tbts", "type", "hLit", "hcLen", "tl", "ldt", "clt", "clb", "clbmsk", "clm", "n", "lt", "dt", "t", "lms", "dms", "lpos", "sym", "add", "dsym", "end", "shift", "dend", "wbits", "wbits16", "hTree", "t2", "et", "i0", "i1", "i2", "maxSym", "tr", "mbt", "ln", "lft", "cst", "i2_1", "i2_2", "i2_3", "lc", "cl", "cli", "cln", "cls", "clen", "cf", "wfblk", "out", "wblk", "syms", "lf", "df", "li", "bs", "dlt", "mlb", "ddt", "mdb", "_c", "lclt", "nlc", "_d", "lcdt", "ndc", "lcfreq", "_e", "lct", "mlcb", "nlcc", "flen", "ftlen", "dtlen", "ll", "llm", "lcts", "it", "clct", "len", "dst", "deo", "dflt", "lvl", "plvl", "pre", "post", "lst", "opt", "msk_1", "prev", "head", "bs1_1", "bs2_1", "hsh", "lc_1", "wi", "hv", "imod", "pimod", "rem", "ch_1", "dif", "maxn", "maxd", "ml", "nl", "mmd", "md", "ti", "pti", "lin", "din", "crct", "k", "crc", "cr", "dopt", "dat", "opt", "pre", "post", "st", "dict", "newDat", "u8", "dflt", "mrg", "a", "b", "o", "k", "wcln", "fn", "fnStr", "td", "dt", "ks", "i", "v", "st_1", "spInd", "t", "ch", "cbfs", "tl", "wrkr", "fns", "init", "id", "cb", "td_1", "m", "wk", "bInflt", "u16", "i32", "fleb", "fdeb", "clim", "fl", "fd", "flrm", "fdrm", "rev", "ec", "hMap", "max", "bits", "bits16", "shft", "slc", "err", "inflt", "inflateSync", "pbf", "gopt", "bDflt", "revfl", "revfd", "flm", "flt", "fdm", "fdt", "deo", "et", "wbits", "wbits16", "hTree", "ln", "lc", "clen", "wfblk", "wblk", "deflateSync", "pbf", "msg", "gopt", "o", "u8", "cbify", "dat", "opts", "fns", "init", "id", "cb", "w", "wrkr", "err", "b2", "d", "b", "b4", "b8", "wbytes", "v", "deflate", "data", "opts", "cb", "err", "cbify", "bDflt", "ev", "pbf", "deflateSync", "dopt", "inflate", "data", "opts", "cb", "err", "cbify", "bInflt", "ev", "pbf", "inflateSync", "gopt", "inflt", "fltn", "d", "p", "o", "k", "val", "n", "op", "mrg", "u8", "te", "td", "tds", "et", "dutf8", "i", "c", "eb", "slc", "strToU8", "str", "latin1", "ar_1", "u8", "i", "te", "l", "ar", "ai", "w", "v", "n", "slc", "strFromU8", "dat", "r", "td", "_a", "dutf8", "s", "err", "slzh", "d", "b", "b2", "zh", "z", "fnl", "fn", "strFromU8", "es", "bs", "b4", "_a", "z64e", "sc", "su", "off", "b8", "exfl", "ex", "le", "k", "l", "err", "wzh", "f", "u", "c", "ce", "co", "fl", "col", "exl", "wbytes", "dt", "y", "exf", "wzf", "o", "e", "zip", "data", "opts", "cb", "err", "r", "fltn", "k", "lft", "o", "tot", "slft", "files", "term", "tAll", "i", "cbd", "a", "b", "mt", "cbf", "out", "u8", "oe", "cdl", "f", "l", "wzh", "badd", "exfl", "loc", "e", "wzf", "_loop_1", "fn", "_a", "file", "p", "c", "crc", "size", "strToU8", "s", "com", "m", "ms", "exl", "compression", "cbl", "d", "mrg", "deflateSync", "deflate", "zipSync", "mt", "fn", "unzip", "data", "opts", "cb", "err", "term", "tAll", "i", "files", "cbd", "a", "b", "e", "b4", "lft", "b2", "o", "z", "ze", "fltr", "_loop_3", "_a", "zh", "c_1", "sc", "su", "no", "off", "slzh", "cbl", "d", "slc", "infl", "inflateSync", "u8", "inflate", "unzipSync", "c", "c_2", "init_define_process", "maybePath", "path", "notNull", "value", "resolveSchemaIdent", "schema", "references", "nesting", "type_exports", "ref", "r", "message", "s", "errorHandler", "root", "error", "shortError", "errors", "CompressErrorKind", "CompressError", "kind", "message", "__publicField", "flateErrorIntoCompressError", "error", "isFlateError", "flateErrorCodes", "FlateErrorCode", "checkErrorIntoCompressError", "root", "references", "shortError", "encodeErrorIntoCompressError", "unknownErrorIntoCompressError", "intoCompressError", "TransformEncodeError", "ValueErrorIterator", "init_define_process", "DecompressErrorKind", "DecompressError", "kind", "message", "__publicField", "flateErrorIntoDecompressError", "error", "isFlateError", "flateErrorCodes", "FlateErrorCode", "checkErrorIntoDecompressError", "root", "references", "shortError", "decodeErrorIntoDecompressError", "unknownErrorIntoDecompressError", "intoDecompressError", "TransformDecodeError", "ValueErrorIterator", "iterRecord", "record", "basePath", "i", "key", "items", "path", "getPath", "root", "ensureUniqueIds", "collection", "idAccessor", "ids", "item", "id", "err", "IntegrityErrorKind", "ok", "validateFloors", "data", "err", "IntegrityErrorKind", "ensureUniqueIds", "feature", "FloorProperties", "Type", "FloorId", "WithDetails", "FloorFeature", "Feature", "Polygon", "MultiPolygon", "FloorCollection", "FeatureCollection", "FloorsSchema", "FloorsExtension", "data", "path", "contents", "decode", "validateFloors", "init_define_process", "init_define_process", "PartialRecord", "schema", "Type", "init_define_process", "typedKeys", "obj", "init_define_process", "init_define_process", "createFloorMap", "data", "feature", "createFloorLookup", "floorMap", "floorId", "floor", "err", "IntegrityErrorKind", "ok", "validateGeometry", "data", "err", "IntegrityErrorKind", "uniqueIds", "ensureUniqueIds", "geometry", "floorLookup", "createFloorLookup", "floorId", "typedKeys", "result", "ok", "GeometryProperties", "Type", "GeometryId", "WithDetails", "GeometryFeature", "Feature", "Point", "MultiPoint", "LineString", "MultiLineString", "Polygon", "MultiPolygon", "GeometryCollection", "FeatureCollection", "GeometrySchema", "PartialRecord", "FloorId", "GeometryFilePath", "GeometryExtension", "data", "floorId", "typedKeys", "path", "contents", "decode", "validateGeometry", "init_define_process", "ManifestFile", "Type", "ManifestFolder", "Self", "ManifestProperties", "FloorId", "ManifestCollection", "FeatureCollection", "Feature", "Point", "ManifestSchema", "ManifestExtension", "data", "path", "contents", "decode", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "TypeDereferenceError", "TypeBoxError", "schema", "__publicField", "Resolve", "references", "target", "Deref", "Pushref", "value_exports", "Kind", "init_define_process", "HasTransformCached", "cache", "schema", "references", "cached", "result", "HasTransform", "CreateTransformCache", "Default", "schema", "path", "value", "type_exports", "TransformKind", "error", "TransformDecodeError", "FromArray", "references", "cache", "value_exports", "index", "Visit", "FromIntersect", "IsValueType", "knownEntries", "KeyOfPropertyEntries", "knownKeys", "entry", "knownProperties", "knownKey", "knownSchema", "unknownKeys", "unevaluatedProperties", "unknownProperties", "key", "FromNot", "FromObject", "KeyOfPropertyKeys", "TypeSystemPolicy", "additionalProperties", "FromRecord", "pattern", "FromRef", "target", "Deref", "FromThis", "FromTuple", "FromUnion", "subschema", "decoded", "references_", "Pushref", "schema_", "Kind", "FastTransformDecode", "CreateTransformCache", "init_define_process", "Default", "schema", "path", "value", "type_exports", "TransformKind", "error", "TransformEncodeError", "FromArray", "references", "cache", "defaulted", "value_exports", "index", "Visit", "FromIntersect", "IsValueType", "knownEntries", "KeyOfPropertyEntries", "knownKeys", "entry", "knownProperties", "knownKey", "knownSchema", "unknownKeys", "unevaluatedProperties", "properties", "key", "FromNot", "_references", "FromObject", "KeyOfPropertyKeys", "TypeSystemPolicy", "additionalProperties", "FromRecord", "pattern", "FromRef", "target", "Deref", "resolved", "FromThis", "FromTuple", "value1", "FromUnion", "subschema", "references_", "Pushref", "schema_", "Kind", "FastTransformEncode", "CreateTransformCache", "init_define_process", "TypeCheck", "schema", "references", "checkFunc", "code", "HasTransform", "value", "Errors", "TransformDecodeCheckError", "TransformDecode", "encoded", "TransformEncode", "TransformEncodeCheckError", "Character", "DollarSign", "IsUnderscore", "IsAlpha", "IsNumeric", "MemberExpression", "IsFirstCharacterNumeric", "IsAccessor", "i", "EscapeHyphen", "key", "Encode", "object", "Identifier", "$id", "buffer", "LiteralString", "Escape", "content", "TypeCompilerUnknownTypeError", "TypeBoxError", "TypeCompilerTypeGuardError", "Policy", "IsExactOptionalProperty", "expression", "TypeSystemPolicy", "IsObjectLike", "IsRecordLike", "IsNumberLike", "IsVoidLike", "TypeCompiler", "IsAnyOrUnknown", "Kind", "FromAny", "FromArray", "parameter", "accumulator", "CreateParameter", "IsNumber", "elementExpression", "CreateExpression", "IsSchema", "containsSchema", "Never", "checkExpression", "checkMinContains", "checkMaxContains", "checkCount", "check", "FromAsyncIterator", "FromBigInt", "IsBigInt", "FromBoolean", "FromConstructor", "Visit", "FromDate", "FromFunction", "FromInteger", "FromIntersect", "check1", "keyCheck", "CreateVariable", "KeyOfPattern", "check2", "FromIterator", "FromLiteral", "FromNever", "FromNot", "FromNull", "FromNumber", "FromObject", "knownKeys", "knownKey", "memberExpression", "property", "ExtendsUndefinedCheck", "keys", "FromPromise", "FromRecord", "patternKey", "patternSchema", "variable", "FromRef", "target", "Deref", "state", "CreateFunctionName", "FromRegExp", "FromString", "FromSymbol", "FromTemplateLiteral", "FromThis", "FromTuple", "FromUndefined", "FromUnion", "FromUint8Array", "FromUnknown", "FromVoid", "FromKind", "instance", "useHoisting", "references_", "IsString", "schema_", "functionName", "functionCode", "CreateFunction", "type_exports", "variableName", "name", "newline", "pad", "length", "returns", "CreateReturns", "type", "annotation", "Build", "options", "functions", "variables", "checkFunction", "Code", "args", "defaults", "IsArray", "Compile", "generatedCode", "compiledFunction", "instances", "typeRegistryFunction", "kind", "formatRegistryFunction", "format", "format_exports", "hashFunction", "Hash", "init_define_process", "init_define_process", "init_define_process", "DATE", "DAYS", "isLeapYear", "year", "isDate", "str", "matches", "month", "day", "init_define_process", "TIME", "isTime", "str", "matches", "hr", "min", "sec", "tz", "tzSign", "tzH", "tzM", "utcMin", "utcHr", "DATE_TIME_SEPARATOR", "isDateTime", "str", "dateTime", "isDate", "isTime", "init_define_process", "NOT_URI_FRAGMENT", "URI", "isUri", "str", "FORMATS", "isDate", "isTime", "isDateTime", "isUri", "registerFormats", "name", "fn", "TypeSystem", "e", "TypeSystemDuplicateFormat", "init_define_process", "Extra", "Type", "WithExtra", "ExtraReferences", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "typedEntries", "record", "createLookupMap", "data", "geometriesByFloorId", "floorId", "geometries", "typedEntries", "g", "createGeometryLookup", "geometryIdsByFloorId", "geometryId", "floorGeometries", "err", "IntegrityErrorKind", "geometry", "ok", "init_define_process", "WithGeometryId", "Type", "GeometryId", "WithGeometryIds", "WithGeometryIdReferences", "init_define_process", "init_define_process", "init_define_process", "asError", "error", "safeFn", "fn", "args", "ok", "e", "err", "asError", "createZippable", "safeFn", "data", "extensions", "compressed", "extension", "file", "strToU8", "compress", "options", "resolve", "zip", "error", "result", "err", "ok", "safeZipSync", "zipSync", "compressSync", "init_define_process", "init_define_process", "deepMergeOn", "full", "partial", "idKeys", "result", "key", "partialValue", "typedKey", "keyPath", "findIdentifierKey", "fullObjectArray", "partialsById", "v", "getValueByKeyPath", "merged", "fullObject", "fullValue", "obj", "search", "current", "idKey", "value", "identity", "value", "jsonDecode", "data", "strFromU8", "isFileExpected", "fileInfo", "extensions", "extension", "processBundle", "safeFn", "result", "filePath", "fileData", "decoded", "deepMergeOn", "decompress", "resolve", "unzip", "info", "error", "err", "ok", "res", "decompressed", "safeUnzipSync", "unzipSync", "decompressSync", "unzipped", "init_define_process", "isRef", "thing", "isDuplicateRef", "things", "reference", "v", "fixDuplicateAllOf", "k", "init_define_process", "prefixReferences", "thing", "k", "v", "CreateMVFParserErrorKind", "join", "iterators", "iterator", "result", "computeReferenceMap", "schemas", "referenceMap", "schema", "existing", "err", "ok", "_schema", "_compiled", "_extensions", "_referenceMap", "_MVFParser", "compiled", "extensions", "__privateAdd", "__privateSet", "builder", "schemaId", "cspSafe", "mergedSchema", "Type", "extension", "type_exports", "GeoJSON", "Identifiers", "DetailsReferences", "ExtraReferences", "GeometryAnchorReferences", "WithGeometryIdReferences", "registerFormats", "TypeCompiler", "e", "TypeBoxError", "content", "__privateGet", "value_exports", "FastTransformDecode", "FastTransformEncode", "normalizedReferences", "fixDuplicateAllOf", "prefixReferences", "data", "d", "encoded", "compress", "res", "intoCompressError", "compressSync", "decompress", "decompressed", "intoDecompressError", "decompressSync", "MVFParser", "_extensions", "MVFParserBuilder", "__privateAdd", "extension", "__privateGet", "partialExtension", "Type", "options", "MVFParser", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "GeometryAnchor", "Type", "GeometryId", "FloorId", "WithGeometryAnchor", "WithGeometryAnchors", "arrayOptions", "objectOptions", "GeometryAnchorReferences", "init_define_process", "init_define_process", "init_define_process", "SafeStringEnumSchema", "enumValues", "options", "Type", "value", "SafeStringEnum", "schema", "values", "record", "createParser", "MVFParserBuilder", "FloorsExtension", "GeometryExtension", "ManifestExtension", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "AnnotationIntegrityErrorKind", "validateAnnotations", "data", "ok", "uniqueIds", "ensureUniqueIds", "annotation", "lookupData", "createGeometryLookup", "knownSymbols", "typedKeys", "floorId", "floorAnnotations", "err", "AnnotationIntegrityErrorKind", "geometry", "AnnotationId", "Ident", "AnnotationProperties", "Type", "WithGeometryId", "AnnotationSymbol", "AnnotationsSchema", "PartialRecord", "FloorId", "AnnotationFilePath", "AnnotationsExtension", "data", "floorId", "typedKeys", "path", "contents", "decode", "validateAnnotations", "init_define_process", "init_define_process", "init_define_process", "LocationCategoryId", "Ident", "LocationCategory", "Type", "WithRequiredDetails", "WithExtra", "CategoryReferences", "init_define_process", "init_define_process", "LocationsIntegrityErrorKind", "validateLocations", "data", "ok", "uniqueCategoryIds", "ensureUniqueIds", "category", "uniqueLocationIds", "location", "uniqueInstanceIds", "instance", "knownCategoryIds", "err", "LocationsIntegrityErrorKind", "geometryLookup", "createGeometryLookup", "anchor", "geometry", "knownLocationIds", "init_define_process", "LocationId", "Ident", "LocationInstanceId", "LocationSocial", "Type", "LocationImage", "LocationLink", "OpeningHoursTime", "OpeningHoursDay", "PUBLIC_HOLIDAYS", "OpeningHoursDayOrPublicHoliday", "OpeningHoursSpecification", "Location", "LocationCategoryId", "WithRequiredDetails", "WithGeometryAnchors", "WithExtra", "LocationInstance", "WithDetails", "LocationReferences", "LocationsExtensionSchema", "Type", "Location", "LocationCategory", "LocationInstance", "LocationsFilePath", "LocationCategoriesFilePath", "LocationInstancesFilePath", "LocationsExtension", "data", "path", "contents", "decode", "CategoryReferences", "LocationReferences", "validateLocations", "init_define_process", "init_define_process", "EnterpriseIntegrityErrorKind", "validateCMS", "data", "ok", "cms", "uniqueCategories", "ensureUniqueIds", "category", "knownCategoryIds", "err", "EnterpriseIntegrityErrorKind", "uniqueLocations", "location", "locationDataMap", "siblingGroup", "id", "locationData", "topLocation", "knownEnterpriseLocationIds", "uniqueLocationInstances", "locationInstance", "knownLocationInstanceIds", "floorLookup", "createFloorLookup", "geometryLookup", "createGeometryLookup", "uniqueFloorTexts", "floorText", "floorId", "floorTextFeatureCollection", "typedEntries", "validFloor", "feature", "validGeometry", "enterpriseTextures", "texture", "enterpriseLayers", "geometryId", "typedKeys", "textAreas", "textArea", "init_define_process", "init_define_process", "EnterpriseLocationId", "Ident", "EnterpriseCategoryId", "EnterpriseLocationInstanceId", "EnterpriseVenueId", "EnterpriseFloorTextId", "IdentifiersReferences", "EnterpriseCategory", "Type", "EnterpriseCategoryId", "LocationCategoryId", "EnterpriseCategoriesSchema", "EnterpriseCategoryReferences", "init_define_process", "textAlignment", "SafeStringEnum", "TextAlignment", "TEXT_ALIGNMENTS", "FloorTextCommonProperties", "Type", "EnterpriseFloorTextId", "AnchoredFloorTextProperties", "WithGeometryId", "FloatingFloorTextProperties", "FloorTextProperties", "FloorTextFeature", "Feature", "Point", "AnchoredFloorTextFeature", "FloatingFloorTextFeature", "EnterpriseFloorTextFeatureCollection", "FeatureCollection", "EnterpriseFloorTextCollectionsByFloor", "FloorId", "EnterpriseFloorTextSchema", "EnterpriseFloorTextReferences", "init_define_process", "EnterpriseLayers", "PartialRecord", "Type", "GeometryId", "EnterpriseLayersByFloor", "FloorId", "EnterpriseLayersSchema", "EnterpriseLayersReferences", "init_define_process", "init_define_process", "init_define_process", "locationStates", "SafeStringEnum", "LocationStateType", "LOCATION_STATES", "LOCATION_STATE", "LocationState", "Type", "SiblingGroup", "LocationId", "Language", "UtilityReferences", "EnterpriseLocation", "Type", "EnterpriseLocationId", "LocationId", "LocationState", "SiblingGroup", "LocationCategoryId", "EnterpriseLocationsSchema", "EnterpriseLocationReferences", "EnterpriseLocationInstance", "Type", "EnterpriseLocationInstanceId", "EnterpriseLocationId", "LocationInstanceId", "EnterpriseLocation", "EnterpriseLocationInstancesSchema", "EnterpriseLocationInstancesReferences", "init_define_process", "textAreaAlignment", "SafeStringEnum", "EnterpriseTextAreaAlignment", "TEXT_AREA_ALIGNMENTS", "TEXT_AREA_ALIGNMENT", "EnterpriseBaseTextAreaProperties", "Type", "EnterpriseAnchoredTextAreaProperties", "WithGeometryId", "EnterpriseFloatingTextAreaProperties", "EnterpriseTextAreaProperties", "EnterpriseTextAreaFeature", "Feature", "Point", "EnterpriseTextAreaCollection", "FeatureCollection", "EnterpriseTextAreasByFloor", "FloorId", "EnterpriseTextAreasSchema", "EnterpriseTextAreasReferences", "init_define_process", "EnterpriseTextureUV", "Type", "enterpriseTextureFace", "SafeStringEnum", "EnterpriseTextureFace", "ENTERPRISE_TEXTURE_FACES", "ENTERPRISE_TEXTURE_FACE", "enterpriseTextureSurface", "EnterpriseTextureSurface", "ENTERPRISE_TEXTURE_SURFACES", "ENTERPRISE_TEXTURE_SURFACE", "EnterpriseTextureBounds", "Longitude", "Latitude", "EnterpriseTexture", "WithGeometryId", "EnterpriseTextures", "EnterpriseTexturesByFloor", "FloorId", "EnterpriseTexturesSchema", "EnterpriseTextureReferences", "init_define_process", "EnterpriseVenue", "Type", "EnterpriseVenueId", "Language", "LocationId", "OpeningHoursSpecification", "WithRequiredDetails", "WithExtra", "EnterpriseVenueSchema", "EnterpriseVenueReferences", "CMSProperties", "Type", "EnterpriseVenueSchema", "EnterpriseLocationsSchema", "EnterpriseLocationInstancesSchema", "EnterpriseCategoriesSchema", "EnterpriseTexturesSchema", "EnterpriseFloorTextSchema", "EnterpriseLayersSchema", "EnterpriseTextAreasSchema", "CMSExtensionSchema", "EnterpriseFilePath", "CMSExtension", "data", "cms", "subSchema", "typedKeys", "floorId", "path", "contents", "decode", "match", "fileName", "decodedContents", "EnterpriseVenueReferences", "EnterpriseLocationReferences", "EnterpriseLocationInstancesReferences", "EnterpriseCategoryReferences", "EnterpriseTextureReferences", "EnterpriseLayersReferences", "EnterpriseFloorTextReferences", "EnterpriseTextAreasReferences", "IdentifiersReferences", "UtilityReferences", "LocationReferences", "validateCMS", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "NavigationFlagIntegrityKind", "validateNavigationFlags", "data", "navigationFlags", "ok", "sortedFlags", "key", "value", "a", "b", "lastIndex", "lastBit", "flag", "err", "NavigationFlagIntegrityKind", "init_define_process", "hasFlag", "withFlags", "flag", "init_define_process", "MAX_FLAG", "determineMaxNavigationFlags", "data", "count", "maxIndex", "maxFlag", "validateFlags", "flags", "path", "ok", "expectedLength", "err", "NavigationFlagIntegrityKind", "i", "flag", "NavigationFlagDeclarationCore", "Type", "NavigationFlagDeclaration", "WithDetails", "WELL_KNOWN_FLAGS", "NavigationFlagDeclarations", "NavigationFlagsSchema", "Flags", "WithFlags", "FlaggedGeometryAnchor", "GeometryAnchor", "WithFlaggedGeometryAnchor", "WithFlaggedGeometryAnchors", "NavigationFlagsExtension", "data", "path", "contents", "decode", "validateNavigationFlags", "init_define_process", "validateConnections", "data", "ok", "uniqueConnectionIds", "ensureUniqueIds", "connection", "anchorLookup", "createGeometryLookup", "maxFlags", "determineMaxNavigationFlags", "i", "j", "entrance", "result", "flagsResult", "validateFlags", "exit", "ConnectionId", "Ident", "schema", "values", "record", "SafeStringEnum", "ConnectionType", "CONNECTION_TYPE", "record", "Connection", "Type", "ConnectionId", "FlaggedGeometryAnchor", "ConnectionType", "WithDetails", "WithExtra", "ConnectionsCollection", "ConnectionsExtensionSchema", "connectionsFilePath", "ConnectionsExtension", "data", "path", "contents", "decode", "Flags", "validateConnections", "init_define_process", "init_define_process", "validateDefaultStyle", "data", "ok", "anchorLookup", "createGeometryLookup", "style", "anchor", "result", "DefaultStyle", "Type", "WithGeometryAnchors", "WithExtra", "DefaultStyleCollection", "DefaultStyleSchema", "DefaultStyleExtension", "data", "path", "contents", "decode", "validateDefaultStyle", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "FloorStacksIntegrityErrorKind", "validateFloorStacks", "data", "ok", "uniqueFloorStackIds", "ensureUniqueIds", "floorStack", "floorLookup", "createFloorLookup", "fs", "floorId", "result", "err", "FloorStacksIntegrityErrorKind", "FloorStackId", "Ident", "FloorStack", "Type", "FloorId", "WithDetails", "FloorStackCollection", "FloorStackExtensionSchema", "filePath", "FloorStackExtension", "data", "path", "contents", "decode", "validateFloorStacks", "init_define_process", "init_define_process", "FacadeIntegrityErrorKind", "validateFacade", "data", "ok", "err", "FacadeIntegrityErrorKind", "floorStackIds", "floorStack", "anchorLookup", "createGeometryLookup", "floorLookup", "createFloorLookup", "floorId", "facades", "typedEntries", "floor", "facade", "floorStackId", "geometryIds", "geometryId", "result", "Facade", "Type", "FloorStackId", "WithGeometryIds", "FacadeExtensionSchema", "PartialRecord", "FloorId", "FacadeFilePath", "FacadeExtension", "data", "floorId", "typedKeys", "path", "contents", "decode", "validateFacade", "init_define_process", "init_define_process", "validateFloorImages", "data", "ok", "lookupData", "createGeometryLookup", "floorId", "floorImagesCollection", "typedEntries", "floorImage", "geometryId", "geometry", "BaseFloorImageProperties", "Type", "AnchoredFloorImageProperties", "WithGeometryId", "FloatingFloorImageProperties", "FloorImageProperties", "FloorImageFeature", "Feature", "Point", "FloorImageCollection", "FeatureCollection", "FloorImagesExtensionSchema", "PartialRecord", "FloorId", "FloorImagesFilePath", "FloorImagesExtension", "data", "floorId", "typedKeys", "path", "contents", "decode", "validateFloorImages", "init_define_process", "init_define_process", "validateKinds", "data", "ok", "geometryLookup", "createGeometryLookup", "floorId", "kindsCollection", "typedEntries", "geometryId", "typedKeys", "geometry", "values", "schema", "record", "SafeStringEnum", "Kind", "GeometryKinds", "PartialRecord", "Type", "GeometryId", "Kind", "KindsExtensionSchema", "FloorId", "KindsFilePath", "KindsExtension", "data", "floorId", "typedKeys", "path", "contents", "decode", "validateKinds", "init_define_process", "init_define_process", "init_define_process", "NodesIntegrityErrorKind", "validateNodes", "data", "ok", "uniqueNodeIds", "ensureUniqueIds", "node", "geometryLookup", "createGeometryLookup", "maxFlags", "determineMaxNavigationFlags", "floorId", "nodesCollection", "typedEntries", "knownNodeIds", "nodeIndex", "geometryId", "geometry", "neighborIndex", "neighbor", "err", "NodesIntegrityErrorKind", "flagsResult", "validateFlags", "NodeId", "Ident", "NodeNeighbor", "Type", "WithFlags", "NodeProperties", "WithGeometryIds", "NodeFeature", "Feature", "Point", "NodeCollection", "FeatureCollection", "NodesExtensionSchema", "PartialRecord", "FloorId", "NodesFilePath", "NodesExtension", "data", "floorId", "typedKeys", "path", "contents", "decode", "validateNodes", "init_define_process", "init_define_process", "init_define_process", "OutdoorsIntegrityErrorKind", "validateOutdoors", "data", "ok", "floorLookup", "createFloorLookup", "floorId", "result", "floorStack", "err", "OutdoorsIntegrityErrorKind", "Outdoors", "Type", "FloorId", "OutdoorsExtensionSchema", "OutdoorsFilePath", "OutdoorsExtension", "data", "path", "contents", "decode", "validateOutdoors", "init_define_process", "init_define_process", "init_define_process", "TilesetIntegrityErrorKind", "validateTilesets", "data", "ok", "keys", "style", "err", "TilesetIntegrityErrorKind", "TilesetStyle", "Type", "TilesetCollection", "TilesetExtensionSchema", "TilesetExtension", "data", "path", "contents", "decode", "validateTilesets", "init_define_process", "WalkableProperties", "Type", "NonWalkableProperties", "WalkableGeometries", "PartialRecord", "GeometryId", "NonWalkableGeometries", "TraversabilitySchema", "FloorId", "WalkableFilePath", "NonWalkableFilePath", "TraversabilityExtension", "data", "floorId", "typedKeys", "path", "contents", "decode", "walkableFloorId", "nonwalkableFloorId", "init_define_process", "init_define_process", "toSpaceId", "id", "toObstructionId", "toWindowId", "id", "convertLocationInstanceId", "convertLocationId", "convertLocationCategoryId", "convertAreaId", "id", "convertNodeToSpaceId", "splitMultiPartGeometryFeatureWithNewId", "feature", "newId", "kind", "result", "index", "type", "coordinates", "mapGeometryToOtherIds", "geometry", "xIds", "convertToX", "kindsMap", "floorId", "converted", "ids", "x", "anchors", "geometryId", "createGeometryMaps", "v3", "createKindsMap", "flatFeatures", "typedEntries", "floor", "featureCollection", "walkableIds", "typedKeys", "obstructionIds", "areaIds", "_", "objectsIds", "windowIds", "toSpaceId", "toObstructionId", "toWindowId", "connection", "c", "entrance", "exit", "buildBuilderOptions", "v3", "nodesByGeometryId", "incomingEdgesByNodeId", "nodesById", "buildNodeMaps", "geometryMaps", "createGeometryMaps", "geometryFeatureById", "buildGeometryFeatureById", "navigationFlags", "floorNodes", "node", "geometryId", "existingNodes", "neighbor", "existing", "floorGeometry", "geometry", "init_define_process", "buildAnnotations", "v3", "_", "v2Annotations", "floorId", "annotations", "typedEntries", "geometryById", "g", "v2AnnotationCollection", "v3Annotation", "geometry", "v2AnnotationProperties", "init_define_process", "buildConnections", "v3", "nodesByGeometryId", "v2", "ACCESSIBLE_FLAG", "WELL_KNOWN_FLAGS", "OUTDOORS_FLAG", "geometryFeatureById", "floor", "f", "connection", "isLineDoor", "doesConnectionTransitionFloors", "entrances", "buildEntranceFeaturesFromConnection", "floorId", "entrance", "accessible", "e", "hasFlag", "nodes", "n", "v2Connection", "CONNECTION_TYPE", "outdoorsFlag", "geometryFeature", "entranceFeature", "isExterior", "details", "init_define_process", "buildEnterprise", "v3", "geometryMaps", "nodesByGeometryId", "v2Enterprise", "v3Manifest", "v3Venue", "locationsByLocationCategoryId", "v3Locations", "v3EnterpriseLocations", "v3EnterpriseCategories", "enterpriseCategoryByLocationCategoryId", "cat", "eneterpriseLocationsByLocationId", "enterpriseLocation", "v3Location", "v3EnterpriseLocation", "details", "v2EnterpriseLocation", "convertLocationId", "v2EnterpriseCategory", "social", "convertSocials", "anchor", "space", "obstruction", "converted", "polygons", "f", "nodes", "node", "category", "v3EnterpriseLocationInstances", "v3LocationInstances", "v3EnterpriseLocationInstancesByLocationInstanceId", "instance", "v2EnterpriseLocationInstances", "v3LocationInstance", "v3EnterpriseLocationInstance", "v2EnterpriseLocationInstance", "convertLocationInstanceId", "spaces", "v3Categories", "v2EnterpriseCategories", "v3CategoriesById", "categoryChildren", "v3Category", "parent", "children", "v3EnterpriseCategory", "convertLocationCategoryId", "v2CategoryPriorities", "e", "v2EnterpriseStyles", "styleId", "style", "convertedAnchors", "v2EnterpriseLayers", "layers", "geometryId", "layer", "typedEntries", "v2EnterpriseLayer", "v2EnterpriseTextures", "textures", "texture", "anchors", "v2EnterpriseFloorText", "floorId", "floorText", "v2FloorTextFeatureCollection", "feature", "commonProperties", "result", "v2TextAreas", "v2FloorTextFeature", "SUPPORTED_SOCIALS", "v3Socials", "v2Socials", "name", "url", "lowerName", "init_define_process", "convertFloorStackIdToFacadeId", "floorStackId", "buildFacade", "v3", "geometryMaps", "v2", "v2FacadeCollection", "floorId", "v3Facades", "typedEntries", "v3Facade", "geometryIds", "facadeId", "geometryId", "init_define_process", "buildFloors", "v3", "_builderOptions", "floors", "maps", "floor", "init_define_process", "buildFloorImages", "v3", "geometryMaps", "v2", "v2FloorImages", "floorId", "v3FloorImageCollection", "typedEntries", "v2FloorImageCollection", "v3FloorImage", "geometryId", "rest", "anchorId", "feature", "init_define_process", "buildFloorStacks", "v3", "_builderOptions", "floorStacks", "floorStack", "v2FloorStack", "v2Outdoors", "init_define_process", "init_define_process", "import_polylabel", "calculateArea", "polygon", "coordinates", "area", "i", "pointInPolygon", "point", "x", "y", "inside", "j", "xi", "yi", "xj", "yj", "calculateCenterOfMass", "sumX", "sumY", "estimatePrecision", "f", "polygonArea", "safePolygonArea", "labelCenter", "centerCoords", "centerPt", "polylabel", "ok", "err", "isPolygonFeature", "feature", "buildGeometry", "v3", "geometryMaps", "nodesByGeometryId", "nodesById", "footprintGeometryIds", "calculateFootprintGeometry", "spaces", "obstructions", "areas", "windows", "floorId", "typedKeys", "floorFeatureCollection", "spaceFeatures", "obstructionFeatures", "areaFeatures", "windowFeatures", "id", "isFootprint", "nodes", "space", "buildSpace", "obstruction", "buildObstruction", "entranceNodeIds", "entranceNodes", "nodeId", "x", "node", "entranceSpace", "convertNodeToSpaceId", "toObstructionId", "area", "buildArea", "window", "buildWindow", "result", "labelCenter", "footprintComponent", "properties", "styles", "a", "init_define_process", "buildLocations", "v3", "geometryMaps", "geometryFeatureById", "v2", "v2Categories", "v3Category", "v2Category", "attachmentMaps", "buildLocationAttachmentMaps", "v2Locations", "v3Location", "v2Location", "geometryId", "floorId", "id", "maps", "annotations", "typedEntries", "annotation", "annotationId", "annotationIds", "connection", "isEntrance", "isLineDoor", "geometryAnchors", "anchor", "entranceIds", "connectionIds", "init_define_process", "buildManifest", "v3", "_builderOptions", "v2Manifest", "v2", "v3Manifest", "v3ManifestFeature", "properties", "v2ManifestFeature", "init_define_process", "buildNodes", "v3", "geometryMaps", "navigationFlags", "incomingEdgesByNodeId", "v2", "v2Nodes", "floorElevationById", "createFloorElevationById", "nodesByGeometryId", "createNodesByGeometryId", "connectionNeighborsByNodeId", "createConnectionNeighborsByNodeId", "floorId", "v3Nodes", "typedEntries", "v3node", "firstSpace", "externalId", "incomingEdges", "knownFlags", "declarations", "edge", "knownFlag", "hasFlag", "v2node", "id", "x", "n", "buildFlagsArray", "floor", "floorNodes", "node", "geometryId", "existingNodes", "connection", "exitNodes", "exit", "entrance", "entranceNodeIds", "entranceNode", "exitNode", "floorCost", "existingNeighbors", "flagDeclarations", "flags", "f", "declaration", "init_define_process", "groupGeometryByType", "geometryIds", "geometryByType", "grouped", "id", "type", "buildStyles", "v3", "geometryMaps", "v2", "styles", "spacesAndObstructions", "space", "obstruction", "geometryTypeById", "feature", "geometry", "groupId", "v3Style", "typedEntries", "anchor", "pointStyle", "lineStringStyle", "polygonStyle", "STANDARD_MVF_V3_PARSER", "createParser", "NavigationFlagsExtension", "NodesExtension", "ConnectionsExtension", "KindsExtension", "TraversabilityExtension", "DefaultStyleExtension", "FloorStackExtension", "OutdoorsExtension", "TilesetExtension", "FloorImagesExtension", "FacadeExtension", "AnnotationsExtension", "LocationsExtension", "CMSExtension", "convertUnzippedStandardMVFv3ToParsedMVFv2", "v3", "builderOptions", "buildBuilderOptions", "floors", "buildFloors", "geometry", "buildGeometry", "nodes", "buildNodes", "connections", "buildConnections", "styles", "buildStyles", "floorStacks", "buildFloorStacks", "floorImages", "buildFloorImages", "facade", "buildFacade", "annotations", "buildAnnotations", "locations", "buildLocations", "enterprise", "buildEnterprise", "manifest", "buildManifest", "extractAndConvertMVFv3UnsafeSync", "data", "result", "STANDARD_MVF_V3_PARSER", "ok", "convertUnzippedStandardMVFv3ToParsedMVFv2", "err", "init_define_process", "normalizeUrl", "url", "init_define_process", "DEFAULT_V6_URI", "DEFAULT_ENTERPRISE_AUTH_URL", "US_SELF_SERVE_ENV", "US_ENTERPRISE_ENV", "EU_ENV_ENTERPRISE", "US_STAGING_ENV", "US_SELF_SERVE_STAGING_ENV", "ENV_MAP", "getEnvironmentAuthState", "env", "init_define_process", "init_define_process", "fromNow", "expires", "currentTimestamp", "shouldRefreshToken", "bufferMinutes", "ACCESS_TOKEN_REFRESH_BUFFER_MINUTES", "ACCESS_TOKEN_REFRESH_BUFFER_MS", "ACCESS_TOKEN_STORAGE_KEY", "getAccessToken", "userOptions", "enterprise", "key", "safeStorage", "SafeStorage", "cachedTokens", "currentTimestamp", "shouldRefreshToken", "tokenData", "fetchAccessTokenEnterprise", "fetchAccessToken", "newTokens", "url", "DEFAULT_ENTERPRISE_AUTH_URL", "response", "isomorphicFetch", "error", "errorMessage", "normalizeUrl", "DEFAULT_V6_URI", "e", "init_define_process", "SAS_TOKEN_REFRESH_BUFFER_MINUTES", "SAS_TOKEN_REFRESH_BUFFER_MS", "SAS_TOKEN_STORAGE_KEY", "getSasToken", "userOptions", "accessToken", "key", "safeStorage", "SafeStorage", "cachedTokens", "shouldRefreshToken", "tokenData", "fetchSasToken", "newTokens", "url", "normalizeUrl", "DEFAULT_V6_URI", "response", "isomorphicFetch", "init_define_process", "u8", "u16", "u32", "fleb", "fdeb", "clim", "freb", "eb", "start", "b", "i", "r", "j", "_a", "fl", "revfl", "_b", "fd", "revfd", "rev", "x", "hMap", "cd", "mb", "s", "l", "le", "co", "rvb", "sv", "r_1", "v", "m", "flt", "fdt", "flrm", "hMap", "flt", "fdrm", "hMap", "fdt", "max", "a", "m", "i", "bits", "d", "p", "o", "bits16", "shft", "slc", "v", "s", "e", "u16", "u32", "u8", "ec", "err", "ind", "msg", "nt", "e", "inflt", "dat", "buf", "st", "sl", "u8", "noBuf", "noSt", "cbuf", "l", "bl", "nbuf", "final", "pos", "bt", "lm", "dm", "lbt", "dbt", "tbts", "bits", "type", "flrm", "fdrm", "hLit", "hcLen", "tl", "ldt", "clt", "i", "clim", "clb", "max", "clbmsk", "clm", "hMap", "r", "s", "c", "n", "lt", "dt", "shft", "t", "lms", "dms", "lpos", "bits16", "sym", "add", "b", "fleb", "fl", "d", "dsym", "fd", "fdeb", "end", "slc", "et", "u8", "b2", "d", "b", "b4", "b8", "inflateSync", "data", "out", "inflt", "td", "tds", "et", "dutf8", "d", "i", "c", "eb", "slc", "strFromU8", "dat", "latin1", "r", "i", "td", "_a", "dutf8", "out", "ext", "err", "slzh", "d", "b", "b2", "zh", "z", "fnl", "fn", "strFromU8", "es", "bs", "b4", "_a", "z64e", "sc", "su", "off", "b8", "unzipSync", "data", "opts", "files", "e", "b4", "err", "c", "b2", "o", "z", "ze", "fltr", "i", "_a", "zh", "c_2", "sc", "su", "fn", "no", "off", "b", "slzh", "inflateSync", "u8", "slc", "fetch", "version", "define_process_default", "isomorphicFetch", "defaultOptions", "parseOptions", "options", "_options", "version", "constructParamsForRequest", "url", "supplementary", "requestOptions", "headers", "req", "generateAPIRequest", "ret", "response", "isomorphicFetch", "getPerspectivesFromResponse", "res", "availablePerspectives", "Mappedin_Logger_default", "perspectives", "name", "perspective", "locale_packs", "getVenueMVFURL", "userOptions", "path", "parsedOptions", "_url", "localePacks", "requestedPerspective", "getDecoder", "decoder", "getLanguagePackUnitArray", "signal", "data", "parseLanguagePack", "raw", "unzipSync", "mvfData", "locationsRaw", "locationInstancesRaw", "categoryRaw", "downloadLanguagePack", "compressed", "e", "newError", "getMVFBundlePathAPIGateway", "mvfVersion", "useDraftData", "downloadVenueBundleMVFAPIGateway", "resolve", "reject", "downloadMVF", "userOptions", "accessToken", "resolve", "reject", "url", "getMakerBundleURL", "data", "isomorphicFetch", "res", "compressed", "e", "token", "normalizeUrl", "DEFAULT_V6_URI", "response", "parseMVF", "raw", "decoder", "decode", "mvfData", "annotationFiles", "file", "trimmedName", "spaceFiles", "obstructionFiles", "entranceFiles", "Mappedin_Logger_default", "validateStaticMVFFiles", "STATIC_MVF_FILES", "fileName", "unzipMVF", "decompressed", "unzipSync", "keys", "path", "createEnvControl", "environment", "authOption", "getState", "getAuthStateByEnvironment", "getEnvironmentAuthState", "userOption", "env", "isEnterprise", "state", "getBuildingIds", "mvf", "floorStacks", "floorStack", "unzipAndParseMVFv3ToMVFv2", "start", "maybeMvf", "extractAndConvertMVFv3UnsafeSync", "unzipAndParseMVFv2", "inputVersion", "init_define_process", "init_define_process", "init_define_process", "getCoord", "coord", "getCoords", "coords", "getGeom", "geojson", "getType", "_name", "booleanPointOnLine", "pt", "line", "options", "ptCoords", "getCoord", "lineCoords", "getCoords", "ignoreBoundary", "isPointOnLineSegment", "lineSegmentStart", "lineSegmentEnd", "excludeBoundary", "epsilon", "x", "y", "x1", "y1", "x2", "y2", "dxc", "dyc", "dxl", "dyl", "cross", "es_default", "init_define_process", "center", "geojson", "options", "ext", "es_default", "x", "y", "point", "init_define_process", "init_define_process", "distance", "from", "to", "options", "coordinates1", "getCoord", "coordinates2", "dLat", "degreesToRadians", "dLon", "lat1", "lat2", "a", "radiansToLength", "es_default", "length", "geojson", "options", "segmentReduce", "previousValue", "segment", "coords", "es_default", "init_define_process", "init_define_process", "init_define_process", "bearing", "start", "end", "options", "calculateFinalBearing", "coordinates1", "getCoord", "coordinates2", "lon1", "degreesToRadians", "lon2", "lat1", "lat2", "a", "b", "radiansToDegrees", "bear", "init_define_process", "destination", "origin", "distance", "bearing", "options", "coordinates1", "getCoord", "longitude1", "degreesToRadians", "latitude1", "bearingRad", "radians", "lengthToRadians", "latitude2", "longitude2", "lng", "radiansToDegrees", "lat", "point", "init_define_process", "init_define_process", "lineSegment", "geojson", "results", "flattenEach", "feature", "lineSegmentFeature", "featureCollection", "coords", "geometry", "getCoords", "coord", "segments", "createSegments", "segment", "properties", "previousCoords", "currentCoords", "lineString", "bbox", "coords1", "coords2", "x1", "y1", "x2", "y2", "west", "south", "east", "north", "es_default", "import_geojson_rbush", "lineIntersect", "line1", "line2", "unique", "results", "feature", "intersect", "intersects", "featureCollection", "tree", "rbush", "es_default", "featureEach", "segment", "match", "key", "getCoords", "coords1", "coords2", "x1", "y1", "x2", "y2", "x3", "y3", "x4", "y4", "denom", "numeA", "numeB", "uA", "uB", "y", "point", "nearestPointOnLine", "lines", "pt", "options", "closestPt", "point", "length", "flattenEach", "line", "coords", "getCoords", "i", "start", "es_default", "stop_1", "sectionLength", "heightDistance", "direction", "bearing", "perpendicularPt1", "destination", "perpendicularPt2", "intersect", "lineString", "intersectPt", "lineSlice", "startPt", "stopPt", "line", "coords", "getCoords", "getType", "startVertex", "es_default", "stopVertex", "ends", "clipCoords", "i", "lineString", "TURF_EPSILON", "point", "coords", "splitObstructionByEntrance", "wall", "entrance", "entranceCoords", "wallCoords", "entrancePoints", "c", "es_default", "acc", "wallCoord", "line1", "line2", "newWall", "length", "findAndSplitObstructionByAllEntrances", "entrances", "result", "options", "wallWithEntranceIndex", "wallWithEntrance", "firstWall", "secondWall", "init_define_process", "init_define_process", "init_define_process", "BaseMetaData", "id", "__publicField", "init_define_process", "init_define_process", "_Coordinate", "latitudeOrParams", "longitude", "floorId", "__publicField", "randomId", "instance", "coordinate", "Coordinate", "coordinate_default", "parseLocalePackToLanguagePack", "downloaded", "locationsById", "acc", "cur", "instance", "floorStacksById", "floorStack", "floorsById", "floor", "isMappedinCdnUrl", "url", "hasSasToken", "getCenterCoordinate", "mvfData", "floorId", "dataId", "Mappedin_Logger_default", "coordinate_default", "startLon", "startLat", "endLon", "endLat", "longitude", "latitude", "polygonFeature", "es_default", "e", "hasFlag", "withFlags", "flag", "_data", "_cache", "_floorId", "_mvfData", "_Node", "BaseMetaData", "data", "options", "__publicField", "__privateAdd", "__privateSet", "instance", "__privateGet", "id", "_floor", "getCenterCoordinate", "_neighbours", "neighbor", "_node", "flags", "flagsArray", "flagName", "flagDeclaration", "hasFlag", "key", "Node", "node_default", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "_cache", "_mvfData", "_Hyperlink", "BaseMetaData", "options", "randomId", "__publicField", "__privateAdd", "__privateSet", "instance", "__privateGet", "key", "Hyperlink", "hyperlink_default", "init_define_process", "init_define_process", "getId", "item", "isPosition", "thing", "PRECISION", "serializeCoords", "coordinates", "coord", "PROD_PUBLIC_CDN_REGEX", "STAGING_PUBLIC_CDN_REGEX", "isPublicCdnAsset", "url", "PROD_PRIV_CDN_REGEX", "STAGING_PRIV_CDN_REGEX", "isPrivateCdnAsset", "parseCdnAssetUrl", "protocol", "origin", "mapId", "fileName", "fileType", "computeTotalDistanceBetweenCoordinates", "acc", "c", "index", "equirectangularDistance", "_cache", "_mvfData", "_data", "_ImageMetaData", "BaseMetaData", "options", "randomId", "__publicField", "__privateAdd", "__privateSet", "instance", "url", "__privateGet", "parsed", "parseCdnAssetUrl", "mapId", "sasToken", "error", "Mappedin_Logger_default", "key", "ImageMetaData", "image_default", "init_define_process", "_geoJSONBoundingBox", "BaseMapData", "id", "_data", "__publicField", "__privateAdd", "__privateGet", "__privateSet", "es_default", "_data", "_mvfData", "_cache", "DetailedMapData", "BaseMapData", "data", "mvfData", "__privateAdd", "__privateSet", "__privateGet", "name", "profile", "description", "images", "image", "image_default", "links", "link", "hyperlink_default", "_data", "_floorId", "_cache", "_mvfData", "_Area", "DetailedMapData", "data", "options", "__publicField", "__privateAdd", "__privateSet", "instance", "__privateGet", "getCenterCoordinate", "_floor", "Area", "area_default", "init_define_process", "_data", "_cache", "_floorId", "_mvfData", "_Door", "DetailedMapData", "data", "options", "__publicField", "__privateAdd", "__privateSet", "instance", "_floor", "__privateGet", "getCenterCoordinate", "obstructionId", "key", "Door", "door_default", "init_define_process", "_data", "_floorId", "_cache", "_mvfData", "_Space", "DetailedMapData", "data", "options", "__publicField", "__privateAdd", "__privateSet", "instance", "validateSpaceType", "__privateGet", "enterpriseLocations", "enterpriseLocation", "location", "_floor", "entranceNodeIds", "nodeId", "door", "getCenterCoordinate", "key", "Space", "VALID_SPACE_TYPES", "input", "inputLowerCase", "space_default", "init_define_process", "_data", "_cache", "_mvfData", "_Floor_instances", "translate_fn", "_Floor", "BaseMapData", "data", "options", "__privateAdd", "__publicField", "__privateSet", "instance", "__privateGet", "name", "__privateMethod", "shortName", "subtitle", "spacesOnThisFloor", "space", "objectsOnThisFloor", "obstruction", "connectionsOnFloor", "connection", "doorsOnFloor", "door", "annotationsOnFloor", "annotation", "poisOnFloor", "poi", "floorStackForFloor", "floorStack", "getCenterCoordinate", "object", "key", "prop", "value", "Floor", "floor_default", "init_define_process", "init_define_process", "init_define_process", "getCoordinateFromStuffs", "thing", "coordinate", "space_default", "door_default", "object_default", "area_default", "facade_default", "poi_default", "annotation_default", "coordinate_default", "node_default", "location_default", "init_define_process", "init_define_process", "FLOOR_GAP_MULTIPLIER", "DEFAULT_MAP_OPTIONS", "EXTERIOR_WALLS_ID", "WALLS_ID", "ADD_MAP_FOCUS_ON_DURATION", "INTERIOR_DOORS_ID", "EXTERIOR_DOORS_ID", "GEOMETRY_LAYER", "LABELS_LAYER", "MARKERS_LAYER", "FOOTPRINT_LAYER", "OCCLUSION_LAYER", "AREAS_LAYER", "IMAGES_LAYER", "FACADES_LAYER", "PATHS_LAYER", "ENTERPRISE_API_AUDIENCE", "MAPPEDIN_COLORS", "PUBLIC_MAPVIEW_OPTIONS_SET", "PUBLIC_OUTDOOR_VIEW_OPTIONS_SET", "validateOptions", "options", "Mappedin_Logger_default", "handleShow3DMapOptionDefault", "mapData", "token", "stateWithDefault", "DEFAULT_MAP_OPTIONS", "handleTokenCapabilities", "capabilities", "decoded", "decodeAccessToken", "e", "getPublicOptions", "publicOptions", "key", "_data", "_cache", "_mvfDataByFloorId", "_Connection", "DetailedMapData", "data", "options", "singularData", "__publicField", "__privateAdd", "__privateSet", "instance", "__privateGet", "floorId", "mvfData", "getCenterCoordinate", "nodeId", "coordinate", "notNull", "profiles", "position", "latLonString", "serializeCoords", "mvfConnectionIds", "connectionId", "maybeProfiles", "floor", "key", "Connection", "connection_default", "init_define_process", "_data", "_floorId", "_cache", "_mvfData", "_MapObject", "DetailedMapData", "data", "options", "__publicField", "__privateAdd", "__privateSet", "instance", "objectKind", "__privateGet", "enterpriseLocations", "enterpriseLocation", "location", "_floor", "getCenterCoordinate", "key", "MapObject", "object_default", "init_define_process", "_data", "_floorId", "_cache", "_mvfData", "_PointOfInterest", "DetailedMapData", "data", "options", "__publicField", "__privateAdd", "__privateSet", "instance", "_floor", "__privateGet", "getCenterCoordinate", "key", "PointOfInterest", "poi_default", "init_define_process", "_data", "_floorId", "_cache", "_mvfData", "_Annotation_instances", "getGroupAndTypeFromSymbolId_fn", "_Annotation", "DetailedMapData", "data", "options", "__privateAdd", "__publicField", "__privateSet", "instance", "__privateMethod", "__privateGet", "getCenterCoordinate", "_floor", "key", "group", "type", "Annotation", "annotation_default", "init_define_process", "_data", "_cache", "_mvfData", "_facadeId", "_FloorStack_instances", "translate_fn", "_FloorStack", "BaseMapData", "data", "options", "__privateAdd", "__publicField", "__privateSet", "instance", "__privateGet", "name", "__privateMethod", "shortName", "floorsInStack", "acc", "floorId", "floor", "Mappedin_Logger_default", "a", "b", "defaultFloor", "prev", "curr", "key", "prop", "FloorStack", "floor_stack_default", "init_define_process", "_mvfData", "_data", "_floorStackId", "_cache", "_Facade", "BaseMapData", "data", "options", "__publicField", "__privateAdd", "__privateSet", "instance", "__privateGet", "facadeSpace", "space", "featureCollection", "mvfSpace", "MappedinError", "centerResult", "es_default", "coordinate_default", "Facade", "facade_default", "init_define_process", "OBSTRUCTION_KINDS_TO_SKIP", "SPACE_KINDS_TO_SKIP", "processMVFLocationProfilesAndCategories", "mvf", "data", "locationProfilesById", "locationCategoriesById", "locationCategoriesByParentId", "locationProfilesByExternalId", "locationProfilesByCategoryId", "locationProfilesByAttachedFeatureId", "locationProfile", "newLocationProfile", "location_profile_default", "categoryId", "attachedFeatures", "obstruction", "space", "annotation", "entrance", "area", "featureId", "locationCategory", "newLocationCategory", "location_category_default", "processMVFSpaces", "mvfConnectionsByNodeId", "spacesById", "spacesByExternalId", "poisById", "poisByExternalId", "objectEntranceNodeIdsByObstructionId", "mvfSpacesById", "mvfSpacesByFloorId", "mvfPoisByFloorId", "connectionIdsByLatLon", "connectionsById", "floorIdBySpaceId", "floorIdsWithSpaces", "floorId", "mvfSpaces", "shouldSkipSpace", "latLonString", "serializeCoords", "newPOI", "poi_default", "Mappedin_Logger_default", "newSpace", "space_default", "connectionIds", "mvfDataByFloorId", "connectionId", "mvfConnectionPointSpaceData", "mvfConnectionData", "newConnection", "connection_default", "processMVFNodes", "nodesById", "nodesByExternalId", "mvfNodesById", "mvfNodesByFloorId", "node", "newNode", "node_default", "processMVFObstructions", "objectsById", "objectsByExternalId", "mvfObstructionById", "obstructionIdByEntranceId", "floorIdsWithObstructions", "mvfObstructions", "newObject", "object_default", "processMVFFloors", "floorsById", "floorsByExternalId", "mvfFloorsById", "floor", "newFloor", "floor_default", "map", "processMVFFloorStacks", "floorStacksById", "floorStacksByExternalId", "mvfFloorStacksById", "facadesById", "facadesBySpaceId", "floorStacks", "floorStack", "facade", "newFloorStack", "floor_stack_default", "newFacade", "facade_default", "processMVFConnections", "mvfConnectionsById", "mvfConnectionIdsByLatLon", "acc", "connection", "nodeId", "firstNode", "processMVFEntrances", "doorsById", "doorsByExternalId", "doorsByNodeId", "mvfEntrancesById", "mvfEntrancesByFloorId", "floorIdsWithEntrances", "mvfEntrances", "newDoor", "door_default", "processMVFTextAreas", "obstructionsById", "mvfTextAreas", "feature", "anchoredTextArea", "polygonOrObstruction", "properties", "processMVFPolygonImages", "mvfMapImages", "anchoredImage", "processMVFEnterprisePolygonStyles", "styleMap", "styleId", "style", "anchor", "polygon", "processMVFEnterpriseTextures", "texture", "processMVFAnnotations", "annotationsById", "mvfAnnotationsById", "mvfAnnotationsByFloorId", "floorIdsWithAnnotations", "mvfAnnotations", "newAnnotation", "annotation_default", "processMVFAreas", "areasById", "areasByExternalId", "mvfAreasById", "floorIdsWithAreas", "mvfAreas", "newArea", "area_default", "processDestinationNodes", "entranceNodeIdsBySpaceId", "spaceIdsByNodeId", "objectIdsByNodeId", "destinationNodesIdsBySpaceId", "spaceId", "mvfSpace", "destinationNodes", "entranceNodes", "createEnterpriseDataFromMVF", "connectionsByExternalId", "locationsById", "locationsByExternalId", "mvfLocationsById", "location", "categoriesById", "categoriesByExternalId", "mvfCategoriesById", "mvfLocationsByGeometryId", "categoryIdsByLocationId", "locationIdsByNodeId", "venue", "locationInstancesById", "category", "newCategory", "category_default", "locationId", "locationInstancesByParentId", "locationInstance", "mvfLocation", "parentKeys", "keysObject", "key", "location_default", "newLocation", "mvfData", "mvfConnection", "connectionNode", "createDataFromMVF", "init_define_process", "skipProps", "_data", "_cache", "_mvfData", "_categoryIds", "_EnterpriseLocation", "BaseMetaData", "data", "options", "__publicField", "__privateAdd", "__privateSet", "prop", "parentLocation", "__privateGet", "instance", "id", "i", "space", "point", "spaces", "object", "key", "EnterpriseLocation", "location_default", "init_define_process", "skipProps", "_data", "_cache", "_mvfData", "_EnterpriseCategory", "BaseMetaData", "data", "options", "__publicField", "__privateAdd", "__privateSet", "prop", "__privateGet", "instance", "i", "space", "location", "key", "EnterpriseCategory", "category_default", "init_define_process", "skipProps", "_cache", "_mvfData", "_EnterpriseVenue", "BaseMetaData", "_data", "options", "__publicField", "__privateAdd", "__privateSet", "prop", "instance", "__privateGet", "key", "EnterpriseVenue", "venue_default", "init_define_process", "init_define_process", "deepMergeOn", "full", "partial", "idKeys", "result", "key", "partialValue", "typedKey", "keyPath", "findIdentifierKey", "fullObjectArray", "partialsById", "v", "getValueByKeyPath", "merged", "fullObject", "fullValue", "obj", "search", "current", "idKey", "value", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "ACTION_TYPE", "BEARING_TYPE", "CONNECTION_TYPE", "WALLS", "DOORS", "convertCoordinateToPosition", "coord", "getEntranceMap", "features", "feature", "properties", "id", "cutEntrancesFromLineStrings", "lineStrings", "entranceCollection", "entranceMap", "output", "result", "entrancesList", "acc", "name", "entrances", "obstructions", "findAndSplitObstructionByAllEntrances", "f", "differenceBetweenAngles", "a", "b", "getRelativeBearing", "relativeBearingAngle", "threshold", "relativeBearing", "extractStyleMap", "styles", "styleMap", "styleGroupId", "groupStyle", "polygonId", "lineId", "pointId", "groupGeometryByStyle", "features", "acc", "feature", "style", "newStyle", "translateToCoreStyle", "userOptions", "coreStyle", "shading", "wallTopColor", "getTargetID", "target", "api", "geometryLayer", "GEOMETRY_LAYER", "WALLS_ID", "EXTERIOR_WALLS_ID", "INTERIOR_DOORS_ID", "EXTERIOR_DOORS_ID", "tweenToPromise", "tween", "resolve", "getBoundingBox", "geometry", "es_default", "expandBbox", "bbox", "bboxToExpand", "getTargetFloorObject", "coordinate", "floorsById", "defaultFloor", "getAttachableGeometryId", "target", "space_default", "object_default", "shouldAnimatePathDrawing", "path", "mapData", "api", "isConnectionPath", "shouldAnimate", "fromFloor", "toFloor", "fromFloorState", "toFloorState", "floor", "generateImageId", "feature", "imageIdx", "pathSplit", "fileName", "decodedFileName", "cyrb53", "parseFloorGap", "floorGap", "height", "FLOOR_GAP_MULTIPLIER", "computeFloorAltitudes", "floors", "orderedFloors", "a", "b", "firstAboveGroundFloorIndex", "altitude", "result", "i", "curFloor", "nextFloor", "curElevation", "nextElevation", "gapsAfter", "missingToGround", "effectiveHeight", "baseAltitude", "norm", "lvl", "convertPanBoundsToCameraBounds", "panBounds", "convert3DMapPositionToCoordinate", "center", "coordinate_default", "BEARING_CHANGE_THRESHOLD", "_cache", "_mapData", "_directions", "_lastConnectionAction", "_lastConnection", "_lastMVFConnection", "_Directions_instances", "getActions_fn", "createConnectionAction_fn", "createTurnAction_fn", "Directions", "directions", "mapData", "departure", "destination", "options", "__privateAdd", "__publicField", "randomId", "__privateSet", "__privateGet", "direction", "feature", "coordinate_default", "acc", "instructions", "distance", "i", "prevDirection", "nextDirection", "coordinate", "actions", "__privateMethod", "action", "prevFloor", "floor", "nextFloor", "mvfConnection", "curConnection", "connectionValid", "connectionUnused", "prevMvfConnection", "prevConnection", "type", "fromFloor", "toFloor", "connection", "fromFloorElevation", "elevationDelta", "_connectionType", "exits", "exit", "relativeBearingAngle", "differenceBetweenAngles", "getRelativeBearing", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "Edge", "origin", "destination", "distance", "angle", "pathWeight", "multiplicativeDistanceWeightScaling", "__publicField", "init_define_process", "init_define_process", "init_define_process", "booleanPointInPolygon", "point", "polygon", "options", "pt", "getCoord", "geom", "getGeom", "type", "bbox", "polys", "inBBox", "insidePoly", "i", "inRing", "inHole", "k", "ring", "ignoreBoundary", "isInside", "j", "xi", "yi", "xj", "yj", "onBoundary", "intersect", "init_define_process", "init_define_process", "getAngle", "point1Lon", "point1Lat", "point2Lon", "point2Lat", "xDelta", "yDelta", "init_define_process", "init_define_process", "getLineIntersection", "line1Point1", "line1Point2", "line2Point1", "line2Point2", "lon1", "lat1", "lon2", "lat2", "lon3", "lat3", "lon4", "lat4", "denominator", "ua", "ub", "lat", "init_define_process", "getOffsetLine", "point1", "point2", "offset", "angle", "destinationPoint1", "destination", "destinationPoint2", "init_define_process", "radToDegNormalized", "radians", "degrees", "KM_PER_DEGREE_LAT", "hasLineOfSight", "originFeature", "destinationFeature", "edges", "bufferRadius", "isVisible", "origin", "destination", "angleLeft", "radToDegNormalized", "getAngle", "angleRight", "metersToDegreesLat", "metersToDegreesLon", "minX", "maxX", "minY", "maxY", "edge", "parallelLeft", "getOffsetLine", "parallelRight", "getLineIntersection", "DEFAULT_BUFFER_RADIUS", "_groupBy", "_NavigationGraph_instances", "filterValidNodes_fn", "createNodesById_fn", "removeInvalidNeighbors_fn", "initializeEdgesAndGroups_fn", "initializeSearch_fn", "isDestinationNode_fn", "reconstructPath_fn", "_getZonalCost", "NavigationGraph", "nodes", "groupBy", "multiplicativeDistanceWeightScaling", "__privateAdd", "__publicField", "origin", "destination", "edges", "bufferRadius", "hasLineOfSight", "node", "zones", "cost", "zone", "__privateGet", "booleanPointInPolygon", "__privateSet", "nodesList", "__privateMethod", "destinations", "result", "distance", "euclideanDistance", "originId", "maxTravelDistance", "includedNodeIds", "obstructionEdges", "useLineOfSight", "limitNumberOfResults", "frontier", "cameFrom", "costSoFar", "visited", "results", "a", "b", "current", "currentNode", "currentDistance", "edge", "neighbor", "newDistance", "newCost", "originIds", "destinationNodeIds", "disabledConnectionNodeIds", "overrideEdgeWeights", "disabledNodeIds", "origins", "edgeWeight", "nodeIds", "id", "options", "groupId", "pathWeight", "equirectangularDistance", "angle", "getAngle", "Edge", "priority", "currentId", "directions", "step", "init_define_process", "hasFlag", "flags", "index", "bit", "mask", "Navigator", "nodes", "geojsonCollection", "groupBy", "multiplicativeDistanceWeightScaling", "flagDeclarations", "__publicField", "steps", "destination", "path", "origin", "properties", "originId", "maxDistance", "floorId", "includedNodeIds", "useLineOfSight", "limitNumberOfResults", "bufferRadius", "point1", "point2", "equirectangularDistance", "getAngle", "NavigationGraph", "features", "feature", "coords", "groupId", "v", "i", "disabledNodeIds", "WELL_KNOWN_FLAGS", "nodeId", "hasFlag", "directionsZones", "originIds", "destinationNodeIds", "disabledConnectionNodeIds", "simplify", "overrideEdgeWeights", "simplifyEnabled", "zones", "DEFAULT_BUFFER_RADIUS", "processedSteps", "stepMapSegment", "edges", "finalStep", "finalGroupId", "finalEdges", "geometryEdges", "simpleSteps", "n", "m", "hasLineOfSight", "lastVisible", "Edge", "init_define_process", "findNearestOptions", "getOptions", "enterpriseMode", "featureNodeCache", "nearestNodeIdsSync", "feature", "mapData", "options", "id", "nearestNodeIds", "locationProfileNodeIdsSync", "target", "nodeIds", "navigationTarget", "result", "getNodesFromTargetSync", "locationProfileNodeIds", "getNodesFromTarget", "doorNodeIds", "nodeId", "areaNodeIds", "spaceNodeIds", "mvfSpace", "precomputedEntrances", "connectionNodeIdsSync", "coordinate", "nearest", "connectionNodeIds", "mapObjectNodeIds", "facadeNodeIds", "space", "node", "enterpriseLocationNodeIds", "location_profile_default", "annotation_default", "coordinate_default", "poi_default", "door_default", "area_default", "space_default", "connection_default", "object_default", "facade_default", "location_default", "node_default", "getDepartureFromDirections", "directions", "from", "featureToNodeIdsMap", "firstNodeId", "departure", "getDestinationFromDirections", "to", "lastNodeId", "destination", "_execDirections", "_setConnectionWeight", "DirectionsInternal", "nodes", "geojsonCollection", "connections", "groupBy", "multiplicativeDistanceWeightScaling", "flagDeclarations", "__publicField", "from", "to", "options", "mapData", "fromNodesByTarget", "toNodesByTarget", "target", "getNodesFromTarget", "originIds", "destinationNodeIds", "featureToNodeIdsMap", "earlyReturnNodeId", "__privateGet", "getNodesFromTargetSync", "__privateAdd", "disabledConnectionNodeIds", "nodeId", "overrideEdgeWeights", "connectionWeights", "connection", "connectionId", "directions", "zone", "departure", "getDepartureFromDirections", "destination", "getDestinationFromDirections", "makerDirections", "Directions", "accessible", "acc", "weight", "connectionNodeIds", "n", "sourceNode", "sourceEdges", "edge", "coordinate_default", "direction", "lastDirection", "coordinate", "angle", "distance", "Navigator", "nodeSpaceIdsSet", "nodeIds", "collection", "mapID", "obstructions", "feature", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "add_default", "d", "x", "y", "add", "tree", "parent", "node", "leaf", "x0", "y0", "x1", "y1", "xm", "ym", "xp", "yp", "right", "bottom", "i", "j", "addAll", "data", "xz", "yz", "init_define_process", "cover_default", "x", "y", "x0", "y0", "x1", "y1", "z", "node", "parent", "i", "init_define_process", "data_default", "data", "node", "init_define_process", "extent_default", "_", "init_define_process", "init_define_process", "quad_default", "node", "x0", "y0", "x1", "y1", "find_default", "x", "y", "radius", "data", "x0", "y0", "x1", "y1", "x2", "y2", "x3", "y3", "quads", "node", "q", "i", "quad_default", "xm", "ym", "dx", "dy", "d2", "d", "init_define_process", "remove_default", "d", "x", "y", "parent", "node", "retainer", "previous", "next", "x0", "y0", "x1", "y1", "xm", "ym", "right", "bottom", "i", "j", "removeAll", "data", "n", "init_define_process", "root_default", "init_define_process", "size_default", "size", "node", "init_define_process", "visit_default", "callback", "quads", "q", "node", "child", "x0", "y0", "x1", "y1", "quad_default", "xm", "ym", "init_define_process", "visitAfter_default", "callback", "quads", "next", "q", "quad_default", "node", "child", "x0", "y0", "x1", "y1", "xm", "ym", "init_define_process", "defaultX", "d", "x_default", "_", "init_define_process", "defaultY", "d", "y_default", "_", "quadtree", "nodes", "x", "y", "tree", "Quadtree", "defaultX", "defaultY", "x0", "y0", "x1", "y1", "leaf_copy", "leaf", "copy", "next", "treeProto", "node", "child", "i", "add_default", "addAll", "cover_default", "data_default", "extent_default", "find_default", "remove_default", "removeAll", "root_default", "size_default", "visit_default", "visitAfter_default", "x_default", "y_default", "init_define_process", "traverseQuadTree", "tree", "callback", "node", "x1", "y1", "x2", "y2", "extent", "quadrants", "i", "quadrant", "qx1", "qy1", "qx2", "qy2", "MAX_SEARCH_RADIUS_METERS", "LINE_OF_SIGHT_BUFFER_RADIUS", "INITIAL_SEARCH_RADIUS_METERS", "RADIUS_EXPANSION_FACTOR", "_queryTrees", "_maxSquareCache", "_QueryCache_instances", "findCandidatesInRadius_fn", "_mapDataInternal", "_projectOntoCartesianPlane", "QueryCache", "mapDataInternal", "projectOntoCartesianPlane", "__privateAdd", "__publicField", "type", "floorId", "maxSquareSize", "__privateGet", "tree", "x0", "y0", "x1", "y1", "width", "height", "__privateSet", "point", "mapName", "includedIds", "maxDistance", "lineOfSight", "limit", "processedNodeIds", "results", "currentRadius", "effectiveMaxDistance", "candidates", "__privateMethod", "a", "b", "candidate", "quadtree", "node", "targetsOnFloor", "space", "id", "radius", "x", "y", "xmin", "xmax", "ymin", "ymax", "traverseQuadTree", "x2", "y2", "quadIsOutsideRadius", "d", "distance", "equirectangularDistance", "z", "SEARCH_RADIUS_METERS", "METERS_PER_DEGREE_LAT", "DEFAULT_MAX_RESULTS", "SHOULD_USE_LINE_OF_SIGHT", "findNearestOptionsSchema", "z", "defaultOptions", "_mapDataInternal", "_cache", "_projectOntoCartesianPlane", "_Query_instances", "getFloorIds_fn", "_getAbsoluteDistance", "_getTravelDistance", "_getTravelDistanceSync", "Query", "mapDataInternal", "__privateAdd", "lon", "lat", "centerLon", "centerLat", "__privateGet", "metersPerDegreeLat", "metersPerDegreeLon", "x", "y", "__publicField", "origin", "include", "options", "parsedOptions", "error", "Mappedin_Logger_default", "coordinate", "getCoordinateFromStuffs", "floorIds", "__privateMethod", "results", "nodeToFeatureMap", "includedNodeIds", "feature", "targetNodeIds", "getNodesFromTargetSync", "targetNodeId", "a", "b", "includedFeatures", "types", "f", "floorId", "type", "nearestResults", "result", "node", "distanceToNode", "node_default", "n", "uniqueFeatureIds", "searchResults", "__privateSet", "QueryCache", "promises", "getNodesFromTarget", "fs", "floor", "elevation", "init_define_process", "init_define_process", "_mvfData", "OpeningHours", "mvfData", "__privateAdd", "__privateSet", "__privateGet", "_data", "_cache", "_mvfData", "_LocationProfile", "BaseMetaData", "data", "options", "__publicField", "__privateAdd", "__privateSet", "prop", "link", "hyperlink_default", "image", "image_default", "__privateGet", "instance", "i", "space", "point", "door", "uniqueConnections", "connectionGroupId", "mvfConnection", "nodes", "id", "node", "latLonString", "serializeCoords", "connections", "c", "connection", "annotation", "cId", "o", "a", "targets", "mapObject", "area", "OpeningHours", "LocationProfile", "location_profile_default", "init_define_process", "_data", "_cache", "_mvfData", "_LocationCategory", "BaseMetaData", "data", "options", "__publicField", "__privateAdd", "__privateSet", "prop", "__privateGet", "instance", "profiles", "profile", "locationProfile", "LocationCategory", "location_category_default", "_cache", "_MapDataInternal_instances", "getConnectionFromMVFConnection_fn", "_mapCenter", "_abortChangeLanguageControl", "MapDataInternal", "PubSub", "mvf", "options", "__privateAdd", "__publicField", "coordinate_default", "from", "to", "opt", "accessible", "multiDestination", "smoothingConfig", "getSmoothingConfig", "zones", "fromArray", "result", "destination", "toArray", "directions", "Mappedin_Logger_default", "e", "url", "isMappedinCdnUrl", "hasSasToken", "parsed", "parseCdnAssetUrl", "sasToken", "baseUrl", "env", "createEnvControl", "AnalyticsInternal", "tileset", "data", "createDataFromMVF", "shouldForceEnterpriseLocations", "enterpriseData", "createEnterpriseDataFromMVF", "venue_default", "allLocationsById", "locationId", "language", "localePack", "parseLocalePackToLanguagePack", "DirectionsInternal", "Query", "scope", "__privateGet", "__privateSet", "type", "id", "collections", "__privateMethod", "getItemFromCollection", "collection", "getItemFromAllCollections", "item", "externalId", "prop", "fallback", "code", "translated", "cacheKey", "cyrb53", "deepMergeOn", "preferredLanguage", "findPreferredLanguageInVenue", "languageCode", "update", "currentLanguageCode", "targetlanguage", "languagePack", "localePackUrl", "controller", "downloaded", "downloadLanguagePack", "fromCoord", "getCoordinateFromStuffs", "toCoord", "equirectangularDistance", "downloadLanguagePacks", "languagePacks", "getLanguagePackUnitArray", "parsedLocalePack", "parseLanguagePack", "key", "mvfConnection", "nodeId", "node", "latLon", "serializeCoords", "c", "getSmoothingConfig", "enterpriseMode", "opt", "defaultSmoothingEnabled", "smoothing", "smoothingEnabled", "smoothingRadius", "init_define_process", "init_define_process", "init_define_process", "cb", "start", "id", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "testMode", "enableTestMode", "isTestMode", "Renderer", "renderOptions", "__publicField", "Color", "event", "isTestMode", "WebGLRenderer", "e", "Mappedin_Logger_default", "scene", "sceneCamera", "l", "RENDER_LAYERS", "width", "height", "define_process_default", "color", "alpha", "init_define_process", "init_define_process", "worker_default", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "contains", "rect1", "rect2", "init_define_process", "intersectPoint", "rect1", "point", "tx", "ty", "init_define_process", "intersects", "rect1", "rect2", "x1", "y1", "x2", "y2", "x3", "y3", "x4", "y4", "init_define_process", "appendItems", "arr1", "arr2", "i", "init_define_process", "Rectangle", "x", "y", "w", "h", "userData", "__publicField", "rectangle", "contains", "intersects", "point", "intersectPoint", "context", "QuadTree", "_QuadTree", "boundary", "parent", "__publicField", "x", "y", "w", "h", "Rectangle", "rectangle", "result", "appendItems", "point", "context", "o", "init_define_process", "throttle", "func", "wait", "options", "context", "args", "result", "timeout", "previous", "later", "now", "remaining", "unpackMessage", "packedMessage", "colliders", "packedCollider", "bboxes", "bbox", "ALWAYS_VISIBLE_RANK_INDEX", "init_define_process", "STATIC_COLLIDER_INDEX", "padding", "OFFSCREEN_COLLIDER_BUFFER", "processColliders", "colliders", "totalWidth", "totalHeight", "watermarkWidth", "watermarkHeight", "watermarkPosition", "msgId", "minX", "minY", "maxX", "maxY", "leftScreenBoundary", "Rectangle", "topScreenBoundary", "rightScreenBoundary", "bottomScreenBoundary", "watermarkBoundary", "getWatermarkBoundary", "screenBoundColliders", "screenRectangle", "collider", "boundingBox", "boundingIndex", "i", "y1", "y2", "x1", "x2", "y11", "y21", "x11", "x21", "x", "y", "w", "h", "qTree", "QuadTree", "result", "staticColliderIndex", "idx", "minIntersectionsForCollider", "strategyIndex", "rectangle", "index", "rect", "intersections", "c", "ALWAYS_VISIBLE_RANK_INDEX", "init_define_process", "SyncWorker", "__publicField", "e", "unpacked", "unpackMessage", "processColliders", "DEBUG", "THROTTLE_TIME", "CollisionSystem", "PubSub", "debugCanvas", "coreState", "useWorker", "__publicField", "QuadTree", "Rectangle", "watermarkWidth", "watermarkHeight", "watermarkPosition", "isPanning", "staticColliders", "needsSort", "component", "entityId", "entity", "c", "a", "b", "currentIndex", "staticCollider", "STATIC_COLLIDER_INDEX", "componentIndex", "json", "ALWAYS_VISIBLE_RANK_INDEX", "e", "visibleColliders", "strategyIndex", "rectangle", "boundingRect", "canvasRect", "i", "SyncWorker", "collisionWorkerUrl", "worker_default", "throttle", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "Tap", "event", "__publicField", "TapsController", "tap", "timestamp", "init_define_process", "getUniqueIntersectedGroupContainers", "intersects", "groupContainers", "intersect", "object", "GroupContainerObject3D", "_animationFrame", "InteractionSystem", "PubSub", "container", "coreState", "camera", "worldPlane", "isUserInteracting", "__publicField", "Raycaster", "QuadTree", "Rectangle", "__privateAdd", "event", "__privateGet", "__privateSet", "TapsController", "Tap", "mouseDownStart", "Vector2", "takeIT", "interactionComponent", "point", "intersects", "worldPlaneIndex", "intersectedContainers", "getUniqueIntersectedGroupContainers", "e", "entity3D", "entity2D", "position", "groupContainers", "intersected", "isMouseDown", "isPanning", "cursor", "processCursor", "entity", "intersection", "entityId", "offsetX", "offsetY", "result", "r", "alwaysOnTopIntersects", "nonDepthTestIntersects", "filteredIntersects", "i", "intersect", "Mesh", "firstHit", "findModelParentEntity", "instanceIndex", "containerIntersects", "updateHover", "arraysEqual", "panel", "payload", "msg", "color", "div", "hover", "labelTextEntityId", "textEntity", "findModelParent", "object", "itr", "Scene", "map", "found", "init_define_process", "init_define_process", "_glTFExporter", "_state", "_getExportedScene", "_ExporterSystem_instances", "getGLTFExporter_fn", "_processObject3D", "_createStandardMaterial", "processBatchedMesh_fn", "processLineSegments_fn", "_convertGeometry", "_convertAttributes", "_convertVector", "_convertObjectProperties", "_convertUVs", "ExporterSystem", "state", "__privateAdd", "__publicField", "userOptions", "options", "gltfExporter", "__privateMethod", "newScene", "__privateGet", "gltf", "blob", "output", "scale", "light", "onlyVisible", "Scene", "bbox", "Box3", "directionalLight", "DirectionalLight", "object", "BatchedMesh", "mesh", "LineSegments", "child", "color", "opacity", "transparent", "newMaterial", "MeshStandardMaterial", "Color", "geometry", "material", "position", "rotation", "quaternion", "positionAttribute", "normalAttribute", "uvAttribute", "DoubleSide", "vertex", "Vector3", "normal", "vector", "tempY", "tempPosY", "tempScaleY", "Euler", "tempQuatY", "i", "u", "v", "__privateSet", "GLTFExporter", "batchedMesh", "result", "entities", "id", "colorMap", "entity", "Geometry3D", "style", "interaction", "StyleComponent", "Text3DStyleComponent", "ModelStyleComponnet", "key", "visible", "geometries", "acc", "BufferGeometry", "mergedGeometry", "mergeGeometries", "mergedMesh", "Mesh", "MeshBasicMaterial", "clone", "init_define_process", "init_define_process", "DEFAULT_COLOR", "DEFAULT_HEIGHT", "OFFSET_QUALITY", "offsetter", "ClipperLib_default", "offset", "vertices", "paths", "v", "offsettedPaths", "p", "renderPolygonGeometry", "feature", "convertTo3DMapPosition", "style", "color", "opacity", "altitude", "height", "boundingBox", "clippedCoordinates", "coordinate", "coord", "geometries", "polygon", "shape", "Shape", "holes", "hole", "cartesianCoordinates", "path", "Path", "extrudeSettings", "createExtrudeSettings", "geometry", "ExtrudeGeometry", "mergedGeometry", "mergeGeometries", "init_define_process", "DEFAULT_COLOR", "DEFAULT_HEIGHT", "renderMultiPolygonGeometry", "feature", "convertTo3DMapPosition", "style", "color", "opacity", "altitude", "height", "boundingBox", "extrudeSettings", "createExtrudeSettings", "geometries", "coordinates", "shape", "Shape", "cartesianCoordinates", "coordinate", "coord", "holes", "hole", "path", "Path", "geometry", "ExtrudeGeometry", "mergeGeometries", "geom", "init_define_process", "QUALITY", "DEFAULT_WALL_WIDTH", "DEFAULT_WALL_HEIGHT", "renderMultiLineStringGeometry", "feature", "convertTo3DMapPosition", "style", "width", "height", "color", "opacity", "altitude", "boundingBox", "extrudeSettings", "offsetter", "ClipperLib_default", "cartesianCoordinates", "coordinate", "v", "c", "polygons", "geometries", "polygon", "shape", "Shape", "coords", "coord", "h", "path", "Path", "ExtrudeGeometry", "geometry", "mergeGeometries", "init_define_process", "init_define_process", "z", "geoJSONPoint", "z", "modelPropertiesSchema", "z", "featureSchema", "geoJSONPoint", "addModelFeatureSchema", "MaterialStyleSchema", "modelGroupStyleSchema", "validateModelGroup", "id", "geometry", "style", "_visible", "_altitude", "_opacity", "_renderOrder", "_visibleThroughGeometry", "ModelComponent", "feature", "__publicField", "__privateAdd", "Color", "Vector3", "RENDER_LAYERS", "__privateGet", "value", "__privateSet", "MathUtils", "InstancedMesh", "child", "targetOpacity", "interpolate", "Mesh", "material", "updateMaterialOpacity", "opacity", "init_define_process", "applyModelGeometryStyle", "model", "modelComp", "styleComponent", "materialStyle", "color", "materialState", "consolidateColorAndMaterial", "child", "Mesh", "material", "meshPositionZOffset", "targetAltitude", "materialOverwrite", "update", "name", "defaultMaterials", "materialName", "applyModelPosition", "convertTo3DMapPosition", "verticalOffset", "position", "getMaterial", "meshComponent", "MeshComponent", "getMaterialSide", "BackSide", "FrontSide", "setMaterialSide", "side", "DoubleSide", "generateIndex", "style", "color", "opacity", "topColor", "texture", "topTexture", "MeshCreationAndOptimizationSystem", "PubSub", "state", "convertTo3DMapPosition", "__publicField", "GLTFLoader", "id", "feature", "meshComponent", "MeshComponent", "featureBevel", "styleBevel", "mergedBevel", "entity", "Geometry3D", "StyleComponent", "OutlineComponent", "darkenColorForOutline", "FocusableComponent", "TextureComponent", "t", "ModelComponent", "initStyle", "modelStyle", "ModelStyleComponnet", "geometry", "entities", "url", "tree", "matrix", "Matrix4", "rotation", "Euler", "quaternion", "Quaternion", "scale", "Vector3", "object", "Geometry3DObject3D", "loader", "promise", "resolve", "processGLTF", "gltf", "child", "gltfChild", "mesh", "InstancedMesh", "gltfText", "idx", "entityId", "modelComponent", "styleComponent", "applyModelGeometryStyle", "x", "y", "MathUtils", "DEFAULT_ROTATION", "DEFAULT_SCALE", "renderPolygonGeometry", "updateUVsLegacy", "renderMultiPolygonGeometry", "renderLineStringGeometry", "renderMultiLineStringGeometry", "GeometryGroupObject3D", "e", "Mappedin_Logger_default", "childEntity", "index", "component", "indexString", "batchGeometries", "entity2D", "init_define_process", "DOMVisibilitySystem", "state", "domTree", "__publicField", "entity", "child", "component", "entityId", "MarkerComponent", "init_define_process", "TwoDProjectionSystem", "state", "project", "__publicField", "entity", "height", "altitude", "attachedEntityStyle", "component", "entityId", "attachedEntity", "Geometry3D", "shouldBeVisible", "init_define_process", "init_define_process", "init_define_process", "getMeasureCanvas", "measureCanvas", "measureCanvasContext", "pixelRatio", "shaveText", "text", "size", "maxWidth", "maxLines", "lineHeight", "options", "font", "lines", "words", "linePtr", "wordPtr", "maxTextWidth", "word", "width", "l", "lineHeightPx", "maxHeight", "context", "x", "y", "init_define_process", "createImage", "icon", "img", "TwoDDrawSystem", "PubSub", "state", "colliderCanvas", "transformImageRequest", "__publicField", "url", "zoomLevel", "pixelRatio", "labelCacheId", "foregroundColor", "backgroundColor", "pinSize", "iconVisible", "component", "entity", "entityId", "label_default", "shouldBeVisible", "round", "textDrawFn", "width", "height", "textAlign", "iconScale", "on", "input", "output", "easing", "interpolateMulti", "Mappedin_Logger_default", "text", "size", "maxWidth", "maxLines", "lineHeight", "draw", "shaveText", "cacheCanvas", "bboxWidth", "bboxHeight", "shouldDisableOffscreenCanvas", "ctx", "strokeSize", "xOffset", "label", "imageHash", "cyrb53", "resolve", "res", "img", "createImage", "maxIconScale", "canvasSize", "cacheCanvasContext", "context", "scales", "maxScale", "activeContext", "inactiveContext", "dpX", "dpY", "imageToDraw", "drawSize", "circleDiameter", "iconFit", "scaledWidth", "scaledHeight", "iconFitCache", "imgWidth", "imgHeight", "imgDiagonal", "scale", "scaleByWidth", "scaleByHeight", "init_define_process", "processColor", "entity", "globalHoverColor", "interactionComponent", "styleComponent", "DrawSystem", "state", "convertTo3DMapPosition", "__publicField", "meshComponent", "textureComponent", "material", "getMaterial", "component", "entityId", "color", "MeshComponent", "textEntity", "opacity", "getGroupContainerOpacity", "getMaterialSide", "setMaterialSide", "TextureComponent", "applyModelGeometryStyle", "applyModelPosition", "styleComp", "textMesh", "hoverColor", "DEFAULT_TEXT_STYLE", "init_define_process", "TwoDVisibilitySystem", "PubSub", "state", "__publicField", "entity", "component", "entityId", "label_default", "frameTime", "startingOpacity", "endOpacity", "duration", "percentComplete", "interpolate", "linearEase", "easeIn", "init_define_process", "RenderSystem", "PubSub", "renderer", "state", "mode", "scene", "cameraObject", "viewCamera", "systems", "__publicField", "sync", "promise", "res", "rej", "error", "promises", "populateGeometry2DIdsInScene", "populateGeometry3DIdsInScene", "meshOptimizePromise", "needs2DRecompute", "e", "init_define_process", "z", "addPathOptionsSchema", "z", "featureSchema", "geoJSONPoint", "validatePath", "geometry", "options", "_altitude", "PathComponent", "feature", "__publicField", "Geometry3DObject3D", "Vector3", "__privateAdd", "visible", "__privateGet", "value", "__privateSet", "init_define_process", "init_define_process", "init_define_process", "Easing", "amount", "s", "power", "now", "Group", "tweens", "_i", "_this", "tweenId", "_a", "_b", "tweens_1", "tween", "tweens_2", "time", "preserve", "tweenIds", "i", "autoStart", "Interpolation", "v", "k", "m", "f", "fn", "b", "pw", "bn", "p0", "p1", "n", "fc", "a", "p2", "p3", "t", "v0", "v1", "t2", "t3", "Sequence", "mainGroup", "Tween", "object", "group", "target", "duration", "dynamic", "overrideStartingValues", "property", "tmp", "prop", "_object", "_valuesStart", "_valuesEnd", "_valuesStartRepeat", "startValue", "startValueIsArray", "propType", "isInterpolationList", "endValues", "temp", "l", "value", "nestedObject", "numChainedTweens", "times", "yoyo", "easingFunction", "interpolationFunction", "callback", "elapsedTime", "durationAndDelay", "totalTime", "calculateElapsedPortion", "timesRepeated", "timeIntoCurrentRepeat", "portion", "elapsed", "completeCount", "start", "end", "startIsArray", "endIsArray", "endValue", "nextId", "Sequence", "TWEEN", "mainGroup", "getAll", "removeAll", "add", "remove", "update", "init_define_process", "init_define_process", "init_define_process", "differenceBetweenAngles", "a", "b", "getTouchPos", "touch", "origin", "Vector2", "angle", "first", "second", "distance", "average", "getScrollDelta", "event", "delta", "wheelDelta", "detail", "InputSet", "input1", "input2", "__publicField", "angle", "distance", "newDistance", "newAngle", "average", "init_define_process", "TouchAnchor", "touch", "camera", "cameraPlane", "__publicField", "coordinateVector", "Vector2", "Raycaster", "point", "coord", "intersection", "constants_exports", "__export", "BLOCK_MERCATOR_ZOOM_LEVEL", "CLIPPING_RADIUS", "CONTROL_OPTIONS", "DEFAULT_ANIMATION_DURATION", "DEFAULT_BEARING", "DEFAULT_MAX_ZOOM_LEVEL", "DEFAULT_MIN_ZOOM_LEVEL", "DEFAULT_PITCH", "DEFAULT_ZOOM_LEVEL", "EVENTS", "MAPLIBRE_TILE_SIZE", "MAX_LAT", "MAX_MERCATOR_ZOOM_LEVEL", "MIN_LAT", "MIN_MERCATOR_ZOOM_LEVEL", "ROOM_MERCATOR_ZOOM_LEVEL", "TWO_PI", "WHEEL_ZOOM_MULTIPLIER", "ZRANGE", "init_define_process", "DEBUG_CAMERA_PLANE", "DEBUG_FOCUS_ON", "_defaultMinZoomLevel", "CameraSystem", "PubSub", "camera", "scene", "renderer", "rendererState", "options", "__publicField", "__privateAdd", "DEFAULT_MIN_ZOOM_LEVEL", "Vector3", "MOUSE", "Raycaster", "Clock", "Vector2", "pos", "intersection", "right", "down", "x", "y", "dx", "dy", "targetDistanceFromBounds", "angle", "target", "radians", "newTilt", "duration", "curve", "callback", "zoom", "tweensArray", "lastTween", "cancelledCallback", "_options", "tweenStart", "tweenEnd", "position", "start", "end", "shortestTweenRotation", "zooming", "rotating", "tilting", "tween", "Tween", "define_process_default", "between", "wait", "Easing", "rotation", "tilt", "publishChangeEvent", "positionUpdated", "payload", "targetZoom", "CLIPPING_RADIUS", "ZRANGE", "min", "silent", "newRotation", "TWO_PI", "z", "zoomLevel", "elevation", "zoomDelta", "newZoom", "FOV", "canvasHeight", "getProjectionScaleFactor", "emitEvent", "emitCameraStateChanged", "eventName", "EVENTS", "size", "DEBUG_CAMERA_PLANE", "segments", "planeGeometry", "PlaneGeometry", "cameraPlaneMaterial", "MeshBasicMaterial", "cameraPlane", "Mesh", "domElement", "event", "InputSet", "prevFirst", "prevSecond", "first", "second", "movingUp", "movingDown", "vectorToCast", "TouchAnchor", "newMatrix", "currentZoom", "getScrollDelta", "WHEEL_ZOOM_MULTIPLIER", "zoomPercent", "transform", "newAngle", "Euler", "vectorToGround", "groundPosition", "touchAnchor1", "touchAnchor2", "p", "w1", "w2", "nw1", "nw2", "s1", "s2", "xd1", "yd1", "angle1", "xd2", "yd2", "angle2", "zAngleDelta", "differenceBetweenAngles", "yawAdjustment", "Matrix4", "t", "m", "o", "a", "b", "x1", "y1", "z1", "c1", "x2", "y2", "z2", "c2", "x3", "y3", "z3", "c3", "xb", "yb", "zb", "cb", "dx1", "dy1", "dz1", "dx2", "dy2", "dz2", "dx3", "dy3", "dz3", "dx4", "dy4", "dz4", "min1", "min2", "x4", "y4", "c4", "x5", "y5", "c5", "y6", "z6", "c6", "y7", "z7", "finalTransformMatrix", "touchOriginElement", "i", "iLen", "touch", "getTouchPos", "delta", "newZ", "debounce", "altitude", "lat", "metersPerPixel", "mapPixelWidthAtZoom", "MathUtils", "EARTH_RADIUS_M", "MIN_MERCATOR_ZOOM_LEVEL", "MAX_MERCATOR_ZOOM_LEVEL", "Object3D", "__privateGet", "max", "pedestal", "v", "lon", "cartesianToGeographic", "longitude", "latitude", "geographicToCartesian", "value", "pointCloud", "minZoom", "maxZoom", "canvasWidth", "currentRotation", "currentTilt", "frame", "getCameraFrameForPoints", "DEBUG_FOCUS_ON", "destroyObject3D", "geometry", "BoxGeometry", "material", "instancedMesh", "InstancedMesh", "matrix", "point", "index", "DEFAULT_ANIMATION_DURATION", "padding", "currentRotaion", "constrainedZoom", "constrainedScale", "constrainedLatitude", "MIN_LAT", "MAX_LAT", "worldSize", "getCameraFrameForPoints", "pointCloud", "canvasWidth", "orbit", "paddingOption", "verticalPadding", "canvasHeight", "minZoom", "maxZoom", "camera", "position", "results", "side", "CameraSystem", "padding", "camMatrixWorldInverse", "halfFOV", "yFov", "xFov", "min", "Vector3", "max", "originalBbox", "Box3", "point", "i", "iLen", "originalBoundsWidth", "originalBoundsHeight", "containmentWidth", "containmentHeight", "originalBoundsCenterX", "originalBoundsCenterY", "widthRatio", "heightRatio", "minZoomDistance", "maxZoomDistance", "minBoundsWidth", "maxBoundsWidth", "minimumScaleRatio", "maximumScaleRatio", "scaleRatio", "MathUtils", "paddedBoundsWidth", "paddedBoundsHeight", "boundsForScreen", "centerX", "centerY", "center", "deltaX", "deltaY", "distanceX", "distanceY", "cameraTarget", "cameraAnchor", "direction", "distanceToZPlane", "nextPoint", "init_define_process", "ANIMATION_DURATION", "_colliderWorldPosition", "_cameraWorldPosition", "DOMDrawSystem", "state", "__publicField", "__privateAdd", "Vector3", "isUserInteracting", "entity", "component", "__privateGet", "entityId", "distanceFromCamera", "init_define_process", "DOMResizeSystem", "PubSub", "state", "domTree", "__publicField", "mutations", "mutation", "id", "entity", "component", "MarkerComponent", "resizeObserver", "child", "init_define_process", "defaultMinPitch", "defaultMaxPitch", "DEBUG_FOCUSON_BOUNDS", "define_process_default", "ANIMATION_TWEENS", "Easing", "MAX_UNDERGROUND_DEPTH", "_core", "_systems", "_state", "_elevationAnimation", "_Camera_instances", "convertToLegacy_fn", "Camera", "core", "systems", "state", "__privateAdd", "__privateSet", "__privateGet", "elevation", "center", "zoomLevel", "clampWithWarning", "value", "disableAutoMinZoomLevel", "targetMinZoom", "constants_exports", "targetMaxZoom", "MathUtils", "pitch", "targetMinPitch", "targetMaxPitch", "bearing", "options", "resolve", "panMode", "padding", "position", "zoom", "rotation", "tilt", "coordinates", "_options", "__privateMethod", "pointCloud", "processTargets", "Mappedin_Logger_default", "target", "geoBounds", "firstPosition", "drawBounds", "DEFAULT_INSET_PADDING", "updateBounds", "bounds", "coord", "targets", "geometry3DMap", "renderSystem", "entity", "boundingBox", "Box3", "getVerticesOfEntity", "GroupContainerObject3D", "min", "max", "Vector3", "boundsCoordinates", "init_define_process", "init_define_process", "watermark_vertex_default", "init_define_process", "watermark_fragment_default", "init_define_process", "WATERMARK_LOGO_ASPECT_RATIO", "WATERMARK_ICON_MIN_WIDTH", "WATERMARK_ICON_DEFAULT_WIDTH", "WATERMARK_ICON_ASPECT_RATIO", "init_define_process", "ICON_NAMES", "ICONS", "regex", "getLogoIcon", "iconName", "color", "width", "height", "icon", "init_define_process", "_TextureLoaderSingleton", "__publicField", "TextureLoader", "url", "resolve", "reject", "TextureLoaderSingleton", "DEBUG", "_options", "_rendererState", "_cameraObject", "_mesh", "_material", "_collider", "_width", "_height", "WatermarkSystem", "PubSub", "cameraObject", "rendererState", "options", "__privateAdd", "__publicField", "canvasWidth", "canvasHeight", "__privateGet", "padding", "paddings", "key", "value", "__privateSet", "WATERMARK_ICON_MIN_WIDTH", "WATERMARK_ICON_DEFAULT_WIDTH", "WATERMARK_ICON_ASPECT_RATIO", "WATERMARK_LOGO_ASPECT_RATIO", "getLogoIcon", "w", "h", "x", "y", "width", "height", "quadTree", "canvasPosition", "offset", "Rectangle", "TextureLoader", "imageData", "ShaderMaterial", "Vector4", "watermark_vertex_default", "watermark_fragment_default", "planeGeometry", "PlaneGeometry", "Mesh", "box", "BoxGeometry", "mesh", "MeshBasicMaterial", "destroyObject3D", "init_define_process", "PAN_BOUNDS_MARGIN", "DEBUG", "PanBoundsSystem", "PubSub", "state", "cameraSystem", "__publicField", "Box3", "Vector3", "box", "boxSize", "maxDimention", "entity", "radius", "expandedByPaddingBox", "expandedByPaddingSphere", "Scene", "Object3D", "Mesh", "SphereGeometry", "MeshBasicMaterial", "size", "boxGeometry", "BoxGeometry", "boxMaterial", "Sphere", "init_define_process", "MAPPEDIN_ATTRIBUTION", "FEEDBACK_LINK", "ATTRIBUTION_POSITIONS", "MAX_COMPACT_CANVAS_WIDTH", "getAttributionButtonIcon", "DEFAULT_ATTRIB_OPTIONS", "_outdoorEnabled", "HTMLControlsSystem", "container", "options", "__publicField", "__privateAdd", "e", "__privateSet", "a", "v", "el", "position", "__privateGet", "map", "attributions", "sourceCaches", "id", "sourceCache", "source", "attrib", "j", "combinedAttributions", "canvasWidth", "init_define_process", "_opacity", "_altitude", "CustomGeometryComponent", "feature", "builder", "__publicField", "__privateAdd", "Color", "Geometry3DObject3D", "value", "__privateSet", "__privateGet", "color", "init_define_process", "CustomGeometrySystem", "state", "convertTo3DMapPosition", "__publicField", "component", "style", "entityId", "entity", "child", "init_define_process", "init_define_process", "hasOutline", "entity", "child", "needsOutline", "entity", "state", "firstChildId", "updateBufferGeometryHeight", "bufferGeometry", "ranges", "height", "altitude", "positions", "maxZ", "i", "baseIndex", "z", "init_define_process", "extractBufferGeometryFromBatchedGeometry", "meshComponent", "bufferGeometry", "BufferGeometry", "originalGeometry", "range", "start", "count", "originalPosition", "extractedPositions", "i", "sourceIndex", "BufferAttribute", "originalNormal", "extractedNormals", "originalUV", "extractedUVs", "originalIndex", "extractedIndices", "transferGeometryToNewBatchedMesh", "newBatchedMesh", "matrix", "instance", "geometryId", "init_define_process", "init_define_process", "outline_vertex_default", "init_define_process", "outline_fragment_default", "OutlineLineMaterial", "LineBasicMaterial", "parameters", "shader", "outline_vertex_default", "outline_fragment_default", "init_define_process", "_queue", "_isProcessing", "_onCompleteCallback", "_currentCallbackId", "_IdleQueue_instances", "processQueue_fn", "IdleQueue", "__privateAdd", "__privateGet", "callback", "__privateMethod", "__privateSet", "deadline", "processedCount", "GEOMETRY_OUTLINE_THRESHOLD", "_geometries3DDirty", "_lastOpacity", "_mergedGeometries", "_material", "_publishRender", "OutlineInterpolationSystem", "PubSub", "rendererState", "__publicField", "__privateAdd", "IdleQueue", "OutlineLineMaterial", "FrontSide", "__privateGet", "value", "__privateSet", "geometryGroupEntity", "edgeGeometries", "childEntityId", "childGeometry3DEntity", "Geometry3D", "geometry", "needsDisposal", "extractBufferGeometryFromBatchedGeometry", "style", "EdgesGeometry", "mergedGeometry", "mergeGeometries", "e", "edgePositions", "edgeColors", "colorBuffer", "BufferAttribute", "edgeVisibility", "visibilityBuffer", "currentStart", "i", "outlineComponent", "individualGeometry", "vertexCount", "outline", "LineSegments", "zoomLevel", "isCameraZoomDirty", "entityId", "GeometryGroupObject3D", "needsOutline", "hasOutline", "entity", "outlineMergedGeometry", "visible", "color", "Color", "vertexIndex", "height", "altitude", "updateBufferGeometryHeight", "outlineOpacity", "interpolate", "MeshComponent", "targetOpacity", "getGroupContainerOpacity", "init_define_process", "init_define_process", "z", "EntityMesh", "Mesh", "__publicField", "addImageFeatureStyleSchema", "z", "addImageFeatureSchema", "geoJSONPoint", "validateImage", "id", "feature", "style", "ImageComponent", "Geometry3DObject3D", "Vector3", "visible", "init_define_process", "rotatePoint", "point", "angleRad", "rotatePoints", "points", "p", "getBounds", "minX", "minY", "maxX", "maxY", "pointInPolygon", "polygon", "inside", "i", "j", "xi", "yi", "xj", "yj", "isValidRectangle", "grid", "x", "y", "width", "height", "dy", "dx", "calculateGridDimensions", "bounds", "aspectRatio", "gridSize", "boxWidth", "boxHeight", "gridBounds", "createAndFillGrid", "rotatedPoints", "testPoint", "calculateRectSizes", "rectSizes", "maxSize", "size", "calculatePolygonCenter", "totalWeight", "weightedSumX", "weightedSumY", "weight", "px", "py", "findBestRectangle", "polygonCenter", "centerWeight", "buffer", "maxScore", "bestRect", "maxDistance", "w", "h", "area", "centerX", "centerY", "centerPoint", "normalizedDistance", "score", "findLargestInteriorRectangle", "originalRect", "preferredRotation", "options", "scaleFactor", "centerPriority", "resolution", "minimumSizeRatio", "rotationRad", "toRadians", "TWO_PI", "HALF_PI", "ONE_AND_A_HALF_PI", "ROUNDED_HALF_PI", "round", "ROUNDED_ONE_AND_A_HALF_PI", "DEFAULT_VERTICAL_OFFSET", "SHOW_DEBUG_IMAGE_CONTAINERS", "ImageSystem", "PubSub", "rendererState", "convertTo3DMapPosition", "projectToScreen", "initialBearing", "naturalBearing", "imagePlacementOptions", "__publicField", "Frustum", "Matrix4", "entityId", "url", "polygonImage", "verticalOffset", "position", "polygonPoints", "originalRectangle", "imagePlacementMode", "rectangle", "bearingDiff", "findLargestInteriorRectangle", "debugCenter", "Mesh", "SphereGeometry", "MeshLambertMaterial", "material", "DoubleSide", "geo", "PlaneGeometry", "imageMesh", "EntityMesh", "RENDER_LAYERS", "texture", "SRGBColorSpace", "containerMesh", "axisHelper", "AxesHelper", "MathUtils", "promise", "resolve", "TextureLoader", "state", "meshComponent", "cameraRotationRadians", "normalizedCameraRotation", "imageRotation", "angle", "entity", "styleComponent", "point", "pos", "points", "coord", "mesh", "bbox", "worldPosition", "Vector3", "centerScreen", "Vector2", "corners", "screenCorners", "corner", "worldCorner", "screenCorner", "minX", "minY", "maxX", "maxY", "Rectangle", "init_define_process", "CAMERA_MOVE_BUFFER_THRESHOLD_MS", "_animationFrame", "GeometryInFocusSystem", "PubSub", "state", "camera", "__publicField", "__privateAdd", "cameraIsMoving", "cameraStoppedMovingTime", "__privateGet", "__privateSet", "center", "Vector2", "topLeft", "topRight", "bottomLeft", "bottomRight", "centerTop", "centerBottom", "coordXY", "idx", "el", "_x", "_y", "coordinateVector", "raycaster", "Raycaster", "meshComponent", "focusableComponent", "entity", "entityId", "FocusableComponent", "destroyObject3D", "box", "Box3", "width", "height", "depth", "geometry", "BoxGeometry", "matProperties", "colors", "material", "MeshBasicMaterial", "focusMesh", "Mesh", "MeshComponent", "_", "weight", "collision", "currentWeight", "sortedEntities", "a", "b", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "es_default", "poly", "options", "geom", "getGeom", "polygonToLine", "multiPolygonToLine", "coords", "properties", "coordsToLine", "multiPoly", "lines", "coord", "featureCollection", "multiLineString", "lineString", "booleanDisjoint", "feature1", "feature2", "bool", "flattenEach", "flatten1", "flatten2", "disjoint", "geom1", "geom2", "compareCoords", "isPointOnLine", "booleanPointInPolygon", "isLineOnLine", "isLineInPoly", "isPolyInPoly", "lineString", "pt", "i", "isPointOnLineSegment", "lineString1", "lineString2", "doLinesIntersect", "es_default", "polygon", "_i", "_a", "coord", "coord1", "_b", "_c", "coord2", "lineSegmentStart", "lineSegmentEnd", "dxc", "dyc", "dxl", "dyl", "cross", "pair1", "pair2", "booleanIntersects", "feature1", "feature2", "bool", "flattenEach", "flatten1", "flatten2", "es_default", "TRYING_TIMEOUT_MS", "DEBUG_CONTAINER_ID", "DEBUG", "_dirty", "_map", "_stylesheetId", "_userHiddenLayers", "_hiddenLayersInStyle", "_bbox", "_polygons", "_timer", "_loaded", "_getScreenPoints", "_stopTrying", "_startTrying", "_OutdoorLayers_instances", "filterStylesInMap_fn", "_handleRender", "_expr", "running_get", "_cancelJobs", "_handleStyleChange", "addDebugContainer_fn", "updateDebugBBox_fn", "OutdoorLayers", "map", "__privateAdd", "__publicField", "IdleQueue", "bbox", "__privateGet", "screenPoints", "point", "maxX", "p", "minX", "maxY", "minY", "Point", "__privateSet", "points", "__privateMethod", "features", "layer", "feature", "poly", "polygon", "multiPolygon", "booleanIntersects", "e", "newStylesheetId", "polygons", "layers", "acc", "c", "layerId", "container", "el", "topLeftPoint", "bottomRightPoint", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "Path_Vertex_default", "init_define_process", "Path_Fragment_default", "init_define_process", "Path_Stencil_Fragment_default", "textureLoader", "TextureLoader", "buildPath", "points", "component", "options", "breakpoint", "width", "pulseColor", "completeFraction", "isVertical", "visibleThroughGeometry", "dashed", "highlightCompleteFraction", "highlightStartFraction", "highlightEndFraction", "highlightColor", "highlightWidthMultiplier", "color", "animateDrawing", "nearZoom", "farZoom", "displayArrowsOnPath", "showPulse", "showArrow", "nearRadius", "farRadius", "pathZ", "ALTITUDE_ADJUSTMENT", "pathLength", "i", "dx", "dz", "dy", "firstPoint", "lastPoint", "arrowTexture", "Texture", "mappedin_icon_arrow_default", "SRGBColorSpace", "colorThree", "Color", "pulseColorThree", "uniforms", "Vector2", "pathCurve", "CatmullRomCurve3", "TUBULAR_SEGMENTS_PER_UNIT_LENGTH", "RADIAL_SEGMENTS", "tubularSegments", "geometry", "TubeGeometry", "vertexIndex", "BufferAttribute", "pathDistance", "pathDistanceAttribute", "j", "pathTangents", "pathTangentAttribute", "tangent", "pathNormals", "pathNormalAttribute", "normalX", "normalY", "normalZ", "normalR", "unitNormalX", "unitNormalY", "unitNormalZ", "material", "ShaderMaterial", "Path_Vertex_default", "Path_Fragment_default", "RepeatWrapping", "pathObject", "Mesh", "xRayObject", "xRayUniforms", "mesh", "stencilMaterial", "Path_Stencil_Fragment_default", "stencilMesh", "AlwaysStencilFunc", "ReplaceStencilOp", "boundingBox", "Box3", "center", "Vector3", "child", "NotEqualStencilFunc", "KeepStencilOp", "RENDER_LAYERS", "VERTICAL_THRESHOLD_METERS", "PathSystem", "PubSub", "rendererState", "convertTo3DMapPosition", "getParentContainer", "convertZoomLevelToAltitude", "__publicField", "minZoomAltitude", "maxZoomAltitude", "currentZoomAltitude", "entity", "shouldAnimate", "entityId", "component", "style", "componentVerticalDistanceDirty", "PathComponent", "points", "i", "destroyObject3D", "fromGeoJSONPoint", "toGeoJSONPoint", "fromParent", "toParent", "fromAltitude", "toAltitude", "fromPosition", "toPosition", "geojsonPoints", "coordinatesEqual", "convertedPoint", "mesh", "material", "center", "buildPath", "zoomLevel", "child", "uniforms", "updateHighlightPathUniforms", "Mappedin_Logger_default", "breakpoint", "getInterpolationBreakpoint", "init_define_process", "_meshComponentBeingProcessed", "_geometryGroupBeingProcessed", "_styleComponentBeingProcessed", "_processingMatrix", "MeshDetachmentSystem", "rendererState", "__publicField", "__privateAdd", "Matrix4", "geometry", "Geometry3D", "MeshComponent", "StyleComponent", "GeometryGroupObject3D", "__privateSet", "__privateGet", "color", "Color", "opacity", "getGroupContainerOpacity", "newMaterial", "BatchedStandardMaterial", "DoubleSide", "newMesh", "EntityBatchedMesh", "instance", "transferGeometryToNewBatchedMesh", "geometryId", "init_define_process", "init_define_process", "updateHeight", "component", "height", "initialHeight", "newHeight", "repeatScalingFactor", "updateBufferGeometryHeight", "updateAltitude", "altitude", "matrix", "position", "quaternion", "scale", "_meshComponentBeingProcessed", "_styleComponentBeingProcessed", "_processingMatrix", "_processingPosition", "_processingQuaternion", "_processingScale", "MeshModificationSystem", "rendererState", "__publicField", "__privateAdd", "Matrix4", "Vector3", "Quaternion", "entity", "Geometry3D", "__privateSet", "modified", "__privateGet", "updateHeight", "updateAltitude", "entityId", "init_define_process", "DEFAULT_DEBUG_STATE", "Debug", "core", "__publicField", "updateState", "diff", "key", "value", "init_define_process", "OCCLUSION_CAMERA_LAYER", "DEBUG", "DEFAULT_OCCLUDER_HEIGHT", "fillArrayWithColor", "array", "count", "color", "i", "r", "g", "b", "Occlusion2DSystem", "state", "convertTo3DMapPosition", "renderer", "__publicField", "dpr", "WebGLRenderTarget", "RGBAFormat", "UnsignedByteType", "x", "y", "id", "pixelIndex", "feature", "mesh", "entityId", "entity", "GroupContainerObject3D", "geometry", "renderPolygonGeometry", "renderMultiPolygonGeometry", "clearColor", "Color", "projection", "shouldShow", "error", "Mappedin_Logger_default", "ShaderMaterial", "GLSL3", "position", "BufferAttribute", "occluderId", "Mesh", "init_define_process", "GeometryDisposalSystem", "state", "__publicField", "entityId", "entity", "Geometry3D", "meshComponent", "init_define_process", "TextureSystem", "PubSub", "state", "__publicField", "path", "promise", "resolve", "reject", "TextureLoader", "geometryId", "geometry", "Geometry3D", "textureComponent", "TextureComponent", "meshComponent", "MeshComponent", "material", "getMaterial", "texture", "init_define_process", "RenderOrderSystem", "state", "__publicField", "RENDER_LAYERS", "object", "styleComponent", "meshComponent", "entity", "entityId", "renderOrder", "init_define_process", "MAX_PLANE_SIZE", "ClippingPlaneSystem", "rendererState", "__publicField", "entity", "clippingPlaneComponent", "meshComponent", "entityId", "Plane", "Vector3", "MeshStandardMaterial", "plane", "po", "parent", "geometries", "child", "Mesh", "clonedGeometry", "mergedGeometry", "mergeGeometries", "mainGroup", "Group", "clippedObjectAndStencilGroup", "holeFillGroup", "holeFillMaterial", "NotEqualStencilFunc", "ReplaceStencilOp", "planeGeom", "PlaneGeometry", "holeFillMesh", "geometry", "renderOrder", "group", "baseMat", "MeshBasicMaterial", "AlwaysStencilFunc", "mat0", "BackSide", "IncrementWrapStencilOp", "mesh0", "mat1", "FrontSide", "DecrementWrapStencilOp", "mesh1", "raycaster", "Raycaster", "DEFAULT_PITCH", "DEFAULT_BEARING", "DEFAULT_ZOOM_LEVEL", "DEFAULT_MIN_ZOOM_LEVEL", "DEFAULT_MAX_ZOOM_LEVEL", "constants_exports", "FIELD_OF_VIEW", "MathUtils", "_scene", "_cameraObject", "_cachedBasicEnvMapPromise", "_viewCamera", "_resolution", "_worldPlane", "_resizeObserver", "_cameraOrbit", "_Core_instances", "setResolutionScale_fn", "_state", "_mapLibreEventListeners", "_abortController", "_collisionEngineContainerEl", "_debugCanvas", "_colliderCanvas", "_twoDEntityScene", "_renderer", "_systems", "_matchMediaMinResolution", "_invalidate2DEntities", "_invalidate3DEntities", "renderEntity2DContainer_fn", "renderEntityDOMContainer_fn", "resizeCollisionCanvas_fn", "_mode", "_setGeometryDisposalDirty", "_round10", "_handlePixelRatioChange", "_handleWindowResizeWithEvent", "_handleWindowResize", "_renderFull", "_tempProjectionVector", "_project", "_setBufferSize", "_measureCanvas", "createEntity2D_fn", "_cameraFrustum", "_viewProjectionMatrix", "_onRenderError", "_aggregateUserEventsStart", "_aggregateUserEventsEnd", "loadEnvMap_fn", "_cleanupEventListeners", "_cleanupDOMElements", "_tempVec", "_batchoffsetTempVec", "Core", "PubSub", "container", "options", "__privateAdd", "__publicField", "GroupContainerObject3D", "DEFAULT_INSET_PADDING", "Group", "PerspectiveCamera", "__privateGet", "value", "__privateMethod", "getPixelRatio", "width", "height", "force", "currentWidth", "currentHeight", "top", "left", "Vector3", "projectVector", "position", "camera", "projection", "x", "y", "translateX", "translateY", "widthThreeJS", "heightThreeJS", "parent", "defaultToScene", "parentEntity", "Mappedin_Logger_default", "parentContainer", "clientX", "clientY", "useWorldPlane", "containerRect", "offsetX", "offsetY", "point", "Vector2", "pointThreeD", "groupContainers", "raycaster", "coordinate", "vector3D", "vector2D", "v", "lat", "lon", "cartesianToGeographic", "color", "alpha", "bbox", "polygons", "layers", "Frustum", "Matrix4", "e", "debounce", "eventName", "fn", "define_process_default", "event", "handler", "__privateSet", "error", "obj", "destroyObject3D", "HTMLControlsSystem", "Renderer", "Scene", "maplibreFrustrumCullHack", "__THREE_DEVTOOLS__", "Camera", "cameraElevation", "Object3D", "worldPlaneGeometery", "PlaneGeometry", "worldPlaneMaterial", "MeshBasicMaterial", "Mesh", "throttle", "a", "canvasWidth", "canvasHeight", "WatermarkSystem", "directionalLight", "DirectionalLight", "ambientLight", "AmbientLight", "CameraSystem", "PathSystem", "PanBoundsSystem", "handlePanBoundsUpdate", "panBounds", "fov", "convertAltitudeToZoomLevel", "screenWidthHeightRatio", "fovInRadians", "tanFovHalf", "r", "center", "d", "cameraPosition", "cameraToCenterDistance", "cameraToCenterPlane", "minZoomFromCurrentPanBounds", "shouldExpandZoomLevel", "DOMVisibilitySystem", "DOMResizeSystem", "DOMDrawSystem", "CollisionSystem", "TwoDDrawSystem", "InteractionSystem", "TAP_ZOOM_DURATION", "payload", "geometry", "PathComponent", "MarkerComponent", "ModelComponent", "label_default", "GeometryInFocusSystem", "handleGeometryInFocus", "TwoDVisibilitySystem", "DrawSystem", "TwoDProjectionSystem", "ExporterSystem", "MeshCreationAndOptimizationSystem", "MeshDetachmentSystem", "MeshModificationSystem", "GeometryDisposalSystem", "TextureSystem", "BorderSystem", "ClippingPlaneSystem", "RenderOrderSystem", "CustomGeometrySystem", "OutlineInterpolationSystem", "RenderSystem", "ImageSystem", "Text3DSystem", "OutdoorLayers", "Occlusion2DSystem", "Debug", "id", "containerObject", "updateInteractivity", "updateFocusable", "feature", "builder", "style", "CustomGeometryComponent", "entity", "Geometry3D", "StyleComponent", "groupObject", "GeometryGroupObject3D", "visible", "rest", "DEFAULT_COLOR", "randomId", "occluderId", "validateImage", "meshComponent", "ImageComponent", "onAdd", "validateModelGroup", "ClippingPlaneComponent", "contentHTML", "entityId", "validateMarker", "updateEnabled", "attachedEntity", "textComponent", "Text3DComponent", "Text3DStyleComponent", "meshGeometryId", "content", "addText3DOptionsSchema", "targetGeometry3D", "targetMeshComponent", "existing", "text", "validateLabel", "validatePath", "pickPathOptions", "object", "focusComponent", "focusableComponent", "parentGroupId", "group", "outlineComponent", "parentId", "batchedText", "textMesh", "polygonEntityId", "meshGeometry3D", "update", "texture", "geometryOrGeometryId", "box", "Box3", "geometryEntity", "getGeometryByGeometryId", "component", "MeshComponent", "BatchedMesh", "isFiniteBox", "getCornersOfBoundingBox", "styleComponent", "children", "firstChildId", "firstChildState", "tempVec", "childId", "parentObject", "convertNumberToCollisionRankingTier", "hoverColor", "initialColor", "initialTopColor", "topColor", "altitude", "textureComponent", "interactionComponent", "modelComponent", "styleComp", "DEFAULT_ROTATION", "DEFAULT_SCALE", "pathComponent", "imageComp", "assetGeometryIsText3D", "text3DComp", "DEFAULT_TEXT_STYLE", "state", "isColor", "geometry3D", "updateVisibility", "updateAltitude", "updatePosition", "updateParent", "handlePathUpdate", "handleModelStyleUpdate", "updateClippingPlane", "updateOpacity", "updateGroupColor", "updateOutline", "updateHeight", "updateGroupTexture", "updateGroupShading", "updateSide", "updateImageProps", "updateIndividualGeometryRenderOrder", "updateIndividualGeometryOpacity", "updateFlipImageToFaceCamera", "updateEnableImageCollisions", "updateIndividualGeometryTexture", "updateColor", "updateHoverColor", "updateHovered", "updateBorder", "updateLabel", "updateMarker", "handleText3DUpdate", "latitudeOrPosition", "longitude", "vector", "geographicToCartesian", "geometryOrBoundingBox", "getBoundingBoxCenter", "target", "Geometry2D", "mesh", "screenOffsets", "fullyContains", "w", "h", "rectFromScreenOffsets", "rectangle", "Rectangle", "c", "i", "lowerContainer", "upperContainer", "debug", "assertType", "lowerObjectNDCBox", "projectToBox2D", "upperObjectClone", "upperObjectNDCBox", "zOffset", "overlaps", "el", "bottomBox", "drawProjectedBox", "topBox", "verticalOffset", "TextureLoader", "blaze_thick_compressed_default", "EquirectangularReflectionMapping", "renderer_default", "init_define_process", "mountSceneGraphVisualizer", "mv", "gui", "createParseChild", "createWatermarkChild", "gltf", "blob", "a", "url", "camera", "state", "value", "root", "parseChild", "obj", "parent", "group", "tinycolor", "c", "currentState", "child", "folder", "controller", "url", "authURL", "maplibreWorkerUrl", "setMaplibreWorkerUrl", "url", "setWorkerUrl", "collisionWorkerUrl", "setCollisionWorkerUrl", "createRenderer", "container", "options", "useWorkers", "coreOptions", "headers", "getRequestHeaders", "authURL", "center", "map", "Map", "DEFAULT_ZOOM_LEVEL", "DEFAULT_PITCH", "DEFAULT_BEARING", "transformRequest", "getPixelRatio", "gl", "core", "renderer_default", "cachedPosition", "position", "modelAsMercatorCoordinate", "MercatorCoordinate", "layer", "createCustomLayer", "styleLoadHandler", "outdoorsLoaded", "outdoorStyleLoaded", "idleHandler", "updateData", "e", "styleDataHandler", "errorHandler", "Mappedin_Logger_default", "init_define_process", "init_define_process", "init_define_process", "init_define_process", "_Label", "id", "text", "target", "__publicField", "instance", "Label", "init_define_process", "_target", "_Marker", "id", "contentEl", "target", "__publicField", "__privateAdd", "__privateSet", "__privateGet", "instance", "Marker", "init_define_process", "_id", "_url", "_Image3DView", "id", "url", "target", "__privateAdd", "__publicField", "__privateSet", "instance", "__privateGet", "Image3DView", "init_define_process", "_target", "_Model", "id", "groupId", "target", "__publicField", "__privateAdd", "__privateSet", "__privateGet", "instance", "Model", "init_define_process", "_cachedDistance", "_PathSegment", "id", "coordinates", "__publicField", "__privateAdd", "instance", "__privateGet", "__privateSet", "computeTotalDistanceBetweenCoordinates", "PathSegment", "_Path", "drawAnimation", "segments", "Path", "init_define_process", "CENTIMETER_PRECISION", "_internalCamera", "_precision", "CameraTransform", "camera", "options", "__privateAdd", "__privateSet", "originalCenter", "__privateGet", "roundedLat", "round", "roundedLng", "coordinate_default", "init_define_process", "_Shape", "id", "__publicField", "instance", "Shape", "init_define_process", "_Text3DView", "id", "target", "__publicField", "instance", "Text3DView", "init_define_process", "init_define_process", "init_define_process", "ICONS", "regex", "getStyledIcon", "iconName", "color", "size", "icon", "getDeparturePin", "color", "getDestinationPin", "DESTINATION_COLOR", "DEPARTURE_COLOR", "DroppedPin", "type", "getSize", "state", "ConnectionMarker", "direction", "size", "iconSize", "hasDirection", "getStyledIcon", "init_define_process", "EARTH_RADIUS_M", "cartesianToCoordinateCache", "ms", "resolve", "computePathCoordinateFraction", "segment", "coordinate", "origin", "totalDistance", "remainingPathSegment", "getRemainingPathSegment", "projectSegmentToCartesianPlane", "projectedCoords", "coord", "projectCoordinateToCartesianPlane", "originLat", "originLon", "deltaLat", "deltaLon", "metersPerDegreeLatitude", "metersPerDegreeLongitude", "x", "y", "findSegmentIntersection", "segments", "point", "closestPoint", "closestDistance", "segmentIndex", "i", "start", "end", "closest", "getClosestPointOnLineSegment", "distance", "cartesianToCoordinate", "segmentX", "segmentY", "pointX", "pointY", "segmentLengthSq", "t", "clampedT", "cartesian", "latitude", "longitude", "coordinate_default", "intersectionPoint", "projectedIntersection", "dx", "dy", "closestEndpointIndex", "closestEndpointDistance", "remainingCoordinates", "PathSegment", "getHighlightedPathSegments", "paths", "from", "to", "projectionOrigin", "fromSegment", "toSegment", "fromClosestDistance", "toClosestDistance", "projectedFrom", "projectCoordinateToCartesianPlane", "projectedTo", "path", "segment", "segmentFloorId", "isFromFloor", "isToFloor", "projectedCoords", "projectSegmentToCartesianPlane", "segmentMinDistanceFrom", "i", "start", "end", "closest", "getClosestPointOnLineSegment", "dx", "dy", "distance", "segmentMinDistanceTo", "segmentHighlights", "computePathCoordinateFraction", "INACTIVE_PATH_VERTICAL_OFFSET", "ACTIVE_PATH_VERTICAL_OFFSET", "defaultPathOptions", "defaultInactivePathOptions", "defaultOptions", "DEPARTURE_COLOR", "DESTINATION_COLOR", "_markers", "_paths", "_geoJSONApi", "_options", "_existingDraw", "_existingDrawSync", "_directions", "_activePath", "_pathsMap", "_directionsMap", "_Navigation_instances", "isVortexAction_fn", "reorderPaths_fn", "createPath_fn", "createMarker_fn", "computeVerticalOffset_fn", "drawAsync_fn", "setupOptions_fn", "emitNavigationStateChanged_fn", "setActiveDirections_fn", "addMarker_fn", "addMarkers_fn", "_handleClick", "Navigation", "geoJSONApi", "__privateAdd", "e", "__privateGet", "instruction", "__privateSet", "floorIds", "direction", "coordinate", "id", "paths", "path", "mapData", "floorStacks", "floor", "floors", "target", "directions", "Mappedin_Logger_default", "__privateMethod", "foundDirections", "d", "segment", "from", "to", "options", "animationDuration", "projectionOrigin", "highlightedPathSegments", "getHighlightedPathSegments", "tweens", "h", "Tween", "value", "resolveFn", "completedPromise", "res", "tween", "index", "directionsArray", "firstDirection", "lastDirection", "firstNode", "i", "pathOptions", "mo", "m", "s", "action", "activePath", "coordinates", "randomId", "internalPath", "Path", "contentEl", "interactive", "internalMarker", "el", "Marker", "type", "cancelled", "resolve", "define_process_default", "ms", "color", "marker", "ConnectionMarker", "DroppedPin", "instructions", "init_define_process", "_rendererCore", "_api", "_Camera_instances", "getFloorAltitude_fn", "computeCoordinateCloud_fn", "Camera", "api", "__privateAdd", "__publicField", "options", "__privateGet", "minPitch", "maxPitch", "zoomLevel", "__privateSet", "padding", "panMode", "target", "frame", "__privateMethod", "coordinate_default", "_center", "bearing", "pitch", "center", "position", "value", "elevation", "convertPanBoundsToCameraBounds", "thing", "fallback", "floor_default", "targets", "flattenedThings", "t", "floorAltitude", "coordEach", "coord", "boundingBox", "coordinates", "isPosition", "init_define_process", "_getCurrentMap", "Exporter", "currentMapGetter", "__privateAdd", "__privateSet", "__privateGet", "userOptions", "map", "Mappedin_Logger_default", "init_define_process", "_labelsById", "_getCurrentMap", "Labels", "currentMapGetter", "__privateAdd", "__privateSet", "__privateGet", "l", "id", "target", "text", "options", "coord", "map", "entity", "getAttachableGeometryId", "newLabel", "Label", "created", "label", "found", "removed", "init_define_process", "init_define_process", "DEFAULT_WALL_STYLE", "DEFAULT_DOOR_STYLE", "DEFAULT_AREA_STYLE", "MIN_DOOR_HEIGHT", "Layer", "renderer", "containerId", "layers", "__publicField", "visible", "imageIdx", "_geoJSONBoundingBox", "FloorObject", "parentId", "floor", "mapObject", "multiFloorView", "options", "mvf", "styleMap", "mapDataInternal", "__privateAdd", "Mappedin_Logger_default", "labelsLayer", "LABELS_LAYER", "markersLayer", "MARKERS_LAYER", "allGeometry", "GEOMETRY_LAYER", "pathsContainer", "PATHS_LAYER", "floorAltitudes", "style", "exteriorWallFeatures", "f", "footprintGroup", "parseFloorGap", "FOOTPRINT_LAYER", "spaceFeatures", "facadeSpaceGroups", "space", "facade", "group", "spaceStyleGroups", "groupGeometryByStyle", "spaces", "index", "features", "translateToCoreStyle", "groupId", "facadesLayer", "FACADES_LAYER", "facadeId", "facadeContainer", "facadeGeometryLayer", "spaceFacadeStyleGroups", "geometry", "objectFeatures", "objectStyleGroups", "objects", "wallFeatures", "entrances", "wallStyle", "exteriorWallStyle", "walls", "entrancesCollection", "cutEntrancesFromLineStrings", "doorHeight", "doorStyle", "interiorDoors", "INTERIOR_DOORS_ID", "interiorWalls", "WALLS_ID", "EXTERIOR_WALLS_ID", "exteriorDoors", "EXTERIOR_DOORS_ID", "exteriorWalls", "imageContainer", "feature", "id", "generateImageId", "coordinate_default", "IMAGES_LAYER", "verticalOffset", "randomId", "areasLayer", "AREAS_LAYER", "floorContainer", "__privateGet", "__privateSet", "getBoundingBox", "occluderContainer", "OCCLUSION_LAYER", "occluderLayer", "init_define_process", "_defaultFloorObject", "FloorStackObject", "floorStack", "parentId", "renderer", "facade", "__publicField", "__privateAdd", "groupContainer", "__privateGet", "MappedinError", "defaultFloor", "floor", "prev", "curr", "__privateSet", "Mappedin_Logger_default", "init_define_process", "getMultiFloorState", "floors", "currentFloor", "floorGap", "floorIdsInNavigation", "floorsVisualHeightMap", "state", "sortedFloors", "f1", "f2", "hasGroundFloor", "floor", "firstNonGroundFloorProcessed", "footprintHeight", "parseFloorGap", "currentFloorState", "_multiFloorView", "GeojsonApiMapObject", "PubSub", "id", "mapDataInternal", "options", "api", "__publicField", "targets", "opts", "floorId", "scale", "rest", "floor", "params", "model", "target", "randomId", "convertCoordinateToPosition", "MappedinError", "_id", "_groupId", "url", "flipImageToFaceCamera", "properties", "geometry", "coordinate", "html", "getTargetFloorObject", "attachTo", "_opts", "markerLayer", "MARKERS_LAYER", "marker", "markerState", "targetFloorId", "Mappedin_Logger_default", "optionsWithDefaults", "tween", "Tween", "ANIMATION_TWEENS", "lon", "lat", "layerContainerId", "tweenToPromise", "style", "customGeometry", "content", "textInfo", "labelSpace", "option", "mapData", "result", "space", "text3d", "onCreate", "labelOptions", "entry", "val", "feature", "hasImageLabel", "featureImages", "appearance", "labelLayer", "LABELS_LAYER", "label", "getAttachableGeometryId", "space_default", "text", "entityId", "coordinates", "animateDrawing", "segments", "currentFloorId", "segmentIndex", "coord", "latitude", "longitude", "coordinate_default", "paths", "acc", "idx", "fromSegment", "fromCoordinate", "toCoordinate", "fromPosition", "toPosition", "connectionPath", "pathsLayerId", "PATHS_LAYER", "path", "tweens", "shouldAnimate", "shouldAnimatePathDrawing", "value", "index", "entityIds", "__privateAdd", "styleMap", "extractStyleMap", "__privateSet", "defaultStack", "FloorStackObject", "defaultFloor", "FloorObject", "__privateGet", "floorStacks", "floorStack", "floorStackInternal", "floorObject", "computeFloorAltitudes", "spaceId", "pickedFloor", "getId", "floorStackId", "reason", "currentFloor", "currentFloorStack", "state", "getMultiFloorState", "f", "floorAltitudes", "parseFloorGap", "previousFloorId", "shouldHideOtherFloors", "pathLayer", "shouldShowLayer", "animation", "altitudeData", "spaceStyle", "spaceAltitudeData", "core", "init_define_process", "_markersById", "_getCurrentMap", "Markers", "currentMapGetter", "__privateAdd", "__privateSet", "__privateGet", "marker", "id", "target", "html", "options", "coord", "map", "getAttachableGeometryId", "el", "newMarker", "Marker", "found", "removed", "Mappedin_Logger_default", "convertCoordinateToPosition", "init_define_process", "_images", "_getCurrentMap", "Image3D", "currentMapGetter", "__privateAdd", "__privateSet", "__privateGet", "id", "target", "url", "options", "coord", "map", "entity", "convertCoordinateToPosition", "newImage", "Image3DView", "image", "found", "removed", "init_define_process", "_models", "_getCurrentMap", "Models", "currentMapGetter", "__privateAdd", "__privateSet", "__privateGet", "id", "coordinate", "url", "options", "targets", "targetsByFloor", "acc", "coord", "Mappedin_Logger_default", "floorId", "getTargetFloorObject", "map", "instances", "groupId", "randomId", "newModel", "Model", "model", "found", "removed", "init_define_process", "_paths", "_getCurrentMap", "Paths", "currentMapGetter", "__privateAdd", "__privateSet", "__privateGet", "id", "coordinates", "options", "map", "internalPath", "entityIds", "p", "newPath", "Path", "randomId", "path", "start", "end", "projectionOrigin", "highlightedPathSegments", "getHighlightedPathSegments", "animationDuration", "resolveFn", "completedPromise", "res", "tween", "Tween", "value", "highlightedPathSegment", "found", "removed", "init_define_process", "_shapes", "_getCurrentMap", "Shapes", "currentMapGetter", "__privateAdd", "__privateSet", "__privateGet", "id", "geometry", "style", "floor", "map", "geometryId", "shapes", "Shape", "shape", "removed", "init_define_process", "_getCurrentMap", "Style", "currentMapGetter", "__privateAdd", "__privateSet", "__privateGet", "styleCollection", "styleId", "floor", "GEOMETRY_LAYER", "geometryLayer", "layer", "WALLS_ID", "EXTERIOR_WALLS_ID", "exteriorId", "FACADES_LAYER", "facadeLayer", "facades", "facadeId", "groupId", "init_define_process", "DEFAULT_STYLE", "_core", "_hiddenOutdoorGeometry", "_style", "_initialStyle", "_hiddenLayers", "_Outdoor_instances", "setInitialStyle_fn", "clearInitialStyle_fn", "Outdoor", "core", "hiddenOutdoorGeometry", "__privateAdd", "__privateSet", "map", "__privateGet", "__privateMethod", "style", "MAPPEDIN_LAYER_ID", "bbox", "polygons", "layers", "layer", "excludedStyleLayerIds", "visibility", "targetOpacity", "initialOpacity", "error", "Mappedin_Logger_default", "value", "init_define_process", "disableText3DWorker", "configureWorker", "_getCurrentMap", "_textViewMap", "_text3DToTextViewMap", "Text3D", "currentMapGetter", "__privateAdd", "__privateSet", "options", "results", "recordedTextInfoId", "__privateGet", "textInfo", "target", "textId", "found", "text3DView", "Text3DView", "content", "space_default", "created", "text3dView", "id", "info", "item", "init_define_process", "init_define_process", "z", "init_define_process", "z", "extractTypeFromSchema", "schema", "shape", "typeSchema", "extractInvalidFields", "parseResult", "fieldErrors", "issue", "fieldName", "logInvalidFields", "invalidFields", "elementType", "fieldEntries", "fieldDetails", "field", "messages", "Mappedin_Logger_default", "parsePartialState", "state", "options", "result", "key", "parseCompleteState", "DOORS_STATE_TYPE", "doorsStateSchema", "z", "doorsStateSchemaPartial", "doorsStateSchemaStrict", "getDoorsState", "geometryGroupState", "color", "topColor", "texture", "topTexture", "visible", "opacity", "parseCompleteState", "translateDoorsStateToGeojsonCore", "state", "currentState", "update", "init_define_process", "z", "FACADE_STATE_TYPE", "facadeStateSchema", "z", "facadeStateSchemaPartial", "facadeStateSchemaStrict", "getFacadeState", "state", "parseCompleteState", "init_define_process", "z", "FLOOR_STATE_TYPE", "FOOTPRINT_STATE_TYPE", "GEOMETRY_STATE_TYPE", "LABELS_STATE_TYPE", "MARKERS_STATE_TYPE", "IMAGES_STATE_TYPE", "OCCLUSION_STATE_TYPE", "PATHS_STATE_TYPE", "AREAS_STATE_TYPE", "footprintStateSchema", "z", "footprintStateSchemaPartial", "floorGeometryStateSchema", "floorGeometryStateSchemaPartial", "floorLabelsStateSchema", "floorLabelsStateSchemaPartial", "floorMarkersStateSchema", "floorMarkersStateSchemaPartial", "floorImagesStateSchema", "floorImagesStateSchemaPartial", "floorOcclusionStateSchema", "floorOcclusionStateSchemaPartial", "floorPathsStateSchema", "floorPathsStateSchemaPartial", "floorSchema", "areasStateSchema", "areasStateSchemaPartial", "floorStateSchema", "floorSchemaPartial", "floorStateSchemaPartial", "floorStateSchemaStrict", "getFloorState", "state", "floor", "renderer", "Mappedin_Logger_default", "geometryLayer", "GEOMETRY_LAYER", "geometryLayerState", "labelLayer", "LABELS_LAYER", "markersLayer", "MARKERS_LAYER", "footprintLayer", "FOOTPRINT_LAYER", "footprintLayerState", "occlusionLayer", "OCCLUSION_LAYER", "occlusionLayerState", "imagesLayer", "IMAGES_LAYER", "imagesLayerState", "pathsLayer", "PATHS_LAYER", "pathsLayerState", "areasLayer", "AREAS_LAYER", "areasLayerState", "parseCompleteState", "init_define_process", "z", "GEOMETRY_STATE_TYPE", "geometryStateSchema", "z", "geometryStateSchemaPartial", "geometryStateSchemaStrict", "getGeometryState", "geometryState", "altitude", "interactive", "hoverColor", "color", "visible", "opacity", "height", "texture", "topTexture", "flipImageToFaceCamera", "enableImageCollisions", "topColor", "borderVisible", "borderColor", "borderWidth", "parseCompleteState", "translateGeometryStateToGeojsonCore", "state", "currentState", "update", "init_define_process", "z", "LABEL_STATE_TYPE", "labelStateSchema", "z", "val", "collisionRankingTierSchema", "labelAppearanceSchemaBase", "LABEL_TEXT_PLACEMENT_VALUES", "DEFAULT_LABEL_TEXT_PLACEMENTS", "labelStateSchemaPartial", "getLabelState", "state", "text", "enabled", "options", "parseLabelAppearance", "translateLabelStateToGeojsonCore", "currentState", "update", "init_define_process", "z", "MARKER_STATE_TYPE", "markerStateSchema", "z", "val", "collisionRankingTierSchema", "MARKER_PLACEMENT_VALUES", "markerStateSchemaPartial", "getMarkerState", "state", "marker", "coordinate", "enabled", "placement", "element", "dynamicResize", "contentHTML", "options", "position", "parent", "parentId", "coordinate_default", "translateMarkerStateToGeojsonCore", "currentState", "update", "init_define_process", "z", "PATH_STATE_TYPE", "PATH_DEFAULTS", "pathStateSchema", "z", "pathStateSchemaPartial", "pathStateSchemaStrict", "getPathState", "state", "color", "visible", "width", "verticalOffset", "completeFraction", "highlightStartFraction", "highlightEndFraction", "highlightColor", "highlightWidthMultiplier", "highlightCompleteFraction", "parseCompleteState", "init_define_process", "z", "SHAPE_STATE_TYPE", "shapeStateSchema", "z", "shapeStateSchemaPartial", "shapeStateSchemaStrict", "getShapeState", "state", "altitude", "visible", "color", "opacity", "interactive", "height", "children", "bevel", "Mappedin_Logger_default", "parseCompleteState", "translateShapeStateToGeojsonCore", "parsedState", "parsePartialState", "translatedState", "bevelState", "init_define_process", "z", "TEXT3D_STATE_TYPE", "commonText3DStateSchema", "z", "val", "coordinate_default", "text3DStateSchema", "text3DUpdateStateSchema", "updateText3DStateSchema", "text3DStateSchemaStrict", "getText3DState", "state", "position", "visible", "color", "flipToFaceCamera", "font", "fontSize", "outlineColor", "outlineOpacity", "outlineBlur", "outlineWidth", "outlineOffsetX", "outlineOffsetY", "strokeWidth", "strokeOpacity", "strokeColor", "fillOpacity", "hoverColor", "parseCompleteState", "init_define_process", "z", "WALLS_STATE_TYPE", "wallsStateSchema", "z", "wallsStateSchemaPartial", "wallsStateSchemaStrict", "getWallsState", "geometryGroupState", "color", "topColor", "texture", "topTexture", "visible", "height", "opacity", "parseCompleteState", "translateWallsStateToGeojsonCore", "state", "currentState", "update", "init_define_process", "z", "IMAGE_STATE_TYPE", "imageStateSchema", "z", "val", "coordinate_default", "imageStateSchemaPartial", "getImageState", "state", "position", "init_define_process", "z", "MODEL_STATE_TYPE", "modelStateSchema", "modelPropertiesSchema", "z", "val", "coordinate_default", "MaterialStyleSchema", "modelStateUpdateSchema", "modelStateSchemaStrict", "getModelState", "state", "color", "position", "rotation", "scale", "visible", "interactive", "opacity", "material", "verticalOffset", "parent", "clippingPlaneZOffset", "clippingPlaneTopVisible", "floorId", "parseCompleteState", "init_define_process", "init_define_process", "autoGeometries", "mapData", "api", "thing", "init_define_process", "init_define_process", "entries", "setPrototypeOf", "isFrozen", "getPrototypeOf", "getOwnPropertyDescriptor", "Object", "freeze", "seal", "create", "apply", "construct", "Reflect", "x", "fun", "thisValue", "args", "Func", "arrayForEach", "unapply", "Array", "prototype", "forEach", "arrayLastIndexOf", "lastIndexOf", "arrayPop", "pop", "arrayPush", "push", "arraySplice", "splice", "stringToLowerCase", "String", "toLowerCase", "stringToString", "toString", "stringMatch", "match", "stringReplace", "replace", "stringIndexOf", "indexOf", "stringTrim", "trim", "objectHasOwnProperty", "hasOwnProperty", "regExpTest", "RegExp", "test", "typeErrorCreate", "unconstruct", "TypeError", "func", "thisArg", "lastIndex", "_len", "arguments", "length", "_key", "_len2", "_key2", "addToSet", "set", "array", "transformCaseFunc", "l", "element", "lcElement", "cleanArray", "index", "clone", "object", "newObject", "property", "value", "isArray", "constructor", "lookupGetter", "prop", "desc", "get", "fallbackValue", "html", "svg", "svgFilters", "svgDisallowed", "mathMl", "mathMlDisallowed", "text", "xml", "MUSTACHE_EXPR", "ERB_EXPR", "TMPLIT_EXPR", "DATA_ATTR", "ARIA_ATTR", "IS_ALLOWED_URI", "IS_SCRIPT_OR_DATA", "ATTR_WHITESPACE", "DOCTYPE_NAME", "CUSTOM_ELEMENT", "NODE_TYPE", "attribute", "cdataSection", "entityReference", "entityNode", "progressingInstruction", "comment", "document", "documentType", "documentFragment", "notation", "getGlobal", "window", "_createTrustedTypesPolicy", "trustedTypes", "purifyHostElement", "createPolicy", "suffix", "ATTR_NAME", "hasAttribute", "getAttribute", "policyName", "createHTML", "createScriptURL", "scriptUrl", "console", "warn", "_createHooksMap", "afterSanitizeAttributes", "afterSanitizeElements", "afterSanitizeShadowDOM", "beforeSanitizeAttributes", "beforeSanitizeElements", "beforeSanitizeShadowDOM", "uponSanitizeAttribute", "uponSanitizeElement", "uponSanitizeShadowNode", "createDOMPurify", "undefined", "DOMPurify", "root", "version", "VERSION", "removed", "nodeType", "Element", "isSupported", "originalDocument", "currentScript", "DocumentFragment", "HTMLTemplateElement", "Node", "NodeFilter", "NamedNodeMap", "MozNamedAttrMap", "HTMLFormElement", "DOMParser", "ElementPrototype", "cloneNode", "remove", "getNextSibling", "getChildNodes", "getParentNode", "template", "createElement", "content", "ownerDocument", "trustedTypesPolicy", "emptyHTML", "implementation", "createNodeIterator", "createDocumentFragment", "getElementsByTagName", "importNode", "hooks", "createHTMLDocument", "EXPRESSIONS", "ALLOWED_TAGS", "DEFAULT_ALLOWED_TAGS", "TAGS", "ALLOWED_ATTR", "DEFAULT_ALLOWED_ATTR", "ATTRS", "CUSTOM_ELEMENT_HANDLING", "tagNameCheck", "writable", "configurable", "enumerable", "attributeNameCheck", "allowCustomizedBuiltInElements", "FORBID_TAGS", "FORBID_ATTR", "ALLOW_ARIA_ATTR", "ALLOW_DATA_ATTR", "ALLOW_UNKNOWN_PROTOCOLS", "ALLOW_SELF_CLOSE_IN_ATTR", "SAFE_FOR_TEMPLATES", "SAFE_FOR_XML", "WHOLE_DOCUMENT", "SET_CONFIG", "FORCE_BODY", "RETURN_DOM", "RETURN_DOM_FRAGMENT", "RETURN_TRUSTED_TYPE", "SANITIZE_DOM", "SANITIZE_NAMED_PROPS", "SANITIZE_NAMED_PROPS_PREFIX", "KEEP_CONTENT", "IN_PLACE", "USE_PROFILES", "FORBID_CONTENTS", "DEFAULT_FORBID_CONTENTS", "DATA_URI_TAGS", "DEFAULT_DATA_URI_TAGS", "URI_SAFE_ATTRIBUTES", "DEFAULT_URI_SAFE_ATTRIBUTES", "MATHML_NAMESPACE", "SVG_NAMESPACE", "HTML_NAMESPACE", "NAMESPACE", "IS_EMPTY_INPUT", "ALLOWED_NAMESPACES", "DEFAULT_ALLOWED_NAMESPACES", "MATHML_TEXT_INTEGRATION_POINTS", "HTML_INTEGRATION_POINTS", "COMMON_SVG_AND_HTML_ELEMENTS", "PARSER_MEDIA_TYPE", "SUPPORTED_PARSER_MEDIA_TYPES", "DEFAULT_PARSER_MEDIA_TYPE", "CONFIG", "formElement", "isRegexOrFunction", "testValue", "Function", "_parseConfig", "cfg", "ADD_URI_SAFE_ATTR", "ADD_DATA_URI_TAGS", "ALLOWED_URI_REGEXP", "ADD_TAGS", "ADD_ATTR", "table", "tbody", "TRUSTED_TYPES_POLICY", "ALL_SVG_TAGS", "ALL_MATHML_TAGS", "_checkValidNamespace", "parent", "tagName", "namespaceURI", "parentTagName", "Boolean", "_forceRemove", "node", "removeChild", "_removeAttribute", "name", "getAttributeNode", "from", "removeAttribute", "setAttribute", "_initDocument", "dirty", "doc", "leadingWhitespace", "matches", "dirtyPayload", "parseFromString", "documentElement", "createDocument", "innerHTML", "body", "insertBefore", "createTextNode", "childNodes", "call", "_createNodeIterator", "SHOW_ELEMENT", "SHOW_COMMENT", "SHOW_TEXT", "SHOW_PROCESSING_INSTRUCTION", "SHOW_CDATA_SECTION", "_isClobbered", "nodeName", "textContent", "attributes", "hasChildNodes", "_isNode", "_executeHooks", "currentNode", "data", "hook", "_sanitizeElements", "allowedTags", "firstElementChild", "_isBasicCustomElement", "parentNode", "childCount", "i", "childClone", "__removalCount", "expr", "_isValidAttribute", "lcTag", "lcName", "_sanitizeAttributes", "hookEvent", "attrName", "attrValue", "keepAttr", "allowedAttributes", "forceKeepAttr", "attr", "initValue", "getAttributeType", "setAttributeNS", "_sanitizeShadowDOM", "fragment", "shadowNode", "shadowIterator", "nextNode", "sanitize", "importedNode", "returnNode", "appendChild", "firstChild", "nodeIterator", "shadowroot", "shadowrootmode", "serializedHTML", "outerHTML", "doctype", "setConfig", "clearConfig", "isValidAttribute", "tag", "addHook", "entryPoint", "hookFunction", "removeHook", "removeHooks", "removeAllHooks", "purify", "ICONS", "OPENING_TAG_REGEX", "getBuiltInIcon", "iconName", "color", "size", "icon", "sanitizeSVGString", "svg", "purify", "styleSVGString", "svgElement", "Mappedin_Logger_default", "element", "fetchIcon", "url", "options", "res", "isomorphicFetch", "contentType", "raw", "e", "init_define_process", "hasWashroomCategory", "thing", "profile", "category", "hasParkingCategory", "LABEL_COLORS", "LABEL_ICONS", "getDefaultIcon", "thing", "iconName", "connection_default", "poi_default", "door_default", "facade_default", "getBuiltInIcon", "getLabelColor", "hasWashroomCategory", "hasParkingCategory", "getLabelIcon", "options", "icon", "url", "location", "fetchIcon", "defaultIcon", "getLabelRank", "getLabelOptions", "autoLabels", "mapData", "api", "promises", "labels", "coordinate", "auto", "mapData", "api", "promises", "autoLabels", "autoGeometries", "labels", "PERCENT_OF_SCREEN_PADDING", "_manualFloorVisibility", "_hidePathsNotOnCurrentFloor", "GeoJsonApi", "PubSub", "rendererCore", "mapView", "externalPubSub", "__publicField", "__privateAdd", "Camera", "defaultMap", "GeojsonApiMapObject", "error", "MappedinRenderError", "getFacadeFromEntityId", "entityId", "geometry", "entities", "uniqueFacades", "facade", "cameraTransform", "CameraTransform", "panBounds", "convertPanBoundsToCameraBounds", "createHandler", "event", "payload", "labels", "markers", "models", "paths", "l", "found", "m", "p", "geometryIntersectIds", "geometryIntersected", "id", "floorsIntersected", "acc", "floor", "floor_default", "floorId", "verticalOffset", "floorState", "facadeIntersected", "space", "space_default", "publicPayload", "coordinate_default", "object_default", "area_default", "Shape", "currentMapGetter", "Markers", "Models", "Labels", "Text3D", "Exporter", "Paths", "Navigation", "e", "Outdoor", "Image3D", "Shapes", "Style", "__privateGet", "value", "__privateSet", "floors", "target", "state", "geometryLayer", "GEOMETRY_LAYER", "wallsId", "WALLS_ID", "translateWallsStateToGeojsonCore", "parsePartialState", "wallsStateSchemaPartial", "exteriorWallsId", "EXTERIOR_WALLS_ID", "interiorDoorsId", "INTERIOR_DOORS_ID", "translateDoorsStateToGeojsonCore", "doorsStateSchemaPartial", "exteriorDoorsId", "EXTERIOR_DOORS_ID", "dataObject", "Path", "Mappedin_Logger_default", "Label", "translateLabelStateToGeojsonCore", "labelStateSchemaPartial", "Marker", "translateMarkerStateToGeojsonCore", "markerStateSchemaPartial", "currentState", "translateGeometryStateToGeojsonCore", "geometryStateSchemaPartial", "Image3DView", "imageStateSchemaPartial", "door_default", "translateShapeStateToGeojsonCore", "shapeStateSchemaPartial", "Model", "scale", "rotation", "rest", "modelStateUpdateSchema", "update", "floorObject", "parsedState", "floorSchemaPartial", "floorGeometryStateSchemaPartial", "labelsLayer", "LABELS_LAYER", "labelsState", "floorLabelsStateSchemaPartial", "markersLayer", "MARKERS_LAYER", "markersState", "floorMarkersStateSchemaPartial", "footprintLayer", "FOOTPRINT_LAYER", "footprintStateSchemaPartial", "occlusionLayer", "OCCLUSION_LAYER", "occlusionState", "floorOcclusionStateSchemaPartial", "imagesLayer", "IMAGES_LAYER", "imagesState", "floorImagesStateSchemaPartial", "pathsLayer", "PATHS_LAYER", "pathsState", "floorPathsStateSchemaPartial", "areasLayer", "AREAS_LAYER", "areasState", "areasStateSchemaPartial", "facade_default", "facadeContainerState", "facadeGeometryContainer", "facadeStateSchemaPartial", "Text3DView", "text3DUpdateStateSchema", "segment", "pathStateSchemaPartial", "PathSegment", "getMapDataInternal", "mapData", "options", "resolve", "data", "mvf", "mvfCenter", "mapObject", "boundingBox", "userHiddenLayers", "totalBbox", "polygons", "floorStack", "footprint", "bbox", "getBoundingBox", "expandBbox", "feature", "insets", "ADD_MAP_FOCUS_ON_DURATION", "reason", "getId", "currentFloorStackId", "MappedinError", "currentFloorId", "currentFloor", "targetId", "getTargetID", "getWallsState", "getDoorsState", "getGeometryState", "getLabelState", "getMarkerState", "getModelState", "getImageState", "getText3DState", "getShapeState", "getPathState", "getFloorState", "facadeGeometryState", "getFacadeState", "c", "x", "y", "coord", "result", "coordinate", "groupContainers", "containerId", "altitude", "type", "ids", "auto", "object", "tween", "Tween", "debug", "currentMap", "floor2", "assertType", "floorBox", "Box3", "floor2Box", "child", "Mesh", "destroyObject3D", "isFiniteBox", "floorBoxGeometry", "BoxGeometry", "floorBoxMaterial", "MeshBasicMaterial", "floorBoxMesh", "floor2BoxGeometry", "floor2BoxMaterial", "floor2BoxMesh", "setWorkersUrl", "baseUrl", "setCollisionWorkerUrl", "setMaplibreWorkerUrl", "MAPLIBRE_WORKER_PATH", "COLLISION_WORKER_PATH", "init_define_process", "Debug", "core", "__publicField", "init_define_process", "z", "updateGlobalStateSchema", "init_define_process", "import_lodash", "extractProperties", "object1", "object2", "result", "processObject", "target", "key", "object1Value", "object2Value", "animationFactory", "initialState", "finalValues", "baseState", "finalState", "merge", "intermediateState", "interpolate", "initial", "final", "percent", "currentValue", "finalValue", "isColor", "currentColor", "stringToRgbArray", "finalColor", "rgbArrayToString", "Mappedin_Logger_default", "_pubSub", "_api", "_core", "MapView", "rendererCore", "__privateAdd", "__publicField", "__privateGet", "from", "to", "options", "eventName", "fn", "__privateSet", "PubSub", "geojsonApi", "GeoJsonApi", "define_process_default", "Debug", "target", "state", "initialState", "Mappedin_Logger_default", "res", "animate", "animationFactory", "tween", "percent", "ANIMATION_TWEENS", "promise", "update", "updateGlobalStateSchema", "e", "coreUpdate", "backgroundColor", "backgroundAlpha", "getPublicOptions", "coreState", "MappedinError", "mapData", "floor", "floorStack", "floors", "object", "c", "altitude", "zoomLevel", "type", "latitudeOrParams", "longitude", "coordinate_default", "x", "y", "coordinate", "opitons", "Inspector", "takeScreenshotOptions", "indoorCanvas", "outdoorMap", "resolve", "outdoorCanvas", "compositeCanvas", "compositeCtx", "value", "init_define_process", "TWO_HOURS_MS", "_pubsub", "_mapIds", "_options", "_accessTokenPromise", "_sasTokensPromise", "_accessToken", "_sasTokens", "_accessTokenRefresh", "_sasTokensRefresh", "_handleWindowFocus", "_TokenManager_instances", "setAccessToken_fn", "setSasTokens_fn", "refreshAccessToken_fn", "refreshSasTokens_fn", "setAccessTokenRefresh_fn", "setSasTokensRefresh_fn", "stopRefreshing_fn", "TokenManager", "mapIds", "options", "__privateAdd", "PubSub", "__privateGet", "__privateMethod", "__publicField", "eventName", "fn", "__privateSet", "enterprise", "Mappedin_Logger_default", "promises", "accessToken", "sasTokens", "isBrowser", "mapId", "isDifferent", "forceRefresh", "getAccessToken", "token", "error", "resolve", "reject", "sasTokenPromises", "getSasToken", "res", "expiresIn", "ACCESS_TOKEN_REFRESH_BUFFER_MS", "tokens", "SAS_TOKEN_REFRESH_BUFFER_MS", "init_define_process", "hydrateMapData", "backup", "userOptions", "mvfVersion", "userOptionsWithDefaults", "mvf", "env", "createEnvControl", "internalOptions", "unzipAndParseMVFv2", "lp", "parseLanguagePack", "floorStackIds", "getBuildingIds", "mapIds", "tokenManager", "TokenManager", "accessToken", "tokenData", "e", "Mappedin_Logger_default", "shouldForceEnterpriseLocations", "mapDataInternal", "MapDataInternal", "mapData", "map_data_default", "language", "init_define_process", "injectCSS", "style", "id", "stylesArr", "s", "styleContent", "styleElement", "existing", "navigation_default", "marker_default", "collisions_default", "interactions_default", "html_controls_default", "maplibre_gl_default", "init_define_process", "findNavigatorPreferredLanguageInVenue", "venue", "isBrowser", "i", "language", "l", "findPreferredLanguageInVenue", "options", "languageCode", "fallbackToNavigatorLanguage", "preferredLanguageInVenue", "result", "navigatorLanguage", "e", "Mappedin_Logger_default", "styles", "navigation_default", "marker_default", "collisions_default", "interactions_default", "html_controls_default", "maplibre_gl_default", "CUSTOM_WATERMARK_ON_CLICK_FN", "__setWatermarkOnClickFn", "fn", "hydrateMapDataFromMVF", "mvf", "options", "accessToken", "env", "createEnvControl", "getAccessToken", "e", "Mappedin_Logger_default", "mapDataInternal", "MapDataInternal", "map_data_default", "USE_ENTERPRISE_API", "setUseEnterpriseAPI", "value", "FORCE_ENTERPRISE_LOCATIONS", "forceEnterpriseLocations", "shouldForceEnterpriseLocations", "getMapData", "userOptions", "enterprise", "userOptionsWithDefaults", "tokenManager", "TokenManager", "aud", "sub", "decodeAccessToken", "ENTERPRISE_API_AUDIENCE", "audience", "tokenData", "beforeDownload", "data", "localePacks", "venueOptions", "result", "downloadVenueBundleMVFAPIGateway", "downloadMVF", "postDownload", "unzipAndParseMVFv2", "postParse", "floorStackIds", "getBuildingIds", "mapData", "language", "getMapDataEnterprise", "checkWorkerUrls", "collisionWorkerUrl", "maplibreWorkerUrl", "promises", "collisionResponse", "maplibreResponse", "show3dMap", "el", "start", "optionsWithDefaults", "handleShow3DMapOptionDefault", "validateOptions", "injectCSS", "capabilities", "handleTokenCapabilities", "internal", "getMapDataInternal", "disableCollisionWorker", "disableOutdoors", "workerUrls", "core", "createRenderer", "mapView3d", "MapView", "getVersion", "define_process_default", "show3dMapGeojson"]
}
