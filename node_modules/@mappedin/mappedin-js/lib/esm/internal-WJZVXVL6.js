import{b as Me,n as Le,o as Ee,p as je,q as De}from"./chunk-3PM6GKGK.js";import{q as Fe}from"./chunk-UOCWYBVK.js";import"./chunk-MLCPE7I2.js";import{a as A}from"./chunk-3U5JJXJA.js";import{b as At,d as Ft,e as $,f as Oe,g as re,h as Ce,i as Ae}from"./chunk-ROCNZJLL.js";var It=At((V,M)=>{A();var Wt=200,it="__lodash_hash_undefined__",Ut=800,$t=16,st=9007199254740991,rt="[object Arguments]",Gt="[object Array]",qt="[object AsyncFunction]",Jt="[object Boolean]",Ht="[object Date]",Kt="[object Error]",ot="[object Function]",Qt="[object GeneratorFunction]",Yt="[object Map]",Zt="[object Number]",Xt="[object Null]",at="[object Object]",en="[object Proxy]",tn="[object RegExp]",nn="[object Set]",sn="[object String]",rn="[object Undefined]",on="[object WeakMap]",an="[object ArrayBuffer]",cn="[object DataView]",un="[object Float32Array]",ln="[object Float64Array]",dn="[object Int8Array]",hn="[object Int16Array]",fn="[object Int32Array]",pn="[object Uint8Array]",gn="[object Uint8ClampedArray]",mn="[object Uint16Array]",_n="[object Uint32Array]",yn=/[\\^$.*+?()[\]{}|]/g,bn=/^\[object .+?Constructor\]$/,wn=/^(?:0|[1-9]\d*)$/,_={};_[un]=_[ln]=_[dn]=_[hn]=_[fn]=_[pn]=_[gn]=_[mn]=_[_n]=!0;_[rt]=_[Gt]=_[an]=_[Jt]=_[cn]=_[Ht]=_[Kt]=_[ot]=_[Yt]=_[Zt]=_[at]=_[tn]=_[nn]=_[sn]=_[on]=!1;var ct=typeof global=="object"&&global&&global.Object===Object&&global,Sn=typeof self=="object"&&self&&self.Object===Object&&self,N=ct||Sn||Function("return this")(),ut=typeof V=="object"&&V&&!V.nodeType&&V,P=ut&&typeof M=="object"&&M&&!M.nodeType&&M,lt=P&&P.exports===ut,ge=lt&&ct.process,He=function(){try{var t=P&&P.require&&P.require("util").types;return t||ge&&ge.binding&&ge.binding("util")}catch{}}(),Ke=He&&He.isTypedArray;function dt(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function vn(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}function xn(t){return function(e){return t(e)}}function In(t,e){return t?.[e]}function Tn(t,e){return function(n){return t(e(n))}}var zn=Array.prototype,On=Function.prototype,Q=Object.prototype,me=N["__core-js_shared__"],Y=On.toString,x=Q.hasOwnProperty,Qe=function(){var t=/[^.]+$/.exec(me&&me.keys&&me.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),ht=Q.toString,Cn=Y.call(Object),An=RegExp("^"+Y.call(x).replace(yn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),H=lt?N.Buffer:void 0,Ye=N.Symbol,Ze=N.Uint8Array,Xe=H?H.allocUnsafe:void 0,ft=Tn(Object.getPrototypeOf,Object),et=Object.create,Fn=Q.propertyIsEnumerable,Mn=zn.splice,O=Ye?Ye.toStringTag:void 0,K=function(){try{var t=xe(Object,"defineProperty");return t({},"",{}),t}catch{}}(),Ln=H?H.isBuffer:void 0,tt=Math.max,En=Date.now,pt=xe(N,"Map"),B=xe(Object,"create"),jn=function(){function t(){}return function(e){if(!v(e))return{};if(et)return et(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function C(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function Dn(){this.__data__=B?B(null):{},this.size=0}function Rn(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Vn(t){var e=this.__data__;if(B){var n=e[t];return n===it?void 0:n}return x.call(e,t)?e[t]:void 0}function Pn(t){var e=this.__data__;return B?e[t]!==void 0:x.call(e,t)}function Bn(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=B&&e===void 0?it:e,this}C.prototype.clear=Dn;C.prototype.delete=Rn;C.prototype.get=Vn;C.prototype.has=Pn;C.prototype.set=Bn;function I(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function Nn(){this.__data__=[],this.size=0}function kn(t){var e=this.__data__,n=Z(e,t);if(n<0)return!1;var i=e.length-1;return n==i?e.pop():Mn.call(e,n,1),--this.size,!0}function Wn(t){var e=this.__data__,n=Z(e,t);return n<0?void 0:e[n][1]}function Un(t){return Z(this.__data__,t)>-1}function $n(t,e){var n=this.__data__,i=Z(n,t);return i<0?(++this.size,n.push([t,e])):n[i][1]=e,this}I.prototype.clear=Nn;I.prototype.delete=kn;I.prototype.get=Wn;I.prototype.has=Un;I.prototype.set=$n;function L(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function Gn(){this.size=0,this.__data__={hash:new C,map:new(pt||I),string:new C}}function qn(t){var e=ee(this,t).delete(t);return this.size-=e?1:0,e}function Jn(t){return ee(this,t).get(t)}function Hn(t){return ee(this,t).has(t)}function Kn(t,e){var n=ee(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this}L.prototype.clear=Gn;L.prototype.delete=qn;L.prototype.get=Jn;L.prototype.has=Hn;L.prototype.set=Kn;function E(t){var e=this.__data__=new I(t);this.size=e.size}function Qn(){this.__data__=new I,this.size=0}function Yn(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function Zn(t){return this.__data__.get(t)}function Xn(t){return this.__data__.has(t)}function ei(t,e){var n=this.__data__;if(n instanceof I){var i=n.__data__;if(!pt||i.length<Wt-1)return i.push([t,e]),this.size=++n.size,this;n=this.__data__=new L(i)}return n.set(t,e),this.size=n.size,this}E.prototype.clear=Qn;E.prototype.delete=Yn;E.prototype.get=Zn;E.prototype.has=Xn;E.prototype.set=ei;function ti(t,e){var n=we(t),i=!n&&be(t),s=!n&&!i&&bt(t),r=!n&&!i&&!s&&St(t),o=n||i||s||r,a=o?vn(t.length,String):[],c=a.length;for(var u in t)(e||x.call(t,u))&&!(o&&(u=="length"||s&&(u=="offset"||u=="parent")||r&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||_t(u,c)))&&a.push(u);return a}function _e(t,e,n){(n!==void 0&&!te(t[e],n)||n===void 0&&!(e in t))&&Se(t,e,n)}function ni(t,e,n){var i=t[e];(!(x.call(t,e)&&te(i,n))||n===void 0&&!(e in t))&&Se(t,e,n)}function Z(t,e){for(var n=t.length;n--;)if(te(t[n][0],e))return n;return-1}function Se(t,e,n){e=="__proto__"&&K?K(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}var ii=gi();function X(t){return t==null?t===void 0?rn:Xt:O&&O in Object(t)?mi(t):vi(t)}function nt(t){return k(t)&&X(t)==rt}function si(t){if(!v(t)||wi(t))return!1;var e=Te(t)?An:bn;return e.test(zi(t))}function ri(t){return k(t)&&wt(t.length)&&!!_[X(t)]}function oi(t){if(!v(t))return Si(t);var e=yt(t),n=[];for(var i in t)i=="constructor"&&(e||!x.call(t,i))||n.push(i);return n}function ve(t,e,n,i,s){t!==e&&ii(e,function(r,o){if(s||(s=new E),v(r))ai(t,e,o,n,ve,i,s);else{var a=i?i(ye(t,o),r,o+"",t,e,s):void 0;a===void 0&&(a=r),_e(t,o,a)}},vt)}function ai(t,e,n,i,s,r,o){var a=ye(t,n),c=ye(e,n),u=o.get(c);if(u){_e(t,n,u);return}var l=r?r(a,c,n+"",t,e,o):void 0,h=l===void 0;if(h){var d=we(c),f=!d&&bt(c),g=!d&&!f&&St(c);l=c,d||f||g?we(a)?l=a:Oi(a)?l=hi(a):f?(h=!1,l=ui(c,!0)):g?(h=!1,l=di(c,!0)):l=[]:Ci(c)||be(c)?(l=a,be(a)?l=Ai(a):(!v(a)||Te(a))&&(l=_i(c))):h=!1}h&&(o.set(c,l),s(l,c,i,r,o),o.delete(c)),_e(t,n,l)}function gt(t,e){return Ii(xi(t,e,xt),t+"")}var ci=K?function(t,e){return K(t,"toString",{configurable:!0,enumerable:!1,value:Li(e),writable:!0})}:xt;function ui(t,e){if(e)return t.slice();var n=t.length,i=Xe?Xe(n):new t.constructor(n);return t.copy(i),i}function li(t){var e=new t.constructor(t.byteLength);return new Ze(e).set(new Ze(t)),e}function di(t,e){var n=e?li(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function hi(t,e){var n=-1,i=t.length;for(e||(e=Array(i));++n<i;)e[n]=t[n];return e}function fi(t,e,n,i){var s=!n;n||(n={});for(var r=-1,o=e.length;++r<o;){var a=e[r],c=i?i(n[a],t[a],a,n,t):void 0;c===void 0&&(c=t[a]),s?Se(n,a,c):ni(n,a,c)}return n}function pi(t){return gt(function(e,n){var i=-1,s=n.length,r=s>1?n[s-1]:void 0,o=s>2?n[2]:void 0;for(r=t.length>3&&typeof r=="function"?(s--,r):void 0,o&&yi(n[0],n[1],o)&&(r=s<3?void 0:r,s=1),e=Object(e);++i<s;){var a=n[i];a&&t(e,a,i,r)}return e})}function gi(t){return function(e,n,i){for(var s=-1,r=Object(e),o=i(e),a=o.length;a--;){var c=o[t?a:++s];if(n(r[c],c,r)===!1)break}return e}}function mt(t,e,n,i,s,r){return v(t)&&v(e)&&(r.set(e,t),ve(t,e,void 0,mt,r),r.delete(e)),t}function ee(t,e){var n=t.__data__;return bi(e)?n[typeof e=="string"?"string":"hash"]:n.map}function xe(t,e){var n=In(t,e);return si(n)?n:void 0}function mi(t){var e=x.call(t,O),n=t[O];try{t[O]=void 0;var i=!0}catch{}var s=ht.call(t);return i&&(e?t[O]=n:delete t[O]),s}function _i(t){return typeof t.constructor=="function"&&!yt(t)?jn(ft(t)):{}}function _t(t,e){var n=typeof t;return e=e??st,!!e&&(n=="number"||n!="symbol"&&wn.test(t))&&t>-1&&t%1==0&&t<e}function yi(t,e,n){if(!v(n))return!1;var i=typeof e;return(i=="number"?Ie(n)&&_t(e,n.length):i=="string"&&e in n)?te(n[e],t):!1}function bi(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function wi(t){return!!Qe&&Qe in t}function yt(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||Q;return t===n}function Si(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}function vi(t){return ht.call(t)}function xi(t,e,n){return e=tt(e===void 0?t.length-1:e,0),function(){for(var i=arguments,s=-1,r=tt(i.length-e,0),o=Array(r);++s<r;)o[s]=i[e+s];s=-1;for(var a=Array(e+1);++s<e;)a[s]=i[s];return a[e]=n(o),dt(t,this,a)}}function ye(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var Ii=Ti(ci);function Ti(t){var e=0,n=0;return function(){var i=En(),s=$t-(i-n);if(n=i,s>0){if(++e>=Ut)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function zi(t){if(t!=null){try{return Y.call(t)}catch{}try{return t+""}catch{}}return""}function te(t,e){return t===e||t!==t&&e!==e}var be=nt(function(){return arguments}())?nt:function(t){return k(t)&&x.call(t,"callee")&&!Fn.call(t,"callee")},we=Array.isArray;function Ie(t){return t!=null&&wt(t.length)&&!Te(t)}function Oi(t){return k(t)&&Ie(t)}var bt=Ln||Ei;function Te(t){if(!v(t))return!1;var e=X(t);return e==ot||e==Qt||e==qt||e==en}function wt(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=st}function v(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function k(t){return t!=null&&typeof t=="object"}function Ci(t){if(!k(t)||X(t)!=at)return!1;var e=ft(t);if(e===null)return!0;var n=x.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&Y.call(n)==Cn}var St=Ke?xn(Ke):ri;function Ai(t){return fi(t,vt(t))}var Fi=gt(function(t){return t.push(void 0,mt),dt(Mi,void 0,t)});function vt(t){return Ie(t)?ti(t,!0):oi(t)}var Mi=pi(function(t,e,n,i){ve(t,e,n,i)});function Li(t){return function(){return t}}function xt(t){return t}function Ei(){return!1}M.exports=Fi});A();A();var Mt="ENTRIES",ke="KEYS",We="VALUES",b="",D=class{constructor(e,n){let i=e._tree,s=Array.from(i.keys());this.set=e,this._type=n,this._path=s.length>0?[{node:i,keys:s}]:[]}next(){let e=this.dive();return this.backtrack(),e}dive(){if(this._path.length===0)return{done:!0,value:void 0};let{node:e,keys:n}=F(this._path);if(F(n)===b)return{done:!1,value:this.result()};let i=e.get(F(n));return this._path.push({node:i,keys:Array.from(i.keys())}),this.dive()}backtrack(){if(this._path.length===0)return;let e=F(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}key(){return this.set._prefix+this._path.map(({keys:e})=>F(e)).filter(e=>e!==b).join("")}value(){return F(this._path).node.get(b)}result(){switch(this._type){case We:return this.value();case ke:return this.key();default:return[this.key(),this.value()]}}[Symbol.iterator](){return this}},F=t=>t[t.length-1],Lt=(t,e,n)=>{let i=new Map;if(e===void 0)return i;let s=e.length+1,r=s+n,o=new Uint8Array(r*s).fill(n+1);for(let a=0;a<s;++a)o[a]=a;for(let a=1;a<r;++a)o[a*s]=a;return Ue(t,e,n,i,o,1,s,""),i},Ue=(t,e,n,i,s,r,o,a)=>{let c=r*o;e:for(let u of t.keys())if(u===b){let l=s[c-1];l<=n&&i.set(a,[t.get(u),l])}else{let l=r;for(let h=0;h<u.length;++h,++l){let d=u[h],f=o*l,g=f-o,m=s[f],p=Math.max(0,l-n-1),w=Math.min(o-1,l+n);for(let S=p;S<w;++S){let ie=d!==e[S],se=s[g+S]+ +ie,U=s[g+S+1]+1,T=s[f+S]+1,j=s[f+S+1]=Math.min(se,U,T);j<m&&(m=j)}if(m>n)continue e}Ue(t.get(u),e,n,i,s,l,o,a+u)}},R=class t{constructor(e=new Map,n=""){this._size=void 0,this._tree=e,this._prefix=n}atPrefix(e){if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");let[n,i]=J(this._tree,e.slice(this._prefix.length));if(n===void 0){let[s,r]=fe(i);for(let o of s.keys())if(o!==b&&o.startsWith(r)){let a=new Map;return a.set(o.slice(r.length),s.get(o)),new t(a,e)}}return new t(n,e)}clear(){this._size=void 0,this._tree.clear()}delete(e){return this._size=void 0,Et(this._tree,e)}entries(){return new D(this,Mt)}forEach(e){for(let[n,i]of this)e(n,i,this)}fuzzyGet(e,n){return Lt(this._tree,e,n)}get(e){let n=le(this._tree,e);return n!==void 0?n.get(b):void 0}has(e){let n=le(this._tree,e);return n!==void 0&&n.has(b)}keys(){return new D(this,ke)}set(e,n){if(typeof e!="string")throw new Error("key must be a string");return this._size=void 0,oe(this._tree,e).set(b,n),this}get size(){if(this._size)return this._size;this._size=0;let e=this.entries();for(;!e.next().done;)this._size+=1;return this._size}update(e,n){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;let i=oe(this._tree,e);return i.set(b,n(i.get(b))),this}fetch(e,n){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;let i=oe(this._tree,e),s=i.get(b);return s===void 0&&i.set(b,s=n()),s}values(){return new D(this,We)}[Symbol.iterator](){return this.entries()}static from(e){let n=new t;for(let[i,s]of e)n.set(i,s);return n}static fromObject(e){return t.from(Object.entries(e))}},J=(t,e,n=[])=>{if(e.length===0||t==null)return[t,n];for(let i of t.keys())if(i!==b&&e.startsWith(i))return n.push([t,i]),J(t.get(i),e.slice(i.length),n);return n.push([t,e]),J(void 0,"",n)},le=(t,e)=>{if(e.length===0||t==null)return t;for(let n of t.keys())if(n!==b&&e.startsWith(n))return le(t.get(n),e.slice(n.length))},oe=(t,e)=>{let n=e.length;e:for(let i=0;t&&i<n;){for(let r of t.keys())if(r!==b&&e[i]===r[0]){let o=Math.min(n-i,r.length),a=1;for(;a<o&&e[i+a]===r[a];)++a;let c=t.get(r);if(a===r.length)t=c;else{let u=new Map;u.set(r.slice(a),c),t.set(e.slice(i,i+a),u),t.delete(r),t=u}i+=a;continue e}let s=new Map;return t.set(e.slice(i),s),s}return t},Et=(t,e)=>{let[n,i]=J(t,e);if(n!==void 0){if(n.delete(b),n.size===0)$e(i);else if(n.size===1){let[s,r]=n.entries().next().value;Ge(i,s,r)}}},$e=t=>{if(t.length===0)return;let[e,n]=fe(t);if(e.delete(n),e.size===0)$e(t.slice(0,-1));else if(e.size===1){let[i,s]=e.entries().next().value;i!==b&&Ge(t.slice(0,-1),i,s)}},Ge=(t,e,n)=>{if(t.length===0)return;let[i,s]=fe(t);i.set(s+e,n),i.delete(s)},fe=t=>t[t.length-1],pe="or",qe="and",jt="and_not",z=class t{constructor(e){if(e?.fields==null)throw new Error('MiniSearch: option "fields" must be provided');let n=e.autoVacuum==null||e.autoVacuum===!0?ue:e.autoVacuum;this._options={...ce,...e,autoVacuum:n,searchOptions:{...Re,...e.searchOptions||{}},autoSuggestOptions:{...Bt,...e.autoSuggestOptions||{}}},this._index=new R,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=he,this.addFields(this._options.fields)}add(e){let{extractField:n,stringifyField:i,tokenize:s,processTerm:r,fields:o,idField:a}=this._options,c=n(e,a);if(c==null)throw new Error(`MiniSearch: document does not have ID field "${a}"`);if(this._idToShortId.has(c))throw new Error(`MiniSearch: duplicate ID ${c}`);let u=this.addDocumentId(c);this.saveStoredFields(u,e);for(let l of o){let h=n(e,l);if(h==null)continue;let d=s(i(h,l),l),f=this._fieldIds[l],g=new Set(d).size;this.addFieldLength(u,f,this._documentCount-1,g);for(let m of d){let p=r(m,l);if(Array.isArray(p))for(let w of p)this.addTerm(f,u,w);else p&&this.addTerm(f,u,p)}}}addAll(e){for(let n of e)this.add(n)}addAllAsync(e,n={}){let{chunkSize:i=10}=n,s={chunk:[],promise:Promise.resolve()},{chunk:r,promise:o}=e.reduce(({chunk:a,promise:c},u,l)=>(a.push(u),(l+1)%i===0?{chunk:[],promise:c.then(()=>new Promise(h=>setTimeout(h,0))).then(()=>this.addAll(a))}:{chunk:a,promise:c}),s);return o.then(()=>this.addAll(r))}remove(e){let{tokenize:n,processTerm:i,extractField:s,stringifyField:r,fields:o,idField:a}=this._options,c=s(e,a);if(c==null)throw new Error(`MiniSearch: document does not have ID field "${a}"`);let u=this._idToShortId.get(c);if(u==null)throw new Error(`MiniSearch: cannot remove document with ID ${c}: it is not in the index`);for(let l of o){let h=s(e,l);if(h==null)continue;let d=n(r(h,l),l),f=this._fieldIds[l],g=new Set(d).size;this.removeFieldLength(u,f,this._documentCount,g);for(let m of d){let p=i(m,l);if(Array.isArray(p))for(let w of p)this.removeTerm(f,u,w);else p&&this.removeTerm(f,u,p)}}this._storedFields.delete(u),this._documentIds.delete(u),this._idToShortId.delete(c),this._fieldLength.delete(u),this._documentCount-=1}removeAll(e){if(e)for(let n of e)this.remove(n);else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new R,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}}discard(e){let n=this._idToShortId.get(e);if(n==null)throw new Error(`MiniSearch: cannot discard document with ID ${e}: it is not in the index`);this._idToShortId.delete(e),this._documentIds.delete(n),this._storedFields.delete(n),(this._fieldLength.get(n)||[]).forEach((i,s)=>{this.removeFieldLength(n,s,this._documentCount,i)}),this._fieldLength.delete(n),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()}maybeAutoVacuum(){if(this._options.autoVacuum===!1)return;let{minDirtFactor:e,minDirtCount:n,batchSize:i,batchWait:s}=this._options.autoVacuum;this.conditionalVacuum({batchSize:i,batchWait:s},{minDirtCount:n,minDirtFactor:e})}discardAll(e){let n=this._options.autoVacuum;try{this._options.autoVacuum=!1;for(let i of e)this.discard(i)}finally{this._options.autoVacuum=n}this.maybeAutoVacuum()}replace(e){let{idField:n,extractField:i}=this._options,s=i(e,n);this.discard(s),this.add(e)}vacuum(e={}){return this.conditionalVacuum(e)}conditionalVacuum(e,n){return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&n,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(()=>{let i=this._enqueuedVacuumConditions;return this._enqueuedVacuumConditions=he,this.performVacuuming(e,i)}),this._enqueuedVacuum)):this.vacuumConditionsMet(n)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(e),this._currentVacuum)}async performVacuuming(e,n){let i=this._dirtCount;if(this.vacuumConditionsMet(n)){let s=e.batchSize||de.batchSize,r=e.batchWait||de.batchWait,o=1;for(let[a,c]of this._index){for(let[u,l]of c)for(let[h]of l)this._documentIds.has(h)||(l.size<=1?c.delete(u):l.delete(h));this._index.get(a).size===0&&this._index.delete(a),o%s===0&&await new Promise(u=>setTimeout(u,r)),o+=1}this._dirtCount-=i}await null,this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null}vacuumConditionsMet(e){if(e==null)return!0;let{minDirtCount:n,minDirtFactor:i}=e;return n=n||ue.minDirtCount,i=i||ue.minDirtFactor,this.dirtCount>=n&&this.dirtFactor>=i}get isVacuuming(){return this._currentVacuum!=null}get dirtCount(){return this._dirtCount}get dirtFactor(){return this._dirtCount/(1+this._documentCount+this._dirtCount)}has(e){return this._idToShortId.has(e)}getStoredFields(e){let n=this._idToShortId.get(e);if(n!=null)return this._storedFields.get(n)}search(e,n={}){let{searchOptions:i}=this._options,s={...i,...n},r=this.executeQuery(e,n),o=[];for(let[a,{score:c,terms:u,match:l}]of r){let h=u.length||1,d={id:this._documentIds.get(a),score:c*h,terms:Object.keys(l),queryTerms:u,match:l};Object.assign(d,this._storedFields.get(a)),(s.filter==null||s.filter(d))&&o.push(d)}return e===t.wildcard&&s.boostDocument==null||o.sort(Pe),o}autoSuggest(e,n={}){n={...this._options.autoSuggestOptions,...n};let i=new Map;for(let{score:r,terms:o}of this.search(e,n)){let a=o.join(" "),c=i.get(a);c!=null?(c.score+=r,c.count+=1):i.set(a,{score:r,terms:o,count:1})}let s=[];for(let[r,{score:o,terms:a,count:c}]of i)s.push({suggestion:r,terms:a,score:o/c});return s.sort(Pe),s}get documentCount(){return this._documentCount}get termCount(){return this._index.size}static loadJSON(e,n){if(n==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(e),n)}static async loadJSONAsync(e,n){if(n==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJSAsync(JSON.parse(e),n)}static getDefault(e){if(ce.hasOwnProperty(e))return ae(ce,e);throw new Error(`MiniSearch: unknown option "${e}"`)}static loadJS(e,n){let{index:i,documentIds:s,fieldLength:r,storedFields:o,serializationVersion:a}=e,c=this.instantiateMiniSearch(e,n);c._documentIds=G(s),c._fieldLength=G(r),c._storedFields=G(o);for(let[u,l]of c._documentIds)c._idToShortId.set(l,u);for(let[u,l]of i){let h=new Map;for(let d of Object.keys(l)){let f=l[d];a===1&&(f=f.ds),h.set(parseInt(d,10),G(f))}c._index.set(u,h)}return c}static async loadJSAsync(e,n){let{index:i,documentIds:s,fieldLength:r,storedFields:o,serializationVersion:a}=e,c=this.instantiateMiniSearch(e,n);c._documentIds=await q(s),c._fieldLength=await q(r),c._storedFields=await q(o);for(let[l,h]of c._documentIds)c._idToShortId.set(h,l);let u=0;for(let[l,h]of i){let d=new Map;for(let f of Object.keys(h)){let g=h[f];a===1&&(g=g.ds),d.set(parseInt(f,10),await q(g))}++u%1e3===0&&await Je(0),c._index.set(l,d)}return c}static instantiateMiniSearch(e,n){let{documentCount:i,nextId:s,fieldIds:r,averageFieldLength:o,dirtCount:a,serializationVersion:c}=e;if(c!==1&&c!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");let u=new t(n);return u._documentCount=i,u._nextId=s,u._idToShortId=new Map,u._fieldIds=r,u._avgFieldLength=o,u._dirtCount=a||0,u._index=new R,u}executeQuery(e,n={}){if(e===t.wildcard)return this.executeWildcardQuery(n);if(typeof e!="string"){let d={...n,...e,queries:void 0},f=e.queries.map(g=>this.executeQuery(g,d));return this.combineResults(f,d.combineWith)}let{tokenize:i,processTerm:s,searchOptions:r}=this._options,o={tokenize:i,processTerm:s,...r,...n},{tokenize:a,processTerm:c}=o,h=a(e).flatMap(d=>c(d)).filter(d=>!!d).map(Pt(o)).map(d=>this.executeQuerySpec(d,o));return this.combineResults(h,o.combineWith)}executeQuerySpec(e,n){let i={...this._options.searchOptions,...n},s=(i.fields||this._options.fields).reduce((m,p)=>({...m,[p]:ae(i.boost,p)||1}),{}),{boostDocument:r,weights:o,maxFuzzy:a,bm25:c}=i,{fuzzy:u,prefix:l}={...Re.weights,...o},h=this._index.get(e.term),d=this.termResults(e.term,e.term,1,e.termBoost,h,s,r,c),f,g;if(e.prefix&&(f=this._index.atPrefix(e.term)),e.fuzzy){let m=e.fuzzy===!0?.2:e.fuzzy,p=m<1?Math.min(a,Math.round(e.term.length*m)):m;p&&(g=this._index.fuzzyGet(e.term,p))}if(f)for(let[m,p]of f){let w=m.length-e.term.length;if(!w)continue;g?.delete(m);let S=l*m.length/(m.length+.3*w);this.termResults(e.term,m,S,e.termBoost,p,s,r,c,d)}if(g)for(let m of g.keys()){let[p,w]=g.get(m);if(!w)continue;let S=u*m.length/(m.length+w);this.termResults(e.term,m,S,e.termBoost,p,s,r,c,d)}return d}executeWildcardQuery(e){let n=new Map,i={...this._options.searchOptions,...e};for(let[s,r]of this._documentIds){let o=i.boostDocument?i.boostDocument(r,"",this._storedFields.get(s)):1;n.set(s,{score:o,terms:[],match:{}})}return n}combineResults(e,n=pe){if(e.length===0)return new Map;let i=n.toLowerCase(),s=Dt[i];if(!s)throw new Error(`Invalid combination operator: ${n}`);return e.reduce(s)||new Map}toJSON(){let e=[];for(let[n,i]of this._index){let s={};for(let[r,o]of i)s[r]=Object.fromEntries(o);e.push([n,s])}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:e,serializationVersion:2}}termResults(e,n,i,s,r,o,a,c,u=new Map){if(r==null)return u;for(let l of Object.keys(o)){let h=o[l],d=this._fieldIds[l],f=r.get(d);if(f==null)continue;let g=f.size,m=this._avgFieldLength[d];for(let p of f.keys()){if(!this._documentIds.has(p)){this.removeTerm(d,p,n),g-=1;continue}let w=a?a(this._documentIds.get(p),n,this._storedFields.get(p)):1;if(!w)continue;let S=f.get(p),ie=this._fieldLength.get(p)[d],se=Vt(S,g,this._documentCount,ie,m,c),U=i*s*h*w*se,T=u.get(p);if(T){T.score+=U,Nt(T.terms,e);let j=ae(T.match,n);j?j.push(l):T.match[n]=[l]}else u.set(p,{score:U,terms:[e],match:{[n]:[l]}})}}return u}addTerm(e,n,i){let s=this._index.fetch(i,Be),r=s.get(e);if(r==null)r=new Map,r.set(n,1),s.set(e,r);else{let o=r.get(n);r.set(n,(o||0)+1)}}removeTerm(e,n,i){if(!this._index.has(i)){this.warnDocumentChanged(n,e,i);return}let s=this._index.fetch(i,Be),r=s.get(e);r==null||r.get(n)==null?this.warnDocumentChanged(n,e,i):r.get(n)<=1?r.size<=1?s.delete(e):r.delete(n):r.set(n,r.get(n)-1),this._index.get(i).size===0&&this._index.delete(i)}warnDocumentChanged(e,n,i){for(let s of Object.keys(this._fieldIds))if(this._fieldIds[s]===n){this._options.logger("warn",`MiniSearch: document with ID ${this._documentIds.get(e)} has changed before removal: term "${i}" was not present in field "${s}". Removing a document after it has changed can corrupt the index!`,"version_conflict");return}}addDocumentId(e){let n=this._nextId;return this._idToShortId.set(e,n),this._documentIds.set(n,e),this._documentCount+=1,this._nextId+=1,n}addFields(e){for(let n=0;n<e.length;n++)this._fieldIds[e[n]]=n}addFieldLength(e,n,i,s){let r=this._fieldLength.get(e);r==null&&this._fieldLength.set(e,r=[]),r[n]=s;let a=(this._avgFieldLength[n]||0)*i+s;this._avgFieldLength[n]=a/(i+1)}removeFieldLength(e,n,i,s){if(i===1){this._avgFieldLength[n]=0;return}let r=this._avgFieldLength[n]*i-s;this._avgFieldLength[n]=r/(i-1)}saveStoredFields(e,n){let{storeFields:i,extractField:s}=this._options;if(i==null||i.length===0)return;let r=this._storedFields.get(e);r==null&&this._storedFields.set(e,r={});for(let o of i){let a=s(n,o);a!==void 0&&(r[o]=a)}}};z.wildcard=Symbol("*");var ae=(t,e)=>Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0,Dt={[pe]:(t,e)=>{for(let n of e.keys()){let i=t.get(n);if(i==null)t.set(n,e.get(n));else{let{score:s,terms:r,match:o}=e.get(n);i.score=i.score+s,i.match=Object.assign(i.match,o),Ve(i.terms,r)}}return t},[qe]:(t,e)=>{let n=new Map;for(let i of e.keys()){let s=t.get(i);if(s==null)continue;let{score:r,terms:o,match:a}=e.get(i);Ve(s.terms,o),n.set(i,{score:s.score+r,terms:s.terms,match:Object.assign(s.match,a)})}return n},[jt]:(t,e)=>{for(let n of e.keys())t.delete(n);return t}},Rt={k:1.2,b:.7,d:.5},Vt=(t,e,n,i,s,r)=>{let{k:o,b:a,d:c}=r;return Math.log(1+(n-e+.5)/(e+.5))*(c+t*(o+1)/(t+o*(1-a+a*i/s)))},Pt=t=>(e,n,i)=>{let s=typeof t.fuzzy=="function"?t.fuzzy(e,n,i):t.fuzzy||!1,r=typeof t.prefix=="function"?t.prefix(e,n,i):t.prefix===!0,o=typeof t.boostTerm=="function"?t.boostTerm(e,n,i):1;return{term:e,fuzzy:s,prefix:r,termBoost:o}},ce={idField:"id",extractField:(t,e)=>t[e],stringifyField:(t,e)=>t.toString(),tokenize:t=>t.split(kt),processTerm:t=>t.toLowerCase(),fields:void 0,searchOptions:void 0,storeFields:[],logger:(t,e)=>{typeof console?.[t]=="function"&&console[t](e)},autoVacuum:!0},Re={combineWith:pe,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:Rt},Bt={combineWith:qe,prefix:(t,e,n)=>e===n.length-1},de={batchSize:1e3,batchWait:10},he={minDirtFactor:.1,minDirtCount:20},ue={...de,...he},Nt=(t,e)=>{t.includes(e)||t.push(e)},Ve=(t,e)=>{for(let n of e)t.includes(n)||t.push(n)},Pe=({score:t},{score:e})=>e-t,Be=()=>new Map,G=t=>{let e=new Map;for(let n of Object.keys(t))e.set(parseInt(n,10),t[n]);return e},q=async t=>{let e=new Map,n=0;for(let i of Object.keys(t))e.set(parseInt(i,10),t[i]),++n%1e3===0&&await Je(0);return e},Je=t=>new Promise(e=>setTimeout(e,t)),kt=/[\n\r\p{Z}\p{P}]+/u;var Ot=Ft(It(),1);import{z as y}from"zod";var W,ne,Ct,Tt=class{constructor(e){re(this,ne);$(this,"mapData");$(this,"indexes");$(this,"ready");re(this,W);this.mapData=e,this.indexes=Ri(e),this.ready=this.populate(),Ce(this,W,Fe(Ae(this,ne,Ct).bind(this),2e3))}async populate(){let{places:e,enterpriseLocations:n,enterpriseCategories:i}=this.indexes,s=this.mapData,r=[];return e.removeAll(),r=r.concat([e.addAllAsync(s.getByType("space")),e.addAllAsync(s.getByType("point-of-interest")),e.addAllAsync(s.getByType("object")),e.addAllAsync(s.getByType("connection")),e.addAllAsync(s.getByType("floor")),e.addAllAsync(s.getByType("door")),e.addAllAsync(s.getByType("annotation")),e.addAllAsync(s.getByType("area"))]),n&&(n?.removeAll(),r.push(n.addAllAsync(s.getByType("enterprise-location")))),i&&(i?.removeAll(),r.push(i.addAllAsync(s.getByType("enterprise-category")))),Promise.all(r)}async search(e,n={}){await this.ready,Vi.parse(n);let i=(0,Ot.default)({},n,Di),s=this.indexes.places.search(e,{fields:Object.keys(i.places.fields).filter(c=>i.places.fields[c])});i.places.limit&&(s=s.slice(0,i.places.limit));let r=this.indexes.enterpriseLocations?.search(e,{fields:Object.keys(i.enterpriseLocations.fields).filter(c=>i.enterpriseLocations.fields[c])});r&&i.enterpriseLocations.limit&&(r=r.slice(0,i.enterpriseLocations.limit));let o=this.indexes.enterpriseCategories?.search(e,{fields:Object.keys(i.enterpriseCategories.fields).filter(c=>i.enterpriseCategories.fields[c])});o&&i.enterpriseCategories.limit&&(o=o.slice(0,i.enterpriseCategories.limit));let a=ji(this.mapData,{placesResult:s,locationsResult:r,categoriesResult:o});return Oe(this,W).call(this,e),a}async suggest(e,n={}){await this.ready,Pi.parse(n);let i=[],{places:{enabled:s=!0}={},enterpriseLocations:{enabled:r=!0}={}}=n;return r&&this.indexes.enterpriseLocations&&this.indexes.enterpriseLocations.autoSuggest(e,{fields:["name","tags"],combineWith:"AND",prefix:!0,boost:{name:2,tags:1}}).forEach(o=>i.push(o)),s&&this.indexes.places.autoSuggest(e,{fields:["name"],combineWith:"AND",prefix:!0}).forEach(o=>i.push(o)),i.sort((o,a)=>a.score-o.score),this.mapData.Analytics.capture("$query-suggest",{query:e,suggestions:i.map(o=>o.suggestion)}),i}};W=new WeakMap,ne=new WeakSet,Ct=function(e){this.mapData.Analytics.capture("$query-search",{query:e})};function ji(t,{placesResult:e,locationsResult:n,categoriesResult:i}){let s=e.reduce((a,{id:c,match:u,score:l,__type:h})=>{let d=t.getById(h,c);return d!=null&&!Me.is(d)&&!Le.is(d)&&!Ee.is(d)&&!je.is(d)&&!De.is(d)&&a.push({type:d.__type,match:u,score:l,item:d}),a},[]),r;if(n){r=[];for(let{id:a,match:c,score:u}of n){let l=t.getById("enterprise-location",a);l&&r.push({type:l.__type,match:c,score:u,item:l})}}let o;if(i){o=[];for(let{id:a,match:c,score:u}of i){let l=t.getById("enterprise-category",a);l&&o.push({type:l.__type,match:c,score:u,item:l})}}return{places:s,enterpriseLocations:r,enterpriseCategories:o}}var Di={places:{fields:{name:!0,description:!0}},enterpriseCategories:{fields:{name:!0,description:!1,"locations.name":!0}},enterpriseLocations:{fields:{name:!0,tags:!0,description:!0}}};function ze(t){return t.normalize("NFD").replace(/[\u0300-\u036f|\u2019|\u0027|\']/g,"").toLowerCase()}function Ri(t){let e=new z({fields:["name","description"],storeFields:["id","__type"],searchOptions:{fuzzy:.2,prefix:!0,boost:{name:2},combineWith:"AND"},extractField:(o,a)=>{let c=o[a];return typeof c=="string"?ze(c):o[a]},processTerm:o=>Bi.has(o)?"":o.toLowerCase()}),n=t.getByType("enterprise-location"),i;n&&(i=new z({fields:["name","tags","description"],storeFields:["id","__type"],searchOptions:{combineWith:"OR",prefix:!0,fuzzy:.2,boost:{name:3,tags:2,description:1}},extractField:(o,a)=>Array.isArray(o[a])?o[a].join(" "):typeof o[a]=="string"?ze(o[a]):o[a]}));let s=t.getByType("enterprise-category"),r;return s&&(r=new z({fields:["name","description","locations.name"],storeFields:["id","__type"],extractField(o,a){return a==="locations.name"?o.locations.reduce((u,l)=>u+` ${zt} `+l.name,"")+` ${zt}`:typeof o[a]=="string"?ze(o[a]):o[a]},searchOptions:{combineWith:"OR",prefix:!0,fuzzy:.2,boost:{name:2,"locations.name":2}}})),{enterpriseCategories:r,enterpriseLocations:i,places:e}}var Vi=y.object({places:y.object({fields:y.object({name:y.boolean().optional(),description:y.boolean().optional()}).optional(),limit:y.number().positive().optional()}).optional(),enterpriseCategories:y.object({fields:y.object({name:y.boolean().optional(),description:y.boolean().optional(),"locations.name":y.boolean().optional()}).optional(),limit:y.number().positive().optional()}).optional(),enterpriseLocations:y.object({fields:y.object({name:y.boolean().optional(),tags:y.boolean().optional(),description:y.boolean().optional()}).optional(),limit:y.number().positive().optional()}).optional()}),Pi=y.object({places:y.object({enabled:y.boolean().optional()}).optional(),enterpriseLocations:y.object({enabled:y.boolean().optional()}).optional()}),Bi=new Set(["the","an","and","or","of","in","on","at","to","from","with","by","for"]),zt="";export{Tt as InternalSearch,ze as removeAccents};
//# sourceMappingURL=internal-WJZVXVL6.js.map
